{"version":3,"file":"194.931bb4d4a157b1413f99.chunk.js","mappings":"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AAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,MAAO,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,KAAM,KAAO,KAAM,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,KAAO,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,YAAY,MAAO,OAAO,MAAO,OAAO,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,cAAc,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,MAAO,kBAAkB,MAAO,QAAQ,MAAO,kBAAkB,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,4CAA4C,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,QAAQ,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,8BAA8B,KAAM,yCAAyC,KAAM,yCAAyC,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,6BAA6B,KAAM,6BAA6B,KAAM,wCAAwC,KAAM,wCAAwC,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,GAAI,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,mBAAmB,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,GAAI,QAAQ,IAAK,QAAQ,IAAK,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,IAAK,QAAQ,KAAM,QAAQ,IAAK,QAAQ,IAAK,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,IAAK,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,8BAA8B,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,mBAAmB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,kBAAkB,KAAM,kBAAkB,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,MAAO,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,QAAQ,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,IAAK,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,iBAAiB,KAAM,iBAAiB,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,kBAAkB,KAAM,kBAAkB,KAAM,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,MAAO,OAAO,KAAM,OAAO,MAAO,OAAO,MAAO,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,oDAAoD,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,yCAAyC,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,0CAA0C,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,yBAAyB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,wBAAwB,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,cAAc,EAAG,aAAa,EAAG,aAAa,EAAG,aAAa,EAAG,aA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","sources":["webpack://tweb/./src/components/animationIntersector.ts","webpack://tweb/./src/components/appMediaPlaybackController.ts","webpack://tweb/./src/components/appMediaViewer.ts","webpack://tweb/./src/lib/mediaPlayer.ts","webpack://tweb/./src/components/appMediaViewerBase.ts","webpack://tweb/./src/helpers/fillPropertyValue.ts","webpack://tweb/./src/components/appNavigationController.ts","webpack://tweb/./src/components/appSearch.ts","webpack://tweb/./src/components/appSearchSuper..ts","webpack://tweb/./src/helpers/dom/lockTouchScroll.ts","webpack://tweb/./src/components/appSelectPeers.ts","webpack://tweb/./src/components/audio.ts","webpack://tweb/./src/helpers/avatarListLoader.ts","webpack://tweb/./src/components/appMediaViewerAvatar.ts","webpack://tweb/./src/components/avatar.ts","webpack://tweb/./src/components/avatarEdit.ts","webpack://tweb/./src/components/button.ts","webpack://tweb/./src/components/buttonCorner.ts","webpack://tweb/./src/components/buttonIcon.ts","webpack://tweb/./src/components/buttonMenu.ts","webpack://tweb/./src/components/buttonMenuToggle.ts","webpack://tweb/./src/components/chat/gradientRenderer.ts","webpack://tweb/./src/helpers/easing/easeOutQuad.ts","webpack://tweb/./src/components/chat/selection.ts","webpack://tweb/./src/helpers/dom/getSelectedText.ts","webpack://tweb/./src/components/checkboxField.ts","webpack://tweb/./src/components/codeInputField.ts","webpack://tweb/./src/components/confirmationPopup.ts","webpack://tweb/./src/components/countryInputField.ts","webpack://tweb/./src/components/editPeer.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/gifs.ts","webpack://tweb/./src/components/sidebarRight/tabs/stickers.ts","webpack://tweb/./src/components/emoticonsDropdown/index.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/emoji.ts","webpack://tweb/./src/lib/richTextProcessor/wrapSingleEmoji.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat.ts","webpack://tweb/./src/components/emoticonsDropdown/tabs/stickers.ts","webpack://tweb/./src/components/generateFakeIcon.ts","webpack://tweb/./src/components/lazyLoadQueueRepeat2.ts","webpack://tweb/./src/components/gifsMasonry.ts","webpack://tweb/./src/components/horizontalMenu.ts","webpack://tweb/./src/components/inputField.ts","webpack://tweb/./src/helpers/dom/selectElementContents.ts","webpack://tweb/./src/components/inputSearch.ts","webpack://tweb/./src/components/lazyLoadQueue.ts","webpack://tweb/./src/components/lazyLoadQueueIntersector.ts","webpack://tweb/./src/components/mediaProgressLine.ts","webpack://tweb/./src/components/middleEllipsis.ts","webpack://tweb/./src/components/monkeys/password.ts","webpack://tweb/./src/components/monkeys/tracking.ts","webpack://tweb/./src/components/passwordInputField.ts","webpack://tweb/./src/components/peerProfileAvatars.ts","webpack://tweb/./src/components/peerProfile.ts","webpack://tweb/./src/components/generateTitleIcons.ts","webpack://tweb/./src/components/generateVerifiedIcon.ts","webpack://tweb/./src/components/generatePremiumIcon.ts","webpack://tweb/./src/components/peerTitle.ts","webpack://tweb/./src/components/popups/avatar.ts","webpack://tweb/./src/lib/cropper.ts","webpack://tweb/./src/components/popups/deleteDialog.ts","webpack://tweb/./src/components/popups/deleteMessages.ts","webpack://tweb/./src/components/popups/forward.ts","webpack://tweb/./src/components/popups/index.ts","webpack://tweb/./src/components/popups/mute.ts","webpack://tweb/./src/components/popups/peer.ts","webpack://tweb/./src/components/popups/pickUser.ts","webpack://tweb/./src/components/popups/sendNow.ts","webpack://tweb/./src/components/popups/stickers.ts","webpack://tweb/./src/components/preloader.ts","webpack://tweb/./src/components/putPhoto.ts","webpack://tweb/./src/components/wrappers/getPeerInitials.ts","webpack://tweb/./src/components/putPreloader.ts","webpack://tweb/./src/components/radioField.ts","webpack://tweb/./src/components/radioForm.ts","webpack://tweb/./src/components/rangeSelector.ts","webpack://tweb/./src/components/ripple.ts","webpack://tweb/./src/components/row.ts","webpack://tweb/./src/components/scrollable.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newGroup.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/privacyType.ts","webpack://tweb/./src/lib/appManagers/utils/privacy/getPrivacyRulesDetails.ts","webpack://tweb/./src/components/privacySection.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/phoneNumber.ts","webpack://tweb/./src/helpers/dom/anchorCopy.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/passwordSet.ts","webpack://tweb/./src/helpers/dom/canFocus.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/emailConfirmation.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/email.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/hint.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/reEnterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/enterPassword.ts","webpack://tweb/./src/components/sidebarLeft/tabs/2fa/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/lastSeen.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/profilePhoto.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/forwardMessages.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/addToGroups.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/calls.ts","webpack://tweb/./src/components/sidebarLeft/tabs/activeSessions.ts","webpack://tweb/./src/components/sidebarLeft/tabs/blockedUsers.ts","webpack://tweb/./src/helpers/string/convertKeyToInputKey.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacy/voices.ts","webpack://tweb/./src/components/sidebarLeft/tabs/privacyAndSecurity.ts","webpack://tweb/./src/helpers/averageColor.ts","webpack://tweb/./src/helpers/highlightningColor.ts","webpack://tweb/./src/components/colorPicker.ts","webpack://tweb/./src/components/sidebarLeft/tabs/backgroundColor.ts","webpack://tweb/./src/components/sidebarLeft/tabs/background.ts","webpack://tweb/./src/helpers/files/requestFile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/quickReaction.ts","webpack://tweb/./src/components/sidebarLeft/tabs/generalSettings.ts","webpack://tweb/./src/helpers/eachMinute.ts","webpack://tweb/./src/helpers/eachTimeout.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editProfile.ts","webpack://tweb/./src/components/sidebarLeft/tabs/notifications.ts","webpack://tweb/./src/components/sidebarLeft/tabs/language.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/photo.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/file.ts","webpack://tweb/./src/components/sidebarLeft/tabs/autoDownload/video.ts","webpack://tweb/./src/components/sidebarLeft/tabs/dataAndStorage.ts","webpack://tweb/./src/components/sidebarLeft/tabs/settings.ts","webpack://tweb/./src/components/sidebarLeft/tabs/newChannel.ts","webpack://tweb/./src/components/popups/createContact.ts","webpack://tweb/./src/components/sidebarLeft/tabs/contacts.ts","webpack://tweb/./src/components/sidebarLeft/tabs/archivedTab.ts","webpack://tweb/./src/components/sidebarLeft/tabs/peopleNearby.ts","webpack://tweb/./src/components/sidebarLeft/index.ts","webpack://tweb/./src/components/sidebarLeft/tabs/addMembers.ts","webpack://tweb/./src/components/sidebarLeft/tabs/chatFolders.ts","webpack://tweb/./src/components/sidebarLeft/tabs/includedChats.ts","webpack://tweb/./src/components/sidebarLeft/tabs/editFolder.ts","webpack://tweb/./src/components/sidebarRight/index.ts","webpack://tweb/./src/components/sidebarRight/tabs/editContact.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatType.ts","webpack://tweb/./src/components/sidebarRight/tabs/userPermissions.ts","webpack://tweb/./src/components/sidebarRight/tabs/groupPermissions.ts","webpack://tweb/./src/lib/appManagers/utils/chats/combineParticipantBannedRights.ts","webpack://tweb/./src/components/sidebarRight/tabs/chatReactions.ts","webpack://tweb/./src/components/sidebarRight/tabs/editChat.ts","webpack://tweb/./src/components/sidebarRight/tabs/sharedMedia.ts","webpack://tweb/./src/components/singleTransition.ts","webpack://tweb/./src/components/slider.ts","webpack://tweb/./src/components/sliderTab.ts","webpack://tweb/./src/components/sortedUserList.ts","webpack://tweb/./src/components/stickerViewer.ts","webpack://tweb/./src/components/stickyIntersector.ts","webpack://tweb/./src/components/swipeHandler.ts","webpack://tweb/./src/components/telInputField.ts","webpack://tweb/./src/components/toast.ts","webpack://tweb/./src/components/transition.ts","webpack://tweb/./src/lib/richTextProcessor/isUsernameValid.ts","webpack://tweb/./src/components/usernameInputField.ts","webpack://tweb/./src/components/visibilityIntersector.ts","webpack://tweb/./src/components/volumeSelector.ts","webpack://tweb/./src/components/wrappers/customEmoji.ts","webpack://tweb/./src/components/wrappers/document.ts","webpack://tweb/./src/components/wrappers/formatUserPhone.ts","webpack://tweb/./src/components/wrappers/getChatMembersString.ts","webpack://tweb/./src/components/wrappers/getPeerTitle.ts","webpack://tweb/./src/components/wrappers/getUserStatusString.ts","webpack://tweb/./src/components/wrappers/joinVoiceChatAnchor.ts","webpack://tweb/./src/components/wrappers/messageActionTextNewUnsafe.ts","webpack://tweb/./src/components/wrappers/messageActionTextNew.ts","webpack://tweb/./src/components/wrappers/messageForReply.ts","webpack://tweb/./src/components/wrappers/peerTitle.ts","webpack://tweb/./src/components/wrappers/photo.ts","webpack://tweb/./src/components/wrappers/senderToPeer.ts","webpack://tweb/./src/components/wrappers/sentTime.ts","webpack://tweb/./src/components/wrappers/sticker.ts","webpack://tweb/./src/helpers/bytes/getPathFromBytes.ts","webpack://tweb/./src/helpers/computeLockColor.ts","webpack://tweb/./src/components/wrappers/stickerAnimation.ts","webpack://tweb/./src/components/wrappers/stickerEmoji.ts","webpack://tweb/./src/components/wrappers/stickerSetThumb.ts","webpack://tweb/./src/components/wrappers/stickerToRow.ts","webpack://tweb/./src/components/wrappers/video.ts","webpack://tweb/./src/components/wrappers/webPageDescription.ts","webpack://tweb/./src/components/wrappers/webPageTitle.ts","webpack://tweb/./src/config/currencies.ts","webpack://tweb/./src/config/emoji.ts","webpack://tweb/./src/config/font.ts","webpack://tweb/./src/helpers/animation.ts","webpack://tweb/./src/helpers/array/filterAsync.ts","webpack://tweb/./src/helpers/array/findAndSpliceAll.ts","webpack://tweb/./src/helpers/audioAssetPlayer.ts","webpack://tweb/./src/helpers/blob/readBlobAsDataURL.ts","webpack://tweb/./src/helpers/heavyQueue.ts","webpack://tweb/./src/helpers/blur.ts","webpack://tweb/./src/helpers/bytes/getPreviewURLFromBytes.ts","webpack://tweb/./src/helpers/bytes/bytesToDataURL.ts","webpack://tweb/./src/helpers/calcImageInBox.ts","webpack://tweb/./src/helpers/canvas/getTextWidth.ts","webpack://tweb/./src/helpers/canvas/scaleMediaElement.ts","webpack://tweb/./src/helpers/cleanSearchText.ts","webpack://tweb/./src/helpers/clipboard.ts","webpack://tweb/./src/helpers/contextMenuController.ts","webpack://tweb/./src/helpers/date.ts","webpack://tweb/./src/helpers/dom/attachContextMenuListener.ts","webpack://tweb/./src/helpers/dom/attachGrabListeners.ts","webpack://tweb/./src/helpers/dom/cancelSelection.ts","webpack://tweb/./src/helpers/dom/clickEvent.ts","webpack://tweb/./src/helpers/dom/controlsHover.ts","webpack://tweb/./src/helpers/dom/createStickersContextMenu.ts","webpack://tweb/./src/helpers/dom/createContextMenu.ts","webpack://tweb/./src/helpers/dom/createVideo.ts","webpack://tweb/./src/helpers/dom/customProperties.ts","webpack://tweb/./src/helpers/dom/dispatchEvent.ts","webpack://tweb/./src/helpers/dom/documentFragmentToHTML.ts","webpack://tweb/./src/helpers/dom/findUpAsChild.ts","webpack://tweb/./src/helpers/dom/findUpAttribute.ts","webpack://tweb/./src/helpers/dom/findUpTag.ts","webpack://tweb/./src/helpers/dom/fullScreen.ts","webpack://tweb/./src/helpers/dom/getRichElementValue.ts","webpack://tweb/./src/helpers/dom/getRichValue.ts","webpack://tweb/./src/helpers/dom/getViewportSlice.ts","webpack://tweb/./src/helpers/dom/getVisibleRect.ts","webpack://tweb/./src/helpers/dom/handleHorizontalSwipe.ts","webpack://tweb/./src/helpers/dom/handleTabSwipe.ts","webpack://tweb/./src/helpers/dom/htmlToDocumentFragment.ts","webpack://tweb/./src/helpers/dom/htmlToSpan.ts","webpack://tweb/./src/helpers/dom/isInDOM.ts","webpack://tweb/./src/helpers/dom/isInputEmpty.ts","webpack://tweb/./src/helpers/dom/isSendShortcutPressed.ts","webpack://tweb/./src/helpers/dom/isSwipingBackSafari.ts","webpack://tweb/./src/helpers/dom/placeCaretAtEnd.ts","webpack://tweb/./src/helpers/dom/positionElementByIndex.ts","webpack://tweb/./src/helpers/dom/renderImageFromUrl.ts","webpack://tweb/./src/helpers/dom/renderMediaWithFadeIn.ts","webpack://tweb/./src/helpers/dom/replaceContent.ts","webpack://tweb/./src/helpers/dom/setInnerHTML.ts","webpack://tweb/./src/helpers/dom/toggleDisability.ts","webpack://tweb/./src/helpers/dom/whichChild.ts","webpack://tweb/./src/helpers/dropdownHover.ts","webpack://tweb/./src/helpers/fastSmoothScroll.ts","webpack://tweb/./src/helpers/fileName.ts","webpack://tweb/./src/helpers/filterChatPhotosMessages.ts","webpack://tweb/./src/helpers/formatBytes.ts","webpack://tweb/./src/helpers/formatCallDuration.ts","webpack://tweb/./src/helpers/formatDuration.ts","webpack://tweb/./src/helpers/formatPhoneNumber.ts","webpack://tweb/./src/helpers/generatePathData.ts","webpack://tweb/./src/helpers/getImageFromStrippedThumb.ts","webpack://tweb/./src/helpers/getPreviewURLFromThumb.ts","webpack://tweb/./src/helpers/getStrippedThumbIfNeeded.ts","webpack://tweb/./src/helpers/listLoader.ts","webpack://tweb/./src/helpers/listenerSetter.ts","webpack://tweb/./src/helpers/mediaSize.ts","webpack://tweb/./src/helpers/mediaSizes.ts","webpack://tweb/./src/helpers/middlewarePromise.ts","webpack://tweb/./src/helpers/number/clamp.ts","webpack://tweb/./src/helpers/number/formatNumber.ts","webpack://tweb/./src/helpers/number/numberThousandSplitter.ts","webpack://tweb/./src/helpers/onMediaLoad.ts","webpack://tweb/./src/helpers/overlayClickHandler.ts","webpack://tweb/./src/helpers/paymentsWrapCurrencyAmount.ts","webpack://tweb/./src/helpers/positionMenu.ts","webpack://tweb/./src/helpers/restrictions.ts","webpack://tweb/./src/helpers/saveLottiePreview.ts","webpack://tweb/./src/helpers/schedulers/throttleWithRaf.ts","webpack://tweb/./src/helpers/schedulers/throttleWith.ts","webpack://tweb/./src/helpers/scrollableLoader.ts","webpack://tweb/./src/helpers/searchListLoader.ts","webpack://tweb/./src/lib/appManagers/utils/messageId/incrementMessageId.ts","webpack://tweb/./src/helpers/sequentialDom.ts","webpack://tweb/./src/helpers/setAttachmentSize.ts","webpack://tweb/./src/helpers/sortedList.ts","webpack://tweb/./src/helpers/string/encodeEntities.ts","webpack://tweb/./src/helpers/string/escapeRegExp.ts","webpack://tweb/./src/helpers/string/limitSymbols.ts","webpack://tweb/./src/helpers/string/toHHMMSS.ts","webpack://tweb/./src/helpers/windowSize.ts","webpack://tweb/./src/hooks/useHeavyAnimationCheck.ts","webpack://tweb/./src/components/dialogsContextMenu.ts","webpack://tweb/./src/components/connectionStatus.ts","webpack://tweb/./src/components/sendingStatus.ts","webpack://tweb/./src/helpers/easing/easeInOutSine.ts","webpack://tweb/./src/helpers/canvas/roundRect.ts","webpack://tweb/./src/components/groupCallActiveIcon.ts","webpack://tweb/./src/helpers/canvas/shimmer.ts","webpack://tweb/./src/helpers/dialogsPlaceholder.ts","webpack://tweb/./src/helpers/canvas/drawCircle.ts","webpack://tweb/./src/lib/appManagers/appDialogsManager.ts","webpack://tweb/./src/lib/appManagers/appDownloadManager.ts","webpack://tweb/./src/helpers/dom/createDownloadAnchor.ts","webpack://tweb/./src/components/chat/bubbleGroups.ts","webpack://tweb/./src/helpers/array/partition.ts","webpack://tweb/./src/components/popups/datePicker.ts","webpack://tweb/./src/components/divAndCaption.ts","webpack://tweb/./src/components/chat/replyContainer.ts","webpack://tweb/./src/components/wrappers/reply.ts","webpack://tweb/./src/components/stackedAvatars.ts","webpack://tweb/./src/components/chat/replies.ts","webpack://tweb/./src/components/chat/messageRender.ts","webpack://tweb/./src/helpers/dom/getElementByPoint.ts","webpack://tweb/./src/helpers/dom/reflowScrollableElement.ts","webpack://tweb/./src/lib/mtproto/constants.ts","webpack://tweb/./src/lib/appManagers/internalLink.ts","webpack://tweb/./src/components/popups/joinChatInvite.ts","webpack://tweb/./src/components/chat/reaction.ts","webpack://tweb/./src/components/chat/reactions.ts","webpack://tweb/./src/helpers/scrollSaver.ts","webpack://tweb/./src/helpers/dom/superIntersectionObserver.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMentionUnread.ts","webpack://tweb/./src/helpers/array/accumulate.ts","webpack://tweb/./src/helpers/cacheCallback.ts","webpack://tweb/./src/helpers/string/replaceNonNumber.ts","webpack://tweb/./src/helpers/cards/cardBrands.ts","webpack://tweb/./src/helpers/array/createArray.ts","webpack://tweb/./src/helpers/string/buggedNumbers.ts","webpack://tweb/./src/helpers/cards/patternCharacters.ts","webpack://tweb/./src/helpers/cards/cardFormattingPatterns.ts","webpack://tweb/./src/helpers/cards/formatValueByPattern.ts","webpack://tweb/./src/helpers/cards/validateCard.ts","webpack://tweb/./src/helpers/string/nbsp.ts","webpack://tweb/./src/components/popups/paymentVerification.ts","webpack://tweb/./src/components/popups/paymentCard.ts","webpack://tweb/./src/helpers/cards/formatInputValueByPattern.ts","webpack://tweb/./src/components/popups/paymentCardConfirmation.ts","webpack://tweb/./src/components/popups/paymentShipping.ts","webpack://tweb/./src/components/popups/paymentShippingMethods.ts","webpack://tweb/./src/components/popups/payment.ts","webpack://tweb/./src/components/groupedLayout.ts","webpack://tweb/./src/components/prepareAlbum.ts","webpack://tweb/./src/components/wrappers/album.ts","webpack://tweb/./src/components/sidebarRight/tabs/pollResults.ts","webpack://tweb/./src/components/poll.ts","webpack://tweb/./src/components/chat/bubbles.ts","webpack://tweb/./src/helpers/dom/copyFromElement.ts","webpack://tweb/./src/components/wrappers/groupedDocuments.ts","webpack://tweb/./src/components/wrappers/poll.ts","webpack://tweb/./src/components/popups/unpinMessage.ts","webpack://tweb/./src/helpers/dom/isSelectionEmpty.ts","webpack://tweb/./src/helpers/preloadAnimatedEmojiSticker.ts","webpack://tweb/./src/components/popups/reportMessagesConfirm.ts","webpack://tweb/./src/components/popups/reportMessages.ts","webpack://tweb/./src/components/popups/sponsored.ts","webpack://tweb/./src/components/popups/reactedList.ts","webpack://tweb/./src/components/chat/reactionsMenu.ts","webpack://tweb/./src/components/chat/contextMenu.ts","webpack://tweb/./src/components/chat/sendContextMenu.ts","webpack://tweb/./src/components/popups/createPoll.ts","webpack://tweb/./src/helpers/createPoster.ts","webpack://tweb/./src/helpers/getGifDuration.ts","webpack://tweb/./src/components/popups/newMedia.ts","webpack://tweb/./src/helpers/dom/attachListNavigation.ts","webpack://tweb/./src/components/chat/autocompleteHelper.ts","webpack://tweb/./src/components/chat/stickersHelper.ts","webpack://tweb/./src/components/popups/schedule.ts","webpack://tweb/./src/helpers/dom/getRichValueWithCaret.ts","webpack://tweb/./src/components/chat/emojiHelper.ts","webpack://tweb/./src/components/chat/autocompletePeerHelper.ts","webpack://tweb/./src/components/chat/commandsHelper.ts","webpack://tweb/./src/components/chat/autocompleteHelperController.ts","webpack://tweb/./src/components/chat/mentionsHelper.ts","webpack://tweb/./src/components/chat/replyKeyboard.ts","webpack://tweb/./src/components/chat/inlineHelper.ts","webpack://tweb/./src/components/chat/botCommands.ts","webpack://tweb/./src/helpers/modifyAckedResult.ts","webpack://tweb/./src/components/chat/sendAs.ts","webpack://tweb/./src/components/inputFieldAnimated.ts","webpack://tweb/./src/components/chat/input.ts","webpack://tweb/./src/components/wrappers/draft.ts","webpack://tweb/./src/helpers/dom/setCaretAt.ts","webpack://tweb/./src/components/chat/pinnedContainer.ts","webpack://tweb/./src/components/chat/pinnedMessageBorder.ts","webpack://tweb/./src/components/chat/audio.ts","webpack://tweb/./src/components/chat/pinnedMessage.ts","webpack://tweb/./src/helpers/dom/handleScrollSideEvent.ts","webpack://tweb/./src/components/chat/topbar.ts","webpack://tweb/./src/components/sidebarRight/tabs/search.ts","webpack://tweb/./src/components/chat/search.ts","webpack://tweb/./src/components/chat/patternRenderer.ts","webpack://tweb/./src/components/chat/chat.ts","webpack://tweb/./src/helpers/autoDownload.ts","webpack://tweb/./src/components/chat/markupTooltip.ts","webpack://tweb/./src/helpers/dom/getSelectedNodes.ts","webpack://tweb/./src/components/chat/dragAndDrop.ts","webpack://tweb/./src/helpers/dom/disableTransition.ts","webpack://tweb/./src/components/lineBlobDrawable.ts","webpack://tweb/./src/components/topbarWeave.ts","webpack://tweb/./src/lib/rlottie/rlottieIcon.ts","webpack://tweb/./src/components/superIcon.ts","webpack://tweb/./src/components/groupCall/microphoneIcon.ts","webpack://tweb/./src/components/groupCall/participantMutedIcon.ts","webpack://tweb/./src/components/groupCall/index.ts","webpack://tweb/./src/components/groupCall/participantStatus.ts","webpack://tweb/./src/components/groupCall/participantsList.ts","webpack://tweb/./src/components/call/videoCanvasBlur.ts","webpack://tweb/./src/components/groupCall/participantVideo.ts","webpack://tweb/./src/components/groupCall/participantVideos.ts","webpack://tweb/./src/components/groupCall/participants.ts","webpack://tweb/./src/components/groupCall/description.ts","webpack://tweb/./src/components/groupCall/title.ts","webpack://tweb/./src/components/call/button.ts","webpack://tweb/./src/components/movableElement.ts","webpack://tweb/./src/helpers/movablePanel.ts","webpack://tweb/./src/helpers/toggleClassName.ts","webpack://tweb/./src/components/call/description.ts","webpack://tweb/./src/components/groupCall/microphoneIconMini.ts","webpack://tweb/./src/components/call/index.ts","webpack://tweb/./src/components/topbarCall.ts","webpack://tweb/./src/lib/appManagers/uiNotificationsManager.ts","webpack://tweb/./src/helpers/files/getFilesFromEvent.ts","webpack://tweb/./src/lib/appManagers/appImManager.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMediaFromMessage.ts","webpack://tweb/./src/lib/appManagers/utils/messages/getMessageSenderPeerIdOrName.ts","webpack://tweb/./src/lib/appManagers/utils/messages/isMessageRestricted.ts","webpack://tweb/./src/lib/appManagers/utils/peers/getPeerColorById.ts","webpack://tweb/./src/lib/appManagers/utils/photos/choosePhotoSize.ts","webpack://tweb/./src/lib/calls/callConnectionInstanceBase.ts","webpack://tweb/./src/lib/calls/helpers/createPeerConnection.ts","webpack://tweb/./src/lib/calls/helpers/createDataChannel.ts","webpack://tweb/./src/lib/calls/helpers/parseSignalingData.ts","webpack://tweb/./src/lib/calls/callConnectionInstance.ts","webpack://tweb/./src/lib/crypto/subtle.ts","webpack://tweb/./src/lib/calls/p2P/p2PEncryptor.ts","webpack://tweb/./src/lib/crypto/utils/sha256.ts","webpack://tweb/./src/lib/calls/p2P/chromeP2PSdpBuilder.ts","webpack://tweb/./src/lib/calls/p2P/p2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/firefoxP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/p2P/safariP2PSdpBuilder.js","webpack://tweb/./src/lib/calls/callInstance.ts","webpack://tweb/./src/lib/calls/p2P/getCallProtocol.ts","webpack://tweb/./src/lib/calls/p2P/getRtcConfiguration.ts","webpack://tweb/./src/lib/calls/helpers/getStreamCached.ts","webpack://tweb/./src/lib/calls/callInstanceBase.ts","webpack://tweb/./src/lib/calls/callState.ts","webpack://tweb/./src/components/call/getAudioAsset.ts","webpack://tweb/./src/lib/calls/callsController.ts","webpack://tweb/./src/lib/calls/constants.ts","webpack://tweb/./src/lib/calls/groupCallConnectionInstance.ts","webpack://tweb/./src/lib/calls/helpers/processMediaSection.ts","webpack://tweb/./src/lib/calls/helpers/filterServerCodecs.ts","webpack://tweb/./src/lib/calls/helpers/fixLocalOffer.ts","webpack://tweb/./src/lib/calls/groupCallInstance.ts","webpack://tweb/./src/lib/calls/groupCallState.ts","webpack://tweb/./src/components/groupCall/getAudioAsset.ts","webpack://tweb/./src/lib/calls/groupCallsController.ts","webpack://tweb/./src/lib/calls/helpers/createMainStreamManager.ts","webpack://tweb/./src/lib/calls/helpers/getAudioConstraints.ts","webpack://tweb/./src/environment/constraintSupport.ts","webpack://tweb/./src/lib/calls/helpers/getScreenConstraints.ts","webpack://tweb/./src/lib/calls/helpers/getScreenStream.ts","webpack://tweb/./src/lib/calls/helpers/getStream.ts","webpack://tweb/./src/lib/calls/helpers/getVideoConstraints.ts","webpack://tweb/./src/lib/calls/helpers/parseMediaSectionInfo.ts","webpack://tweb/./src/lib/calls/helpers/parseSourceGroups.ts","webpack://tweb/./src/lib/calls/helpers/stopTrack.ts","webpack://tweb/./src/lib/calls/localConferenceDescription.ts","webpack://tweb/./src/lib/calls/sdp/index.ts","webpack://tweb/./src/helpers/string/splitStringByLimitWithRest.ts","webpack://tweb/./src/helpers/uniqueNumberGenerator.ts","webpack://tweb/./src/lib/calls/sdp/attributeSplitted.ts","webpack://tweb/./src/lib/calls/sdp/mediaLineParts.ts","webpack://tweb/./src/lib/calls/sdp/line.ts","webpack://tweb/./src/lib/calls/sdp/attributeInner.ts","webpack://tweb/./src/lib/calls/sdp/attributes.ts","webpack://tweb/./src/lib/calls/sdp/mediaSection.ts","webpack://tweb/./src/lib/calls/sdp/sessionSection.ts","webpack://tweb/./src/lib/calls/sdp/utils.ts","webpack://tweb/./src/lib/calls/sdpBuilder.ts","webpack://tweb/./src/lib/calls/streamManager.ts","webpack://tweb/./src/lib/calls/stringFromLineBuilder.ts","webpack://tweb/./src/lib/calls/utils.ts","webpack://tweb/./src/lib/richTextProcessor/getAbbreviation.ts","webpack://tweb/./src/lib/richTextProcessor/getEmojiEntityFromEmoji.ts","webpack://tweb/./src/lib/richTextProcessor/matchEmail.ts","webpack://tweb/./src/lib/richTextProcessor/wrapDraftText.ts","webpack://tweb/./src/lib/richTextProcessor/wrapEmojiText.ts","webpack://tweb/./src/lib/richTextProcessor/setBlankToAnchor.ts","webpack://tweb/./src/environment/emojiVersionsSupport.ts","webpack://tweb/./src/lib/richTextProcessor/wrapRichText.ts","webpack://tweb/./src/helpers/buildURLHash.ts","webpack://tweb/./src/lib/rlottie/queryableWorker.ts","webpack://tweb/./src/environment/webAssemblySupport.ts","webpack://tweb/./src/lib/rlottie/lottieLoader.ts","webpack://tweb/./src/environment/imageBitmapSupport.ts","webpack://tweb/./src/helpers/framesCache.ts","webpack://tweb/./src/lib/rlottie/rlottiePlayer.ts","webpack://tweb/./src/pages/pagesManager.ts","webpack://tweb/./src/pages/page.ts","webpack://tweb/./src/vendor/emoji/index.ts","webpack://tweb/./public/recorder.min.js"],"sourcesContent":["/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CustomEmojiRendererElement} from '../lib/richTextProcessor/wrapRichText';\r\nimport rootScope from '../lib/rootScope';\r\nimport {IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport forEachReverse from '../helpers/array/forEachReverse';\r\nimport idleController from '../helpers/idleController';\r\nimport appMediaPlaybackController from './appMediaPlaybackController';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\nexport type AnimationItemGroup = '' | 'none' | 'chat' | 'lock' |\r\n  'STICKERS-POPUP' | 'emoticons-dropdown' | 'STICKERS-SEARCH' | 'GIFS-SEARCH' |\r\n  `CHAT-MENU-REACTIONS-${number}` | 'INLINE-HELPER' | 'GENERAL-SETTINGS' | 'STICKER-VIEWER' | 'EMOJI';\r\nexport interface AnimationItem {\r\n  el: HTMLElement,\r\n  group: AnimationItemGroup,\r\n  animation: AnimationItemWrapper\r\n};\r\n\r\nexport interface AnimationItemWrapper {\r\n  remove: () => void;\r\n  paused: boolean;\r\n  pause: () => any;\r\n  play: () => any;\r\n  autoplay: boolean;\r\n  // onVisibilityChange?: (visible: boolean) => boolean;\r\n};\r\n\r\nexport class AnimationIntersector {\r\n  private observer: IntersectionObserver;\r\n  private visible: Set<AnimationItem> = new Set();\r\n\r\n  private overrideIdleGroups: Set<string>;\r\n  private byGroups: {[group in AnimationItemGroup]?: AnimationItem[]} = {};\r\n  private lockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private onlyOnePlayableGroup: AnimationItemGroup = '';\r\n\r\n  private intersectionLockedGroups: {[group in AnimationItemGroup]?: true} = {};\r\n  private videosLocked = false;\r\n\r\n  constructor() {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      // if(rootScope.idle.isIDLE) return;\r\n\r\n      for(const entry of entries) {\r\n        const target = entry.target;\r\n\r\n        for(const group in this.byGroups) {\r\n          if(this.intersectionLockedGroups[group as AnimationItemGroup]) {\r\n            continue;\r\n          }\r\n\r\n          const animation = this.byGroups[group as AnimationItemGroup].find((p) => p.el === target);\r\n          if(!animation) {\r\n            continue;\r\n          }\r\n\r\n          if(entry.isIntersecting) {\r\n            this.visible.add(animation);\r\n            this.checkAnimation(animation, false);\r\n\r\n            /* if(animation instanceof HTMLVideoElement && animation.dataset.src) {\r\n              animation.src = animation.dataset.src;\r\n              animation.load();\r\n            } */\r\n          } else {\r\n            this.visible.delete(animation);\r\n            this.checkAnimation(animation, true);\r\n\r\n            const _animation = animation.animation;\r\n            if(_animation instanceof RLottiePlayer/*  && animation.cachingDelta === 2 */) {\r\n              // console.warn('will clear cache', player);\r\n              _animation.clearCache();\r\n            }/*  else if(animation instanceof HTMLVideoElement && animation.src) {\r\n              animation.dataset.src = animation.src;\r\n              animation.src = '';\r\n              animation.load();\r\n            } */\r\n          }\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.overrideIdleGroups = new Set();\r\n\r\n    appMediaPlaybackController.addEventListener('play', ({doc}) => {\r\n      if(doc.type === 'round') {\r\n        this.videosLocked = true;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    appMediaPlaybackController.addEventListener('pause', () => {\r\n      if(this.videosLocked) {\r\n        this.videosLocked = false;\r\n        this.checkAnimations();\r\n      }\r\n    });\r\n\r\n    idleController.addEventListener('change', (idle) => {\r\n      this.checkAnimations(idle);\r\n    });\r\n  }\r\n\r\n  public setOverrideIdleGroup(group: string, override: boolean) {\r\n    if(override) this.overrideIdleGroups.add(group);\r\n    else this.overrideIdleGroups.delete(group);\r\n  }\r\n\r\n  public getAnimations(element: HTMLElement) {\r\n    const found: AnimationItem[] = [];\r\n    for(const group in this.byGroups) {\r\n      for(const player of this.byGroups[group as AnimationItemGroup]) {\r\n        if(player.el === element) {\r\n          found.push(player);\r\n        }\r\n      }\r\n    }\r\n\r\n    return found;\r\n  }\r\n\r\n  public removeAnimation(player: AnimationItem) {\r\n    const {el, animation} = player;\r\n    animation.remove();\r\n\r\n    if(animation instanceof HTMLVideoElement && IS_SAFARI) {\r\n      setTimeout(() => { // TODO:   ,       \r\n        animation.src = '';\r\n        animation.load();\r\n      }, 1e3);\r\n    }\r\n\r\n    const group = this.byGroups[player.group];\r\n    if(group) {\r\n      indexOfAndSplice(group, player);\r\n      if(!group.length) {\r\n        delete this.byGroups[player.group];\r\n      }\r\n    }\r\n\r\n    this.observer.unobserve(el);\r\n    this.visible.delete(player);\r\n  }\r\n\r\n  public addAnimation(_animation: AnimationItem['animation'], group: AnimationItemGroup = '') {\r\n    if(group === 'none') {\r\n      return;\r\n    }\r\n\r\n    let el: HTMLElement;\r\n    if(_animation instanceof RLottiePlayer) {\r\n      el = _animation.el[0];\r\n    } else if(_animation instanceof CustomEmojiRendererElement) {\r\n      el = _animation.canvas;\r\n    } else if(_animation instanceof HTMLElement) {\r\n      el = _animation;\r\n    }\r\n\r\n    const animation: AnimationItem = {\r\n      el,\r\n      animation: _animation,\r\n      group\r\n    };\r\n\r\n    if(_animation instanceof RLottiePlayer) {\r\n      if(!rootScope.settings.stickers.loop && _animation.loop) {\r\n        _animation.loop = rootScope.settings.stickers.loop;\r\n      }\r\n    }\r\n\r\n    (this.byGroups[group as AnimationItemGroup] ??= []).push(animation);\r\n    this.observer.observe(animation.el);\r\n  }\r\n\r\n  public checkAnimations(blurred?: boolean, group?: AnimationItemGroup, destroy = false) {\r\n    // if(rootScope.idle.isIDLE) return;\r\n\r\n    if(group !== undefined && !this.byGroups[group]) {\r\n      // console.warn('no animation group:', group);\r\n      return;\r\n    }\r\n\r\n    const groups = group !== undefined /* && false */ ? [group] : Object.keys(this.byGroups) as AnimationItemGroup[];\r\n\r\n    for(const group of groups) {\r\n      const animations = this.byGroups[group];\r\n\r\n      forEachReverse(animations, (animation) => {\r\n        this.checkAnimation(animation, blurred, destroy);\r\n      });\r\n    }\r\n  }\r\n\r\n  public checkAnimation(player: AnimationItem, blurred = false, destroy = false) {\r\n    const {el, animation, group} = player;\r\n    // return;\r\n    if(destroy || (!this.lockedGroups[group] && !isInDOM(el))) {\r\n      this.removeAnimation(player);\r\n      return;\r\n    }\r\n\r\n    if(blurred ||\r\n      (this.onlyOnePlayableGroup && this.onlyOnePlayableGroup !== group) ||\r\n      (animation instanceof HTMLVideoElement && this.videosLocked)\r\n    ) {\r\n      if(!animation.paused) {\r\n        // console.warn('pause animation:', animation);\r\n        animation.pause();\r\n      }\r\n    } else if(animation.paused &&\r\n      this.visible.has(player) &&\r\n      animation.autoplay &&\r\n      (!this.onlyOnePlayableGroup || this.onlyOnePlayableGroup === group) &&\r\n      (!idleController.isIdle || this.overrideIdleGroups.has(player.group))\r\n    ) {\r\n      // console.warn('play animation:', animation);\r\n      animation.play();\r\n    }\r\n  }\r\n\r\n  public getOnlyOnePlayableGroup() {\r\n    return this.onlyOnePlayableGroup;\r\n  }\r\n\r\n  public setOnlyOnePlayableGroup(group: AnimationItemGroup = '') {\r\n    this.onlyOnePlayableGroup = group;\r\n  }\r\n\r\n  public lockGroup(group: AnimationItemGroup) {\r\n    this.lockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockGroup(group: AnimationItemGroup) {\r\n    delete this.lockedGroups[group];\r\n    this.checkAnimations(undefined, group);\r\n  }\r\n\r\n  public refreshGroup(group: AnimationItemGroup) {\r\n    const animations = this.byGroups[group];\r\n    if(!animations?.length) {\r\n      return;\r\n    }\r\n\r\n    animations.forEach((animation) => {\r\n      this.observer.unobserve(animation.el);\r\n    });\r\n\r\n    fastRaf(() => {\r\n      animations.forEach((animation) => {\r\n        this.observer.observe(animation.el);\r\n      });\r\n    });\r\n  }\r\n\r\n  public lockIntersectionGroup(group: AnimationItemGroup) {\r\n    this.intersectionLockedGroups[group] = true;\r\n  }\r\n\r\n  public unlockIntersectionGroup(group: AnimationItemGroup) {\r\n    delete this.intersectionLockedGroups[group];\r\n    this.refreshGroup(group);\r\n  }\r\n}\r\n\r\nconst animationIntersector = new AnimationIntersector();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.animationIntersector = animationIntersector);\r\nexport default animationIntersector;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {IS_APPLE, IS_SAFARI} from '../environment/userAgent';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport type {SearchSuperContext} from './appSearchSuper.';\r\nimport {Document, DocumentAttribute, Message, PhotoSize} from '../layer';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport I18n from '../lib/langPack';\r\nimport SearchListLoader from '../helpers/searchListLoader';\r\nimport copy from '../helpers/object/copy';\r\nimport deepEqual from '../helpers/object/deepEqual';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\r\nimport onMediaLoad from '../helpers/onMediaLoad';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\n// TODO: Safari:  ,          \r\n// TODO: Safari:     \r\n// TODO: Safari:  ,         -    \r\n\r\nexport type MediaItem = {mid: number, peerId: PeerId};\r\n\r\ntype HTMLMediaElement = HTMLAudioElement | HTMLVideoElement;\r\n\r\nconst SHOULD_USE_SAFARI_FIX = (() => {\r\n  try {\r\n    return IS_SAFARI && +navigator.userAgent.match(/ Version\\/(\\d+)/)[1] < 14;\r\n  } catch(err) {\r\n    return false;\r\n  }\r\n})();\r\n\r\nconst SEEK_OFFSET = 10;\r\n\r\nexport type MediaSearchContext = SearchSuperContext & Partial<{\r\n  isScheduled: boolean,\r\n  useSearch: boolean\r\n}>;\r\n\r\ntype MediaDetails = {\r\n  peerId: PeerId,\r\n  mid: number,\r\n  docId: DocId,\r\n  doc: MyDocument,\r\n  message: Message.message,\r\n  clean?: boolean,\r\n  isScheduled?: boolean,\r\n  isSingle?: boolean\r\n};\r\n\r\nexport type PlaybackMediaType = 'voice' | 'video' | 'audio';\r\n\r\nexport class AppMediaPlaybackController extends EventListenerBase<{\r\n  play: (details: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => void,\r\n  pause: () => void,\r\n  playbackParams: (params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => void,\r\n  stop: () => void,\r\n}> {\r\n  private container: HTMLElement;\r\n  private media: Map<PeerId, Map<number, HTMLMediaElement>> = new Map();\r\n  private scheduled: AppMediaPlaybackController['media'] = new Map();\r\n  private mediaDetails: Map<HTMLMediaElement, MediaDetails> = new Map();\r\n  private playingMedia: HTMLMediaElement;\r\n  private playingMediaType: PlaybackMediaType;\r\n\r\n  private waitingMediaForLoad: Map<PeerId, Map<number, CancellablePromise<void>>> = new Map();\r\n  private waitingScheduledMediaForLoad: AppMediaPlaybackController['waitingMediaForLoad'] = new Map();\r\n  private waitingDocumentsForLoad: {[docId: string]: Set<HTMLMediaElement>} = {};\r\n\r\n  public willBePlayedMedia: HTMLMediaElement;\r\n  private searchContext: MediaSearchContext;\r\n\r\n  private listLoader: SearchListLoader<MediaItem>;\r\n\r\n  public volume: number;\r\n  public muted: boolean;\r\n  public playbackRate: number;\r\n  public loop: boolean;\r\n  public round: boolean;\r\n  private _volume: number;\r\n  private _muted: boolean;\r\n  private _playbackRate: number;\r\n  private _loop: boolean;\r\n  private _round: boolean;\r\n  private lockedSwitchers: boolean;\r\n  private playbackRates: Record<PlaybackMediaType, number> = {\r\n    voice: 1,\r\n    video: 1,\r\n    audio: 1\r\n  };\r\n\r\n  private pip: HTMLVideoElement;\r\n  private managers: AppManagers;\r\n  private skipMediaPlayEvent: boolean;\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.container = document.createElement('div');\r\n    // this.container.style.cssText = 'position: absolute; top: -10000px; left: -10000px;';\r\n    this.container.style.cssText = 'display: none;';\r\n    document.body.append(this.container);\r\n\r\n    if(navigator.mediaSession) {\r\n      const actions: {[action in MediaSessionAction]?: MediaSessionActionHandler} = {\r\n        play: this.browserPlay,\r\n        pause: this.browserPause,\r\n        stop: this.browserStop,\r\n        seekbackward: this.browserSeekBackward,\r\n        seekforward: this.browserSeekForward,\r\n        seekto: this.browserSeekTo,\r\n        previoustrack: this.browserPrevious,\r\n        nexttrack: this.browserNext\r\n      };\r\n\r\n      for(const action in actions) {\r\n        try {\r\n          navigator.mediaSession.setActionHandler(action as MediaSessionAction, actions[action as MediaSessionAction]);\r\n        } catch(err) {\r\n          console.warn('MediaSession action is not supported:', action);\r\n        }\r\n      }\r\n    }\r\n\r\n    rootScope.addEventListener('document_downloaded', (docId) => {\r\n      const set = this.waitingDocumentsForLoad[docId];\r\n      if(set) {\r\n        for(const media of set) {\r\n          this.onMediaDocumentLoad(media);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('media_play', () => {\r\n      if(this.skipMediaPlayEvent) {\r\n        this.skipMediaPlayEvent = false;\r\n        return;\r\n      }\r\n\r\n      if(!this.pause() && this.pip) {\r\n        this.pip.pause();\r\n      }\r\n    });\r\n\r\n    const properties: {[key: PropertyKey]: PropertyDescriptor} = {};\r\n    const keys = [\r\n      'volume' as const,\r\n      'muted' as const,\r\n      'playbackRate' as const,\r\n      'loop' as const,\r\n      'round' as const\r\n    ];\r\n    keys.forEach((key) => {\r\n      const _key = ('_' + key) as `_${typeof key}`;\r\n      properties[key] = {\r\n        get: () => this[_key],\r\n        set: (value: number | boolean) => {\r\n          if(this[_key] === value) {\r\n            return;\r\n          }\r\n\r\n          // @ts-ignore\r\n          this[_key] = value;\r\n          if(this.playingMedia && (key !== 'loop' || this.playingMediaType === 'audio') && key !== 'round') {\r\n            // @ts-ignore\r\n            this.playingMedia[key] = value;\r\n          }\r\n\r\n          if(key === 'playbackRate' && this.playingMediaType !== undefined) {\r\n            this.playbackRates[this.playingMediaType] = value as number;\r\n          }\r\n\r\n          this.dispatchPlaybackParams();\r\n        }\r\n      };\r\n    });\r\n    Object.defineProperties(this, properties);\r\n  }\r\n\r\n  private dispatchPlaybackParams() {\r\n    this.dispatchEvent('playbackParams', this.getPlaybackParams());\r\n  }\r\n\r\n  public getPlaybackParams() {\r\n    const {volume, muted, playbackRate, playbackRates, loop, round} = this;\r\n    return {\r\n      volume,\r\n      muted,\r\n      playbackRate,\r\n      playbackRates,\r\n      loop,\r\n      round\r\n    };\r\n  }\r\n\r\n  public setPlaybackParams(params: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) {\r\n    this.playbackRates = params.playbackRates;\r\n    this._volume = params.volume;\r\n    this._muted = params.muted;\r\n    this._playbackRate = params.playbackRate;\r\n    this._loop = params.loop;\r\n    this._round = params.round;\r\n  }\r\n\r\n  public seekBackward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.max(0, media.currentTime - (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekForward = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = Math.min(media.duration, media.currentTime + (details.seekOffset || SEEK_OFFSET));\r\n    }\r\n  };\r\n\r\n  public seekTo = (details: MediaSessionActionDetails, media = this.playingMedia) => {\r\n    if(media) {\r\n      media.currentTime = details.seekTime;\r\n    }\r\n  };\r\n\r\n  public addMedia(message: Message.message, autoload: boolean, clean?: boolean): HTMLMediaElement {\r\n    const {peerId, mid} = message;\r\n\r\n    const isScheduled = !!message.pFlags.is_scheduled;\r\n    const s = isScheduled ? this.scheduled : this.media;\r\n    let storage = s.get(message.peerId);\r\n    if(!storage) {\r\n      s.set(message.peerId, storage = new Map());\r\n    }\r\n\r\n    let media = storage.get(mid);\r\n    if(media) {\r\n      return media;\r\n    }\r\n\r\n    const doc = getMediaFromMessage(message) as Document.document;\r\n    storage.set(mid, media = document.createElement(doc.type === 'round' || doc.type === 'video' ? 'video' : 'audio'));\r\n    // const source = document.createElement('source');\r\n    // source.type = doc.type === 'voice' && !opusDecodeController.isPlaySupported() ? 'audio/wav' : doc.mime_type;\r\n\r\n    if(doc.type === 'round') {\r\n      media.setAttribute('playsinline', 'true');\r\n      // media.muted = true;\r\n    }\r\n\r\n    const details: MediaDetails = {\r\n      peerId,\r\n      mid,\r\n      docId: doc.id,\r\n      doc,\r\n      message,\r\n      clean,\r\n      isScheduled: message.pFlags.is_scheduled\r\n    };\r\n\r\n    this.mediaDetails.set(media, details);\r\n\r\n    // media.autoplay = true;\r\n    media.volume = 1;\r\n    // media.append(source);\r\n\r\n    this.container.append(media);\r\n\r\n    media.addEventListener('play', this.onPlay);\r\n    media.addEventListener('pause', this.onPause);\r\n    media.addEventListener('ended', this.onEnded);\r\n\r\n    if(doc.type !== 'audio' && message?.pFlags.media_unread && message.fromId !== rootScope.myId) {\r\n      media.addEventListener('timeupdate', () => {\r\n        this.managers.appMessagesManager.readMessages(peerId, [mid]);\r\n      }, {once: true});\r\n    }\r\n\r\n    /* const onError = (e: Event) => {\r\n      //console.log('appMediaPlaybackController: video onError', e);\r\n\r\n      if(this.nextMid === mid) {\r\n        this.loadSiblingsMedia(peerId, doc.type as MediaType, mid).then(() => {\r\n          if(this.nextMid && storage[this.nextMid]) {\r\n            storage[this.nextMid].play();\r\n          }\r\n        });\r\n      }\r\n    };\r\n\r\n    media.addEventListener('error', onError); */\r\n\r\n    const deferred = deferredPromise<void>();\r\n    if(autoload) {\r\n      deferred.resolve();\r\n    } else {\r\n      const w = message.pFlags.is_scheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n      let waitingStorage = w.get(peerId);\r\n      if(!waitingStorage) {\r\n        w.set(peerId, waitingStorage = new Map());\r\n      }\r\n\r\n      waitingStorage.set(mid, deferred);\r\n    }\r\n\r\n    deferred.then(async() => {\r\n      // media.autoplay = true;\r\n      // console.log('will set media url:', media, doc, doc.type, doc.url);\r\n\r\n      if(doc.supportsStreaming || (await this.managers.thumbsStorage.getCacheContext(doc)).url) {\r\n        this.onMediaDocumentLoad(media);\r\n      } else {\r\n        let set = this.waitingDocumentsForLoad[doc.id];\r\n        if(!set) {\r\n          set = this.waitingDocumentsForLoad[doc.id] = new Set();\r\n        }\r\n\r\n        set.add(media);\r\n        appDownloadManager.downloadMediaURL({media: doc});\r\n      }\r\n    }/* , onError */);\r\n\r\n    return media;\r\n  }\r\n\r\n  public getMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const s = (isScheduled ? this.scheduled : this.media).get(peerId);\r\n    return s?.get(mid);\r\n  }\r\n\r\n  private onMediaDocumentLoad = async(media: HTMLMediaElement) => {\r\n    const details = this.mediaDetails.get(media);\r\n    const doc = await this.managers.appDocsManager.getDoc(details.docId);\r\n    if(doc.type === 'audio' && doc.supportsStreaming && SHOULD_USE_SAFARI_FIX) {\r\n      this.handleSafariStreamable(media);\r\n    }\r\n\r\n    // setTimeout(() => {\r\n    const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n    media.src = cacheContext.url;\r\n\r\n    if(this.playingMedia === media) {\r\n      media.playbackRate = this.playbackRate;\r\n\r\n      if(doc.type === 'audio') {\r\n        media.loop = this.loop;\r\n      }\r\n    }\r\n    // }, doc.supportsStreaming ? 500e3 : 0);\r\n\r\n    const set = this.waitingDocumentsForLoad[doc.id];\r\n    if(set) {\r\n      set.delete(media);\r\n\r\n      if(!set.size) {\r\n        delete this.waitingDocumentsForLoad[doc.id];\r\n      }\r\n    }\r\n  };\r\n\r\n  // safari      ,\r\n  //         SW,     \r\n  private handleSafariStreamable(media: HTMLMediaElement) {\r\n    media.addEventListener('play', () => {\r\n      /* if(media.readyState === 4) { // https://developer.mozilla.org/ru/docs/Web/API/XMLHttpRequest/readyState\r\n        return;\r\n      } */\r\n\r\n      // media.volume = 0;\r\n      const currentTime = media.currentTime;\r\n      // this.setSafariBuffering(media, true);\r\n\r\n      media.addEventListener('progress', () => {\r\n        media.currentTime = media.duration - 1;\r\n\r\n        media.addEventListener('progress', () => {\r\n          media.currentTime = currentTime;\r\n          // media.volume = 1;\r\n          // this.setSafariBuffering(media, false);\r\n\r\n          if(!media.paused) {\r\n            media.play()/* .catch(() => {}) */;\r\n          }\r\n        }, {once: true});\r\n      }, {once: true});\r\n    }/* , {once: true} */);\r\n  }\r\n\r\n  public resolveWaitingForLoadMedia(peerId: PeerId, mid: number, isScheduled?: boolean) {\r\n    const w = isScheduled ? this.waitingScheduledMediaForLoad : this.waitingMediaForLoad;\r\n    const storage = w.get(peerId);\r\n    if(!storage) {\r\n      return;\r\n    }\r\n\r\n    const promise = storage.get(mid);\r\n    if(promise) {\r\n      promise.resolve();\r\n      storage.delete(mid);\r\n\r\n      if(!storage.size) {\r\n        w.delete(peerId);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Only for audio\r\n   */\r\n  public isSafariBuffering(media: HTMLMediaElement) {\r\n    // @ts-ignore\r\n    return !!media.safariBuffering;\r\n  }\r\n\r\n  private setSafariBuffering(media: HTMLMediaElement, value: boolean) {\r\n    // @ts-ignore\r\n    media.safariBuffering = value;\r\n  }\r\n\r\n  private async setNewMediadata(message: Message.message, playingMedia = this.playingMedia) {\r\n    if(document.pictureInPictureElement) {\r\n      return;\r\n    }\r\n\r\n    await onMediaLoad(playingMedia, undefined, false); // have to wait for load, otherwise on macOS won't set\r\n\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n\r\n    const artwork: MediaImage[] = [];\r\n\r\n    const isVoice = doc.type === 'voice' || doc.type === 'round';\r\n    let title = '', artist = '';\r\n\r\n    if(doc.thumbs?.length) {\r\n      const size = doc.thumbs[doc.thumbs.length - 1];\r\n      if(!(size as PhotoSize.photoStrippedSize).bytes) {\r\n        const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n\r\n        if(cacheContext.url) {\r\n          artwork.push({\r\n            src: cacheContext.url,\r\n            sizes: `${(size as PhotoSize.photoSize).w}x${(size as PhotoSize.photoSize).h}`,\r\n            type: 'image/jpeg'\r\n          });\r\n        } else {\r\n          const download = appDownloadManager.downloadMediaURL({media: doc, thumb: size});\r\n          download.then(() => {\r\n            if(this.playingMedia !== playingMedia || !cacheContext.url) {\r\n              return;\r\n            }\r\n\r\n            this.setNewMediadata(message);\r\n          });\r\n        }\r\n      }\r\n    } else if(isVoice) {\r\n      const peerId = message.fromId || message.peerId;\r\n      const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\r\n      if(peerPhoto) {\r\n        // const result = this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small');\r\n        // if(result.cached) {\r\n        //   const url = await result.loadPromise;\r\n        //   artwork.push({\r\n        //     src: url,\r\n        //     sizes: '160x160',\r\n        //     type: 'image/jpeg'\r\n        //   });\r\n        // } else {\r\n        //   result.loadPromise.then((url) => {\r\n        //     if(this.playingMedia !== playingMedia || !url) {\r\n        //       return;\r\n        //     }\r\n\r\n        //     this.setNewMediadata(message);\r\n        //   });\r\n        // }\r\n      }\r\n\r\n      title = await getPeerTitle(peerId, true, false);\r\n      artist = I18n.format(doc.type === 'voice' ? 'AttachAudio' : 'AttachRound', true);\r\n    }\r\n\r\n    if(!isVoice) {\r\n      const attribute = doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\r\n      title = attribute?.title ?? doc.file_name;\r\n      artist = attribute?.performer;\r\n    }\r\n\r\n    if(!artwork.length) {\r\n      if(IS_APPLE) {\r\n        if(IS_TOUCH_SUPPORTED) {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon-precomposed.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        } else {\r\n          artwork.push({\r\n            src: `assets/img/apple-touch-icon.png`,\r\n            sizes: '180x180',\r\n            type: 'image/png'\r\n          });\r\n        }\r\n      } else {\r\n        [72, 96, 144, 192, 256, 384, 512].forEach((size) => {\r\n          const sizes = `${size}x${size}`;\r\n          artwork.push({\r\n            src: `assets/img/android-chrome-${sizes}.png`,\r\n            sizes,\r\n            type: 'image/png'\r\n          });\r\n        });\r\n      }\r\n    }\r\n\r\n    const metadata = new MediaMetadata({\r\n      title,\r\n      artist,\r\n      artwork\r\n    });\r\n\r\n    navigator.mediaSession.metadata = metadata;\r\n  }\r\n\r\n  public setCurrentMediadata() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) return;\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    this.setNewMediadata(message, playingMedia);\r\n  }\r\n\r\n  private getMessageByMedia(media: HTMLMediaElement): Message.message {\r\n    const details = this.mediaDetails.get(media);\r\n    return details.message;\r\n    // const {peerId, mid} = details;\r\n    // const message = details.isScheduled ?\r\n    //   this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) :\r\n    //   this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\r\n    // return message;\r\n  }\r\n\r\n  public getPlayingDetails() {\r\n    const {playingMedia} = this;\r\n    if(!playingMedia) {\r\n      return;\r\n    }\r\n\r\n    const message = this.getMessageByMedia(playingMedia);\r\n    return {\r\n      doc: getMediaFromMessage(message) as MyDocument,\r\n      message,\r\n      media: playingMedia,\r\n      playbackParams: this.getPlaybackParams()\r\n    };\r\n  }\r\n\r\n  private onPlay = (e?: Event) => {\r\n    const media = e.target as HTMLMediaElement;\r\n    const details = this.mediaDetails.get(media);\r\n    const {peerId, mid} = details;\r\n\r\n    // console.log('appMediaPlaybackController: video playing', this.currentPeerId, this.playingMedia, media);\r\n\r\n    const pip = this.pip;\r\n    if(pip) {\r\n      pip.pause();\r\n    }\r\n\r\n    const message = this.getMessageByMedia(media);\r\n\r\n    const previousMedia = this.playingMedia;\r\n    if(previousMedia !== media) {\r\n      this.stop();\r\n      this.setMedia(media, message);\r\n\r\n      const verify = (element: MediaItem) => element.mid === mid && element.peerId === peerId;\r\n      const listLoader = this.listLoader;\r\n      const current = listLoader.getCurrent();\r\n      if(!current || !verify(current)) {\r\n        let jumpLength: number;\r\n\r\n        for(const withOtherSide of [false, true]) {\r\n          const previous = listLoader.getPrevious(withOtherSide);\r\n\r\n          let idx = previous.findIndex(verify);\r\n          if(idx !== -1) {\r\n            jumpLength = -(previous.length - idx);\r\n          } else {\r\n            const next = listLoader.getNext(withOtherSide);\r\n            idx = next.findIndex(verify);\r\n            if(idx !== -1) {\r\n              jumpLength = idx + 1;\r\n            }\r\n          }\r\n\r\n          if(jumpLength !== undefined) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        if(jumpLength) {\r\n          this.go(jumpLength, false);\r\n        } else {\r\n          this.setTargets({peerId, mid});\r\n        }\r\n      }\r\n    }\r\n\r\n    // audio_pause     \r\n    setTimeout(() => {\r\n      if(this.playingMedia !== media) {\r\n        return;\r\n      }\r\n\r\n      this.dispatchEvent('play', this.getPlayingDetails());\r\n      this.pauseMediaInOtherTabs();\r\n    }, 0);\r\n  };\r\n\r\n  private onPause = (e?: Event) => {\r\n    /* const target = e.target as HTMLMediaElement;\r\n    if(!isInDOM(target)) {\r\n      this.container.append(target);\r\n      target.play();\r\n      return;\r\n    } */\r\n\r\n    // if(this.pip) {\r\n    //   this.pip.play();\r\n    // }\r\n\r\n    this.dispatchEvent('pause');\r\n  };\r\n\r\n  private onEnded = (e?: Event) => {\r\n    if(!e.isTrusted) {\r\n      return;\r\n    }\r\n\r\n    this.onPause(e);\r\n\r\n    // console.log('on media end');\r\n\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers ||\r\n      (!this.round && listLoader.current && !listLoader.next.length) ||\r\n      !listLoader.getNext(true).length ||\r\n      !this.next()) {\r\n      this.stop();\r\n      this.dispatchEvent('stop');\r\n    }\r\n  };\r\n\r\n  public pauseMediaInOtherTabs() {\r\n    this.skipMediaPlayEvent = true;\r\n    rootScope.dispatchEvent('media_play');\r\n  }\r\n\r\n  // public get pip() {\r\n  //   return document.pictureInPictureElement as HTMLVideoElement;\r\n  // }\r\n\r\n  public toggle(play?: boolean, media = this.playingMedia) {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(play === undefined) {\r\n      play = media.paused;\r\n    }\r\n\r\n    if(media.paused !== play) {\r\n      return false;\r\n    }\r\n\r\n    if(play) {\r\n      media.play();\r\n    } else {\r\n      media.pause();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  public play = () => {\r\n    return this.toggle(true);\r\n  };\r\n\r\n  public pause = () => {\r\n    return this.toggle(false);\r\n  };\r\n\r\n  public stop = (media = this.playingMedia) => {\r\n    if(!media) {\r\n      return false;\r\n    }\r\n\r\n    if(!media.paused) {\r\n      media.pause();\r\n    }\r\n\r\n    media.currentTime = 0;\r\n    simulateEvent(media, 'ended');\r\n\r\n    if(media === this.playingMedia) {\r\n      const details = this.mediaDetails.get(media);\r\n      if(details?.clean) {\r\n        media.src = '';\r\n        const peerId = details.peerId;\r\n        const s = details.isScheduled ? this.scheduled : this.media;\r\n        const storage = s.get(peerId);\r\n        if(storage) {\r\n          storage.delete(details.mid);\r\n\r\n          if(!storage.size) {\r\n            s.delete(peerId);\r\n          }\r\n        }\r\n\r\n        media.remove();\r\n\r\n        this.mediaDetails.delete(media);\r\n      }\r\n\r\n      this.playingMedia = undefined;\r\n      this.playingMediaType = undefined;\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  public playItem = (item: MediaItem) => {\r\n    const {peerId, mid} = item;\r\n    const isScheduled = this.searchContext.isScheduled;\r\n    const media = this.getMedia(peerId, mid, isScheduled);\r\n\r\n    /* if(isSafari) {\r\n      media.autoplay = true;\r\n    } */\r\n\r\n    media.play();\r\n\r\n    setTimeout(() => {\r\n      this.resolveWaitingForLoadMedia(peerId, mid, isScheduled);\r\n    }, 0);\r\n  };\r\n\r\n  public go = (length: number, dispatchJump?: boolean) => {\r\n    const listLoader = this.listLoader;\r\n    if(this.lockedSwitchers || !listLoader) {\r\n      return;\r\n    }\r\n\r\n    if(this.playingMediaType === 'audio') {\r\n      return listLoader.goRound(length, dispatchJump);\r\n    } else {\r\n      return listLoader.go(length, dispatchJump);\r\n    }\r\n  };\r\n\r\n  private bindBrowserCallback(cb: (video: HTMLVideoElement, details: MediaSessionActionDetails) => void) {\r\n    const handler: MediaSessionActionHandler = (details) => {\r\n      cb(this.pip, details);\r\n    };\r\n\r\n    return handler;\r\n  }\r\n\r\n  public browserPlay = this.bindBrowserCallback((video) => this.toggle(true, video));\r\n  public browserPause = this.bindBrowserCallback((video) => this.toggle(false, video));\r\n  public browserStop = this.bindBrowserCallback((video) => this.stop(video));\r\n  public browserSeekBackward = this.bindBrowserCallback((video, details) => this.seekBackward(details, video));\r\n  public browserSeekForward = this.bindBrowserCallback((video, details) => this.seekForward(details, video));\r\n  public browserSeekTo = this.bindBrowserCallback((video, details) => this.seekTo(details, video));\r\n  public browserNext = this.bindBrowserCallback((video) => video || this.next());\r\n  public browserPrevious = this.bindBrowserCallback((video) => video ? this.seekToStart(video) : this.previous());\r\n\r\n  public next = () => {\r\n    return this.go(1);\r\n  };\r\n\r\n  public previous = () => {\r\n    if(this.seekToStart(this.playingMedia)) {\r\n      return;\r\n    }\r\n\r\n    return this.go(-1);\r\n  };\r\n\r\n  public seekToStart(media: HTMLMediaElement) {\r\n    if(media?.currentTime > 5) {\r\n      media.currentTime = 0;\r\n      this.toggle(true, media);\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  public willBePlayed(media: HTMLMediaElement) {\r\n    this.willBePlayedMedia = media;\r\n  }\r\n\r\n  public setSearchContext(context: MediaSearchContext) {\r\n    if(deepEqual(this.searchContext, context)) {\r\n      return false;\r\n    }\r\n\r\n    this.searchContext = copy(context); // {_: type === 'audio' ? 'inputMessagesFilterMusic' : 'inputMessagesFilterRoundVoice'}\r\n    return true;\r\n  }\r\n\r\n  public getSearchContext() {\r\n    return this.searchContext;\r\n  }\r\n\r\n  public setTargets(current: MediaItem, prev?: MediaItem[], next?: MediaItem[]) {\r\n    let listLoader = this.listLoader;\r\n    if(!listLoader) {\r\n      listLoader = this.listLoader = new SearchListLoader({\r\n        loadCount: 10,\r\n        loadWhenLeft: 5,\r\n        processItem: (message: Message.message) => {\r\n          this.addMedia(message, false);\r\n          return {peerId: message.peerId, mid: message.mid};\r\n        },\r\n        onJump: (item, older) => {\r\n          this.playItem(item);\r\n        },\r\n        onEmptied: () => {\r\n          this.dispatchEvent('stop');\r\n          this.stop();\r\n        }\r\n      });\r\n    } else {\r\n      listLoader.reset();\r\n    }\r\n\r\n    const reverse = this.searchContext.folderId !== undefined ? false : true;\r\n    if(prev) {\r\n      listLoader.setTargets(prev, next, reverse);\r\n    } else {\r\n      listLoader.reverse = reverse;\r\n    }\r\n\r\n    listLoader.setSearchContext(this.searchContext);\r\n    listLoader.current = current;\r\n\r\n    listLoader.load(true);\r\n    listLoader.load(false);\r\n  }\r\n\r\n  private getPlaybackMediaTypeFromMessage(message: Message.message) {\r\n    const doc = getMediaFromMessage(message) as MyDocument;\r\n    let mediaType: PlaybackMediaType = 'audio';\r\n    if(doc?.type) {\r\n      if(doc.type === 'voice' || doc.type === 'round') {\r\n        mediaType = 'voice';\r\n      } else if(doc.type === 'video') {\r\n        mediaType = 'video';\r\n      }\r\n    }\r\n\r\n    return mediaType;\r\n  }\r\n\r\n  public setMedia(media: HTMLMediaElement, message: Message.message) {\r\n    const mediaType = this.getPlaybackMediaTypeFromMessage(message);\r\n\r\n    this._playbackRate = this.playbackRates[mediaType];\r\n\r\n    this.playingMedia = media;\r\n    this.playingMediaType = mediaType;\r\n    this.playingMedia.volume = this.volume;\r\n    this.playingMedia.muted = this.muted;\r\n    this.playingMedia.playbackRate = this.playbackRate;\r\n\r\n    if(mediaType === 'audio') {\r\n      this.playingMedia.loop = this.loop;\r\n    }\r\n\r\n    if('mediaSession' in navigator) {\r\n      this.setNewMediadata(message);\r\n    }\r\n  }\r\n\r\n  public setSingleMedia(media?: HTMLMediaElement, message?: Message.message) {\r\n    const playingMedia = this.playingMedia;\r\n\r\n    const wasPlaying = this.pause();\r\n\r\n    let onPlay: () => void;\r\n    if(media) {\r\n      onPlay = () => {\r\n        const pip = this.pip;\r\n        if(pip) {\r\n          pip.pause();\r\n        }\r\n\r\n        this.pauseMediaInOtherTabs();\r\n      };\r\n\r\n      if(!media.paused) {\r\n        onPlay();\r\n      }\r\n\r\n      media.addEventListener('play', onPlay);\r\n    } else { // maybe it's voice recording\r\n      this.pauseMediaInOtherTabs();\r\n    }\r\n\r\n    this.willBePlayed(undefined);\r\n    if(media) this.setMedia(media, message);\r\n    else this.playingMedia = undefined;\r\n    this.toggleSwitchers(false);\r\n\r\n    return (playPaused = wasPlaying) => {\r\n      this.toggleSwitchers(true);\r\n\r\n      if(playingMedia) {\r\n        if(this.mediaDetails.get(playingMedia)) {\r\n          this.setMedia(playingMedia, this.getMessageByMedia(playingMedia));\r\n        } else {\r\n          this.next() || this.previous();\r\n        }\r\n      }\r\n\r\n      // If it's still not cleaned\r\n      if(this.playingMedia === media) {\r\n        this.playingMedia = undefined;\r\n        this.playingMediaType = undefined;\r\n      }\r\n\r\n      if(media) {\r\n        media.removeEventListener('play', onPlay);\r\n      }\r\n\r\n      // I don't remember what it was for\r\n      // if(media && this.playingMedia === media) {\r\n      //   this.stop();\r\n      // }\r\n\r\n      if(playPaused) {\r\n        this.play();\r\n      }\r\n    };\r\n  }\r\n\r\n  public toggleSwitchers(enabled: boolean) {\r\n    this.lockedSwitchers = !enabled;\r\n  }\r\n\r\n  public setPictureInPicture(video: HTMLVideoElement) {\r\n    this.pip = video;\r\n\r\n    // let wasPlaying = this.pause();\r\n\r\n    const listenerSetter = new ListenerSetter();\r\n    listenerSetter.add(video)('leavepictureinpicture', () => {\r\n      if(this.pip !== video) {\r\n        return;\r\n      }\r\n\r\n      this.pip = undefined;\r\n      // if(wasPlaying) {\r\n      //   this.play();\r\n      // }\r\n\r\n      listenerSetter.removeAll();\r\n    }, {once: true});\r\n\r\n    listenerSetter.add(video)('play', (e) => {\r\n      if(this.playingMedia !== video) {\r\n        this.pause();\r\n      }\r\n\r\n      this.pauseMediaInOtherTabs();\r\n      // if(this.pause()) {\r\n      //   listenerSetter.add(video)('pause', () => {\r\n      //     this.play();\r\n      //   }, {once: true});\r\n      // }\r\n    });\r\n  }\r\n}\r\n\r\nconst appMediaPlaybackController = new AppMediaPlaybackController();\r\nMOUNT_CLASS_TO.appMediaPlaybackController = appMediaPlaybackController;\r\nexport default appMediaPlaybackController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../environment/mediaMimeTypesSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, detachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport mediaSizes from '../helpers/mediaSizes';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport {Message} from '../layer';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from './appMediaPlaybackController';\nimport AppMediaViewerBase, {MEDIA_VIEWER_CLASSNAME} from './appMediaViewerBase';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport PopupForward from './popups/forward';\nimport Scrollable from './scrollable';\nimport appSidebarRight from './sidebarRight';\nimport AppSharedMediaTab from './sidebarRight/tabs/sharedMedia';\n\ntype AppMediaViewerTargetType = {\n  element: HTMLElement,\n  mid: number,\n  peerId: PeerId\n};\nexport default class AppMediaViewer extends AppMediaViewerBase<'caption', 'delete' | 'forward', AppMediaViewerTargetType> {\n  protected listLoader: SearchListLoader<AppMediaViewerTargetType>;\n  protected btnMenuForward: ButtonMenuItemOptions;\n  protected btnMenuDownload: ButtonMenuItemOptions;\n  protected btnMenuDelete: ButtonMenuItemOptions;\n\n  get searchContext() {\n    return this.listLoader.searchContext;\n  }\n\n  constructor() {\n    super(new SearchListLoader({\n      processItem: (item) => {\n        const isForDocument = this.searchContext.inputFilter._ === 'inputMessagesFilterDocument';\n        const {mid, peerId} = item;\n        const media: MyPhoto | MyDocument = getMediaFromMessage(item);\n\n        if(!media) return;\n\n        if(isForDocument && !AppMediaViewer.isMediaCompatibleForDocumentViewer(media)) {\n          return;\n        }\n\n        return {element: null as HTMLElement, mid, peerId};\n      }\n    }), ['delete', 'forward']);\n\n    this.listLoader.onEmptied = () => {\n      this.close();\n    };\n\n    /* const stub = document.createElement('div');\n    stub.classList.add(MEDIA_VIEWER_CLASSNAME + '-stub');\n    this.content.main.prepend(stub); */\n\n    this.content.caption = document.createElement('div');\n    this.content.caption.classList.add(MEDIA_VIEWER_CLASSNAME + '-caption', 'spoilers-container'/* , 'media-viewer-stub' */);\n\n    let captionTimeout: number;\n    const setCaptionTimeout = () => {\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n      }\n\n      captionTimeout = window.setTimeout(() => {\n        captionTimeout = undefined;\n        this.content.caption.classList.remove('is-focused');\n      }, 800);\n    };\n    this.content.caption.addEventListener('touchstart', () => {\n      if(!mediaSizes.isMobile) return;\n\n      this.content.caption.classList.add('is-focused');\n\n      if(captionTimeout) {\n        clearTimeout(captionTimeout);\n        captionTimeout = undefined;\n      }\n\n      document.addEventListener('touchend', setCaptionTimeout, {once: true});\n    });\n\n    const captionScrollable = new Scrollable(this.content.caption);\n    captionScrollable.onAdditionalScroll = setCaptionTimeout;\n\n    // this.content.main.append(this.content.caption);\n    this.wholeDiv.append(this.content.caption);\n\n    attachClickEvent(this.buttons.delete, this.onDeleteClick);\n\n    const buttons: ButtonMenuItemOptions[] = [this.btnMenuForward = {\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick\n    }, this.btnMenuDownload = {\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }, this.btnMenuDelete = {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick\n    }];\n\n    this.setBtnMenuToggle(buttons);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  protected setListeners() {\n    super.setListeners();\n    attachClickEvent(this.buttons.forward, this.onForwardClick);\n    attachClickEvent(this.author.container, this.onAuthorClick);\n\n    const onCaptionClick = (e: MouseEvent) => {\n      const a = findUpTag(e.target, 'A');\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      if(a instanceof HTMLAnchorElement && (!spoiler || this.content.caption.classList.contains('is-spoiler-visible'))) { // close viewer if it's t.me/ redirect\n        const onclick = a.getAttribute('onclick');\n        if(!onclick || onclick.includes('showMaskedAlert')) {\n          return;\n        }\n\n        cancelEvent(e);\n\n        this.close().then(() => {\n          this.content.caption.removeEventListener('click', onCaptionClick, {capture: true});\n          a.click();\n        });\n\n        return false;\n      }\n    };\n\n    this.content.caption.addEventListener('click', onCaptionClick, {capture: true});\n  }\n\n  /* public close(e?: MouseEvent) {\n    const good = !this.setMoverAnimationPromise;\n    const promise = super.close(e);\n\n    if(good) { // clear\n      this.currentMessageId = 0;\n      this.peerId = 0;\n    }\n\n    return promise;\n  } */\n\n  protected getMessageByPeer(peerId: PeerId, mid: number) {\n    return this.searchContext.isScheduled ? this.managers.appMessagesManager.getScheduledMessageByPeer(peerId, mid) : this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n  }\n\n  onPrevClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, -1);\n  };\n\n  onNextClick = async(target: AppMediaViewerTargetType) => {\n    this.openMedia(await this.getMessageByPeer(target.peerId, target.mid), target.element, 1);\n  };\n\n  onDeleteClick = () => {\n    const target = this.target;\n    new PopupDeleteMessages(target.peerId, [target.mid], 'chat', () => {\n      this.target = {element: this.content.media} as any;\n      this.close();\n    });\n  };\n\n  onForwardClick = () => {\n    const target = this.target;\n    if(target.mid) {\n      // appSidebarRight.forwardTab.open([target.mid]);\n      new PopupForward({\n        [target.peerId]: [target.mid]\n      }, () => {\n        return this.close();\n      });\n    }\n  };\n\n  onAuthorClick = async(e: MouseEvent) => {\n    const {mid, peerId} = this.target;\n    if(mid && mid !== Number.MAX_SAFE_INTEGER) {\n      const threadId = this.searchContext.threadId;\n      const message = await this.getMessageByPeer(peerId, mid);\n      this.close(e)\n      // .then(() => mediaSizes.isMobile ? appSidebarRight.sharedMediaTab.closeBtn.click() : Promise.resolve())\n      .then(async() => {\n        if(mediaSizes.isMobile) {\n          const tab = appSidebarRight.getTab(AppSharedMediaTab);\n          if(tab) {\n            tab.close();\n          }\n        }\n\n        appImManager.setInnerPeer({\n          peerId: message.peerId,\n          lastMsgId: mid,\n          type: threadId ? 'discussion' : undefined,\n          threadId\n        });\n      });\n    }\n  };\n\n  onDownloadClick = async() => {\n    const {peerId, mid} = this.target;\n    const message = await this.getMessageByPeer(peerId, mid);\n    const media = getMediaFromMessage(message);\n    if(!media) return;\n    appDownloadManager.downloadToDisc({media, queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId});\n  };\n\n  private setCaption(message: MyMessage) {\n    const caption = (message as Message.message).message;\n    let html: Parameters<typeof setInnerHTML>[1] = '';\n    if(caption) {\n      html = wrapRichText(caption, {\n        entities: (message as Message.message).totalEntities\n      });\n    }\n\n    // html = 'Dandelion are a family of flowering plants that grow in many parts of the world.';\n    setInnerHTML(this.content.caption.firstElementChild, html);\n    this.content.caption.classList.toggle('hide', !caption);\n    // this.content.container.classList.toggle('with-caption', !!caption);\n  }\n\n  public setSearchContext(context: MediaSearchContext) {\n    this.listLoader.setSearchContext(context);\n\n    return this;\n  }\n\n  public async openMedia(message: MyMessage, target?: HTMLElement, fromRight = 0, reverse = false,\n    prevTargets: AppMediaViewerTargetType[] = [], nextTargets: AppMediaViewerTargetType[] = []/* , needLoadMore = true */) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const mid = message.mid;\n    const fromId = (message as Message.message).fwd_from && !message.fromId ? (message as Message.message).fwd_from.from_name : message.fromId;\n    const media = getMediaFromMessage(message);\n\n    const cantForwardMessage = message._ === 'messageService' || !this.managers.appMessagesManager.canForward(message);\n    [this.buttons.forward, this.btnMenuForward.element].forEach((button) => {\n      button.classList.toggle('hide', cantForwardMessage);\n    });\n\n    this.wholeDiv.classList.toggle('no-forwards', cantForwardMessage);\n\n    const cantDownloadMessage = cantForwardMessage;\n    [this.buttons.download, this.btnMenuDownload.element].forEach((button) => {\n      button.classList.toggle('hide', cantDownloadMessage);\n    });\n\n    const canDeleteMessage = this.managers.appMessagesManager.canDeleteMessage(message);\n    [this.buttons.delete, this.btnMenuDelete.element].forEach((button) => {\n      button.classList.toggle('hide', !canDeleteMessage);\n    });\n\n    this.setCaption(message);\n    const promise = super._openMedia(media, message.date, fromId, fromRight, target, reverse, prevTargets, nextTargets, message/* , needLoadMore */);\n    this.target.mid = mid;\n    this.target.peerId = message.peerId;\n\n    return promise;\n  }\n\n  public static isMediaCompatibleForDocumentViewer(media: MyPhoto | MyDocument) {\n    return media._ === 'photo' || MEDIA_MIME_TYPES_SUPPORTED.has(media.mime_type);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appMediaPlaybackController from '../components/appMediaPlaybackController';\nimport {IS_APPLE_MOBILE, IS_MOBILE} from '../environment/userAgent';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport ButtonMenu from '../components/buttonMenu';\nimport {ButtonMenuToggleHandler} from '../components/buttonMenuToggle';\nimport ControlsHover from '../helpers/dom/controlsHover';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../helpers/dom/fullScreen';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from '../components/mediaProgressLine';\nimport VolumeSelector from '../components/volumeSelector';\nimport debounce from '../helpers/schedulers/debounce';\nimport overlayCounter from '../helpers/overlayCounter';\nimport onMediaLoad from '../helpers/onMediaLoad';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\n\nexport default class VideoPlayer extends ControlsHover {\n  private static PLAYBACK_RATES = [0.5, 1, 1.5, 2];\n  private static PLAYBACK_RATES_ICONS = ['playback_05', 'playback_1x', 'playback_15', 'playback_2x'];\n\n  protected video: HTMLVideoElement;\n  protected wrapper: HTMLDivElement;\n  protected progress: MediaProgressLine;\n  protected skin: 'default';\n\n  protected listenerSetter: ListenerSetter;\n  protected playbackRateButton: HTMLElement;\n  protected pipButton: HTMLElement;\n\n  /* protected videoParent: HTMLElement;\n  protected videoWhichChild: number; */\n\n  protected onPlaybackRackMenuToggle?: (open: boolean) => void;\n  protected onPip?: (pip: boolean) => void;\n  protected onPipClose?: () => void;\n\n  constructor({video, play = false, streamable = false, duration, onPlaybackRackMenuToggle, onPip, onPipClose}: {\n    video: HTMLVideoElement,\n    play?: boolean,\n    streamable?: boolean,\n    duration?: number,\n    onPlaybackRackMenuToggle?: VideoPlayer['onPlaybackRackMenuToggle'],\n    onPip?: VideoPlayer['onPip'],\n    onPipClose?: VideoPlayer['onPipClose']\n  }) {\n    super();\n\n    this.video = video;\n    this.wrapper = document.createElement('div');\n    this.wrapper.classList.add('ckin__player');\n\n    this.onPlaybackRackMenuToggle = onPlaybackRackMenuToggle;\n    this.onPip = onPip;\n    this.onPipClose = onPipClose;\n\n    this.listenerSetter = new ListenerSetter();\n\n    this.setup({\n      element: this.wrapper,\n      listenerSetter: this.listenerSetter,\n      canHideControls: () => {\n        return !this.video.paused && (!this.playbackRateButton || !this.playbackRateButton.classList.contains('menu-open'));\n      },\n      showOnLeaveToClassName: 'media-viewer-caption',\n      ignoreClickClassName: 'ckin__controls'\n    });\n\n    video.parentNode.insertBefore(this.wrapper, video);\n    this.wrapper.appendChild(video);\n\n    this.skin = 'default';\n\n    this.stylePlayer(duration);\n    this.setBtnMenuToggle();\n\n    if(this.skin === 'default') {\n      const controls = this.wrapper.querySelector('.default__controls.ckin__controls') as HTMLDivElement;\n      this.progress = new MediaProgressLine(video, streamable);\n      controls.prepend(this.progress.container);\n    }\n\n    if(play/*  && video.paused */) {\n      const promise = video.play();\n      promise.catch((err: Error) => {\n        if(err.name === 'NotAllowedError') {\n          video.muted = true;\n          video.autoplay = true;\n          video.play();\n        }\n      }).finally(() => { // due to autoplay, play will not call\n        this.wrapper.classList.toggle('is-playing', !this.video.paused);\n      });\n    }\n  }\n\n  private stylePlayer(initDuration: number) {\n    const {wrapper, video, skin, listenerSetter} = this;\n\n    wrapper.classList.add(skin);\n\n    const html = this.buildControls();\n    wrapper.insertAdjacentHTML('beforeend', html);\n    let timeDuration: HTMLElement;\n\n    if(skin === 'default') {\n      this.playbackRateButton = this.wrapper.querySelector('.playback-rate') as HTMLElement;\n      this.pipButton = this.wrapper.querySelector('.pip') as HTMLElement;\n\n      const toggle = wrapper.querySelectorAll('.toggle') as NodeListOf<HTMLElement>;\n      const fullScreenButton = wrapper.querySelector('.fullscreen') as HTMLElement;\n      const timeElapsed = wrapper.querySelector('#time-elapsed');\n      timeDuration = wrapper.querySelector('#time-duration') as HTMLElement;\n      timeDuration.textContent = toHHMMSS(video.duration | 0);\n\n      const volumeSelector = new VolumeSelector(listenerSetter);\n\n      const leftControls = wrapper.querySelector('.left-controls');\n      volumeSelector.btn.classList.remove('btn-icon');\n      leftControls.insertBefore(volumeSelector.btn, timeElapsed.parentElement);\n\n      Array.from(toggle).forEach((button) => {\n        attachClickEvent(button, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n      });\n\n      if(this.pipButton) {\n        attachClickEvent(this.pipButton, () => {\n          this.video.requestPictureInPicture();\n        }, {listenerSetter: this.listenerSetter});\n\n        const onPip = (pip: boolean) => {\n          this.wrapper.style.visibility = pip ? 'hidden': '';\n          if(this.onPip) {\n            this.onPip(pip);\n          }\n        };\n\n        const debounceTime = 20;\n        const debouncedPip = debounce(onPip, debounceTime, false, true);\n\n        listenerSetter.add(video)('enterpictureinpicture', () => {\n          debouncedPip(true);\n\n          listenerSetter.add(video)('leavepictureinpicture', () => {\n            const onPause = () => {\n              clearTimeout(timeout);\n              if(this.onPipClose) {\n                this.onPipClose();\n              }\n            };\n            const listener = listenerSetter.add(video)('pause', onPause, {once: true}) as any as Listener;\n            const timeout = setTimeout(() => {\n              listenerSetter.remove(listener);\n            }, debounceTime);\n          }, {once: true});\n        });\n\n        listenerSetter.add(video)('leavepictureinpicture', () => {\n          debouncedPip(false);\n        });\n      }\n\n      if(!IS_TOUCH_SUPPORTED) {\n        attachClickEvent(video, () => {\n          this.togglePlay();\n        }, {listenerSetter: this.listenerSetter});\n\n        listenerSetter.add(document)('keydown', (e: KeyboardEvent) => {\n          if(overlayCounter.overlaysActive > 1 || document.pictureInPictureElement === video) { // forward popup is active, etc\n            return;\n          }\n\n          const {key, code} = e;\n\n          let good = true;\n          if(code === 'KeyF') {\n            this.toggleFullScreen();\n          } else if(code === 'KeyM') {\n            appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n          } else if(code === 'Space') {\n            this.togglePlay();\n          } else if(e.altKey && (code === 'Equal' || code === 'Minus')) {\n            const add = code === 'Equal' ? 1 : -1;\n            const playbackRate = appMediaPlaybackController.playbackRate;\n            const idx = VideoPlayer.PLAYBACK_RATES.indexOf(playbackRate);\n            const nextIdx = idx + add;\n            if(nextIdx >= 0 && nextIdx < VideoPlayer.PLAYBACK_RATES.length) {\n              appMediaPlaybackController.playbackRate = VideoPlayer.PLAYBACK_RATES[nextIdx];\n            }\n          } else if(wrapper.classList.contains('ckin__fullscreen') && (key === 'ArrowLeft' || key === 'ArrowRight')) {\n            if(key === 'ArrowLeft') appMediaPlaybackController.seekBackward({action: 'seekbackward'});\n            else appMediaPlaybackController.seekForward({action: 'seekforward'});\n          } else {\n            good = false;\n          }\n\n          if(good) {\n            cancelEvent(e);\n            return false;\n          }\n        });\n      }\n\n      listenerSetter.add(video)('dblclick', () => {\n        if(!IS_TOUCH_SUPPORTED) {\n          this.toggleFullScreen();\n        }\n      });\n\n      attachClickEvent(fullScreenButton, () => {\n        this.toggleFullScreen();\n      }, {listenerSetter: this.listenerSetter});\n\n      addFullScreenListener(wrapper, this.onFullScreen.bind(this, fullScreenButton), listenerSetter);\n\n      listenerSetter.add(video)('timeupdate', () => {\n        timeElapsed.textContent = toHHMMSS(video.currentTime | 0);\n      });\n\n      listenerSetter.add(video)('play', () => {\n        wrapper.classList.add('played');\n\n        if(!IS_TOUCH_SUPPORTED) {\n          listenerSetter.add(video)('play', () => {\n            this.hideControls(true);\n          });\n        }\n      }, {once: true});\n\n      listenerSetter.add(video)('pause', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(appMediaPlaybackController)('playbackParams', () => {\n        this.setPlaybackRateIcon();\n      });\n    }\n\n    listenerSetter.add(video)('play', () => {\n      wrapper.classList.add('is-playing');\n    });\n\n    listenerSetter.add(video)('pause', () => {\n      wrapper.classList.remove('is-playing');\n    });\n\n    if(video.duration || initDuration) {\n      timeDuration.textContent = toHHMMSS(Math.round(video.duration || initDuration));\n    } else {\n      onMediaLoad(video).then(() => {\n        timeDuration.textContent = toHHMMSS(Math.round(video.duration));\n      });\n    }\n  }\n\n  protected togglePlay() {\n    this.video[this.video.paused ? 'play' : 'pause']();\n  }\n\n  private buildControls() {\n    const skin = this.skin;\n    if(skin === 'default') {\n      return `\n      <button class=\"${skin}__button--big toggle tgico\" title=\"Toggle Play\"></button>\n      <div class=\"${skin}__gradient-bottom ckin__controls\"></div>\n      <div class=\"${skin}__controls ckin__controls\">\n        <div class=\"bottom-controls\">\n          <div class=\"left-controls\">\n            <button class=\"btn-icon ${skin}__button toggle tgico\" title=\"Toggle Video\"></button>\n            <div class=\"time\">\n              <time id=\"time-elapsed\">0:00</time>\n              <span> / </span>\n              <time id=\"time-duration\">0:00</time>\n            </div>\n          </div>\n          <div class=\"right-controls\">\n            <button class=\"btn-icon ${skin}__button btn-menu-toggle playback-rate night\" title=\"Playback Rate\"></button>\n            ${!IS_MOBILE && document.pictureInPictureEnabled ? `<button class=\"btn-icon ${skin}__button pip tgico-pip\" title=\"Picture-in-Picture\"></button>` : ''}\n            <button class=\"btn-icon ${skin}__button fullscreen tgico-fullscreen\" title=\"Full Screen\"></button>\n          </div>\n        </div>\n      </div>`;\n    }\n  }\n\n  protected setBtnMenuToggle() {\n    const buttons: Parameters<typeof ButtonMenu>[0] = VideoPlayer.PLAYBACK_RATES.map((rate, idx) => {\n      return {\n        // icon: VideoPlayer.PLAYBACK_RATES_ICONS[idx],\n        regularText: rate + 'x',\n        onClick: () => {\n          appMediaPlaybackController.playbackRate = rate;\n        }\n      };\n    });\n    const btnMenu = ButtonMenu(buttons);\n    btnMenu.classList.add('top-left');\n    ButtonMenuToggleHandler(\n      this.playbackRateButton,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(true);\n      } : undefined,\n      undefined,\n      this.onPlaybackRackMenuToggle ? () => {\n        this.onPlaybackRackMenuToggle(false);\n      } : undefined\n    );\n    this.playbackRateButton.append(btnMenu);\n\n    this.setPlaybackRateIcon();\n  }\n\n  protected setPlaybackRateIcon() {\n    const playbackRateButton = this.playbackRateButton;\n    VideoPlayer.PLAYBACK_RATES_ICONS.forEach((className) => {\n      className = 'tgico-' + className;\n      playbackRateButton.classList.remove(className);\n    });\n\n    let idx = VideoPlayer.PLAYBACK_RATES.indexOf(appMediaPlaybackController.playbackRate);\n    if(idx === -1) idx = VideoPlayer.PLAYBACK_RATES.indexOf(1);\n\n    playbackRateButton.classList.add('tgico-' + VideoPlayer.PLAYBACK_RATES_ICONS[idx]);\n  }\n\n  protected toggleFullScreen() {\n    const player = this.wrapper;\n\n    // * https://caniuse.com/#feat=fullscreen\n    if(IS_APPLE_MOBILE) {\n      const video = this.video as any;\n      video.webkitEnterFullscreen();\n      video.enterFullscreen();\n      return;\n    }\n\n    if(!isFullScreen()) {\n      /* const videoParent = this.video.parentElement;\n      const videoWhichChild = whichChild(this.video);\n      const needVideoRemount = videoParent !== player;\n\n      if(needVideoRemount) {\n        this.videoParent = videoParent;\n        this.videoWhichChild = videoWhichChild;\n        player.prepend(this.video);\n      } */\n\n      requestFullScreen(player);\n    } else {\n      /* if(this.videoParent) {\n        const {videoWhichChild, videoParent} = this;\n        if(!videoWhichChild) {\n          videoParent.prepend(this.video);\n        } else {\n          videoParent.insertBefore(this.video, videoParent.children[videoWhichChild]);\n        }\n\n        this.videoParent = null;\n        this.videoWhichChild = -1;\n      } */\n\n      cancelFullScreen();\n    }\n  }\n\n  protected onFullScreen(fullScreenButton: HTMLElement) {\n    const isFull = isFullScreen();\n    this.wrapper.classList.toggle('ckin__fullscreen', isFull);\n    if(!isFull) {\n      fullScreenButton.classList.remove('tgico-smallscreen');\n      fullScreenButton.classList.add('tgico-fullscreen');\n      fullScreenButton.setAttribute('title', 'Full Screen');\n    } else {\n      fullScreenButton.classList.remove('tgico-fullscreen');\n      fullScreenButton.classList.add('tgico-smallscreen');\n      fullScreenButton.setAttribute('title', 'Exit Full Screen');\n    }\n  }\n\n  public cleanup() {\n    super.cleanup();\n    this.listenerSetter.removeAll();\n    this.progress.removeListeners();\n    this.onPlaybackRackMenuToggle = this.onPip = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport deferredPromise from '../helpers/cancellablePromise';\nimport mediaSizes from '../helpers/mediaSizes';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../environment/userAgent';\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {logger} from '../lib/logger';\nimport VideoPlayer from '../lib/mediaPlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector from './animationIntersector';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from './appMediaPlaybackController';\nimport AvatarElement from './avatar';\nimport ButtonIcon from './buttonIcon';\nimport {ButtonMenuItemOptions} from './buttonMenu';\nimport ButtonMenuToggle from './buttonMenuToggle';\nimport ProgressivePreloader from './preloader';\nimport SwipeHandler from './swipeHandler';\nimport {formatFullSentTime} from '../helpers/date';\nimport appNavigationController, {NavigationItem} from './appNavigationController';\nimport {Message} from '../layer';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport fillPropertyValue from '../helpers/fillPropertyValue';\nimport generatePathData from '../helpers/generatePathData';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport {doubleRaf, fastRaf} from '../helpers/schedulers';\nimport RangeSelector from './rangeSelector';\nimport windowSize from '../helpers/windowSize';\nimport ListLoader from '../helpers/listLoader';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport {isFullScreen} from '../helpers/dom/fullScreen';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport SearchListLoader from '../helpers/searchListLoader';\nimport createVideo from '../helpers/dom/createVideo';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../helpers/setAttachmentSize';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport LazyLoadQueueBase from './lazyLoadQueueBase';\nimport overlayCounter from '../helpers/overlayCounter';\nimport {ThumbCache} from '../lib/storages/thumbs';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst ZOOM_STEP = 0.5;\nconst ZOOM_INITIAL_VALUE = 1;\nconst ZOOM_MIN_VALUE = 0.5;\nconst ZOOM_MAX_VALUE = 4;\n\n// TODO:   ( SVG)  ,      \n// TODO:  \"\"      ,     (,  )\n// TODO:    ,    :    ,     , ..  -   ,   \n\nexport const MEDIA_VIEWER_CLASSNAME = 'media-viewer';\n\nexport default class AppMediaViewerBase<\n  ContentAdditionType extends string,\n  ButtonsAdditionType extends string,\n  TargetType extends {element: HTMLElement\n}> extends EventListenerBase<{\n  setMoverBefore: () => void,\n  setMoverAfter: () => void\n}> {\n  protected wholeDiv: HTMLElement;\n  protected overlaysDiv: HTMLElement;\n  protected author: {[k in 'container' | 'avatarEl' | 'nameEl' | 'date']: HTMLElement} = {} as any;\n  protected content: {[k in 'main' | 'container' | 'media' | 'mover' | ContentAdditionType]: HTMLElement} = {} as any;\n  protected buttons: {[k in 'download' | 'close' | 'prev' | 'next' | 'mobile-close' | 'zoom' | ButtonsAdditionType]: HTMLElement} = {} as any;\n  protected topbar: HTMLElement;\n  protected moversContainer: HTMLElement;\n\n  protected tempId = 0;\n  protected preloader: ProgressivePreloader = null;\n  protected preloaderStreamable: ProgressivePreloader = null;\n\n  // protected targetContainer: HTMLElement = null;\n  // protected loadMore: () => void = null;\n\n  protected log: ReturnType<typeof logger>;\n\n  protected isFirstOpen = true;\n\n  // protected needLoadMore = true;\n\n  protected pageEl = document.getElementById('page-chats') as HTMLDivElement;\n\n  protected setMoverPromise: Promise<void>;\n  protected setMoverAnimationPromise: Promise<void>;\n\n  protected lazyLoadQueue: LazyLoadQueueBase;\n\n  protected highlightSwitchersTimeout: number;\n\n  protected onDownloadClick: (e: MouseEvent) => void;\n  protected onPrevClick: (target: TargetType) => void;\n  protected onNextClick: (target: TargetType) => void;\n\n  protected videoPlayer: VideoPlayer;\n\n  protected zoomElements: {\n    container: HTMLElement,\n    btnOut: HTMLElement,\n    btnIn: HTMLElement,\n    rangeSelector: RangeSelector\n  } = {} as any;\n  // protected zoomValue = ZOOM_INITIAL_VALUE;\n  protected zoomSwipeHandler: SwipeHandler;\n  protected zoomSwipeStartX = 0;\n  protected zoomSwipeStartY = 0;\n  protected zoomSwipeX = 0;\n  protected zoomSwipeY = 0;\n\n  protected ctrlKeyDown: boolean;\n  protected releaseSingleMedia: ReturnType<AppMediaPlaybackController['setSingleMedia']>;\n  protected navigationItem: NavigationItem;\n\n  protected managers: AppManagers;\n\n  get target() {\n    return this.listLoader.current;\n  }\n\n  set target(value) {\n    this.listLoader.current = value;\n  }\n\n  constructor(\n    protected listLoader: ListLoader<TargetType, any>,\n    topButtons: Array<keyof AppMediaViewerBase<ContentAdditionType, ButtonsAdditionType, TargetType>['buttons']>\n  ) {\n    super(false);\n\n    this.managers = rootScope.managers;\n\n    this.log = logger('AMV');\n    this.preloader = new ProgressivePreloader();\n    this.preloaderStreamable = new ProgressivePreloader({\n      cancelable: false,\n      streamable: true\n    });\n    this.preloader.construct();\n    this.preloaderStreamable.construct();\n    this.lazyLoadQueue = new LazyLoadQueueBase();\n\n    this.wholeDiv = document.createElement('div');\n    this.wholeDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-whole');\n\n    this.overlaysDiv = document.createElement('div');\n    this.overlaysDiv.classList.add('overlays');\n\n    const mainDiv = document.createElement('div');\n    mainDiv.classList.add(MEDIA_VIEWER_CLASSNAME);\n\n    const topbar = this.topbar = document.createElement('div');\n    topbar.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar', MEDIA_VIEWER_CLASSNAME + '-appear');\n\n    const topbarLeft = document.createElement('div');\n    topbarLeft.classList.add(MEDIA_VIEWER_CLASSNAME + '-topbar-left');\n\n    this.buttons['mobile-close'] = ButtonIcon('close', {onlyMobile: true});\n\n    // * author\n    this.author.container = document.createElement('div');\n    this.author.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-author', 'no-select');\n    const authorRight = document.createElement('div');\n\n    this.author.avatarEl = new AvatarElement();\n    this.author.avatarEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-userpic', 'avatar-44');\n\n    this.author.nameEl = document.createElement('div');\n    this.author.nameEl.classList.add(MEDIA_VIEWER_CLASSNAME + '-name');\n\n    this.author.date = document.createElement('div');\n    this.author.date.classList.add(MEDIA_VIEWER_CLASSNAME + '-date');\n\n    authorRight.append(this.author.nameEl, this.author.date);\n\n    this.author.container.append(this.author.avatarEl, authorRight);\n\n    // * buttons\n    const buttonsDiv = document.createElement('div');\n    buttonsDiv.classList.add(MEDIA_VIEWER_CLASSNAME + '-buttons');\n\n    topButtons.concat(['download', 'zoom', 'close']).forEach((name) => {\n      const button = ButtonIcon(name, {noRipple: true});\n      this.buttons[name] = button;\n      buttonsDiv.append(button);\n    });\n\n    this.buttons.zoom.classList.add('zoom-in');\n\n    // * zoom\n    this.zoomElements.container = document.createElement('div');\n    this.zoomElements.container.classList.add('zoom-container');\n\n    this.zoomElements.btnOut = ButtonIcon('zoomout', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnOut, () => this.changeZoom(false));\n    this.zoomElements.btnIn = ButtonIcon('zoomin', {noRipple: true});\n    attachClickEvent(this.zoomElements.btnIn, () => this.changeZoom(true));\n\n    this.zoomElements.rangeSelector = new RangeSelector({\n      step: ZOOM_STEP,\n      min: ZOOM_MIN_VALUE,\n      max: ZOOM_MAX_VALUE,\n      withTransition: true\n    }, ZOOM_INITIAL_VALUE);\n    this.zoomElements.rangeSelector.setListeners();\n    this.zoomElements.rangeSelector.setHandlers({\n      onScrub: this.setZoomValue,\n      onMouseUp: () => this.setZoomValue()\n    });\n\n    this.zoomElements.container.append(this.zoomElements.btnOut, this.zoomElements.rangeSelector.container, this.zoomElements.btnIn);\n\n    this.wholeDiv.append(this.zoomElements.container);\n\n    // * content\n    this.content.main = document.createElement('div');\n    this.content.main.classList.add(MEDIA_VIEWER_CLASSNAME + '-content');\n\n    this.content.container = document.createElement('div');\n    this.content.container.classList.add(MEDIA_VIEWER_CLASSNAME + '-container');\n\n    this.content.media = document.createElement('div');\n    this.content.media.classList.add(MEDIA_VIEWER_CLASSNAME + '-media');\n\n    this.content.container.append(this.content.media);\n\n    this.content.main.append(this.content.container);\n    mainDiv.append(this.content.main);\n    this.overlaysDiv.append(mainDiv);\n    // * overlays end\n\n    topbarLeft.append(this.buttons['mobile-close'], this.author.container);\n    topbar.append(topbarLeft, buttonsDiv);\n\n    this.buttons.prev = document.createElement('div');\n    this.buttons.prev.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-left`;\n    this.buttons.prev.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-prev-button\"></span>`;\n\n    this.buttons.next = document.createElement('div');\n    this.buttons.next.className = `${MEDIA_VIEWER_CLASSNAME}-switcher ${MEDIA_VIEWER_CLASSNAME}-switcher-right`;\n    this.buttons.next.innerHTML = `<span class=\"tgico-down ${MEDIA_VIEWER_CLASSNAME}-next-button\"></span>`;\n\n    this.moversContainer = document.createElement('div');\n    this.moversContainer.classList.add(MEDIA_VIEWER_CLASSNAME + '-movers');\n\n    this.wholeDiv.append(this.overlaysDiv, this.buttons.prev, this.buttons.next, this.topbar, this.moversContainer);\n\n    // * constructing html end\n\n    this.listLoader.onLoadedMore = () => {\n      this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n      this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n    };\n\n    this.setNewMover();\n  }\n\n  protected setListeners() {\n    attachClickEvent(this.buttons.download, this.onDownloadClick);\n    [this.buttons.close, this.buttons['mobile-close'], this.preloaderStreamable.preloader].forEach((el) => {\n      attachClickEvent(el, this.close.bind(this));\n    });\n\n    ([[-1, this.buttons.prev], [1, this.buttons.next]] as [number, HTMLElement][]).forEach(([moveLength, button]) => {\n      // attachClickEvent(button, (e) => {\n      button.addEventListener('click', (e) => {\n        cancelEvent(e);\n        if(this.setMoverPromise) return;\n\n        this.listLoader.go(moveLength);\n      });\n    });\n\n    attachClickEvent(this.buttons.zoom, () => {\n      if(this.isZooming()) this.toggleZoom(false);\n      else {\n        this.changeZoom(true);\n      }\n    });\n\n    // ! cannot use the function because it'll cancel slide event on touch devices\n    // attachClickEvent(this.wholeDiv, this.onClick);\n    this.wholeDiv.addEventListener('click', this.onClick);\n\n    this.listLoader.onJump = (item, older) => {\n      if(older) this.onNextClick(item);\n      else this.onPrevClick(item);\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n      const swipeHandler = new SwipeHandler({\n        element: this.wholeDiv,\n        onSwipe: (xDiff, yDiff) => {\n          if(isFullScreen()) {\n            return;\n          }\n          // console.log(xDiff, yDiff);\n\n          const percents = Math.abs(xDiff) / windowSize.width;\n          if(percents > .2 || xDiff > 125) {\n            // console.log('will swipe', xDiff);\n\n            if(xDiff < 0) {\n              this.buttons.prev.click();\n            } else {\n              this.buttons.next.click();\n            }\n\n            return true;\n          }\n\n          const percentsY = Math.abs(yDiff) / windowSize.height;\n          if(percentsY > .2 || yDiff > 125) {\n            this.close();\n            return true;\n          }\n\n          return false;\n        },\n        verifyTouchTarget: (evt) => {\n          // * Fix for seek input\n          if((evt.target as HTMLElement).tagName === 'INPUT' || findUpClassName(evt.target, 'media-viewer-caption')) {\n            return false;\n          }\n\n          return true;\n        }\n      });\n    }\n  }\n\n  protected toggleZoom(enable?: boolean) {\n    const isVisible = this.isZooming();\n    if(this.zoomElements.rangeSelector.mousedown || this.ctrlKeyDown) {\n      enable = true;\n    }\n\n    if(isVisible === enable) return;\n\n    if(enable === undefined) {\n      enable = !isVisible;\n    }\n\n    this.buttons.zoom.classList.toggle('zoom-in', !enable);\n    this.zoomElements.container.classList.toggle('is-visible', enable);\n    const zoomValue = enable ? this.zoomElements.rangeSelector.value : 1;\n    this.setZoomValue(zoomValue);\n    this.zoomElements.rangeSelector.setProgress(zoomValue);\n\n    if(this.videoPlayer) {\n      this.videoPlayer.lockControls(enable ? false : undefined);\n    }\n\n    if(enable) {\n      if(!this.zoomSwipeHandler) {\n        let lastDiffX: number, lastDiffY: number;\n        const multiplier = -1;\n        this.zoomSwipeHandler = new SwipeHandler({\n          element: this.moversContainer,\n          onFirstSwipe: () => {\n            lastDiffX = lastDiffY = 0;\n            this.moversContainer.classList.add('no-transition');\n          },\n          onSwipe: (xDiff, yDiff) => {\n            [xDiff, yDiff] = [xDiff * multiplier, yDiff * multiplier];\n            this.zoomSwipeX += xDiff - lastDiffX;\n            this.zoomSwipeY += yDiff - lastDiffY;\n            [lastDiffX, lastDiffY] = [xDiff, yDiff];\n\n            this.setZoomValue();\n          },\n          onReset: () => {\n            this.moversContainer.classList.remove('no-transition');\n          },\n          cursor: 'move'\n        });\n      } else {\n        this.zoomSwipeHandler.setListeners();\n      }\n\n      this.zoomElements.rangeSelector.setProgress(zoomValue);\n    } else if(!enable) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n  }\n\n  protected changeZoom(add: boolean) {\n    this.zoomElements.rangeSelector.addProgress(ZOOM_STEP * (add ? 1 : -1));\n    this.setZoomValue();\n  }\n\n  protected setZoomValue = (value = this.zoomElements.rangeSelector.value) => {\n    // this.zoomValue = value;\n    if(value === ZOOM_INITIAL_VALUE) {\n      this.zoomSwipeX = 0;\n      this.zoomSwipeY = 0;\n    }\n\n    this.moversContainer.style.transform = `matrix(${value}, 0, 0, ${value}, ${this.zoomSwipeX}, ${this.zoomSwipeY})`;\n\n    this.zoomElements.btnOut.classList.toggle('inactive', value === ZOOM_MIN_VALUE);\n    this.zoomElements.btnIn.classList.toggle('inactive', value === ZOOM_MAX_VALUE);\n\n    this.toggleZoom(value !== ZOOM_INITIAL_VALUE);\n  };\n\n  protected isZooming() {\n    return this.zoomElements.container.classList.contains('is-visible');\n  }\n\n  protected setBtnMenuToggle(buttons: ButtonMenuItemOptions[]) {\n    const btnMenuToggle = ButtonMenuToggle({onlyMobile: true}, 'bottom-left', buttons);\n    this.topbar.append(btnMenuToggle);\n  }\n\n  public close(e?: MouseEvent) {\n    if(e) {\n      cancelEvent(e);\n    }\n\n    if(this.setMoverAnimationPromise) return Promise.reject();\n\n    if(this.navigationItem) {\n      appNavigationController.removeItem(this.navigationItem);\n    }\n\n    this.lazyLoadQueue.clear();\n\n    const promise = this.setMoverToTarget(this.target?.element, true).then(({onAnimationEnd}) => onAnimationEnd);\n\n    this.listLoader.reset();\n    (this.listLoader as SearchListLoader<any>).cleanup && (this.listLoader as SearchListLoader<any>).cleanup();\n    this.setMoverPromise = null;\n    this.tempId = -1;\n    if((window as any).appMediaViewer === this) {\n      (window as any).appMediaViewer = undefined;\n    }\n\n    /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n      promise.then(() => {\n        appSidebarRight.forwardTab.closeBtn.click();\n      });\n    } */\n\n    this.removeGlobalListeners();\n\n    this.zoomSwipeHandler = undefined;\n\n    promise.finally(() => {\n      this.wholeDiv.remove();\n      this.toggleOverlay(false);\n    });\n\n    return promise;\n  }\n\n  protected toggleOverlay(active: boolean) {\n    overlayCounter.isOverlayActive = active;\n    animationIntersector.checkAnimations(active);\n  }\n\n  protected toggleGlobalListeners(active: boolean) {\n    if(active) this.setGlobalListeners();\n    else this.removeGlobalListeners();\n  }\n\n  protected removeGlobalListeners() {\n    if(this.zoomSwipeHandler) {\n      this.zoomSwipeHandler.removeListeners();\n    }\n\n    window.removeEventListener('keydown', this.onKeyDown);\n    window.removeEventListener('keyup', this.onKeyUp);\n    window.removeEventListener('wheel', this.onWheel, {capture: true});\n  }\n\n  protected setGlobalListeners() {\n    if(this.isZooming()) {\n      this.zoomSwipeHandler.setListeners();\n    }\n\n    window.addEventListener('keydown', this.onKeyDown);\n    window.addEventListener('keyup', this.onKeyUp);\n    if(!IS_TOUCH_SUPPORTED) window.addEventListener('wheel', this.onWheel, {passive: false, capture: true});\n  }\n\n  onClick = (e: MouseEvent) => {\n    if(this.setMoverAnimationPromise) return;\n\n    const target = e.target as HTMLElement;\n    if(target.tagName === 'A') return;\n    cancelEvent(e);\n\n    if(IS_TOUCH_SUPPORTED) {\n      if(this.highlightSwitchersTimeout) {\n        clearTimeout(this.highlightSwitchersTimeout);\n      } else {\n        this.wholeDiv.classList.add('highlight-switchers');\n      }\n\n      this.highlightSwitchersTimeout = window.setTimeout(() => {\n        this.wholeDiv.classList.remove('highlight-switchers');\n        this.highlightSwitchersTimeout = 0;\n      }, 3e3);\n\n      return;\n    }\n\n    const isZooming = this.isZooming();\n    let mover: HTMLElement = null;\n    const classNames = ['ckin__player', 'media-viewer-buttons', 'media-viewer-author', 'media-viewer-caption', 'zoom-container'];\n    if(isZooming) {\n      classNames.push('media-viewer-movers');\n    }\n\n    classNames.find((s) => {\n      try {\n        mover = findUpClassName(target, s);\n        if(mover) return true;\n      } catch(err) {return false;}\n    });\n\n    if(/* target === this.mediaViewerDiv */!mover || (!isZooming && (target.tagName === 'IMG' || target.tagName === 'image'))) {\n      this.close();\n    }\n  };\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    // this.log('onKeyDown', e);\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    const key = e.key;\n\n    let good = true;\n    if(key === 'ArrowRight') {\n      this.buttons.next.click();\n    } else if(key === 'ArrowLeft') {\n      this.buttons.prev.click();\n    } else if(key === '-' || key === '=') {\n      if(this.ctrlKeyDown) {\n        this.changeZoom(key === '=');\n      }\n    } else {\n      good = false;\n    }\n\n    if(e.ctrlKey || e.metaKey) {\n      this.ctrlKeyDown = true;\n    }\n\n    if(good) {\n      cancelEvent(e);\n    }\n  };\n\n  private onKeyUp = (e: KeyboardEvent) => {\n    if(overlayCounter.overlaysActive > 1) {\n      return;\n    }\n\n    if(!(e.ctrlKey || e.metaKey)) {\n      this.ctrlKeyDown = false;\n\n      if(this.isZooming()) {\n        this.setZoomValue();\n      }\n    }\n  };\n\n  private onWheel = (e: WheelEvent) => {\n    if(overlayCounter.overlaysActive > 1 || (findUpClassName(e.target, 'media-viewer-caption') && !this.ctrlKeyDown)) {\n      return;\n    }\n\n    cancelEvent(e);\n\n    if(this.ctrlKeyDown) {\n      const scrollingUp = e.deltaY < 0;\n      // if(!scrollingUp && !this.isZooming()) return;\n      this.changeZoom(!!scrollingUp);\n    }\n  };\n\n  protected async setMoverToTarget(target: HTMLElement, closing = false, fromRight = 0) {\n    this.dispatchEvent('setMoverBefore');\n\n    const mover = this.content.mover;\n\n    if(!closing) {\n      mover.innerHTML = '';\n      // mover.append(this.buttons.prev, this.buttons.next);\n    }\n\n    const zoomValue = this.isZooming() && closing /* && false */ ? this.zoomElements.rangeSelector.value : ZOOM_INITIAL_VALUE;\n    /* if(!(zoomValue > 1 && closing)) */ this.removeCenterFromMover(mover);\n\n    const wasActive = fromRight !== 0;\n\n    const delay = rootScope.settings.animationsEnabled ? (wasActive ? 350 : 200) : 0;\n    // let delay = wasActive ? 350 : 10000;\n\n    /* if(wasActive) {\n      this.moveTheMover(mover);\n      mover = this.setNewMover();\n    } */\n\n    /* if(DEBUG) {\n      this.log('setMoverToTarget', target, closing, wasActive, fromRight);\n    } */\n\n    let realParent: HTMLElement;\n\n    let rect: DOMRect;\n    if(target) {\n      if(target instanceof AvatarElement || target.classList.contains('grid-item')/*  || target.classList.contains('document-ico') */) {\n        realParent = target;\n        rect = target.getBoundingClientRect();\n      } else if(target instanceof SVGImageElement || target.parentElement instanceof SVGForeignObjectElement) {\n        realParent = findUpClassName(target, 'attachment');\n        rect = realParent.getBoundingClientRect();\n      } else if(target.classList.contains('profile-avatars-avatar')) {\n        realParent = findUpClassName(target, 'profile-avatars-container');\n        rect = realParent.getBoundingClientRect();\n\n        // * if not active avatar\n        if(closing && target.getBoundingClientRect().left !== rect.left) {\n          target = realParent = rect = undefined;\n        }\n      }\n    }\n\n    if(!target) {\n      target = this.content.media;\n    }\n\n    if(!rect) {\n      realParent = target.parentElement as HTMLElement;\n      rect = target.getBoundingClientRect();\n    }\n\n    let needOpacity = false;\n    if(target !== this.content.media && !target.classList.contains('profile-avatars-avatar')) {\n      const overflowElement = findUpClassName(realParent, 'scrollable');\n      const visibleRect = getVisibleRect(realParent, overflowElement, true);\n\n      if(closing && (!visibleRect || visibleRect.overflow.vertical === 2 || visibleRect.overflow.horizontal === 2)) {\n        target = this.content.media;\n        realParent = target.parentElement as HTMLElement;\n        rect = target.getBoundingClientRect();\n      } else if(visibleRect && (visibleRect.overflow.vertical === 1 || visibleRect.overflow.horizontal === 1)) {\n        needOpacity = true;\n      }\n    }\n\n    const containerRect = this.content.media.getBoundingClientRect();\n\n    let transform = '';\n    let left: number;\n    let top: number;\n\n    if(wasActive) {\n      left = fromRight === 1 ? windowSize.width : -containerRect.width;\n      top = containerRect.top;\n    } else {\n      left = rect.left;\n      top = rect.top;\n    }\n\n    /* if(zoomValue > 1) { // 33\n      // const diffX = (rect.width * zoomValue - rect.width) / 4;\n      const diffX = (rect.width * zoomValue - rect.width) / 2;\n      const diffY = (rect.height * zoomValue - rect.height) / 4;\n      // left -= diffX;\n      // top += diffY;\n    } */\n\n    transform += `translate3d(${left}px,${top}px,0) `;\n\n    /* if(wasActive) {\n      left = fromRight === 1 ? appPhotosManager.windowW / 2 : -(containerRect.width + appPhotosManager.windowW / 2);\n      transform += `translate(${left}px,-50%) `;\n    } else {\n      left = rect.left - (appPhotosManager.windowW / 2);\n      top = rect.top - (appPhotosManager.windowH / 2);\n      transform += `translate(${left}px,${top}px) `;\n    } */\n\n    let aspecter: HTMLDivElement;\n    if(target instanceof HTMLImageElement || target instanceof HTMLVideoElement || target.tagName === 'DIV') {\n      if(mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter')) {\n        aspecter = mover.firstElementChild as HTMLDivElement;\n\n        const player = aspecter.querySelector('.ckin__player');\n        if(player) {\n          const video = player.firstElementChild as HTMLVideoElement;\n          aspecter.append(video);\n          player.remove();\n        }\n\n        if(!aspecter.style.cssText) { //  - ,   ,       \n          mover.classList.remove('active');\n          this.setFullAspect(aspecter, containerRect, rect);\n          void mover.offsetLeft; // reflow\n          mover.classList.add('active');\n        }\n      } else {\n        aspecter = document.createElement('div');\n        aspecter.classList.add('media-viewer-aspecter'/* , 'disable-hover' */);\n        mover.prepend(aspecter);\n      }\n\n      aspecter.style.cssText = `width: ${rect.width}px; height: ${rect.height}px; transform: scale3d(${containerRect.width / rect.width}, ${containerRect.height / rect.height}, 1);`;\n    }\n\n    mover.style.width = containerRect.width + 'px';\n    mover.style.height = containerRect.height + 'px';\n\n    // const scaleX = rect.width / (containerRect.width * zoomValue);\n    // const scaleY = rect.height / (containerRect.height * zoomValue);\n    const scaleX = rect.width / containerRect.width;\n    const scaleY = rect.height / containerRect.height;\n    if(!wasActive) {\n      transform += `scale3d(${scaleX},${scaleY},1) `;\n    }\n\n    let borderRadius = window.getComputedStyle(realParent).getPropertyValue('border-radius');\n    const brSplitted = fillPropertyValue(borderRadius) as string[];\n    borderRadius = brSplitted.map((r) => (parseInt(r) / scaleX) + 'px').join(' ');\n    if(!wasActive) {\n      mover.style.borderRadius = borderRadius;\n    }\n    // let borderRadius = '0px 0px 0px 0px';\n\n    if(closing && zoomValue !== 1) {\n      // const width = this.moversContainer.scrollWidth * scaleX;\n      // const height = this.moversContainer.scrollHeight * scaleY;\n      const willBeLeft = windowSize.width / 2 - rect.width / 2;\n      const willBeTop = windowSize.height / 2 - rect.height / 2;\n      const left = rect.left - willBeLeft/*  + (width - rect.width) / 2 */;\n      const top = rect.top - willBeTop/*  + (height - rect.height) / 2 */;\n      this.moversContainer.style.transform = `matrix(${scaleX}, 0, 0, ${scaleY}, ${left}, ${top})`;\n    } else {\n      mover.style.transform = transform;\n    }\n\n    needOpacity && (mover.style.opacity = '0'/* !closing ? '0' : '' */);\n\n    /* if(wasActive) {\n      this.log('setMoverToTarget', mover.style.transform);\n    } */\n\n    let path: SVGPathElement;\n    const isOut = target.classList.contains('is-out');\n\n    const deferred = this.setMoverAnimationPromise = deferredPromise<void>();\n    const ret = {onAnimationEnd: deferred};\n\n    const timeout = setTimeout(() => {\n      if(!deferred.isFulfilled && !deferred.isRejected) {\n        deferred.resolve();\n      }\n    }, 1000);\n\n    deferred.finally(() => {\n      this.dispatchEvent('setMoverAfter');\n\n      if(this.setMoverAnimationPromise === deferred) {\n        this.setMoverAnimationPromise = null;\n      }\n\n      clearTimeout(timeout);\n    });\n\n    if(!closing) {\n      let mediaElement: HTMLImageElement | HTMLVideoElement | HTMLCanvasElement;\n      let src: string;\n\n      // if(target instanceof HTMLVideoElement) {\n      const selector = 'video, img, .canvas-thumbnail';\n      const queryFrom = target.matches(selector) ? target.parentElement : target;\n      const elements = Array.from(queryFrom.querySelectorAll(selector)) as HTMLImageElement[];\n      if(elements.length) {\n        target = elements.pop();\n        const canvas = document.createElement('canvas');\n        const context = canvas.getContext('2d');\n        if(target instanceof HTMLImageElement) {\n          canvas.width = target.naturalWidth;\n          canvas.height = target.naturalHeight;\n        } else if(target instanceof HTMLVideoElement) {\n          canvas.width = target.videoWidth;\n          canvas.height = target.videoHeight;\n        } else if(target instanceof HTMLCanvasElement) {\n          canvas.width = target.width;\n          canvas.height = target.height;\n        }\n\n        canvas.className = 'canvas-thumbnail thumbnail media-photo';\n        context.drawImage(target as HTMLImageElement | HTMLCanvasElement, 0, 0);\n        target = canvas;\n      }\n      // }\n\n      if(target.tagName === 'DIV' || target.tagName === 'AVATAR-ELEMENT') { // useContainerAsTarget\n        const images = Array.from(target.querySelectorAll('img')) as HTMLImageElement[];\n        const image = images.pop();\n        if(image) {\n          mediaElement = new Image();\n          src = image.src;\n          mover.append(mediaElement);\n        }\n        /* mediaElement = new Image();\n        src = target.style.backgroundImage.slice(5, -2); */\n      } else if(target instanceof HTMLImageElement) {\n        mediaElement = new Image();\n        src = target.src;\n      } else if(target instanceof HTMLVideoElement) {\n        mediaElement = createVideo();\n        mediaElement.src = target.src;\n      } else if(target instanceof SVGSVGElement) {\n        const clipId = target.dataset.clipId;\n        const newClipId = clipId + '-mv';\n\n        const {width, height} = containerRect;\n\n        const newSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        newSvg.setAttributeNS(null, 'width', '' + width);\n        newSvg.setAttributeNS(null, 'height', '' + height);\n\n        //     \n        newSvg.setAttributeNS(null, 'viewBox', `0 0 ${width} ${height}`);\n        newSvg.setAttributeNS(null, 'preserveAspectRatio', 'xMidYMid meet');\n\n        newSvg.insertAdjacentHTML('beforeend', target.firstElementChild.outerHTML.replace(clipId, newClipId));\n        newSvg.insertAdjacentHTML('beforeend', target.lastElementChild.outerHTML.replace(clipId, newClipId));\n\n        //       \n        const defs = newSvg.firstElementChild;\n        const use = defs.firstElementChild.firstElementChild as SVGUseElement;\n        if(use instanceof SVGUseElement) {\n          let transform = use.getAttributeNS(null, 'transform');\n          transform = transform.replace(/translate\\((.+?), (.+?)\\) scale\\((.+?), (.+?)\\)/, (match, x, y, sX, sY) => {\n            x = +x;\n            if(x !== 2) {\n              x = width - (2 / scaleX);\n            } else {\n              x = 2 / scaleX;\n            }\n\n            y = height;\n\n            return `translate(${x}, ${y}) scale(${+sX / scaleX}, ${+sY / scaleY})`;\n          });\n          use.setAttributeNS(null, 'transform', transform);\n\n          //   RECT\n          path = defs.firstElementChild.lastElementChild as SVGPathElement;\n\n          //            \n          let d: string;\n          const br: [number, number, number, number] = borderRadius.split(' ').map((v) => parseInt(v)) as any;\n          if(isOut) d = generatePathData(0, 0, width - 9 / scaleX, height, ...br);\n          else d = generatePathData(9 / scaleX, 0, width - 9 / scaleX, height, ...br);\n          path.setAttributeNS(null, 'd', d);\n        }\n\n        const foreignObject = newSvg.lastElementChild;\n        foreignObject.setAttributeNS(null, 'width', '' + containerRect.width);\n        foreignObject.setAttributeNS(null, 'height', '' + containerRect.height);\n\n        mover.prepend(newSvg);\n      } else if(target instanceof HTMLCanvasElement) {\n        mediaElement = target;\n      }\n\n      if(aspecter) {\n        aspecter.style.borderRadius = borderRadius;\n\n        if(mediaElement) {\n          aspecter.append(mediaElement);\n        }\n      }\n\n      mediaElement = mover.querySelector('video, img');\n      if(mediaElement instanceof HTMLImageElement) {\n        mediaElement.classList.add('thumbnail');\n        if(!aspecter) {\n          mediaElement.style.width = containerRect.width + 'px';\n          mediaElement.style.height = containerRect.height + 'px';\n        }\n\n        if(src) {\n          await renderImageFromUrlPromise(mediaElement, src);\n        }\n      }/*  else if(mediaElement instanceof HTMLVideoElement && mediaElement.firstElementChild && ((mediaElement.firstElementChild as HTMLSourceElement).src || src)) {\n        await new Promise((resolve, reject) => {\n          mediaElement.addEventListener('loadeddata', resolve);\n\n          if(src) {\n            (mediaElement.firstElementChild as HTMLSourceElement).src = src;\n          }\n        });\n      } */\n\n      mover.style.display = '';\n\n      fastRaf(() => {\n        mover.classList.add(wasActive ? 'moving' : 'active');\n      });\n    } else {\n      /* if(mover.classList.contains('center')) {\n        mover.classList.remove('center');\n        void mover.offsetLeft; // reflow\n      } */\n\n      if(target instanceof SVGSVGElement) {\n        path = mover.querySelector('path');\n\n        if(path) {\n          this.sizeTailPath(path, containerRect, scaleX, delay, false, isOut, borderRadius);\n        }\n      }\n\n      if(target.classList.contains('media-viewer-media')) {\n        mover.classList.add('hiding');\n      }\n\n      this.toggleWholeActive(false);\n\n      // return ret;\n\n      setTimeout(() => {\n        mover.style.borderRadius = borderRadius;\n\n        if(mover.firstElementChild) {\n          (mover.firstElementChild as HTMLElement).style.borderRadius = borderRadius;\n        }\n      }, delay / 2);\n\n      setTimeout(() => {\n        mover.innerHTML = '';\n        mover.classList.remove('moving', 'active', 'hiding');\n        mover.style.cssText = 'display: none;';\n\n        deferred.resolve();\n      }, delay);\n\n      mover.classList.remove('opening');\n\n      return ret;\n    }\n\n    mover.classList.add('opening');\n\n    // await new Promise((resolve) => setTimeout(resolve, 0));\n    // await new Promise((resolve) => window.requestAnimationFrame(resolve));\n    // *  RAF' ,       (  )\n    await doubleRaf();\n\n    //     - \n    // throw '';\n\n    // await new Promise((resolve) => setTimeout(resolve, 5e3));\n\n    mover.style.transform = `translate3d(${containerRect.left}px,${containerRect.top}px,0) scale3d(1,1,1)`;\n    // mover.style.transform = `translate(-50%,-50%) scale(1,1)`;\n    needOpacity && (mover.style.opacity = ''/* closing ? '0' : '' */);\n\n    if(aspecter) {\n      this.setFullAspect(aspecter, containerRect, rect);\n    }\n\n    // throw '';\n\n    setTimeout(() => {\n      mover.style.borderRadius = '';\n\n      if(mover.firstElementChild) {\n        (mover.firstElementChild as HTMLElement).style.borderRadius = '';\n      }\n    }, 0/* delay / 2 */);\n\n    mover.dataset.timeout = '' + setTimeout(() => {\n      mover.classList.remove('moving', 'opening');\n\n      if(aspecter) { //  - ,   ,       \n        if(mover.querySelector('video') || true) {\n          mover.classList.remove('active');\n          aspecter.style.cssText = '';\n          void mover.offsetLeft; // reflow\n        }\n\n        // aspecter.classList.remove('disable-hover');\n      }\n\n      //       ,      \n      mover.classList.add('center', 'no-transition');\n      /* mover.style.left = mover.style.top = '50%';\n      mover.style.transform = 'translate(-50%, -50%)';\n      void mover.offsetLeft; // reflow */\n\n      //      \n      mover.classList.add('active');\n      delete mover.dataset.timeout;\n\n      deferred.resolve();\n    }, delay);\n\n    if(path) {\n      this.sizeTailPath(path, containerRect, scaleX, delay, true, isOut, borderRadius);\n    }\n\n    return ret;\n  }\n\n  protected toggleWholeActive(active: boolean) {\n    if(active) {\n      this.wholeDiv.classList.add('active');\n    } else {\n      this.wholeDiv.classList.add('backwards');\n      setTimeout(() => {\n        this.wholeDiv.classList.remove('active');\n      }, 0);\n    }\n  }\n\n  protected setFullAspect(aspecter: HTMLDivElement, containerRect: DOMRect, rect: DOMRect) {\n    /* let media = aspecter.firstElementChild;\n    let proportion: number;\n    if(media instanceof HTMLImageElement) {\n      proportion = media.naturalWidth / media.naturalHeight;\n    } else if(media instanceof HTMLVideoElement) {\n      proportion = media.videoWidth / media.videoHeight;\n    } */\n    const proportion = containerRect.width / containerRect.height;\n\n    let {width, height} = rect;\n    /* if(proportion === 1) {\n      aspecter.style.cssText = '';\n    } else { */\n    if(proportion > 0) {\n      width = height * proportion;\n    } else {\n      height = width * proportion;\n    }\n\n    // this.log('will set style aspecter:', `width: ${width}px; height: ${height}px; transform: scale(${containerRect.width / width}, ${containerRect.height / height});`);\n\n    aspecter.style.cssText = `width: ${width}px; height: ${height}px; transform: scale3d(${containerRect.width / width}, ${containerRect.height / height}, 1);`;\n    // }\n  }\n\n  protected sizeTailPath(path: SVGPathElement, rect: DOMRect, scaleX: number, delay: number, upscale: boolean, isOut: boolean, borderRadius: string) {\n    const start = Date.now();\n    const {width, height} = rect;\n    delay = delay / 2;\n\n    const br = borderRadius.split(' ').map((v) => parseInt(v));\n\n    const step = () => {\n      const diff = Date.now() - start;\n\n      let progress = delay ? diff / delay : 1;\n      if(progress > 1) progress = 1;\n      if(upscale) progress = 1 - progress;\n\n      const _br: [number, number, number, number] = br.map((v) => v * progress) as any;\n\n      let d: string;\n      if(isOut) d = generatePathData(0, 0, width - (9 / scaleX * progress), height, ..._br);\n      else d = generatePathData(9 / scaleX * progress, 0, width/* width - (9 / scaleX * progress) */, height, ..._br);\n      path.setAttributeNS(null, 'd', d);\n\n      if(diff < delay) fastRaf(step);\n    };\n\n    // window.requestAnimationFrame(step);\n    step();\n  }\n\n  protected removeCenterFromMover(mover: HTMLElement) {\n    if(mover.classList.contains('center')) {\n      // const rect = mover.getBoundingClientRect();\n      const rect = this.content.media.getBoundingClientRect();\n      mover.style.transform = `translate3d(${rect.left}px,${rect.top}px,0)`;\n      mover.classList.remove('center');\n      void mover.offsetLeft; // reflow\n      mover.classList.remove('no-transition');\n    }\n  }\n\n  protected moveTheMover(mover: HTMLElement, toLeft = true) {\n    const windowW = windowSize.width;\n\n    this.removeCenterFromMover(mover);\n\n    // mover.classList.remove('active');\n    mover.classList.add('moving');\n\n    if(mover.dataset.timeout) { //     -  ,      \n      clearTimeout(+mover.dataset.timeout);\n    }\n\n    const rect = mover.getBoundingClientRect();\n\n    const newTransform = mover.style.transform.replace(/translate3d\\((.+?),/, (match, p1) => {\n      const x = toLeft ? -rect.width : windowW;\n      // const x = toLeft ? -(rect.right + (rect.width / 2)) : windowW / 2;\n\n      return match.replace(p1, x + 'px');\n    });\n\n    // //////this.log('set newTransform:', newTransform, mover.style.transform, toLeft);\n    mover.style.transform = newTransform;\n\n    setTimeout(() => {\n      mover.remove();\n    }, 350);\n  }\n\n  protected setNewMover() {\n    const newMover = document.createElement('div');\n    newMover.classList.add('media-viewer-mover');\n    newMover.style.display = 'none';\n\n    if(this.content.mover) {\n      const oldMover = this.content.mover;\n      oldMover.parentElement.append(newMover);\n    } else {\n      this.moversContainer.append(newMover);\n    }\n\n    return this.content.mover = newMover;\n  }\n\n  protected updateMediaSource(target: HTMLElement, url: string, tagName: 'video' | 'img') {\n    // if(target instanceof SVGSVGElement) {\n    const el = target.tagName.toLowerCase() === tagName ? target : target.querySelector(tagName) as HTMLElement;\n    if(el && !findUpClassName(target, 'document')) {\n      if(findUpClassName(target, 'attachment')) {\n        // two parentElements because element can be contained in aspecter\n        const preloader = target.parentElement.parentElement.querySelector('.preloader-container') as HTMLElement;\n        if(preloader) {\n          if(tagName === 'video') {\n            if(preloader.classList.contains('manual')) {\n              preloader.click();\n              // return;\n            }\n\n            return;\n          }\n\n          preloader.remove();\n        }\n      }\n\n      if((el as HTMLImageElement).src !== url) {\n        renderImageFromUrl(el, url);\n      }\n\n      // ! ,       \n      if(el.classList.contains('thumbnail') && el.parentElement.classList.contains('media-container-aspecter')) {\n        el.classList.remove('thumbnail');\n      }\n    }\n    /* } else {\n\n    } */\n  }\n\n  protected setAuthorInfo(fromId: PeerId | string, timestamp: number) {\n    const isPeerId = fromId.isPeerId();\n    let wrapTitlePromise: Promise<HTMLElement> | HTMLElement;\n    if(isPeerId) {\n      wrapTitlePromise = wrapPeerTitle({\n        peerId: fromId as PeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      })\n    } else {\n      const title = wrapTitlePromise = document.createElement('span');\n      title.append(wrapEmojiText(fromId));\n      title.classList.add('peer-title');\n    }\n\n    const oldAvatar = this.author.avatarEl;\n    const newAvatar = this.author.avatarEl = (oldAvatar.cloneNode() as AvatarElement);\n\n    return Promise.all([\n      (this.author.avatarEl as AvatarElement).updateWithOptions({\n        peerId: fromId as PeerId || NULL_PEER_ID,\n        peerTitle: isPeerId ? undefined : '' + fromId\n      }),\n\n      wrapTitlePromise\n    ]).then(([_, title]) => {\n      if(this.author.avatarEl !== newAvatar) {\n        return;\n      }\n\n      replaceContent(this.author.date, formatFullSentTime(timestamp));\n      replaceContent(this.author.nameEl, title);\n      oldAvatar.replaceWith(this.author.avatarEl);\n    });\n  }\n\n  protected async _openMedia(\n    media: MyDocument | MyPhoto,\n    timestamp: number,\n    fromId: PeerId | string,\n    fromRight: number,\n    target?: HTMLElement,\n    reverse = false,\n    prevTargets: TargetType[] = [],\n    nextTargets: TargetType[] = [],\n    message?: MyMessage\n    /* , needLoadMore = true */\n  ) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    /* if(DEBUG) {\n      this.log('openMedia:', media, fromId, prevTargets, nextTargets);\n    } */\n\n    const setAuthorPromise = this.setAuthorInfo(fromId, timestamp);\n\n    const isDocument = media._ === 'document';\n    const isVideo = isDocument && media.mime_type && ((['video', 'gif'] as MyDocument['type'][]).includes(media.type) || media.mime_type.indexOf('video/') === 0);\n\n    if(this.isFirstOpen) {\n      // this.targetContainer = targetContainer;\n      // this.needLoadMore = needLoadMore;\n      this.isFirstOpen = false;\n      this.listLoader.setTargets(prevTargets, nextTargets, reverse);\n      (window as any).appMediaViewer = this;\n      // this.loadMore = loadMore;\n\n      /* if(appSidebarRight.historyTabIDs.slice(-1)[0] === AppSidebarRight.SLIDERITEMSIDS.forward) {\n        appSidebarRight.forwardTab.closeBtn.click();\n        await new Promise((resolve) => setTimeout(resolve, 200));\n      } */\n    }\n\n    if(this.listLoader.next.length < 10) {\n      setTimeout(() => {\n        this.listLoader.load(true);\n      }, 0);\n    }\n\n    // if(prevTarget && (!prevTarget.parentElement || !this.isElementVisible(this.targetContainer, prevTarget))) prevTarget = null;\n    // if(nextTarget && (!nextTarget.parentElement || !this.isElementVisible(this.targetContainer, nextTarget))) nextTarget = null;\n\n    this.buttons.prev.classList.toggle('hide', !this.listLoader.previous.length);\n    this.buttons.next.classList.toggle('hide', !this.listLoader.next.length);\n\n    const container = this.content.media;\n    const useContainerAsTarget = !target || target === container;\n    if(useContainerAsTarget) target = container;\n\n    this.target = {element: target} as any;\n    const tempId = ++this.tempId;\n\n    if(container.firstElementChild) {\n      container.innerHTML = '';\n    }\n\n    // ok set\n\n    const wasActive = fromRight !== 0;\n    if(wasActive) {\n      this.moveTheMover(this.content.mover, fromRight === 1);\n      this.setNewMover();\n    } else {\n      this.toggleOverlay(true);\n      this.setGlobalListeners();\n      await setAuthorPromise;\n\n      if(!this.wholeDiv.parentElement) {\n        this.pageEl.insertBefore(this.wholeDiv, document.getElementById('main-columns'));\n        void this.wholeDiv.offsetLeft; // reflow\n      }\n\n      this.toggleWholeActive(true);\n\n      if(!IS_MOBILE_SAFARI) {\n        this.navigationItem = {\n          type: 'media',\n          onPop: (canAnimate) => {\n            if(this.setMoverAnimationPromise) {\n              return false;\n            }\n\n            this.close();\n          }\n        };\n\n        appNavigationController.pushItem(this.navigationItem);\n      }\n    }\n\n    // //////this.log('wasActive:', wasActive);\n\n    const mover = this.content.mover;\n\n    const maxWidth = windowSize.width;\n    // const maxWidth = this.pageEl.scrollWidth;\n    // TODO: const maxHeight = mediaSizes.isMobile ? appPhotosManager.windowH : appPhotosManager.windowH - 100;\n    let padding = 0;\n    const windowH = windowSize.height;\n    if(windowH < 1000000 && !mediaSizes.isMobile) {\n      padding = 120;\n    }\n    const maxHeight = windowH - 120 - padding;\n    let thumbPromise: Promise<any> = Promise.resolve();\n    const size = setAttachmentSize(media, container, maxWidth, maxHeight, mediaSizes.isMobile ? false : true, undefined, !!(isDocument && media.w && media.h)).photoSize;\n    if(useContainerAsTarget) {\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(media, size.type);\n      let img: HTMLImageElement | HTMLCanvasElement;\n      if(cacheContext.downloaded) {\n        img = new Image();\n        img.src = cacheContext.url;\n      } else {\n        const gotThumb = getStrippedThumbIfNeeded(media, cacheContext, true);\n        if(gotThumb) {\n          thumbPromise = gotThumb.loadPromise;\n          img = gotThumb.image;\n        }\n      }\n\n      if(img) {\n        img.classList.add('thumbnail');\n        container.append(img);\n      }\n    }\n\n    // need after setAttachmentSize\n    /* if(useContainerAsTarget) {\n      target = target.querySelector('img, video') || target;\n    } */\n\n    const supportsStreaming: boolean = !!(isDocument && media.supportsStreaming);\n    const preloader = supportsStreaming ? this.preloaderStreamable : this.preloader;\n\n    const getCacheContext = () => {\n      return this.managers.thumbsStorage.getCacheContext(media, size?.type);\n    };\n\n    let setMoverPromise: Promise<void>;\n    if(isVideo) {\n      // //////this.log('will wrap video', media, size);\n\n      //    safari     event'\n      // const video = document.createElement('video');\n      const useController = message && media.type !== 'gif';\n      const video = /* useController ?\n        appMediaPlaybackController.addMedia(message, false, true) as HTMLVideoElement :\n         */createVideo({pip: useController});\n\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n        // const video = mover.querySelector('video') || document.createElement('video');\n\n        const moverVideo = mover.querySelector('video');\n        if(moverVideo) {\n          moverVideo.remove();\n        }\n\n        // video.src = '';\n\n        video.setAttribute('playsinline', 'true');\n\n        // * fix for playing video if viewer is closed (https://contest.com/javascript-web-bonus/entry1425#issue11629)\n        video.addEventListener('timeupdate', () => {\n          if(this.tempId !== tempId) {\n            video.pause();\n          }\n        });\n\n        this.addEventListener('setMoverAfter', () => {\n          video.src = '';\n          video.load();\n        }, {once: true});\n\n        if(IS_SAFARI) {\n          // test stream\n          // video.controls = true;\n          video.autoplay = true;\n        }\n\n        if(media.type === 'gif') {\n          video.muted = true;\n          video.autoplay = true;\n          video.loop = true;\n        } else if(media.duration < 60) {\n          video.loop = true;\n        }\n\n        // if(!video.parentElement) {\n        div.append(video);\n        // }\n\n        const canPlayThrough = new Promise((resolve) => {\n          video.addEventListener('canplay', resolve, {once: true});\n        });\n\n        const createPlayer = () => {\n          if(media.type !== 'gif') {\n            video.dataset.ckin = 'default';\n            video.dataset.overlay = '1';\n\n            Promise.all([canPlayThrough, onAnimationEnd]).then(() => {\n              if(this.tempId !== tempId) {\n                return;\n              }\n\n              // const play = useController ? appMediaPlaybackController.willBePlayedMedia === video : true;\n              const play = true;\n              const player = this.videoPlayer = new VideoPlayer({\n                video,\n                play,\n                streamable: supportsStreaming,\n                onPlaybackRackMenuToggle: (open) => {\n                  this.wholeDiv.classList.toggle('hide-caption', !!open);\n                },\n                onPip: (pip) => {\n                  const otherMediaViewer = (window as any).appMediaViewer;\n                  if(!pip && otherMediaViewer && otherMediaViewer !== this) {\n                    this.releaseSingleMedia = undefined;\n                    this.close();\n                    return;\n                  }\n\n                  const mover = this.moversContainer.lastElementChild as HTMLElement;\n                  mover.classList.toggle('hiding', pip);\n                  this.toggleWholeActive(!pip);\n                  this.toggleOverlay(!pip);\n                  this.toggleGlobalListeners(!pip);\n\n                  if(this.navigationItem) {\n                    if(pip) appNavigationController.removeItem(this.navigationItem);\n                    else appNavigationController.pushItem(this.navigationItem);\n                  }\n\n                  if(useController) {\n                    if(pip) {\n                      // appMediaPlaybackController.toggleSwitchers(true);\n\n                      this.releaseSingleMedia(false);\n                      this.releaseSingleMedia = undefined;\n\n                      appMediaPlaybackController.setPictureInPicture(video);\n                    } else {\n                      this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n                    }\n                  }\n                },\n                onPipClose: () => {\n                  // this.target = undefined;\n                  // this.toggleWholeActive(false);\n                  // this.toggleOverlay(false);\n                  this.close();\n                }\n              });\n              player.addEventListener('toggleControls', (show) => {\n                this.wholeDiv.classList.toggle('has-video-controls', show);\n              });\n\n              this.addEventListener('setMoverBefore', () => {\n                this.wholeDiv.classList.remove('has-video-controls');\n                this.videoPlayer.cleanup();\n                this.videoPlayer = undefined;\n              }, {once: true});\n\n              if(this.isZooming()) {\n                this.videoPlayer.lockControls(false);\n              }\n              /* div.append(video);\n              mover.append(player.wrapper); */\n            });\n          }\n        };\n\n        if(supportsStreaming) {\n          onAnimationEnd.then(() => {\n            if(video.readyState < video.HAVE_FUTURE_DATA) {\n              // console.log('ppp 1');\n              preloader.attach(mover, true);\n            }\n\n            /* canPlayThrough.then(() => {\n              preloader.detach();\n            }); */\n          });\n\n          const attachCanPlay = () => {\n            video.addEventListener('canplay', () => {\n              // console.log('ppp 2');\n              preloader.detach();\n              video.parentElement.classList.remove('is-buffering');\n            }, {once: true});\n          };\n\n          video.addEventListener('waiting', () => {\n            const loading = video.networkState === video.NETWORK_LOADING;\n            const isntEnoughData = video.readyState < video.HAVE_FUTURE_DATA;\n\n            // this.log('video waiting for progress', loading, isntEnoughData);\n            if(loading && isntEnoughData) {\n              attachCanPlay();\n\n              // console.log('ppp 3');\n              preloader.attach(mover, true);\n\n              //    ,        \n              video.parentElement.classList.add('is-buffering');\n            }\n          });\n\n          if(this.wholeDiv.classList.contains('no-forwards')) {\n            video.addEventListener('contextmenu', (e) => {\n              cancelEvent(e);\n            });\n          }\n\n          attachCanPlay();\n        }\n\n        // if(!video.src || media.url !== video.src) {\n        const load = async() => {\n          /* if(useController) {\n              appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n            } */\n\n          const promise: Promise<any> = supportsStreaming ? Promise.resolve() : appDownloadManager.downloadMediaURL({media});\n\n          if(!supportsStreaming) {\n            onAnimationEnd.then(async() => {\n              if(!(await getCacheContext()).url) {\n                // console.log('ppp 4');\n                preloader.attach(mover, true, promise);\n              }\n            });\n          }\n\n          Promise.all([promise, onAnimationEnd]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed video');\n              return;\n            }\n\n            const url = (await getCacheContext()).url;\n\n            video.addEventListener('error', () => {\n              if(video.error.code !== 4) {\n                this.log.error('Error ' + video.error.code + '; details: ' + video.error.message);\n              }\n\n              if(preloader) {\n                preloader.detach();\n              }\n            }, {once: true});\n\n            if(target instanceof SVGSVGElement/*  && (video.parentElement || !isSafari) */) { // if video exists\n              // if(!video.parentElement) {\n              div.firstElementChild.lastElementChild.append(video);\n              // }\n            } else {\n              renderImageFromUrl(video, url);\n            }\n\n            // * have to set options (especially playbackRate) after src\n            // * https://github.com/videojs/video.js/issues/2516\n            if(useController) {\n              this.releaseSingleMedia = appMediaPlaybackController.setSingleMedia(video, message as Message.message);\n\n              this.addEventListener('setMoverBefore', () => {\n                if(this.releaseSingleMedia) {\n                  this.releaseSingleMedia();\n                  this.releaseSingleMedia = undefined;\n                }\n              }, {once: true});\n            }\n\n            this.updateMediaSource(target, url, 'video');\n\n            createPlayer();\n          });\n\n          return promise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n        // } else createPlayer();\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    } else {\n      const set = () => this.setMoverToTarget(target, false, fromRight).then(({onAnimationEnd}) => {\n      // return; // set and don't move\n      // if(wasActive) return;\n        // return;\n\n        const load = async() => {\n          const cancellablePromise = isDocument ? appDownloadManager.downloadMediaURL({media}) : appDownloadManager.downloadMediaURL({media, thumb: size});\n\n          onAnimationEnd.then(async() => {\n            if(!(await getCacheContext()).url) {\n              this.preloader.attachPromise(cancellablePromise);\n              // this.preloader.attach(mover, true, cancellablePromise);\n            }\n          });\n\n          Promise.all([onAnimationEnd, cancellablePromise]).then(async() => {\n            if(this.tempId !== tempId) {\n              this.log.warn('media viewer changed photo');\n              return;\n            }\n\n            // /////this.log('indochina', blob);\n\n            const url = (await getCacheContext()).url;\n            if(target instanceof SVGSVGElement) {\n              this.updateMediaSource(target, url, 'img');\n              this.updateMediaSource(mover, url, 'img');\n\n              if(mediaSizes.isMobile) {\n                const imgs = mover.querySelectorAll('img');\n                if(imgs && imgs.length) {\n                  imgs.forEach((img) => {\n                    img.classList.remove('thumbnail'); //      \n                  });\n                }\n              }\n            } else {\n              const div = mover.firstElementChild && mover.firstElementChild.classList.contains('media-viewer-aspecter') ? mover.firstElementChild : mover;\n              const haveImage = div.firstElementChild?.tagName === 'IMG' ? div.firstElementChild as HTMLImageElement : null;\n              if(!haveImage || haveImage.src !== url)  {\n                const image = new Image();\n                image.classList.add('thumbnail');\n\n                // this.log('will renderImageFromUrl:', image, div, target);\n\n                renderImageFromUrl(image, url, () => {\n                  this.updateMediaSource(target, url, 'img');\n\n                  if(haveImage) {\n                    fastRaf(() => {\n                      haveImage.remove();\n                    });\n                  }\n\n                  div.append(image);\n                });\n              }\n            }\n\n            // this.preloader.detach();\n          }).catch((err) => {\n            this.log.error(err);\n            this.preloader.attach(mover);\n            this.preloader.setManual();\n          });\n\n          return cancellablePromise;\n        };\n\n        this.lazyLoadQueue.unshift({load});\n      });\n\n      setMoverPromise = thumbPromise.then(set);\n    }\n\n    return this.setMoverPromise = setMoverPromise.catch(() => {\n      this.setMoverAnimationPromise = null;\n    }).finally(() => {\n      this.setMoverPromise = null;\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function fillPropertyValue(str: string) {\r\n  const splitted = str.split(' ');\r\n  if(splitted.length !== 4) {\r\n    if(!splitted[0]) splitted[0] = '0px';\r\n    for(let i = splitted.length; i < 4; ++i) {\r\n      splitted[i] = splitted[i % 2] || splitted[0] || '0px';\r\n    }\r\n  }\r\n\r\n  return splitted;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\r\nimport {logger} from '../lib/logger';\r\nimport blurActiveElement from '../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport isSwipingBackSafari from '../helpers/dom/isSwipingBackSafari';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\n\r\nexport type NavigationItem = {\r\n  type: 'left' | 'right' | 'im' | 'chat' | 'popup' | 'media' | 'menu' |\r\n    'esg' | 'multiselect' | 'input-helper' | 'autocomplete-helper' | 'markup' |\r\n    'global-search' | 'voice' | 'mobile-search' | 'filters' | 'global-search-focus' |\r\n    'toast',\r\n  onPop: (canAnimate: boolean) => boolean | void,\r\n  onEscape?: () => boolean,\r\n  noHistory?: boolean,\r\n  noBlurOnPop?: boolean,\r\n};\r\n\r\nexport class AppNavigationController {\r\n  private navigations: Array<NavigationItem>;\r\n  private id: number;\r\n  private manual: boolean;\r\n  private log: ReturnType<typeof logger>;\r\n  private debug: boolean;\r\n  private currentHash: string; // have to start with # if not empty\r\n  private overriddenHash: string; // have to start with # if not empty\r\n  private isPossibleSwipe: boolean;\r\n  public onHashChange: () => void;\r\n\r\n  constructor() {\r\n    this.navigations = [];\r\n    this.id = Date.now();\r\n    this.manual = false;\r\n    this.log = logger('NC');\r\n    this.debug = true;\r\n    this.currentHash = window.location.hash;\r\n    this.overriddenHash = '';\r\n    this.isPossibleSwipe = false;\r\n\r\n    window.addEventListener('popstate', this.onPopState);\r\n    window.addEventListener('keydown', this.onKeyDown, {capture: true, passive: false});\r\n\r\n    if(IS_MOBILE_SAFARI) {\r\n      const options = {passive: true};\r\n      window.addEventListener('touchstart', this.onTouchStart, options);\r\n    }\r\n\r\n    history.scrollRestoration = 'manual';\r\n\r\n    this.pushState(); // * push init state\r\n  }\r\n\r\n  private onPopState = (e: PopStateEvent) => {\r\n    const hash = window.location.hash;\r\n    const id: number = e.state;\r\n    this.debug && this.log('popstate', e, this.isPossibleSwipe, hash);\r\n    if(hash !== this.currentHash) {\r\n      this.debug && this.log.warn(`hash changed, new=${hash}, current=${this.currentHash}, overridden=${this.overriddenHash}`);\r\n      // fix for returning to wrong hash (e.g. chat -> archive -> chat -> 3x back)\r\n      if(id === this.id && this.overriddenHash && this.overriddenHash !== hash) {\r\n        this.overrideHash(this.overriddenHash);\r\n      } else if(id/*  === this.id */ && !this.overriddenHash && hash) {\r\n        this.overrideHash();\r\n      } else {\r\n        this.currentHash = hash;\r\n        this.onHashChange && this.onHashChange();\r\n        // this.replaceState();\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(id !== this.id/*  && !this.navigations.length */) {\r\n      this.pushState();\r\n\r\n      if(!this.navigations.length) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    const item = this.navigations.pop();\r\n    if(!item) {\r\n      this.pushState();\r\n      return;\r\n    }\r\n\r\n    this.manual = !this.isPossibleSwipe;\r\n    this.handleItem(item);\r\n    // this.pushState(); // * prevent adding forward arrow\r\n  };\r\n\r\n  private onKeyDown = (e: KeyboardEvent) => {\r\n    const item = this.navigations[this.navigations.length - 1];\r\n    if(!item) return;\r\n    if(e.key === 'Escape' && (item.onEscape ? item.onEscape() : true)) {\r\n      cancelEvent(e);\r\n      this.back(item.type);\r\n    }\r\n  };\r\n\r\n  private onTouchStart = (e: TouchEvent) => {\r\n    if(e.touches.length > 1) return;\r\n    this.debug && this.log('touchstart');\r\n\r\n    if(isSwipingBackSafari(e)) {\r\n      this.isPossibleSwipe = true;\r\n\r\n      window.addEventListener('touchend', () => {\r\n        setTimeout(() => {\r\n          this.isPossibleSwipe = false;\r\n        }, 100);\r\n      }, {passive: true, once: true});\r\n    }\r\n\r\n    /* const detach = () => {\r\n      window.removeEventListener('touchend', onTouchEnd);\r\n      window.removeEventListener('touchmove', onTouchMove);\r\n    };\r\n\r\n    let moved = false;\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      this.debug && this.log('touchmove');\r\n      if(e.touches.length > 1) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      moved = true;\r\n    };\r\n\r\n    const onTouchEnd = (e: TouchEvent) => {\r\n      this.debug && this.log('touchend');\r\n      if(e.touches.length > 1 || !moved) {\r\n        detach();\r\n        return;\r\n      }\r\n\r\n      isPossibleSwipe = true;\r\n      doubleRaf().then(() => {\r\n        isPossibleSwipe = false;\r\n      });\r\n\r\n      detach();\r\n    };\r\n\r\n    window.addEventListener('touchend', onTouchEnd, options);\r\n    window.addEventListener('touchmove', onTouchMove, options); */\r\n  };\r\n\r\n  public overrideHash(hash: string = '') {\r\n    if(hash && hash[0] !== '#') hash = '#' + hash;\r\n    else if(hash === '#') hash = '';\r\n\r\n    this.overriddenHash = this.currentHash = hash;\r\n    this.replaceState();\r\n    this.pushState();\r\n  }\r\n\r\n  private handleItem(item: NavigationItem) {\r\n    const good = item.onPop(!this.manual ? false : undefined);\r\n    this.debug && this.log('popstate, navigation:', item, this.navigations);\r\n    if(good === false) {\r\n      this.pushItem(item);\r\n    } else if(!item.noBlurOnPop) {\r\n      blurActiveElement(); // no better place for it\r\n    }\r\n\r\n    this.manual = false;\r\n  }\r\n\r\n  public findItemByType(type: NavigationItem['type']) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        return {item, index: i};\r\n      }\r\n    }\r\n  }\r\n\r\n  public back(type?: NavigationItem['type']) {\r\n    if(type) {\r\n      const ret = this.findItemByType(type);\r\n      if(ret) {\r\n        this.backByItem(ret.item, ret.index);\r\n        return;\r\n      }\r\n    }\r\n\r\n    history.back();\r\n  }\r\n\r\n  public backByItem(item: NavigationItem, index = this.navigations.indexOf(item)) {\r\n    this.manual = true;\r\n    // ! commented because 'popstate' event will be fired with delay\r\n    // if(index !== (this.navigations.length - 1)) {\r\n    this.navigations.splice(index, 1);\r\n    this.handleItem(item);\r\n    // }\r\n  }\r\n\r\n  private onItemAdded(item: NavigationItem) {\r\n    this.debug && this.log('onItemAdded', item, this.navigations);\r\n\r\n    if(!item.noHistory) {\r\n      this.pushState();\r\n    }\r\n  }\r\n\r\n  public pushItem(item: NavigationItem) {\r\n    this.navigations.push(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public unshiftItem(item: NavigationItem) {\r\n    this.navigations.unshift(item);\r\n    this.onItemAdded(item);\r\n  }\r\n\r\n  public spliceItems(index: number, length: number, ...items: NavigationItem[]) {\r\n    this.navigations.splice(index, length, ...items);\r\n    items.forEach((item) => {\r\n      this.onItemAdded(item);\r\n    });\r\n  }\r\n\r\n  private pushState() {\r\n    this.debug && this.log('push');\r\n    this.manual = false;\r\n    history.pushState(this.id, '');\r\n  }\r\n\r\n  public replaceState() {\r\n    this.debug && this.log.warn('replace');\r\n\r\n    const url = location.origin + location.pathname + location.search + this.overriddenHash;\r\n    history.replaceState(this.id, '', url);\r\n  }\r\n\r\n  public removeItem(item: NavigationItem) {\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    indexOfAndSplice(this.navigations, item);\r\n  }\r\n\r\n  public removeByType(type: NavigationItem['type'], single = false) {\r\n    for(let i = this.navigations.length - 1; i >= 0; --i) {\r\n      const item = this.navigations[i];\r\n      if(item.type === type) {\r\n        this.navigations.splice(i, 1);\r\n\r\n        if(single) {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nconst appNavigationController = new AppNavigationController();\r\nMOUNT_CLASS_TO.appNavigationController = appNavigationController;\r\nexport default appNavigationController;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\r\nimport Scrollable from './scrollable';\r\nimport InputSearch from './inputSearch';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport class SearchGroup {\r\n  container: HTMLDivElement;\r\n  nameEl: HTMLDivElement;\r\n  list: HTMLUListElement;\r\n\r\n  constructor(\r\n    public name: LangPackKey | boolean,\r\n    public type: string,\r\n    private clearable = true,\r\n    className?: string,\r\n    clickable = true,\r\n    public autonomous = true,\r\n    public onFound?: () => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.list = appDialogsManager.createChatList();\r\n    this.container = document.createElement('div');\r\n    if(className) this.container.className = className;\r\n\r\n    if(name) {\r\n      this.nameEl = document.createElement('div');\r\n      this.nameEl.classList.add('search-group__name');\r\n      if(typeof(name) === 'string') {\r\n        this.nameEl.append(i18n(name));\r\n      }\r\n      this.container.append(this.nameEl);\r\n    }\r\n\r\n    this.container.classList.add('search-group', 'search-group-' + type);\r\n    this.container.append(this.list);\r\n    this.container.style.display = 'none';\r\n\r\n    if(clickable) {\r\n      appDialogsManager.setListClickListener(this.list, onFound, undefined, autonomous);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    this.container.style.display = 'none';\r\n\r\n    if(this.clearable) {\r\n      this.list.innerHTML = '';\r\n    }\r\n  }\r\n\r\n  setActive() {\r\n    this.container.style.display = '';\r\n  }\r\n\r\n  toggle() {\r\n    if(this.list.childElementCount) {\r\n      this.setActive();\r\n    } else {\r\n      this.clear();\r\n    }\r\n  }\r\n}\r\n\r\nexport type SearchGroupType = 'contacts' | 'globalContacts' | 'messages' | string;\r\n\r\nexport default class AppSearch {\r\n  private minMsgId = 0;\r\n  private loadedCount = -1;\r\n  private foundCount = -1;\r\n\r\n  private searchPromise: Promise<void> = null;\r\n  private searchTimeout: number = 0;\r\n\r\n  private query = '';\r\n\r\n  private listsContainer: HTMLDivElement = null;\r\n\r\n  private peerId: PeerId; // 0 - means global\r\n  private threadId = 0;\r\n\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    public container: HTMLElement,\r\n    public searchInput: InputSearch,\r\n    public searchGroups: {[group in SearchGroupType]: SearchGroup},\r\n    public onSearch?: (count: number) => void,\r\n    public noIcons?: boolean\r\n  ) {\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.listsContainer = this.scrollable.container as HTMLDivElement;\r\n    for(const i in this.searchGroups) {\r\n      this.listsContainer.append(this.searchGroups[i as SearchGroupType].container);\r\n    }\r\n\r\n    if(this.searchGroups.messages) {\r\n      this.scrollable.setVirtualContainer(this.searchGroups.messages.list);\r\n    }\r\n\r\n    this.searchInput.onChange = (value) => {\r\n      /* if(!value.trim()) {\r\n        //this.peerId = 0;\r\n        return;\r\n      } */\r\n\r\n      this.query = value;\r\n      this.reset(false);\r\n      this.searchMore();\r\n    };\r\n\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(!this.query.trim()) return;\r\n\r\n      if(!this.searchTimeout) {\r\n        this.searchTimeout = window.setTimeout(() => {\r\n          this.searchMore();\r\n          this.searchTimeout = 0;\r\n        }, 0);\r\n      }\r\n    };\r\n  }\r\n\r\n  public reset(all = true) {\r\n    if(all) {\r\n      this.searchInput.value = '';\r\n      this.query = '';\r\n      this.peerId = undefined;\r\n      this.threadId = 0;\r\n    }\r\n\r\n    this.minMsgId = 0;\r\n    this.loadedCount = -1;\r\n    this.foundCount = -1;\r\n\r\n    for(const i in this.searchGroups) {\r\n      this.searchGroups[i as SearchGroupType].clear();\r\n    }\r\n\r\n    this.searchPromise = null;\r\n  }\r\n\r\n  public beginSearch(peerId?: PeerId, threadId = 0, query = '') {\r\n    this.peerId = peerId;\r\n    this.threadId = threadId;\r\n\r\n    if(this.query !== query) {\r\n      this.searchInput.inputField.value = query;\r\n    }\r\n\r\n    this.searchInput.input.focus();\r\n  }\r\n\r\n  public searchMore() {\r\n    if(this.searchPromise) return this.searchPromise;\r\n\r\n    const query = this.query;\r\n\r\n    if(!query.trim()) {\r\n      this.onSearch && this.onSearch(0);\r\n      return;\r\n    }\r\n\r\n    if(this.foundCount !== -1 && this.loadedCount >= this.foundCount) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    const maxId = this.minMsgId || 0;\r\n\r\n    return this.searchPromise = rootScope.managers.appMessagesManager.getSearch({\r\n      peerId: this.peerId,\r\n      query,\r\n      inputFilter: {_: 'inputMessagesFilterEmpty'},\r\n      maxId,\r\n      limit: 20,\r\n      threadId: this.threadId\r\n    }).then((res) => {\r\n      this.searchPromise = null;\r\n\r\n      if(this.searchInput.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('input search result:', this.peerId, query, null, maxId, 20, res);\r\n\r\n      const {count, history} = res;\r\n\r\n      if(history.length && history[0].mid === this.minMsgId) {\r\n        history.shift();\r\n      }\r\n\r\n      const searchGroup = this.searchGroups.messages;\r\n\r\n      history.forEach((message) => {\r\n        try {\r\n          const peerId = this.peerId ? message.fromId : message.peerId;\r\n          appDialogsManager.addDialogAndSetLastMessage({\r\n            peerId,\r\n            container: this.scrollable/* searchGroup.list */,\r\n            avatarSize: 54,\r\n            meAsSaved: false,\r\n            message,\r\n            query,\r\n            noIcons: this.noIcons\r\n          });\r\n        } catch(err) {\r\n          console.error('[appSearch] render search result', err);\r\n        }\r\n      });\r\n\r\n      searchGroup.toggle();\r\n\r\n      this.minMsgId = history.length && history[history.length - 1].mid;\r\n\r\n      if(this.loadedCount === -1) {\r\n        this.loadedCount = 0;\r\n      }\r\n      this.loadedCount += history.length;\r\n\r\n      if(this.foundCount === -1) {\r\n        this.foundCount = count;\r\n\r\n        if(searchGroup.nameEl) {\r\n          replaceContent(searchGroup.nameEl, i18n(count ? 'Chat.Search.MessagesFound' : 'Chat.Search.NoMessagesFound', [count]));\r\n        }\r\n\r\n        this.onSearch && this.onSearch(this.foundCount);\r\n      }\r\n    }).catch((err) => {\r\n      console.error('search error', err);\r\n      this.searchPromise = null;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {MyInputMessagesFilter, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {logger} from '../lib/logger';\nimport rootScope from '../lib/rootScope';\nimport {SearchGroup, SearchGroupType} from './appSearch';\nimport {horizontalMenu} from './horizontalMenu';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport {putPreloader} from './putPreloader';\nimport ripple from './ripple';\nimport Scrollable, {ScrollableX} from './scrollable';\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport I18n, {LangPackKey, i18n} from '../lib/langPack';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {getMiddleware, Middleware} from '../helpers/middleware';\nimport {ChannelParticipant, ChatFull, ChatParticipant, ChatParticipants, Document, Message, MessageMedia, Photo, WebPage} from '../layer';\nimport SortedUserList from './sortedUserList';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport appSidebarRight from './sidebarRight';\nimport mediaSizes from '../helpers/mediaSizes';\nimport appImManager from '../lib/appManagers/appImManager';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport cleanSearchText from '../helpers/cleanSearchText';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport handleTabSwipe from '../helpers/dom/handleTabSwipe';\nimport windowSize from '../helpers/windowSize';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupForward from './popups/forward';\nimport PopupDeleteMessages from './popups/deleteMessages';\nimport Row from './row';\nimport htmlToDocumentFragment from '../helpers/dom/htmlToDocumentFragment';\nimport {SearchSelection} from './chat/selection';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport AppMediaViewer from './appMediaViewer';\nimport lockTouchScroll from '../helpers/dom/lockTouchScroll';\nimport copy from '../helpers/object/copy';\nimport getObjectKeysAndSort from '../helpers/object/getObjectKeysAndSort';\nimport safeAssign from '../helpers/object/safeAssign';\nimport escapeRegExp from '../helpers/string/escapeRegExp';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport {ScrollStartCallbackDimensions} from '../helpers/fastSmoothScroll';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport wrapWebPageDescription from './wrappers/webPageDescription';\nimport wrapWebPageTitle from './wrappers/webPageTitle';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport matchUrl from '../lib/richTextProcessor/matchUrl';\nimport wrapPlainText from '../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport filterMessagesByInputFilter from '../lib/appManagers/utils/messages/filterMessagesByInputFilter';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport {Awaited} from '../types';\nimport {attachContextMenuListener} from '../helpers/dom/attachContextMenuListener';\nimport contextMenuController from '../helpers/contextMenuController';\nimport positionMenu from '../helpers/positionMenu';\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport SwipeHandler from './swipeHandler';\nimport wrapDocument from './wrappers/document';\nimport wrapPhoto from './wrappers/photo';\nimport wrapVideo from './wrappers/video';\n\n// const testScroll = false;\n\nexport type SearchSuperType = MyInputMessagesFilter/*  | 'members' */;\nexport type SearchSuperContext = {\n  peerId: PeerId,\n  inputFilter: {_: MyInputMessagesFilter},\n  query?: string,\n  maxId?: number,\n  folderId?: number,\n  threadId?: number,\n  date?: number,\n  nextRate?: number,\n  minDate?: number,\n  maxDate?: number\n};\n\nexport type SearchSuperMediaType = 'members' | 'media' | 'files' | 'links' | 'music' | 'chats' | 'voice';\nexport type SearchSuperMediaTab = {\n  inputFilter: SearchSuperType,\n  name: LangPackKey,\n  type: SearchSuperMediaType,\n  contentTab?: HTMLElement,\n  menuTab?: HTMLElement,\n  scroll?: {scrollTop: number, scrollHeight: number}\n};\n\nclass SearchContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>, withSelection?: true})[];\n  private element: HTMLElement;\n  private target: HTMLElement;\n  private peerId: PeerId;\n  private mid: number;\n  private isSelected: boolean;\n  private managers: AppManagers;\n\n  constructor(\n    private attachTo: HTMLElement,\n    private searchSuper: AppSearchSuper,\n    private listenerSetter: ListenerSetter\n  ) {\n    this.managers = searchSuper.managers;\n\n    const onContextMenu = (e: MouseEvent) => {\n      if(this.init) {\n        this.init();\n        this.init = null;\n      }\n\n      let item: HTMLElement;\n      try {\n        item = findUpClassName(e.target, 'search-super-item');\n      } catch(e) {}\n\n      if(!item) return;\n\n      if(e instanceof MouseEvent) e.preventDefault();\n      if(this.element.classList.contains('active')) {\n        return false;\n      }\n      if(e instanceof MouseEvent) e.cancelBubble = true;\n\n      const r = async() => {\n        this.target = item;\n        this.peerId = item.dataset.peerId.toPeerId();\n        this.mid = +item.dataset.mid;\n        this.isSelected = searchSuper.selection.isMidSelected(this.peerId, this.mid);\n\n        await Promise.all(this.buttons.map(async(button) => {\n          let good: boolean;\n\n          if(this.isSelected && !button.withSelection) {\n            good = false;\n          } else {\n            good = button.verify ? await button.verify() : true;\n          }\n\n          button.element.classList.toggle('hide', !good);\n        }));\n\n        item.classList.add('menu-open');\n\n        positionMenu(e, this.element);\n        contextMenuController.openBtnMenu(this.element, () => {\n          item.classList.remove('menu-open');\n        });\n      };\n\n      r();\n    };\n\n    if(IS_TOUCH_SUPPORTED) {\n\n    } else {\n      attachContextMenuListener(attachTo, onContextMenu as any, listenerSetter);\n    }\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'forward',\n      text: 'Forward',\n      onClick: this.onForwardClick,\n      verify: async() => this.managers.appMessagesManager.canForward(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'forward',\n      text: 'Message.Context.Selection.Forward',\n      onClick: this.onForwardClick,\n      verify: () => this.isSelected &&\n        !this.searchSuper.selection.selectionForwardBtn.classList.contains('hide'),\n      withSelection: true\n    }, {\n      icon: 'message',\n      text: 'Message.Context.Goto',\n      onClick: this.onGotoClick,\n      withSelection: true\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Select',\n      onClick: this.onSelectClick\n    }, {\n      icon: 'select',\n      text: 'Message.Context.Selection.Clear',\n      onClick: this.onClearSelectionClick,\n      verify: () => this.isSelected,\n      withSelection: true\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(await this.managers.appMessagesManager.getMessageByPeer(this.peerId, this.mid))\n    }, {\n      icon: 'delete danger',\n      text: 'Message.Context.Selection.Delete',\n      onClick: this.onDeleteClick,\n      verify: () => this.isSelected && !this.searchSuper.selection.selectionDeleteBtn.classList.contains('hide'),\n      withSelection: true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.classList.add('search-contextmenu', 'contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onGotoClick = () => {\n    appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: this.mid,\n      threadId: this.searchSuper.searchContext.threadId\n    });\n  };\n\n  private onForwardClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionForwardBtn);\n    } else {\n      new PopupForward({\n        [this.peerId]: [this.mid]\n      });\n    }\n  };\n\n  private onSelectClick = () => {\n    this.searchSuper.selection.toggleByElement(this.target);\n  };\n\n  private onClearSelectionClick = () => {\n    this.searchSuper.selection.cancelSelection();\n  };\n\n  private onDeleteClick = () => {\n    if(this.searchSuper.selection.isSelecting) {\n      simulateClickEvent(this.searchSuper.selection.selectionDeleteBtn);\n    } else {\n      new PopupDeleteMessages(this.peerId, [this.mid], 'chat');\n    }\n  };\n}\n\nexport type ProcessSearchSuperResult = {\n  message: Message.message,\n  middleware: Middleware,\n  promises: Promise<any>[],\n  elemsToAppend: {element: HTMLElement, message: any}[],\n  inputFilter: MyInputMessagesFilter,\n  searchGroup?: SearchGroup\n};\n\nexport default class AppSearchSuper {\n  public tabs: {[t in SearchSuperType]: HTMLDivElement} = {} as any;\n\n  public mediaTab: SearchSuperMediaTab;\n\n  public container: HTMLElement;\n  public nav: HTMLElement;\n  public navScrollableContainer: HTMLDivElement;\n  public tabsContainer: HTMLElement;\n  public navScrollable: ScrollableX;\n  private tabsMenu: HTMLElement;\n  private prevTabId = -1;\n\n  private lazyLoadQueue = new LazyLoadQueue();\n  public middleware = getMiddleware();\n\n  public historyStorage: Partial<{[type in SearchSuperType]: {mid: number, peerId: PeerId}[]}> = {};\n  public usedFromHistory: Partial<{[type in SearchSuperType]: number}> = {};\n  public urlsToRevoke: string[] = [];\n\n  public searchContext: SearchSuperContext;\n  public loadMutex: Promise<any> = Promise.resolve();\n\n  private nextRates: Partial<{[type in SearchSuperType]: number}> = {};\n  private loadPromises: Partial<{[type in SearchSuperType]: Promise<void>}> = {};\n  private loaded: Partial<{[type in SearchSuperType]: boolean}> = {};\n  private loadedChats = false;\n  private firstLoad = true;\n\n  private log = logger('SEARCH-SUPER');\n  public selectTab: ReturnType<typeof horizontalMenu>;\n\n  private monthContainers: Partial<{\n    [type in SearchSuperType]: {\n      [timestamp: number]: {\n        container: HTMLElement,\n        items: HTMLElement\n      }\n    }\n  }> = {};\n\n  private searchGroupMedia: SearchGroup;\n\n  public mediaTabsMap: Map<SearchSuperMediaType, SearchSuperMediaTab> = new Map();\n\n  private membersList: SortedUserList;\n\n  private skipScroll: boolean;\n\n  // * arguments\n  public mediaTabs: SearchSuperMediaTab[];\n  public scrollable: Scrollable;\n  public searchGroups?: {[group in SearchGroupType]: SearchGroup};\n  public asChatList? = false;\n  public groupByMonth? = true;\n  public hideEmptyTabs? = true;\n  public onChangeTab?: (mediaTab: SearchSuperMediaTab) => void;\n  public showSender? = false;\n\n  private searchContextMenu: SearchContextMenu;\n  public selection: SearchSelection;\n\n  public scrollStartCallback: (dimensions: ScrollStartCallbackDimensions) => void;\n\n  public managers: AppManagers;\n  private loadFirstTimePromise: Promise<void>;\n\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(options: Pick<AppSearchSuper, 'mediaTabs' | 'scrollable' | 'searchGroups' | 'asChatList' | 'groupByMonth' | 'hideEmptyTabs' | 'onChangeTab' | 'showSender' | 'managers'>) {\n    safeAssign(this, options);\n\n    this.container = document.createElement('div');\n    this.container.classList.add('search-super');\n\n    this.listenerSetter = new ListenerSetter();\n    this.searchContextMenu = new SearchContextMenu(this.container, this, this.listenerSetter);\n    this.selection = new SearchSelection(this, this.managers, this.listenerSetter);\n\n    const navScrollableContainer = this.navScrollableContainer = document.createElement('div');\n    navScrollableContainer.classList.add('search-super-tabs-scrollable', 'menu-horizontal-scrollable', 'sticky');\n\n    const navScrollable = this.navScrollable = new ScrollableX(navScrollableContainer);\n    navScrollable.container.classList.add('search-super-nav-scrollable');\n\n    const nav = this.nav = document.createElement('nav');\n    nav.classList.add('search-super-tabs', 'menu-horizontal-div');\n    this.tabsMenu = nav;\n\n    navScrollable.container.append(nav);\n\n    for(const mediaTab of this.mediaTabs) {\n      const menuTab = document.createElement('div');\n      menuTab.classList.add('menu-horizontal-div-item');\n      const span = document.createElement('span');\n      const i = document.createElement('i');\n\n      span.append(i18n(mediaTab.name));\n      span.append(i);\n\n      menuTab.append(span);\n\n      ripple(menuTab);\n\n      this.tabsMenu.append(menuTab);\n\n      this.mediaTabsMap.set(mediaTab.type, mediaTab);\n\n      mediaTab.menuTab = menuTab;\n    }\n\n    this.tabsContainer = document.createElement('div');\n    this.tabsContainer.classList.add('search-super-tabs-container', 'tabs-container');\n\n    let unlockScroll: ReturnType<typeof lockTouchScroll>;\n    if(IS_TOUCH_SUPPORTED) {\n      this.swipeHandler = handleTabSwipe({\n        element: this.tabsContainer,\n        onSwipe: (xDiff, yDiff, e) => {\n          const prevId = this.selectTab.prevId();\n          const children = Array.from(this.tabsMenu.children) as HTMLElement[];\n          let idx: number;\n          if(xDiff > 0) {\n            for(let i = prevId + 1; i < children.length; ++i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          } else {\n            for(let i = prevId - 1; i >= 0; --i) {\n              if(!children[i].classList.contains('hide')) {\n                idx = i;\n                break;\n              }\n            }\n          }\n\n          if(idx !== undefined) {\n            unlockScroll = lockTouchScroll(this.tabsContainer);\n            this.selectTab(idx);\n          }\n        }\n      });\n    }\n\n    for(const mediaTab of this.mediaTabs) {\n      const container = document.createElement('div');\n      container.classList.add('search-super-container-' + mediaTab.type, 'tabs-tab');\n\n      const content = document.createElement('div');\n      content.classList.add('search-super-content-' + mediaTab.type);\n\n      container.append(content);\n\n      this.tabsContainer.append(container);\n\n      this.tabs[mediaTab.inputFilter] = content;\n\n      mediaTab.contentTab = content;\n    }\n\n    this.container.append(navScrollableContainer, this.tabsContainer);\n\n    // * construct end\n\n    this.searchGroupMedia = new SearchGroup(false, 'messages', true);\n\n    this.scrollable.onScrolledBottom = () => {\n      if(this.mediaTab.contentTab && this.canLoadMediaTab(this.mediaTab)/* && false */) {\n        // this.log('onScrolledBottom will load media');\n        this.load(true);\n      }\n    };\n    // this.scroll.attachSentinels(undefined, 400);\n\n    this.selectTab = horizontalMenu(this.tabsMenu, this.tabsContainer, (id, tabContent, animate) => {\n      if(this.prevTabId === id && !this.skipScroll) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.container,\n          position: 'start',\n          startCallback: this.scrollStartCallback\n        });\n        return;\n      }\n\n      const newMediaTab = this.mediaTabs[id];\n      if(this.onChangeTab) {\n        this.onChangeTab(newMediaTab);\n      }\n\n      const fromMediaTab = this.mediaTab;\n      this.mediaTab = newMediaTab;\n\n      if(this.prevTabId !== -1 && animate) {\n        this.onTransitionStart();\n      }\n\n      if(this.skipScroll) {\n        this.skipScroll = false;\n      } else {\n        const offsetTop = this.container.offsetTop;\n        let scrollTop = this.scrollable.scrollTop;\n        if(scrollTop < offsetTop) {\n          this.scrollable.scrollIntoViewNew({\n            element: this.container,\n            position: 'start',\n            startCallback: this.scrollStartCallback\n          });\n          scrollTop = offsetTop;\n        }\n\n        fromMediaTab.scroll = {scrollTop: scrollTop, scrollHeight: this.scrollable.scrollHeight};\n\n        if(newMediaTab.scroll === undefined) {\n          const rect = this.container.getBoundingClientRect();\n          const rect2 = this.container.parentElement.getBoundingClientRect();\n          const diff = rect.y - rect2.y;\n\n          if(scrollTop > diff) {\n            newMediaTab.scroll = {scrollTop: diff, scrollHeight: 0};\n          }\n        }\n\n        if(newMediaTab.scroll) {\n          const diff = fromMediaTab.scroll.scrollTop - newMediaTab.scroll.scrollTop;\n          // console.log('what you gonna do', this.goingHard, diff);\n\n          // this.scrollable.scrollTop = scrollTop;\n          if(diff/*  && diff < 0 */) {\n            /* if(diff > -(fromMediaTab.contentTab.scrollHeight + this.nav.scrollHeight)) {\n              fromMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n              this.scrollable.scrollTop = scrollTop - diff;\n            } else { */\n            newMediaTab.contentTab.style.transform = `translateY(${diff}px)`;\n            // }\n          }\n        }\n      }\n\n      /* if(this.prevTabId !== -1 && nav.offsetTop) {\n        this.scrollable.scrollTop -= nav.offsetTop;\n      } */\n\n      /* this.log('setVirtualContainer', id, this.sharedMediaSelected, this.sharedMediaSelected.childElementCount);\n      this.scroll.setVirtualContainer(this.sharedMediaSelected); */\n\n      if(this.prevTabId !== -1 && !newMediaTab.contentTab.childElementCount) { // quick brown fix\n        // this.contentContainer.classList.remove('loaded');\n        this.load(true);\n      }\n\n      this.prevTabId = id;\n    }, () => {\n      this.scrollable.onScroll();\n\n      // console.log('what y', this.tabSelected.style.transform);\n      if(this.mediaTab.scroll !== undefined) {\n        this.mediaTab.contentTab.style.transform = '';\n        this.scrollable.scrollTop = this.mediaTab.scroll.scrollTop;\n      }\n\n      if(unlockScroll) {\n        unlockScroll();\n        unlockScroll = undefined;\n      }\n\n      this.onTransitionEnd();\n    }, undefined, navScrollable, this.listenerSetter);\n\n    attachClickEvent(this.tabsContainer, (e) => {\n      if(this.selection.isSelecting) {\n        cancelEvent(e);\n        this.selection.toggleByElement(findUpClassName(e.target, 'search-super-item'));\n      }\n    }, {capture: true, passive: false, listenerSetter: this.listenerSetter});\n\n    const onMediaClick = async(className: string, targetClassName: string, inputFilter: MyInputMessagesFilter, e: MouseEvent) => {\n      const target = findUpClassName(e.target as HTMLDivElement, className);\n      if(!target) return;\n\n      const mid = +target.dataset.mid;\n      if(!mid) {\n        this.log.warn('no messageId by click on target:', target);\n        return;\n      }\n\n      const peerId = target.dataset.peerId.toPeerId();\n\n      const targets = (Array.from(this.tabs[inputFilter].querySelectorAll('.' + targetClassName)) as HTMLElement[]).map((el) => {\n        const containerEl = findUpClassName(el, className);\n        return {\n          element: el,\n          mid: +containerEl.dataset.mid,\n          peerId: containerEl.dataset.peerId.toPeerId()\n        };\n      });\n\n      // const ids = Object.keys(this.mediaDivsByIds).map((k) => +k).sort((a, b) => a - b);\n      const idx = targets.findIndex((item) => item.mid === mid && item.peerId === peerId);\n\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      new AppMediaViewer()\n      .setSearchContext(this.copySearchContext(inputFilter))\n      .openMedia(message, targets[idx].element, 0, false, targets.slice(0, idx), targets.slice(idx + 1));\n    };\n\n    attachClickEvent(this.tabs.inputMessagesFilterPhotoVideo, onMediaClick.bind(null, 'grid-item', 'grid-item', 'inputMessagesFilterPhotoVideo'), {listenerSetter: this.listenerSetter});\n    attachClickEvent(this.tabs.inputMessagesFilterDocument, onMediaClick.bind(null, 'document-with-thumb', 'media-container', 'inputMessagesFilterDocument'), {listenerSetter: this.listenerSetter});\n\n    /* attachClickEvent(this.tabs.inputMessagesFilterUrl, (e) => {\n      const target = e.target as HTMLElement;\n      if(target.tagName === 'A') {\n        return;\n      }\n\n      try {\n        const a = findUpClassName(target, 'row').querySelector('.anchor-url:last-child') as HTMLAnchorElement;\n        a.click();\n      } catch(err) {}\n    }); */\n\n    this.mediaTab = this.mediaTabs[0];\n\n    useHeavyAnimationCheck(() => {\n      this.lazyLoadQueue.lock();\n    }, () => {\n      this.lazyLoadQueue.unlockAndRefresh(); // ! maybe not so efficient\n    }, this.listenerSetter);\n  }\n\n  private onTransitionStart = () => {\n    this.container.classList.add('sliding');\n  };\n\n  private onTransitionEnd = () => {\n    this.container.classList.remove('sliding');\n  };\n\n  public filterMessagesByType(messages: any[], type: SearchSuperType): MyMessage[] {\n    return filterMessagesByInputFilter(type, messages, messages.length);\n  }\n\n  private processEmptyFilter({message, searchGroup}: ProcessSearchSuperResult) {\n    const loadPromises: Promise<any>[] = [];\n    const {dom} = appDialogsManager.addDialogNew({\n      peerId: message.peerId,\n      container: searchGroup.list,\n      avatarSize: 54,\n      loadPromises\n    });\n\n    const setLastMessagePromise = appDialogsManager.setLastMessageN({\n      dialog: {\n        _: 'dialog',\n        peerId: message.peerId\n      } as any,\n      lastMessage: message,\n      dom,\n      highlightWord: this.searchContext.query\n    });\n\n    loadPromises.push(setLastMessagePromise);\n    return Promise.all(loadPromises);\n  }\n\n  private async processPhotoVideoFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    const media = getMediaFromMessage(message);\n\n    const div = document.createElement('div');\n    div.classList.add('grid-item');\n    // this.log(message, photo);\n\n    let wrapped: Awaited<ReturnType<typeof wrapPhoto>>;\n    const size = choosePhotoSize(media, 200, 200);\n    if(media._ !== 'photo') {\n      wrapped = await (await wrapVideo({\n        doc: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        onlyPreview: true,\n        withoutPreloader: true,\n        noPlayButton: true,\n        photoSize: size\n      })).thumb;\n    } else {\n      wrapped = await wrapPhoto({\n        photo: media,\n        message,\n        container: div,\n        boxWidth: 0,\n        boxHeight: 0,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        withoutPreloader: true,\n        noBlur: true,\n        size\n      });\n    }\n\n    [wrapped.images.thumb, wrapped.images.full].filter(Boolean).forEach((image) => {\n      image.classList.add('grid-item-media');\n    });\n\n    promises.push(wrapped.loadPromises.thumb);\n\n    return {element: div, message};\n  }\n\n  private async processDocumentFilter({message, inputFilter}: ProcessSearchSuperResult) {\n    const document = getMediaFromMessage(message) as Document.document;\n    const showSender = this.showSender || (['voice', 'round'] as MyDocument['type'][]).includes(document.type);\n\n    const div = await wrapDocument({\n      message,\n      withTime: !showSender,\n      fontWeight: 400,\n      voiceAsMusic: true,\n      showSender,\n      searchContext: this.copySearchContext(inputFilter),\n      lazyLoadQueue: this.lazyLoadQueue,\n      autoDownloadSize: 0\n    });\n\n    if((['audio', 'voice', 'round'] as MyDocument['type'][]).includes(document.type)) {\n      div.classList.add('audio-48');\n    }\n\n    return {message, element: div};\n  }\n\n  private async processUrlFilter({message, promises, middleware}: ProcessSearchSuperResult) {\n    let webpage = (message.media as MessageMedia.messageMediaWebPage)?.webpage as WebPage.webPage;\n\n    if(!webpage) {\n      const entity = message.totalEntities ? message.totalEntities.find((e: any) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') : null;\n      let url: string, display_url: string, sliced: string;\n\n      if(!entity) {\n        // this.log.error('NO ENTITY:', message);\n        const match = matchUrl(message.message);\n        if(!match) {\n          // this.log.error('NO ENTITY AND NO MATCH:', message);\n          return;\n        }\n\n        url = match[0];\n      } else {\n        sliced = message.message.slice(entity.offset, entity.offset + entity.length);\n      }\n\n      if(entity?._ === 'messageEntityTextUrl') {\n        url = entity.url;\n        // display_url = sliced;\n      } else {\n        url = url || sliced;\n      }\n\n      display_url = url;\n\n      const same = message.message === url;\n      if(!url.match(/^(ftp|http|https):\\/\\//)) {\n        display_url = 'https://' + url;\n        url = url.includes('@') ? url : 'https://' + url;\n      }\n\n      display_url = new URL(display_url).hostname;\n\n      webpage = {\n        _: 'webPage',\n        url,\n        display_url,\n        id: '',\n        hash: 0\n      };\n\n      if(!same) {\n        webpage.description = message.message;\n      }\n    }\n\n    const previewDiv = document.createElement('div');\n    previewDiv.classList.add('preview', 'row-media');\n\n    // this.log('wrapping webpage', webpage);\n\n    if(webpage.photo) {\n      const res = wrapPhoto({\n        container: previewDiv,\n        message: null,\n        photo: webpage.photo as Photo.photo,\n        boxWidth: 0,\n        boxHeight: 0,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue,\n        middleware,\n        size: choosePhotoSize(webpage.photo as Photo.photo, 60, 60, false),\n        loadPromises: promises,\n        noBlur: true\n      });\n    } else {\n      previewDiv.classList.add('empty');\n      setInnerHTML(previewDiv, getAbbreviation(webpage.title || webpage.display_url || webpage.description || webpage.url, true));\n    }\n\n    const title = wrapWebPageTitle(webpage);\n\n    const subtitleFragment = wrapWebPageDescription(webpage);\n    const aFragment = htmlToDocumentFragment(wrapRichText(webpage.url || ''));\n    const a = aFragment.firstElementChild;\n    if(a instanceof HTMLAnchorElement) {\n      try { // can have 'URIError: URI malformed'\n        a.innerText = decodeURIComponent(a.href);\n      } catch(err) {\n\n      }\n    }\n\n    if(subtitleFragment.firstChild) {\n      subtitleFragment.append('\\n');\n    }\n\n    subtitleFragment.append(a);\n\n    if(this.showSender) {\n      subtitleFragment.append('\\n', await wrapSenderToPeer(message));\n    }\n\n    if(!title.textContent) {\n      // title = new URL(webpage.url).hostname;\n      title.append(wrapPlainText(webpage.display_url.split('/', 1)[0]));\n    }\n\n    const row = new Row({\n      title,\n      titleRight: wrapSentTime(message),\n      subtitle: subtitleFragment,\n      havePadding: true,\n      clickable: true,\n      noRipple: true\n    });\n\n    /* const mediaDiv = document.createElement('div');\n    mediaDiv.classList.add('row-media'); */\n\n    row.container.append(previewDiv);\n\n    /* ripple(div);\n    div.append(previewDiv);\n    div.insertAdjacentHTML('beforeend', `\n    <div class=\"title\">${title}${titleAdditionHTML}</div>\n    <div class=\"subtitle\">${subtitle}</div>\n    <div class=\"url\">${url}</div>\n    ${sender}\n    `); */\n\n    if(row.container.innerText.trim().length) {\n      return {message, element: row.container};\n    }\n  }\n\n  public async performSearchResult(messages: any[], mediaTab: SearchSuperMediaTab, append = true) {\n    const elemsToAppend: {element: HTMLElement, message: any}[] = [];\n    const sharedMediaDiv: HTMLElement = mediaTab.contentTab;\n    const promises: Promise<any>[] = [];\n    const middleware = this.middleware.get();\n    let inputFilter = mediaTab.inputFilter;\n\n    await getHeavyAnimationPromise();\n\n    let searchGroup: SearchGroup;\n    if(inputFilter === 'inputMessagesFilterPhotoVideo' && !!this.searchContext.query.trim()) {\n      inputFilter = 'inputMessagesFilterEmpty';\n      searchGroup = this.searchGroupMedia;\n      sharedMediaDiv.append(searchGroup.container);\n    } else if(inputFilter === 'inputMessagesFilterEmpty') {\n      searchGroup = this.searchGroups.messages;\n    }\n\n    const options: ProcessSearchSuperResult = {\n      elemsToAppend,\n      inputFilter,\n      message: undefined,\n      middleware,\n      promises,\n      searchGroup\n    };\n\n    let processCallback: (options: ProcessSearchSuperResult) => any;\n\n    // https://core.telegram.org/type/MessagesFilter\n    switch(inputFilter) {\n      case 'inputMessagesFilterEmpty': {\n        processCallback = this.processEmptyFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterPhotoVideo': {\n        processCallback = this.processPhotoVideoFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterVoice':\n      case 'inputMessagesFilterRoundVoice':\n      case 'inputMessagesFilterMusic':\n      case 'inputMessagesFilterDocument': {\n        processCallback = this.processDocumentFilter;\n        break;\n      }\n\n      case 'inputMessagesFilterUrl': {\n        processCallback = this.processUrlFilter;\n        break;\n      }\n\n      default:\n        // this.log.warn('death is my friend', messages);\n        break;\n    }\n\n    if(processCallback) {\n      processCallback = processCallback.bind(this);\n\n      type K = {element: HTMLElement, message: Message.message | Message.messageService};\n      const results: (Promise<K> | K)[] = messages.map(async(message) => {\n        try {\n          options.message = message;\n          return await processCallback(options);\n        } catch(err) {\n          this.log.error('error rendering filter', inputFilter, options, message, err);\n        }\n      });\n\n      const awaited = (await Promise.all(results)).filter(Boolean);\n      elemsToAppend.push(...awaited.filter(Boolean));\n    }\n\n    if(searchGroup && searchGroup.list.childElementCount) {\n      searchGroup.setActive();\n    }\n\n    if(this.loadMutex) {\n      promises.push(this.loadMutex);\n    }\n\n    if(promises.length) {\n      await Promise.all(promises);\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n    }\n\n    if(elemsToAppend.length) {\n      const method = append ? 'append' : 'prepend';\n      elemsToAppend.forEach((details) => {\n        const {element, message} = details;\n        const monthContainer = this.getMonthContainerByTimestamp(this.groupByMonth ? message.date : 0, inputFilter);\n        element.classList.add('search-super-item');\n        element.dataset.mid = '' + message.mid;\n        element.dataset.peerId = '' + message.peerId;\n        monthContainer.items[method](element);\n\n        if(this.selection?.isSelecting) {\n          this.selection.toggleElementCheckbox(element, true);\n        }\n      });\n    }\n\n    // if(type !== 'inputMessagesFilterEmpty') {\n    this.afterPerforming(inputFilter === 'inputMessagesFilterEmpty' ? 1 : messages.length, sharedMediaDiv);\n    // }\n  }\n\n  private afterPerforming(length: number, contentTab: HTMLElement) {\n    if(contentTab) {\n      const parent = contentTab.parentElement;\n      Array.from(parent.children).slice(1).forEach((child) => {\n        child.remove();\n      });\n\n      // this.contentContainer.classList.add('loaded');\n\n      if(!length && !contentTab.childElementCount) {\n        const div = document.createElement('div');\n        div.innerText = 'Nothing interesting here yet...';\n        div.classList.add('position-center', 'text-center', 'content-empty', 'no-select');\n\n        parent.append(div);\n      }\n    }\n  }\n\n  private loadChats() {\n    const renderedPeerIds: Set<PeerId> = new Set();\n    const middleware = this.middleware.get();\n\n    for(const i in this.searchGroups) {\n      const group = this.searchGroups[i as SearchGroupType];\n      this.tabs.inputMessagesFilterEmpty.append(group.container);\n      group.clear();\n    }\n\n    const query = this.searchContext.query;\n    if(query) {\n      const setResults = (results: PeerId[], group: SearchGroup, showMembersCount = false) => {\n        results.map((peerId) => {\n          if(renderedPeerIds.has(peerId)) {\n            return;\n          }\n\n          renderedPeerIds.add(peerId);\n\n          const {dom} = appDialogsManager.addDialogNew({\n            peerId: peerId,\n            container: group.list,\n            avatarSize: 48,\n            autonomous: group.autonomous\n          });\n\n          return {dom, peerId};\n        }).forEach(async({dom, peerId}) => {\n          const peer = await this.managers.appPeersManager.getPeer(peerId);\n          if(showMembersCount && (peer.participants_count || peer.participants)) {\n            const regExp = new RegExp(`(${escapeRegExp(query)}|${escapeRegExp(cleanSearchText(query))})`, 'gi');\n            dom.titleSpan.innerHTML = dom.titleSpan.innerHTML.replace(regExp, '<i>$1</i>');\n            dom.lastMessageSpan.append(await getChatMembersString(peerId.toChatId()));\n          } else if(peerId === rootScope.myId) {\n            dom.lastMessageSpan.append(i18n('Presence.YourChat'));\n          } else {\n            let username = await this.managers.appPeersManager.getPeerUsername(peerId);\n            if(!username) {\n              const user = await this.managers.appUsersManager.getUser(peerId);\n              if(user && user.phone) {\n                username = '+' + formatPhoneNumber(user.phone).formatted;\n              }\n            } else {\n              username = '@' + username;\n            }\n\n            dom.lastMessageSpan.innerHTML = '<i>' + username + '</i>';\n          }\n        });\n\n        group.toggle();\n      };\n\n      const onLoad = <T>(arg: T) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // this.loadedContacts = true;\n\n        return arg;\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getContactsPeerIds(query, true)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts, this.searchGroups.contacts, true);\n          }\n        }),\n\n        this.managers.appUsersManager.searchContacts(query, 20)\n        .then(onLoad)\n        .then((contacts) => {\n          if(contacts) {\n            setResults(contacts.my_results, this.searchGroups.contacts, true);\n            setResults(contacts.results/* .concat(contacts.results, contacts.results, contacts.results) */, this.searchGroups.globalContacts);\n\n            this.searchGroups.globalContacts.container.classList.add('is-short');\n\n            if(this.searchGroups.globalContacts.nameEl.lastElementChild !== this.searchGroups.globalContacts.nameEl.firstElementChild) {\n              this.searchGroups.globalContacts.nameEl.lastElementChild.remove();\n            }\n\n            if(this.searchGroups.globalContacts.list.childElementCount > 3) {\n              const showMore = document.createElement('div');\n              showMore.classList.add('search-group__show-more');\n              const intlElement = new I18n.IntlElement({\n                key: 'Separator.ShowMore'\n              });\n              showMore.append(intlElement.element);\n              this.searchGroups.globalContacts.nameEl.append(showMore);\n              attachClickEvent(showMore, () => {\n                const isShort = this.searchGroups.globalContacts.container.classList.toggle('is-short');\n                intlElement.key = isShort ? 'Separator.ShowMore' : 'Separator.ShowLess';\n                intlElement.update();\n              });\n            }\n          }\n        }),\n\n        this.managers.appMessagesManager.getConversations(query, 0, 20, 0)\n        .then(onLoad)\n        .then((value) => {\n          if(value) {\n            setResults(value.dialogs.map((d) => d.peerId), this.searchGroups.contacts, true);\n          }\n        })\n      ]);\n    } else if(!this.searchContext.peerId && !this.searchContext.minDate) {\n      const renderRecentSearch = (setActive = true) => {\n        return apiManagerProxy.getState().then((state) => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.searchGroups.recent.list.innerHTML = '';\n\n          state.recentSearch.slice(0, 20).forEach(async(peerId) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              container: this.searchGroups.recent.list,\n              meAsSaved: true,\n              avatarSize: 48,\n              autonomous: true\n            });\n\n            dom.lastMessageSpan.append(await (peerId.isUser() ?\n              getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())) :\n              getChatMembersString(peerId.toChatId())));\n          });\n\n          if(!state.recentSearch.length) {\n            this.searchGroups.recent.clear();\n          } else if(setActive) {\n            this.searchGroups.recent.setActive();\n          }\n        });\n      };\n\n      return Promise.all([\n        this.managers.appUsersManager.getTopPeers('correspondents').then((peers) => {\n          if(!middleware()) return;\n\n          const idx = peers.findIndex((peer) => peer.id === rootScope.myId);\n          if(idx !== -1) {\n            peers = peers.slice();\n            peers.splice(idx, 1);\n          }\n          // console.log('got top categories:', categories);\n          if(peers.length) {\n            peers.forEach((peer) => {\n              appDialogsManager.addDialogNew({\n                peerId: peer.id,\n                container: this.searchGroups.people.list,\n                onlyFirstName: true,\n                avatarSize: 54,\n                autonomous: false,\n                noIcons: this.searchGroups.people.noIcons\n              });\n            });\n          }\n\n          this.searchGroups.people.setActive();\n        }),\n\n        renderRecentSearch()\n      ]);\n    } else return Promise.resolve();\n  }\n\n  private async loadMembers(mediaTab: SearchSuperMediaTab) {\n    const id = this.searchContext.peerId.toChatId();\n    const middleware = this.middleware.get();\n    let promise: Promise<void>;\n\n    const renderParticipants = async(participants: (ChatParticipant | ChannelParticipant)[]) => {\n      if(this.loadMutex) {\n        await this.loadMutex;\n\n        if(!middleware()) {\n          return;\n        }\n      }\n\n      if(!this.membersList) {\n        this.membersList = new SortedUserList({\n          lazyLoadQueue: this.lazyLoadQueue,\n          rippleEnabled: false,\n          managers: this.managers\n        });\n        attachClickEvent(this.membersList.list, (e) => {\n          const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n          if(!li) {\n            return;\n          }\n\n          const peerId = li.dataset.peerId.toPeerId();\n          let promise: Promise<any> = Promise.resolve();\n          if(mediaSizes.isMobile) {\n            promise = appSidebarRight.toggleSidebar(false);\n          }\n\n          promise.then(() => {\n            appImManager.setInnerPeer({peerId});\n          });\n        });\n        mediaTab.contentTab.append(this.membersList.list);\n        this.afterPerforming(1, mediaTab.contentTab);\n      }\n\n      for(const participant of participants) {\n        const peerId = getParticipantPeerId(participant);\n        if(peerId.isAnyChat()) {\n          continue;\n        }\n\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.pFlags.deleted) {\n          continue;\n        }\n\n        this.membersList.add(peerId);\n      }\n    };\n\n    if(await this.managers.appChatsManager.isChannel(id)) {\n      const LOAD_COUNT = !this.membersList ? 50 : 200;\n      promise = this.managers.appProfileManager.getChannelParticipants(id, undefined, LOAD_COUNT, this.nextRates[mediaTab.inputFilter]).then((participants) => {\n        if(!middleware()) {\n          return;\n        }\n\n        const list = mediaTab.contentTab.firstElementChild as HTMLUListElement;\n        this.nextRates[mediaTab.inputFilter] = (list ? list.childElementCount : 0) + participants.participants.length;\n\n        if(participants.participants.length < LOAD_COUNT) {\n          this.loaded[mediaTab.inputFilter] = true;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    } else {\n      promise = this.managers.appProfileManager.getChatFull(id).then((chatFull) => {\n        if(!middleware()) {\n          return;\n        }\n\n        // console.log('anymore', chatFull);\n        this.loaded[mediaTab.inputFilter] = true;\n        const participants = (chatFull as ChatFull.chatFull).participants;\n        if(participants._ === 'chatParticipantsForbidden') {\n          return;\n        }\n\n        return renderParticipants(participants.participants);\n      });\n    }\n\n    return this.loadPromises[mediaTab.inputFilter] = promise.finally(() => {\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadPromises[mediaTab.inputFilter] = null;\n    });\n  }\n\n  private loadType(mediaTab: SearchSuperMediaTab, justLoad: boolean, loadCount: number, middleware: () => boolean) {\n    const type = mediaTab.inputFilter;\n\n    if(this.loadPromises[type]) {\n      return this.loadPromises[type];\n    }\n\n    if(mediaTab.type === 'members') {\n      return this.loadMembers(mediaTab);\n    }\n\n    const history = this.historyStorage[type] ?? (this.historyStorage[type] = []);\n\n    if(type === 'inputMessagesFilterEmpty' && !history.length) {\n      if(!this.loadedChats) {\n        this.loadChats();\n        this.loadedChats = true;\n      }\n\n      if(!this.searchContext.query.trim() && !this.searchContext.peerId && !this.searchContext.minDate) {\n        this.loaded[type] = true;\n        return Promise.resolve();\n      }\n    }\n\n    const promise = this.loadPromises[type] = Promise.resolve().then(async() => {\n      // render from cache\n      if(history.length && this.usedFromHistory[type] < history.length && !justLoad) {\n        const messages: any[] = [];\n        let used = Math.max(0, this.usedFromHistory[type]);\n        let slicedLength = 0;\n\n        do {\n          const ids = history.slice(used, used + loadCount);\n          used += ids.length;\n          slicedLength += ids.length;\n\n          const notFilteredMessages = await Promise.all(ids.map((m) => this.managers.appMessagesManager.getMessageByPeer(m.peerId, m.mid)));\n\n          messages.push(...this.filterMessagesByType(notFilteredMessages, type));\n        } while(slicedLength < loadCount && used < history.length);\n\n        //  \n        /* if(slicedLength > loadCount) {\n          let diff = messages.length - loadCount;\n          messages = messages.slice(0, messages.length - diff);\n          used -= diff;\n        } */\n\n        this.usedFromHistory[type] = used;\n        // if(messages.length) {\n        return this.performSearchResult(messages, mediaTab).finally(() => {\n          setTimeout(() => {\n            this.scrollable.checkForTriggers();\n          }, 0);\n        });\n        // }\n      }\n\n      const maxId = history.length ? history[history.length - 1].mid : 0;\n\n      const value = await this.managers.appMessagesManager.getSearch({\n        ...this.searchContext,\n        inputFilter: {_: type},\n        maxId,\n        limit: loadCount,\n        nextRate: this.nextRates[type] ??= 0\n      });\n\n      history.push(...value.history.map((m) => ({mid: m.mid, peerId: m.peerId})));\n\n      if(!middleware()) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      // !  ,         ( - ,        getSearch)\n      if(value.history.length < loadCount || (this.searchContext.folderId !== undefined && !value.next_rate) || value.history.length === value.count) {\n      // if((value.count || history.length === value.count) && history.length >= value.count) {\n        // this.log(logStr + 'loaded all media', value, loadCount);\n        this.loaded[type] = true;\n      }\n\n      this.nextRates[type] = value.next_rate;\n\n      if(justLoad) {\n        return;\n      }\n\n      this.usedFromHistory[type] = history.length;\n\n      if(!this.loaded[type]) {\n        promise.then(() => {\n          setTimeout(() => {\n            if(!middleware()) return;\n            // this.log('will preload more');\n            if(this.mediaTab === mediaTab) {\n              const promise = this.load(true, true);\n              if(promise) {\n                promise.then(() => {\n                  if(!middleware()) return;\n                  // this.log('preloaded more');\n                  setTimeout(() => {\n                    this.scrollable.checkForTriggers();\n                  }, 0);\n                });\n              }\n            }\n          }, 0);\n        });\n      }\n\n      // if(value.history.length) {\n      return this.performSearchResult(this.filterMessagesByType(value.history, type), mediaTab);\n      // }\n    }).catch((err) => {\n      this.log.error('load error:', err);\n    }).finally(() => {\n      this.loadPromises[type] = null;\n    });\n\n    return promise;\n  }\n\n  private canLoadMediaTab(mediaTab: SearchSuperMediaTab) {\n    const inputFilter = mediaTab.inputFilter;\n    return !this.loaded[inputFilter] || (this.historyStorage[inputFilter] && this.usedFromHistory[inputFilter] < this.historyStorage[inputFilter].length);\n  }\n\n  private async loadFirstTime() {\n    const middleware = this.middleware.get();\n    const peerId = this.searchContext.peerId;\n    if(!this.hideEmptyTabs) {\n      return;\n    }\n\n    const mediaTabs = this.mediaTabs.filter((mediaTab) => mediaTab.inputFilter !== 'inputMessagesFilterEmpty');\n    const filters = mediaTabs.map((mediaTab) => ({_: mediaTab.inputFilter}));\n\n    const [counters, canViewMembers] = await Promise.all([\n      this.managers.appMessagesManager.getSearchCounters(peerId, filters),\n      this.canViewMembers()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    if(this.loadMutex) {\n      await this.loadMutex;\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    let firstMediaTab: SearchSuperMediaTab;\n    let count = 0;\n    mediaTabs.forEach((mediaTab) => {\n      const counter = counters.find((c) => c.filter._ === mediaTab.inputFilter);\n\n      mediaTab.menuTab.classList.toggle('hide', !counter.count);\n      mediaTab.menuTab.classList.remove('active');\n      // mediaTab.contentTab.classList.toggle('hide', !counter.count);\n\n      if(counter.count) {\n        if(firstMediaTab === undefined) {\n          firstMediaTab = mediaTab;\n        }\n\n        ++count;\n      }\n    });\n\n    const membersTab = this.mediaTabsMap.get('members');\n    membersTab.menuTab.classList.toggle('hide', !canViewMembers);\n\n    if(canViewMembers) {\n      firstMediaTab = membersTab;\n    }\n\n    this.container.classList.toggle('hide', !firstMediaTab);\n    this.container.parentElement.classList.toggle('search-empty', !firstMediaTab);\n    if(firstMediaTab) {\n      this.skipScroll = true;\n      this.selectTab(this.mediaTabs.indexOf(firstMediaTab), false);\n      // firstMediaTab.menuTab.classList.add('active');\n\n      this.navScrollableContainer.classList.toggle('hide', count <= 1);\n    }\n  }\n\n  public async load(single = false, justLoad = false) {\n    const peerId = this.searchContext.peerId;\n    this.log('load', single, peerId, this.loadPromises);\n    const middleware = this.middleware.get();\n\n    if(this.firstLoad) {\n      await (this.loadFirstTimePromise ??= this.loadFirstTime());\n      if(!middleware()) {\n        return;\n      }\n\n      this.loadFirstTimePromise = undefined;\n      this.firstLoad = false;\n    }\n\n    let toLoad = single ? [this.mediaTab] : this.mediaTabs.filter((t) => t !== this.mediaTab);\n    toLoad = toLoad.filter((mediaTab) => {\n      return this.canLoadMediaTab(mediaTab);\n    });\n\n    if(peerId.isUser()) {\n      findAndSplice(toLoad, (mediaTab) => mediaTab.type === 'members');\n    }\n\n    if(!toLoad.length) {\n      return;\n    }\n\n    const loadCount = justLoad ? 50 : Math.round((windowSize.height / 130 | 0) * 3 * 1.25); // that's good for all types\n\n    const promises: Promise<any>[] = toLoad.map((mediaTab) => {\n      return this.loadType(mediaTab, justLoad, loadCount, middleware);\n    });\n\n    return Promise.all(promises).catch((err) => {\n      this.log.error('Load error all promises:', err);\n    });\n  }\n\n  public getMonthContainerByTimestamp(timestamp: number, type: SearchSuperType) {\n    const date = new Date(timestamp * 1000);\n    date.setHours(0, 0, 0);\n    date.setDate(1);\n    const dateTimestamp = date.getTime();\n    const containers = this.monthContainers[type] ?? (this.monthContainers[type] = {});\n    if(!(dateTimestamp in containers)) {\n      const container = document.createElement('div');\n      container.className = 'search-super-month';\n\n      const name = document.createElement('div');\n      name.classList.add('search-super-month-name');\n\n      const options: Intl.DateTimeFormatOptions = {\n        month: 'long'\n      };\n\n      if(date.getFullYear() !== new Date().getFullYear()) {\n        options.year = 'numeric';\n      }\n\n      const dateElement = new I18n.IntlDateElement({\n        date,\n        options\n      }).element;\n      name.append(dateElement);\n\n      container.append(name);\n\n      const items = document.createElement('div');\n      items.classList.add('search-super-month-items');\n\n      container.append(name, items);\n\n      const haveTimestamps = getObjectKeysAndSort(containers, 'desc');\n      let i = 0;\n      for(; i < haveTimestamps.length; ++i) {\n        const t = haveTimestamps[i];\n        if(dateTimestamp > t) {\n          break;\n        }\n      }\n\n      containers[dateTimestamp] = {container, items};\n      positionElementByIndex(container, this.tabs[type], i);\n    }\n\n    return containers[dateTimestamp];\n  }\n\n  public canViewMembers() {\n    return Promise.all([\n      this.searchContext.peerId.isAnyChat(),\n      this.managers.appChatsManager.isBroadcast(this.searchContext.peerId.toChatId()),\n      this.managers.appChatsManager.hasRights(this.searchContext.peerId.toChatId(), 'view_participants')\n    ]).then(([isAnyChat, isBroadcast, hasRights]) => {\n      return isAnyChat && !isBroadcast && hasRights;\n    });\n  }\n\n  public cleanup() {\n    this.loadPromises = {};\n    this.loaded = {};\n    this.loadedChats = false;\n    this.nextRates = {};\n    this.firstLoad = true;\n    this.prevTabId = -1;\n\n    this.lazyLoadQueue.clear();\n\n    this.mediaTabs.forEach((mediaTab) => {\n      this.usedFromHistory[mediaTab.inputFilter] = -1;\n    });\n\n    if(this.selection?.isSelecting) {\n      this.selection.cancelSelection();\n    }\n\n    // * must go to first tab ( )\n    /* const membersTab = this.mediaTabsMap.get('members');\n    if(membersTab) {\n      const tab = this.canViewMembers() ? membersTab : this.mediaTabs[this.mediaTabs.indexOf(membersTab) + 1];\n      this.mediaTab = tab;\n    } */\n\n    this.middleware.clean();\n    this.loadFirstTimePromise = undefined;\n    this.cleanScrollPositions();\n    this.membersList = undefined;\n  }\n\n  public cleanScrollPositions() {\n    this.mediaTabs.forEach((mediaTab) => {\n      mediaTab.scroll = undefined;\n    });\n  }\n\n  public cleanupHTML(goFirst = false) {\n    if(this.urlsToRevoke.length) {\n      this.urlsToRevoke.forEach((url) => {\n        URL.revokeObjectURL(url);\n      });\n      this.urlsToRevoke.length = 0;\n    }\n\n    this.mediaTabs.forEach((tab) => {\n      tab.contentTab.innerHTML = '';\n\n      if(this.hideEmptyTabs) {\n        // tab.menuTab.classList.add('hide');\n        this.container.classList.add('hide');\n        this.container.parentElement.classList.add('search-empty');\n      }\n\n      if(tab.type === 'chats') {\n        return;\n      }\n\n      if(!this.historyStorage[tab.inputFilter]) {\n        const parent = tab.contentTab.parentElement;\n        // if(!testScroll) {\n        if(!parent.querySelector('.preloader')) {\n          putPreloader(parent, true);\n        }\n        // }\n\n        const empty = parent.querySelector('.content-empty');\n        if(empty) {\n          empty.remove();\n        }\n      }\n    });\n\n    /* if(goFirst) {\n      const membersTab = this.mediaTabsMap.get('members');\n      if(membersTab) {\n        let idx = this.canViewMembers() ? 0 : 1;\n        membersTab.menuTab.classList.toggle('hide', idx !== 0);\n\n        this.selectTab(idx, false);\n      } else {\n        this.selectTab(0, false);\n      }\n    } */\n\n    this.monthContainers = {};\n    this.searchGroupMedia.clear();\n    this.scrollable.scrollTop = 0;\n\n    /* if(testScroll) {\n      for(let i = 0; i < 1500; ++i) {\n        let div = document.createElement('div');\n        div.insertAdjacentHTML('beforeend', `<img class=\"media-image\" src=\"assets/img/camomile.jpg\">`);\n        div.classList.add('grid-item');\n        div.dataset.id = '' + (i / 3 | 0);\n        //div.innerText = '' + (i / 3 | 0);\n        this.tabs.inputMessagesFilterPhotoVideo.append(div);\n      }\n    } */\n  }\n\n  private copySearchContext(newInputFilter: MyInputMessagesFilter) {\n    const context = copy(this.searchContext);\n    context.inputFilter = {_: newInputFilter};\n    context.nextRate = this.nextRates[newInputFilter];\n    return context;\n  }\n\n  public setQuery({peerId, query, threadId, historyStorage, folderId, minDate, maxDate}: {\n    peerId: PeerId,\n    query?: string,\n    threadId?: number,\n    historyStorage?: AppSearchSuper['historyStorage'],\n    folderId?: number,\n    minDate?: number,\n    maxDate?: number\n  }) {\n    this.searchContext = {\n      peerId,\n      query: query || '',\n      inputFilter: {_: this.mediaTab.inputFilter},\n      threadId,\n      folderId,\n      minDate,\n      maxDate\n    };\n\n    this.historyStorage = historyStorage ?? {};\n\n    this.cleanup();\n  }\n\n  public destroy() {\n    this.listenerSetter.removeAll();\n    this.scrollable.destroy();\n    this.swipeHandler?.removeListeners();\n    this.selection?.cleanup();\n\n    this.scrollStartCallback = undefined;\n    this.onChangeTab = undefined;\n    this.selectTab = undefined;\n    this.searchContextMenu = undefined;\n    this.swipeHandler = undefined;\n    this.selection = undefined;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from './cancelEvent';\n\nexport default function lockTouchScroll(container: HTMLElement) {\n  const onTouchMove = (e: TouchEvent) => {\n    cancelEvent(e);\n  };\n\n  let lockers = 2;\n  const cb = () => {\n    if(!--lockers) {\n      container.removeEventListener('touchmove', onTouchMove, {capture: true});\n    }\n  };\n\n  container.addEventListener('touchmove', onTouchMove, {capture: true, passive: false});\n  container.addEventListener('touchend', cb, {once: true});\n\n  return cb;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../lib/appManagers/appChatsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport appDialogsManager from '../lib/appManagers/appDialogsManager';\nimport rootScope from '../lib/rootScope';\nimport Scrollable from './scrollable';\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\nimport CheckboxField from './checkboxField';\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport PeerTitle from './peerTitle';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport debounce from '../helpers/schedulers/debounce';\nimport windowSize from '../helpers/windowSize';\nimport type {IsPeerType} from '../lib/appManagers/appPeersManager';\nimport {generateDelimiter, SettingSection} from './sidebarLeft';\nimport {attachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\nimport filterUnique from '../helpers/array/filterUnique';\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\nimport safeAssign from '../helpers/object/safeAssign';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport AvatarElement from './avatar';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport filterAsync from '../helpers/array/filterAsync';\nimport getParticipantPeerId from '../lib/appManagers/utils/chats/getParticipantPeerId';\nimport getChatMembersString from './wrappers/getChatMembersString';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport {Chat, User} from '../layer';\nimport canSendToUser from '../lib/appManagers/utils/users/canSendToUser';\nimport hasRights from '../lib/appManagers/utils/chats/hasRights';\nimport getDialogIndex from '../lib/appManagers/utils/dialogs/getDialogIndex';\n\ntype SelectSearchPeerType = 'contacts' | 'dialogs' | 'channelParticipants';\n\n// TODO:    addMembers, ..  peerType: 'contacts',       -  ,      \n\nexport default class AppSelectPeers {\n  public container = document.createElement('div');\n  public list = appDialogsManager.createChatList(/* {\n    handheldsSize: 66,\n    avatarSize: 48\n  } */);\n  private chatsContainer = document.createElement('div');\n  public scrollable: Scrollable;\n  private selectedScrollable: Scrollable;\n\n  private selectedContainer: HTMLElement;\n  public input: HTMLInputElement;\n\n  // public selected: {[peerId: PeerId]: HTMLElement} = {};\n  public selected = new Set<PeerId | string>();\n\n  public freezed = false;\n\n  private folderId = 0;\n  private offsetIndex = 0;\n  private promise: Promise<any>;\n\n  private query = '';\n  private cachedContacts: PeerId[];\n\n  private loadedWhat: Partial<{[k in 'dialogs' | 'archived' | 'contacts' | 'channelParticipants']: true}> = {};\n\n  private renderedPeerIds: Set<PeerId> = new Set();\n\n  private appendTo: HTMLElement;\n  private onChange: (length: number) => void;\n  private peerType: SelectSearchPeerType[] = ['dialogs'];\n  private renderResultsFunc: (peerIds: PeerId[]) => void | Promise<void>;\n  private chatRightsAction: ChatRights;\n  private multiSelect = true;\n  private rippleEnabled = true;\n  private avatarSize = 48;\n  private exceptSelf = false;\n  private filterPeerTypeBy: IsPeerType[];\n\n  private tempIds: {[k in keyof AppSelectPeers['loadedWhat']]: number} = {};\n  private peerId: PeerId;\n\n  private placeholder: LangPackKey;\n\n  private selfPresence: LangPackKey = 'Presence.YourChat';\n\n  private needSwitchList = false;\n\n  private sectionNameLangPackKey: LangPackKey;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: AppSelectPeers['appendTo'],\n    onChange?: AppSelectPeers['onChange'],\n    peerType?: AppSelectPeers['peerType'],\n    peerId?: AppSelectPeers['peerId'],\n    onFirstRender?: () => void,\n    renderResultsFunc?: AppSelectPeers['renderResultsFunc'],\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\n    multiSelect?: AppSelectPeers['multiSelect'],\n    rippleEnabled?: AppSelectPeers['rippleEnabled'],\n    avatarSize?: AppSelectPeers['avatarSize'],\n    placeholder?: AppSelectPeers['placeholder'],\n    selfPresence?: AppSelectPeers['selfPresence'],\n    exceptSelf?: AppSelectPeers['exceptSelf'],\n    filterPeerTypeBy?: AppSelectPeers['filterPeerTypeBy'],\n    sectionNameLangPackKey?: AppSelectPeers['sectionNameLangPackKey'],\n    managers: AppSelectPeers['managers']\n  }) {\n    safeAssign(this, options);\n\n    this.container.classList.add('selector');\n\n    const f = (this.renderResultsFunc || this.renderResults).bind(this);\n    this.renderResultsFunc = async(peerIds) => {\n      if(this.needSwitchList) {\n        this.scrollable.splitUp.replaceWith(this.list);\n        this.scrollable.setVirtualContainer(this.list);\n        this.needSwitchList = false;\n      }\n\n      peerIds = peerIds.filter((peerId) => {\n        const notRendered = !this.renderedPeerIds.has(peerId);\n        if(notRendered) this.renderedPeerIds.add(peerId);\n        return notRendered;\n      });\n\n      if(this.filterPeerTypeBy) {\n        peerIds = await filterAsync(peerIds, async(peerId) => {\n          if(peerId.isPeerId()) {\n            const peer = await this.managers.appPeersManager.getPeer(peerId);\n            if(!peer.deleted) {\n              for(const method of this.filterPeerTypeBy) {\n                if(await this.managers.appPeersManager[method](peerId)) {\n                  return true;\n                }\n              }\n            }\n          }\n\n          return true;\n        });\n      }\n\n      return f(peerIds);\n    };\n\n    this.input = document.createElement('input');\n    this.input.classList.add('selector-search-input');\n    if(this.placeholder) {\n      _i18n(this.input, this.placeholder, undefined, 'placeholder');\n    } else {\n      _i18n(this.input, 'SendMessageTo', undefined, 'placeholder');\n    }\n\n    this.input.type = 'text';\n\n    if(this.multiSelect) {\n      const section = new SettingSection({});\n      section.innerContainer.classList.add('selector-search-section');\n      const topContainer = document.createElement('div');\n      topContainer.classList.add('selector-search-container');\n\n      this.selectedContainer = document.createElement('div');\n      this.selectedContainer.classList.add('selector-search');\n\n      this.selectedContainer.append(this.input);\n      topContainer.append(this.selectedContainer);\n      this.selectedScrollable = new Scrollable(topContainer);\n\n      // let delimiter = document.createElement('hr');\n\n      attachClickEvent(this.selectedContainer, (e) => {\n        if(this.freezed) return;\n        let target = e.target as HTMLElement;\n        target = findUpClassName(target, 'selector-user');\n\n        if(!target) return;\n\n        const peerId = target.dataset.key;\n        const li = this.chatsContainer.querySelector('[data-peer-id=\"' + peerId + '\"]') as HTMLElement;\n        if(!li) {\n          this.remove(peerId.toPeerId());\n        } else {\n          simulateClickEvent(li);\n        }\n      });\n\n      section.content.append(topContainer);\n      this.container.append(section.container/* , delimiter */);\n    }\n\n    this.chatsContainer.classList.add('chatlist-container');\n    // this.chatsContainer.append(this.list);\n    const section = new SettingSection({\n      name: this.sectionNameLangPackKey,\n      noShadow: true\n    });\n    section.content.append(this.list);\n    this.chatsContainer.append(section.container);\n    this.scrollable = new Scrollable(this.chatsContainer);\n    this.scrollable.setVirtualContainer(this.list);\n\n    attachClickEvent(this.chatsContainer, (e) => {\n      const target = findUpAttribute(e.target, 'data-peer-id') as HTMLElement;\n      cancelEvent(e);\n\n      if(!target) return;\n      if(this.freezed) return;\n\n      let key: PeerId | string = target.dataset.peerId;\n      key = key.isPeerId() ? key.toPeerId() : key;\n\n      if(!this.multiSelect) {\n        this.add(key);\n        return;\n      }\n\n      // target.classList.toggle('active');\n      if(this.selected.has(key)) {\n        this.remove(key);\n      } else {\n        this.add(key);\n      }\n\n      const checkbox = target.querySelector('input') as HTMLInputElement;\n      checkbox.checked = !checkbox.checked;\n    });\n\n    const debouncedInput = debounce(this.onInput, 200, false, true);\n    this.input.addEventListener('input', debouncedInput);\n\n    this.scrollable.onScrolledBottom = () => {\n      this.getMoreResults();\n    };\n\n    this.scrollable.container.prepend(generateDelimiter());\n\n    this.container.append(this.chatsContainer);\n    this.appendTo.append(this.container);\n\n    // WARNING TIMEOUT\n    setTimeout(() => {\n      const getResultsPromise = this.getMoreResults() as Promise<any>;\n      if(options.onFirstRender) {\n        getResultsPromise.then(() => {\n          options.onFirstRender();\n        });\n      }\n    }, 0);\n  }\n\n  private onInput = () => {\n    const value = this.input.value;\n    if(this.query !== value) {\n      if(this.peerType.includes('contacts') || this.peerType.includes('dialogs')) {\n        this.cachedContacts = null;\n      }\n\n      if(this.peerType.includes('dialogs')) {\n        this.folderId = 0;\n        this.offsetIndex = 0;\n      }\n\n      for(const i in this.tempIds) {\n        // @ts-ignore\n        ++this.tempIds[i];\n      }\n\n      this.list = appDialogsManager.createChatList();\n\n      this.promise = null;\n      this.loadedWhat = {};\n      this.query = value;\n      this.renderedPeerIds.clear();\n      this.needSwitchList = true;\n\n      // console.log('selectPeers input:', this.query);\n      this.getMoreResults();\n    }\n  };\n\n  private async renderSaved() {\n    if(\n      !this.exceptSelf &&\n      !this.offsetIndex &&\n      this.folderId === 0 &&\n      this.peerType.includes('dialogs') &&\n      (!this.query || await this.managers.appUsersManager.testSelfSearch(this.query))\n    ) {\n      await this.renderResultsFunc([rootScope.myId]);\n    }\n  }\n\n  private getTempId(type: keyof AppSelectPeers['tempIds']) {\n    if(this.tempIds[type] === undefined) {\n      this.tempIds[type] = 0;\n    }\n\n    return ++this.tempIds[type];\n  }\n\n  private async getMoreDialogs(): Promise<any> {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.dialogs && this.loadedWhat.archived) {\n      return;\n    }\n\n    //   -   ,  ,    \n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n\n    const tempId = this.getTempId('dialogs');\n    const promise = this.managers.appMessagesManager.getConversations(this.query, this.offsetIndex, pageCount, this.folderId, true);\n    this.promise = promise;\n    const value = await promise;\n    if(this.tempIds.dialogs !== tempId) {\n      return;\n    }\n\n    this.promise = null;\n\n    let dialogs = value.dialogs as Dialog[];\n    if(dialogs.length) {\n      const newOffsetIndex = getDialogIndex(dialogs[dialogs.length - 1]) || 0;\n\n      dialogs = dialogs.slice();\n      findAndSplice(dialogs, d => d.peerId === rootScope.myId); // no my account\n\n      if(this.chatRightsAction) {\n        dialogs = await filterAsync(dialogs, (d) => this.filterByRights(d.peerId));\n      }\n\n      await this.renderSaved();\n\n      this.offsetIndex = newOffsetIndex;\n    }\n\n    this.renderResultsFunc(dialogs.map((dialog) => dialog.peerId));\n\n    if(value.isEnd) {\n      if(!this.loadedWhat.dialogs) {\n        await this.renderSaved();\n\n        this.loadedWhat.dialogs = true;\n        this.offsetIndex = 0;\n        this.folderId = 1;\n\n        return this.getMoreDialogs();\n      } else {\n        this.loadedWhat.archived = true;\n\n        if(!this.loadedWhat.contacts/*  && this.peerType.includes('contacts') */) {\n          return this.getMoreContacts();\n        }\n      }\n    }\n  }\n\n  private async filterByRights(peerId: PeerId) {\n    const peer: User | Chat = await this.managers.appPeersManager.getPeer(peerId);\n    if(peerId.isUser()) {\n      return this.chatRightsAction !== 'send_messages' || canSendToUser(peer as User.user);\n    } else if(hasRights(peer as Chat.chat, this.chatRightsAction)) {\n      return true;\n    }\n  }\n\n  private async getMoreContacts() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.contacts) {\n      return;\n    }\n\n    const isGlobalSearch = this.peerType.includes('contacts');\n\n    if(!this.cachedContacts) {\n      /* const promises: Promise<any>[] = [appUsersManager.getContacts(this.query)];\n      if(!this.peerType.includes('dialogs')) {\n        promises.push(appMessagesManager.getConversationsAll());\n      }\n\n      this.promise = Promise.all(promises);\n      this.cachedContacts = (await this.promise)[0].slice(); */\n      const tempId = this.getTempId('contacts');\n      const promise = Promise.all([\n        isGlobalSearch ? this.managers.appUsersManager.getContactsPeerIds(this.query) : [],\n        this.query ? this.managers.appUsersManager.searchContacts(this.query) : undefined\n      ]);\n\n      this.promise = promise;\n      const [cachedContacts, searchResult] = await promise;\n      if(this.tempIds.contacts !== tempId) {\n        return;\n      }\n\n      if(searchResult) {\n        // do not add global result if only dialogs needed\n        let resultPeerIds = isGlobalSearch ? searchResult.my_results.concat(searchResult.results) : searchResult.my_results;\n\n        if(this.chatRightsAction) {\n          resultPeerIds = await filterAsync(resultPeerIds, (peerId) => this.filterByRights(peerId));\n        }\n\n        if(!this.peerType.includes('dialogs')) {\n          resultPeerIds = resultPeerIds.filter((peerId) => peerId.isUser());\n        }\n\n        this.cachedContacts = filterUnique(cachedContacts.concat(resultPeerIds));\n      } else this.cachedContacts = cachedContacts.slice();\n\n      indexOfAndSplice(this.cachedContacts, rootScope.myId); // no my account\n      this.promise = null;\n    }\n\n    // if(this.cachedContacts.length) {\n    const pageCount = windowSize.height / 72 * 1.25 | 0;\n    const arr = this.cachedContacts.splice(0, pageCount);\n    this.renderResultsFunc(arr);\n    // }\n\n    if(!this.cachedContacts.length) {\n      this.loadedWhat.contacts = true;\n\n      // need to load non-contacts\n      /* if(!this.peerType.includes('dialogs')) {\n        return this.getMoreDialogs();\n      } */\n    }\n  }\n\n  private async getMoreChannelParticipants() {\n    if(this.promise) return this.promise;\n\n    if(this.loadedWhat.channelParticipants) {\n      return;\n    }\n\n    const pageCount = 50; // same as in group permissions to use cache\n\n    const tempId = this.getTempId('channelParticipants');\n    const promise = this.managers.appProfileManager.getChannelParticipants(this.peerId.toChatId(), {_: 'channelParticipantsSearch', q: this.query}, pageCount, this.list.childElementCount);\n    const participants = await promise;\n    if(this.tempIds.channelParticipants !== tempId) {\n      return;\n    }\n\n    const peerIds = participants.participants.map((participant) => {\n      return getParticipantPeerId(participant);\n    });\n    indexOfAndSplice(peerIds, rootScope.myId);\n    this.renderResultsFunc(peerIds);\n\n    if(this.list.childElementCount >= participants.count || participants.participants.length < pageCount) {\n      this.loadedWhat.channelParticipants = true;\n    }\n  }\n\n  checkForTriggers = () => {\n    this.scrollable.checkForTriggers();\n  };\n\n  private getMoreResults() {\n    const get = () => {\n      const promises: Promise<any>[] = [];\n\n      // if(!loadedAllDialogs && (this.peerType.includes('dialogs')/*  || this.peerType.includes('contacts') */)) {\n      //   if(!loadAllDialogsPromise) {\n      //     loadAllDialogsPromise = appMessagesManager.getConversationsAll()\n      //     .then(() => {\n      //       loadedAllDialogs = true;\n      //     }).finally(() => {\n      //       loadAllDialogsPromise = null;\n      //     });\n      //   }\n\n      //   promises.push(loadAllDialogsPromise);\n      // }\n\n      if((this.peerType.includes('dialogs')/*  || this.loadedWhat.contacts */) && !this.loadedWhat.archived) { // to load non-contacts\n        promises.push(this.getMoreDialogs());\n\n        if(!this.loadedWhat.archived) {\n          return promises;\n        }\n      }\n\n      if((this.peerType.includes('contacts') || this.peerType.includes('dialogs')) && !this.loadedWhat.contacts) {\n        promises.push(this.getMoreContacts());\n      }\n\n      if(this.peerType.includes('channelParticipants') && !this.loadedWhat.channelParticipants) {\n        promises.push(this.getMoreChannelParticipants());\n      }\n\n      return promises;\n    };\n\n    const promises = get();\n    const promise = Promise.all(promises);\n    if(promises.length) {\n      promise.then(this.checkForTriggers);\n    }\n\n    return promise;\n  }\n\n  private async renderResults(peerIds: PeerId[]) {\n    // console.log('will renderResults:', peerIds);\n\n    //     \n    if(!this.peerType.includes('dialogs') && this.loadedWhat.contacts) {\n      peerIds = await filterAsync(peerIds, (peerId) => {\n        return this.managers.appUsersManager.isNonContactUser(peerId);\n      });\n    }\n\n    peerIds.forEach(async(peerId) => {\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: peerId,\n        container: this.scrollable,\n        rippleEnabled: this.rippleEnabled,\n        avatarSize: this.avatarSize\n      });\n\n      if(this.multiSelect) {\n        const selected = this.selected.has(peerId);\n        const checkboxField = new CheckboxField();\n\n        if(selected) {\n          // dom.listEl.classList.add('active');\n          checkboxField.input.checked = true;\n        }\n\n        dom.containerEl.prepend(checkboxField.label);\n      }\n\n      let subtitleEl: HTMLElement;\n      if(peerId.isAnyChat()) {\n        subtitleEl = await getChatMembersString(peerId.toChatId());\n      } else if(peerId === rootScope.myId) {\n        subtitleEl = i18n(this.selfPresence);\n      } else {\n        subtitleEl = getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId()));\n      }\n\n      dom.lastMessageSpan.append(subtitleEl);\n    });\n  }\n\n  public add(key: PeerId | string, title?: string | HTMLElement, scroll = true) {\n    // console.trace('add');\n    this.selected.add(key);\n\n    if(!this.multiSelect) {\n      this.onChange(this.selected.size);\n      return;\n    }\n\n    if(this.query.trim()) {\n      this.input.value = '';\n      this.onInput();\n    }\n\n    const div = document.createElement('div');\n    div.classList.add('selector-user', 'scale-in');\n\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-32');\n    avatarEl.isDialog = true;\n\n    div.dataset.key = '' + key;\n    if(key.isPeerId()) {\n      if(title === undefined) {\n        title = new PeerTitle({peerId: key.toPeerId(), dialog: true}).element;\n      }\n\n      avatarEl.updateWithOptions({\n        peerId: key as PeerId\n      });\n    }\n\n    if(title) {\n      if(typeof(title) === 'string') {\n        div.innerHTML = title;\n      } else {\n        replaceContent(div, title);\n        div.append(title);\n      }\n    }\n\n    div.insertAdjacentElement('afterbegin', avatarEl);\n\n    this.selectedContainer.insertBefore(div, this.input);\n    // this.selectedScrollable.scrollTop = this.selectedScrollable.scrollHeight;\n    this.onChange && this.onChange(this.selected.size);\n\n    if(scroll) {\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center'\n      });\n    }\n\n    return div;\n  }\n\n  public remove(key: PeerId | string) {\n    if(!this.multiSelect) return;\n    // const div = this.selected[peerId];\n    const div = this.selectedContainer.querySelector(`[data-key=\"${key}\"]`) as HTMLElement;\n    div.classList.remove('scale-in');\n    void div.offsetWidth;\n    div.classList.add('scale-out');\n\n    const onAnimationEnd = () => {\n      this.selected.delete(key);\n      div.remove();\n      this.onChange && this.onChange(this.selected.size);\n    };\n\n    if(rootScope.settings.animationsEnabled) {\n      div.addEventListener('animationend', onAnimationEnd, {once: true});\n    } else {\n      onAnimationEnd();\n    }\n  }\n\n  public getSelected() {\n    return [...this.selected];\n  }\n\n  public addInitial(values: any[]) {\n    values.forEach((value) => {\n      this.add(value, undefined, false);\n    });\n\n    window.requestAnimationFrame(() => { // ! not the best place for this raf though it works\n      this.selectedScrollable.scrollIntoViewNew({\n        element: this.input,\n        position: 'center',\n        forceDirection: FocusDirection.Static\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport ProgressivePreloader from './preloader';\nimport appMediaPlaybackController, {MediaItem, MediaSearchContext} from './appMediaPlaybackController';\nimport {DocumentAttribute, Message} from '../layer';\nimport mediaSizes from '../helpers/mediaSizes';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport rootScope from '../lib/rootScope';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport LazyLoadQueue from './lazyLoadQueue';\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\nimport ListenerSetter, {Listener} from '../helpers/listenerSetter';\nimport noop from '../helpers/noop';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport {joinElementsWith} from '../lib/langPack';\nimport {MiddleEllipsisElement} from './middleEllipsis';\nimport {formatFullSentTime} from '../helpers/date';\nimport throttleWithRaf from '../helpers/schedulers/throttleWithRaf';\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport formatBytes from '../helpers/formatBytes';\nimport {animateSingle} from '../helpers/animation';\nimport clamp from '../helpers/number/clamp';\nimport toHHMMSS from '../helpers/string/toHHMMSS';\nimport MediaProgressLine from './mediaProgressLine';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport wrapSenderToPeer from './wrappers/senderToPeer';\nimport wrapSentTime from './wrappers/sentTime';\nimport getMediaFromMessage from '../lib/appManagers/utils/messages/getMediaFromMessage';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport wrapPhoto from './wrappers/photo';\n\nrootScope.addEventListener('messages_media_read', ({mids, peerId}) => {\n  mids.forEach((mid) => {\n    const attr = `[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`;\n    (Array.from(document.querySelectorAll(`audio-element.is-unread${attr}, .media-round.is-unread${attr}`)) as AudioElement[]).forEach((elem) => {\n      elem.classList.remove('is-unread');\n    });\n  });\n});\n\n// https://github.com/LonamiWebs/Telethon/blob/4393ec0b83d511b6a20d8a20334138730f084375/telethon/utils.py#L1285\nexport function decodeWaveform(waveform: Uint8Array | number[]) {\n  if(!(waveform instanceof Uint8Array)) {\n    waveform = new Uint8Array(waveform);\n  }\n\n  const bitCount = waveform.length * 8;\n  const valueCount = bitCount / 5 | 0;\n  if(!valueCount) {\n    return new Uint8Array([]);\n  }\n\n  let result: Uint8Array;\n  try {\n    const dataView = new DataView(waveform.buffer);\n    result = new Uint8Array(valueCount);\n    for(let i = 0; i < valueCount; i++) {\n      const byteIndex = i * 5 / 8 | 0;\n      const bitShift = i * 5 % 8;\n      const value = dataView.getUint16(byteIndex, true);\n      result[i] = (value >> bitShift) & 0b00011111;\n    }\n  } catch(err) {\n    result = new Uint8Array([]);\n  }\n\n  /* var byteIndex = (valueCount - 1) / 8 | 0;\n  var bitShift = (valueCount - 1) % 8;\n  if(byteIndex === waveform.length - 1) {\n    var value = waveform[byteIndex];\n  } else {\n    var value = dataView.getUint16(byteIndex, true);\n  }\n  console.log('decoded waveform, setting last value:', value, byteIndex, bitShift);\n  result[valueCount - 1] = (value >> bitShift) & 0b00011111; */\n  return result;\n}\n\nfunction createWaveformBars(waveform: Uint8Array, duration: number) {\n  const barWidth = 2;\n  const barMargin = 2;      // mediaSizes.isMobile ? 2 : 1;\n  const barHeightMin = 4;   // mediaSizes.isMobile ? 3 : 2;\n  const barHeightMax = mediaSizes.isMobile ? 16 : 23;\n  // const availW = 150;       //mediaSizes.isMobile ? 152 : 190;\n\n  const minW = mediaSizes.isMobile ? 152 : 190;\n  const maxW = mediaSizes.isMobile ? 190 : 256;\n  const availW = clamp(duration / 60 * maxW, minW, maxW); // mediaSizes.isMobile ? 152 : 224;\n\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.classList.add('audio-waveform-bars');\n  svg.setAttributeNS(null, 'width', '' + availW);\n  svg.setAttributeNS(null, 'height', '' + barHeightMax);\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${availW} ${barHeightMax}`);\n\n  // console.log('decoded waveform:', waveform);\n\n  const normValue = Math.max(...waveform);\n  const wfSize = waveform.length ? waveform.length : 100;\n  const barCount = Math.min((availW / (barWidth + barMargin)) | 0, wfSize);\n\n  let maxValue = 0;\n  const maxDelta = barHeightMax - barHeightMin;\n\n  let html = '';\n  for(let i = 0, barX = 0, sumI = 0; i < wfSize; ++i) {\n    const value = waveform[i] || 0;\n    if((sumI + barCount) >= wfSize) { // draw bar\n      sumI = sumI + barCount - wfSize;\n      if(sumI < (barCount + 1) / 2) {\n        if(maxValue < value) maxValue = value;\n      }\n\n      const bar_value = Math.max(((maxValue * maxDelta) + ((normValue + 1) / 2)) / (normValue + 1), barHeightMin);\n\n      const h = `\n      <rect x=\"${barX}\" y=\"${barHeightMax - bar_value}\" width=\"${barWidth}\" height=\"${bar_value}\" rx=\"1\" ry=\"1\"></rect>\n      `;\n      html += h;\n\n      barX += barWidth + barMargin;\n\n      if(sumI < (barCount + 1) / 2) {\n        maxValue = 0;\n      } else {\n        maxValue = value;\n      }\n    } else {\n      if(maxValue < value) maxValue = value;\n\n      sumI += barCount;\n    }\n  }\n\n  const container = document.createElement('div');\n  container.classList.add('audio-waveform');\n  container.append(svg);\n\n  svg.insertAdjacentHTML('beforeend', html);\n  return {svg, container, availW};\n}\n\nasync function wrapVoiceMessage(audioEl: AudioElement) {\n  audioEl.classList.add('is-voice');\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  if(message.pFlags.out) {\n    audioEl.classList.add('is-out');\n  }\n\n  let waveform = (doc.attributes.find((attribute) => attribute._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio).waveform || new Uint8Array([]);\n  waveform = decodeWaveform(waveform.slice(0, 63));\n\n  const {svg, container: svgContainer, availW} = createWaveformBars(waveform, doc.duration);\n\n  const fakeSvgContainer = svgContainer.cloneNode(true) as HTMLElement;\n  fakeSvgContainer.classList.add('audio-waveform-fake');\n  svgContainer.classList.add('audio-waveform-background');\n\n  const waveformContainer = document.createElement('div');\n  waveformContainer.classList.add('audio-waveform-container');\n  waveformContainer.append(svgContainer, fakeSvgContainer);\n\n  const timeDiv = document.createElement('div');\n  timeDiv.classList.add('audio-time');\n  audioEl.append(waveformContainer, timeDiv);\n\n  let progress = svg as any as HTMLElement;\n\n  const onLoad = () => {\n    let audio = audioEl.audio;\n\n    const setAnimation = () => {\n      animateSingle(() => {\n        if(!audio) return false;\n        onTimeUpdate();\n        return !audio.paused;\n      }, audioEl);\n    };\n\n    const onTimeUpdate = () => {\n      fakeSvgContainer.style.width = (audio.currentTime / audio.duration * 100) + '%';\n    };\n\n    if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n      onTimeUpdate();\n    }\n\n    const throttledTimeUpdate = throttleWithRaf(onTimeUpdate);\n    audioEl.addAudioListener('timeupdate', throttledTimeUpdate);\n    audioEl.addAudioListener('ended', throttledTimeUpdate);\n    audioEl.addAudioListener('play', setAnimation);\n\n    audioEl.readyPromise.then(() => {\n      let mousedown = false, mousemove = false;\n      progress.addEventListener('mouseleave', (e) => {\n        if(mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n        mousemove = false;\n      })\n      progress.addEventListener('mousemove', (e) => {\n        mousemove = true;\n        if(mousedown) scrub(e);\n      });\n      progress.addEventListener('mousedown', (e) => {\n        e.preventDefault();\n        if(e.button !== 0) return;\n        if(!audio.paused) {\n          audio.pause();\n        }\n\n        scrub(e);\n        mousedown = true;\n      });\n      progress.addEventListener('mouseup', (e) => {\n        if(mousemove && mousedown) {\n          audio.play();\n          mousedown = false;\n        }\n      });\n      attachClickEvent(progress, (e) => {\n        cancelEvent(e);\n        if(!audio.paused) scrub(e);\n      });\n\n      function scrub(e: MouseEvent | TouchEvent) {\n        let offsetX: number;\n        if(e instanceof MouseEvent) {\n          offsetX = e.offsetX;\n        } else { // touch\n          const rect = (e.target as HTMLElement).getBoundingClientRect();\n          offsetX = e.targetTouches[0].pageX - rect.left;\n        }\n\n        const scrubTime = offsetX / availW /* width */ * audio.duration;\n        audio.currentTime = scrubTime;\n      }\n    }, noop);\n\n    return () => {\n      progress.remove();\n      progress = null;\n      audio = null;\n    };\n  };\n\n  return onLoad;\n}\n\nasync function wrapAudio(audioEl: AudioElement) {\n  const withTime = audioEl.withTime;\n\n  const message = audioEl.message;\n  const doc = getMediaFromMessage(message) as MyDocument;\n\n  const isVoice = doc.type === 'voice' || doc.type === 'round';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('audio-description');\n\n  const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n\n  if(!isVoice) {\n    const parts: (Node | string)[] = [];\n    if(audioAttribute?.performer) {\n      parts.push(wrapEmojiText(audioAttribute.performer));\n    }\n\n    if(withTime) {\n      parts.push(formatFullSentTime(message.date));\n    } else if(!parts.length) {\n      parts.push(formatBytes(doc.size));\n    }\n\n    if(audioEl.showSender) {\n      parts.push(await wrapSenderToPeer(message));\n    }\n\n    descriptionEl.append(...joinElementsWith(parts, '  '));\n  }\n\n  const html = `\n  <div class=\"audio-details\">\n    <div class=\"audio-title\"></div>\n    <div class=\"audio-subtitle\"><div class=\"audio-time\"></div></div>\n  </div>`;\n  audioEl.insertAdjacentHTML('beforeend', html);\n\n  const titleEl = audioEl.querySelector('.audio-title') as HTMLElement;\n\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = audioEl.dataset.fontWeight;\n  middleEllipsisEl.dataset.sizeType = audioEl.dataset.sizeType;\n  if(isVoice) {\n    middleEllipsisEl.append(await wrapSenderToPeer(message));\n  } else {\n    setInnerHTML(middleEllipsisEl, wrapEmojiText(audioAttribute?.title ?? doc.file_name));\n  }\n\n  titleEl.append(middleEllipsisEl);\n\n  if(audioEl.showSender) {\n    titleEl.append(wrapSentTime(message));\n  }\n\n  const subtitleDiv = audioEl.querySelector('.audio-subtitle') as HTMLDivElement;\n  subtitleDiv.append(descriptionEl);\n\n  const onLoad = () => {\n    let launched = false;\n\n    let progressLine = new MediaProgressLine(audioEl.audio, doc.supportsStreaming);\n\n    audioEl.addAudioListener('ended', () => {\n      audioEl.classList.remove('audio-show-progress');\n      // Reset subtitle\n      subtitleDiv.lastChild.replaceWith(descriptionEl);\n      launched = false;\n    });\n\n    const onPlay = () => {\n      if(!launched) {\n        audioEl.classList.add('audio-show-progress');\n        launched = true;\n\n        if(progressLine) {\n          subtitleDiv.lastChild.replaceWith(progressLine.container);\n        }\n      }\n    };\n\n    audioEl.addAudioListener('play', onPlay);\n\n    if(!audioEl.audio.paused || audioEl.audio.currentTime > 0) {\n      onPlay();\n    }\n\n    return () => {\n      progressLine.removeListeners();\n      progressLine.container.remove();\n      progressLine = null;\n    };\n  };\n\n  return onLoad;\n}\n\nfunction constructDownloadPreloader(tryAgainOnFail = true) {\n  const preloader = new ProgressivePreloader({cancelable: true, tryAgainOnFail});\n  preloader.construct();\n\n  if(!tryAgainOnFail) {\n    preloader.circle.setAttributeNS(null, 'r', '23');\n    preloader.totalLength = 143.58203125;\n  }\n\n  return preloader;\n}\n\nexport const findMediaTargets = (anchor: HTMLElement, anchorMid: number/* , useSearch: boolean */) => {\n  let prev: MediaItem[], next: MediaItem[];\n  // if(anchor.classList.contains('search-super-item') || !useSearch) {\n  const isBubbles = !anchor.classList.contains('search-super-item');\n  const container = findUpClassName(anchor, !isBubbles ? 'tabs-tab' : 'bubbles-inner');\n  if(container) {\n    const attr = `:not([data-is-outgoing=\"1\"])`;\n    const justAudioSelector = `.audio:not(.is-voice)${attr}`;\n    let selectors: string[];\n    if(!anchor.matches(justAudioSelector)) {\n      selectors = [`.audio.is-voice${attr}`, `.media-round${attr}`];\n    } else {\n      selectors = [justAudioSelector];\n    }\n\n    if(isBubbles) {\n      const prefix = '.bubble:not(.webpage) ';\n      selectors = selectors.map((s) => prefix + s);\n    }\n\n    const selector = selectors.join(', ');\n\n    const elements = Array.from(container.querySelectorAll(selector)) as HTMLElement[];\n    const idx = elements.indexOf(anchor);\n\n    const mediaItems: MediaItem[] = elements.map((element) => ({peerId: element.dataset.peerId.toPeerId(), mid: +element.dataset.mid}));\n\n    prev = mediaItems.slice(0, idx);\n    next = mediaItems.slice(idx + 1);\n  }\n  // }\n\n  if((next.length && next[0].mid < anchorMid) || (prev.length && prev[prev.length - 1].mid > anchorMid)) {\n    [prev, next] = [next.reverse(), prev.reverse()];\n  }\n\n  // prev = next = undefined;\n\n  return [prev, next];\n};\n\nexport default class AudioElement extends HTMLElement {\n  public audio: HTMLAudioElement;\n  public preloader: ProgressivePreloader;\n  public message: Message.message;\n  public withTime = false;\n  public voiceAsMusic = false;\n  public searchContext: MediaSearchContext;\n  public showSender = false;\n  public noAutoDownload: boolean;\n  public lazyLoadQueue: LazyLoadQueue;\n  public loadPromises: Promise<any>[];\n  public managers: AppManagers;\n\n  private listenerSetter = new ListenerSetter();\n  private onTypeDisconnect: () => void;\n  public onLoad: (autoload?: boolean) => void;\n  public readyPromise: CancellablePromise<void>;\n\n  public async render() {\n    this.classList.add('audio');\n    this.managers = rootScope.managers;\n\n    this.dataset.mid = '' + this.message.mid;\n    this.dataset.peerId = '' + this.message.peerId;\n\n    const doc = getMediaFromMessage(this.message) as MyDocument;\n    const isRealVoice = doc.type === 'voice';\n    const isVoice = !this.voiceAsMusic && isRealVoice;\n    const isOutgoing = this.message.pFlags.is_outgoing;\n    const uploadingFileName = this.message?.uploadingFileName;\n\n    const durationStr = toHHMMSS(doc.duration | 0);\n\n    this.innerHTML = `\n    <div class=\"audio-toggle audio-ico\">\n      <div class=\"audio-play-icon\">\n        <div class=\"part one\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n        <div class=\"part two\" x=\"0\" y=\"0\" fill=\"#fff\"></div>\n      </div>\n    </div>`;\n\n    const toggle = this.firstElementChild as HTMLElement;\n\n    const downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('audio-download');\n\n    const isUnread = doc.type !== 'audio' && this.message && this.message.pFlags.media_unread;\n    if(isUnread) {\n      this.classList.add('is-unread');\n    }\n\n    if(uploadingFileName) {\n      this.classList.add('is-outgoing');\n      this.append(downloadDiv);\n    }\n\n    const onTypeLoad = await (isVoice ? wrapVoiceMessage(this) : wrapAudio(this));\n\n    const audioTimeDiv = this.querySelector('.audio-time') as HTMLDivElement;\n    audioTimeDiv.innerHTML = durationStr;\n\n    const onLoad = this.onLoad = (autoload: boolean) => {\n      this.onLoad = undefined;\n\n      const audio = this.audio = appMediaPlaybackController.addMedia(this.message, autoload);\n\n      const readyPromise = this.readyPromise = deferredPromise<void>();\n      if(this.audio.readyState >= this.audio.HAVE_CURRENT_DATA) readyPromise.resolve();\n      else {\n        this.addAudioListener('canplay', () => readyPromise.resolve(), {once: true});\n      }\n\n      this.onTypeDisconnect = onTypeLoad();\n\n      const getTimeStr = () => toHHMMSS(audio.currentTime | 0) + (isVoice ? (' / ' + durationStr) : '');\n\n      const onPlay = () => {\n        audioTimeDiv.innerText = getTimeStr();\n        toggle.classList.toggle('playing', !audio.paused);\n      };\n\n      if(!audio.paused || (audio.currentTime > 0 && audio.currentTime !== audio.duration)) {\n        onPlay();\n      }\n\n      const togglePlay = (e?: Event, paused = audio.paused) => {\n        e && cancelEvent(e);\n\n        if(paused) {\n          const hadSearchContext = !!this.searchContext;\n          if(appMediaPlaybackController.setSearchContext(this.searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(this, this.message.mid/* , this.searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: this.message.peerId, mid: this.message.mid}, prev, next);\n          }\n\n          audio.play().catch(() => {});\n        } else {\n          audio.pause();\n        }\n      };\n\n      attachClickEvent(toggle, (e) => togglePlay(e), {listenerSetter: this.listenerSetter});\n\n      this.addAudioListener('ended', () => {\n        toggle.classList.remove('playing');\n        audioTimeDiv.innerText = durationStr;\n      });\n\n      this.addAudioListener('timeupdate', () => {\n        if((!audio.currentTime && audio.paused) || appMediaPlaybackController.isSafariBuffering(audio)) return;\n        audioTimeDiv.innerText = getTimeStr();\n      });\n\n      this.addAudioListener('pause', () => {\n        toggle.classList.remove('playing');\n      });\n\n      this.addAudioListener('play', onPlay);\n\n      return togglePlay;\n    };\n\n    if(doc.thumbs?.length) {\n      const imgs: HTMLElement[] = [];\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: toggle,\n        boxWidth: 48,\n        boxHeight: 48,\n        loadPromises: this.loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue: this.lazyLoadQueue\n      });\n      toggle.style.width = toggle.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n\n      this.classList.add('audio-with-thumb');\n      imgs.forEach((img) => img.classList.add('audio-thumb'));\n    }\n\n    if(!isOutgoing) {\n      let preloader: ProgressivePreloader = this.preloader;\n\n      const autoDownload = doc.type !== 'audio'/*  || !this.noAutoDownload */;\n      onLoad(autoDownload);\n\n      const r = (shouldPlay: boolean) => {\n        if(this.audio.src) {\n          return;\n        }\n\n        appMediaPlaybackController.resolveWaitingForLoadMedia(this.message.peerId, this.message.mid, this.message.pFlags.is_scheduled);\n\n        const onDownloadInit = () => {\n          if(shouldPlay) {\n            appMediaPlaybackController.willBePlayed(this.audio); // prepare for loading audio\n\n            if(IS_SAFARI && !this.audio.autoplay) {\n              this.audio.autoplay = true;\n            }\n          }\n        };\n\n        onDownloadInit();\n\n        if(!preloader) {\n          if(doc.supportsStreaming) {\n            this.classList.add('corner-download');\n\n            let pauseListener: Listener;\n            const onPlay = () => {\n              const preloader = constructDownloadPreloader(false);\n              const deferred = deferredPromise<void>();\n              deferred.notifyAll({done: 75, total: 100});\n              deferred.catch(() => {\n                this.audio.pause();\n                appMediaPlaybackController.willBePlayed(undefined);\n              });\n              deferred.cancel = () => {\n                deferred.cancel = noop;\n                const err = new Error();\n                (err as any).type = 'CANCELED';\n                deferred.reject(err);\n              };\n              preloader.attach(downloadDiv, false, deferred);\n\n              pauseListener = this.addAudioListener('pause', () => {\n                deferred.cancel();\n              }, {once: true}) as any;\n\n              onDownloadInit();\n            };\n\n            /* if(!this.audio.paused) {\n              onPlay();\n            } */\n\n            const playListener: any = this.addAudioListener('play', onPlay);\n            this.readyPromise.then(() => {\n              this.listenerSetter.remove(playListener);\n              this.listenerSetter.remove(pauseListener);\n            });\n          } else {\n            preloader = constructDownloadPreloader();\n\n            if(!shouldPlay) {\n              this.readyPromise = deferredPromise();\n            }\n\n            const load = () => {\n              onDownloadInit();\n\n              const download = appDownloadManager.downloadMediaURL({media: doc});\n\n              if(!shouldPlay) {\n                download.then(() => {\n                  this.readyPromise.resolve();\n                });\n              }\n\n              preloader.attach(downloadDiv, false, download);\n              return {download};\n            };\n\n            preloader.setDownloadFunction(load);\n            load();\n          }\n        }\n\n        if(this.classList.contains('corner-download')) {\n          toggle.append(downloadDiv);\n        } else {\n          this.append(downloadDiv);\n        }\n\n        this.classList.add('downloading');\n\n        this.readyPromise.then(() => {\n          this.classList.remove('downloading');\n          downloadDiv.classList.add('downloaded');\n          setTimeout(() => {\n            downloadDiv.remove();\n          }, 200);\n\n          // setTimeout(() => {\n          // release loaded audio\n          if(appMediaPlaybackController.willBePlayedMedia === this.audio) {\n            this.audio.play();\n            appMediaPlaybackController.willBePlayed(undefined);\n          }\n          // }, 10e3);\n        });\n      };\n\n      if(!this.audio?.src) {\n        if(autoDownload) {\n          r(false);\n        } else {\n          attachClickEvent(toggle, () => {\n            r(true);\n          }, {once: true, capture: true, passive: false, listenerSetter: this.listenerSetter});\n        }\n      }\n    } else if(uploadingFileName) {\n      this.preloader = constructDownloadPreloader(false);\n      this.preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      this.dataset.isOutgoing = '1';\n      this.preloader.attach(downloadDiv, false);\n      // onLoad();\n    }\n  }\n\n  get addAudioListener() {\n    return this.listenerSetter.add(this.audio);\n  }\n\n  disconnectedCallback() {\n    setTimeout(() => {\n      if(this.isConnected) {\n        return;\n      }\n\n      if(this.onTypeDisconnect) {\n        this.onTypeDisconnect();\n        this.onTypeDisconnect = null;\n      }\n\n      if(this.readyPromise) {\n        this.readyPromise.reject();\n      }\n\n      if(this.listenerSetter) {\n        this.listenerSetter.removeAll();\n        this.listenerSetter = null;\n      }\n\n      if(this.preloader) {\n        this.preloader = null;\n      }\n    }, 100);\n  }\n}\n\ncustomElements.define('audio-element', AudioElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Photo} from '../layer';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class AvatarListLoader<Item extends {photoId: Photo.photo['id']}> extends ListLoader<Item, any> {\n  private peerId: PeerId;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, any>, 'loadMore'> & {peerId: PeerId, managers: AppManagers}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        if(this.peerId.isAnyChat() || !older) return Promise.resolve({count: 0, items: []}); // !  ,    ,    .\n\n        const maxId = anchor?.photoId;\n        return this.managers.appPhotosManager.getUserPhotos(this.peerId, maxId, loadCount).then((value) => {\n          const items = value.photos.map((photoId) => {\n            return {element: null as HTMLElement, photoId} as any;\n          });\n\n          return {count: value.count, items};\n        });\n      }\n    });\n\n    this.loadedAllUp = true;\n    this.peerId = options.peerId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarListLoader from '../helpers/avatarListLoader';\nimport {Photo} from '../layer';\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport rootScope from '../lib/rootScope';\nimport AppMediaViewerBase from './appMediaViewerBase';\n\ntype AppMediaViewerAvatarTargetType = {element: HTMLElement, photoId: Photo.photo['id']};\nexport default class AppMediaViewerAvatar extends AppMediaViewerBase<'', 'delete', AppMediaViewerAvatarTargetType> {\n  public peerId: PeerId;\n\n  constructor(peerId: PeerId) {\n    super(new AvatarListLoader({peerId, managers: rootScope.managers}), [/* 'delete' */]);\n\n    this.peerId = peerId;\n\n    this.setBtnMenuToggle([{\n      icon: 'download',\n      text: 'MediaViewer.Context.Download',\n      onClick: this.onDownloadClick\n    }/* , {\n      icon: 'delete danger btn-disabled',\n      text: 'Delete',\n      onClick: () => {}\n    } */]);\n\n    // * constructing html end\n\n    this.setListeners();\n  }\n\n  onPrevClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, -1);\n  };\n\n  onNextClick = (target: AppMediaViewerAvatarTargetType) => {\n    this.openMedia(target.photoId, target.element, 1);\n  };\n\n  onDownloadClick = async() => {\n    appDownloadManager.downloadToDisc({\n      media: await this.managers.appPhotosManager.getPhoto(this.target.photoId),\n      queueId: appImManager.chat.bubbles.lazyLoadQueue.queueId\n    });\n  };\n\n  public async openMedia(photoId: Photo.photo['id'], target?: HTMLElement, fromRight = 0, prevTargets?: AppMediaViewerAvatarTargetType[], nextTargets?: AppMediaViewerAvatarTargetType[]) {\n    if(this.setMoverPromise) return this.setMoverPromise;\n\n    const photo = await this.managers.appPhotosManager.getPhoto(photoId);\n    const ret = super._openMedia(photo, photo.date, this.peerId, fromRight, target, false, prevTargets, nextTargets);\n    this.target.photoId = photo.id;\n\n    return ret;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {Message, Photo} from '../layer';\r\nimport type LazyLoadQueue from './lazyLoadQueue';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport AppMediaViewer from './appMediaViewer';\r\nimport AppMediaViewerAvatar from './appMediaViewerAvatar';\r\nimport isObject from '../helpers/object/isObject';\r\nimport {ArgumentTypes} from '../types';\r\nimport putPhoto from './putPhoto';\r\nimport {recordPromise} from '../helpers/recordPromise';\r\n\r\nconst onAvatarUpdate = (peerId: PeerId) => {\r\n  (Array.from(document.querySelectorAll('avatar-element[data-peer-id=\"' + peerId + '\"]')) as AvatarElement[]).forEach((elem) => {\r\n    // console.log('updating avatar:', elem);\r\n    elem.update();\r\n  });\r\n};\r\n\r\nrootScope.addEventListener('avatar_update', onAvatarUpdate);\r\nrootScope.addEventListener('peer_title_edit', async(peerId) => {\r\n  if(!(await rootScope.managers.appAvatarsManager.isAvatarCached(peerId))) {\r\n    onAvatarUpdate(peerId);\r\n  }\r\n});\r\n\r\nexport async function openAvatarViewer(\r\n  target: HTMLElement,\r\n  peerId: PeerId,\r\n  middleware: () => boolean,\r\n  message?: any,\r\n  prevTargets?: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[],\r\n  nextTargets?: typeof prevTargets\r\n) {\r\n  let photo = await rootScope.managers.appProfileManager.getFullPhoto(peerId);\r\n  if(!middleware() || !photo) {\r\n    return;\r\n  }\r\n\r\n  const getTarget = () => {\r\n    const good = Array.from(target.querySelectorAll('img')).find((img) => !img.classList.contains('emoji'));\r\n    return good ? target : null;\r\n  };\r\n\r\n  if(peerId.isAnyChat()) {\r\n    const hadMessage = !!message;\r\n    const inputFilter = 'inputMessagesFilterChatPhotos';\r\n    if(!message) {\r\n      message = await rootScope.managers.appMessagesManager.getSearch({\r\n        peerId,\r\n        inputFilter: {_: inputFilter},\r\n        maxId: 0,\r\n        limit: 1\r\n      }).then((value) => {\r\n        // console.log(lol);\r\n        // ! by descend\r\n        return value.history[0];\r\n      });\r\n\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(message) {\r\n      // !   ,  (  )\r\n      const messagePhoto = message.action.photo;\r\n      if(messagePhoto.id !== photo.id) {\r\n        if(!hadMessage) {\r\n          message = rootScope.managers.appMessagesManager.generateFakeAvatarMessage(peerId, photo);\r\n        } else {\r\n\r\n        }\r\n      }\r\n\r\n      const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n        element: el.element,\r\n        mid: (el.item as Message.messageService).mid,\r\n        peerId: (el.item as Message.messageService).peerId\r\n      }));\r\n\r\n      new AppMediaViewer()\r\n      .setSearchContext({\r\n        peerId,\r\n        inputFilter: {_: inputFilter}\r\n      })\r\n      .openMedia(message, getTarget(), undefined, undefined, prevTargets ? f(prevTargets) : undefined, nextTargets ? f(nextTargets) : undefined);\r\n\r\n      return;\r\n    }\r\n  }\r\n\r\n  if(photo) {\r\n    if(!isObject(message) && message) {\r\n      photo = await rootScope.managers.appPhotosManager.getPhoto(message);\r\n    }\r\n\r\n    const f = (arr: typeof prevTargets) => arr.map((el) => ({\r\n      element: el.element,\r\n      photoId: el.item as string\r\n    }));\r\n\r\n    new AppMediaViewerAvatar(peerId).openMedia(\r\n      photo.id,\r\n      getTarget(),\r\n      undefined,\r\n      prevTargets ? f(prevTargets) : undefined,\r\n      nextTargets ? f(nextTargets) : undefined\r\n    );\r\n  }\r\n}\r\n\r\nconst believeMe: Map<PeerId, Set<AvatarElement>> = new Map();\r\nconst seen: Set<PeerId> = new Set();\r\n\r\nexport default class AvatarElement extends HTMLElement {\r\n  public peerId: PeerId;\r\n  public isDialog: boolean;\r\n  public peerTitle: string;\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public isBig: boolean;\r\n  private addedToQueue = false;\r\n\r\n  disconnectedCallback() {\r\n    //         \r\n    // (   ,    /)\r\n    const set = believeMe.get(this.peerId);\r\n    if(set && set.has(this)) {\r\n      set.delete(this);\r\n      if(!set.size) {\r\n        believeMe.delete(this.peerId);\r\n      }\r\n    }\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.unobserve(this);\r\n    }\r\n  }\r\n\r\n  public attachClickEvent() {\r\n    let loading = false;\r\n    attachClickEvent(this, async(e) => {\r\n      cancelEvent(e);\r\n      if(loading) return;\r\n      // console.log('avatar clicked');\r\n      const peerId = this.peerId;\r\n      loading = true;\r\n      await openAvatarViewer(this, this.peerId, () => this.peerId === peerId);\r\n      loading = false;\r\n    });\r\n  }\r\n\r\n  public updateOptions(options: Partial<ArgumentTypes<AvatarElement['updateWithOptions']>[0]>) {\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      this[i] = options[i];\r\n    }\r\n  }\r\n\r\n  public updateWithOptions(options: {\r\n    peerId: PeerId,\r\n    isDialog?: boolean,\r\n    isBig?: boolean,\r\n    peerTitle?: string,\r\n    lazyLoadQueue?: LazyLoadQueue,\r\n    loadPromises?: Promise<any>[]\r\n  }) {\r\n    const wasPeerId = this.peerId;\r\n    this.updateOptions(options);\r\n    const newPeerId = this.peerId;\r\n\r\n    if(wasPeerId === newPeerId) {\r\n      return;\r\n    }\r\n\r\n    this.peerId = /* rootScope.managers.appPeersManager.getPeerMigratedTo(newPeerId) ||  */newPeerId;\r\n    this.dataset.peerId = '' + newPeerId;\r\n\r\n    if(wasPeerId) {\r\n      const set = believeMe.get(wasPeerId);\r\n      if(set) {\r\n        set.delete(this);\r\n        if(!set.size) {\r\n          believeMe.delete(wasPeerId);\r\n        }\r\n      }\r\n    }\r\n\r\n    return this.update();\r\n  }\r\n\r\n  private r(onlyThumb = false) {\r\n    const promise = putPhoto(this, this.peerId, this.isDialog, this.peerTitle, onlyThumb, this.isBig);\r\n    // recordPromise(promise, 'avatar putPhoto-' + this.peerId);\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises.push(promise);\r\n\r\n      promise.finally(() => {\r\n        this.loadPromises = undefined;\r\n      });\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public update() {\r\n    if(this.lazyLoadQueue) {\r\n      if(!seen.has(this.peerId)) {\r\n        if(this.addedToQueue) return;\r\n        this.addedToQueue = true;\r\n\r\n        let set = believeMe.get(this.peerId);\r\n        if(!set) {\r\n          set = new Set();\r\n          believeMe.set(this.peerId, set);\r\n        }\r\n\r\n        set.add(this);\r\n\r\n        this.lazyLoadQueue.push({\r\n          div: this,\r\n          load: () => {\r\n            seen.add(this.peerId);\r\n            return this.update();\r\n          }\r\n        });\r\n\r\n        return this.r(true);\r\n      } else if(this.addedToQueue) {\r\n        this.lazyLoadQueue.unobserve(this);\r\n      }\r\n    }\r\n\r\n    seen.add(this.peerId);\r\n\r\n    const promise = this.r();\r\n\r\n    if(this.addedToQueue) {\r\n      promise.finally(() => {\r\n        this.addedToQueue = false;\r\n      });\r\n    }\r\n\r\n    const set = believeMe.get(this.peerId);\r\n    if(set) {\r\n      set.delete(this);\r\n      const arr = Array.from(set);\r\n      believeMe.delete(this.peerId);\r\n\r\n\r\n      for(let i = 0, length = arr.length; i < length; ++i) {\r\n        arr[i].update();\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\ncustomElements.define('avatar-element', AvatarElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport type {InputFile} from '../layer';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport PopupElement from './popups';\r\nimport PopupAvatar from './popups/avatar';\r\n\r\nexport default class AvatarEdit {\r\n  public container: HTMLElement;\r\n  private canvas: HTMLCanvasElement;\r\n  private icon: HTMLSpanElement;\r\n\r\n  constructor(onChange: (uploadAvatar: () => CancellablePromise<InputFile>) => void) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('avatar-edit');\r\n\r\n    this.canvas = document.createElement('canvas');\r\n    this.canvas.classList.add('avatar-edit-canvas');\r\n\r\n    this.icon = document.createElement('span');\r\n    this.icon.classList.add('tgico', 'tgico-cameraadd');\r\n\r\n    this.container.append(this.canvas, this.icon);\r\n\r\n    attachClickEvent(this.container, () => {\r\n      PopupElement.createPopup(PopupAvatar).open(this.canvas, onChange);\r\n    });\r\n  }\r\n\r\n  public clear() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ripple from './ripple';\r\n\r\nexport type ButtonOptions = Partial<{\r\n  noRipple: true,\r\n  onlyMobile: true,\r\n  icon: string,\r\n  rippleSquare: true,\r\n  text: LangPackKey,\r\n  disabled: boolean,\r\n  asDiv: boolean\r\n}>;\r\n\r\nconst Button = (className: string, options: ButtonOptions = {}) => {\r\n  const button: HTMLButtonElement = document.createElement(options.asDiv ? 'div' : 'button') as any;\r\n  button.className = className + (options.icon ? ' tgico-' + options.icon : '');\r\n\r\n  if(!options.noRipple) {\r\n    if(options.rippleSquare) {\r\n      button.classList.add('rp-square');\r\n    }\r\n\r\n    ripple(button);\r\n  }\r\n\r\n  if(options.onlyMobile) {\r\n    button.classList.add('only-handhelds');\r\n  }\r\n\r\n  if(options.disabled) {\r\n    button.setAttribute('disabled', 'true');\r\n  }\r\n\r\n  if(options.text) {\r\n    button.append(i18n(options.text));\r\n  }\r\n\r\n  return button;\r\n};\r\n\r\nexport default Button;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonCorner = (options: Partial<{className: string, icon: string, noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-circle btn-corner z-depth-1' + (options.className ? ' ' + options.className : ''), options);\r\n  return button;\r\n};\r\n\r\nexport default ButtonCorner;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Button from './button';\r\n\r\nconst ButtonIcon = (className?: string, options: Partial<{noRipple: true, onlyMobile: true, asDiv: boolean}> = {}) => {\r\n  const button = Button('btn-icon', {\r\n    icon: className || undefined,\r\n    ...options\r\n  });\r\n\r\n  return button;\r\n};\r\n\r\nexport default ButtonIcon;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport contextMenuController from '../helpers/contextMenuController';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {AttachClickOptions, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\nimport CheckboxField from './checkboxField';\n\nexport type ButtonMenuItemOptions = {\n  icon?: string,\n  text?: LangPackKey,\n  textArgs?: FormatterArguments,\n  regularText?: string,\n  onClick: (e: MouseEvent | TouchEvent) => void | boolean | any,\n  element?: HTMLElement,\n  textElement?: HTMLElement,\n  options?: AttachClickOptions,\n  checkboxField?: CheckboxField,\n  noCheckboxClickListener?: boolean,\n  keepOpen?: boolean\n  /* , cancelEvent?: true */\n};\n\nconst ButtonMenuItem = (options: ButtonMenuItemOptions) => {\n  if(options.element) return options.element;\n\n  const {icon, text, onClick, checkboxField, noCheckboxClickListener} = options;\n  const el = document.createElement('div');\n  el.className = 'btn-menu-item rp-overflow' + (icon ? ' tgico-' + icon : '');\n  // ripple(el);\n\n  let textElement = options.textElement;\n  if(!textElement) {\n    textElement = options.textElement = text ? i18n(text, options.textArgs) : document.createElement('span');\n    if(options.regularText) textElement.innerHTML = options.regularText;\n  }\n\n  textElement.classList.add('btn-menu-item-text');\n  el.append(textElement);\n\n  const keepOpen = !!checkboxField || !!options.keepOpen;\n\n  // * cancel mobile keyboard close\n  onClick && attachClickEvent(el, /* CLICK_EVENT_NAME !== 'click' || keepOpen ? */ (e) => {\n    cancelEvent(e);\n\n    const menu = findUpClassName(e.target, 'btn-menu');\n    if(menu && !menu.classList.contains('active')) {\n      return;\n    }\n\n    const result = onClick(e);\n\n    if(result === false) {\n      return;\n    }\n\n    if(!keepOpen) {\n      contextMenuController.close();\n    }\n\n    if(checkboxField && !noCheckboxClickListener/*  && result !== false */) {\n      checkboxField.checked = checkboxField.input.type === 'radio' ? true : !checkboxField.checked;\n    }\n  }/*  : onClick */, options.options);\n\n  if(checkboxField) {\n    el.append(checkboxField.label);\n  }\n\n  return options.element = el;\n};\n\nconst ButtonMenu = (buttons: ButtonMenuItemOptions[], listenerSetter?: ListenerSetter) => {\n  const el = document.createElement('div');\n  el.classList.add('btn-menu');\n\n  if(listenerSetter) {\n    buttons.forEach((b) => {\n      if(b.options) {\n        b.options.listenerSetter = listenerSetter;\n      } else {\n        b.options = {listenerSetter};\n      }\n    });\n  }\n\n  const items = buttons.map(ButtonMenuItem);\n\n  el.append(...items);\n\n  return el;\n};\n\nexport default ButtonMenu;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../helpers/contextMenuController';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {AttachClickOptions, CLICK_EVENT_NAME} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonIcon from './buttonIcon';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\r\n\r\nconst ButtonMenuToggle = (\r\n  options: Partial<{\r\n    noRipple: true,\r\n    onlyMobile: true,\r\n    listenerSetter: ListenerSetter,\r\n    asDiv: boolean,\r\n    container: HTMLElement\r\n  }> = {},\r\n  direction: 'bottom-left' | 'bottom-right' | 'top-left' | 'top-right',\r\n  buttons: ButtonMenuItemOptions[],\r\n  onOpen?: (e: Event) => void,\r\n  onClose?: () => void\r\n) => {\r\n  options.asDiv = true;\r\n  const button = options.container ?? ButtonIcon('more', options);\r\n  button.classList.add('btn-menu-toggle');\r\n\r\n  const btnMenu = ButtonMenu(buttons, options.listenerSetter);\r\n  btnMenu.classList.add(direction);\r\n  ButtonMenuToggleHandler(button, onOpen, options, onClose);\r\n  button.append(btnMenu);\r\n  return button;\r\n};\r\n\r\n// TODO: refactor for attachClickEvent, because if move finger after touchstart, it will start anyway\r\nconst ButtonMenuToggleHandler = (el: HTMLElement, onOpen?: (e: Event) => void | Promise<any>, options?: AttachClickOptions, onClose?: () => void) => {\r\n  const add = options?.listenerSetter ? options.listenerSetter.add(el) : el.addEventListener.bind(el);\r\n\r\n  // console.trace('ButtonMenuToggleHandler attach', el, onOpen, options);\r\n  add(CLICK_EVENT_NAME, (e: Event) => {\r\n    // console.log('ButtonMenuToggleHandler click', e);\r\n    if(!el.classList.contains('btn-menu-toggle')) return false;\r\n\r\n    // window.removeEventListener('mousemove', onMouseMove);\r\n    const openedMenu = el.querySelector('.btn-menu') as HTMLDivElement;\r\n    cancelEvent(e);\r\n\r\n    if(el.classList.contains('menu-open')) {\r\n      contextMenuController.close();\r\n    } else {\r\n      const result = onOpen && onOpen(e);\r\n      const open = () => {\r\n        contextMenuController.openBtnMenu(openedMenu, onClose);\r\n      };\r\n\r\n      if(result instanceof Promise) {\r\n        result.then(open);\r\n      } else {\r\n        open();\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nexport {ButtonMenuToggleHandler};\r\nexport default ButtonMenuToggle;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko, Artem Kolnogorov and unknown creator of the script taken from http://useless.altervista.org/gradient.html\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animateSingle} from '../../helpers/animation';\nimport {hexToRgb} from '../../helpers/color';\nimport {easeOutCubicApply} from '../../helpers/easing/easeOutCubic';\nimport {easeOutQuadApply} from '../../helpers/easing/easeOutQuad';\n\nconst WIDTH = 50;\nconst HEIGHT = WIDTH;\n\nexport default class ChatBackgroundGradientRenderer {\n  private readonly _width = WIDTH;\n  private readonly _height = HEIGHT;\n  private _phase: number;\n  private _tail: number;\n  private readonly _tails = 90;\n  private readonly _scrollTails = 50;\n  private _frames: ImageData[];\n  private _colors: {r: number, g: number, b: number}[];\n  private readonly _curve = [\n    0, 0.25, 0.50, 0.75, 1, 1.5, 2, 2.5, 3, 3.5, 4, 5, 6, 7, 8, 9, 10, 11, 12,\n    13, 14, 15, 16, 17, 18, 18.3, 18.6, 18.9, 19.2, 19.5, 19.8, 20.1, 20.4, 20.7,\n    21.0, 21.3, 21.6, 21.9, 22.2, 22.5, 22.8, 23.1, 23.4, 23.7, 24.0, 24.3, 24.6,\n    24.9, 25.2, 25.5, 25.8, 26.1, 26.3, 26.4, 26.5, 26.6, 26.7, 26.8, 26.9, 27\n  ];\n  private readonly _incrementalCurve: number[];\n  private readonly _positions = [\n    {x: 0.80, y: 0.10},\n    {x: 0.60, y: 0.20},\n    {x: 0.35, y: 0.25},\n    {x: 0.25, y: 0.60},\n    {x: 0.20, y: 0.90},\n    {x: 0.40, y: 0.80},\n    {x: 0.65, y: 0.75},\n    {x: 0.75, y: 0.40}\n  ];\n  private readonly _phases = this._positions.length;\n  private _onWheelRAF: number;\n  private _scrollDelta: number;\n\n  // private _ts = 0;\n  // private _fps = 15;\n  // private _frametime = 1000 / this._fps;\n  // private _raf: number;\n\n  private _canvas: HTMLCanvasElement;\n  private _ctx: CanvasRenderingContext2D;\n  private _hc: HTMLCanvasElement;\n  private _hctx: CanvasRenderingContext2D;\n\n  private _addedScrollListener: boolean;\n  private _animatingToNextPosition: boolean;\n  private _nextPositionTail: number;\n  private _nextPositionTails: number;\n  private _nextPositionLeft: number;\n\n  constructor() {\n    const diff = this._tails / this._curve[this._curve.length - 1];\n\n    for(let i = 0, length = this._curve.length; i < length; ++i) {\n      this._curve[i] = this._curve[i] * diff;\n    }\n\n    this._incrementalCurve = this._curve.map((v, i, arr) => {\n      return v - (arr[i - 1] ?? 0);\n    });\n  }\n\n  private hexToRgb(hex: string) {\n    const result = hexToRgb(hex);\n    return {r: result[0], g: result[1], b: result[2]};\n  }\n\n  private getPositions(shift: number) {\n    const positions = this._positions.slice();\n    positions.push(...positions.splice(0, shift));\n\n    const result: typeof positions = [];\n    for(let i = 0; i < positions.length; i += 2) {\n      result.push(positions[i]);\n    }\n    return result;\n  }\n\n  private getNextPositions(phase: number, curveMax: number, curve: number[]) {\n    const pos = this.getPositions(phase);\n    if(!curve[0] && curve.length === 1) {\n      return [pos];\n    }\n\n    const nextPos = this.getPositions(++phase % this._phases);\n    const distances = nextPos.map((nextPos, idx) => {\n      return {\n        x: (nextPos.x - pos[idx].x) / curveMax,\n        y: (nextPos.y - pos[idx].y) / curveMax\n      };\n    });\n\n    const positions = curve.map((value) => {\n      return distances.map((distance, idx) => {\n        return {\n          x: pos[idx].x + distance.x * value,\n          y: pos[idx].y + distance.y * value\n        };\n      });\n    });\n\n    return positions;\n  }\n\n  private curPosition(phase: number, tail: number) {\n    const positions = this.getNextPositions(phase, this._tails, [tail]);\n    return positions[0];\n  }\n\n  private changeTail(diff: number) {\n    this._tail += diff;\n\n    while(this._tail >= this._tails) {\n      this._tail -= this._tails;\n      if(++this._phase >= this._phases) {\n        this._phase -= this._phases;\n      }\n    }\n\n    while(this._tail < 0) {\n      this._tail += this._tails;\n      if(--this._phase < 0) {\n        this._phase += this._phases;\n      }\n    }\n  }\n\n  private onWheel = (e: {deltaY: number}) => {\n    if(this._animatingToNextPosition) {\n      return;\n    }\n\n    this._scrollDelta += e.deltaY;\n    if(this._onWheelRAF === undefined) {\n      this._onWheelRAF = requestAnimationFrame(this.drawOnWheel);\n    }\n  };\n\n  private changeTailAndDraw(diff: number) {\n    this.changeTail(diff);\n    const curPos = this.curPosition(this._phase, this._tail);\n    this.drawGradient(curPos);\n  }\n\n  private drawOnWheel = () => {\n    const value = this._scrollDelta / this._scrollTails;\n    this._scrollDelta %= this._scrollTails;\n    const diff = value > 0 ? Math.floor(value) : Math.ceil(value);\n    if(diff) {\n      this.changeTailAndDraw(diff);\n    }\n    this._onWheelRAF = undefined;\n  };\n\n  private drawNextPositionAnimated = (getProgress?: () => number) => {\n    let done: boolean, id: ImageData;\n    if(getProgress) {\n      const value = getProgress();\n      done = value >= 1;\n      const transitionValue = easeOutQuadApply(value, 1);\n      const nextPositionTail = this._nextPositionTail ?? 0;\n      const tail = this._nextPositionTail = this._nextPositionTails * transitionValue;\n      const diff = tail - nextPositionTail;\n      if(diff) {\n        this._nextPositionLeft -= diff;\n        this.changeTailAndDraw(diff);\n      }\n    } else {\n      const frames = this._frames;\n      id = frames.shift();\n      done = !frames.length;\n    }\n\n    if(id) {\n      this.drawImageData(id);\n    }\n\n    if(done) {\n      this._nextPositionLeft = undefined;\n      this._nextPositionTails = undefined;\n      this._nextPositionTail = undefined;\n      this._animatingToNextPosition = undefined;\n    }\n\n    return !done;\n  };\n\n  private getGradientImageData(positions: {x: number, y: number}[]) {\n    const id = this._hctx.createImageData(this._width, this._height);\n    const pixels = id.data;\n\n    let offset = 0;\n    for(let y = 0; y < this._height; ++y) {\n      const directPixelY = y / this._height;\n      const centerDistanceY = directPixelY - 0.5;\n      const centerDistanceY2 = centerDistanceY * centerDistanceY;\n\n      for(let x = 0; x < this._width; ++x) {\n        const directPixelX = x / this._width;\n\n        const centerDistanceX = directPixelX - 0.5;\n        const centerDistance = Math.sqrt(centerDistanceX * centerDistanceX + centerDistanceY2);\n\n        const swirlFactor = 0.35 * centerDistance;\n        const theta = swirlFactor * swirlFactor * 0.8 * 8.0;\n        const sinTheta = Math.sin(theta);\n        const cosTheta = Math.cos(theta);\n\n        const pixelX = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * cosTheta - centerDistanceY * sinTheta));\n        const pixelY = Math.max(0.0, Math.min(1.0, 0.5 + centerDistanceX * sinTheta + centerDistanceY * cosTheta));\n\n        let distanceSum = 0.0;\n\n        let r = 0.0;\n        let g = 0.0;\n        let b = 0.0;\n\n        for(let i = 0; i < this._colors.length; i++) {\n          const colorX = positions[i].x;\n          const colorY = positions[i].y;\n\n          const distanceX = pixelX - colorX;\n          const distanceY = pixelY - colorY;\n\n          let distance = Math.max(0.0, 0.9 - Math.sqrt(distanceX * distanceX + distanceY * distanceY));\n          distance = distance * distance * distance * distance;\n          distanceSum += distance;\n\n          r += distance * this._colors[i].r / 255;\n          g += distance * this._colors[i].g / 255;\n          b += distance * this._colors[i].b / 255;\n        }\n\n        pixels[offset++] = r / distanceSum * 255.0;\n        pixels[offset++] = g / distanceSum * 255.0;\n        pixels[offset++] = b / distanceSum * 255.0;\n        pixels[offset++] = 0xFF;\n      }\n    }\n    return id;\n  }\n\n  private drawImageData(id: ImageData) {\n    this._hctx.putImageData(id, 0, 0);\n    this._ctx.drawImage(this._hc, 0, 0, this._width, this._height);\n  }\n\n  private drawGradient(positions: {x: number, y: number}[]) {\n    this.drawImageData(this.getGradientImageData(positions));\n  }\n\n  // private doAnimate = () => {\n  //   const now = +Date.now();\n  //   if(!document.hasFocus() || (now - this._ts) < this._frametime) {\n  //     this._raf = requestAnimationFrame(this.doAnimate);\n  //     return;\n  //   }\n\n  //   this._ts = now;\n  //   this.changeTail(1);\n  //   const cur_pos = this.curPosition(this._phase, this._tail);\n  //   this.drawGradient(cur_pos);\n  //   this._raf = requestAnimationFrame(this.doAnimate);\n  // };\n\n  // public animate(start?: boolean) {\n  //   if(!start) {\n  //     cancelAnimationFrame(this._raf);\n  //     return;\n  //   }\n  //   this.doAnimate();\n  // }\n\n  public init(el: HTMLCanvasElement) {\n    this._frames = [];\n    this._phase = 0;\n    this._tail = 0;\n    this._scrollDelta = 0;\n    if(this._onWheelRAF !== undefined) {\n      cancelAnimationFrame(this._onWheelRAF);\n      this._onWheelRAF = undefined;\n    }\n\n    const colors = el.getAttribute('data-colors').split(',').reverse();\n    this._colors = colors.map((color) => {\n      return this.hexToRgb(color);\n    });\n\n    if(!this._hc) {\n      this._hc = document.createElement('canvas');\n      this._hc.width = this._width;\n      this._hc.height = this._height;\n      this._hctx = this._hc.getContext('2d', {alpha: false});\n    }\n\n    this._canvas = el;\n    this._ctx = this._canvas.getContext('2d', {alpha: false});\n    this.update();\n  }\n\n  public update() {\n    if(this._colors.length < 2) {\n      const color = this._colors[0];\n      this._ctx.fillStyle = `rgb(${color.r}, ${color.g}, ${color.b})`;\n      this._ctx.fillRect(0, 0, this._width, this._height);\n      return;\n    }\n\n    const pos = this.curPosition(this._phase, this._tail);\n    this.drawGradient(pos);\n  }\n\n  public toNextPosition(getProgress?: () => number) {\n    if(this._colors.length < 2) {\n      return;\n    }\n\n    if(getProgress) {\n      this._nextPositionLeft = this._tails + (this._nextPositionLeft ?? 0);\n      this._nextPositionTails = this._nextPositionLeft;\n      this._nextPositionTail = undefined;\n      this._animatingToNextPosition = true;\n      animateSingle(this.drawNextPositionAnimated.bind(this, getProgress), this);\n      return;\n    }\n\n    const tail = this._tail;\n    const tails = this._tails;\n\n    let nextPhaseOnIdx: number;\n\n    const curve: number[] = [];\n    for(let i = 0, length = this._incrementalCurve.length; i < length; ++i) {\n      const inc = this._incrementalCurve[i];\n      let value = (curve[i - 1] ?? tail) + inc;\n\n      if(+value.toFixed(2) > tails && nextPhaseOnIdx === undefined) {\n        nextPhaseOnIdx = i;\n        value %= tails;\n      }\n\n      curve.push(value);\n    }\n\n    const currentPhaseCurve = curve.slice(0, nextPhaseOnIdx);\n    const nextPhaseCurve = nextPhaseOnIdx !== undefined ? curve.slice(nextPhaseOnIdx) : [];\n\n    [currentPhaseCurve, nextPhaseCurve].forEach((curve, idx, curves) => {\n      const last = curve[curve.length - 1];\n      if(last !== undefined && last > tails) {\n        curve[curve.length - 1] = +last.toFixed(2);\n      }\n\n      this._tail = last ?? 0;\n\n      if(!curve.length) {\n        return;\n      }\n\n      const positions = this.getNextPositions(this._phase, tails, curve);\n      if(idx !== (curves.length - 1)) {\n        if(++this._phase >= this._phases) {\n          this._phase -= this._phases;\n        }\n      }\n\n      const ids = positions.map((pos) => {\n        return this.getGradientImageData(pos);\n      });\n\n      this._frames.push(...ids);\n    });\n\n    this._animatingToNextPosition = true;\n    animateSingle(this.drawNextPositionAnimated, this);\n  }\n\n  // public toNextPositionThrottled = throttle(this.toNextPosition.bind(this), 100, true);\n\n  public scrollAnimate(start?: boolean) {\n    // return;\n\n    if(this._colors.length < 2 && start) {\n      return;\n    }\n\n    if(start && !this._addedScrollListener) {\n      document.addEventListener('wheel', this.onWheel);\n      this._addedScrollListener = true;\n    } else if(!start && this._addedScrollListener) {\n      document.removeEventListener('wheel', this.onWheel);\n      this._addedScrollListener = false;\n    }\n  }\n\n  public cleanup() {\n    this.scrollAnimate(false);\n    // this.animate(false);\n  }\n\n  public static createCanvas(colors?: string) {\n    const canvas = document.createElement('canvas');\n    canvas.width = WIDTH;\n    canvas.height = HEIGHT;\n    if(colors !== undefined) {\n      canvas.dataset.colors = colors;\n    }\n\n    return canvas;\n  }\n\n  public static create(colors?: string) {\n    const canvas = this.createCanvas(colors);\n    const gradientRenderer = new ChatBackgroundGradientRenderer();\n    gradientRenderer.init(canvas);\n\n    return {gradientRenderer, canvas};\n  }\n}\n","export default function easeOutQuad(t: number, b: number, c: number, d: number) {\n  return t >= d ? b + c : easeOutQuadApply(t / d, c) + b;\n}\n\nexport function easeOutQuadApply(v: number, c: number) {\n  return -c * v * (v - 2);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager, MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport type ChatBubbles from './bubbles';\nimport type ChatInput from './input';\nimport type Chat from './chat';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport CheckboxField from '../checkboxField';\nimport PopupDeleteMessages from '../popups/deleteMessages';\nimport PopupForward from '../popups/forward';\nimport SetTransition from '../singleTransition';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupSendNow from '../popups/sendNow';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport I18n, {i18n, _i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport cancelSelection from '../../helpers/dom/cancelSelection';\nimport getSelectedText from '../../helpers/dom/getSelectedText';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport AppSearchSuper from '../appSearchSuper.';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {randomLong} from '../../helpers/random';\nimport {attachClickEvent, AttachClickOptions} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport filterUnique from '../../helpers/array/filterUnique';\nimport appImManager from '../../lib/appManagers/appImManager';\n\nconst accumulateMapSet = (map: Map<any, Set<number>>) => {\n  return [...map.values()].reduce((acc, v) => acc + v.size, 0);\n};\n\n// const MIN_CLICK_MOVE = 32; // minimum bubble height\n\nclass AppSelection extends EventListenerBase<{\n  toggle: (isSelecting: boolean) => void\n}> {\n  public selectedMids: Map<PeerId, Set<number>> = new Map();\n  public isSelecting = false;\n\n  public selectedText: string;\n\n  protected listenerSetter: ListenerSetter;\n  protected isScheduled: boolean;\n  protected listenElement: HTMLElement;\n\n  protected onToggleSelection: (forwards: boolean, animate: boolean) => void | Promise<void>;\n  protected onUpdateContainer: (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => void;\n  protected onCancelSelection: () => void;\n  protected toggleByMid: (peerId: PeerId, mid: number) => void;\n  protected toggleByElement: (bubble: HTMLElement) => void;\n\n  protected navigationType: NavigationItem['type'];\n\n  protected getElementFromTarget: (target: HTMLElement) => HTMLElement;\n  protected verifyTarget: (e: MouseEvent, target: HTMLElement) => boolean;\n  protected verifyMouseMoveTarget: (e: MouseEvent, element: HTMLElement, selecting: boolean) => boolean;\n  protected verifyTouchLongPress: () => boolean;\n  protected targetLookupClassName: string;\n  protected lookupBetweenParentClassName: string;\n  protected lookupBetweenElementsQuery: string;\n\n  protected doNotAnimate: boolean;\n  protected managers: AppManagers;\n\n  constructor(options: {\n    managers: AppManagers,\n    getElementFromTarget: AppSelection['getElementFromTarget'],\n    verifyTarget?: AppSelection['verifyTarget'],\n    verifyMouseMoveTarget?: AppSelection['verifyMouseMoveTarget'],\n    verifyTouchLongPress?: AppSelection['verifyTouchLongPress'],\n    targetLookupClassName: string,\n    lookupBetweenParentClassName: string,\n    lookupBetweenElementsQuery: string,\n    isScheduled?: AppSelection['isScheduled']\n  }) {\n    super(false);\n\n    safeAssign(this, options);\n\n    this.navigationType = 'multiselect-' + randomLong() as any;\n  }\n\n  public attachListeners(listenElement: HTMLElement, listenerSetter: ListenerSetter) {\n    if(this.listenElement) {\n      this.listenerSetter.removeAll();\n    }\n\n    this.listenElement = listenElement;\n    this.listenerSetter = listenerSetter;\n\n    if(!listenElement) {\n      return;\n    }\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(listenElement)('touchend', () => {\n        if(!this.isSelecting) return;\n        this.selectedText = getSelectedText();\n      });\n\n      attachContextMenuListener(listenElement, (e) => {\n        if(this.isSelecting || (this.verifyTouchLongPress && !this.verifyTouchLongPress())) return;\n\n        // * these two lines will fix instant text selection on iOS Safari\n        document.body.classList.add('no-select'); // * need no-select on body because chat-input transforms in channels\n        listenElement.addEventListener('touchend', (e) => {\n          cancelEvent(e); // ! this one will fix propagation to document loader button, etc\n          document.body.classList.remove('no-select');\n\n          // this.chat.bubbles.onBubblesClick(e);\n        }, {once: true, capture: true});\n\n        cancelSelection();\n        // cancelEvent(e as any);\n        const element = this.getElementFromTarget(e.target as HTMLElement);\n        if(element) {\n          this.toggleByElement(element);\n        }\n      }, listenerSetter);\n\n      return;\n    }\n\n    listenerSetter.add(listenElement)('mousedown', this.onMouseDown);\n  }\n\n  private onMouseDown = (e: MouseEvent) => {\n    // console.log('selection mousedown', e);\n    const element = findUpClassName(e.target, this.targetLookupClassName);\n    if(e.button !== 0) {\n      return;\n    }\n\n    if(this.verifyTarget && !this.verifyTarget(e, element)) {\n      return;\n    }\n\n    const seen: AppSelection['selectedMids'] = new Map();\n    let selecting: boolean;\n\n    /* let good = false;\n    const {x, y} = e; */\n\n    /* const bubbles = appImManager.bubbles;\n    for(const mid in bubbles) {\n      const bubble = bubbles[mid];\n      bubble.addEventListener('mouseover', () => {\n        console.log('mouseover');\n      }, {once: true});\n    } */\n\n    let firstTarget = element;\n\n    const processElement = (element: HTMLElement, checkBetween = true) => {\n      const mid = +element.dataset.mid;\n      if(!mid || !element.dataset.peerId) return;\n      const peerId = element.dataset.peerId.toPeerId();\n\n      if(!isInDOM(firstTarget)) {\n        firstTarget = element;\n      }\n\n      let seenSet = seen.get(peerId);\n      if(!seenSet) {\n        seen.set(peerId, seenSet = new Set());\n      }\n\n      if(seenSet.has(mid)) {\n        return;\n      }\n\n      const isSelected = this.isMidSelected(peerId, mid);\n      if(selecting === undefined) {\n        // bubblesContainer.classList.add('no-select');\n        selecting = !isSelected;\n      }\n\n      seenSet.add(mid);\n\n      if((selecting && !isSelected) || (!selecting && isSelected)) {\n        const seenLength = accumulateMapSet(seen);\n        if(this.toggleByElement && checkBetween) {\n          if(seenLength < 2) {\n            if(findUpAsChild(element, firstTarget)) {\n              firstTarget = element;\n            }\n          }\n\n          const elementsBetween = this.getElementsBetween(firstTarget, element);\n          // console.log(elementsBetween);\n          if(elementsBetween.length) {\n            elementsBetween.forEach((element) => {\n              processElement(element, false);\n            });\n          }\n        }\n\n        if(!this.selectedMids.size) {\n          if(seenLength === 2 && this.toggleByMid) {\n            for(const [peerId, mids] of seen) {\n              for(const mid of mids) {\n                this.toggleByMid(peerId, mid);\n              }\n            }\n          }\n        } else if(this.toggleByElement) {\n          this.toggleByElement(element);\n        }\n      }\n    };\n\n    // const foundTargets: Map<HTMLElement, true> = new Map();\n    let canceledSelection = false;\n    const onMouseMove = (e: MouseEvent) => {\n      if(!canceledSelection) {\n        cancelSelection();\n        canceledSelection = true;\n      }\n      /* if(!good) {\n        if(Math.abs(e.x - x) > MIN_CLICK_MOVE || Math.abs(e.y - y) > MIN_CLICK_MOVE) {\n          good = true;\n        } else {\n          return;\n        }\n      } */\n\n      /* if(foundTargets.has(e.target as HTMLElement)) return;\n      foundTargets.set(e.target as HTMLElement, true); */\n      const element = this.getElementFromTarget(e.target as HTMLElement);\n      if(!element) {\n        // console.error('found no bubble', e);\n        return;\n      }\n\n      if(this.verifyMouseMoveTarget && !this.verifyMouseMoveTarget(e, element, selecting)) {\n        this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n        this.listenerSetter.removeManual(document, 'mouseup', onMouseUp, documentListenerOptions);\n        return;\n      }\n\n      processElement(element);\n    };\n\n    const onMouseUp = (e: MouseEvent) => {\n      if(seen.size) {\n        attachClickEvent(window, cancelEvent, {capture: true, once: true, passive: false});\n      }\n\n      this.listenerSetter.removeManual(this.listenElement, 'mousemove', onMouseMove);\n      // bubblesContainer.classList.remove('no-select');\n\n      // ! CANCEL USER SELECTION !\n      cancelSelection();\n    };\n\n    const documentListenerOptions = {once: true};\n    this.listenerSetter.add(this.listenElement)('mousemove', onMouseMove);\n    this.listenerSetter.add(document)('mouseup', onMouseUp, documentListenerOptions);\n  };\n\n  private getElementsBetween = (first: HTMLElement, last: HTMLElement) => {\n    if(first === last) {\n      return [];\n    }\n\n    const firstRect = first.getBoundingClientRect();\n    const lastRect = last.getBoundingClientRect();\n    const difference = (firstRect.top - lastRect.top) || (firstRect.left - lastRect.left);\n    const isHigher = difference < 0;\n\n    const parent = findUpClassName(first, this.lookupBetweenParentClassName);\n    if(!parent) {\n      return [];\n    }\n\n    const elements = Array.from(parent.querySelectorAll(this.lookupBetweenElementsQuery)) as HTMLElement[];\n    let firstIndex = elements.indexOf(first);\n    let lastIndex = elements.indexOf(last);\n\n    if(!isHigher) {\n      [lastIndex, firstIndex] = [firstIndex, lastIndex];\n    }\n\n    const slice = elements.slice(firstIndex + 1, lastIndex);\n\n    // console.log('getElementsBetween', first, last, slice, firstIndex, lastIndex, isHigher);\n\n    return slice;\n  };\n\n  protected isElementShouldBeSelected(element: HTMLElement) {\n    return this.isMidSelected(element.dataset.peerId.toPeerId(), +element.dataset.mid);\n  }\n\n  protected appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    element.prepend(checkboxField.label);\n  }\n\n  public toggleElementCheckbox(element: HTMLElement, show: boolean) {\n    const hasCheckbox = !!this.getCheckboxInputFromElement(element);\n    if(show) {\n      if(hasCheckbox) {\n        return false;\n      }\n\n      const checkboxField = new CheckboxField({\n        name: element.dataset.mid,\n        round: true\n      });\n\n      // * if it is a render of new message\n      if(this.isSelecting) { // ! avoid breaking animation on start\n        if(this.isElementShouldBeSelected(element)) {\n          checkboxField.input.checked = true;\n          element.classList.add('is-selected');\n        }\n      }\n\n      this.appendCheckbox(element, checkboxField);\n    } else if(hasCheckbox) {\n      this.getCheckboxInputFromElement(element).parentElement.remove();\n      SetTransition(element, 'is-selected', false, 200);\n    }\n\n    return true;\n  }\n\n  protected getCheckboxInputFromElement(element: HTMLElement): HTMLInputElement {\n    return element.firstElementChild?.tagName === 'LABEL' &&\n      element.firstElementChild.firstElementChild as HTMLInputElement;\n  }\n\n  protected async updateContainer(forceSelection = false) {\n    const size = this.selectedMids.size;\n    if(!size && !forceSelection) return;\n\n    let cantForward = !size,\n      cantDelete = !size;\n    const cantSend = !size;\n    for(const [peerId, mids] of this.selectedMids) {\n      const storageKey: MessagesStorageKey = `${peerId}_${this.isScheduled ? 'scheduled' : 'history'}`;\n      const r = await this.managers.appMessagesManager.cantForwardDeleteMids(storageKey, Array.from(mids));\n      cantForward = r.cantForward;\n      cantDelete = r.cantDelete;\n\n      if(cantForward && cantDelete) break;\n    }\n\n    this.onUpdateContainer?.(cantForward, cantDelete, cantSend);\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const wasSelecting = this.isSelecting;\n    const size = this.selectedMids.size;\n    this.isSelecting = !!size || forceSelection;\n\n    if(wasSelecting === this.isSelecting) return false;\n\n    this.dispatchEvent('toggle', this.isSelecting);\n\n    // const bubblesContainer = this.bubbles.bubblesContainer;\n    // bubblesContainer.classList.toggle('is-selecting', !!size);\n\n    /* if(bubblesContainer.classList.contains('is-chat-input-hidden')) {\n      const scrollable = this.appImManager.scrollable;\n      if(scrollable.isScrolledDown) {\n        scrollable.scrollTo(scrollable.scrollHeight, 'top', true, true, 200);\n      }\n    } */\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.listenElement.classList.toggle('no-select', this.isSelecting);\n\n      if(wasSelecting) {\n        // ! CANCEL USER SELECTION !\n        cancelSelection();\n      }\n    }/*  else {\n      if(!wasSelecting) {\n        bubblesContainer.classList.add('no-select');\n        setTimeout(() => {\n          cancelSelection();\n          bubblesContainer.classList.remove('no-select');\n          cancelSelection();\n        }, 100);\n      }\n    } */\n\n    blurActiveElement();\n\n    const forwards = !!size || forceSelection;\n    const toggleResult = this.onToggleSelection?.(forwards, !this.doNotAnimate);\n\n    if(!IS_MOBILE_SAFARI) {\n      if(forwards) {\n        appNavigationController.pushItem({\n          type: this.navigationType,\n          onPop: () => {\n            this.cancelSelection();\n          }\n        });\n      } else {\n        appNavigationController.removeByType(this.navigationType);\n      }\n    }\n\n    if(forceSelection) {\n      (toggleResult || Promise.resolve()).then(() => this.updateContainer(forceSelection));\n    }\n\n    return true;\n  }\n\n  public cancelSelection = async(doNotAnimate?: boolean) => {\n    if(doNotAnimate) this.doNotAnimate = true;\n    this.onCancelSelection && await this.onCancelSelection();\n    this.selectedMids.clear();\n    this.toggleSelection();\n    cancelSelection();\n    if(doNotAnimate) this.doNotAnimate = undefined;\n  };\n\n  public cleanup() {\n    this.doNotAnimate = true;\n    this.selectedMids.clear();\n    this.toggleSelection(false);\n    this.doNotAnimate = undefined;\n  }\n\n  protected updateElementSelection(element: HTMLElement, isSelected: boolean) {\n    this.toggleElementCheckbox(element, true);\n    const input = this.getCheckboxInputFromElement(element);\n    input.checked = isSelected;\n\n    this.toggleSelection();\n    this.updateContainer();\n    SetTransition(element, 'is-selected', isSelected, 200);\n  }\n\n  public isMidSelected(peerId: PeerId, mid: number) {\n    const set = this.selectedMids.get(peerId);\n    return set?.has(mid);\n  }\n\n  public length() {\n    return accumulateMapSet(this.selectedMids);\n  }\n\n  protected toggleMid(peerId: PeerId, mid: number, unselect?: boolean) {\n    let set = this.selectedMids.get(peerId);\n    if(unselect || (unselect === undefined && set?.has(mid))) {\n      if(set) {\n        set.delete(mid);\n\n        if(!set.size) {\n          this.selectedMids.delete(peerId);\n        }\n      }\n    } else {\n      // const diff = rootScope.config.forwarded_count_max - this.length() - 1;\n      // if(diff < 0) {\n      //   toast(I18n.format('Chat.Selection.LimitToast', true));\n      //   return false;\n      //   /* const it = this.selectedMids.values();\n      //   do {\n      //     const mid = it.next().value;\n      //     const mounted = this.appImManager.getMountedBubble(mid);\n      //     if(mounted) {\n      //       this.toggleByBubble(mounted.bubble);\n      //     } else {\n      //       const mids = this.appMessagesManager.getMidsByMid(mid);\n      //       for(const mid of mids) {\n      //         this.selectedMids.delete(mid);\n      //       }\n      //     }\n      //   } while(this.selectedMids.size > MAX_SELECTION_LENGTH); */\n      // }\n\n      if(!set) {\n        set = new Set();\n        this.selectedMids.set(peerId, set);\n      }\n\n      set.add(mid);\n    }\n\n    return true;\n  }\n\n  /**\n   * ! Call this method only to handle deleted messages\n   */\n  public deleteSelectedMids(peerId: PeerId, mids: number[]) {\n    const set = this.selectedMids.get(peerId);\n    if(!set) {\n      return;\n    }\n\n    mids.forEach((mid) => {\n      set.delete(mid);\n    });\n\n    if(!set.size) {\n      this.selectedMids.delete(peerId);\n    }\n\n    this.updateContainer();\n    this.toggleSelection();\n  }\n}\n\nexport class SearchSelection extends AppSelection {\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  public selectionGotoBtn: HTMLElement;\n\n  private isPrivate: boolean;\n\n  constructor(private searchSuper: AppSearchSuper, managers: AppManagers, listenerSetter: ListenerSetter) {\n    super({\n      managers,\n      verifyTarget: (e, target) => !!target && this.isSelecting,\n      getElementFromTarget: (target) => findUpClassName(target, 'search-super-item'),\n      targetLookupClassName: 'search-super-item',\n      lookupBetweenParentClassName: 'tabs-tab',\n      lookupBetweenElementsQuery: '.search-super-item'\n    });\n\n    this.isPrivate = !searchSuper.showSender;\n    this.attachListeners(searchSuper.container, listenerSetter);\n  }\n\n  /* public appendCheckbox(element: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(element.classList.contains('document') || element.tagName === 'AUDIO-ELEMENT') {\n      element.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  } */\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      const elements = Array.from(this.searchSuper.tabsContainer.querySelectorAll('.search-super-item')) as HTMLElement[];\n      elements.forEach((element) => {\n        this.toggleElementCheckbox(element, this.isSelecting);\n      });\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (element: HTMLElement) => {\n    const mid = +element.dataset.mid;\n    const peerId = element.dataset.peerId.toPeerId();\n\n    if(!this.toggleMid(peerId, mid)) {\n      return;\n    }\n\n    this.updateElementSelection(element, this.isMidSelected(peerId, mid));\n  };\n\n  public toggleByMid = (peerId: PeerId, mid: number) => {\n    const element = this.searchSuper.mediaTab.contentTab.querySelector(`.search-super-item[data-peer-id=\"${peerId}\"][data-mid=\"${mid}\"]`) as HTMLElement;\n    this.toggleByElement(element);\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    const length = this.length();\n    replaceContent(this.selectionCountEl, i18n('messages', [length]));\n    this.selectionGotoBtn.classList.toggle('hide', length !== 1);\n    this.selectionForwardBtn.classList.toggle('hide', cantForward);\n    this.selectionDeleteBtn && this.selectionDeleteBtn.classList.toggle('hide', cantDelete);\n  };\n\n  protected onToggleSelection = (forwards: boolean, animate: boolean) => {\n    SetTransition(this.searchSuper.navScrollableContainer, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionContainer.remove();\n        this.selectionContainer =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          null;\n        this.selectedText = undefined;\n      }\n    });\n\n    SetTransition(this.searchSuper.container, 'is-selecting', forwards, 200);\n\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        const BASE_CLASS = 'search-super-selection';\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add(BASE_CLASS + '-container');\n\n        const btnCancel = ButtonIcon(`close ${BASE_CLASS}-cancel`, {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {listenerSetter: this.listenerSetter, once: true});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add(BASE_CLASS + '-count');\n\n        this.selectionGotoBtn = ButtonIcon(`message ${BASE_CLASS}-goto`);\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        attachClickEvent(this.selectionGotoBtn, () => {\n          const peerId = [...this.selectedMids.keys()][0];\n          const mid = [...this.selectedMids.get(peerId)][0];\n          this.cancelSelection();\n\n          appImManager.setInnerPeer({peerId, lastMsgId: mid});\n        }, attachClickOptions);\n\n        this.selectionForwardBtn = ButtonIcon(`forward ${BASE_CLASS}-forward`);\n        attachClickEvent(this.selectionForwardBtn, () => {\n          const obj: {[fromPeerId: PeerId]: number[]} = {};\n          for(const [fromPeerId, mids] of this.selectedMids) {\n            obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n          }\n\n          new PopupForward(obj, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        if(this.isPrivate) {\n          this.selectionDeleteBtn = ButtonIcon(`delete danger ${BASE_CLASS}-delete`);\n          attachClickEvent(this.selectionDeleteBtn, () => {\n            const peerId = [...this.selectedMids.keys()][0];\n            new PopupDeleteMessages(peerId, [...this.selectedMids.get(peerId)], 'chat', () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionContainer.append(...[\n          btnCancel,\n          this.selectionCountEl,\n          this.selectionGotoBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean));\n\n        const transitionElement = this.selectionContainer;\n        transitionElement.style.opacity = '0';\n        this.searchSuper.navScrollableContainer.append(transitionElement);\n\n        void transitionElement.offsetLeft; // reflow\n        transitionElement.style.opacity = '';\n      }\n    }\n  };\n}\n\nexport default class ChatSelection extends AppSelection {\n  protected selectionInputWrapper: HTMLElement;\n  protected selectionContainer: HTMLElement;\n  protected selectionCountEl: HTMLElement;\n  public selectionSendNowBtn: HTMLElement;\n  public selectionForwardBtn: HTMLElement;\n  public selectionDeleteBtn: HTMLElement;\n  private selectionLeft: HTMLDivElement;\n  private selectionRight: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private bubbles: ChatBubbles,\n    private input: ChatInput,\n    managers: AppManagers\n  ) {\n    super({\n      managers,\n      getElementFromTarget: (target) => findUpClassName(target, 'grouped-item') || findUpClassName(target, 'bubble'),\n      verifyTarget: (e, target) => {\n        // LEFT BUTTON\n        //     ,      target  .bubble\n        const bad = !this.selectedMids.size &&\n          !(e.target as HTMLElement).classList.contains('bubble') &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          target;\n\n        return !bad;\n      },\n      verifyMouseMoveTarget: (e, element, selecting) => {\n        const bad = e.target !== element &&\n          !(e.target as HTMLElement).classList.contains('document-selection') &&\n          selecting === undefined &&\n          !this.selectedMids.size;\n        return !bad;\n      },\n      verifyTouchLongPress: () => !this.chat.input.recording,\n      targetLookupClassName: 'bubble',\n      lookupBetweenParentClassName: 'bubbles-inner',\n      lookupBetweenElementsQuery: '.bubble:not(.is-multiple-documents), .grouped-item',\n      isScheduled: chat.type === 'scheduled'\n    });\n  }\n\n  public appendCheckbox(bubble: HTMLElement, checkboxField: CheckboxField) {\n    checkboxField.label.classList.add('bubble-select-checkbox');\n\n    if(bubble.classList.contains('document-container')) {\n      bubble.querySelector('.document, audio-element').append(checkboxField.label);\n    } else {\n      super.appendCheckbox(bubble, checkboxField);\n    }\n  }\n\n  public toggleSelection(toggleCheckboxes = true, forceSelection = false) {\n    const ret = super.toggleSelection(toggleCheckboxes, forceSelection);\n\n    if(ret && toggleCheckboxes) {\n      for(const mid in this.bubbles.bubbles) {\n        if(this.bubbles.skippedMids.has(+mid)) {\n          continue;\n        }\n\n        const bubble = this.bubbles.bubbles[mid];\n        this.toggleElementCheckbox(bubble, this.isSelecting);\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleElementCheckbox(bubble: HTMLElement, show: boolean) {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const ret = super.toggleElementCheckbox(bubble, show);\n    if(ret) {\n      const isGrouped = bubble.classList.contains('is-grouped');\n      if(isGrouped) {\n        this.bubbles.getBubbleGroupedItems(bubble).forEach((item) => this.toggleElementCheckbox(item, show));\n      }\n    }\n\n    return ret;\n  }\n\n  public toggleByElement = (bubble: HTMLElement): Promise<void> => {\n    if(!this.canSelectBubble(bubble)) return;\n\n    const mid = +bubble.dataset.mid;\n\n    const isGrouped = bubble.classList.contains('is-grouped');\n    if(isGrouped) {\n      if(!this.isGroupedBubbleSelected(bubble)) {\n        const set = this.selectedMids.get(this.chat.peerId);\n        if(set) {\n          // const mids = await this.chat.getMidsByMid(mid);\n          const mids = this.getMidsFromGroupContainer(bubble);\n          mids.forEach((mid) => set.delete(mid));\n        }\n      }\n\n      /* const promises =  */this.bubbles.getBubbleGroupedItems(bubble).map(this.toggleByElement);\n      // await Promise.all(promises);\n      return;\n    }\n\n    if(!this.toggleMid(this.chat.peerId, mid)) {\n      return;\n    }\n\n    const isGroupedItem = bubble.classList.contains('grouped-item');\n    if(isGroupedItem) {\n      const groupContainer = findUpClassName(bubble, 'bubble');\n      const isGroupedSelected = this.isGroupedBubbleSelected(groupContainer);\n      const isGroupedMidsSelected = this.isGroupedMidsSelected(groupContainer);\n\n      const willChange = isGroupedMidsSelected || isGroupedSelected;\n      if(willChange) {\n        this.updateElementSelection(groupContainer, isGroupedMidsSelected);\n      }\n    }\n\n    this.updateElementSelection(bubble, this.isMidSelected(this.chat.peerId, mid));\n  };\n\n  protected toggleByMid = async(peerId: PeerId, mid: number) => {\n    const mounted = await this.bubbles.getMountedBubble(mid);\n    if(mounted) {\n      this.toggleByElement(mounted.bubble);\n    }\n  };\n\n  public isElementShouldBeSelected(element: HTMLElement) {\n    const isGrouped = element.classList.contains('is-grouped');\n    return super.isElementShouldBeSelected(element) && (!isGrouped || this.isGroupedMidsSelected(element));\n  }\n\n  protected isGroupedBubbleSelected(bubble: HTMLElement) {\n    const groupedCheckboxInput = this.getCheckboxInputFromElement(bubble);\n    return groupedCheckboxInput?.checked;\n  }\n\n  protected getMidsFromGroupContainer(groupContainer: HTMLElement) {\n    const elements = this.chat.bubbles.getBubbleGroupedItems(groupContainer);\n    if(!elements.length) {\n      elements.push(groupContainer);\n    }\n\n    return elements.map((element) => +element.dataset.mid);\n  }\n\n  protected isGroupedMidsSelected(groupContainer: HTMLElement) {\n    const mids = this.getMidsFromGroupContainer(groupContainer);\n    const selectedMids = mids.filter((mid) => this.isMidSelected(this.chat.peerId, mid));\n    return mids.length === selectedMids.length;\n  }\n\n  protected getCheckboxInputFromElement(bubble: HTMLElement) {\n    /* let perf = performance.now();\n    let checkbox = bubble.firstElementChild.tagName === 'LABEL' && bubble.firstElementChild.firstElementChild as HTMLInputElement;\n    console.log('getCheckboxInputFromBubble firstElementChild time:', performance.now() - perf);\n\n    perf = performance.now();\n    checkbox = bubble.querySelector('label input');\n    console.log('getCheckboxInputFromBubble querySelector time:', performance.now() - perf); */\n    /* let perf = performance.now();\n    let contains = bubble.classList.contains('document-container');\n    console.log('getCheckboxInputFromBubble classList time:', performance.now() - perf);\n\n    perf = performance.now();\n    contains = bubble.className.includes('document-container');\n    console.log('getCheckboxInputFromBubble className time:', performance.now() - perf); */\n\n    return bubble.classList.contains('document-container') ?\n      bubble.querySelector('label input') as HTMLInputElement :\n      super.getCheckboxInputFromElement(bubble);\n  }\n\n  public canSelectBubble(bubble: HTMLElement) {\n    return !bubble.classList.contains('service') &&\n      !bubble.classList.contains('is-outgoing') &&\n      !bubble.classList.contains('is-error') &&\n      !bubble.classList.contains('bubble-first') &&\n      !bubble.classList.contains('avoid-selection');\n  }\n\n  protected onToggleSelection = async(forwards: boolean, animate: boolean) => {\n    const {needTranslateX, widthFrom, widthTo} = await this.chat.input.center(animate);\n\n    SetTransition(this.listenElement, 'is-selecting', forwards, animate ? 200 : 0, () => {\n      if(!this.isSelecting) {\n        this.selectionInputWrapper.remove();\n        this.selectionInputWrapper =\n          this.selectionContainer =\n          this.selectionSendNowBtn =\n          this.selectionForwardBtn =\n          this.selectionDeleteBtn =\n          this.selectionLeft =\n          this.selectionRight =\n          null;\n        this.selectedText = undefined;\n      }\n\n      /* fastRaf(() => {\n        this.bubbles.onScroll();\n      }); */\n    });\n\n    // const chatInput = this.appImManager.chatInput;\n\n    const translateButtonsX = widthFrom < widthTo ? undefined : needTranslateX * 2;\n    if(this.isSelecting) {\n      if(!this.selectionContainer) {\n        this.selectionInputWrapper = document.createElement('div');\n        this.selectionInputWrapper.classList.add('chat-input-wrapper', 'selection-wrapper');\n\n        // const background = document.createElement('div');\n        // background.classList.add('chat-input-wrapper-background');\n\n        this.selectionContainer = document.createElement('div');\n        this.selectionContainer.classList.add('selection-container');\n\n        const attachClickOptions: AttachClickOptions = {listenerSetter: this.listenerSetter};\n        const btnCancel = ButtonIcon('close', {noRipple: true});\n        attachClickEvent(btnCancel, () => this.cancelSelection(), {once: true, listenerSetter: this.listenerSetter});\n\n        this.selectionCountEl = document.createElement('div');\n        this.selectionCountEl.classList.add('selection-container-count');\n\n        if(this.chat.type === 'scheduled') {\n          this.selectionSendNowBtn = Button('btn-primary btn-transparent btn-short text-bold selection-container-send', {icon: 'send2'});\n          this.selectionSendNowBtn.append(i18n('MessageScheduleSend'));\n          attachClickEvent(this.selectionSendNowBtn, () => {\n            new PopupSendNow(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        } else {\n          this.selectionForwardBtn = Button('btn-primary btn-transparent text-bold selection-container-forward', {icon: 'forward'});\n          this.selectionForwardBtn.append(i18n('Forward'));\n          attachClickEvent(this.selectionForwardBtn, () => {\n            const obj: {[fromPeerId: PeerId]: number[]} = {};\n            for(const [fromPeerId, mids] of this.selectedMids) {\n              obj[fromPeerId] = Array.from(mids).sort((a, b) => a - b);\n            }\n\n            new PopupForward(obj, () => {\n              this.cancelSelection();\n            });\n          }, attachClickOptions);\n        }\n\n        this.selectionDeleteBtn = Button('btn-primary btn-transparent danger text-bold selection-container-delete', {icon: 'delete'});\n        this.selectionDeleteBtn.append(i18n('Delete'));\n        attachClickEvent(this.selectionDeleteBtn, () => {\n          new PopupDeleteMessages(this.chat.peerId, [...this.selectedMids.get(this.chat.peerId)], this.chat.type, () => {\n            this.cancelSelection();\n          });\n        }, attachClickOptions);\n\n        const left = this.selectionLeft = document.createElement('div');\n        left.classList.add('selection-container-left');\n        left.append(btnCancel, this.selectionCountEl);\n\n        const right = this.selectionRight = document.createElement('div');\n        right.classList.add('selection-container-right');\n        right.append(...[\n          this.selectionSendNowBtn,\n          this.selectionForwardBtn,\n          this.selectionDeleteBtn\n        ].filter(Boolean))\n\n        if(translateButtonsX !== undefined) {\n          left.style.transform = `translateX(${-translateButtonsX}px)`;\n          right.style.transform = `translateX(${translateButtonsX}px)`;\n        }\n\n        this.selectionContainer.append(left, right);\n\n        // background.style.opacity = '0';\n        this.selectionInputWrapper.style.opacity = '0';\n        this.selectionInputWrapper.append(/* background,  */this.selectionContainer);\n        this.input.inputContainer.append(this.selectionInputWrapper);\n\n        void this.selectionInputWrapper.offsetLeft; // reflow\n        // background.style.opacity = '';\n        this.selectionInputWrapper.style.opacity = '';\n        left.style.transform = '';\n        right.style.transform = '';\n      }\n    } else if(this.selectionLeft && translateButtonsX !== undefined) {\n      this.selectionLeft.style.transform = `translateX(-${translateButtonsX}px)`;\n      this.selectionRight.style.transform = `translateX(${translateButtonsX}px)`;\n    }\n  };\n\n  protected onUpdateContainer = (cantForward: boolean, cantDelete: boolean, cantSend: boolean) => {\n    replaceContent(this.selectionCountEl, i18n('messages', [this.length()]));\n    this.selectionSendNowBtn && this.selectionSendNowBtn.toggleAttribute('disabled', cantSend);\n    this.selectionForwardBtn && this.selectionForwardBtn.toggleAttribute('disabled', cantForward);\n    this.selectionDeleteBtn && this.selectionDeleteBtn.toggleAttribute('disabled', cantDelete);\n  };\n\n  protected onCancelSelection = async() => {\n    return;\n    const promises: Promise<HTMLElement>[] = [];\n    for(const [peerId, mids] of this.selectedMids) {\n      for(const mid of mids) {\n        promises.push(this.bubbles.getMountedBubble(mid).then((m) => m?.bubble));\n      }\n    }\n\n    const bubbles = filterUnique((await Promise.all(promises)).filter(Boolean));\n    bubbles.forEach((bubble) => {\n      this.toggleByElement(bubble);\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedText(): string {\r\n  if(window.getSelection) {\r\n    return window.getSelection().toString();\r\n    // @ts-ignore\r\n  } else if(document.selection) {\r\n    // @ts-ignore\r\n    return document.selection.createRange().text;\r\n  }\r\n\r\n  return '';\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../helpers/listenerSetter';\r\nimport ripple from './ripple';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport rootScope from '../lib/rootScope';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\n\r\nexport type CheckboxFieldOptions = {\r\n  text?: LangPackKey,\r\n  textArgs?: any[],\r\n  name?: string,\r\n  round?: boolean,\r\n  toggle?: boolean,\r\n  stateKey?: string,\r\n  stateValues?: any[],\r\n  disabled?: boolean,\r\n  checked?: boolean,\r\n  restriction?: boolean,\r\n  withRipple?: boolean,\r\n  withHover?: boolean,\r\n  listenerSetter?: ListenerSetter\r\n};\r\nexport default class CheckboxField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public span: HTMLSpanElement;\r\n\r\n  constructor(options: CheckboxFieldOptions = {}) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('checkbox-field');\r\n\r\n    if(options.restriction) {\r\n      label.classList.add('checkbox-field-restriction');\r\n    }\r\n\r\n    if(options.round) {\r\n      label.classList.add('checkbox-field-round');\r\n    }\r\n\r\n    if(options.disabled) {\r\n      this.toggleDisability(true);\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.classList.add('checkbox-field-input');\r\n    input.type = 'checkbox';\r\n    if(options.name) {\r\n      input.id = 'input-' + options.name;\r\n    }\r\n\r\n    if(options.checked) {\r\n      input.checked = true;\r\n    }\r\n\r\n    if(options.stateKey) {\r\n      let loaded = false;\r\n      const onChange = () => {\r\n        if(!loaded) {\r\n          return;\r\n        }\r\n\r\n        let value: any;\r\n        if(options.stateValues) {\r\n          value = options.stateValues[input.checked ? 1 : 0];\r\n        } else {\r\n          value = input.checked;\r\n        }\r\n\r\n        rootScope.managers.appStateManager.setByKey(options.stateKey, value);\r\n      };\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        loaded = true;\r\n        const stateValue = getDeepProperty(state, options.stateKey);\r\n        let checked: boolean;\r\n        if(options.stateValues) {\r\n          checked = options.stateValues.indexOf(stateValue) === 1;\r\n        } else {\r\n          checked = stateValue;\r\n        }\r\n\r\n        this.setValueSilently(checked);\r\n      });\r\n\r\n      if(options.listenerSetter) options.listenerSetter.add(input)('change', onChange);\r\n      else input.addEventListener('change', onChange);\r\n    }\r\n\r\n    let span: HTMLSpanElement;\r\n    if(options.text) {\r\n      span = this.span = document.createElement('span');\r\n      span.classList.add('checkbox-caption');\r\n      _i18n(span, options.text, options.textArgs);\r\n    } else {\r\n      label.classList.add('checkbox-without-caption');\r\n    }\r\n\r\n    label.append(input);\r\n\r\n    if(options.toggle) {\r\n      label.classList.add('checkbox-field-toggle');\r\n\r\n      const toggle = document.createElement('div');\r\n      toggle.classList.add('checkbox-toggle');\r\n      label.append(toggle);\r\n    } else {\r\n      const box = document.createElement('div');\r\n      box.classList.add('checkbox-box');\r\n\r\n      const checkSvg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n      checkSvg.classList.add('checkbox-box-check');\r\n      checkSvg.setAttributeNS(null, 'viewBox', '0 0 24 24');\r\n      const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\r\n      use.setAttributeNS(null, 'href', '#check');\r\n      use.setAttributeNS(null, 'x', '-1');\r\n      checkSvg.append(use);\r\n\r\n      const bg = document.createElement('div');\r\n      bg.classList.add('checkbox-box-background');\r\n\r\n      const border = document.createElement('div');\r\n      border.classList.add('checkbox-box-border');\r\n\r\n      box.append(border, bg, checkSvg);\r\n\r\n      label.append(box);\r\n    }\r\n\r\n    if(span) {\r\n      label.append(span);\r\n    }\r\n\r\n    if(options.withRipple) {\r\n      label.classList.add('checkbox-ripple', 'hover-effect');\r\n      ripple(label, undefined, undefined, true);\r\n      // label.prepend(input);\r\n    } else if(options.withHover) {\r\n      label.classList.add('hover-effect');\r\n    }\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    /* if(this.checked === checked) {\r\n      return;\r\n    } */\r\n\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n\r\n  public toggleDisability(disable: boolean) {\r\n    this.label.classList.toggle('checkbox-disabled', disable);\r\n    return () => this.toggleDisability(!disable);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class CodeInputField extends InputField {\r\n  constructor(options: InputFieldOptions & {\r\n    length: number,\r\n    onFill: (code: string) => void\r\n  }) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'tel';\r\n    input.setAttribute('required', '');\r\n    input.autocomplete = 'off';\r\n\r\n    let lastLength = 0;\r\n    this.input.addEventListener('input', (e) => {\r\n      this.input.classList.remove('error');\r\n      this.setLabel();\r\n\r\n      const value = this.value.replace(/\\D/g, '').slice(0, options.length);\r\n      this.setValueSilently(value);\r\n\r\n      const length = this.value.length;\r\n      if(length === options.length) { // submit code\r\n        options.onFill(this.value);\r\n      } else if(length === lastLength) {\r\n        return;\r\n      }\r\n\r\n      lastLength = length;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {addCancelButton} from './popups';\nimport PopupPeer, {PopupPeerOptions} from './popups/peer';\n\n// type PopupConfirmationOptions = Pick<PopupPeerOptions, 'titleLangKey'>;\nexport type PopupConfirmationOptions = PopupPeerOptions & {\n  button: PopupPeerOptions['buttons'][0],\n  checkbox?: PopupPeerOptions['checkboxes'][0]\n};\n\nexport default function confirmationPopup(options: PopupConfirmationOptions) {\n  return new Promise<boolean | void>((resolve, reject) => {\n    const {button, checkbox} = options;\n    button.callback = (set) => {\n      resolve(set ? !!set.size : undefined);\n    };\n\n    const buttons = addCancelButton(options.buttons || [button]);\n    const cancelButton = buttons.find((button) => button.isCancel);\n    cancelButton.callback = () => {\n      reject();\n    };\n\n    options.buttons = buttons;\n    options.checkboxes ??= checkbox && [checkbox];\n\n    new PopupPeer('popup-confirmation', options).show();\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_EMOJI_SUPPORTED from '../environment/emojiSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport simulateEvent from '../helpers/dom/dispatchEvent';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\nimport {randomLong} from '../helpers/random';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n, {i18n} from '../lib/langPack';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../lib/rootScope';\nimport {getCountryEmoji} from '../vendor/emoji';\nimport InputField, {InputFieldOptions} from './inputField';\nimport Scrollable from './scrollable';\n\nlet countries: HelpCountry.helpCountry[];\nconst setCountries = () => {\n  countries = I18n.countriesList\n  .filter((country) => !country.pFlags?.hidden)\n  .sort((a, b) => (a.name || a.default_name).localeCompare(b.name || b.default_name));\n};\n\nlet init = () => {\n  setCountries();\n  rootScope.addEventListener('language_change', () => {\n    setCountries();\n  });\n};\n\nexport default class CountryInputField extends InputField {\n  private lastCountrySelected: HelpCountry;\n  private lastCountryCodeSelected: HelpCountryCode;\n\n  private hideTimeout: number;\n  private selectWrapper: HTMLElement;\n\n  private liMap: Map<string, HTMLLIElement[]>;\n\n  constructor(public options: InputFieldOptions & {\n    onCountryChange?: (country: HelpCountry.helpCountry, code: HelpCountryCode.helpCountryCode) => void,\n    noPhoneCodes?: boolean\n  } = {}) {\n    super({\n      label: 'Country',\n      name: randomLong(),\n      ...options\n    });\n\n    if(init) {\n      init();\n      init = undefined;\n    }\n\n    this.liMap = new Map();\n\n    this.container.classList.add('input-select');\n\n    const selectWrapper = this.selectWrapper = document.createElement('div');\n    selectWrapper.classList.add('select-wrapper', 'z-depth-3', 'hide');\n\n    const arrowDown = document.createElement('span');\n    arrowDown.classList.add('arrow', 'arrow-down');\n    this.container.append(arrowDown);\n\n    const selectList = document.createElement('ul');\n    selectWrapper.appendChild(selectList);\n\n    const scroll = new Scrollable(selectWrapper);\n\n    let initSelect = () => {\n      initSelect = null;\n\n      countries.forEach((c) => {\n        const emoji = getCountryEmoji(c.iso2);\n\n        const liArr: Array<HTMLLIElement> = [];\n        for(let i = 0, length = Math.min(c.country_codes.length, options.noPhoneCodes ? 1 : Infinity); i < length; ++i) {\n          const countryCode = c.country_codes[i];\n          const li = document.createElement('li');\n\n          const wrapped = wrapEmojiText(emoji);\n          if(IS_EMOJI_SUPPORTED) {\n            const spanEmoji = document.createElement('span');\n            setInnerHTML(spanEmoji, wrapped);\n            li.append(spanEmoji);\n          } else {\n            setInnerHTML(li, wrapped);\n          }\n\n          const el = i18n(c.default_name as any);\n          el.dataset.defaultName = c.default_name;\n          li.append(el);\n\n          if(!options.noPhoneCodes) {\n            const span = document.createElement('span');\n            span.classList.add('phone-code');\n            span.innerText = '+' + countryCode.country_code;\n            li.appendChild(span);\n          }\n\n          liArr.push(li);\n          selectList.append(li);\n        }\n\n        this.liMap.set(c.iso2, liArr);\n      });\n\n      selectList.addEventListener('mousedown', (e) => {\n        if(e.button !== 0) { // other buttons but left shall not pass\n          return;\n        }\n\n        const target = findUpTag(e.target, 'LI')\n        this.selectCountryByTarget(target);\n        // console.log('clicked', e, countryName, phoneCode);\n      });\n\n      this.container.appendChild(selectWrapper);\n    };\n\n    initSelect();\n\n    this.input.addEventListener('focus', (e) => {\n      if(initSelect) {\n        initSelect();\n      } else {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      }\n\n      clearTimeout(this.hideTimeout);\n      this.hideTimeout = undefined;\n\n      selectWrapper.classList.remove('hide');\n      void selectWrapper.offsetWidth; // reflow\n      selectWrapper.classList.add('active');\n\n      this.select();\n\n      fastSmoothScroll({\n        // container: page.pageEl.parentElement.parentElement,\n        container: findUpClassName(this.container, 'scrollable-y'),\n        element: this.input,\n        position: 'start',\n        margin: 4\n      });\n\n      setTimeout(() => {\n        if(!mouseDownHandlerAttached) {\n          document.addEventListener('mousedown', onMouseDown, {capture: true});\n          mouseDownHandlerAttached = true;\n        }\n      }, 0);\n    });\n\n    let mouseDownHandlerAttached = false;\n    const onMouseDown = (e: MouseEvent) => {\n      if(findUpClassName(e.target, 'input-select')) {\n        return;\n      }\n      if(e.target === this.input) {\n        return;\n      }\n\n      this.hidePicker();\n      document.removeEventListener('mousedown', onMouseDown, {capture: true});\n      mouseDownHandlerAttached = false;\n    };\n\n    /* false && this.input.addEventListener('blur', function(this: typeof this.input, e) {\n      hidePicker();\n\n      e.cancelBubble = true;\n    }, {capture: true}); */\n\n    const onKeyPress = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(e.ctrlKey || key === 'Control') return false;\n\n      // let i = new RegExp('^' + this.value, 'i');\n      const _value = this.value.toLowerCase();\n      const matches: HelpCountry[] = [];\n      countries.forEach((c) => {\n        const names = [\n          c.name,\n          c.default_name,\n          c.iso2\n        ];\n\n        names.filter(Boolean).forEach((name) => {\n          const abbr = name.split(' ').filter((word) => /\\w/.test(word)).map((word) => word[0]).join('');\n          if(abbr.length > 1) {\n            names.push(abbr);\n          }\n        });\n\n        const good = !!names.filter(Boolean).find((str) => str.toLowerCase().indexOf(_value) !== -1)/*  === 0 */;// i.test(c.name);\n\n        this.liMap.get(c.iso2).forEach((li) => li.style.display = good ? '' : 'none');\n        if(good) matches.push(c);\n      });\n\n      //           \n      /* if(matches.length === 1 && matches[0].li.length === 1) {\n        if(matches[0].name === lastCountrySelected) return false;\n        //console.log('clicking', matches[0]);\n\n        var clickEvent = document.createEvent('MouseEvents');\n        clickEvent.initEvent('mousedown', true, true);\n        matches[0].li[0].dispatchEvent(clickEvent);\n        return false;\n      } else  */if(matches.length === 0) {\n        countries.forEach((c) => {\n          this.liMap.get(c.iso2).forEach((li) => li.style.display = '');\n        });\n      } else if(matches.length === 1 && key === 'Enter') {\n        cancelEvent(e);\n        this.selectCountryByTarget(this.liMap.get(matches[0].iso2)[0]);\n      }\n    };\n\n    this.input.addEventListener('keyup', onKeyPress);\n    this.input.addEventListener('keydown', (e) => {\n      if(e.key === 'Enter') {\n        onKeyPress(e);\n      }\n    });\n\n    arrowDown.addEventListener('mousedown', (e) => {\n      if(this.input.matches(':focus')) {\n        this.hidePicker();\n        this.input.blur();\n      } else {\n        e.cancelBubble = true;\n        e.preventDefault();\n        this.input.focus();\n      }\n    });\n  }\n\n  public getSelected() {\n    return {country: this.lastCountrySelected, code: this.lastCountryCodeSelected};\n  }\n\n  public hidePicker = () => {\n    if(this.hideTimeout !== undefined) return;\n    this.selectWrapper.classList.remove('active');\n    this.hideTimeout = window.setTimeout(() => {\n      this.selectWrapper.classList.add('hide');\n      this.hideTimeout = undefined;\n    }, 200);\n  }\n\n  public selectCountryByTarget = (target: HTMLElement) => {\n    const defaultName = target.querySelector<HTMLElement>('[data-default-name]').dataset.defaultName;\n    const phoneCodeEl = target.querySelector<HTMLElement>('.phone-code');\n    const phoneCode = phoneCodeEl?.innerText;\n    const countryCode = phoneCode && phoneCode.replace(/\\D/g, '');\n\n    replaceContent(this.input, i18n(defaultName as any));\n    simulateEvent(this.input, 'input');\n    this.lastCountrySelected = countries.find((c) => c.default_name === defaultName);\n    this.lastCountryCodeSelected = countryCode && this.lastCountrySelected.country_codes.find((_countryCode) => _countryCode.country_code === countryCode);\n\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n    this.hidePicker();\n  }\n\n  public selectCountryByIso2(iso2: string) {\n    this.selectCountryByTarget(this.liMap.get(iso2)[0]);\n  }\n\n  public override(country: HelpCountry, code: HelpCountryCode, countryName?: string) {\n    replaceContent(this.input, country ? i18n(country.default_name as any) : countryName);\n    this.lastCountrySelected = country;\n    this.lastCountryCodeSelected = code;\n    this.options.onCountryChange?.(this.lastCountrySelected, this.lastCountryCodeSelected);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {InputFile} from '../layer';\r\nimport AvatarEdit from './avatarEdit';\r\nimport AvatarElement from './avatar';\r\nimport InputField from './inputField';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport ButtonCorner from './buttonCorner';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class EditPeer {\r\n  public nextBtn: HTMLButtonElement;\r\n\r\n  public uploadAvatar: () => Promise<InputFile>;\r\n  public avatarEdit: AvatarEdit;\r\n  public avatarElem: AvatarElement;\r\n\r\n  private inputFields: InputField[];\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private peerId: PeerId;\r\n\r\n  private _disabled = false;\r\n  private avatarSize = 120;\r\n\r\n  constructor(options: {\r\n    peerId?: EditPeer['peerId'],\r\n    inputFields: EditPeer['inputFields'],\r\n    listenerSetter: ListenerSetter,\r\n    doNotEditAvatar?: boolean,\r\n    withoutAvatar?: boolean,\r\n    nextBtn?: HTMLButtonElement,\r\n    avatarSize?: number\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.nextBtn) {\r\n      this.nextBtn = ButtonCorner({icon: 'check'});\r\n    } else if(!this.nextBtn.classList.contains('btn-corner')) {\r\n      this.handleChange = () => {\r\n        this.nextBtn.toggleAttribute('disabled', !this.isChanged() || this.disabled);\r\n      };\r\n    }\r\n\r\n    if(!options.withoutAvatar) {\r\n      this.avatarElem = document.createElement('avatar-element') as AvatarElement;\r\n      this.avatarElem.classList.add('avatar-placeholder', 'avatar-' + this.avatarSize);\r\n      this.avatarElem.updateWithOptions({peerId: this.peerId});\r\n\r\n      if(!options.doNotEditAvatar) {\r\n        this.avatarEdit = new AvatarEdit((_upload) => {\r\n          this.uploadAvatar = _upload;\r\n          this.handleChange();\r\n          this.avatarElem.remove();\r\n        });\r\n\r\n        this.avatarEdit.container.append(this.avatarElem);\r\n      }\r\n    }\r\n\r\n    this.inputFields.forEach((inputField) => {\r\n      this.listenerSetter.add(inputField.input)('input', this.handleChange);\r\n    });\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  public get disabled() {\r\n    return this._disabled;\r\n  }\r\n\r\n  public set disabled(value) {\r\n    this._disabled = value;\r\n    this.inputFields.forEach((inputField) => inputField.input.toggleAttribute('disabled', value));\r\n    this.handleChange();\r\n  }\r\n\r\n  public lockWithPromise(promise: Promise<any>, unlockOnSuccess = false) {\r\n    this.disabled = true;\r\n    promise.then(() => {\r\n      if(unlockOnSuccess) {\r\n        this.disabled = false;\r\n      }\r\n    }, () => {\r\n      this.disabled = false;\r\n    });\r\n  }\r\n\r\n  public isChanged = () => {\r\n    if(this.uploadAvatar) {\r\n      return true;\r\n    }\r\n\r\n    let changedLength = 0, requiredLength = 0, requiredValidLength = 0;\r\n    this.inputFields.forEach((inputField) => {\r\n      if(inputField.isValid()) {\r\n        if(inputField.isChanged()) {\r\n          ++changedLength;\r\n        }\r\n\r\n        if(inputField.required) {\r\n          ++requiredValidLength;\r\n        }\r\n      }\r\n\r\n      if(inputField.required) {\r\n        ++requiredLength;\r\n      }\r\n    });\r\n\r\n    return requiredLength === requiredValidLength && changedLength > 0;\r\n  };\r\n\r\n  public handleChange = () => {\r\n    this.nextBtn.classList.toggle('is-visible', this.isChanged());\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab, EMOTICONSSTICKERGROUP} from '..';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport Scrollable from '../../scrollable';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class GifsTab implements EmoticonsTab {\r\n  private content: HTMLElement;\r\n\r\n  constructor(private managers: AppManagers) {\r\n\r\n  }\r\n\r\n  init() {\r\n    this.content = document.getElementById('content-gifs');\r\n    const gifsContainer = this.content.firstElementChild as HTMLDivElement;\r\n    attachClickEvent(gifsContainer, EmoticonsDropdown.onMediaClick);\r\n\r\n    const scroll = new Scrollable(this.content, 'GIFS');\r\n    const masonry = new GifsMasonry(gifsContainer, EMOTICONSSTICKERGROUP, scroll);\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    this.managers.appDocsManager.getGifs().then((docs) => {\r\n      docs.forEach((doc) => {\r\n        masonry.add(doc);\r\n      });\r\n\r\n      preloader.remove();\r\n    });\r\n\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(masonry.lazyLoadQueue, masonry.processInvisibleDiv);\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport appSidebarRight from '..';\r\nimport {AppInlineBotsManager} from '../../../lib/appManagers/appInlineBotsManager';\r\nimport GifsMasonry from '../../gifsMasonry';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport type {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport {NULL_PEER_ID} from '../../../lib/mtproto/mtproto_config';\r\n\r\nconst ANIMATIONGROUP: AnimationItemGroup = 'GIFS-SEARCH';\r\n\r\nexport default class AppGifsTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private gifsDiv: HTMLDivElement;\r\n\r\n  private nextOffset = '';\r\n  private loadedAll = false;\r\n\r\n  private gifBotPeerId: PeerId;\r\n  private masonry: GifsMasonry;\r\n\r\n  private searchPromise: ReturnType<AppInlineBotsManager['getInlineResults']>;\r\n\r\n  protected init() {\r\n    this.container.id = 'search-gifs-container';\r\n\r\n    this.inputSearch = new InputSearch('SearchGifsTitle', (value) => {\r\n      this.reset();\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.gifsDiv = document.createElement('div');\r\n    this.gifsDiv.classList.add('gifs-masonry');\r\n    attachClickEvent(this.gifsDiv, this.onGifsClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable.append(this.gifsDiv);\r\n\r\n    this.masonry = new GifsMasonry(this.gifsDiv, ANIMATIONGROUP, this.scrollable);\r\n    // this.backBtn.parentElement.append(this.inputSearch.container);\r\n  }\r\n\r\n  private onGifsClick = async(e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'gif');\r\n    if(!target) return;\r\n\r\n    const fileId = target.dataset.docId;\r\n    if(await appImManager.chat.input.sendMessageWithDocument(fileId)) {\r\n      if(mediaSizes.isMobile) {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }\r\n    } else {\r\n      console.warn('got no doc by id:', fileId);\r\n    }\r\n  };\r\n\r\n  public onClose() {\r\n    this.scrollable.onScrolledBottom = () => {};\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.reset();\r\n    this.gifsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, ANIMATIONGROUP);\r\n    this.inputSearch.remove();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  private reset() {\r\n    this.searchPromise = null;\r\n    this.nextOffset = '';\r\n    this.loadedAll = false;\r\n    this.masonry.clear();\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.search('', true);\r\n\r\n      this.scrollable.onScrolledBottom = () => {\r\n        this.search(this.inputSearch.value, false);\r\n      };\r\n    });\r\n    return ret;\r\n  }\r\n\r\n  public async search(query: string, newSearch = true) {\r\n    if(this.searchPromise || this.loadedAll) return;\r\n\r\n    if(!this.gifBotPeerId) {\r\n      this.gifBotPeerId = (await this.managers.appUsersManager.resolveUsername('gif')).id.toPeerId(false);\r\n    }\r\n\r\n    try {\r\n      this.searchPromise = this.managers.appInlineBotsManager.getInlineResults(NULL_PEER_ID, this.gifBotPeerId, query, this.nextOffset);\r\n      const {results, next_offset} = await this.searchPromise;\r\n\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      this.searchPromise = null;\r\n      this.nextOffset = next_offset;\r\n      if(newSearch) {\r\n        this.gifsDiv.innerHTML = '';\r\n      }\r\n\r\n      if(results.length) {\r\n        results.forEach((result) => {\r\n          if(result._ === 'botInlineMediaResult' && result.document) {\r\n            this.masonry.add(result.document as MyDocument);\r\n          }\r\n        });\r\n      } else {\r\n        this.loadedAll = true;\r\n      }\r\n\r\n      this.scrollable.onScroll();\r\n    } catch(err) {\r\n      this.searchPromise = null;\r\n      console.error('gifs loading error:', err);\r\n      throw err;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport InputSearch from '../../inputSearch';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport animationIntersector from '../../animationIntersector';\r\nimport appSidebarRight from '..';\r\nimport {StickerSet, StickerSetCovered} from '../../../layer';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\nimport wrapSticker from '../../wrappers/sticker';\r\n\r\nexport default class AppStickersTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private setsDiv: HTMLDivElement;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n\r\n  protected init() {\r\n    this.container.id = 'stickers-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n\r\n    this.inputSearch = new InputSearch('StickersTab.SearchPlaceholder', (value) => {\r\n      this.search(value);\r\n    });\r\n\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.setsDiv = document.createElement('div');\r\n    this.setsDiv.classList.add('sticker-sets');\r\n    this.scrollable.append(this.setsDiv);\r\n\r\n    attachStickerViewerListeners({listenTo: this.setsDiv, listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.setsDiv, (e) => {\r\n      const sticker = findUpClassName(e.target, 'sticker-set-sticker');\r\n      if(sticker) {\r\n        const docId = sticker.dataset.docId;\r\n        appImManager.chat.input.sendMessageWithDocument(docId);\r\n        return;\r\n      }\r\n\r\n      const target = findUpClassName(e.target, 'sticker-set');\r\n      if(!target) return;\r\n\r\n      const id = target.dataset.stickerSet as string;\r\n      const access_hash = target.dataset.access_hash as string;\r\n\r\n      const button = findUpClassName(e.target, 'sticker-set-button') as HTMLElement;\r\n      if(button) {\r\n        e.preventDefault();\r\n        e.cancelBubble = true;\r\n\r\n        button.setAttribute('disabled', 'true');\r\n\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          this.managers.appStickersManager.toggleStickerSet(full.set).then((changed) => {\r\n            if(changed) {\r\n              button.textContent = '';\r\n              button.append(i18n(full.set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n              button.classList.toggle('gray', !!full.set.installed_date);\r\n            }\r\n          }).finally(() => {\r\n            // button.style.width = set.installed_date ? '68px' : '52px';\r\n            button.removeAttribute('disabled');\r\n          });\r\n        });\r\n      } else {\r\n        this.managers.appStickersManager.getStickerSet({id, access_hash}).then((full) => {\r\n          new PopupStickers(full.set).show();\r\n        });\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.setsDiv.innerHTML = '';\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  public renderSet(set: StickerSet.stickerSet) {\r\n    // console.log('renderSet:', set);\r\n    const div = document.createElement('div');\r\n    div.classList.add('sticker-set');\r\n\r\n    const header = document.createElement('div');\r\n    header.classList.add('sticker-set-header');\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add('sticker-set-details');\r\n    details.innerHTML = `<div class=\"sticker-set-name\"></div>`;\r\n\r\n    setInnerHTML(details.firstElementChild, wrapEmojiText(set.title));\r\n\r\n    const countDiv = document.createElement('div');\r\n    countDiv.classList.add('sticker-set-count');\r\n    countDiv.append(i18n('Stickers', [set.count]));\r\n    details.append(countDiv);\r\n\r\n    const button = document.createElement('button');\r\n    button.classList.add('btn-primary', 'btn-color-primary', 'sticker-set-button');\r\n    button.append(i18n(set.installed_date ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n    // button.style.width = set.installed_date ? '68px' : '52px';\r\n\r\n    if(set.installed_date) {\r\n      button.classList.add('gray');\r\n    }\r\n\r\n    // ripple(button);\r\n\r\n    header.append(details, button);\r\n\r\n    const stickersDiv = document.createElement('div');\r\n    stickersDiv.classList.add('sticker-set-stickers');\r\n\r\n    const count = Math.min(5, set.count);\r\n    for(let i = 0; i < count; ++i) {\r\n      const stickerDiv = document.createElement('div');\r\n      stickerDiv.classList.add('sticker-set-sticker');\r\n\r\n      stickersDiv.append(stickerDiv);\r\n    }\r\n\r\n    this.managers.appStickersManager.getStickerSet(set).then((set) => {\r\n      // console.log('renderSet got set:', set);\r\n\r\n      for(let i = 0; i < count; ++i) {\r\n        const div = stickersDiv.children[i] as HTMLDivElement;\r\n        const doc = set.documents[i];\r\n        if(doc._ === 'documentEmpty') {\r\n          continue;\r\n        }\r\n\r\n        wrapSticker({\r\n          doc,\r\n          div,\r\n          lazyLoadQueue: this.lazyLoadQueue,\r\n          group: 'STICKERS-SEARCH',\r\n          /* play: false,\r\n          loop: false, */\r\n          play: true,\r\n          loop: true,\r\n          width: 68,\r\n          height: 68,\r\n          withLock: true\r\n        });\r\n      }\r\n    });\r\n\r\n    /* const onMouseOver = () => {\r\n      const animations: AnimationItem['animation'][] = [];\r\n      for(let i = 0; i < count; ++i) {\r\n        const stickerDiv = stickersDiv.children[i] as HTMLElement;\r\n        const animationItem = animationIntersector.getAnimation(stickerDiv);\r\n        if(!animationItem) continue;\r\n\r\n        const animation = animationItem.animation;\r\n\r\n        animations.push(animation);\r\n        animation.loop = true;\r\n        animation.play();\r\n      }\r\n\r\n      div.addEventListener('mouseout', () => {\r\n        animations.forEach((animation) => {\r\n          animation.loop = false;\r\n        });\r\n\r\n        div.addEventListener('mouseover', onMouseOver, {once: true});\r\n      }, {once: true});\r\n    };\r\n\r\n    div.addEventListener('mouseover', onMouseOver, {once: true}); */\r\n\r\n    div.dataset.stickerSet = '' + set.id;\r\n    div.dataset.access_hash = '' + set.access_hash;\r\n    div.dataset.title = set.title;\r\n\r\n    div.append(header, stickersDiv);\r\n\r\n    this.setsDiv.append(div);\r\n  }\r\n\r\n  public open() {\r\n    const ret = super.open();\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      this.renderFeatured();\r\n    });\r\n\r\n    return ret;\r\n  }\r\n\r\n  public renderFeatured() {\r\n    return this.managers.appStickersManager.getFeaturedStickers().then((coveredSets) => {\r\n      if(this.inputSearch.value) {\r\n        return;\r\n      }\r\n\r\n      coveredSets = this.filterRendered('', coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n\r\n  private filterRendered(query: string, coveredSets: StickerSetCovered[]) {\r\n    coveredSets = coveredSets.slice();\r\n\r\n    const children = Array.from(this.setsDiv.children) as HTMLElement[];\r\n    forEachReverse(children, el => {\r\n      const id = el.dataset.stickerSet;\r\n      const index = coveredSets.findIndex((covered) => covered.set.id === id);\r\n\r\n      if(index !== -1) {\r\n        coveredSets.splice(index, 1);\r\n      } else if(!query || !el.dataset.title.toLowerCase().includes(query.toLowerCase())) {\r\n        el.remove();\r\n      }\r\n    });\r\n\r\n    animationIntersector.checkAnimations(undefined, 'STICKERS-SEARCH');\r\n\r\n    return coveredSets;\r\n  }\r\n\r\n  public search(query: string) {\r\n    if(!query) {\r\n      return this.renderFeatured();\r\n    }\r\n\r\n    return this.managers.appStickersManager.searchStickerSets(query, false).then((coveredSets) => {\r\n      if(this.inputSearch.value !== query) {\r\n        return;\r\n      }\r\n\r\n      // console.log('search result:', coveredSets);\r\n\r\n      coveredSets = this.filterRendered(query, coveredSets);\r\n      coveredSets.forEach((set) => {\r\n        this.renderSet(set.set);\r\n      });\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport {horizontalMenu} from '../horizontalMenu';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport appSidebarRight from '../sidebarRight';\nimport StickyIntersector from '../stickyIntersector';\nimport EmojiTab from './tabs/emoji';\nimport GifsTab from './tabs/gifs';\nimport StickersTab from './tabs/stickers';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppGifsTab from '../sidebarRight/tabs/gifs';\nimport AppStickersTab from '../sidebarRight/tabs/stickers';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport whichChild from '../../helpers/dom/whichChild';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport DropdownHover from '../../helpers/dropdownHover';\nimport pause from '../../helpers/schedulers/pause';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport type LazyLoadQueueIntersector from '../lazyLoadQueueIntersector';\nimport {simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport overlayCounter from '../../helpers/overlayCounter';\n\nexport const EMOTICONSSTICKERGROUP: AnimationItemGroup = 'emoticons-dropdown';\n\nexport interface EmoticonsTab {\n  init: () => void,\n  onCloseAfterTimeout?: () => void\n}\n\nexport class EmoticonsDropdown extends DropdownHover {\n  public static lazyLoadQueue = new LazyLoadQueue();\n\n  private emojiTab: EmojiTab;\n  public stickersTab: StickersTab;\n  private gifsTab: GifsTab;\n\n  private container: HTMLElement;\n  private tabsEl: HTMLElement;\n  private tabId = -1;\n\n  private tabs: {[id: number]: EmoticonsTab};\n\n  private searchButton: HTMLElement;\n  private deleteBtn: HTMLElement;\n\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  private savedRange: Range;\n  private managers: AppManagers;\n\n  constructor() {\n    super({\n      element: document.getElementById('emoji-dropdown') as HTMLDivElement\n    });\n\n    this.addEventListener('open', async() => {\n      if(IS_TOUCH_SUPPORTED) {\n        // appImManager.chat.input.saveScroll();\n        if(blurActiveElement()) {\n          await pause(100);\n        }\n      }\n\n      if(this.element.parentElement !== appImManager.chat.input.chatInput) {\n        appImManager.chat.input.chatInput.append(this.element);\n      }\n\n      this.savedRange = this.getGoodRange();\n\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.unlock();\n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('opened', () => {\n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n    });\n\n    this.addEventListener('close', () => {\n      EmoticonsDropdown.lazyLoadQueue.lock();\n      // EmoticonsDropdown.lazyLoadQueue.lock();\n\n      //      \n      animationIntersector.lockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n    });\n\n    this.addEventListener('closed', () => {\n      //    visible,      \n      animationIntersector.unlockIntersectionGroup(EMOTICONSSTICKERGROUP);\n      EmoticonsDropdown.lazyLoadQueue.unlock();\n      EmoticonsDropdown.lazyLoadQueue.refresh();\n\n      // this.container.classList.remove('disable-hover');\n\n      this.savedRange = undefined;\n    });\n  }\n\n  protected init() {\n    this.managers = rootScope.managers;\n    this.emojiTab = new EmojiTab(this.managers);\n    this.stickersTab = new StickersTab(this.managers);\n    this.gifsTab = new GifsTab(this.managers);\n\n    this.tabs = {\n      0: this.emojiTab,\n      1: this.stickersTab,\n      2: this.gifsTab\n    };\n\n    this.container = this.element.querySelector('.emoji-container .tabs-container') as HTMLDivElement;\n    this.tabsEl = this.element.querySelector('.emoji-tabs') as HTMLUListElement;\n    this.selectTab = horizontalMenu(this.tabsEl, this.container, this.onSelectTabClick, () => {\n      const tab = this.tabs[this.tabId];\n      if(tab.init) {\n        tab.init();\n      }\n\n      tab.onCloseAfterTimeout && tab.onCloseAfterTimeout();\n      animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\n    });\n\n    this.searchButton = this.element.querySelector('.emoji-tabs-search');\n    this.searchButton.addEventListener('click', () => {\n      if(this.tabId === 1) {\n        if(!appSidebarRight.isTabExists(AppStickersTab)) {\n          appSidebarRight.createTab(AppStickersTab).open();\n        }\n      } else {\n        if(!appSidebarRight.isTabExists(AppGifsTab)) {\n          appSidebarRight.createTab(AppGifsTab).open();\n        }\n      }\n    });\n\n    this.deleteBtn = this.element.querySelector('.emoji-tabs-delete');\n    this.deleteBtn.addEventListener('click', (e) => {\n      const input = appImManager.chat.input.messageInput;\n      if((input.lastChild as any)?.tagName) {\n        input.lastElementChild.remove();\n      } else if(input.lastChild) {\n        if(!input.lastChild.textContent.length) {\n          input.lastChild.remove();\n        } else {\n          input.lastChild.textContent = input.lastChild.textContent.slice(0, -1);\n        }\n      }\n\n      const event = new Event('input', {bubbles: true, cancelable: true});\n      appImManager.chat.input.messageInput.dispatchEvent(event);\n      // appSidebarRight.stickersTab.init();\n\n      cancelEvent(e);\n    });\n\n    const HIDE_EMOJI_TAB = IS_APPLE_MOBILE;\n\n    const INIT_TAB_ID = HIDE_EMOJI_TAB ? 1 : 0;\n\n    if(HIDE_EMOJI_TAB) {\n      (this.tabsEl.children[1] as HTMLElement).classList.add('hide');\n    }\n\n    simulateClickEvent(this.tabsEl.children[INIT_TAB_ID + 1] as HTMLElement); // set emoji tab\n    if(this.tabs[INIT_TAB_ID].init) {\n      this.tabs[INIT_TAB_ID].init(); // onTransitionEnd  , ..    \n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      let lastMouseMoveEvent: MouseEvent, mouseMoveEventAttached = false;\n      const onMouseMove = (e: MouseEvent) => {\n        lastMouseMoveEvent = e;\n      };\n      overlayCounter.addEventListener('change', (isActive) => {\n        if(isActive) {\n          if(!mouseMoveEventAttached) {\n            document.body.addEventListener('mousemove', onMouseMove);\n            mouseMoveEventAttached = true;\n          }\n        } else if(mouseMoveEventAttached) {\n          document.body.removeEventListener('mousemove', onMouseMove);\n          if(lastMouseMoveEvent) {\n            this.onMouseOut(lastMouseMoveEvent);\n          }\n        }\n      });\n    }\n\n    appImManager.addEventListener('peer_changed', this.checkRights);\n    this.checkRights();\n\n    return super.init();\n  }\n\n  public getElement() {\n    return this.element;\n  }\n\n  private onSelectTabClick = (id: number) => {\n    if(this.tabId === id) {\n      return;\n    }\n\n    animationIntersector.checkAnimations(true, EMOTICONSSTICKERGROUP);\n\n    this.tabId = id;\n    this.searchButton.classList.toggle('hide', this.tabId === 0);\n    this.deleteBtn.classList.toggle('hide', this.tabId !== 0);\n  };\n\n  private checkRights = async() => {\n    const {peerId, threadId} = appImManager.chat;\n    const children = this.tabsEl.children;\n    const tabsElements = Array.from(children) as HTMLElement[];\n\n    const [canSendStickers, canSendGifs] = await Promise.all([\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_stickers'),\n      this.managers.appMessagesManager.canSendToPeer(peerId, threadId, 'send_gifs')\n    ]);\n\n    tabsElements[2].toggleAttribute('disabled', !canSendStickers);\n    tabsElements[3].toggleAttribute('disabled', !canSendGifs);\n\n    const active = this.tabsEl.querySelector('.active');\n    if(active && whichChild(active) !== 1 && (!canSendStickers || !canSendGifs)) {\n      this.selectTab(0, false);\n    }\n  };\n\n  public static menuOnClick = (menu: HTMLElement, scroll: Scrollable, menuScroll?: ScrollableX, prevId = 0) => {\n    let jumpedTo = -1;\n\n    const setActive = (id: number) => {\n      if(id === prevId) {\n        return false;\n      }\n\n      menu.children[prevId].classList.remove('active');\n      menu.children[id].classList.add('active');\n      prevId = id;\n\n      return true;\n    };\n\n    const stickyIntersector = new StickyIntersector(scroll.container, (stuck, target) => {\n      // console.log('sticky scrollTOp', stuck, target, scroll.container.scrollTop);\n\n      if(Math.abs(jumpedTo - scroll.container.scrollTop) <= 1) {\n        return;\n      } else {\n        jumpedTo = -1;\n      }\n\n      const which = whichChild(target);\n      if(!stuck && which) { // * due to stickyIntersector\n        return;\n      }\n\n      setActive(which);\n\n      if(menuScroll) {\n        menuScroll.scrollIntoViewNew({\n          element: menu.children[which] as HTMLElement,\n          position: 'center',\n          axis: 'x'\n        });\n      }\n    });\n\n    menu.addEventListener('click', (e) => {\n      let target = e.target as HTMLElement;\n      target = findUpClassName(target, 'menu-horizontal-div-item');\n\n      if(!target) {\n        return;\n      }\n\n      const which = whichChild(target);\n\n      /* if(menuScroll) {\n        menuScroll.scrollIntoView(target, false, 0);\n      } */\n\n      if(!setActive(which)) {\n        return;\n      }\n\n      let offsetTop = 0;\n      if(which > 0) {\n        const element = (scroll.splitUp || scroll.container).children[which] as HTMLElement;\n        offsetTop = element.offsetTop + 1; // * due to stickyIntersector\n      }\n\n      scroll.container.scrollTop = jumpedTo = offsetTop;\n\n      // console.log('set scrollTop:', offsetTop);\n    });\n\n    return {stickyIntersector, setActive};\n  };\n\n  public static onMediaClick = async(e: {target: EventTarget | Element}, clearDraft = false, silent?: boolean) => {\n    let target = e.target as HTMLElement;\n    target = findUpTag(target, 'DIV');\n\n    if(!target) return false;\n\n    const docId = target.dataset.docId;\n    if(!docId) return false;\n\n    return this.sendDocId(docId, clearDraft, silent);\n  };\n\n  public static async sendDocId(docId: DocId, clearDraft?: boolean, silent?: boolean) {\n    if(await appImManager.chat.input.sendMessageWithDocument(docId, undefined, clearDraft, silent)) {\n      /* dropdown.classList.remove('active');\n      toggleEl.classList.remove('active'); */\n      if(emoticonsDropdown.container) {\n        emoticonsDropdown.forceClose = true;\n        // emoticonsDropdown.container.classList.add('disable-hover');\n        emoticonsDropdown.toggle(false);\n      }\n\n      return true;\n    } else {\n      console.warn('got no doc by id:', docId);\n      return false;\n    }\n  }\n\n  public addLazyLoadQueueRepeat(lazyLoadQueue: LazyLoadQueueIntersector, processInvisibleDiv: (div: HTMLElement) => void) {\n    this.addEventListener('close', () => {\n      lazyLoadQueue.lock();\n    });\n\n    this.addEventListener('closed', () => {\n      const divs = lazyLoadQueue.intersector.getVisible();\n\n      for(const div of divs) {\n        processInvisibleDiv(div);\n      }\n\n      lazyLoadQueue.intersector.clearVisible();\n    });\n\n    this.addEventListener('opened', () => {\n      lazyLoadQueue.unlockAndRefresh();\n    });\n  }\n\n  public getSavedRange() {\n    return this.getGoodRange() || this.savedRange;\n  }\n\n  private getGoodRange() {\n    const sel = document.getSelection();\n    if(sel.rangeCount && document.activeElement === appImManager.chat.input.messageInput) {\n      return sel.getRangeAt(0);\n    }\n  }\n}\n\nconst emoticonsDropdown = new EmoticonsDropdown();\nMOUNT_CLASS_TO.emoticonsDropdown = emoticonsDropdown;\nexport default emoticonsDropdown;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport emoticonsDropdown, {EmoticonsDropdown, EmoticonsTab} from '..';\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\nimport {fastRaf} from '../../../helpers/schedulers';\nimport pause from '../../../helpers/schedulers/pause';\nimport appImManager from '../../../lib/appManagers/appImManager';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport {emojiFromCodePoints} from '../../../vendor/emoji';\nimport {putPreloader} from '../../putPreloader';\nimport Scrollable, {ScrollableX} from '../../scrollable';\nimport StickyIntersector from '../../stickyIntersector';\nimport IS_EMOJI_SUPPORTED from '../../../environment/emojiSupport';\nimport IS_TOUCH_SUPPORTED from '../../../environment/touchSupport';\nimport blurActiveElement from '../../../helpers/dom/blurActiveElement';\nimport Emoji from '../../../config/emoji';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport fixEmoji from '../../../lib/richTextProcessor/fixEmoji';\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\nimport wrapSingleEmoji from '../../../lib/richTextProcessor/wrapSingleEmoji';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport {StickersTabCategory} from './stickers';\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\n\nconst loadedURLs: Set<string> = new Set();\nexport function appendEmoji(emoji: string, container: HTMLElement, prepend = false, unify = false) {\n  // const emoji = details.unified;\n  // const emoji = (details.unified as string).split('-')\n  // .reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\n\n  const spanEmoji = document.createElement('span');\n  spanEmoji.classList.add('super-emoji');\n\n  let kek: DocumentFragment;\n  if(unify && !IS_EMOJI_SUPPORTED) {\n    kek = wrapSingleEmoji(emoji);\n  } else {\n    emoji = fixEmoji(emoji);\n    kek = wrapEmojiText(emoji);\n  }\n\n  /* if(!kek.includes('emoji')) {\n    console.log(emoji, kek, spanEmoji, emoji.length, new TextEncoder().encode(emoji), emojiUnicode(emoji));\n    return;\n  } */\n\n  // console.log(kek);\n\n  spanEmoji.append(kek);\n\n  if(spanEmoji.children.length > 1) {\n    const first = spanEmoji.firstElementChild;\n    spanEmoji.innerHTML = '';\n    spanEmoji.append(first);\n  }\n\n  if(spanEmoji.firstElementChild?.tagName === 'IMG') {\n    const image = spanEmoji.firstElementChild as HTMLImageElement;\n\n    const url = image.src;\n    if(!loadedURLs.has(url)) {\n      image.setAttribute('loading', 'lazy');\n      const placeholder = document.createElement('span');\n      placeholder.classList.add('emoji-placeholder');\n\n      if(rootScope.settings.animationsEnabled) {\n        image.style.opacity = '0';\n        placeholder.style.opacity = '1';\n      }\n\n      image.addEventListener('load', () => {\n        fastRaf(() => {\n          if(rootScope.settings.animationsEnabled) {\n            image.style.opacity = '';\n            placeholder.style.opacity = '';\n          }\n\n          spanEmoji.classList.remove('empty');\n\n          loadedURLs.add(url);\n        });\n      }, {once: true});\n\n      spanEmoji.append(placeholder);\n    }\n  }\n\n  // spanEmoji = spanEmoji.firstElementChild as HTMLSpanElement;\n  // spanEmoji.setAttribute('emoji', emoji);\n  if(prepend) container.prepend(spanEmoji);\n  else container.appendChild(spanEmoji);\n}\n\nexport function getEmojiFromElement(element: HTMLElement) {\n  if(!findUpClassName(element, 'super-emoji')) return '';\n\n  if(element.nodeType === 3) return element.nodeValue;\n  if(element.tagName === 'SPAN' && !element.classList.contains('emoji') && element.firstElementChild) {\n    element = element.firstElementChild as HTMLElement;\n  }\n\n  return element.getAttribute('alt') || element.innerText;\n}\n\nexport default class EmojiTab implements EmoticonsTab {\n  private content: HTMLElement;\n\n  private recentItemsDiv: HTMLElement;\n\n  private scroll: Scrollable;\n  private stickyIntersector: StickyIntersector;\n  private menu: HTMLElement;\n\n  private closeScrollTop = 0;\n  private setMenuActive: (id: number) => boolean;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  init() {\n    this.content = document.getElementById('content-emoji') as HTMLDivElement;\n\n    const EMOJI_RECENT_CATEGORY: (typeof EMOJI_CATEGORIES)[0] = ['Emoji.Recent', 'recent'];\n    const EMOJI_CATEGORIES: [LangPackKey, string][] = [\n      ['Emoji.SmilesAndPeople', 'smile'],\n      ['Emoji.AnimalsAndNature', 'animals'],\n      ['Emoji.FoodAndDrink', 'eats'],\n      ['Emoji.TravelAndPlaces', 'car'],\n      ['Emoji.ActivityAndSport', 'sport'],\n      ['Emoji.Objects', 'lamp'],\n      // ['Emoji.Symbols', 'info'],\n      ['Emoji.Flags', 'flag'],\n      ['Skin Tones' as any, '']\n    ];\n    const divs: {\n      [category in LangPackKey]?: StickersTabCategory\n    } = {};\n\n    const sorted: Map<(typeof EMOJI_CATEGORIES)[0], string[]> = new Map([\n      [\n        EMOJI_RECENT_CATEGORY,\n        []\n      ]\n    ]);\n\n    for(const emoji in Emoji) {\n      const details = Emoji[emoji];\n      const i = '' + details;\n      const category = EMOJI_CATEGORIES[+i[0] - 1];\n      if(!category) continue; // maybe it's skin tones\n\n      let s = sorted.get(category);\n      if(!s) {\n        s = [];\n        sorted.set(category, s);\n      }\n\n      s[+i.slice(1) || 0] = emoji;\n    }\n\n    sorted.delete(EMOJI_CATEGORIES.pop());\n\n    sorted.forEach((emojis, emojiCategory) => {\n      const titleLangPackKey = emojiCategory[0];\n      const category = new StickersTabCategory({\n        id: titleLangPackKey,\n        overflowElement: this.content,\n        title: i18n(titleLangPackKey),\n        getElementMediaSize: () => undefined\n      });\n\n      category.elements.menuTab.classList.add('tgico', 'tgico-' + emojiCategory[1]);\n      category.elements.menuTabPadding.remove();\n      category.elements.items.classList.add('super-emojis');\n\n      emojis.forEach((unified) => {\n        /* if(emojiUnicode(emoji) === '1f481-200d-2642') {\n          console.log('append emoji', emoji, emojiUnicode(emoji));\n        } */\n\n        const emoji = emojiFromCodePoints(unified);\n        // if(emoji.includes('')) {\n        // console.log('toCodePoints', toCodePoints(emoji));\n        // emoji = emoji.replace(/(\\u200d[\\u2640\\u2642\\u2695])(?!\\ufe0f)/, '\\ufe0f$1');\n        // const zwjIndex = emoji.indexOf('\\u200d');\n        // if(zwjIndex !== -1 && !emoji.includes('\\ufe0f')) {\n        //   /* if(zwjIndex !== (emoji.length - 1)) {\n        //     emoji = emoji.replace(/(\\u200d)/g, '\\ufe0f$1');\n        //   } */\n\n        //   emoji += '\\ufe0f';\n        //   //emoji += '\\ufe0f';\n        // }\n\n        // debugger;\n        // }\n\n        appendEmoji(emoji/* .replace(/[\\ufe0f\\u2640\\u2642\\u2695]/g, '') */, category.elements.items, false/* , false */);\n\n        /* if(category === 'Smileys & Emotion') {\n          console.log('appended emoji', emoji, itemsDiv.children[itemsDiv.childElementCount - 1].innerHTML, emojiUnicode(emoji));\n        } */\n      });\n\n      divs[titleLangPackKey] = category;\n    });\n\n    const menuWrapper = this.content.previousElementSibling as HTMLElement;\n    const menu = this.menu = menuWrapper.firstElementChild as HTMLElement;\n    const menuScroll = new ScrollableX(menuWrapper);\n\n    const emojiScroll = this.scroll = new Scrollable(this.content, 'EMOJI');\n\n    const preloader = putPreloader(this.content, true);\n\n    Promise.all([\n      pause(200),\n      this.managers.appEmojiManager.getRecentEmojis()\n    ]).then(([_, recent]) => {\n      preloader.remove();\n\n      const m = EmoticonsDropdown.menuOnClick(menu, emojiScroll, menuScroll);\n      this.stickyIntersector = m.stickyIntersector;\n      this.setMenuActive = m.setActive;\n\n      const hasRecent = !!recent.length;\n      const activeId = hasRecent ? 0 : 1;\n      const recentCategory = divs[EMOJI_RECENT_CATEGORY[0]];\n      recentCategory.elements.menuTab.classList.toggle('hide', !hasRecent);\n\n      this.recentItemsDiv = recentCategory.elements.items;\n      for(const emoji of recent) {\n        appendEmoji(emoji, this.recentItemsDiv);\n      }\n\n      recentCategory.elements.container.classList.toggle('hide', !this.recentItemsDiv.childElementCount);\n\n      EMOJI_CATEGORIES.unshift(EMOJI_RECENT_CATEGORY);\n      EMOJI_CATEGORIES.map(([id], idx) => {\n        const category = divs[id];\n\n        positionElementByIndex(category.elements.menuTab, menu, idx);\n        emojiScroll.container.append(category.elements.container);\n        this.stickyIntersector.observeStickyHeaderChanges(category.elements.container);\n        return category;\n      });\n\n      this.menu.children[activeId].classList.add('active');\n      this.setMenuActive(activeId);\n    });\n\n    attachClickEvent(this.content, this.onContentClick);\n    this.init = null;\n\n    rootScope.addEventListener('emoji_recent', (emoji) => {\n      const children = Array.from(this.recentItemsDiv.children) as HTMLElement[];\n      for(let i = 0, length = children.length; i < length; ++i) {\n        const el = children[i];\n        const _emoji = fixEmoji(getEmojiFromElement(el));\n        if(emoji === _emoji) {\n          if(i === 0) {\n            return;\n          }\n\n          el.remove();\n        }\n      }\n\n      appendEmoji(emoji, this.recentItemsDiv, true);\n      this.recentItemsDiv.parentElement.classList.remove('hide');\n      this.menu.children[0].classList.remove('hide');\n\n      if(!this.closeScrollTop) {\n        this.setMenuActive(0);\n      }\n    });\n\n    emoticonsDropdown.addEventListener('close', () => {\n      this.closeScrollTop = this.scroll.scrollTop;\n    });\n  }\n\n  onContentClick = (e: MouseEvent) => {\n    cancelEvent(e);\n\n    const emoji = getEmojiFromElement(e.target as HTMLElement);\n    if(!emoji) {\n      return;\n    }\n\n    appImManager.chat.input.onEmojiSelected(emoji, false);\n    if(IS_TOUCH_SUPPORTED) {\n      blurActiveElement();\n    }\n  };\n\n  onClose() {\n\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getEmojiEntityFromEmoji from './getEmojiEntityFromEmoji';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapSingleEmoji(emoji: string) {\n  return wrapRichText(emoji, {\n    entities: [getEmojiEntityFromEmoji(emoji)]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat extends LazyLoadQueueIntersector {\n  private _queue: Map<HTMLElement, LazyLoadElement> = new Map();\n\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange, options?: IntersectionObserverInit) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible) {\n        const items = spliced.length ? spliced : [this._queue.get(target)];\n        items.forEach((item) => {\n          this.queue.unshift(item || this._queue.get(target));\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    }, options);\n  }\n\n  public clear() {\n    super.clear();\n    this._queue.clear();\n  }\n\n  /* public async processItem(item: LazyLoadElement) {\n    //await super.processItem(item);\n    await LazyLoadQueueBase.prototype.processItem.call(this, item);\n\n    if(this.lazyLoadMedia.length) {\n      this.processQueue();\n    }\n  } */\n\n  public observe(el: LazyLoadElement) {\n    this._queue.set(el.div, el);\n    this.intersector.observe(el.div);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport emoticonsDropdown, {EmoticonsDropdown, EMOTICONSSTICKERGROUP, EmoticonsTab} from '..';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport mediaSizes from '../../../helpers/mediaSizes';\r\nimport {MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport {AppManagers} from '../../../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport animationIntersector, {AnimationItemGroup} from '../../animationIntersector';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport LazyLoadQueueRepeat from '../../lazyLoadQueueRepeat';\r\nimport {putPreloader} from '../../putPreloader';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport Scrollable, {ScrollableX} from '../../scrollable';\r\nimport StickyIntersector from '../../stickyIntersector';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport noop from '../../../helpers/noop';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport VisibilityIntersector, {OnVisibilityChange} from '../../visibilityIntersector';\r\nimport createStickersContextMenu from '../../../helpers/dom/createStickersContextMenu';\r\nimport findUpAsChild from '../../../helpers/dom/findUpAsChild';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport attachStickerViewerListeners from '../../stickerViewer';\r\nimport ListenerSetter from '../../../helpers/listenerSetter';\r\nimport wrapSticker from '../../wrappers/sticker';\r\nimport wrapStickerSetThumb from '../../wrappers/stickerSetThumb';\r\nimport {MediaSize} from '../../../helpers/mediaSize';\r\n\r\nexport class SuperStickerRenderer {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat;\r\n  private animated: Set<HTMLElement> = new Set();\r\n\r\n  constructor(\r\n    private regularLazyLoadQueue: LazyLoadQueue,\r\n    private group: AnimationItemGroup,\r\n    private managers: AppManagers,\r\n    private options?: IntersectionObserverInit\r\n  ) {\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat(undefined, ({target, visible}) => {\r\n      if(!visible) {\r\n        this.processInvisible(target);\r\n      }\r\n    }, options);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  public renderSticker(doc: MyDocument, element?: HTMLElement, loadPromises?: Promise<any>[]) {\r\n    if(!element) {\r\n      element = document.createElement('div');\r\n      element.classList.add('grid-item', 'super-sticker');\r\n      element.dataset.docId = '' + doc.id;\r\n\r\n      if(doc.animated) {\r\n        this.observeAnimated(element);\r\n      }\r\n    }\r\n\r\n    // * This will wrap only a thumb\r\n    /* !doc.animated &&  */wrapSticker({\r\n      doc,\r\n      div: element,\r\n      lazyLoadQueue: this.regularLazyLoadQueue,\r\n      group: this.group,\r\n      onlyThumb: doc.animated,\r\n      loadPromises\r\n    });\r\n\r\n    return element;\r\n  }\r\n\r\n  public observeAnimated(element: HTMLElement) {\r\n    this.animated.add(element);\r\n    this.lazyLoadQueue.observe({\r\n      div: element,\r\n      load: this.processVisible\r\n    });\r\n  }\r\n\r\n  public unobserveAnimated(element: HTMLElement) {\r\n    this.animated.delete(element);\r\n    this.lazyLoadQueue.unobserve(element);\r\n  }\r\n\r\n  private checkAnimationContainer = (element: HTMLElement, visible: boolean) => {\r\n    // console.error('checkAnimationContainer', div, visible);\r\n    const players = animationIntersector.getAnimations(element);\r\n    players.forEach((player) => {\r\n      if(!visible) {\r\n        animationIntersector.checkAnimation(player, true, true);\r\n      } else {\r\n        animationIntersector.checkAnimation(player, false);\r\n      }\r\n    });\r\n  };\r\n\r\n  private processVisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    const size = mediaSizes.active.esgSticker.width;\r\n\r\n    // console.log('processVisibleDiv:', div);\r\n\r\n    const promise = wrapSticker({\r\n      doc,\r\n      div: element,\r\n      width: size,\r\n      height: size,\r\n      lazyLoadQueue: null,\r\n      group: this.group,\r\n      onlyThumb: false,\r\n      play: true,\r\n      loop: true,\r\n      withLock: true\r\n    }).then(({render}) => render);\r\n\r\n    promise.then(() => {\r\n      // clearTimeout(timeout);\r\n      this.checkAnimationContainer(element, this.lazyLoadQueue.intersector.isVisible(element));\r\n    });\r\n\r\n    /* let timeout = window.setTimeout(() => {\r\n      console.error('processVisibleDiv timeout', div, doc);\r\n    }, 1e3); */\r\n\r\n    return promise;\r\n  };\r\n\r\n  public processInvisible = async(element: HTMLElement) => {\r\n    const docId = element.dataset.docId;\r\n    const doc = await this.managers.appDocsManager.getDoc(docId);\r\n\r\n    // console.log('STICKER INvisible:', /* div,  */docId);\r\n\r\n    this.checkAnimationContainer(element, false);\r\n\r\n    element.textContent = '';\r\n    this.renderSticker(doc, element as HTMLDivElement);\r\n  };\r\n}\r\n\r\nexport class StickersTabCategory {\r\n  public elements: {\r\n    container: HTMLElement,\r\n    title: HTMLElement,\r\n    items: HTMLElement,\r\n    menuTab: HTMLElement,\r\n    menuTabPadding: HTMLElement\r\n  };\r\n  public items: {\r\n    document: MyDocument,\r\n    element: HTMLElement\r\n  }[];\r\n  public mounted: boolean;\r\n  public id: string;\r\n  public limit: number;\r\n\r\n  private overflowElement: HTMLElement;\r\n  private getElementMediaSize: () => MediaSize;\r\n\r\n  constructor(options: {\r\n    id: string,\r\n    title: HTMLElement | DocumentFragment,\r\n    overflowElement: HTMLElement,\r\n    getElementMediaSize: () => MediaSize\r\n  }) {\r\n    const container = document.createElement('div');\r\n    container.classList.add('emoji-category');\r\n\r\n    const items = document.createElement('div');\r\n    items.classList.add('category-items');\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('category-title');\r\n    title.append(options.title);\r\n\r\n    const menuTab = ButtonIcon(undefined, {noRipple: true});\r\n    menuTab.classList.add('menu-horizontal-div-item');\r\n\r\n    const menuTabPadding = document.createElement('div');\r\n    menuTabPadding.classList.add('menu-horizontal-div-item-padding');\r\n\r\n    menuTab.append(menuTabPadding);\r\n\r\n    container.append(title, items);\r\n\r\n    this.elements = {\r\n      container,\r\n      title,\r\n      items,\r\n      menuTab,\r\n      menuTabPadding\r\n    };\r\n    this.id = options.id;\r\n    this.items = [];\r\n\r\n    this.overflowElement = options.overflowElement;\r\n    this.getElementMediaSize = options.getElementMediaSize;\r\n  }\r\n\r\n  public setCategoryItemsHeight() {\r\n    const containerWidth = this.overflowElement.getBoundingClientRect().width - 10;\r\n    const elementSize = this.getElementMediaSize().width;\r\n\r\n    const itemsPerRow = Math.floor(containerWidth / elementSize);\r\n    const rows = Math.ceil(this.items.length / itemsPerRow);\r\n    const height = rows * elementSize;\r\n\r\n    this.elements.items.style.minHeight = height + 'px';\r\n  }\r\n}\r\n\r\ntype S = StickersTabCategory & {set?: StickerSet};\r\n\r\nclass EmoticonsTabC {\r\n  protected content: HTMLElement;\r\n\r\n  protected categories: {[id: string]: S};\r\n  protected categoriesMap: Map<HTMLElement, S>;\r\n  protected categoriesIntersector: VisibilityIntersector;\r\n  protected localCategories: StickersTabCategory[];\r\n\r\n  protected scroll: Scrollable;\r\n  protected menu: HTMLElement;\r\n  protected mounted = false;\r\n  protected stickyIntersector: StickyIntersector;\r\n\r\n  constructor(\r\n    protected managers: AppManagers\r\n  ) {\r\n    this.categories = {};\r\n    this.categoriesMap = new Map();\r\n    this.localCategories = [];\r\n  }\r\n\r\n  protected createCategory(stickerSet: StickerSet, title: HTMLElement | DocumentFragment) {\r\n    const category: S = new StickersTabCategory({\r\n      id: '' + stickerSet.id,\r\n      title,\r\n      overflowElement: this.content,\r\n      getElementMediaSize: () => mediaSizes.active.esgSticker\r\n    });\r\n\r\n    category.elements.items.classList.add('super-stickers');\r\n    const container = category.elements.container;\r\n    container.classList.add('hide');\r\n\r\n    category.set = stickerSet;\r\n    this.categories[stickerSet.id] = category;\r\n    this.categoriesMap.set(container, category);\r\n\r\n    this.categoriesIntersector.observe(container);\r\n    this.stickyIntersector.observeStickyHeaderChanges(container);\r\n\r\n    return category;\r\n  }\r\n\r\n  protected isCategoryVisible(category: StickersTabCategory) {\r\n    return this.categoriesIntersector.getVisible().includes(category.elements.container);\r\n  }\r\n\r\n  protected toggleLocalCategory(category: StickersTabCategory, visible: boolean) {\r\n    if(!visible) {\r\n      category.elements.menuTab.remove();\r\n      category.elements.container.remove();\r\n    } else {\r\n      let idx = this.localCategories.indexOf(category);\r\n      const notMounted = this.localCategories.slice(0, idx).filter((category) => !category.mounted);\r\n      idx -= notMounted.length;\r\n      positionElementByIndex(category.elements.menuTab, this.menu, idx);\r\n      positionElementByIndex(category.elements.container, this.scroll.container, idx);\r\n    }\r\n\r\n    category.mounted = visible;\r\n    // category.elements.container.classList.toggle('hide', !visible);\r\n  }\r\n\r\n  protected onLocalCategoryUpdate(category: StickersTabCategory) {\r\n    category.setCategoryItemsHeight();\r\n    this.toggleLocalCategory(category, !!category.items.length);\r\n  }\r\n}\r\n\r\nexport default class StickersTab extends EmoticonsTabC implements EmoticonsTab {\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n\r\n  private setFavedLimit(appConfig: MTAppConfig) {\r\n    const limit = rootScope.premium ? appConfig.stickers_faved_limit_premium : appConfig.stickers_faved_limit_default;\r\n    const category = this.categories['faved'];\r\n    category.limit = limit;\r\n  }\r\n\r\n  private categoryAppendStickers(\r\n    category: StickersTabCategory,\r\n    promise: Promise<MyDocument[]>\r\n  ) {\r\n    const {container} = category.elements;\r\n\r\n    promise.then((documents) => {\r\n      const isVisible = this.isCategoryVisible(category);\r\n\r\n      documents.forEach((document) => {\r\n        const element = this.superStickerRenderer.renderSticker(document);\r\n        category.items.push({document, element});\r\n\r\n        if(isVisible) {\r\n          category.elements.items.append(element);\r\n        }\r\n      });\r\n\r\n      category.setCategoryItemsHeight();\r\n      container.classList.remove('hide');\r\n    });\r\n  }\r\n\r\n  private async renderStickerSet(set: StickerSet.stickerSet, prepend = false) {\r\n    const category = this.createCategory(set, wrapEmojiText(set.title));\r\n    const {menuTab, menuTabPadding, container} = category.elements;\r\n\r\n    const pos = prepend ? this.localCategories.filter((category) => category.mounted).length : 0xFFFF;\r\n    positionElementByIndex(menuTab, this.menu, pos);\r\n\r\n    const promise = this.managers.appStickersManager.getStickerSet(set);\r\n    this.categoryAppendStickers(\r\n      category,\r\n      promise.then((stickerSet) => stickerSet.documents as MyDocument[])\r\n    );\r\n    // const stickerSet = await promise;\r\n\r\n    positionElementByIndex(container, this.scroll.container, pos, -1);\r\n\r\n    wrapStickerSetThumb({\r\n      set,\r\n      container: menuTabPadding,\r\n      group: EMOTICONSSTICKERGROUP,\r\n      lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n      width: 32,\r\n      height: 32,\r\n      autoplay: false\r\n    });\r\n  }\r\n\r\n  public init() {\r\n    this.content = document.getElementById('content-stickers');\r\n    const menuWrapper = this.content.previousElementSibling as HTMLElement;\r\n    const menu = this.menu = menuWrapper.firstElementChild as HTMLElement;\r\n    const menuScroll = new ScrollableX(menuWrapper);\r\n\r\n    this.scroll = new Scrollable(this.content, 'STICKERS');\r\n    this.scroll.onAdditionalScroll = () => {\r\n      setTyping();\r\n    };\r\n\r\n    /* stickersDiv.addEventListener('mouseover', (e) => {\r\n      let target = e.target as HTMLElement;\r\n\r\n      if(target.tagName === 'CANVAS') { // turn on sticker\r\n        let animation = lottieLoader.getAnimation(target.parentElement, EMOTICONSSTICKERGROUP);\r\n\r\n        if(animation) {\r\n          // @ts-ignore\r\n          if(animation.currentFrame === animation.totalFrames - 1) {\r\n            animation.goToAndPlay(0, true);\r\n          } else {\r\n            animation.play();\r\n          }\r\n        }\r\n      }\r\n    }); */\r\n\r\n    const onCategoryVisibility: OnVisibilityChange = ({target, visible, entry}) => {\r\n      const category = this.categoriesMap.get(target);\r\n      if(!visible) {\r\n        category.elements.items.textContent = '';\r\n      } else {\r\n        category.elements.items.append(...category.items.map(({element}) => element));\r\n      }\r\n    };\r\n\r\n    const intersectionOptions: IntersectionObserverInit = {root: emoticonsDropdown.getElement()};\r\n    this.categoriesIntersector = new VisibilityIntersector(onCategoryVisibility, intersectionOptions);\r\n\r\n    const clearCategoryItems = (category: StickersTabCategory) => {\r\n      category.elements.items.textContent = '';\r\n      category.items.forEach(({element}) => this.superStickerRenderer.unobserveAnimated(element));\r\n      category.items.length = 0;\r\n    };\r\n\r\n    this.scroll.container.addEventListener('click', (e) => {\r\n      const target = e.target as HTMLElement;\r\n      if(findUpClassName(target, 'category-title')) {\r\n        const container = findUpClassName(target, 'emoji-category');\r\n        const category = this.categoriesMap.get(container);\r\n        if(category.id === 'recent') {\r\n          return;\r\n        }\r\n\r\n        new PopupStickers({id: category.set.id, access_hash: category.set.access_hash}).show();\r\n        return;\r\n      }\r\n\r\n      EmoticonsDropdown.onMediaClick(e);\r\n    });\r\n\r\n    const setTyping = (cancel = false) => {\r\n      rootScope.dispatchEvent('choosing_sticker', !cancel);\r\n    };\r\n\r\n    emoticonsDropdown.addEventListener('closed', () => {\r\n      setTyping(true);\r\n    });\r\n\r\n    emoticonsDropdown.addEventListener('opened', () => {\r\n      setTyping();\r\n    });\r\n\r\n    const {stickyIntersector, setActive} = EmoticonsDropdown.menuOnClick(menu, this.scroll, menuScroll);\r\n    this.stickyIntersector = stickyIntersector;\r\n\r\n    const preloader = putPreloader(this.content, true);\r\n\r\n    const createLocalCategory = (id: string, title: LangPackKey, icon?: string) => {\r\n      const category = this.createCategory({id} as any, i18n(title));\r\n      this.localCategories.push(category);\r\n      category.elements.title.classList.add('disable-hover');\r\n      icon && category.elements.menuTab.classList.add('tgico', 'tgico-' + icon);\r\n      category.elements.menuTabPadding.remove();\r\n      this.toggleLocalCategory(category, false);\r\n      return category;\r\n    };\r\n\r\n    const onCategoryStickers = (category: StickersTabCategory, stickers: MyDocument[]) => {\r\n      // if(category.id === 'faved' && category.limit && category.limit < stickers.length) {\r\n      //   category.limit = stickers.length;\r\n      // }\r\n\r\n      if(category.limit) {\r\n        stickers = stickers.slice(0, category.limit);\r\n      }\r\n\r\n      const ids = new Set(stickers.map((doc) => doc.id));\r\n      forEachReverse(category.items, (item) => {\r\n        if(!ids.has(item.document.id)) {\r\n          this.deleteSticker(category, item.document, true);\r\n        }\r\n      });\r\n\r\n      this.toggleLocalCategory(category, !!stickers.length);\r\n      forEachReverse(stickers, (doc, idx) => {\r\n        this.unshiftSticker(category, doc, true, idx);\r\n      });\r\n      this.spliceExceed(category);\r\n      category.elements.container.classList.remove('hide');\r\n    };\r\n\r\n    const favedCategory = createLocalCategory('faved', 'FavoriteStickers', 'saved');\r\n    favedCategory.elements.menuTab.classList.add('active');\r\n\r\n    const recentCategory = createLocalCategory('recent', 'Stickers.Recent', 'recent');\r\n    recentCategory.limit = 20;\r\n\r\n    const clearButton = ButtonIcon('close', {noRipple: true});\r\n    recentCategory.elements.title.append(clearButton);\r\n    attachClickEvent(clearButton, () => {\r\n      confirmationPopup({\r\n        titleLangKey: 'ClearRecentStickersAlertTitle',\r\n        descriptionLangKey: 'ClearRecentStickersAlertMessage',\r\n        button: {\r\n          langKey: 'Clear'\r\n        }\r\n      }).then(() => {\r\n        this.managers.appStickersManager.clearRecentStickers();\r\n      }, noop);\r\n    });\r\n\r\n    const premiumCategory = createLocalCategory('premium', 'PremiumStickersShort');\r\n    const s = document.createElement('span');\r\n    s.classList.add('tgico-star', 'color-premium');\r\n    premiumCategory.elements.menuTab.append(s);\r\n\r\n    const promises = [\r\n      Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appStickersManager.getFavedStickersStickers()\r\n      ]).then(([appConfig, stickers]) => {\r\n        this.setFavedLimit(appConfig);\r\n        onCategoryStickers(favedCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getRecentStickersStickers().then((stickers) => {\r\n        onCategoryStickers(recentCategory, stickers);\r\n      }),\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((res) => {\r\n        for(const set of (res as MessagesAllStickers.messagesAllStickers).sets) {\r\n          this.renderStickerSet(set);\r\n        }\r\n      }),\r\n\r\n      this.managers.appStickersManager.getPremiumStickers().then((stickers) => {\r\n        const length = stickers.length;\r\n        this.toggleLocalCategory(premiumCategory, rootScope.premium && !!length);\r\n        this.categoryAppendStickers(premiumCategory, Promise.resolve(stickers));\r\n\r\n        rootScope.addEventListener('premium_toggle', (isPremium) => {\r\n          this.toggleLocalCategory(this.categories['premium'], isPremium && !!length);\r\n        });\r\n      })\r\n    ];\r\n\r\n    Promise.race(promises).finally(() => {\r\n      preloader.remove();\r\n    });\r\n\r\n    Promise.all(promises).finally(() => {\r\n      this.mounted = true;\r\n      setTyping();\r\n      setActive(0);\r\n    });\r\n\r\n    this.superStickerRenderer = new SuperStickerRenderer(EmoticonsDropdown.lazyLoadQueue, EMOTICONSSTICKERGROUP, this.managers, intersectionOptions);\r\n\r\n    const rendererLazyLoadQueue = this.superStickerRenderer.lazyLoadQueue;\r\n    emoticonsDropdown.addLazyLoadQueueRepeat(rendererLazyLoadQueue, this.superStickerRenderer.processInvisible);\r\n\r\n    // emoticonsDropdown.addEventListener('close', () => {\r\n    //   this.categoriesIntersector.lock();\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('closed', () => {\r\n    //   for(const [container] of this.categoriesMap) {\r\n    //     onCategoryVisibility(container, false);\r\n    //   }\r\n    // });\r\n\r\n    // emoticonsDropdown.addEventListener('opened', () => {\r\n    //   this.categoriesIntersector.unlockAndRefresh();\r\n    // });\r\n\r\n    // setInterval(() => {\r\n    //   // @ts-ignore\r\n    //   const players = Object.values(lottieLoader.players).filter((p) => p.width >= 80);\r\n\r\n    //   console.log(\r\n    //     'STICKERS RENDERED IN PANEL:',\r\n    //     players.length,\r\n    //     players.filter((p) => !p.paused).length,\r\n    //     rendererLazyLoadQueue.intersector.getVisible().length\r\n    //   );\r\n    // }, .25e3);\r\n\r\n    rootScope.addEventListener('stickers_installed', (set) => {\r\n      if(!this.categories[set.id] && this.mounted) {\r\n        this.renderStickerSet(set, true);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_deleted', ({id}) => {\r\n      const category = this.categories[id];\r\n      if(category && this.mounted) {\r\n        category.elements.container.remove();\r\n        category.elements.menuTab.remove();\r\n        this.categoriesIntersector.unobserve(category.elements.container);\r\n        clearCategoryItems(category);\r\n        delete this.categories[id];\r\n        this.categoriesMap.delete(category.elements.container);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('sticker_updated', ({type, document, faved}) => {\r\n      // if(type === 'faved') {\r\n      //   return;\r\n      // }\r\n\r\n      const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n      if(category) {\r\n        if(faved) {\r\n          this.unshiftSticker(category, document);\r\n        } else {\r\n          this.deleteSticker(category, document);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('stickers_updated', ({type, stickers}) => {\r\n      if(this.mounted) {\r\n        const category = this.categories[type === 'faved' ? 'faved' : 'recent'];\r\n        onCategoryStickers(category, stickers);\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('app_config', (appConfig) => {\r\n      this.setFavedLimit(appConfig);\r\n    });\r\n\r\n    const resizeCategories = () => {\r\n      for(const [container, category] of this.categoriesMap) {\r\n        category.setCategoryItemsHeight();\r\n      }\r\n    };\r\n\r\n    mediaSizes.addEventListener('resize', resizeCategories);\r\n\r\n    emoticonsDropdown.addEventListener('opened', resizeCategories);\r\n\r\n    attachStickerViewerListeners({listenTo: this.content, listenerSetter: new ListenerSetter()});\r\n\r\n    createStickersContextMenu({\r\n      listenTo: this.content,\r\n      verifyRecent: (target) => !!findUpAsChild(target, this.categories['recent'].elements.items),\r\n      onOpen: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(true);\r\n      },\r\n      onClose: () => {\r\n        emoticonsDropdown.setIgnoreMouseOut(false);\r\n      }\r\n    });\r\n\r\n    this.init = null;\r\n  }\r\n\r\n  public deleteSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean) {\r\n    const item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(item) {\r\n      item.element.remove();\r\n\r\n      if(!batch) {\r\n        this.onLocalCategoryUpdate(category);\r\n      }\r\n    }\r\n  }\r\n\r\n  private spliceExceed(category: StickersTabCategory) {\r\n    const {items, limit} = category;\r\n    items.splice(limit, items.length - limit).forEach(({element}) => {\r\n      element.remove();\r\n    });\r\n\r\n    this.onLocalCategoryUpdate(category);\r\n  }\r\n\r\n  public unshiftSticker(category: StickersTabCategory, doc: MyDocument, batch?: boolean, idx?: number) {\r\n    if(idx !== undefined) {\r\n      const i = category.items[idx];\r\n      if(i && i.document.id === doc.id) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    let item = findAndSplice(category.items, (item) => item.document.id === doc.id);\r\n    if(!item) {\r\n      item = {\r\n        element: this.superStickerRenderer.renderSticker(doc),\r\n        document: doc\r\n      };\r\n    }\r\n\r\n    category.items.unshift(item);\r\n    category.elements.items.prepend(item.element);\r\n\r\n    if(!batch) {\r\n      this.spliceExceed(category);\r\n    }\r\n  }\r\n\r\n  public unshiftRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id);\r\n  }\r\n\r\n  public deleteRecentSticker(doc: MyDocument) {\r\n    this.managers.appStickersManager.saveRecentSticker(doc.id, true);\r\n  }\r\n\r\n  onClose() {\r\n\r\n  }\r\n}\r\n","import {_i18n} from '../lib/langPack';\n\nexport default function generateFakeIcon(isScam?: boolean) {\n  const span = document.createElement('span');\n  span.classList.add('badge-fake');\n  _i18n(span, isScam ? 'ScamMessage' : 'FakeMessage');\n  return span;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueIntersector from './lazyLoadQueueIntersector';\nimport VisibilityIntersector, {OnVisibilityChange} from './visibilityIntersector';\n\nexport default class LazyLoadQueueRepeat2 extends LazyLoadQueueIntersector {\n  constructor(parallelLimit?: number, protected onVisibilityChange?: OnVisibilityChange) {\n    super(parallelLimit);\n\n    this.intersector = new VisibilityIntersector((item) => {\n      const {target, visible} = item;\n      const spliced = findAndSpliceAll(this.queue, (i) => i.div === target);\n      if(visible && spliced.length) {\n        spliced.forEach((item) => {\n          this.queue.unshift(item);\n        });\n      }\n\n      this.onVisibilityChange && this.onVisibilityChange(item);\n      this.setProcessQueueTimeout();\n    });\n  }\n\n  public observe(el: HTMLElement) {\n    this.intersector.observe(el);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\r\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\r\nimport Scrollable from './scrollable';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport calcImageInBox from '../helpers/calcImageInBox';\r\nimport {doubleRaf} from '../helpers/schedulers';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport rootScope from '../lib/rootScope';\r\nimport LazyLoadQueueRepeat2 from './lazyLoadQueueRepeat2';\r\nimport wrapVideo from './wrappers/video';\r\n\r\nconst width = 400;\r\nconst maxSingleWidth = width - 100;\r\nconst height = 100;\r\n\r\nexport default class GifsMasonry {\r\n  public lazyLoadQueue: LazyLoadQueueRepeat2;\r\n  private scrollPromise: CancellablePromise<void> = Promise.resolve();\r\n  private timeout: number = 0;\r\n  private managers: AppManagers;\r\n\r\n  constructor(\r\n    private element: HTMLElement,\r\n    private group: AnimationItemGroup,\r\n    private scrollable: Scrollable,\r\n    attach = true\r\n  ) {\r\n    this.managers = rootScope.managers;\r\n\r\n    this.lazyLoadQueue = new LazyLoadQueueRepeat2(undefined, ({target, visible}) => {\r\n      if(visible) {\r\n        this.processVisibleDiv(target);\r\n      } else {\r\n        this.processInvisibleDiv(target);\r\n      }\r\n    });\r\n\r\n    /* setInterval(() => {\r\n      // @ts-ignore\r\n      const players = animationIntersector.byGroups[group];\r\n\r\n      if(players) {\r\n        console.log(`GIFS RENDERED IN ${group}:`, players.length, players.filter((p) => !p.animation.paused).length, this.lazyLoadQueue.intersector.getVisible().length);\r\n      }\r\n    }, .25e3); */\r\n\r\n    if(attach) {\r\n      this.attach();\r\n    }\r\n  }\r\n\r\n  private onScroll = () => {\r\n    if(this.timeout) {\r\n      clearTimeout(this.timeout);\r\n    } else {\r\n      this.scrollPromise = deferredPromise<void>();\r\n      // animationIntersector.checkAnimations(true, group);\r\n    }\r\n\r\n    this.timeout = window.setTimeout(() => {\r\n      this.timeout = 0;\r\n      this.scrollPromise.resolve();\r\n      // animationIntersector.checkAnimations(false, group);\r\n    }, 150);\r\n  };\r\n\r\n  public attach() {\r\n    this.scrollable.container.addEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public detach() {\r\n    this.clear();\r\n    this.scrollable.container.removeEventListener('scroll', this.onScroll);\r\n  }\r\n\r\n  public clear() {\r\n    this.lazyLoadQueue.clear();\r\n  }\r\n\r\n  private processVisibleDiv(div: HTMLElement) {\r\n    const video = div.querySelector('video');\r\n    if(video) {\r\n      return;\r\n    }\r\n\r\n    const load = () => {\r\n      const docId = div.dataset.docId;\r\n      const promise = Promise.all([this.managers.appDocsManager.getDoc(docId), this.scrollPromise]).then(async([doc]) => {\r\n        const res = await wrapVideo({\r\n          doc,\r\n          container: div as HTMLDivElement,\r\n          lazyLoadQueue: null,\r\n          // lazyLoadQueue: EmoticonsDropdown.lazyLoadQueue,\r\n          group: this.group,\r\n          noInfo: true,\r\n          noPreview: true\r\n        });\r\n\r\n        const promise = res.loadPromise;\r\n        promise.finally(() => {\r\n          const video = div.querySelector('video');\r\n          const thumb = div.querySelector('img, canvas');\r\n\r\n          // div.style.opacity = '';\r\n          thumb && thumb.classList.add('hide');\r\n\r\n          if(video && !video.parentElement) {\r\n            setTimeout(() => {\r\n              video.src = '';\r\n              video.load();\r\n              const animations = animationIntersector.getAnimations(video);\r\n              animations.forEach((item) => {\r\n                animationIntersector.checkAnimation(item, true, true);\r\n              });\r\n            }, 0);\r\n          }\r\n\r\n          // clearTimeout(timeout);\r\n          if(!this.lazyLoadQueue.intersector.isVisible(div)) {\r\n            this.processInvisibleDiv(div);\r\n          }\r\n        });\r\n\r\n        return promise;\r\n      });\r\n\r\n      /* let timeout = window.setTimeout(() => {\r\n        console.error('processVisibleDiv timeout', div, doc);\r\n      }, 1e3); */\r\n\r\n      return promise;\r\n    };\r\n\r\n    // return load();\r\n\r\n    this.lazyLoadQueue.push({div, load});\r\n  }\r\n\r\n  public processInvisibleDiv = (div: HTMLElement) => {\r\n    return this.scrollPromise.then(async() => {\r\n      // return;\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      const video = div.querySelector('video');\r\n      const thumb = div.querySelector('img, canvas');\r\n\r\n      if(thumb) {\r\n        thumb.classList.remove('hide');\r\n\r\n        await doubleRaf();\r\n      }\r\n\r\n      if(this.lazyLoadQueue.intersector.isVisible(div)) {\r\n        return;\r\n      }\r\n\r\n      if(video) {\r\n        video.remove();\r\n        video.src = '';\r\n        video.load();\r\n        const animations = animationIntersector.getAnimations(video);\r\n        animations.forEach((item) => {\r\n          animationIntersector.checkAnimation(item, true, true);\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  public add(doc: MyDocument, appendTo = this.element) {\r\n    let gifWidth = doc.w;\r\n    let gifHeight = doc.h;\r\n    if(gifHeight < height) {\r\n      gifWidth = height / gifHeight * gifWidth;\r\n      gifHeight = height;\r\n    }\r\n\r\n    const willUseWidth = Math.min(maxSingleWidth, width, gifWidth);\r\n    const size = calcImageInBox(gifWidth, gifHeight, willUseWidth, height);\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add('gif'/* , 'fade-in-transition' */);\r\n    div.style.width = size.width + 'px';\r\n    // div.style.opacity = '0';\r\n    // div.style.height = h + 'px';\r\n    div.dataset.docId = '' + doc.id;\r\n\r\n    appendTo.append(div);\r\n\r\n    this.lazyLoadQueue.observe(div);\r\n\r\n    // let preloader = new ProgressivePreloader(div);\r\n\r\n    wrapVideo({\r\n      doc,\r\n      container: div as HTMLDivElement,\r\n      lazyLoadQueue: null,\r\n      noInfo: true,\r\n      onlyPreview: true\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {TransitionSlider} from './transition';\r\nimport {ScrollableX} from './scrollable';\r\nimport rootScope from '../lib/rootScope';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport {FocusDirection} from '../helpers/fastSmoothScroll';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\n\r\nexport function horizontalMenu(\r\n  tabs: HTMLElement,\r\n  content: HTMLElement,\r\n  onClick?: (id: number, tabContent: HTMLDivElement, animate: boolean) => void | boolean | Promise<void | boolean>,\r\n  onTransitionEnd?: () => void,\r\n  transitionTime = 250,\r\n  scrollableX?: ScrollableX,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  const selectTab = TransitionSlider(content, tabs || content.dataset.animation === 'tabs' ? 'tabs' : 'navigation', transitionTime, onTransitionEnd, undefined, listenerSetter);\r\n\r\n  if(!tabs) {\r\n    return selectTab;\r\n  }\r\n\r\n  const proxy = new Proxy(selectTab, {\r\n    apply: (target, that, args) => {\r\n      const id = +args[0];\r\n      const animate = args[1] !== undefined ? args[1] : true;\r\n\r\n      const el = (tabs.querySelector(`[data-tab=\"${id}\"]`) || tabs.children[id]) as HTMLElement;\r\n      selectTarget(el, id, animate);\r\n    }\r\n  });\r\n\r\n  const selectTarget = async(target: HTMLElement, id: number, animate = true) => {\r\n    const tabContent = content.children[id] as HTMLDivElement;\r\n\r\n    if(onClick) {\r\n      const result1 = onClick(id, tabContent, animate);\r\n      const canChange = result1 instanceof Promise ? await result1 : result1;\r\n      if(canChange !== undefined && !canChange) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(scrollableX) {\r\n      scrollableX.scrollIntoViewNew({\r\n        element: target.parentElement.children[id] as HTMLElement,\r\n        position: 'center',\r\n        forceDirection: animate ? undefined : FocusDirection.Static,\r\n        forceDuration: transitionTime,\r\n        axis: 'x'\r\n      });\r\n    }\r\n\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(target.classList.contains('active') || id === prevId) {\r\n      return false;\r\n    }\r\n\r\n    const mutateCallback = animate ? fastRaf : (cb: () => void) => cb();\r\n\r\n    const prev = tabs.querySelector(tagName.toLowerCase() + '.active') as HTMLElement;\r\n    if(prev) {\r\n      mutateCallback(() => {\r\n        prev.classList.remove('active');\r\n      });\r\n    }\r\n\r\n    // a great stripe from Jolly Cobra\r\n    if(useStripe && prevId !== -1 && animate) {\r\n      mutateCallback(() => {\r\n        const indicator = target.querySelector('i')!;\r\n        const currentIndicator = target.parentElement.children[prevId].querySelector('i')!;\r\n\r\n        currentIndicator.classList.remove('animate');\r\n        indicator.classList.remove('animate');\r\n\r\n        // We move and resize our indicator so it repeats the position and size of the previous one.\r\n        const shiftLeft = currentIndicator.parentElement.parentElement.offsetLeft - indicator.parentElement.parentElement.offsetLeft;\r\n        const scaleFactor = currentIndicator.clientWidth / indicator.clientWidth;\r\n        indicator.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\r\n\r\n        // console.log(`translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`);\r\n\r\n        fastRaf(() => {\r\n          // Now we remove the transform to let it animate to its own position and size.\r\n          indicator.classList.add('animate');\r\n          indicator.style.transform = 'none';\r\n        });\r\n      });\r\n    }\r\n\r\n    mutateCallback(() => {\r\n      target.classList.add('active');\r\n    });\r\n\r\n    selectTab(id, animate);\r\n  };\r\n\r\n  const useStripe = !tabs.classList.contains('no-stripe');\r\n\r\n  // const tagName = tabs.classList.contains('menu-horizontal-div') ? 'BUTTON' : 'LI';\r\n  const tagName = tabs.firstElementChild.tagName;\r\n  attachClickEvent(tabs, (e) => {\r\n    let target = e.target as HTMLElement;\r\n\r\n    target = findUpAsChild(target, tabs);\r\n\r\n    // console.log('tabs click:', target);\r\n\r\n    if(!target) return false;\r\n\r\n    let id: number;\r\n    if(target.dataset.tab) {\r\n      id = +target.dataset.tab;\r\n      if(id === -1) {\r\n        return false;\r\n      }\r\n    } else {\r\n      id = whichChild(target);\r\n    }\r\n\r\n    selectTarget(target, id);\r\n  }, {listenerSetter});\r\n\r\n  return proxy;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport simulateEvent from '../helpers/dom/dispatchEvent';\r\nimport documentFragmentToHTML from '../helpers/dom/documentFragmentToHTML';\r\nimport findUpAttribute from '../helpers/dom/findUpAttribute';\r\nimport getRichValue from '../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../helpers/dom/isInputEmpty';\r\nimport selectElementContents from '../helpers/dom/selectElementContents';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {MessageEntity} from '../layer';\r\nimport {i18n, LangPackKey, _i18n} from '../lib/langPack';\r\nimport mergeEntities from '../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../lib/richTextProcessor/parseEntities';\r\nimport wrapDraftText from '../lib/richTextProcessor/wrapDraftText';\r\n\r\nlet init = () => {\r\n  document.addEventListener('paste', (e) => {\r\n    const input = findUpAttribute(e.target, 'contenteditable=\"true\"');\r\n    if(!input) {\r\n      return;\r\n    }\r\n\r\n    const noLinebreaks = !!input.dataset.noLinebreaks;\r\n    e.preventDefault();\r\n    let text: string, entities: MessageEntity[];\r\n\r\n    // @ts-ignore\r\n    let plainText: string = (e.originalEvent || e).clipboardData.getData('text/plain');\r\n    let usePlainText = true;\r\n\r\n    // @ts-ignore\r\n    let html: string = (e.originalEvent || e).clipboardData.getData('text/html');\r\n\r\n    const filterEntity = (e: MessageEntity) => e._ === 'messageEntityEmoji' || (e._ === 'messageEntityLinebreak' && !noLinebreaks);\r\n    if(noLinebreaks) {\r\n      const regExp = /[\\r\\n]/g;\r\n      plainText = plainText.replace(regExp, '');\r\n      html = html.replace(regExp, '');\r\n    }\r\n\r\n    if(html.trim()) {\r\n      html = html.replace(/<style([\\s\\S]*)<\\/style>/, '');\r\n      html = html.replace(/<!--([\\s\\S]*)-->/, '');\r\n\r\n      const match = html.match(/<body>([\\s\\S]*)<\\/body>/);\r\n      if(match) {\r\n        html = match[1].trim();\r\n      }\r\n\r\n      const span: HTMLElement = document.createElement('span');\r\n      span.innerHTML = html;\r\n\r\n      let curChild = span.firstChild;\r\n      while(curChild) { // * fix whitespace between elements like <p>asd</p>\\n<p>zxc</p>\r\n        const nextSibling = curChild.nextSibling;\r\n        if(curChild.nodeType === 3) {\r\n          if(!curChild.nodeValue.trim()) {\r\n            curChild.remove();\r\n          }\r\n        }\r\n\r\n        curChild = nextSibling;\r\n      }\r\n\r\n      const richValue = getRichValue(span, true);\r\n      if(richValue.value.replace(/\\s/g, '').length === plainText.replace(/\\s/g, '').length) {\r\n        text = richValue.value;\r\n        entities = richValue.entities;\r\n        usePlainText = false;\r\n\r\n        let entities2 = parseEntities(text);\r\n        entities2 = entities2.filter(filterEntity);\r\n        mergeEntities(entities, entities2);\r\n      }\r\n    }\r\n\r\n    if(usePlainText) {\r\n      text = plainText;\r\n      entities = parseEntities(text);\r\n      entities = entities.filter(filterEntity);\r\n    }\r\n\r\n    const fragment = wrapDraftText(text, {entities});\r\n    text = documentFragmentToHTML(fragment);\r\n\r\n    window.document.execCommand('insertHTML', false, text);\r\n  });\r\n\r\n  init = null;\r\n};\r\n\r\n// ! it doesn't respect symbols other than strongs\r\n/* const checkAndSetRTL = (input: HTMLElement) => {\r\n  //const isEmpty = isInputEmpty(input);\r\n  //console.log('input', isEmpty);\r\n\r\n  //const char = [...getRichValue(input)][0];\r\n  const char = (input instanceof HTMLInputElement ? input.value : input.innerText)[0];\r\n  let direction = 'ltr';\r\n  if(char && checkRTL(char)) {\r\n    direction = 'rtl';\r\n  }\r\n\r\n  //console.log('RTL', direction, char);\r\n\r\n  input.style.direction = direction;\r\n}; */\r\n\r\nexport enum InputState {\r\n  Neutral = 0,\r\n  Valid = 1,\r\n  Error = 2\r\n};\r\n\r\nexport type InputFieldOptions = {\r\n  placeholder?: LangPackKey,\r\n  label?: LangPackKey,\r\n  labelOptions?: any[],\r\n  labelText?: string | DocumentFragment,\r\n  name?: string,\r\n  maxLength?: number,\r\n  showLengthOn?: number,\r\n  plainText?: true,\r\n  required?: boolean,\r\n  canBeEdited?: boolean,\r\n  validate?: () => boolean,\r\n  inputMode?: 'tel' | 'numeric',\r\n  withLinebreaks?: boolean,\r\n  autocomplete?: string\r\n};\r\n\r\nexport default class InputField {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public label: HTMLLabelElement;\r\n\r\n  public originalValue: string;\r\n\r\n  public required: boolean;\r\n  public validate: () => boolean;\r\n\r\n  constructor(public options: InputFieldOptions = {}) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('input-field');\r\n\r\n    this.required = options.required;\r\n    this.validate = options.validate;\r\n\r\n    if(options.maxLength !== undefined && options.showLengthOn === undefined) {\r\n      options.showLengthOn = Math.min(40, Math.round(options.maxLength / 3));\r\n    }\r\n\r\n    const {placeholder, maxLength, showLengthOn, name, plainText, canBeEdited = true, autocomplete} = options;\r\n    const label = options.label || options.labelText;\r\n\r\n    const onInputCallbacks: Array<() => void> = [];\r\n    let input: HTMLElement;\r\n    if(!plainText) {\r\n      if(init) {\r\n        init();\r\n      }\r\n\r\n      this.container.innerHTML = `\r\n      <div contenteditable=\"${String(!!canBeEdited)}\" class=\"input-field-input\"></div>\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // const observer = new MutationObserver(() => {\r\n      //   //checkAndSetRTL(input);\r\n\r\n      //   if(processInput) {\r\n      //     processInput();\r\n      //   }\r\n      // });\r\n\r\n      onInputCallbacks.push(() => {\r\n        // * because if delete all characters there will br left\r\n        if(isInputEmpty(input)) {\r\n          input.textContent = '';\r\n        }\r\n      });\r\n\r\n      // ! childList for paste first symbol\r\n      // observer.observe(input, {characterData: true, childList: true, subtree: true});\r\n    } else {\r\n      this.container.innerHTML = `\r\n      <input type=\"text\" ${name ? `name=\"${name}\"` : ''} autocomplete=\"${autocomplete ?? 'off'}\" ${label ? 'required=\"\"' : ''} class=\"input-field-input\">\r\n      `;\r\n\r\n      input = this.container.firstElementChild as HTMLElement;\r\n      // input.addEventListener('input', () => checkAndSetRTL(input));\r\n    }\r\n\r\n    input.setAttribute('dir', 'auto');\r\n\r\n    if(options.inputMode) {\r\n      input.inputMode = options.inputMode;\r\n    }\r\n\r\n    if(placeholder) {\r\n      _i18n(input, placeholder, undefined, 'placeholder');\r\n    }\r\n\r\n    if(label || placeholder) {\r\n      const border = document.createElement('div');\r\n      border.classList.add('input-field-border');\r\n      this.container.append(border);\r\n    }\r\n\r\n    if(label) {\r\n      this.label = document.createElement('label');\r\n      this.setLabel();\r\n      this.container.append(this.label);\r\n    }\r\n\r\n    if(maxLength) {\r\n      const labelEl = this.container.lastElementChild as HTMLLabelElement;\r\n      let showingLength = false;\r\n\r\n      const onInput = () => {\r\n        const wasError = input.classList.contains('error');\r\n        // * https://stackoverflow.com/a/54369605 #2 to count emoji as 1 symbol\r\n        const inputLength = plainText ? (input as HTMLInputElement).value.length : [...getRichValue(input, false).value].length;\r\n        const diff = maxLength - inputLength;\r\n        const isError = diff < 0;\r\n        input.classList.toggle('error', isError);\r\n\r\n        // this.onLengthChange && this.onLengthChange(inputLength, isError);\r\n\r\n        if(isError || diff <= showLengthOn) {\r\n          this.setLabel();\r\n          labelEl.append(` (${maxLength - inputLength})`);\r\n          if(!showingLength) showingLength = true;\r\n        } else if((wasError && !isError) || showingLength) {\r\n          this.setLabel();\r\n          showingLength = false;\r\n        }\r\n      };\r\n\r\n      onInputCallbacks.push(onInput);\r\n    }\r\n\r\n    const noLinebreaks = !options.withLinebreaks;\r\n    if(noLinebreaks && !plainText) {\r\n      input.dataset.noLinebreaks = '1';\r\n      input.addEventListener('keypress', (e) => {\r\n        if(e.key === 'Enter') {\r\n          e.preventDefault();\r\n          return false;\r\n        }\r\n      });\r\n    }\r\n\r\n    if(onInputCallbacks.length) {\r\n      input.addEventListener('input', () => {\r\n        onInputCallbacks.forEach((callback) => callback());\r\n      });\r\n    }\r\n\r\n    this.input = input;\r\n  }\r\n\r\n  public select() {\r\n    if(!this.value) { // * avoid selecting whole empty field on iOS devices\r\n      return;\r\n    }\r\n\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).select(); // * select text\r\n    } else {\r\n      selectElementContents(this.input);\r\n    }\r\n  }\r\n\r\n  public setLabel() {\r\n    this.label.textContent = '';\r\n    if(this.options.labelText) {\r\n      setInnerHTML(this.label, this.options.labelText);\r\n    } else {\r\n      this.label.append(i18n(this.options.label, this.options.labelOptions));\r\n    }\r\n  }\r\n\r\n  get value() {\r\n    return this.options.plainText ? (this.input as HTMLInputElement).value : getRichValue(this.input, false).value;\r\n    // return getRichValue(this.input);\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.setValueSilently(value, true);\r\n\r\n    simulateEvent(this.input, 'input');\r\n  }\r\n\r\n  public setValueSilently(value: string, fromSet?: boolean) {\r\n    if(this.options.plainText) {\r\n      (this.input as HTMLInputElement).value = value;\r\n    } else {\r\n      this.input.innerHTML = value;\r\n    }\r\n  }\r\n\r\n  public isChanged() {\r\n    return this.value !== this.originalValue;\r\n  }\r\n\r\n  public isValid() {\r\n    return !this.input.classList.contains('error') &&\r\n      (!this.validate || this.validate()) &&\r\n      (!this.required || !isInputEmpty(this.input));\r\n  }\r\n\r\n  public isValidToChange() {\r\n    return this.isValid() && this.isChanged();\r\n  }\r\n\r\n  public setDraftValue(value = '', silent?: boolean) {\r\n    if(!this.options.plainText) {\r\n      value = documentFragmentToHTML(wrapDraftText(value));\r\n    }\r\n\r\n    if(silent) {\r\n      this.setValueSilently(value, false);\r\n    } else {\r\n      this.value = value;\r\n    }\r\n  }\r\n\r\n  public setOriginalValue(value: InputField['originalValue'] = '', silent?: boolean) {\r\n    this.originalValue = value;\r\n    this.setDraftValue(value, silent);\r\n  }\r\n\r\n  public setState(state: InputState, label?: LangPackKey) {\r\n    if(label) {\r\n      this.label.textContent = '';\r\n      this.label.append(i18n(label, this.options.labelOptions));\r\n    } else {\r\n      this.setLabel();\r\n    }\r\n\r\n    this.input.classList.toggle('error', !!(state & InputState.Error));\r\n    this.input.classList.toggle('valid', !!(state & InputState.Valid));\r\n  }\r\n\r\n  public setError(label?: LangPackKey) {\r\n    this.setState(InputState.Error, label);\r\n  }\r\n}\r\n","// https://stackoverflow.com/a/6150060\nexport default function selectElementContents(el: HTMLElement) {\n  const range = document.createRange();\n  range.selectNodeContents(el);\n  const sel = window.getSelection();\n  sel.removeAllRanges();\n  sel.addRange(range);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { getRichValue } from \"../helpers/dom\";\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField from './inputField';\r\n\r\nexport default class InputSearch {\r\n  public container: HTMLElement;\r\n  public input: HTMLElement;\r\n  public inputField: InputField;\r\n  public clearBtn: HTMLElement;\r\n\r\n  public prevValue = '';\r\n  public timeout = 0;\r\n  public onChange: (value: string) => void;\r\n  public onClear: () => void;\r\n\r\n  constructor(placeholder: LangPackKey, onChange?: (value: string) => void) {\r\n    this.inputField = new InputField({\r\n      placeholder,\r\n      plainText: true\r\n    });\r\n\r\n    this.container = this.inputField.container;\r\n    this.container.classList.remove('input-field');\r\n    this.container.classList.add('input-search');\r\n\r\n    this.onChange = onChange;\r\n\r\n    this.input = this.inputField.input;\r\n    this.input.classList.add('input-search-input');\r\n\r\n    const searchIcon = document.createElement('i');\r\n    searchIcon.classList.add('tgico', 'tgico-search');\r\n\r\n    this.clearBtn = document.createElement('i');\r\n    this.clearBtn.classList.add('tgico', 'btn-icon', 'tgico-close');\r\n\r\n    this.input.addEventListener('input', this.onInput);\r\n    this.clearBtn.addEventListener('click', this.onClearClick);\r\n\r\n    this.container.append(searchIcon, this.clearBtn);\r\n  }\r\n\r\n  onInput = () => {\r\n    if(!this.onChange) return;\r\n\r\n    const value = this.value;\r\n\r\n    // this.input.classList.toggle('is-empty', !value.trim());\r\n\r\n    if(value !== this.prevValue) {\r\n      this.prevValue = value;\r\n      clearTimeout(this.timeout);\r\n      this.timeout = window.setTimeout(() => {\r\n        this.onChange(value);\r\n      }, 200);\r\n    }\r\n  };\r\n\r\n  onClearClick = () => {\r\n    this.value = '';\r\n    this.onChange && this.onChange('');\r\n    this.onClear && this.onClear();\r\n  };\r\n\r\n  get value() {\r\n    return this.inputField.value;\r\n  }\r\n\r\n  set value(value: string) {\r\n    this.prevValue = value;\r\n    clearTimeout(this.timeout);\r\n    this.inputField.value = value;\r\n  }\r\n\r\n  public remove() {\r\n    clearTimeout(this.timeout);\r\n    this.input.removeEventListener('input', this.onInput);\r\n    this.clearBtn.removeEventListener('click', this.onClearClick);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport VisibilityIntersector, {OnVisibilityChangeItem} from './visibilityIntersector';\r\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\r\nimport findAndSplice from '../helpers/array/findAndSplice';\r\nimport LazyLoadQueueIntersector, {LazyLoadElement} from './lazyLoadQueueIntersector';\r\n\r\nexport default class LazyLoadQueue extends LazyLoadQueueIntersector {\r\n  constructor(parallelLimit?: number) {\r\n    super(parallelLimit);\r\n\r\n    this.intersector = new VisibilityIntersector(this.onVisibilityChange);\r\n  }\r\n\r\n  private onVisibilityChange = ({target, visible}: OnVisibilityChangeItem) => {\r\n    if(visible) {\r\n      /* if(DEBUG) {\r\n        this.log('isIntersecting', target);\r\n      } */\r\n\r\n      // need for set element first if scrolled\r\n      findAndSpliceAll(this.queue, (i) => i.div === target).forEach((item) => {\r\n        item.wasSeen = true;\r\n        this.queue.unshift(item);\r\n        // this.processQueue(item);\r\n      });\r\n\r\n      this.setProcessQueueTimeout();\r\n    }\r\n  };\r\n\r\n  protected getItem() {\r\n    return findAndSplice(this.queue, item => item.wasSeen);\r\n  }\r\n\r\n  public async processItem(item: LazyLoadElement) {\r\n    await super.processItem(item);\r\n    this.intersector.unobserve(item.div);\r\n  }\r\n\r\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\r\n    const inserted = super.addElement(method, el);\r\n\r\n    if(!inserted) return false;\r\n\r\n    this.intersector.observe(el.div);\r\n    /* if(el.wasSeen) {\r\n      this.processQueue(el);\r\n    } else  */if(!el.hasOwnProperty('wasSeen')) {\r\n      el.wasSeen = false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findAndSpliceAll from '../helpers/array/findAndSpliceAll';\nimport LazyLoadQueueBase, {LazyLoadElementBase} from './lazyLoadQueueBase';\nimport VisibilityIntersector from './visibilityIntersector';\n\nexport type LazyLoadElement = Omit<LazyLoadElementBase, 'load'> & {\n  load: (target?: HTMLElement) => Promise<any>,\n  div: HTMLElement\n  wasSeen?: boolean,\n};\n\nexport default class LazyLoadQueueIntersector extends LazyLoadQueueBase {\n  protected queue: Array<LazyLoadElement> = [];\n  protected inProcess: Set<LazyLoadElement> = new Set();\n\n  public intersector: VisibilityIntersector;\n  protected intersectorTimeout: number;\n\n  constructor(parallelLimit?: number) {\n    super(parallelLimit);\n  }\n\n  public lock() {\n    super.lock();\n    this.intersector.lock();\n  }\n\n  public unlock() {\n    super.unlock();\n    this.intersector.unlock();\n  }\n\n  public unlockAndRefresh() {\n    super.unlock();\n    this.intersector.unlockAndRefresh();\n  }\n\n  public clear() {\n    super.clear();\n    this.intersector.disconnect();\n  }\n\n  public refresh() {\n    this.intersector.refresh();\n  }\n\n  protected loadItem(item: LazyLoadElement) {\n    return item.load(item.div);\n  }\n\n  protected addElement(method: 'push' | 'unshift', el: LazyLoadElement) {\n    const item = this.queue.find((i) => i.div === el.div && i.load === el.load);\n    if(item) {\n      return false;\n    } else {\n      for(const item of this.inProcess) {\n        if(item.div === el.div && item.load === el.load) {\n          return false;\n        }\n      }\n    }\n\n    this.queue[method](el);\n    return true;\n  }\n\n  protected setProcessQueueTimeout() {\n    if(!this.intersectorTimeout) {\n      this.intersectorTimeout = window.setTimeout(() => {\n        this.intersectorTimeout = 0;\n        this.processQueue();\n      }, 0);\n    }\n  }\n\n  public push(el: LazyLoadElement) {\n    super.push(el);\n  }\n\n  public unshift(el: LazyLoadElement) {\n    super.unshift(el);\n  }\n\n  public unobserve(el: HTMLElement) {\n    findAndSpliceAll(this.queue, (i) => i.div === el);\n\n    this.intersector.unobserve(el);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GrabEvent} from '../helpers/dom/attachGrabListeners';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class MediaProgressLine extends RangeSelector {\n  protected filledLoad: HTMLDivElement;\n\n  protected progressRAF = 0;\n\n  protected media: HTMLMediaElement;\n  protected streamable: boolean;\n\n  constructor(media?: HTMLAudioElement | HTMLVideoElement, streamable?: boolean, withTransition?: boolean, useTransform?: boolean) {\n    super({\n      step: 1000 / 60 / 1000,\n      min: 0,\n      max: 1,\n      withTransition,\n      useTransform\n    }, 0);\n\n    if(media) {\n      this.setMedia(media, streamable);\n    }\n  }\n\n  public setMedia(media: HTMLMediaElement, streamable = false) {\n    if(this.media) {\n      this.removeListeners();\n    }\n\n    if(streamable && !this.filledLoad) {\n      this.filledLoad = document.createElement('div');\n      this.filledLoad.classList.add('progress-line__filled', 'progress-line__loaded');\n      this.container.prepend(this.filledLoad);\n      // this.setLoadProgress();\n    } else if(this.filledLoad) {\n      this.filledLoad.classList.toggle('hide', !streamable);\n    }\n\n    this.media = media;\n    this.streamable = streamable;\n    if(!media.paused || media.currentTime > 0) {\n      this.onPlay();\n    }\n\n    let wasPlaying = false;\n    this.setSeekMax();\n    this.setListeners();\n    this.setHandlers({\n      onMouseDown: () => {\n        wasPlaying = !this.media.paused;\n        wasPlaying && this.media.pause();\n      },\n\n      onMouseUp: (e) => {\n        // cancelEvent(e.event);\n        wasPlaying && this.media.play();\n      }\n    });\n  }\n\n  protected onLoadedData = () => {\n    this.max = this.media.duration;\n    this.seek.setAttribute('max', '' + this.max);\n  };\n\n  protected onEnded = () => {\n    this.setProgress();\n  };\n\n  protected onPlay = () => {\n    const r = () => {\n      this.setProgress();\n\n      this.progressRAF = this.media.paused ? 0 : window.requestAnimationFrame(r);\n    };\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n    }\n\n    if(this.streamable) {\n      this.setLoadProgress();\n    }\n\n    this.progressRAF = window.requestAnimationFrame(r);\n  };\n\n  protected onTimeUpdate = () => {\n    if(this.media.paused) {\n      this.setProgress();\n\n      if(this.streamable) {\n        this.setLoadProgress();\n      }\n    }\n  };\n\n  protected onProgress = (e: Event) => {\n    this.setLoadProgress();\n  };\n\n  protected scrub(e: GrabEvent) {\n    const scrubTime = super.scrub(e);\n    this.media.currentTime = scrubTime;\n    return scrubTime;\n  }\n\n  protected setLoadProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const buf = this.media.buffered;\n    const numRanges = buf.length;\n\n    const currentTime = this.media.currentTime;\n    let nearestStart = 0, end = 0;\n    for(let i = 0; i < numRanges; ++i) {\n      const start = buf.start(i);\n      if(currentTime >= start && start >= nearestStart) {\n        nearestStart = start;\n        end = buf.end(i);\n      }\n\n      // console.log('onProgress range:', i, buf.start(i), buf.end(i), this.media);\n    }\n\n    // console.log('onProgress correct range:', nearestStart, end, this.media);\n\n    const percents = this.media.duration ? end / this.media.duration : 0;\n    this.filledLoad.style.width = (percents * 100) + '%';\n    // this.filledLoad.style.transform = 'scaleX(' + percents + ')';\n  }\n\n  protected setSeekMax() {\n    this.max = this.media.duration || 0;\n    if(this.max > 0) {\n      this.onLoadedData();\n    } else {\n      this.media.addEventListener('loadeddata', this.onLoadedData);\n    }\n  }\n\n  public setProgress() {\n    if(appMediaPlaybackController.isSafariBuffering(this.media)) return;\n    const currentTime = this.media.currentTime;\n\n    super.setProgress(currentTime);\n  }\n\n  public setListeners() {\n    super.setListeners();\n    this.media.addEventListener('ended', this.onEnded);\n    this.media.addEventListener('play', this.onPlay);\n    this.media.addEventListener('timeupdate', this.onTimeUpdate);\n    this.streamable && this.media.addEventListener('progress', this.onProgress);\n  }\n\n  public removeListeners() {\n    super.removeListeners();\n\n    if(this.media) {\n      this.media.removeEventListener('loadeddata', this.onLoadedData);\n      this.media.removeEventListener('ended', this.onEnded);\n      this.media.removeEventListener('play', this.onPlay);\n      this.media.removeEventListener('timeupdate', this.onTimeUpdate);\n      this.streamable && this.media.removeEventListener('progress', this.onProgress);\n    }\n\n    if(this.progressRAF) {\n      window.cancelAnimationFrame(this.progressRAF);\n      this.progressRAF = 0;\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {FontFamily, FontSize, FontWeight} from '../config/font';\r\nimport getTextWidth from '../helpers/canvas/getTextWidth';\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport clamp from '../helpers/number/clamp';\r\nimport {fastRaf} from '../helpers/schedulers';\r\n\r\n// Thanks to https://stackoverflow.com/a/49349813\r\n\r\n/**\r\n * Attibute modifier to create middle ellipsis\r\n * When the attribute value is left blank the ellipsis will be in the middle\r\n * When positive the attribute value will be used as a percentage\r\n * When negative the attribute value will be used as character index counted from the end\r\n * @example\r\n *   <div data-middle-ellipsis>A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"20\">A Javascript solution to middle ellipsis</div>\r\n *   <div data-middle-ellipsis=\"-3\">A Javascript solution to middle ellipsis</div>\r\n */\r\nconst ellipsis = '';\r\nconst map: Map<HTMLElement, {\r\n  text: string,\r\n  textLength: number,\r\n  from: number,\r\n  multiplier: number,\r\n  font: string,\r\n  textWidth: number,\r\n  elementWidth: number\r\n}> = new Map();\r\n\r\nconst testQueue: Set<HTMLElement> = new Set();\r\nconst fontSize = '16px';\r\nlet pendingTest = false;\r\n\r\nfunction setTestQueue() {\r\n  if(pendingTest) {\r\n    return;\r\n  }\r\n\r\n  pendingTest = true;\r\n  fastRaf(() => {\r\n    pendingTest = false;\r\n    testQueueElements();\r\n  });\r\n}\r\n\r\nfunction testQueueElements() {\r\n  testQueue.forEach(testElement);\r\n  testQueue.clear();\r\n}\r\n\r\nwindow.addEventListener('resize', () => {\r\n  for(const [key] of map) {\r\n    testQueue.add(key);\r\n  }\r\n\r\n  setTestQueue();\r\n}, {capture: true, passive: true});\r\n\r\nfunction getElementWidth(element: HTMLElement) {\r\n  const type = element.dataset.sizeType;\r\n  if(type) {\r\n    const mediaSize = mediaSizes.active;\r\n    // @ts-ignore\r\n    const size: MediaSize = mediaSize[type];\r\n    return size.width;\r\n  }\r\n\r\n  return element.getBoundingClientRect().width;\r\n}\r\n\r\nfunction testElement(element: HTMLElement) {\r\n  // const perf = performance.now();\r\n  // do not recalculate variables a second time\r\n  let mapped = map.get(element);\r\n  const firstTime = !mapped;\r\n\r\n  let {text, textLength, from, multiplier, font, textWidth, elementWidth} = mapped || {};\r\n  // console.log('[MEE] testElement got mapped', mapped);\r\n\r\n  if(firstTime) {\r\n    text = element.textContent;\r\n    textLength = text.length;\r\n    from = /* parseFloat(element.getAttribute(attributeName)) ||  */50;\r\n    multiplier = from > 0 && from / 100;\r\n\r\n    // const perf = performance.now();\r\n    font = `${element.dataset.fontWeight || FontWeight} ${FontSize} ${FontFamily}`;\r\n    /* const computedStyle = window.getComputedStyle(elm, null);\r\n    font = `${computedStyle.getPropertyValue('font-weight')} ${computedStyle.getPropertyValue('font-size')} ${computedStyle.getPropertyValue('font-family')}`; */\r\n    // console.log('testMiddleEllipsis get computed style:', performance.now() - perf, font);\r\n\r\n    textWidth = getTextWidth(text, font);\r\n    // const perf = performance.now();\r\n    elementWidth = getElementWidth(element);\r\n    // console.log('testMiddleEllipsis get offsetWidth:', performance.now() - perf, font);\r\n    mapped = {text, textLength, from, multiplier, font, textWidth, elementWidth};\r\n    map.set(element, mapped);\r\n\r\n    // console.log('[MEE] testElement map set', element);\r\n  }\r\n\r\n  const newElementWidth = getElementWidth(element);\r\n  const widthChanged = firstTime || elementWidth !== newElementWidth;\r\n  !firstTime && widthChanged && (mapped.elementWidth = elementWidth = newElementWidth);\r\n\r\n  if(widthChanged) {\r\n    if(textWidth > elementWidth) {\r\n      element.setAttribute('title', text);\r\n      let smallerText = text;\r\n      let smallerWidth = elementWidth;\r\n      while(smallerText.length > 3) {\r\n        const smallerTextLength = smallerText.length;\r\n        const half = multiplier &&\r\n          clamp(multiplier * smallerTextLength << 0, 1, smallerTextLength - 2) ||\r\n          Math.max(smallerTextLength + from - 1, 1);\r\n        const half1 = smallerText.substr(0, half).replace(/\\s*$/, '');\r\n        const half2 = smallerText.substr(half + 1).replace(/^\\s*/, '');\r\n        smallerText = half1 + half2;\r\n        smallerWidth = getTextWidth(smallerText + ellipsis, font);\r\n        if(smallerWidth < elementWidth) {\r\n          element.textContent = half1 + ellipsis + half2;\r\n          break;\r\n        }\r\n      }\r\n\r\n      // * set new width after cutting text\r\n      mapped.elementWidth = getElementWidth(element);\r\n      // mapped.textWidth = smallerWidth;\r\n    } else {\r\n      element.removeAttribute('title');\r\n    }\r\n  }\r\n\r\n  // console.log('testMiddleEllipsis for element:', elm, performance.now() - perf);\r\n}\r\n\r\nexport class MiddleEllipsisElement extends HTMLElement {\r\n  connectedCallback() {\r\n    // console.log('[MEE]: connectedCallback before', map.has(this), testQueue.has(this), map.size, this.textContent, map);\r\n\r\n    map.set(this, null);\r\n    if(this.dataset.sizeType) {\r\n      testElement(this);\r\n    } else {\r\n      testQueue.add(this);\r\n      setTestQueue();\r\n    }\r\n    // testElement(this);\r\n\r\n    // console.log('[MEE]: connectedCallback after', map.has(this), map.size, testQueue.has(this), testQueue.size);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    const deleted = map.delete(this);\r\n    testQueue.delete(this);\r\n    // console.log('[MEE]: disconnectedCallback', deleted, map.has(this), map.size, this.textContent, map);\r\n  }\r\n}\r\n\r\ncustomElements.define('middle-ellipsis-element', MiddleEllipsisElement);\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport lottieLoader, {LottieLoader} from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\nimport PasswordInputField from '../passwordInputField';\r\n\r\nexport default class PasswordMonkey {\r\n  public container: HTMLElement;\r\n  public animation: RLottiePlayer;\r\n  public needFrame = 0;\r\n  protected loadPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  constructor(protected passwordInputField: PasswordInputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.container,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: this.size,\r\n      height: this.size,\r\n      noCache: true\r\n    // }, 'assets/img/TwoFactorSetupMonkeyClose.tgs').then((_animation) => {\r\n    }, 'TwoFactorSetupMonkeyPeek').then((_animation) => {\r\n      // return;\r\n      this.animation = _animation;\r\n      this.animation.addEventListener('enterFrame', currentFrame => {\r\n        // console.log('enterFrame', currentFrame, this.needFrame);\r\n\r\n        if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n          (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n          this.animation.setSpeed(1);\r\n          this.animation.pause();\r\n        }\r\n      });\r\n\r\n      this.passwordInputField.onVisibilityClickAdditional = () => {\r\n        if(this.passwordInputField.passwordVisible) {\r\n          this.animation.setDirection(1);\r\n          this.animation.curFrame = 0;\r\n          this.needFrame = 16;\r\n          this.animation.play();\r\n        } else {\r\n          this.animation.setDirection(-1);\r\n          this.animation.curFrame = 16;\r\n          this.needFrame = 0;\r\n          this.animation.play();\r\n        }\r\n      };\r\n\r\n      return lottieLoader.waitForFirstFrame(_animation);\r\n    });\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) {\r\n      this.animation.remove();\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../inputField';\r\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\r\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\r\n\r\nexport default class TrackingMonkey {\r\n  public container: HTMLElement;\r\n\r\n  protected max = 45;\r\n  protected needFrame = 0;\r\n\r\n  protected animation: RLottiePlayer;\r\n  protected idleAnimation: RLottiePlayer;\r\n\r\n  protected loadPromise: Promise<any>;\r\n\r\n  constructor(protected inputField: InputField, protected size: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('media-sticker-wrapper');\r\n\r\n    const input = inputField.input;\r\n\r\n    input.addEventListener('blur', () => {\r\n      this.playAnimation(0);\r\n    });\r\n\r\n    input.addEventListener('input', (e) => {\r\n      this.playAnimation(inputField.value.length);\r\n    });\r\n\r\n    /* codeInput.addEventListener('focus', () => {\r\n      playAnimation(Math.max(codeInput.value.length, 1));\r\n    }); */\r\n  }\r\n\r\n  // 1st symbol = frame 15\r\n  // end symbol = frame 165\r\n  public playAnimation(length: number) {\r\n    if(!this.animation) return;\r\n\r\n    length = Math.min(length, 30);\r\n    let frame: number;\r\n    if(length) {\r\n      frame = Math.round(Math.min(this.max, length) * (165 / this.max) + 11.33);\r\n\r\n      if(this.idleAnimation) {\r\n        this.idleAnimation.stop(true);\r\n        this.idleAnimation.canvas[0].style.display = 'none';\r\n      }\r\n\r\n      this.animation.canvas[0].style.display = '';\r\n    } else {\r\n      /* const cb = (frameNo: number) => {\r\n        if(frameNo <= 1) { */\r\n      /* idleAnimation.play();\r\n          idleAnimation.canvas.style.display = '';\r\n          animation.canvas.style.display = 'none'; */\r\n      /*     animation.removeListener('enterFrame', cb);\r\n        }\r\n      };\r\n      animation.addListener('enterFrame', cb); */\r\n\r\n      frame = 0;\r\n    }\r\n    // animation.playSegments([1, 2]);\r\n\r\n    const direction = this.needFrame > frame ? -1 : 1;\r\n    // console.log('keydown', length, frame, direction);\r\n\r\n    this.animation.setDirection(direction);\r\n    if(this.needFrame !== 0 && frame === 0) {\r\n      this.animation.setSpeed(7);\r\n    }\r\n    /* let diff = Math.abs(needFrame - frame * direction);\r\n    if((diff / 20) > 1) animation.setSpeed(diff / 20 | 0); */\r\n    this.needFrame = frame;\r\n\r\n    this.animation.play();\r\n\r\n    /* animation.goToAndStop(15, true); */\r\n    // animation.goToAndStop(length / max * );\r\n  }\r\n\r\n  public load() {\r\n    if(this.loadPromise) return this.loadPromise;\r\n    return this.loadPromise = Promise.all([\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: true,\r\n        autoplay: true,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyIdle').then((animation) => {\r\n        this.idleAnimation = animation;\r\n\r\n        // ! animationIntersector will stop animation instantly\r\n        if(!this.inputField.value.length) {\r\n          animation.play();\r\n        }\r\n\r\n        return lottieLoader.waitForFirstFrame(animation);\r\n      }),\r\n\r\n      lottieLoader.loadAnimationAsAsset({\r\n        container: this.container,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: this.size,\r\n        height: this.size\r\n      }, 'TwoFactorSetupMonkeyTracking').then((_animation) => {\r\n        this.animation = _animation;\r\n\r\n        if(!this.inputField.value.length) {\r\n          this.animation.canvas[0].style.display = 'none';\r\n        }\r\n\r\n        this.animation.addEventListener('enterFrame', currentFrame => {\r\n          // console.log('enterFrame', currentFrame, needFrame);\r\n          // let currentFrame = Math.round(e.currentTime);\r\n\r\n          if((this.animation.direction === 1 && currentFrame >= this.needFrame) ||\r\n            (this.animation.direction === -1 && currentFrame <= this.needFrame)) {\r\n            this.animation.setSpeed(1);\r\n            this.animation.pause();\r\n          }\r\n\r\n          if(currentFrame === 0 && this.needFrame === 0) {\r\n            // animation.curFrame = 0;\r\n\r\n            if(this.idleAnimation) {\r\n              this.idleAnimation.canvas[0].style.display = '';\r\n              this.idleAnimation.play();\r\n              this.animation.canvas[0].style.display = 'none';\r\n            }\r\n          }\r\n        });\r\n        // console.log(animation.getDuration(), animation.getDuration(true));\r\n\r\n        return lottieLoader.waitForFirstFrame(_animation);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  public remove() {\r\n    if(this.animation) this.animation.remove();\r\n    if(this.idleAnimation) this.idleAnimation.remove();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// import { IS_MOBILE_SAFARI, IS_SAFARI } from \"../environment/userAgent\";\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport InputField, {InputFieldOptions} from './inputField';\r\n\r\nexport default class PasswordInputField extends InputField {\r\n  public passwordVisible = false;\r\n  public toggleVisible: HTMLElement;\r\n  public onVisibilityClickAdditional: () => void;\r\n\r\n  constructor(options: InputFieldOptions = {}) {\r\n    super({\r\n      plainText: true,\r\n      ...options\r\n    });\r\n\r\n    const input = this.input as HTMLInputElement;\r\n    input.type = 'password';\r\n    input.setAttribute('required', '');\r\n    input.name = 'notsearch_password';\r\n    input.autocomplete = 'off';\r\n\r\n    /* if(IS_SAFARI && !IS_MOBILE_SAFARI) {\r\n      input.setAttribute('readonly', '');\r\n      input.addEventListener('focus', () => {\r\n        input.removeAttribute('readonly');\r\n      }, {once: true});\r\n    } */\r\n\r\n    // * https://stackoverflow.com/a/35949954/6758968\r\n    const stealthy = document.createElement('input');\r\n    stealthy.classList.add('stealthy');\r\n    stealthy.tabIndex = -1;\r\n    stealthy.type = 'password';\r\n    input.parentElement.prepend(stealthy);\r\n    input.parentElement.insertBefore(stealthy.cloneNode(), input.nextSibling);\r\n\r\n    const toggleVisible = this.toggleVisible = document.createElement('span');\r\n    toggleVisible.classList.add('toggle-visible', 'tgico');\r\n\r\n    this.container.classList.add('input-field-password');\r\n    this.container.append(toggleVisible);\r\n\r\n    toggleVisible.addEventListener('click', this.onVisibilityClick);\r\n    toggleVisible.addEventListener('touchend', this.onVisibilityClick);\r\n  }\r\n\r\n  public onVisibilityClick = (e: Event) => {\r\n    cancelEvent(e);\r\n    this.passwordVisible = !this.passwordVisible;\r\n\r\n    this.toggleVisible.classList.toggle('eye-hidden', this.passwordVisible);\r\n    (this.input as HTMLInputElement).type = this.passwordVisible ? 'text' : 'password';\r\n    this.onVisibilityClickAdditional && this.onVisibilityClickAdditional();\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport findAndSplice from '../helpers/array/findAndSplice';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport filterChatPhotosMessages from '../helpers/filterChatPhotosMessages';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport ListLoader from '../helpers/listLoader';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Message, ChatFull, MessageAction, Photo} from '../layer';\nimport type {AppMessagesManager} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {openAvatarViewer} from './avatar';\nimport {putAvatar} from './putPhoto';\nimport Scrollable from './scrollable';\nimport SwipeHandler from './swipeHandler';\nimport wrapPhoto from './wrappers/photo';\n\nconst LOAD_NEAREST = 3;\n\nexport default class PeerProfileAvatars {\n  private static BASE_CLASS = 'profile-avatars';\n  private static SCALE = IS_PARALLAX_SUPPORTED ? 2 : 1;\n  private static TRANSLATE_TEMPLATE = IS_PARALLAX_SUPPORTED ? `translate3d({x}, 0, -1px) scale(${PeerProfileAvatars.SCALE})` : 'translate({x}, 0)';\n  public container: HTMLElement;\n  public avatars: HTMLElement;\n  public gradient: HTMLElement;\n  public info: HTMLElement;\n  public arrowPrevious: HTMLElement;\n  public arrowNext: HTMLElement;\n  private tabs: HTMLDivElement;\n  private listLoader: ListLoader<Photo.photo['id'] | Message.messageService, Photo.photo['id'] | Message.messageService>;\n  private peerId: PeerId;\n  private intersectionObserver: IntersectionObserver;\n  private loadCallbacks: Map<Element, () => void>;\n  private listenerSetter: ListenerSetter;\n  private swipeHandler: SwipeHandler;\n\n  constructor(\n    public scrollable: Scrollable,\n    private managers: AppManagers\n  ) {\n    this.container = document.createElement('div');\n    this.container.classList.add(PeerProfileAvatars.BASE_CLASS + '-container');\n\n    this.avatars = document.createElement('div');\n    this.avatars.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatars');\n\n    this.gradient = document.createElement('div');\n    this.gradient.classList.add(PeerProfileAvatars.BASE_CLASS + '-gradient');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(PeerProfileAvatars.BASE_CLASS + '-info');\n\n    this.tabs = document.createElement('div');\n    this.tabs.classList.add(PeerProfileAvatars.BASE_CLASS + '-tabs');\n\n    this.arrowPrevious = document.createElement('div');\n    this.arrowPrevious.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', 'tgico-avatarprevious');\n\n    /* const previousIcon = document.createElement('i');\n    previousIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-previous');\n    this.arrowBack.append(previousIcon); */\n\n    this.arrowNext = document.createElement('div');\n    this.arrowNext.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow', PeerProfileAvatars.BASE_CLASS + '-arrow-next', 'tgico-avatarnext');\n\n    /* const nextIcon = document.createElement('i');\n    nextIcon.classList.add(PeerProfileAvatars.BASE_CLASS + '-arrow-icon', 'tgico-next');\n    this.arrowNext.append(nextIcon); */\n\n    this.container.append(this.avatars, this.gradient, this.info, this.tabs, this.arrowPrevious, this.arrowNext);\n\n    this.loadCallbacks = new Map();\n    this.listenerSetter = new ListenerSetter();\n\n    const checkScrollTop = () => {\n      if(this.scrollable.scrollTop !== 0) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        return false;\n      }\n\n      return true;\n    };\n\n    const SWITCH_ZONE = 1 / 3;\n    let cancel = false;\n    let freeze = false;\n    attachClickEvent(this.container, async(_e) => {\n      if(freeze) {\n        cancelEvent(_e);\n        return;\n      }\n\n      if(cancel) {\n        cancel = false;\n        return;\n      }\n\n      if(!checkScrollTop()) {\n        return;\n      }\n\n      const rect = this.container.getBoundingClientRect();\n\n      // const e = (_e as TouchEvent).touches ? (_e as TouchEvent).touches[0] : _e as MouseEvent;\n      const e = _e;\n      const x = e.pageX;\n\n      const clickX = x - rect.left;\n      if((!this.listLoader.previous.length && !this.listLoader.next.length) ||\n        (clickX > (rect.width * SWITCH_ZONE) && clickX < (rect.width - rect.width * SWITCH_ZONE))) {\n        const peerId = this.peerId;\n\n        const targets: {element: HTMLElement, item: Photo.photo['id'] | Message.messageService}[] = [];\n        this.listLoader.previous.concat(this.listLoader.current, this.listLoader.next).forEach((item, idx) => {\n          targets.push({\n            element: /* null */this.avatars.children[idx] as HTMLElement,\n            item\n          });\n        });\n\n        const prevTargets = targets.slice(0, this.listLoader.previous.length);\n        const nextTargets = targets.slice(this.listLoader.previous.length + 1);\n\n        const target = this.avatars.children[this.listLoader.previous.length] as HTMLElement;\n        freeze = true;\n        openAvatarViewer(target, peerId, () => peerId === this.peerId, this.listLoader.current, prevTargets, nextTargets);\n        freeze = false;\n      } else {\n        const centerX = rect.right - (rect.width / 2);\n        const toRight = x > centerX;\n\n        // this.avatars.classList.remove('no-transition');\n        // fastRaf(() => {\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n\n        let distance: number;\n        if(this.listLoader.index === 0 && !toRight) distance = this.listLoader.count - 1;\n        else if(this.listLoader.index === (this.listLoader.count - 1) && toRight) distance = -(this.listLoader.count - 1);\n        else distance = toRight ? 1 : -1;\n        this.listLoader.go(distance);\n\n        fastRaf(() => {\n          this.avatars.classList.remove('no-transition');\n        });\n        // });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const cancelNextClick = () => {\n      cancel = true;\n      document.body.addEventListener(IS_TOUCH_SUPPORTED ? 'touchend' : 'click', (e) => {\n        cancel = false;\n      }, {once: true});\n    };\n\n    let width = 0, x = 0, lastDiffX = 0, /* lastIndex = 0, */ minX = 0;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.avatars,\n      onSwipe: (xDiff, yDiff) => {\n        lastDiffX = xDiff;\n        let lastX = x + xDiff * -PeerProfileAvatars.SCALE;\n        if(lastX > 0) lastX = 0;\n        else if(lastX < minX) lastX = minX;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', lastX + 'px');\n        // console.log(xDiff, yDiff);\n        return false;\n      },\n      verifyTouchTarget: (e) => {\n        if(!checkScrollTop()) {\n          cancelNextClick();\n          cancelEvent(e);\n          return false;\n        } else if(this.container.classList.contains('is-single') || freeze) {\n          return false;\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        const rect = this.avatars.getBoundingClientRect();\n        width = rect.width;\n        minX = -width * (this.tabs.childElementCount - 1);\n\n        /* lastIndex = whichChild(this.tabs.querySelector('.active'));\n        x = -width * lastIndex; */\n        x = rect.left - this.container.getBoundingClientRect().left;\n\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', x + 'px');\n\n        this.container.classList.add('is-swiping');\n        this.avatars.classList.add('no-transition');\n        void this.avatars.offsetLeft; // reflow\n      },\n      onReset: () => {\n        const addIndex = Math.ceil(Math.abs(lastDiffX) / (width / PeerProfileAvatars.SCALE)) * (lastDiffX >= 0 ? 1 : -1);\n        cancelNextClick();\n\n        // console.log(addIndex);\n\n        this.avatars.classList.remove('no-transition');\n        fastRaf(() => {\n          this.listLoader.go(addIndex);\n          this.container.classList.remove('is-swiping');\n        });\n      }\n    });\n\n    this.intersectionObserver = new IntersectionObserver((entries) => {\n      entries.forEach((entry) => {\n        if(!entry.isIntersecting) {\n          return;\n        }\n\n        this.loadNearestToTarget(entry.target);\n      });\n    });\n\n    /* this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        const photo = appPeersManager.getPeerPhoto(peerId);\n        if(photo) {\n          const id = photo.photo_id;\n          const previous = this.listLoader.previous;\n          for(let i = 0; i < previous.length; ++i) {\n            if(previous[i] === id)\n          }\n          this.listLoader.previous.forEach((_id, idx, arr) => {});\n        }\n      }\n    }); */\n  }\n\n  public async setPeer(peerId: PeerId) {\n    this.peerId = peerId;\n\n    const photo = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(!photo) {\n      return;\n    }\n\n    const listLoader: PeerProfileAvatars['listLoader'] = this.listLoader = new ListLoader({\n      loadCount: 50,\n      loadMore: (anchor, older, loadCount) => {\n        if(!older) return Promise.resolve({count: undefined, items: []});\n\n        if(peerId.isUser()) {\n          const maxId: Photo.photo['id'] = anchor as any;\n          return this.managers.appPhotosManager.getUserPhotos(peerId, maxId, loadCount).then((value) => {\n            return {\n              count: value.count,\n              items: value.photos\n            };\n          });\n        } else {\n          const promises: [Promise<ChatFull> | ChatFull, ReturnType<AppMessagesManager['getSearch']>] = [] as any;\n          if(!listLoader.current) {\n            promises.push(this.managers.appProfileManager.getChatFull(peerId.toChatId()));\n          }\n\n          promises.push(this.managers.appMessagesManager.getSearch({\n            peerId,\n            maxId: Number.MAX_SAFE_INTEGER,\n            inputFilter: {\n              _: 'inputMessagesFilterChatPhotos'\n            },\n            limit: loadCount,\n            backLimit: 0\n          }));\n\n          return Promise.all(promises).then(async(result) => {\n            const value = result.pop() as typeof result[1];\n\n            filterChatPhotosMessages(value);\n\n            if(!listLoader.current) {\n              const chatFull = result[0];\n              const message = findAndSplice(value.history, (message) => {\n                return ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo.id === chatFull.chat_photo.id;\n              }) as Message.messageService;\n\n              listLoader.current = message || await this.managers.appMessagesManager.generateFakeAvatarMessage(this.peerId, chatFull.chat_photo);\n            }\n\n            // console.log('avatars loaded:', value);\n            return {\n              count: value.count,\n              items: value.history\n            };\n          });\n        }\n      },\n      processItem: this.processItem,\n      onJump: (item, older) => {\n        const id = this.listLoader.index;\n        // const nextId = Math.max(0, id);\n        const x = 100 * PeerProfileAvatars.SCALE * id;\n        this.avatars.style.transform = PeerProfileAvatars.TRANSLATE_TEMPLATE.replace('{x}', `-${x}%`);\n\n        const activeTab = this.tabs.querySelector('.active');\n        if(activeTab) activeTab.classList.remove('active');\n\n        const tab = this.tabs.children[id] as HTMLElement;\n        tab.classList.add('active');\n\n        this.loadNearestToTarget(this.avatars.children[id]);\n      }\n    });\n\n    if(photo._ === 'userProfilePhoto') {\n      listLoader.current = photo.photo_id;\n    }\n\n    await this.processItem(listLoader.current);\n\n    // listLoader.loaded\n    listLoader.load(true);\n  }\n\n  public addTab() {\n    const tab = document.createElement('div');\n    tab.classList.add(PeerProfileAvatars.BASE_CLASS + '-tab');\n    this.tabs.append(tab);\n\n    if(this.tabs.childElementCount === 1) {\n      tab.classList.add('active');\n    }\n\n    this.container.classList.toggle('is-single', this.tabs.childElementCount <= 1);\n  }\n\n  public processItem = async(photoId: Photo.photo['id'] | Message.messageService) => {\n    const avatar = document.createElement('div');\n    avatar.classList.add(PeerProfileAvatars.BASE_CLASS + '-avatar', 'media-container', 'hide');\n\n    this.avatars.append(avatar);\n\n    let photo: Photo.photo;\n    if(photoId) {\n      photo = typeof(photoId) !== 'object' ?\n        await this.managers.appPhotosManager.getPhoto(photoId) :\n        (photoId.action as MessageAction.messageActionChannelEditPhoto).photo as Photo.photo;\n    }\n\n    const img = new Image();\n    img.classList.add('avatar-photo');\n    img.draggable = false;\n\n    const loadCallback = async() => {\n      if(photo) {\n        const res = await wrapPhoto({\n          container: avatar,\n          photo,\n          size: choosePhotoSize(photo, 420, 420, false),\n          withoutPreloader: true\n        });\n\n        [res.images.thumb, res.images.full].filter(Boolean).forEach((img) => {\n          img.classList.add('avatar-photo');\n        });\n      } else {\n        const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n        await putAvatar(avatar, this.peerId, photo, 'photo_big', img);\n      }\n\n      avatar.classList.remove('hide');\n    };\n\n    if(this.avatars.childElementCount <= LOAD_NEAREST) {\n      await loadCallback();\n    } else {\n      this.intersectionObserver.observe(avatar);\n      this.loadCallbacks.set(avatar, loadCallback);\n    }\n\n    this.addTab();\n\n    return photoId;\n  };\n\n  private loadNearestToTarget(target: Element) {\n    const children = Array.from(target.parentElement.children);\n    const idx = children.indexOf(target);\n    const slice = children.slice(Math.max(0, idx - LOAD_NEAREST), Math.min(children.length, idx + LOAD_NEAREST));\n\n    slice.forEach((target) => {\n      const callback = this.loadCallbacks.get(target);\n      if(callback) {\n        callback();\n        this.loadCallbacks.delete(target);\n        this.intersectionObserver.unobserve(target);\n      }\n    });\n  }\n\n  public cleanup() {\n    this.listenerSetter.removeAll();\n    this.swipeHandler.removeListeners();\n    this.intersectionObserver?.disconnect();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_PARALLAX_SUPPORTED from '../environment/parallaxSupport';\nimport {copyTextToClipboard} from '../helpers/clipboard';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {fastRaf} from '../helpers/schedulers';\nimport {Chat, ChatFull, User, UserFull} from '../layer';\nimport type {Channel} from '../lib/appManagers/appChatsManager';\nimport appImManager from '../lib/appManagers/appImManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport I18n from '../lib/langPack';\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../lib/rootScope';\nimport AvatarElement from './avatar';\nimport CheckboxField from './checkboxField';\nimport PeerProfileAvatars from './peerProfileAvatars';\nimport Row from './row';\nimport Scrollable from './scrollable';\nimport {SettingSection, generateDelimiter} from './sidebarLeft';\nimport {toast} from './toast';\nimport formatUserPhone from './wrappers/formatUserPhone';\nimport wrapPeerTitle from './wrappers/peerTitle';\n\nconst setText = (text: Parameters<typeof setInnerHTML>[1], row: Row) => {\n  // fastRaf(() => {\n  setInnerHTML(row.title, text || '');\n  row.container.style.display = text ? '' : 'none';\n  // });\n};\n\nexport default class PeerProfile {\n  public element: HTMLElement;\n  private avatars: PeerProfileAvatars;\n  private avatar: AvatarElement;\n  private section: SettingSection;\n  private name: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private bio: Row;\n  private username: Row;\n  private phone: Row;\n  private notifications: Row;\n  private location: Row;\n  private link: Row;\n\n  private cleaned: boolean;\n  private setMoreDetailsTimeout: number;\n  private setPeerStatusInterval: number;\n\n  private peerId: PeerId;\n  private threadId: number;\n\n  constructor(\n    private managers: AppManagers,\n    public scrollable: Scrollable,\n    private listenerSetter?: ListenerSetter,\n    private isDialog = true\n  ) {\n    if(!IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.add('no-parallax');\n    }\n\n    if(!listenerSetter) {\n      this.listenerSetter = new ListenerSetter();\n    }\n  }\n\n  public init() {\n    this.init = null;\n\n\n    this.element = document.createElement('div');\n    this.element.classList.add('profile-content');\n\n    this.section = new SettingSection({\n      noDelimiter: true\n    });\n\n    this.avatar = new AvatarElement();\n    this.avatar.classList.add('profile-avatar', 'avatar-120');\n    this.avatar.isDialog = this.isDialog;\n    this.avatar.attachClickEvent();\n\n    this.name = document.createElement('div');\n    this.name.classList.add('profile-name');\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('profile-subtitle');\n\n    this.bio = new Row({\n      title: ' ',\n      subtitleLangKey: 'UserBio',\n      icon: 'info',\n      clickable: async(e) => {\n        if((e.target as HTMLElement).tagName === 'A') {\n          return;\n        }\n\n        const full = await this.managers.appProfileManager.getProfileByPeerId(this.peerId);\n        copyTextToClipboard(full.about);\n        toast(I18n.format('BioCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.bio.title.classList.add('pre-wrap');\n\n    this.username = new Row({\n      title: ' ',\n      subtitleLangKey: 'Username',\n      icon: 'username',\n      clickable: async() => {\n        const peer: Channel | User.user = await this.managers.appPeersManager.getPeer(this.peerId);\n        copyTextToClipboard('@' + peer.username);\n        toast(I18n.format('UsernameCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.phone = new Row({\n      title: ' ',\n      subtitleLangKey: 'Phone',\n      icon: 'phone',\n      clickable: async() => {\n        const peer: User = await this.managers.appUsersManager.getUser(this.peerId);\n        copyTextToClipboard('+' + peer.phone);\n        toast(I18n.format('PhoneCopied', true));\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.link = new Row({\n      title: ' ',\n      subtitleLangKey: 'SetUrlPlaceholder',\n      icon: 'link',\n      clickable: () => {\n        copyTextToClipboard(this.link.title.textContent);\n        // Promise.resolve(appProfileManager.getChatFull(this.peerId.toChatId())).then((chatFull) => {\n        // copyTextToClipboard(chatFull.exported_invite.link);\n        toast(I18n.format('LinkCopied', true));\n        // });\n      },\n      listenerSetter: this.listenerSetter\n    });\n\n    this.location = new Row({\n      title: ' ',\n      subtitleLangKey: 'ChatLocation',\n      icon: 'location'\n    });\n\n    this.section.content.append(\n      this.phone.container,\n      this.username.container,\n      this.location.container,\n      this.bio.container,\n      this.link.container\n    );\n\n    const {listenerSetter} = this;\n    if(this.isDialog) {\n      this.notifications = new Row({\n        checkboxField: new CheckboxField({toggle: true}),\n        titleLangKey: 'Notifications',\n        icon: 'unmute',\n        listenerSetter: this.listenerSetter\n      });\n\n      listenerSetter.add(this.notifications.checkboxField.input)('change', (e) => {\n        if(!e.isTrusted) {\n          return;\n        }\n\n        // let checked = this.notificationsCheckbox.checked;\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      });\n\n      listenerSetter.add(rootScope)('dialog_notify_settings', async(dialog) => {\n        if(this.peerId === dialog.peerId) {\n          const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n          this.notifications.checkboxField.checked = !muted;\n        }\n      });\n\n      this.section.content.append(this.notifications.container);\n    }\n\n    this.element.append(this.section.container);\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.element.append(generateDelimiter());\n    }\n\n    listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_bio_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.setMoreDetails(true);\n      }\n    });\n\n    listenerSetter.add(rootScope)('peer_title_edit', (peerId) => {\n      if(peerId === this.peerId) {\n        this.fillUsername();\n      }\n    });\n\n    listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        if(!user.pFlags.self || !this.isDialog) {\n          this.fillUserPhone();\n        }\n      }\n    });\n\n    listenerSetter.add(rootScope)('avatar_update', (peerId) => {\n      if(this.peerId === peerId) {\n        // const photo = appPeersManager.getPeerPhoto(peerId);\n        // if(!photo && this.avatars) {\n        this.setAvatar();\n        // }\n      }\n    });\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n  }\n\n  private setPeerStatus = (needClear = false) => {\n    const peerId = this.peerId;\n    this.element.classList.toggle('is-me', peerId === rootScope.myId);\n    if(!peerId || (rootScope.myId === peerId && this.isDialog)) return;\n\n    return appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      true,\n      () => peerId === this.peerId,\n      !this.isDialog\n    ).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n\n  public cleanupHTML() {\n    [\n      this.bio,\n      this.phone,\n      this.username,\n      this.location,\n      this.link\n    ].forEach((row) => {\n      row.container.style.display = 'none';\n    });\n\n    if(this.notifications) {\n      this.notifications.container.style.display = '';\n      this.notifications.checkboxField.checked = true;\n    }\n\n    this.clearSetMoreDetailsTimeout();\n  }\n\n  private canBeDetailed() {\n    return this.peerId !== rootScope.myId || !this.isDialog;\n  }\n\n  private async setAvatar() {\n    if(this.canBeDetailed()) {\n      const photo = await this.managers.appPeersManager.getPeerPhoto(this.peerId);\n\n      if(photo) {\n        const oldAvatars = this.avatars;\n        this.avatars = new PeerProfileAvatars(this.scrollable, this.managers);\n        await this.avatars.setPeer(this.peerId);\n        this.avatars.info.append(this.name, this.subtitle);\n\n        this.avatar.remove();\n\n        if(oldAvatars) oldAvatars.container.replaceWith(this.avatars.container);\n        else this.element.prepend(this.avatars.container);\n\n        if(IS_PARALLAX_SUPPORTED) {\n          this.scrollable.container.classList.add('parallax');\n        }\n\n        return;\n      }\n    }\n\n    if(IS_PARALLAX_SUPPORTED) {\n      this.scrollable.container.classList.remove('parallax');\n    }\n\n    if(this.avatars) {\n      this.avatars.container.remove();\n      this.avatars.cleanup();\n      this.avatars = undefined;\n    }\n\n    await this.avatar.updateWithOptions({peerId: this.peerId});\n\n    this.section.content.prepend(this.avatar, this.name, this.subtitle);\n  }\n\n  private async fillUsername() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      return setText(username, this.username);\n    }\n  }\n\n  private async fillUserPhone() {\n    const {peerId} = this;\n    if(peerId.isUser() && this.canBeDetailed()) {\n      const user = await this.managers.appUsersManager.getUser(peerId);\n      return setText(user.phone ? formatUserPhone(user.phone) : undefined, this.phone);\n    }\n  }\n\n  private async fillNotifications() {\n    const notificationsRow = this.notifications;\n    if(!notificationsRow) {\n      return;\n    }\n\n    if(this.canBeDetailed()) {\n      const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false);\n      notificationsRow.checkboxField.checked = !muted;\n    } else {\n      fastRaf(() => {\n        notificationsRow.container.style.display = 'none';\n      });\n    }\n  }\n\n  private async fillRows() {\n    const peerId = this.peerId;\n\n    await Promise.all([\n      this.fillUsername(),\n      this.fillUserPhone(),\n      this.fillNotifications(),\n      this.setMoreDetails(),\n      (async() => {\n        const [element/* , icons */] = await Promise.all([\n          wrapPeerTitle({\n            peerId,\n            dialog: this.isDialog,\n            withIcons: true\n          })\n\n          // generateTitleIcons(peerId)\n        ]);\n        replaceContent(this.name, element);\n        // this.name.append(...icons);\n      })(),\n      this.setPeerStatus(true)\n    ]);\n  }\n\n  public async fillProfileElements() {\n    if(!this.cleaned) return;\n    this.cleaned = false;\n\n    this.cleanupHTML();\n    await Promise.all([\n      this.setAvatar(),\n      this.fillRows()\n    ]);\n  }\n\n  private async _setMoreDetails(peerId: PeerId, peerFull: ChatFull | UserFull) {\n    // if(peerFull.about) {\n    setText(peerFull.about ? wrapRichText(peerFull.about) : undefined, this.bio);\n    // }\n\n    if(!peerId.isUser()) {\n      const chat: Chat.channel = await this.managers.appChatsManager.getChat(peerId.toChatId());\n      if(chat.username) {\n        setText('https://t.me/' + chat.username, this.link);\n      } else {\n        const exportedInvite = (peerFull as ChatFull.channelFull).exported_invite;\n        if(exportedInvite?._ === 'chatInviteExported') {\n          setText(exportedInvite.link, this.link);\n        }\n      }\n    }\n\n    const location = (peerFull as ChatFull.channelFull).location;\n    if(location?._ == 'channelLocation') {\n      setText(location.address, this.location);\n    }\n\n    this.setMoreDetailsTimeout = window.setTimeout(() => this.setMoreDetails(true), 60e3);\n  }\n\n  private async setMoreDetails(override?: true) {\n    this.clearSetMoreDetailsTimeout();\n\n    const peerId = this.peerId;\n    const threadId = this.threadId;\n\n    if(!peerId || await this.managers.appPeersManager.isRestricted(peerId) || !this.canBeDetailed()) {\n      return;\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId, override);\n    const setPromise = result.result.then(async(peerFull) => {\n      if(this.peerId !== peerId || this.threadId !== threadId || await this.managers.appPeersManager.isRestricted(peerId)) {\n        // this.log.warn('peer changed');\n        return;\n      }\n\n      await this._setMoreDetails(peerId, peerFull);\n    });\n\n    if(result.cached) {\n      await setPromise;\n    }\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return;\n\n    if(this.init) {\n      this.init();\n    }\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n\n    this.cleaned = true;\n  }\n\n  public clearSetMoreDetailsTimeout() {\n    if(this.setMoreDetailsTimeout !== undefined) {\n      clearTimeout(this.setMoreDetailsTimeout);\n      this.setMoreDetailsTimeout = undefined;\n    }\n  }\n\n  public destroy() {\n    this.clearSetMoreDetailsTimeout();\n    clearInterval(this.setPeerStatusInterval);\n    this.avatars?.cleanup();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../layer';\nimport rootScope from '../lib/rootScope';\nimport generateFakeIcon from './generateFakeIcon';\nimport generatePremiumIcon from './generatePremiumIcon';\nimport generateVerifiedIcon from './generateVerifiedIcon';\n\nexport default async function generateTitleIcons(peerId: PeerId, noVerifiedIcon?: boolean, noFakeIcon?: boolean, noPremiumIcon?: boolean) {\n  const elements: Element[] = [];\n  const peer: Chat | User = await rootScope.managers.appPeersManager.getPeer(peerId);\n  if((peer as Chat.channel).pFlags.verified && !noVerifiedIcon) {\n    elements.push(generateVerifiedIcon());\n  }\n\n  if(((peer as Chat.channel).pFlags.fake || (peer as User.user).pFlags.scam) && !noFakeIcon) {\n    elements.push(generateFakeIcon((peer as User.user).pFlags.scam));\n  }\n\n  if((peer as User.user).pFlags.premium && !noPremiumIcon) {\n    elements.push(generatePremiumIcon());\n  }\n\n  return elements;\n}\n","export default function generateVerifiedIcon() {\n  const span = document.createElement('span');\n  span.classList.add('verified-icon', 'tgico');\n\n  const size = 26; // 24\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.setAttributeNS(null, 'viewBox', `0 0 ${size} ${size}`);\n  svg.setAttributeNS(null, 'width', `${size}`);\n  svg.setAttributeNS(null, 'height', `${size}`);\n  svg.classList.add('verified-icon-svg');\n\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use.setAttributeNS(null, 'href', '#verified-icon-background');\n  use.classList.add('verified-icon-background');\n\n  const use2 = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use2.setAttributeNS(null, 'href', '#verified-icon-check');\n  use2.classList.add('verified-icon-check');\n\n  // svg.append(use, use2);\n  svg.append(use2, use);\n\n  span.append(svg);\n\n  return span;\n  // const span = document.createElement('span');\n  // span.classList.add('verified-icon', 'tgico-verified_filled');\n  // return span;\n}\n","export default function generatePremiumIcon() {\n  const span = document.createElement('span');\n  span.classList.add('premium-icon', 'tgico-star');\n  return span;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport {i18n} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {NULL_PEER_ID} from '../lib/mtproto/mtproto_config';\r\nimport limitSymbols from '../helpers/string/limitSymbols';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport getPeerTitle from './wrappers/getPeerTitle';\r\nimport generateTitleIcons from './generateTitleIcons';\r\n\r\nexport type PeerTitleOptions = {\r\n  peerId?: PeerId,\r\n  fromName?: string,\r\n  plainText?: boolean,\r\n  onlyFirstName?: boolean,\r\n  dialog?: boolean,\r\n  limitSymbols?: number,\r\n  managers?: AppManagers,\r\n  withIcons?: boolean,\r\n  withPremiumIcon?: boolean\r\n};\r\n\r\nconst weakMap: WeakMap<HTMLElement, PeerTitle> = new WeakMap();\r\n\r\nrootScope.addEventListener('peer_title_edit', (peerId) => {\r\n  const elements = Array.from(document.querySelectorAll(`.peer-title[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\r\n  elements.forEach((element) => {\r\n    const peerTitle = weakMap.get(element);\r\n    peerTitle?.update();\r\n  });\r\n});\r\n\r\nexport default class PeerTitle {\r\n  public element: HTMLElement;\r\n  public peerId: PeerId;\r\n  private fromName: string;\r\n  private plainText = false;\r\n  private onlyFirstName = false;\r\n  private dialog = false;\r\n  private limitSymbols: number;\r\n  private managers: AppManagers;\r\n  private hasInner: boolean;\r\n  private withIcons: boolean;\r\n  private withPremiumIcon: boolean;\r\n\r\n  constructor(options?: PeerTitleOptions) {\r\n    this.element = document.createElement('span');\r\n    this.element.classList.add('peer-title');\r\n    this.element.setAttribute('dir', 'auto');\r\n\r\n    if(options) {\r\n      this.update(options);\r\n    }\r\n\r\n    weakMap.set(this.element, this);\r\n  }\r\n\r\n  public setOptions(options?: PeerTitleOptions) {\r\n    if(!options) {\r\n      return;\r\n    }\r\n\r\n    for(const i in options) {\r\n      // @ts-ignore\r\n      const value = options[i];\r\n\r\n      if(typeof(value) !== 'object') {\r\n        // @ts-ignore\r\n        this.element.dataset[i] = value ? '' + (typeof(value) === 'boolean' ? +value : value) : '0';\r\n      }\r\n\r\n      // @ts-ignore\r\n      this[i] = value;\r\n    }\r\n  }\r\n\r\n  public async update(options?: PeerTitleOptions) {\r\n    this.setOptions(options);\r\n\r\n    let fromName = this.fromName;\r\n    if(fromName !== undefined) {\r\n      if(this.limitSymbols !== undefined) {\r\n        fromName = limitSymbols(fromName, this.limitSymbols, this.limitSymbols);\r\n      }\r\n\r\n      setInnerHTML(this.element, wrapEmojiText(fromName));\r\n      return;\r\n    }\r\n\r\n    this.peerId ??= NULL_PEER_ID;\r\n\r\n    let hasInner: boolean;\r\n    if(this.peerId !== rootScope.myId || !this.dialog) {\r\n      const managers = this.managers ?? rootScope.managers;\r\n      const [title, icons] = await Promise.all([\r\n        getPeerTitle(this.peerId, this.plainText, this.onlyFirstName, this.limitSymbols, managers),\r\n        (this.withIcons && generateTitleIcons(this.peerId)) || (this.withPremiumIcon && generateTitleIcons(this.peerId, true, true))\r\n      ]);\r\n\r\n      if(icons?.length) {\r\n        const inner = document.createElement('span');\r\n        inner.classList.add('peer-title-inner');\r\n        hasInner = true;\r\n        setInnerHTML(inner, title);\r\n\r\n        const fragment = document.createDocumentFragment();\r\n        fragment.append(inner, ...icons);\r\n        setInnerHTML(this.element, fragment);\r\n      } else {\r\n        setInnerHTML(this.element, title);\r\n      }\r\n    } else {\r\n      replaceContent(this.element, i18n(this.onlyFirstName ? 'Saved' : 'SavedMessages'));\r\n    }\r\n\r\n    if(this.hasInner !== hasInner) {\r\n      this.hasInner = hasInner;\r\n      this.element.classList.toggle('with-icons', hasInner);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppDownloadManager} from '../../lib/appManagers/appDownloadManager';\r\nimport resizeableImage from '../../lib/cropper';\r\nimport PopupElement from '.';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\n\r\nexport default class PopupAvatar extends PopupElement {\r\n  private cropContainer: HTMLElement;\r\n  private input: HTMLInputElement;\r\n  private h6: HTMLElement;\r\n\r\n  private image = new Image();\r\n\r\n  private canvas: HTMLCanvasElement;\r\n  private blob: Blob;\r\n  private cropper = {\r\n    crop: () => {},\r\n    removeHandlers: () => {}\r\n  };\r\n\r\n  private onCrop: (upload: () => ReturnType<AppDownloadManager['upload']>) => void;\r\n\r\n  constructor() {\r\n    super('popup-avatar', {closable: true, withConfirm: true});\r\n\r\n    this.h6 = document.createElement('h6');\r\n    _i18n(this.h6, 'Popup.Avatar.Title');\r\n\r\n    this.btnClose.classList.remove('btn-icon');\r\n\r\n    this.header.append(this.h6);\r\n\r\n    this.cropContainer = document.createElement('div');\r\n    this.cropContainer.classList.add('crop');\r\n    this.cropContainer.append(this.image);\r\n\r\n    this.input = document.createElement('input');\r\n    this.input.type = 'file';\r\n    this.input.style.display = 'none';\r\n    this.listenerSetter.add(this.input)('change', (e: any) => {\r\n      const file = e.target.files[0];\r\n      if(!file) {\r\n        return;\r\n      }\r\n\r\n      readBlobAsDataURL(file).then((contents) => {\r\n        this.image = new Image();\r\n        this.cropContainer.append(this.image);\r\n        this.image.src = contents;\r\n\r\n        this.image.onload = () => {\r\n          /* let {w, h} = calcImageInBox(this.image.naturalWidth, this.image.naturalHeight, 460, 554);\r\n          cropContainer.style.width = w + 'px';\r\n          cropContainer.style.height = h + 'px'; */\r\n          this.show();\r\n\r\n          this.cropper = resizeableImage(this.image, this.canvas);\r\n          this.input.value = '';\r\n        };\r\n      });\r\n    }, false);\r\n\r\n    this.btnConfirm.className = 'btn-primary btn-color-primary btn-circle btn-crop btn-icon tgico-check z-depth-1';\r\n    attachClickEvent(this.btnConfirm, () => {\r\n      this.cropper.crop();\r\n      this.hide();\r\n\r\n      this.canvas.toBlob((blob) => {\r\n        this.blob = blob; // save blob to send after reg\r\n        this.darkenCanvas();\r\n        this.resolve();\r\n      }, 'image/jpeg', 1);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.container.append(this.cropContainer, this.btnConfirm, this.input);\r\n\r\n    this.addEventListener('closeAfterTimeout', () => {\r\n      this.cropper.removeHandlers();\r\n      if(this.image) {\r\n        this.image.remove();\r\n      }\r\n    });\r\n  }\r\n\r\n  private resolve() {\r\n    this.onCrop(() => {\r\n      return appDownloadManager.upload(this.blob);\r\n    });\r\n  }\r\n\r\n  public open(postCanvas: HTMLCanvasElement, onCrop: PopupAvatar['onCrop']) {\r\n    this.canvas = postCanvas;\r\n    this.onCrop = onCrop;\r\n\r\n    this.input.click();\r\n  }\r\n\r\n  public darkenCanvas() {\r\n    const ctx = this.canvas.getContext('2d');\r\n    ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';\r\n    ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nfunction resizeableImage(originalImage: HTMLImageElement, canvas?: HTMLCanvasElement) {\r\n  let cropComponent: HTMLDivElement,\r\n    container: HTMLDivElement,\r\n    cropImage: HTMLImageElement,\r\n    event_state: Partial<{\r\n      mouse_x: number,\r\n      mouse_y: number,\r\n      container_width: number,\r\n      container_height: number,\r\n      container_left: number,\r\n      container_top: number\r\n    }> = {},\r\n    keyZoomValue = 4.0,\r\n    MINWIDTH = 50,\r\n    MINHEIGHT = 50,\r\n    CROPWIDTH = 200,\r\n    CROPHEIGHT = 200,\r\n    cropLeft = 0,\r\n    cropTop = 0,\r\n    cropWidth = 0,\r\n    cropHeight = 0,\r\n    scaledRatio = 0;\r\n\r\n  if(originalImage.complete) init();\r\n  else originalImage.onload = init;\r\n\r\n  function removeHandlers() {\r\n    container.removeEventListener('mousedown', startMoving);\r\n    container.removeEventListener('touchstart', startMoving);\r\n    container.removeEventListener('wheel', resizing);\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n    document.removeEventListener('keypress', keyHandler);\r\n\r\n    cropComponent.remove();\r\n    container.remove();\r\n    cropImage.remove();\r\n  }\r\n\r\n  function addHandlers() {\r\n    container.addEventListener('mousedown', startMoving, false);\r\n    container.addEventListener('touchstart', startMoving, false);\r\n    container.addEventListener('wheel', resizing, false);\r\n\r\n    document.addEventListener('keypress', keyHandler, false);\r\n    // document.querySelector('.btn-crop').addEventListener('click', openCropCanvasImg);\r\n  }\r\n\r\n  function init() {\r\n    originalImage.classList.add('crop-blur');\r\n    originalImage.draggable = false;\r\n\r\n    cropImage = new Image();\r\n    cropImage.src = originalImage.src;\r\n    cropImage.draggable = false;\r\n    cropImage.classList.add('crop-overlay-image');\r\n\r\n    if(!canvas) {\r\n      canvas = document.createElement('canvas');\r\n    }\r\n\r\n    cropComponent = document.createElement('div');\r\n    cropComponent.classList.add('crop-component');\r\n\r\n    container = document.createElement('div');\r\n    container.classList.add('crop-overlay');\r\n\r\n    const overlayColor = document.createElement('div');\r\n    overlayColor.classList.add('crop-overlay-color');\r\n\r\n    cropComponent.appendChild(container);\r\n    const wrapper = originalImage.parentNode as HTMLElement;\r\n    wrapper.appendChild(cropComponent);\r\n    cropComponent.appendChild(cropImage);\r\n    cropComponent.appendChild(originalImage);\r\n    cropComponent.appendChild(overlayColor);\r\n    container.appendChild(cropImage);\r\n\r\n    cropImage.style.maxWidth = originalImage.width + 'px';\r\n\r\n    scaledRatio = originalImage.naturalWidth / originalImage.offsetWidth;\r\n\r\n    const left = originalImage.offsetWidth / 2 - CROPWIDTH / 2;\r\n    const top = originalImage.offsetHeight / 2 - CROPHEIGHT / 2;\r\n\r\n    updateCropSize(CROPWIDTH, CROPHEIGHT);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    addHandlers();\r\n    // crop();\r\n  }\r\n\r\n  function updateCropSize(width: number, height: number) {\r\n    cropWidth = width * scaledRatio;\r\n    cropHeight = height * scaledRatio;\r\n\r\n    container.style.width = width + 'px';\r\n    container.style.height = height + 'px';\r\n  }\r\n\r\n  function updateCropImage(left: number, top: number) {\r\n    cropTop = top * scaledRatio;\r\n    cropLeft = left * scaledRatio;\r\n\r\n    cropImage.style.top = -top + 'px';\r\n    cropImage.style.left = -left + 'px';\r\n  }\r\n\r\n  function updateContainer(left: number, top: number) {\r\n    container.style.top = top + 'px';\r\n    container.style.left = left + 'px';\r\n  }\r\n\r\n  // Save the initial event details and container state\r\n  function saveEventState(e: any) {\r\n    event_state.container_width = container.offsetWidth;\r\n    event_state.container_height = container.offsetHeight;\r\n\r\n    event_state.container_left = container.offsetLeft;\r\n    event_state.container_top = container.offsetTop;\r\n\r\n    event_state.mouse_x = (e.clientX || e.pageX || e.touches && e.touches[0].clientX) + window.scrollX;\r\n    event_state.mouse_y = (e.clientY || e.pageY || e.touches && e.touches[0].clientY) + window.scrollY;\r\n  }\r\n\r\n  function imgZoom(zoom: number) {\r\n    zoom = zoom * Math.PI * 2\r\n    let newWidth = Math.floor(container.clientWidth + zoom),\r\n      newHeight = Math.floor(container.clientHeight + zoom),\r\n      w = cropImage.clientWidth,\r\n      h = cropImage.clientHeight,\r\n      left: number,\r\n      top: number,\r\n      right: number,\r\n      bottom: number;\r\n\r\n    if(newWidth < MINWIDTH) {\r\n      return;\r\n    } else if(newWidth > w) {\r\n      return;\r\n    }\r\n\r\n    left = container.offsetLeft - (zoom / 2);\r\n    top = container.offsetTop - (zoom / 2);\r\n    right = left + newWidth;\r\n    bottom = top + newHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    if(top < 0) top = 0;\r\n\r\n    if(right > w) return;\r\n    if(bottom > h) return;\r\n\r\n    updateCropSize(newWidth, newWidth);\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function keyHandler(e: KeyboardEvent) {\r\n    e.preventDefault();\r\n\r\n    switch(String.fromCharCode(e.charCode)) {\r\n      case '+':\r\n        imgZoom(keyZoomValue);\r\n        break;\r\n      case '-':\r\n        imgZoom(-keyZoomValue);\r\n        break;\r\n    }\r\n  }\r\n\r\n  function resizing(e: any) {\r\n    e.preventDefault();\r\n    imgZoom(e.deltaY > 0 ? 1 : -1);\r\n  }\r\n\r\n  function startMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    saveEventState(e);\r\n\r\n    document.addEventListener('mousemove', moving);\r\n    document.addEventListener('touchmove', moving);\r\n    document.addEventListener('mouseup', endMoving);\r\n    document.addEventListener('touchend', endMoving);\r\n  }\r\n\r\n  function endMoving(e: MouseEvent | TouchEvent) {\r\n    e.preventDefault();\r\n\r\n    document.removeEventListener('mouseup', endMoving);\r\n    document.removeEventListener('touchend', endMoving);\r\n    document.removeEventListener('mousemove', moving);\r\n    document.removeEventListener('touchmove', moving);\r\n  }\r\n\r\n  function moving(e: any) {\r\n    let currentTouch = {x: 0, y: 0},\r\n      left: number,\r\n      top: number,\r\n      w: number,\r\n      h: number;\r\n\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    currentTouch.x = e.pageX || e.touches && e.touches[0].pageX;\r\n    currentTouch.y = e.pageY || e.touches && e.touches[0].pageY;\r\n\r\n    left = currentTouch.x - (event_state.mouse_x - event_state.container_left);\r\n    top = currentTouch.y - (event_state.mouse_y - event_state.container_top);\r\n    w = container.offsetWidth;\r\n    h = container.offsetHeight;\r\n\r\n    if(left < 0) left = 0;\r\n    else if(left > cropImage.offsetWidth - w) left = cropImage.offsetWidth - w;\r\n\r\n    if(top < 0) top = 0;\r\n    else if(top > cropImage.offsetHeight - h) top = cropImage.offsetHeight - h;\r\n\r\n    updateCropImage(left, top);\r\n    updateContainer(left, top);\r\n    // crop();\r\n  }\r\n\r\n  function crop() {\r\n    canvas.width = cropWidth;\r\n    canvas.height = cropHeight;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.drawImage(originalImage,\r\n      cropLeft, cropTop,\r\n      cropWidth, cropHeight,\r\n      0, 0,\r\n      cropWidth, cropHeight\r\n    );\r\n  }\r\n\r\n  return {crop, removeHandlers};\r\n}\r\n\r\nexport default resizeableImage;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport type {PeerType} from '../../lib/appManagers/appPeersManager';\nimport {LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\n\nexport default class PopupDeleteDialog {\n  constructor(\n    private peerId: PeerId,\n    // actionType: 'leave' | 'delete',\n    private peerType?: PeerType,\n    private onSelect?: (promise: Promise<any>) => void\n  ) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, peerType, onSelect} = this;\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n    if(peerType === undefined) {\n      peerType = await managers.appPeersManager.getDialogType(peerId);\n    }\n\n    /* const callbackFlush = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      const promise = appMessagesManager.flushHistory(peerId, checkboxes ? !checked[checkboxes[0].text] : undefined);\n      onSelect && onSelect(promise);\n    }; */\n\n    const callbackLeave = (checked: PopupPeerButtonCallbackCheckboxes, flush = checkboxes && !!checked.size) => {\n      let promise = managers.appChatsManager.leave(peerId.toChatId());\n\n      if(flush) {\n        promise = promise.finally(() => {\n          return managers.appMessagesManager.flushHistory(peerId);\n        }) as any;\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    const callbackDelete = (checked: PopupPeerButtonCallbackCheckboxes) => {\n      let promise: Promise<any>;\n\n      if(peerId.isUser()) {\n        promise = managers.appMessagesManager.flushHistory(peerId, false, checkboxes ? !!checked.size : undefined);\n      } else {\n        if(checked.size) {\n          promise = managers.appChatsManager.delete(peerId.toChatId());\n        } else {\n          return callbackLeave(checked);\n        }\n      }\n\n      onSelect && onSelect(promise);\n    };\n\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: any[], buttons: PopupPeerOptions['buttons'], checkboxes: PopupPeerOptions['checkboxes'];\n    switch(peerType) {\n      case 'channel': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'ChannelDeleteMenu';\n          description = 'AreYouSureDeleteAndExitChannel';\n          buttons = [{\n            langKey: 'ChannelDeleteMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChannelForAll'\n          }];\n        } else {\n          title = 'LeaveChannelMenu';\n          description = 'ChannelLeaveAlertWithName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'LeaveChannel',\n            isDanger: true,\n            callback: callbackLeave\n          }];\n        }\n\n        break;\n      }\n\n      /* case 'megagroup': {\n        title = 'Leave Group?';\n        description = `Are you sure you want to leave this group?`;\n        buttons = [{\n          text: 'LEAVE ' + peerTitleElement,\n          isDanger: true,\n          callback: callbackLeave\n        }];\n\n        break;\n      } */\n\n      case 'chat': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatWithUser';\n        descriptionArgs = [peerTitleElement];\n\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        checkboxes = [{\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [\n            new PeerTitle({peerId}).element\n          ]\n        }];\n\n        break;\n      }\n\n      case 'saved': {\n        title = 'DeleteChatUser';\n        description = 'AreYouSureDeleteThisChatSavedMessages';\n        buttons = [{\n          langKey: 'DeleteChatUser',\n          isDanger: true,\n          callback: callbackDelete\n        }];\n\n        break;\n      }\n\n      case 'megagroup':\n      case 'group': {\n        if(/* actionType === 'delete' &&  */await managers.appChatsManager.hasRights(peerId.toChatId(), 'delete_chat')) {\n          title = 'DeleteMegaMenu';\n          description = 'AreYouSureDeleteAndExit';\n          buttons = [{\n            langKey: 'DeleteMegaMenu',\n            isDanger: true,\n            callback: callbackDelete\n          }];\n\n          checkboxes = [{\n            text: 'DeleteChat.DeleteGroupForAll'\n          }];\n        } else {\n          title = 'LeaveMegaMenu';\n          description = 'AreYouSureDeleteAndExitName';\n          descriptionArgs = [peerTitleElement];\n          buttons = [{\n            langKey: 'DeleteChatUser',\n            isDanger: true,\n            callback: (checkboxes) => callbackLeave(checkboxes, true)\n          }];\n        }\n\n        break;\n      }\n    }\n\n    new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    }).show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport {ChatType} from '../chat/chat';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport filterAsync from '../../helpers/array/filterAsync';\n\nexport default class PopupDeleteMessages {\n  constructor(private peerId: PeerId, private mids: number[], private type: ChatType, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    let {peerId, mids, type, onConfirm} = this;\n\n    const peerTitleElement = new PeerTitle({peerId}).element;\n\n    const managers = PopupElement.MANAGERS;\n\n    mids = mids.slice();\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, revoke?: boolean) => {\n      onConfirm && onConfirm();\n      if(type === 'scheduled') {\n        managers.appMessagesManager.deleteScheduledMessages(peerId, mids);\n      } else {\n        managers.appMessagesManager.deleteMessages(peerId, mids, !!checked.size || revoke);\n      }\n    };\n\n    const buttons: PopupPeerOptions['buttons'] = [{\n      langKey: 'Delete',\n      isDanger: true,\n      callback\n    }];\n    const checkboxes: PopupPeerOptions['checkboxes'] = [];\n    let title: LangPackKey, titleArgs: any[], description: LangPackKey, descriptionArgs: any[];\n    if(mids.length === 1) {\n      title = 'DeleteSingleMessagesTitle';\n    } else {\n      title = 'DeleteMessagesTitle';\n      titleArgs = [i18n('messages', [mids.length])];\n    }\n\n    if(await managers.appPeersManager.isMegagroup(peerId)) {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessageMega' : 'AreYouSureDeleteFewMessagesMega';\n    } else {\n      description = mids.length === 1 ? 'AreYouSureDeleteSingleMessage' : 'AreYouSureDeleteFewMessages';\n    }\n\n    if(peerId === rootScope.myId || type === 'scheduled') {\n\n    } else {\n      if(peerId.isUser()) {\n        checkboxes.push({\n          text: 'DeleteMessagesOptionAlso',\n          textArgs: [peerTitleElement]\n        });\n      } else {\n        const chat = await managers.appChatsManager.getChat(peerId.toChatId());\n\n        const _hasRights = hasRights(chat, 'delete_messages');\n        if(chat._ === 'chat') {\n          const canRevoke = _hasRights ? mids.slice() : await filterAsync(mids, async(mid) => {\n            const message = await managers.appMessagesManager.getMessageByPeer(peerId, mid);\n            return message.fromId === rootScope.myId;\n          });\n\n          if(canRevoke.length) {\n            if(canRevoke.length === mids.length) {\n              checkboxes.push({\n                text: 'DeleteForAll'\n              });\n            } else {\n              checkboxes.push({\n                text: 'DeleteMessagesOption'\n              });\n\n              description = 'DeleteMessagesTextGroup';\n              descriptionArgs = [i18n('messages', [canRevoke.length])];\n              // description = `You can also delete the ${canRevoke.length} message${canRevoke.length > 1 ? 's' : ''} you sent from the inboxes of other group members by pressing \"${buttonText}\".`;\n            }\n          }\n        } else {\n          buttons[0].callback = (checked) => callback(checked, true);\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      titleLangArgs: titleArgs,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport PopupPickUser from './pickUser';\r\n\r\nexport default class PopupForward extends PopupPickUser {\r\n  constructor(\r\n    peerIdMids: {[fromPeerId: PeerId]: number[]},\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    overrideOnSelect = false\r\n  ) {\r\n    super({\r\n      peerTypes: ['dialogs', 'contacts'],\r\n      onSelect: overrideOnSelect ? onSelect : async(peerId) => {\r\n        if(onSelect) {\r\n          const res = onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId});\r\n        appImManager.chat.input.initMessagesForward(peerIdMids);\r\n      },\r\n      placeholder: 'ShareModal.Search.ForwardPlaceholder',\r\n      chatRightsAction: 'send_messages',\r\n      selfPresence: 'ChatYourSelf'\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ripple from '../ripple';\r\nimport animationIntersector from '../animationIntersector';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {i18n, LangPackKey, _i18n} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\r\nimport {addFullScreenListener, getFullScreenElement} from '../../helpers/dom/fullScreen';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport overlayCounter from '../../helpers/overlayCounter';\r\nimport Scrollable from '../scrollable';\r\nimport {getMiddleware, MiddlewareHelper} from '../../helpers/middleware';\r\n\r\nexport type PopupButton = {\r\n  text?: string,\r\n  callback?: () => void,\r\n  langKey?: LangPackKey,\r\n  langArgs?: any[],\r\n  isDanger?: true,\r\n  isCancel?: true,\r\n  element?: HTMLButtonElement\r\n};\r\n\r\nexport type PopupOptions = Partial<{\r\n  closable: boolean,\r\n  overlayClosable: boolean,\r\n  withConfirm: LangPackKey | boolean,\r\n  body: boolean,\r\n  confirmShortcutIsSendShortcut: boolean,\r\n  withoutOverlay: boolean,\r\n  scrollable: boolean,\r\n  buttons: Array<PopupButton>,\r\n  title: boolean | LangPackKey\r\n}>;\r\n\r\nexport interface PopupElementConstructable<T extends PopupElement = any> {\r\n  new(...args: any[]): T;\r\n}\r\n\r\nconst DEFAULT_APPEND_TO = document.body;\r\nlet appendPopupTo = DEFAULT_APPEND_TO;\r\n\r\nconst onFullScreenChange = () => {\r\n  appendPopupTo = getFullScreenElement() || DEFAULT_APPEND_TO;\r\n  PopupElement.reAppend();\r\n};\r\n\r\naddFullScreenListener(DEFAULT_APPEND_TO, onFullScreenChange);\r\n\r\ntype PopupListeners = {\r\n  close: () => void,\r\n  closeAfterTimeout: () => void\r\n};\r\n\r\nexport default class PopupElement<T extends EventListenerListeners = {}> extends EventListenerBase<PopupListeners & T> {\r\n  private static POPUPS: PopupElement<any>[] = [];\r\n  public static MANAGERS: AppManagers;\r\n\r\n  protected element = document.createElement('div');\r\n  protected container = document.createElement('div');\r\n  protected header = document.createElement('div');\r\n  protected title = document.createElement('div');\r\n  protected btnClose: HTMLElement;\r\n  protected btnConfirm: HTMLButtonElement;\r\n  protected body: HTMLElement;\r\n  protected buttonsEl: HTMLElement;\r\n\r\n  protected onEscape: () => boolean = () => true;\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  protected listenerSetter: ListenerSetter;\r\n\r\n  protected confirmShortcutIsSendShortcut: boolean;\r\n  protected btnConfirmOnEnter: HTMLElement;\r\n\r\n  protected withoutOverlay: boolean;\r\n\r\n  protected managers: AppManagers;\r\n\r\n  protected scrollable: Scrollable;\r\n\r\n  protected buttons: Array<PopupButton>;\r\n\r\n  protected middlewareHelper: MiddlewareHelper;\r\n\r\n  constructor(className: string, options: PopupOptions = {}) {\r\n    super(false);\r\n    this.element.classList.add('popup');\r\n    this.element.className = 'popup' + (className ? ' ' + className : '');\r\n    this.container.classList.add('popup-container', 'z-depth-1');\r\n\r\n    this.header.classList.add('popup-header');\r\n\r\n    if(options.title) {\r\n      this.title.classList.add('popup-title');\r\n      if(typeof(options.title) === 'string') {\r\n        _i18n(this.title, options.title);\r\n      }\r\n\r\n      this.header.append(this.title);\r\n    }\r\n\r\n    this.middlewareHelper = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.managers = PopupElement.MANAGERS;\r\n\r\n    this.confirmShortcutIsSendShortcut = options.confirmShortcutIsSendShortcut;\r\n\r\n    if(options.closable) {\r\n      this.btnClose = document.createElement('span');\r\n      this.btnClose.classList.add('btn-icon', 'popup-close', 'tgico-close');\r\n      // ripple(this.closeBtn);\r\n      this.header.prepend(this.btnClose);\r\n\r\n      attachClickEvent(this.btnClose, this.hide, {listenerSetter: this.listenerSetter, once: true});\r\n    }\r\n\r\n    this.withoutOverlay = options.withoutOverlay;\r\n    if(this.withoutOverlay) {\r\n      this.element.classList.add('no-overlay');\r\n    }\r\n\r\n    if(options.overlayClosable) {\r\n      attachClickEvent(this.element, (e: MouseEvent) => {\r\n        if(!findUpClassName(e.target, 'popup-container')) {\r\n          this.hide();\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(options.withConfirm) {\r\n      this.btnConfirm = document.createElement('button');\r\n      this.btnConfirm.classList.add('btn-primary', 'btn-color-primary');\r\n      if(options.withConfirm !== true) {\r\n        this.btnConfirm.append(i18n(options.withConfirm));\r\n      }\r\n      this.header.append(this.btnConfirm);\r\n      ripple(this.btnConfirm);\r\n    }\r\n\r\n    this.container.append(this.header);\r\n    if(options.body) {\r\n      this.body = document.createElement('div');\r\n      this.body.classList.add('popup-body');\r\n      this.container.append(this.body);\r\n    }\r\n\r\n    if(options.scrollable) {\r\n      const scrollable = this.scrollable = new Scrollable(this.body);\r\n      scrollable.onAdditionalScroll = () => {\r\n        scrollable.container.classList.toggle('scrolled-top', !scrollable.scrollTop);\r\n        scrollable.container.classList.toggle('scrolled-bottom', scrollable.isScrolledDown);\r\n      };\r\n\r\n      scrollable.container.classList.add('scrolled-top', 'scrolled-bottom', 'scrollable-y-bordered');\r\n\r\n      if(!this.body) {\r\n        this.container.insertBefore(scrollable.container, this.header.nextSibling);\r\n      }\r\n    }\r\n\r\n    let btnConfirmOnEnter = this.btnConfirm;\r\n    const buttons = this.buttons = options.buttons;\r\n    if(buttons?.length) {\r\n      const buttonsDiv = this.buttonsEl = document.createElement('div');\r\n      buttonsDiv.classList.add('popup-buttons');\r\n\r\n      const buttonsElements = buttons.map((b) => {\r\n        const button = document.createElement('button');\r\n        button.className = 'btn' + (b.isDanger ? ' danger' : ' primary');\r\n\r\n        ripple(button);\r\n\r\n        if(b.text) {\r\n          button.innerHTML =  b.text;\r\n        } else {\r\n          button.append(i18n(b.langKey, b.langArgs));\r\n        }\r\n\r\n        attachClickEvent(button, () => {\r\n          b.callback && b.callback();\r\n          this.destroy();\r\n        }, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n        return b.element = button;\r\n      });\r\n\r\n      if(!btnConfirmOnEnter && buttons.length === 2) {\r\n        const button = buttons.find((button) => !button.isCancel);\r\n        if(button) {\r\n          btnConfirmOnEnter = button.element;\r\n        }\r\n      }\r\n\r\n      buttonsDiv.append(...buttonsElements);\r\n      this.container.append(buttonsDiv);\r\n    }\r\n\r\n    this.btnConfirmOnEnter = btnConfirmOnEnter;\r\n\r\n    this.element.append(this.container);\r\n\r\n    PopupElement.POPUPS.push(this);\r\n  }\r\n\r\n  protected onContentUpdate() {\r\n    if(this.scrollable) {\r\n      this.scrollable.onAdditionalScroll();\r\n    }\r\n  }\r\n\r\n  public show() {\r\n    this.navigationItem = {\r\n      type: 'popup',\r\n      onPop: () => this.destroy(),\r\n      onEscape: this.onEscape\r\n    };\r\n\r\n    appNavigationController.pushItem(this.navigationItem);\r\n\r\n    blurActiveElement(); // * hide mobile keyboard\r\n    appendPopupTo.append(this.element);\r\n    void this.element.offsetWidth; // reflow\r\n    this.element.classList.add('active');\r\n\r\n    this.onContentUpdate();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = true;\r\n      animationIntersector.checkAnimations(true);\r\n    }\r\n\r\n    // cannot add event instantly because keydown propagation will fire it\r\n    // if(this.btnConfirmOnEnter) {\r\n    setTimeout(() => {\r\n      if(!this.element.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      this.listenerSetter.add(document.body)('keydown', (e) => {\r\n        if(PopupElement.POPUPS[PopupElement.POPUPS.length - 1] !== this) {\r\n          return;\r\n        }\r\n\r\n        if(this.confirmShortcutIsSendShortcut ? isSendShortcutPressed(e) : e.key === 'Enter') {\r\n          simulateClickEvent(this.btnConfirmOnEnter);\r\n          cancelEvent(e);\r\n        }\r\n      });\r\n    }, 0);\r\n    // }\r\n  }\r\n\r\n  public hide = () => {\r\n    appNavigationController.backByItem(this.navigationItem);\r\n  };\r\n\r\n  protected destroy() {\r\n    this.dispatchEvent<PopupListeners>('close');\r\n    this.element.classList.add('hiding');\r\n    this.element.classList.remove('active');\r\n    this.listenerSetter.removeAll();\r\n    this.middlewareHelper.destroy();\r\n\r\n    if(!this.withoutOverlay) {\r\n      overlayCounter.isOverlayActive = false;\r\n    }\r\n\r\n    appNavigationController.removeItem(this.navigationItem);\r\n    this.navigationItem = undefined;\r\n\r\n    indexOfAndSplice(PopupElement.POPUPS, this);\r\n\r\n    // ! calm\r\n    onFullScreenChange();\r\n\r\n    setTimeout(() => {\r\n      this.element.remove();\r\n      this.dispatchEvent<PopupListeners>('closeAfterTimeout');\r\n      this.cleanup();\r\n\r\n      if(!this.withoutOverlay) {\r\n        animationIntersector.checkAnimations(false);\r\n      }\r\n    }, 150);\r\n  }\r\n\r\n  public static reAppend() {\r\n    this.POPUPS.forEach((popup) => {\r\n      const {element, container} = popup;\r\n      const parentElement = element.parentElement;\r\n      if(parentElement && parentElement !== appendPopupTo && appendPopupTo !== container) {\r\n        appendPopupTo.append(element);\r\n      }\r\n    });\r\n  }\r\n\r\n  public static getPopups<T extends PopupElement>(popupConstructor: PopupElementConstructable<T>) {\r\n    return this.POPUPS.filter((element) => element instanceof popupConstructor) as T[];\r\n  }\r\n\r\n  public static createPopup<T extends PopupElement, A extends Array<any>>(ctor: {new(...args: A): T}, ...args: A) {\r\n    const popup = new ctor(...args);\r\n    return popup;\r\n  }\r\n}\r\n\r\nexport const addCancelButton = (buttons: PopupButton[]) => {\r\n  const button = buttons.find((b) => b.isCancel);\r\n  if(!button) {\r\n    buttons.push({\r\n      langKey: 'Cancel',\r\n      isCancel: true\r\n    });\r\n  }\r\n\r\n  return buttons;\r\n};\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport tsNow from '../../helpers/tsNow';\nimport {LangPackKey} from '../../lib/langPack';\nimport {MUTE_UNTIL} from '../../lib/mtproto/mtproto_config';\nimport {RadioFormFromValues} from '../row';\nimport PopupPeer from './peer';\n\nconst ONE_HOUR = 3600;\nconst times: {value: number | string, langPackKey: LangPackKey, checked?: boolean}[] = [{\n  value: ONE_HOUR,\n  langPackKey: 'ChatList.Mute.1Hour'\n}, {\n  value: ONE_HOUR * 4,\n  langPackKey: 'ChatList.Mute.4Hours'\n}, {\n  value: ONE_HOUR * 8,\n  langPackKey: 'ChatList.Mute.8Hours'\n}, {\n  value: ONE_HOUR * 24,\n  langPackKey: 'ChatList.Mute.1Day'\n}, {\n  value: ONE_HOUR * 24 * 3,\n  langPackKey: 'ChatList.Mute.3Days'\n}, {\n  value: -1,\n  langPackKey: 'ChatList.Mute.Forever',\n  checked: true\n}];\n\nexport default class PopupMute extends PopupPeer {\n  constructor(peerId: PeerId) {\n    super('popup-mute', {\n      peerId,\n      titleLangKey: 'Notifications',\n      buttons: [{\n        langKey: 'ChatList.Context.Mute',\n        callback: () => {\n          this.managers.appMessagesManager.mutePeer(peerId, time === -1 ? MUTE_UNTIL : tsNow(true) + time);\n        }\n      }],\n      body: true\n    });\n\n    let time: number;\n    const radioForm = RadioFormFromValues(times, (value) => {\n      time = +value;\n    });\n\n    this.body.append(radioForm);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from '../avatar';\nimport PopupElement, {addCancelButton, PopupButton, PopupOptions} from '.';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport CheckboxField, {CheckboxFieldOptions} from '../checkboxField';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\n\nexport type PopupPeerButton = Omit<PopupButton, 'callback'> & Partial<{callback: PopupPeerButtonCallback}>;\nexport type PopupPeerButtonCallbackCheckboxes = Set<LangPackKey>;\nexport type PopupPeerButtonCallback = (checkboxes?: PopupPeerButtonCallbackCheckboxes) => void;\nexport type PopupPeerCheckboxOptions = CheckboxFieldOptions & {checkboxField?: CheckboxField};\n\nexport type PopupPeerOptions = Omit<PopupOptions, 'buttons' | 'title'> & Partial<{\n  peerId: PeerId,\n  title: string | HTMLElement,\n  titleLangKey: LangPackKey,\n  titleLangArgs: any[],\n  noTitle: boolean,\n  description: string | DocumentFragment,\n  descriptionLangKey: LangPackKey,\n  descriptionLangArgs: any[],\n  buttons: Array<PopupPeerButton>,\n  checkboxes: Array<PopupPeerCheckboxOptions>\n}>;\nexport default class PopupPeer extends PopupElement {\n  protected description: HTMLParagraphElement;\n\n  constructor(private className: string, options: PopupPeerOptions = {}) {\n    super('popup-peer' + (className ? ' ' + className : ''), {\n      overlayClosable: true,\n      ...options,\n      title: true,\n      buttons: options.buttons && addCancelButton(options.buttons)\n    });\n\n    if(options.peerId) {\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('avatar-32');\n      avatarEl.updateWithOptions({\n        isDialog: true,\n        peerId: options.peerId\n      });\n      this.header.prepend(avatarEl);\n    }\n\n    if(!options.noTitle) {\n      if(options.titleLangKey || !options.title) this.title.append(i18n(options.titleLangKey || 'AppName', options.titleLangArgs));\n      else if(options.title instanceof HTMLElement) {\n        this.title.append(options.title);\n      } else this.title.innerText = options.title || '';\n    }\n\n    const fragment = document.createDocumentFragment();\n\n    if(options.descriptionLangKey || options.description) {\n      const p = this.description = document.createElement('p');\n      p.classList.add('popup-description');\n      if(options.descriptionLangKey) p.append(i18n(options.descriptionLangKey, options.descriptionLangArgs));\n      else if(options.description) setInnerHTML(p, options.description);\n\n      fragment.append(p);\n    }\n\n    if(options.checkboxes) {\n      this.container.classList.add('have-checkbox');\n\n      options.checkboxes.forEach((o) => {\n        o.withRipple = true;\n        const checkboxField = new CheckboxField(o);\n        o.checkboxField = checkboxField;\n        fragment.append(checkboxField.label);\n      });\n\n      options.buttons.forEach((button) => {\n        if(button.callback) {\n          const original = button.callback;\n          button.callback = () => {\n            const c: Set<LangPackKey> = new Set();\n            options.checkboxes.forEach((o) => {\n              if(o.checkboxField.checked) {\n                c.add(o.text);\n              }\n            });\n            original(c);\n          };\n        }\n      });\n    }\n\n    this.container.insertBefore(fragment, this.header.nextElementSibling);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport AppSelectPeers from '../appSelectPeers';\r\nimport PopupElement from '.';\r\nimport {LangPackKey, _i18n} from '../../lib/langPack';\r\n\r\nexport default class PopupPickUser extends PopupElement {\r\n  protected selector: AppSelectPeers;\r\n\r\n  constructor(options: {\r\n    peerTypes: AppSelectPeers['peerType'],\r\n    onSelect?: (peerId: PeerId) => Promise<void> | void,\r\n    placeholder: LangPackKey,\r\n    chatRightsAction?: AppSelectPeers['chatRightsAction'],\r\n    peerId?: number,\r\n    selfPresence?: LangPackKey\r\n  }) {\r\n    super('popup-forward', {closable: true, overlayClosable: true, body: true, title: true});\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.body,\r\n      onChange: async() => {\r\n        const selected = this.selector.getSelected();\r\n        const peerId = selected[selected.length - 1].toPeerId();\r\n\r\n        if(options.onSelect) {\r\n          const res = options.onSelect(peerId);\r\n          if(res instanceof Promise) {\r\n            try {\r\n              await res;\r\n            } catch(err) {\r\n              return;\r\n            }\r\n          }\r\n        }\r\n\r\n        this.selector = null;\r\n        this.hide();\r\n      },\r\n      peerType: options.peerTypes,\r\n      onFirstRender: () => {\r\n        this.show();\r\n        this.selector.checkForTriggers(); // ! due to zero height before mounting\r\n\r\n        if(!IS_TOUCH_SUPPORTED) {\r\n          this.selector.input.focus();\r\n        }\r\n      },\r\n      chatRightsAction: options.chatRightsAction,\r\n      multiSelect: false,\r\n      rippleEnabled: false,\r\n      avatarSize: 46,\r\n      peerId: options.peerId,\r\n      placeholder: options.placeholder,\r\n      selfPresence: options.selfPresence,\r\n      managers: this.managers\r\n    });\r\n\r\n    // this.scrollable = new Scrollable(this.body);\r\n\r\n    this.title.append(this.selector.input);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupPeer from './peer';\n\nexport default class PopupSendNow extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-delete-chat', {\n      title: `Send Message${mids.length > 1 ? 's' : ''} Now`,\n      description: mids.length > 1 ? 'Send ' + mids.length + ' messages now?' : 'Send message now?',\n      buttons: [{\n        langKey: 'Send',\n        callback: () => {\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.sendScheduledMessages(peerId, mids);\n        }\n      }]\n    });\n\n    this.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppStickersManager} from '../../lib/appManagers/appStickersManager';\r\nimport PopupElement from '.';\r\nimport wrapSticker from '../wrappers/sticker';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport {putPreloader} from '../putPreloader';\r\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport {i18n} from '../../lib/langPack';\r\nimport Button from '../button';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {toastNew} from '../toast';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport createStickersContextMenu from '../../helpers/dom/createStickersContextMenu';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport {Document, StickerSet} from '../../layer';\r\nimport Row from '../row';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport rootScope from '../../lib/rootScope';\r\nimport wrapCustomEmoji from '../wrappers/customEmoji';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'STICKERS-POPUP';\r\n\r\nexport default class PopupStickers extends PopupElement {\r\n  private stickersFooter: HTMLElement;\r\n  private appendTo: HTMLElement;\r\n  private updateAdded: {[setId: Long]: (added: boolean) => void};\r\n  private sets: StickerSet.stickerSet[];\r\n  private button: HTMLElement;\r\n\r\n  constructor(\r\n    private stickerSetInput: Parameters<AppStickersManager['getStickerSet']>[0] | Parameters<AppStickersManager['getStickerSet']>[0][],\r\n    private isEmojis?: boolean\r\n  ) {\r\n    super('popup-stickers', {closable: true, overlayClosable: true, body: true, scrollable: true, title: true});\r\n\r\n    this.title.append(i18n('Loading'));\r\n    this.updateAdded = {};\r\n\r\n    this.addEventListener('close', () => {\r\n      animationIntersector.setOnlyOnePlayableGroup();\r\n    });\r\n\r\n    this.appendTo = this.scrollable.container;\r\n\r\n    this.appendTo.classList.add('is-loading');\r\n    putPreloader(this.appendTo, true);\r\n\r\n    this.stickersFooter = document.createElement('div');\r\n    this.stickersFooter.classList.add('sticker-set-footer');\r\n\r\n    const btn = Button('btn-primary btn-primary-transparent disable-hover', {noRipple: true, text: 'Loading'});\r\n    this.stickersFooter.append(btn);\r\n\r\n    this.body.append(this.stickersFooter);\r\n\r\n    attachStickerViewerListeners({listenTo: this.appendTo, listenerSetter: this.listenerSetter});\r\n\r\n    const onStickerSetUpdate = (set: StickerSet.stickerSet) => {\r\n      const idx = this.sets.findIndex((_set) => _set.id === set.id);\r\n      if(idx === -1) {\r\n        return;\r\n      }\r\n\r\n      this.sets[idx] = set;\r\n      const updateAdded = this.updateAdded[set.id];\r\n      updateAdded?.(!!set.installed_date);\r\n      this.updateButton();\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('stickers_installed', onStickerSetUpdate);\r\n    this.listenerSetter.add(rootScope)('stickers_deleted', onStickerSetUpdate);\r\n\r\n    this.loadStickerSet();\r\n  }\r\n\r\n  private createStickerSetElements(set?: StickerSet.stickerSet) {\r\n    const container = document.createElement('div');\r\n    container.classList.add('sticker-set');\r\n\r\n    let headerRow: Row, updateAdded: (added: boolean) => void;\r\n    if(set) {\r\n      headerRow = new Row({\r\n        title: wrapEmojiText(set.title),\r\n        subtitle: i18n(set.pFlags.emojis ? 'EmojiCount' : 'Stickers', [set.count]),\r\n        buttonRight: true\r\n      });\r\n\r\n      updateAdded = (added) => {\r\n        replaceContent(headerRow.buttonRight, i18n(added ? 'Stickers.SearchAdded' : 'Stickers.SearchAdd'));\r\n        headerRow.buttonRight.classList.toggle('active', added);\r\n      };\r\n\r\n      updateAdded(!!set.installed_date);\r\n\r\n      container.append(headerRow.container);\r\n    }\r\n\r\n    const itemsContainer = document.createElement('div');\r\n    itemsContainer.classList.add('sticker-set-stickers');\r\n\r\n    container.append(itemsContainer);\r\n\r\n    return {container, headerRow, updateAdded, itemsContainer};\r\n  }\r\n\r\n  private onStickersClick = async(e: MouseEvent) => {\r\n    const target = findUpClassName(e.target, 'sticker-set-sticker');\r\n    if(!target) return;\r\n\r\n    const docId = target.dataset.docId;\r\n    if(await appImManager.chat.input.sendMessageWithDocument(docId)) {\r\n      this.hide();\r\n    }\r\n  };\r\n\r\n  private async loadStickerSet() {\r\n    const middleware = this.middlewareHelper.get();\r\n    const inputs = Array.isArray(this.stickerSetInput) ? this.stickerSetInput : [this.stickerSetInput];\r\n    const setsPromises = inputs.map((input) => this.managers.appStickersManager.getStickerSet(input));\r\n    let sets = await Promise.all(setsPromises);\r\n    if(!middleware()) return;\r\n    let firstSet = sets[0];\r\n    if(sets.length === 1 && !firstSet) {\r\n      toastNew({langPackKey: this.isEmojis ? 'AddEmojiNotFound' : 'StickerSet.DontExist'});\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    sets = sets.filter(Boolean);\r\n    firstSet = sets[0];\r\n\r\n    this.sets = sets.map((set) => set.set);\r\n\r\n    const isEmojis = this.isEmojis ??= !!firstSet.set.pFlags.emojis;\r\n\r\n    if(!isEmojis) {\r\n      attachClickEvent(this.appendTo, this.onStickersClick, {listenerSetter: this.listenerSetter});\r\n\r\n      const {destroy} = createStickersContextMenu({\r\n        listenTo: this.appendTo,\r\n        isStickerPack: true,\r\n        onSend: () => this.hide()\r\n      });\r\n\r\n      this.addEventListener('close', destroy);\r\n    }\r\n\r\n    animationIntersector.setOnlyOnePlayableGroup(ANIMATION_GROUP);\r\n\r\n    const lazyLoadQueue = new LazyLoadQueue();\r\n    const loadPromises: Promise<any>[] = [];\r\n\r\n    const containersPromises = sets.map(async(set) => {\r\n      const {container, itemsContainer, headerRow, updateAdded} = this.createStickerSetElements(sets.length > 1 ? set.set : undefined);\r\n\r\n      if(headerRow) {\r\n        attachClickEvent(headerRow.buttonRight, () => {\r\n          this.managers.appStickersManager.toggleStickerSet(set.set);\r\n        }, {listenerSetter: this.listenerSetter});\r\n      }\r\n\r\n      this.updateAdded[set.set.id] = updateAdded;\r\n\r\n      let divs: (HTMLElement | DocumentFragment)[];\r\n\r\n      const docs = set.documents.filter((doc) => doc?._ === 'document') as Document.document[];\r\n      if(isEmojis) {\r\n        divs = [wrapCustomEmoji({\r\n          docIds: docs.map((doc) => doc.id),\r\n          loadPromises,\r\n          animationGroup: ANIMATION_GROUP,\r\n          size: mediaSizes.active.esgCustomEmoji,\r\n          middleware\r\n          // lazyLoadQueue\r\n        })];\r\n\r\n        itemsContainer.classList.add('is-emojis');\r\n      } else {\r\n        divs = await Promise.all(docs.map(async(doc) => {\r\n          const div = document.createElement('div');\r\n          div.classList.add('sticker-set-sticker');\r\n\r\n          const size = mediaSizes.active.esgSticker.width;\r\n\r\n          await wrapSticker({\r\n            doc,\r\n            div,\r\n            lazyLoadQueue,\r\n            group: ANIMATION_GROUP,\r\n            play: true,\r\n            loop: true,\r\n            width: size,\r\n            height: size,\r\n            withLock: true,\r\n            loadPromises,\r\n            middleware\r\n          });\r\n\r\n          return div;\r\n        }));\r\n      }\r\n\r\n      itemsContainer.append(...divs.filter(Boolean));\r\n\r\n      return container;\r\n    });\r\n\r\n    const containers = await Promise.all(containersPromises);\r\n    await Promise.all(loadPromises);\r\n\r\n    const button = this.button = Button('', {noRipple: true});\r\n\r\n    this.updateButton();\r\n\r\n    attachClickEvent(button, () => {\r\n      const toggle = toggleDisability([button], true);\r\n\r\n      this.managers.appStickersManager.toggleStickerSets(sets.map((set) => set.set)).then(() => {\r\n        this.hide();\r\n      }).catch(() => {\r\n        toggle();\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    if(sets.length === 1) {\r\n      setInnerHTML(this.title, wrapEmojiText(firstSet.set.title));\r\n    } else {\r\n      setInnerHTML(this.title, i18n('Emoji'));\r\n    }\r\n\r\n    this.stickersFooter.textContent = '';\r\n    this.stickersFooter.append(button);\r\n\r\n    this.appendTo.classList.remove('is-loading');\r\n    this.appendTo.textContent = '';\r\n    this.appendTo.append(...containers);\r\n\r\n    this.scrollable.onAdditionalScroll();\r\n  }\r\n\r\n  private updateButton() {\r\n    const {sets, isEmojis} = this;\r\n    let isAdd: boolean, buttonAppend: HTMLElement;\r\n    if(sets.length === 1) {\r\n      const firstSet = sets[0];\r\n      buttonAppend = i18n(isEmojis ? 'EmojiCount' : 'Stickers', [firstSet.count]);\r\n      isAdd = !firstSet.installed_date;\r\n    } else {\r\n      const installed = sets.filter((set) => set.installed_date);\r\n      let count: number;\r\n      if(sets.length === installed.length) {\r\n        isAdd = false;\r\n        count = sets.length;\r\n      } else {\r\n        isAdd = true;\r\n        count = sets.length - installed.length;\r\n      }\r\n\r\n      buttonAppend = i18n('EmojiPackCount', [count]);\r\n    }\r\n\r\n    this.button.className = isAdd ? 'btn-primary btn-color-primary' : 'btn-primary btn-primary-transparent danger';\r\n    replaceContent(this.button, i18n(isAdd ? 'AddStickersCount' : 'RemoveStickersCount', [buttonAppend]));\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport SetTransition from './singleTransition';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport isInDOM from '../helpers/dom/isInDOM';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nconst TRANSITION_TIME = 200;\r\n\r\nexport default class ProgressivePreloader {\r\n  public preloader: HTMLDivElement;\r\n  public circle: SVGCircleElement;\r\n  private cancelSvg: SVGSVGElement;\r\n  private downloadSvg: HTMLElement;\r\n\r\n  private tempId = 0;\r\n  public detached = true;\r\n\r\n  public promise: CancellablePromise<any> = null;\r\n\r\n  public isUpload = false;\r\n  private cancelable = true;\r\n  private streamable = false;\r\n  private tryAgainOnFail = true;\r\n  private attachMethod: 'append' | 'prepend' = 'append';\r\n\r\n  public loadFunc: (e?: Event) => any;\r\n\r\n  public totalLength: number;\r\n\r\n  constructor(options?: Partial<{\r\n    isUpload: ProgressivePreloader['isUpload'],\r\n    cancelable: ProgressivePreloader['cancelable'],\r\n    streamable: ProgressivePreloader['streamable'],\r\n    tryAgainOnFail: ProgressivePreloader['tryAgainOnFail'],\r\n    attachMethod: ProgressivePreloader['attachMethod']\r\n  }>) {\r\n    if(options) {\r\n      safeAssign(this, options);\r\n    }\r\n\r\n    if(this.isUpload) {\r\n      this.tryAgainOnFail = false;\r\n    }\r\n  }\r\n\r\n  public constructContainer(options: Partial<{\r\n    color: 'transparent',\r\n    bold: boolean\r\n  }> = {}) {\r\n    if(!this.preloader) {\r\n      this.preloader = document.createElement('div');\r\n      this.preloader.classList.add('preloader-container');\r\n\r\n      if(options.color) {\r\n        this.preloader.classList.add('preloader-' + options.color);\r\n      }\r\n\r\n      if(options.bold) {\r\n        this.preloader.classList.add('preloader-bold');\r\n      }\r\n\r\n      if(this.streamable) {\r\n        this.preloader.classList.add('preloader-streamable');\r\n      }\r\n    }\r\n  }\r\n\r\n  public constructDownloadIcon() {\r\n    this.constructContainer();\r\n  }\r\n\r\n  public construct() {\r\n    this.construct = null;\r\n\r\n    this.constructContainer();\r\n\r\n    this.preloader.innerHTML = `\r\n    <div class=\"you-spin-me-round\">\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"${this.streamable ? '25 25 50 50' : '27 27 54 54'}\">\r\n    <circle class=\"preloader-path-new\" cx=\"${this.streamable ? '50' : '54'}\" cy=\"${this.streamable ? '50' : '54'}\" r=\"${this.streamable ? 19 : 24}\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n    </svg>\r\n    </div>`;\r\n\r\n    if(this.streamable) {\r\n      this.totalLength = 118.61124420166016;\r\n    } else {\r\n      this.totalLength = 149.82473754882812;\r\n    }\r\n\r\n    if(this.cancelable) {\r\n      this.preloader.innerHTML += `\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-close\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5.20970461,5.38710056 L5.29289322,5.29289322 C5.65337718,4.93240926 6.22060824,4.90467972 6.61289944,5.20970461 L6.70710678,5.29289322 L12,10.585 L17.2928932,5.29289322 C17.6834175,4.90236893 18.3165825,4.90236893 18.7071068,5.29289322 C19.0976311,5.68341751 19.0976311,6.31658249 18.7071068,6.70710678 L13.415,12 L18.7071068,17.2928932 C19.0675907,17.6533772 19.0953203,18.2206082 18.7902954,18.6128994 L18.7071068,18.7071068 C18.3466228,19.0675907 17.7793918,19.0953203 17.3871006,18.7902954 L17.2928932,18.7071068 L12,13.415 L6.70710678,18.7071068 C6.31658249,19.0976311 5.68341751,19.0976311 5.29289322,18.7071068 C4.90236893,18.3165825 4.90236893,17.6834175 5.29289322,17.2928932 L10.585,12 L5.29289322,6.70710678 C4.93240926,6.34662282 4.90467972,5.77939176 5.20970461,5.38710056 L5.29289322,5.29289322 L5.20970461,5.38710056 Z\"/>\r\n        </g>\r\n      </svg>\r\n      <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-download\" viewBox=\"0 0 24 24\">\r\n        <g fill=\"none\" fill-rule=\"evenodd\">\r\n          <polygon points=\"0 0 24 0 24 24 0 24\"/>\r\n          <path fill=\"#000\" fill-rule=\"nonzero\" d=\"M5,19 L19,19 C19.5522847,19 20,19.4477153 20,20 C20,20.5128358 19.6139598,20.9355072 19.1166211,20.9932723 L19,21 L5,21 C4.44771525,21 4,20.5522847 4,20 C4,19.4871642 4.38604019,19.0644928 4.88337887,19.0067277 L5,19 L19,19 L5,19 Z M11.8833789,3.00672773 L12,3 C12.5128358,3 12.9355072,3.38604019 12.9932723,3.88337887 L13,4 L13,13.585 L16.2928932,10.2928932 C16.6533772,9.93240926 17.2206082,9.90467972 17.6128994,10.2097046 L17.7071068,10.2928932 C18.0675907,10.6533772 18.0953203,11.2206082 17.7902954,11.6128994 L17.7071068,11.7071068 L12.7071068,16.7071068 C12.3466228,17.0675907 11.7793918,17.0953203 11.3871006,16.7902954 L11.2928932,16.7071068 L6.29289322,11.7071068 C5.90236893,11.3165825 5.90236893,10.6834175 6.29289322,10.2928932 C6.65337718,9.93240926 7.22060824,9.90467972 7.61289944,10.2097046 L7.70710678,10.2928932 L11,13.585 L11,4 C11,3.48716416 11.3860402,3.06449284 11.8833789,3.00672773 L12,3 L11.8833789,3.00672773 Z\"/>\r\n        </g>\r\n      </svg>`;\r\n\r\n      this.downloadSvg = this.preloader.lastElementChild as HTMLElement;\r\n      this.cancelSvg = this.downloadSvg.previousElementSibling as any;\r\n    } else {\r\n      this.preloader.classList.add('preloader-swing');\r\n    }\r\n\r\n    this.circle = this.preloader.firstElementChild.firstElementChild.firstElementChild as SVGCircleElement;\r\n\r\n    if(this.cancelable) {\r\n      attachClickEvent(this.preloader, this.onClick);\r\n    }\r\n  }\r\n\r\n  public onClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.preloader.classList.contains('manual')) {\r\n      if(this.loadFunc) {\r\n        this.loadFunc(e);\r\n      }\r\n    } else {\r\n      if(this.promise && this.promise.cancel) {\r\n        this.promise.cancel();\r\n      }\r\n    }\r\n  };\r\n\r\n  public setDownloadFunction(func: ProgressivePreloader['loadFunc']) {\r\n    this.loadFunc = func;\r\n  }\r\n\r\n  public setManual() {\r\n    this.preloader.classList.add('manual');\r\n    this.setProgress(0);\r\n  }\r\n\r\n  public attachPromise(promise: CancellablePromise<any>) {\r\n    if(this.isUpload && this.promise) return;\r\n\r\n    this.promise = promise;\r\n\r\n    const tempId = --this.tempId;\r\n    const startTime = Date.now();\r\n\r\n    const onEnd = (err: Error) => {\r\n      promise.notify = promise.notifyAll = null;\r\n\r\n      if(tempId !== this.tempId) {\r\n        return;\r\n      }\r\n\r\n      const elapsedTime = Date.now() - startTime;\r\n\r\n      // console.log('[PP]: end', this.detached, performance.now());\r\n\r\n      if(!err && this.cancelable) {\r\n        this.setProgress(100);\r\n\r\n        const delay = TRANSITION_TIME * 0.75;\r\n\r\n        if(elapsedTime < delay) {\r\n          this.detach();\r\n        } else {\r\n          setTimeout(() => { // * wait for transition complete\r\n            if(tempId === this.tempId) {\r\n              this.detach();\r\n            }\r\n          }, delay);\r\n        }\r\n      } else {\r\n        if(this.tryAgainOnFail) {\r\n          this.attach(this.preloader.parentElement);\r\n          fastRaf(() => {\r\n            this.setManual();\r\n          });\r\n        } else {\r\n          this.detach();\r\n        }\r\n      }\r\n\r\n      this.promise = promise = null;\r\n    };\r\n\r\n    promise\r\n    .then(() => onEnd(null))\r\n    .catch((err) => onEnd(err));\r\n\r\n    if(promise.addNotifyListener) {\r\n      promise.addNotifyListener((details: {done: number, total: number}) => {\r\n        /* if(details.done >= details.total) {\r\n          onEnd();\r\n        } */\r\n\r\n        if(tempId !== this.tempId) return;\r\n\r\n        // console.log('preloader download', promise, details);\r\n        const percents = details.done / details.total * 100;\r\n        this.setProgress(percents);\r\n      });\r\n    }\r\n  }\r\n\r\n  public attach(elem: Element, reset = false, promise?: CancellablePromise<any>) {\r\n    if(this.construct) {\r\n      this.construct();\r\n    }\r\n\r\n    if(this.preloader.parentElement) {\r\n      this.preloader.classList.remove('manual');\r\n    }\r\n\r\n    this.detached = false;\r\n\r\n    if(promise/*  && false */) {\r\n      this.attachPromise(promise);\r\n    }\r\n\r\n    let useRafs = 0;\r\n    if(this.detached || this.preloader.parentElement !== elem) {\r\n      useRafs = isInDOM(this.preloader) ? 1 : 2;\r\n      if(this.preloader.parentElement !== elem) {\r\n        elem[this.attachMethod](this.preloader);\r\n      }\r\n    }\r\n\r\n    SetTransition(this.preloader, 'is-visible', true, TRANSITION_TIME, undefined, useRafs);\r\n\r\n    if(this.cancelable && reset) {\r\n      this.setProgress(0);\r\n    }\r\n  }\r\n\r\n  public detach() {\r\n    if(this.detached) {\r\n      return;\r\n    }\r\n    // return;\r\n\r\n    this.detached = true;\r\n\r\n    // return;\r\n\r\n    if(this.preloader?.parentElement) {\r\n      /* setTimeout(() =>  */// fastRaf(() => {\r\n      /* if(!this.detached) return;\r\n        this.detached = true; */\r\n\r\n      // fastRaf(() => {\r\n      // console.log('[PP]: detach after rAF', this.detached, performance.now());\r\n\r\n      // if(!this.detached || !this.preloader.parentElement) {\r\n      //   return;\r\n      // }\r\n\r\n      SetTransition(this.preloader, 'is-visible', false, TRANSITION_TIME, () => {\r\n        this.preloader.remove();\r\n      }, 1);\r\n      // });\r\n      // })/* , 5e3) */;\r\n    }\r\n  }\r\n\r\n  public setProgress(percents: number) {\r\n    if(!this.totalLength && !isInDOM(this.circle)) {\r\n      return;\r\n    }\r\n\r\n    if(percents === 0) {\r\n      this.circle.style.strokeDasharray = '';\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if(!this.totalLength) {\r\n        this.totalLength = this.circle.getTotalLength();\r\n      }\r\n\r\n      // console.log('setProgress', (percents / 100 * totalLength));\r\n      this.circle.style.strokeDasharray = '' + Math.max(5, percents / 100 * this.totalLength) + ', ' + this.totalLength;\r\n    } catch(err) {}\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPreviewURLFromBytes from '../helpers/bytes/getPreviewURLFromBytes';\nimport {renderImageFromUrlPromise} from '../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\nimport {recordPromise} from '../helpers/recordPromise';\nimport sequentialDom from '../helpers/sequentialDom';\nimport {UserProfilePhoto, ChatPhoto} from '../layer';\nimport type {PeerPhotoSize} from '../lib/appManagers/appAvatarsManager';\nimport getPeerColorById from '../lib/appManagers/utils/peers/getPeerColorById';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../lib/mtproto/mtproto_config';\nimport getAbbreviation from '../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../lib/rootScope';\nimport getPeerInitials from './wrappers/getPeerInitials';\n\nexport async function putAvatar(\n  div: HTMLElement,\n  peerId: PeerId,\n  photo: UserProfilePhoto.userProfilePhoto | ChatPhoto.chatPhoto,\n  size: PeerPhotoSize,\n  img = new Image(),\n  onlyThumb = false\n) {\n  const r = await rootScope.managers.acknowledged.appAvatarsManager.loadAvatar(peerId, photo, size);\n  const loadPromise = r.result;\n  const cached = r.cached;\n\n  img.classList.add('avatar-photo');\n\n  let renderThumbPromise: Promise<void>;\n  let callback: () => void;\n  let thumbImage: HTMLImageElement;\n  if(cached) {\n    //   misc.ts: renderImageFromUrl\n    callback = () => {\n      replaceContent(div, img);\n      div.dataset.color = '';\n    };\n  } else {\n    const animate = rootScope.settings.animationsEnabled;\n    if(animate) {\n      img.classList.add('fade-in');\n    }\n\n    let isFullLoaded = false;\n    if(size === 'photo_big') { // let's load small photo first\n      const res = await putAvatar(div, peerId, photo, 'photo_small');\n      renderThumbPromise = res.loadPromise;\n      thumbImage = res.thumbImage;\n    } else if(photo.stripped_thumb) {\n      thumbImage = new Image();\n      div.classList.add('avatar-relative');\n      thumbImage.classList.add('avatar-photo', 'avatar-photo-thumbnail');\n      const url = getPreviewURLFromBytes(photo.stripped_thumb);\n      renderThumbPromise = renderImageFromUrlPromise(thumbImage, url).then(() => {\n        if(isFullLoaded) {\n          return;\n        }\n\n        replaceContent(div, thumbImage);\n      });\n    }\n\n    callback = () => {\n      isFullLoaded = true;\n\n      if(thumbImage) {\n        div.append(img);\n      } else {\n        replaceContent(div, img);\n      }\n\n      setTimeout(() => {\n        if(div.childElementCount) {\n          sequentialDom.mutateElement(img, () => {\n            div.dataset.color = '';\n\n            if(animate) {\n              img.classList.remove('fade-in');\n            }\n\n            if(thumbImage) {\n              thumbImage.remove();\n            }\n          });\n        }\n      }, animate ? 200 : 0);\n    };\n  }\n\n  const renderPromise = loadPromise\n  .then((url) => renderImageFromUrlPromise(img, url/* , !cached */))\n  .then(callback);\n\n  await (renderThumbPromise || renderPromise);\n\n  return {\n    cached,\n    loadPromise: renderThumbPromise || renderPromise,\n    thumbImage\n  };\n}\n\nfunction set(\n  div: HTMLElement,\n  innerHTML: Parameters<typeof setInnerHTML>[1],\n  color: string,\n  icon: string\n) {\n  setInnerHTML(div, innerHTML);\n  div.dataset.color = color;\n  div.classList.remove('tgico-saved', 'tgico-deletedaccount', 'tgico-reply_filled');\n  icon && div.classList.add(icon);\n}\n\n// peerId === peerId || title\nexport default async function putPhoto(\n  div: HTMLElement,\n  peerId: PeerId,\n  isDialog = false,\n  title = '',\n  onlyThumb = false,\n  isBig?: boolean\n) {\n  const myId = rootScope.myId;\n\n  if(peerId === myId && isDialog) {\n    set(div, '', '', 'tgico-saved');\n    return;\n  }\n\n  const managers = rootScope.managers;\n\n  if(peerId !== NULL_PEER_ID && peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId);\n    if(user && user.pFlags && user.pFlags.deleted) {\n      set(div, '', getPeerColorById(peerId), 'tgico-deletedaccount');\n      return;\n    }\n  }\n\n  const size: PeerPhotoSize = isBig ? 'photo_big' : 'photo_small';\n  const photo = await managers.appPeersManager.getPeerPhoto(peerId);\n  const avatarAvailable = !!photo;\n  const avatarRendered = !!div.firstElementChild && !(div.firstElementChild as HTMLElement).classList.contains('emoji');\n  if(!avatarAvailable || !avatarRendered || !(await managers.appAvatarsManager.isAvatarCached(peerId, size))) {\n    let color = '';\n    if(peerId && (peerId !== myId || !isDialog)) {\n      color = getPeerColorById(peerId);\n    }\n\n    if(peerId === REPLIES_PEER_ID) {\n      set(div, '', color, 'tgico-reply_filled');\n      return;\n    }\n\n    const abbr = await (title ? getAbbreviation(title) : getPeerInitials(peerId, managers));\n    set(div, abbr, color, '');\n    // return Promise.resolve(true);\n  }\n\n  if(avatarAvailable/*  && false */) {\n    const promise = putAvatar(div, peerId, photo, size, undefined, onlyThumb);\n    // recordPromise(promise, 'putAvatar-' + peerId);\n    return promise;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Chat, User} from '../../layer';\nimport getAbbreviation from '../../lib/richTextProcessor/getAbbreviation';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerInitials(peerId: PeerId, managers = rootScope.managers) {\n  const peer: Chat | User = await managers.appPeersManager.getPeer(peerId);\n  return getAbbreviation(\n    (peer as Chat.chat).title ?? [(peer as User.user).first_name, (peer as User.user).last_name].filter(Boolean).join(' ')\n  );\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\nexport function putPreloader(elem: Element, returnDiv = false): HTMLElement {\r\n  const html = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"preloader-circular\" viewBox=\"25 25 50 50\">\r\n  <circle class=\"preloader-path\" cx=\"50\" cy=\"50\" r=\"20\" fill=\"none\" stroke-miterlimit=\"10\"/>\r\n  </svg>`;\r\n\r\n  if(returnDiv) {\r\n    const div = document.createElement('div');\r\n    div.classList.add('preloader');\r\n    div.innerHTML = html;\r\n\r\n    if(elem) {\r\n      elem.appendChild(div);\r\n    }\r\n\r\n    return div;\r\n  }\r\n\r\n  elem.insertAdjacentHTML('beforeend', html);\r\n  return elem.lastElementChild as HTMLElement;\r\n}\r\n\r\nMOUNT_CLASS_TO.putPreloader = putPreloader;\r\n\r\nexport function setButtonLoader(elem: HTMLButtonElement, icon = 'check') {\r\n  elem.classList.remove('tgico-' + icon);\r\n  elem.disabled = true;\r\n  putPreloader(elem);\r\n\r\n  return () => {\r\n    elem.innerHTML = '';\r\n    elem.classList.add('tgico-' + icon);\r\n    elem.removeAttribute('disabled');\r\n  };\r\n}\r\n\r\n/* export function parseMenuButtonsTo(to: {[name: string]: HTMLElement}, elements: HTMLCollection | NodeListOf<HTMLElement>) {\r\n  Array.from(elements).forEach((el) => {\r\n    const match = el.className.match(/(?:^|\\s)menu-(.+?)(?:$|\\s)/);\r\n    if(!match) return;\r\n    to[match[1]] = el as HTMLElement;\r\n  });\r\n} */\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getDeepProperty from '../helpers/object/getDeepProperty';\r\nimport {LangPackKey, _i18n} from '../lib/langPack';\r\nimport apiManagerProxy from '../lib/mtproto/mtprotoworker';\r\nimport rootScope from '../lib/rootScope';\r\n\r\nexport default class RadioField {\r\n  public input: HTMLInputElement;\r\n  public label: HTMLLabelElement;\r\n  public main: HTMLElement;\r\n\r\n  constructor(options: {\r\n    text?: string,\r\n    langKey?: LangPackKey,\r\n    name: string,\r\n    value?: string,\r\n    stateKey?: string,\r\n    alignRight?: boolean\r\n  }) {\r\n    const label = this.label = document.createElement('label');\r\n    label.classList.add('radio-field');\r\n\r\n    if(options.alignRight) {\r\n      label.classList.add('radio-field-right');\r\n    }\r\n\r\n    const input = this.input = document.createElement('input');\r\n    input.type = 'radio';\r\n    /* input.id =  */input.name = 'input-radio-' + options.name;\r\n\r\n    if(options.value) {\r\n      input.value = options.value;\r\n\r\n      if(options.stateKey) {\r\n        apiManagerProxy.getState().then((state) => {\r\n          input.checked = getDeepProperty(state, options.stateKey) === options.value;\r\n        });\r\n\r\n        input.addEventListener('change', () => {\r\n          rootScope.managers.appStateManager.setByKey(options.stateKey, options.value);\r\n        });\r\n      }\r\n    }\r\n\r\n    const main = this.main = document.createElement('div');\r\n    main.classList.add('radio-field-main');\r\n\r\n    if(options.text) {\r\n      main.innerHTML = options.text;\r\n      /* const caption = document.createElement('div');\r\n      caption.classList.add('radio-field-main-caption');\r\n      caption.innerHTML = text;\r\n\r\n      if(subtitle) {\r\n        label.classList.add('radio-field-with-subtitle');\r\n        caption.insertAdjacentHTML('beforeend', `<div class=\"radio-field-main-subtitle\">${subtitle}</div>`);\r\n      }\r\n\r\n      main.append(caption); */\r\n    } else if(options.langKey) {\r\n      _i18n(main, options.langKey);\r\n    }\r\n\r\n    label.append(input, main);\r\n  }\r\n\r\n  get checked() {\r\n    return this.input.checked;\r\n  }\r\n\r\n  set checked(checked: boolean) {\r\n    this.setValueSilently(checked);\r\n\r\n    const event = new Event('change', {bubbles: true, cancelable: true});\r\n    this.input.dispatchEvent(event);\r\n  }\r\n\r\n  public setValueSilently(checked: boolean) {\r\n    this.input.checked = checked;\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function RadioForm(radios: {container: HTMLElement, input: HTMLInputElement}[], onChange: (value: string, event: Event) => void) {\r\n  const form = document.createElement('form');\r\n\r\n  radios.forEach((r) => {\r\n    const {container, input} = r;\r\n    form.append(container);\r\n    input.addEventListener('change', (e) => {\r\n      if(input.checked) {\r\n        onChange(input.value, e);\r\n      }\r\n    });\r\n  });\r\n\r\n  return form;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachGrabListeners, {GrabEvent} from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\n\r\nexport default class RangeSelector {\r\n  public container: HTMLDivElement;\r\n  protected filled: HTMLDivElement;\r\n  protected seek: HTMLInputElement;\r\n\r\n  public mousedown = false;\r\n  protected rect: DOMRect;\r\n  protected _removeListeners: () => void;\r\n\r\n  private events: Partial<{\r\n    // onMouseMove: ProgressLine['onMouseMove'],\r\n    onMouseDown: RangeSelector['onMouseDown'],\r\n    onMouseUp: RangeSelector['onMouseUp'],\r\n    onScrub: (value: number) => void\r\n  }> = {};\r\n\r\n  protected decimals: number;\r\n\r\n  protected step: number;\r\n  protected min: number;\r\n  protected max: number;\r\n  protected withTransition = false;\r\n  protected useTransform = false;\r\n  protected vertical = false;\r\n\r\n  constructor(\r\n    options: {\r\n      step: RangeSelector['step'],\r\n      min: RangeSelector['min'],\r\n      max: RangeSelector['max'],\r\n      withTransition?: RangeSelector['withTransition'],\r\n      useTransform?: RangeSelector['useTransform'],\r\n      vertical?: RangeSelector['vertical']\r\n    },\r\n    value = 0\r\n  ) {\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('progress-line');\r\n\r\n    // there is no sense in using transition with transform, because it is updating every frame\r\n    if(this.useTransform) {\r\n      this.container.classList.add('use-transform');\r\n    } else if(this.withTransition) {\r\n      this.container.classList.add('with-transition');\r\n    }\r\n\r\n    this.filled = document.createElement('div');\r\n    this.filled.classList.add('progress-line__filled');\r\n\r\n    const seek = this.seek = document.createElement('input');\r\n    seek.classList.add('progress-line__seek');\r\n    // seek.setAttribute('max', '0');\r\n    seek.type = 'range';\r\n    seek.step = '' + this.step;\r\n    seek.min = '' + this.min;\r\n    seek.max = '' + this.max;\r\n    seek.value = '' + value;\r\n\r\n    if(value) {\r\n      this.setProgress(value);\r\n    }\r\n\r\n    const stepStr = '' + this.step;\r\n    const index = stepStr.indexOf('.');\r\n    this.decimals = index === -1 ? 0 : stepStr.length - index - 1;\r\n\r\n    // this.setListeners();\r\n\r\n    this.container.append(this.filled, seek);\r\n  }\r\n\r\n  get value() {\r\n    return +this.seek.value;\r\n  }\r\n\r\n  public setHandlers(events: RangeSelector['events']) {\r\n    this.events = events;\r\n  }\r\n\r\n  protected onMouseMove = (event: GrabEvent) => {\r\n    this.scrub(event);\r\n  };\r\n\r\n  protected onMouseDown = (event: GrabEvent) => {\r\n    this.rect = this.container.getBoundingClientRect();\r\n    this.mousedown = true;\r\n    this.scrub(event);\r\n    this.container.classList.add('is-focused');\r\n    this.events?.onMouseDown && this.events.onMouseDown(event);\r\n  };\r\n\r\n  protected onMouseUp = (event: GrabEvent) => {\r\n    this.mousedown = false;\r\n    this.container.classList.remove('is-focused');\r\n    this.events?.onMouseUp && this.events.onMouseUp(event);\r\n  };\r\n\r\n  public setListeners() {\r\n    this.seek.addEventListener('input', this.onInput);\r\n    this._removeListeners = attachGrabListeners(this.container, this.onMouseDown, this.onMouseMove, this.onMouseUp);\r\n  }\r\n\r\n  public onInput = () => {\r\n    const value = +this.seek.value;\r\n    this.setFilled(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n  };\r\n\r\n  public setProgress(value: number) {\r\n    this.seek.value = '' + value;\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public addProgress(value: number) {\r\n    this.seek.value = '' + (+this.seek.value + value);\r\n    this.setFilled(+this.seek.value); // clamp\r\n  }\r\n\r\n  public setFilled(value: number) {\r\n    let percents = (value - this.min) / (this.max - this.min);\r\n    percents = clamp(percents, 0, 1);\r\n\r\n    // using scaleX and width even with vertical because it will be rotated\r\n    if(this.useTransform) {\r\n      this.filled.style.transform = `scaleX(${percents})`;\r\n    } else {\r\n      this.filled.style.width = (percents * 100) + '%';\r\n    }\r\n  }\r\n\r\n  protected scrub(event: GrabEvent) {\r\n    const rectMax = this.vertical ? this.rect.height : this.rect.width;\r\n    const offsetAxisValue = clamp(this.vertical ? -(event.y - this.rect.bottom) : event.x - this.rect.left, 0, rectMax);\r\n\r\n    let value = this.min + (offsetAxisValue / rectMax * (this.max - this.min));\r\n\r\n    if((value - this.min) < ((this.max - this.min) / 2)) {\r\n      value -= this.step / 10;\r\n    }\r\n\r\n    value = +value.toFixed(this.decimals);\r\n    value = clamp(value, this.min, this.max);\r\n\r\n    // this.seek.value = '' + value;\r\n    // this.onInput();\r\n\r\n    this.setProgress(value);\r\n    this.events?.onScrub && this.events.onScrub(value);\r\n\r\n    return value;\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(this._removeListeners) {\r\n      this._removeListeners();\r\n      this._removeListeners = null;\r\n    }\r\n\r\n    this.seek.removeEventListener('input', this.onInput);\r\n\r\n    this.events = {};\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport sequentialDom from '../helpers/sequentialDom';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport rootScope from '../lib/rootScope';\r\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\r\n\r\nlet rippleClickId = 0;\r\nexport default function ripple(\r\n  elem: HTMLElement,\r\n  callback: (id: number) => Promise<boolean | void> = () => Promise.resolve(),\r\n  onEnd: (id: number) => void = null,\r\n  prepend = false,\r\n  attachListenerTo = elem\r\n) {\r\n  // return;\r\n  if(elem.querySelector('.c-ripple')) return;\r\n  elem.classList.add('rp');\r\n\r\n  const r = document.createElement('div');\r\n  r.classList.add('c-ripple');\r\n\r\n  const isSquare = elem.classList.contains('rp-square');\r\n  if(isSquare) {\r\n    r.classList.add('is-square');\r\n  }\r\n\r\n  elem[prepend ? 'prepend' : 'append'](r);\r\n\r\n  let handler: () => void;\r\n  // let animationEndPromise: Promise<number>;\r\n  const drawRipple = (clientX: number, clientY: number) => {\r\n    const startTime = Date.now();\r\n    const elem = document.createElement('div');\r\n\r\n    const clickId = rippleClickId++;\r\n\r\n    // console.log('ripple drawRipple');\r\n\r\n    const duration = +window.getComputedStyle(r).getPropertyValue('--ripple-duration').replace('s', '') * 1000;\r\n    // console.log('ripple duration', duration);\r\n\r\n    handler = () => {\r\n    // handler = () => animationEndPromise.then((duration) => {\r\n      // console.log('ripple animation was:', duration);\r\n\r\n      // const duration = isSquare || mediaSizes.isMobile ? 200 : 700;\r\n      // return;\r\n      const elapsedTime = Date.now() - startTime;\r\n      const cb = () => {\r\n        // console.log('ripple elapsedTime total pre-remove:', Date.now() - startTime);\r\n        sequentialDom.mutate(() => {\r\n          elem.remove();\r\n        });\r\n\r\n        if(onEnd) onEnd(clickId);\r\n      };\r\n      if(elapsedTime < duration) {\r\n        const delay = Math.max(duration - elapsedTime, duration / 2);\r\n        setTimeout(() => elem.classList.add('hiding'), Math.max(delay - duration / 2, 0));\r\n\r\n        setTimeout(cb, delay);\r\n      } else {\r\n        elem.classList.add('hiding');\r\n        setTimeout(cb, duration / 2);\r\n      }\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        window.removeEventListener('contextmenu', handler);\r\n      }\r\n\r\n      handler = null;\r\n      touchStartFired = false;\r\n    };\r\n    // });\r\n\r\n    callback && callback(clickId);\r\n\r\n    /* callback().then((bad) => {\r\n      if(bad) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    // console.log('ripple after promise', Date.now() - startTime);\r\n    // console.log('ripple tooSlow:', tooSlow);\r\n    /* if(tooSlow) {\r\n        span.remove();\r\n        return;\r\n      } */\r\n\r\n    window.requestAnimationFrame(() => {\r\n      const rect = r.getBoundingClientRect();\r\n      elem.classList.add('c-ripple__circle');\r\n\r\n      const clickX = clientX - rect.left;\r\n      const clickY = clientY - rect.top;\r\n\r\n      const radius = Math.sqrt((Math.abs(clickY - rect.height / 2) + rect.height / 2) ** 2 + (Math.abs(clickX - rect.width / 2) + rect.width / 2) ** 2);\r\n      const size = radius;\r\n\r\n      // center of circle\r\n      const x = clickX - size / 2;\r\n      const y = clickY - size / 2;\r\n\r\n      // console.log('ripple click', offsetFromCenter, size, clickX, clickY);\r\n\r\n      elem.style.width = elem.style.height = size + 'px';\r\n      elem.style.left = x + 'px';\r\n      elem.style.top = y + 'px';\r\n\r\n      //     \r\n      /* animationEndPromise = new Promise((resolve) => {\r\n          span.addEventListener('animationend', () => {\r\n            // 713 -> 700\r\n            resolve(((Date.now() - startTime) / 100 | 0) * 100);\r\n          }, {once: true});\r\n        }); */\r\n\r\n      //             \r\n      /* span.style.display = 'none';\r\n        r.append(span);\r\n        duration = +window.getComputedStyle(span).getPropertyValue('animation-duration').replace('s', '') * 1000;\r\n        span.style.display = ''; */\r\n\r\n      r.append(elem);\r\n\r\n      // r.classList.add('active');\r\n      // handler();\r\n    });\r\n    // });\r\n  };\r\n\r\n  const isRippleUnneeded = (e: Event) => e.target !== elem && (\r\n    ['BUTTON', 'A'].includes((e.target as HTMLElement).tagName) ||\r\n      findUpClassName(e.target as HTMLElement, 'c-ripple') !== r\r\n  ) && (\r\n    attachListenerTo === elem ||\r\n      !findUpAsChild(e.target as HTMLElement, attachListenerTo)\r\n  );\r\n\r\n  // TODO: rename this variable\r\n  let touchStartFired = false;\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    const touchEnd = () => {\r\n      handler && handler();\r\n    };\r\n\r\n    attachListenerTo.addEventListener('touchstart', (e) => {\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n\r\n      // console.log('ripple touchstart', e);\r\n      if(e.touches.length > 1 || touchStartFired || isRippleUnneeded(e)) {\r\n        return;\r\n      }\r\n\r\n      // console.log('touchstart', e);\r\n      touchStartFired = true;\r\n\r\n      const {clientX, clientY} = e.touches[0];\r\n      drawRipple(clientX, clientY);\r\n      attachListenerTo.addEventListener('touchend', touchEnd, {once: true});\r\n\r\n      window.addEventListener('touchmove', (e) => {\r\n        e.cancelBubble = true;\r\n        e.stopPropagation();\r\n        touchEnd();\r\n        attachListenerTo.removeEventListener('touchend', touchEnd);\r\n      }, {once: true});\r\n    }, {passive: true});\r\n  } else {\r\n    attachListenerTo.addEventListener('mousedown', (e) => {\r\n      if(![0, 2].includes(e.button)) { // only left and right buttons\r\n        return;\r\n      }\r\n\r\n      if(!rootScope.settings.animationsEnabled) {\r\n        return;\r\n      }\r\n      // console.log('ripple mousedown', e, e.target, findUpClassName(e.target as HTMLElement, 'c-ripple') === r);\r\n\r\n      if(attachListenerTo.dataset.ripple === '0' || isRippleUnneeded(e)) {\r\n        return;\r\n      } else if(touchStartFired) {\r\n        touchStartFired = false;\r\n        return;\r\n      }\r\n\r\n      const {clientX, clientY} = e;\r\n      drawRipple(clientX, clientY);\r\n      window.addEventListener('mouseup', handler, {once: true, passive: true});\r\n      window.addEventListener('contextmenu', handler, {once: true, passive: true});\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport CheckboxField from './checkboxField';\r\nimport RadioField from './radioField';\r\nimport ripple from './ripple';\r\nimport {SliderSuperTab} from './slider';\r\nimport RadioForm from './radioForm';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport Button from './button';\r\n\r\nexport default class Row {\r\n  public container: HTMLElement;\r\n  public title: HTMLDivElement;\r\n  public titleRight: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n  public media: HTMLElement;\r\n\r\n  public checkboxField: CheckboxField;\r\n  public radioField: RadioField;\r\n\r\n  public freezed = false;\r\n\r\n  public buttonRight: HTMLElement;\r\n\r\n  constructor(options: Partial<{\r\n    icon: string,\r\n    subtitle: string | HTMLElement | DocumentFragment,\r\n    subtitleLangKey: LangPackKey,\r\n    subtitleLangArgs: any[],\r\n    radioField: Row['radioField'],\r\n    checkboxField: Row['checkboxField'],\r\n    noCheckboxSubtitle: boolean,\r\n    title: string | HTMLElement | DocumentFragment,\r\n    titleLangKey: LangPackKey,\r\n    titleRight: string | HTMLElement,\r\n    titleRightSecondary: string | HTMLElement,\r\n    clickable: boolean | ((e: Event) => void),\r\n    navigationTab: SliderSuperTab,\r\n    havePadding: boolean,\r\n    noRipple: boolean,\r\n    noWrap: boolean,\r\n    listenerSetter: ListenerSetter,\r\n    buttonRight?: HTMLElement | boolean,\r\n    buttonRightLangKey: LangPackKey\r\n  }> = {}) {\r\n    this.container = document.createElement(options.radioField || options.checkboxField ? 'label' : 'div');\r\n    this.container.classList.add('row');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add('row-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n    if(options.subtitle) {\r\n      if(typeof(options.subtitle) === 'string') {\r\n        setInnerHTML(this.subtitle, options.subtitle);\r\n      } else {\r\n        this.subtitle.append(options.subtitle);\r\n      }\r\n    } else if(options.subtitleLangKey) {\r\n      this.subtitle.append(i18n(options.subtitleLangKey, options.subtitleLangArgs));\r\n    }\r\n    this.container.append(this.subtitle);\r\n\r\n    let havePadding = !!options.havePadding;\r\n    if(options.radioField || options.checkboxField) {\r\n      if(options.radioField) {\r\n        this.radioField = options.radioField;\r\n        this.container.append(this.radioField.label);\r\n        havePadding = true;\r\n      }\r\n\r\n      if(options.checkboxField) {\r\n        this.checkboxField = options.checkboxField;\r\n\r\n        const isToggle = options.checkboxField.label.classList.contains('checkbox-field-toggle');\r\n        if(isToggle) {\r\n          this.container.classList.add('row-with-toggle');\r\n          options.titleRight = this.checkboxField.label;\r\n        } else {\r\n          havePadding = true;\r\n          this.container.append(this.checkboxField.label);\r\n        }\r\n\r\n        if(!options.noCheckboxSubtitle && !isToggle) {\r\n          const onChange = () => {\r\n            replaceContent(this.subtitle, i18n(this.checkboxField.input.checked ? 'Checkbox.Enabled' : 'Checkbox.Disabled'));\r\n          };\r\n\r\n          if(options.listenerSetter) options.listenerSetter.add(this.checkboxField.input)('change', onChange);\r\n          else this.checkboxField.input.addEventListener('change', onChange);\r\n        }\r\n      }\r\n\r\n      const i = options.radioField || options.checkboxField;\r\n      i.label.classList.add('disable-hover');\r\n    }\r\n\r\n    if(options.title || options.titleLangKey) {\r\n      let c: HTMLElement;\r\n      const titleRight = options.titleRight || options.titleRightSecondary;\r\n      if(titleRight) {\r\n        c = document.createElement('div');\r\n        c.classList.add('row-title-row');\r\n        this.container.append(c);\r\n      } else {\r\n        c = this.container;\r\n      }\r\n\r\n      this.title = document.createElement('div');\r\n      this.title.classList.add('row-title');\r\n      this.title.setAttribute('dir', 'auto');\r\n      if(options.noWrap) this.title.classList.add('no-wrap');\r\n      if(options.title) {\r\n        if(typeof(options.title) === 'string') {\r\n          this.title.innerHTML = options.title;\r\n        } else {\r\n          this.title.append(options.title);\r\n        }\r\n      } else {\r\n        this.title.append(i18n(options.titleLangKey));\r\n      }\r\n      c.append(this.title);\r\n\r\n      if(titleRight) {\r\n        const titleRightEl = this.titleRight = document.createElement('div');\r\n        titleRightEl.classList.add('row-title', 'row-title-right');\r\n\r\n        if(options.titleRightSecondary) {\r\n          titleRightEl.classList.add('row-title-right-secondary');\r\n        }\r\n\r\n        if(typeof(titleRight) === 'string') {\r\n          titleRightEl.innerHTML = titleRight;\r\n        } else {\r\n          titleRightEl.append(titleRight);\r\n        }\r\n\r\n        c.append(titleRightEl);\r\n      }\r\n    }\r\n\r\n    if(options.icon) {\r\n      havePadding = true;\r\n      this.title.classList.add('tgico', 'tgico-' + options.icon);\r\n      this.container.classList.add('row-with-icon');\r\n    }\r\n\r\n    if(havePadding) {\r\n      this.container.classList.add('row-with-padding');\r\n    }\r\n\r\n    if(options.navigationTab) {\r\n      options.clickable = () => options.navigationTab.open();\r\n    }\r\n\r\n    if(options.clickable || options.radioField || options.checkboxField) {\r\n      if(typeof(options.clickable) === 'function') {\r\n        attachClickEvent(this.container, (e) => {\r\n          if(this.freezed) return;\r\n          (options.clickable as any)(e);\r\n        }, {listenerSetter: options.listenerSetter});\r\n      }\r\n\r\n      this.container.classList.add('row-clickable', 'hover-effect');\r\n\r\n      if(!options.noRipple) {\r\n        ripple(this.container, undefined, undefined, true);\r\n      }\r\n\r\n      /* if(options.radioField || options.checkboxField) {\r\n        this.container.prepend(this.container.lastElementChild);\r\n      } */\r\n    }\r\n\r\n    if(options.buttonRight || options.buttonRightLangKey) {\r\n      this.buttonRight = options.buttonRight instanceof HTMLElement ?\r\n        options.buttonRight :\r\n        Button('btn-primary btn-color-primary', {text: options.buttonRightLangKey});\r\n      this.container.append(this.buttonRight);\r\n    }\r\n  }\r\n\r\n  public createMedia(size?: 'small') {\r\n    this.container.classList.add('row-with-padding');\r\n\r\n    const media = this.media = document.createElement('div');\r\n    media.classList.add('row-media');\r\n\r\n    if(size) {\r\n      media.classList.add('row-media-' + size);\r\n    }\r\n\r\n    this.container.append(media);\r\n\r\n    return media;\r\n  }\r\n}\r\n\r\nexport const RadioFormFromRows = (rows: Row[], onChange: (value: string) => void) => {\r\n  return RadioForm(rows.map((r) => ({container: r.container, input: r.radioField.input})), onChange);\r\n};\r\n\r\nexport const RadioFormFromValues = (values: {langPackKey: LangPackKey, value: number | string, checked?: boolean}[], onChange: Parameters<typeof RadioFormFromRows>[1]) => {\r\n  const name = 'name-' + (Math.random() * 0x7FFFFF | 0);\r\n  const rows = values.map(({langPackKey, value, checked}) => {\r\n    const row = new Row({\r\n      radioField: new RadioField({\r\n        langKey: langPackKey,\r\n        name,\r\n        value: '' + value\r\n      })\r\n    });\r\n\r\n    if(checked) {\r\n      row.radioField.checked = checked;\r\n    }\r\n\r\n    return row;\r\n  });\r\n\r\n  return RadioFormFromRows(rows, onChange);\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport {logger, LogTypes} from '../lib/logger';\r\nimport fastSmoothScroll, {ScrollOptions} from '../helpers/fastSmoothScroll';\r\nimport useHeavyAnimationCheck from '../hooks/useHeavyAnimationCheck';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {IS_ANDROID} from '../environment/userAgent';\r\n/*\r\nvar el = $0;\r\nvar height = 0;\r\nvar checkUp = false;\r\n\r\ndo {\r\n  height += el.scrollHeight;\r\n} while(el = (checkUp ? el.previousElementSibling : el.nextElementSibling));\r\nconsole.log(height);\r\n*/\r\n\r\n/*\r\nArray.from($0.querySelectorAll('.bubble-content')).forEach((_el) => {\r\n  //_el.style.display = '';\r\n  //return;\r\n\r\n  let el = _el.parentElement;\r\n  let height = el.scrollHeight;\r\n  let width = el.scrollWidth;\r\n  el.style.width = width + 'px';\r\n  el.style.height = height + 'px';\r\n  _el.style.display = 'none';\r\n});\r\n*/\r\n\r\n/* const scrollables: Map<HTMLElement, Scrollable> = new Map();\r\nconst scrollsIntersector = new IntersectionObserver((entries) => {\r\n  for(let entry of entries) {\r\n    const scrollable = scrollables.get(entry.target as HTMLElement);\r\n\r\n    if(entry.isIntersecting) {\r\n      scrollable.isVisible = true;\r\n    } else {\r\n      scrollable.isVisible = false;\r\n\r\n      if(!isInDOM(entry.target)) {\r\n        scrollsIntersector.unobserve(scrollable.container);\r\n        scrollables.delete(scrollable.container);\r\n      }\r\n    }\r\n  }\r\n}); */\r\n\r\nconst SCROLL_THROTTLE = IS_ANDROID ? 200 : 24;\r\n\r\nexport class ScrollableBase {\r\n  protected log: ReturnType<typeof logger>;\r\n\r\n  public splitUp: HTMLElement;\r\n  public onScrollMeasure: number = 0;\r\n\r\n  public lastScrollPosition: number = 0;\r\n  public lastScrollDirection: number = 0;\r\n\r\n  public onAdditionalScroll: () => void;\r\n  public onScrolledTop: () => void;\r\n  public onScrolledBottom: () => void;\r\n\r\n  public isHeavyAnimationInProgress = false;\r\n  protected needCheckAfterAnimation = false;\r\n\r\n  public checkForTriggers?: () => void;\r\n\r\n  public scrollProperty: 'scrollTop' | 'scrollLeft';\r\n\r\n  protected removeHeavyAnimationListener: () => void;\r\n  protected addedScrollListener: boolean;\r\n\r\n  constructor(public el: HTMLElement, logPrefix = '', public container: HTMLElement = document.createElement('div')) {\r\n    this.container.classList.add('scrollable');\r\n\r\n    this.log = logger('SCROLL' + (logPrefix ? '-' + logPrefix : ''), LogTypes.Error);\r\n\r\n    if(el) {\r\n      Array.from(el.children).forEach((c) => this.container.append(c));\r\n\r\n      el.append(this.container);\r\n    }\r\n    // this.onScroll();\r\n  }\r\n\r\n  public addScrollListener() {\r\n    if(this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = true;\r\n    this.container.addEventListener('scroll', this.onScroll, {passive: true, capture: true});\r\n  }\r\n\r\n  public removeScrollListener() {\r\n    if(!this.addedScrollListener) {\r\n      return;\r\n    }\r\n\r\n    this.addedScrollListener = false;\r\n    this.container.removeEventListener('scroll', this.onScroll, {capture: true});\r\n  }\r\n\r\n  public setListeners() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('resize', this.onScroll, {passive: true});\r\n    this.addScrollListener();\r\n\r\n    this.removeHeavyAnimationListener = useHeavyAnimationCheck(() => {\r\n      this.isHeavyAnimationInProgress = true;\r\n\r\n      if(this.onScrollMeasure) {\r\n        this.cancelMeasure();\r\n        this.needCheckAfterAnimation = true;\r\n      }\r\n    }, () => {\r\n      this.isHeavyAnimationInProgress = false;\r\n\r\n      if(this.needCheckAfterAnimation) {\r\n        this.onScroll();\r\n        this.needCheckAfterAnimation = false;\r\n      }\r\n    });\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!this.removeHeavyAnimationListener) {\r\n      return;\r\n    }\r\n\r\n    window.removeEventListener('resize', this.onScroll);\r\n    this.removeScrollListener();\r\n\r\n    this.removeHeavyAnimationListener();\r\n    this.removeHeavyAnimationListener = undefined;\r\n  }\r\n\r\n  public destroy() {\r\n    this.removeListeners();\r\n    this.onAdditionalScroll = undefined;\r\n    this.onScrolledTop = undefined;\r\n    this.onScrolledBottom = undefined;\r\n  }\r\n\r\n  public append(element: HTMLElement) {\r\n    this.container.append(element);\r\n  }\r\n\r\n  public scrollIntoViewNew(options: Omit<ScrollOptions, 'container'>) {\r\n    // return Promise.resolve();\r\n    // this.removeListeners();\r\n    return fastSmoothScroll({\r\n      ...options,\r\n      container: this.container\r\n    });/* .finally(() => {\r\n      this.setListeners();\r\n    }); */\r\n  }\r\n\r\n  public onScroll = () => {\r\n    // if(this.debug) {\r\n    // this.log('onScroll call', this.onScrollMeasure);\r\n    // }\r\n\r\n    // return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.cancelMeasure();\r\n      this.needCheckAfterAnimation = true;\r\n      return;\r\n    }\r\n\r\n    // if(this.onScrollMeasure || ((this.scrollLocked || (!this.onScrolledTop && !this.onScrolledBottom)) && !this.splitUp && !this.onAdditionalScroll)) return;\r\n    if((!this.onScrolledTop && !this.onScrolledBottom) && !this.splitUp && !this.onAdditionalScroll) return;\r\n    if(this.onScrollMeasure) return;\r\n    // if(this.onScrollMeasure) window.cancelAnimationFrame(this.onScrollMeasure);\r\n    // this.onScrollMeasure = window.requestAnimationFrame(() => {\r\n    this.onScrollMeasure = window.setTimeout(() => {\r\n      this.onScrollMeasure = 0;\r\n\r\n      const scrollPosition = this.container[this.scrollProperty];\r\n      this.lastScrollDirection = this.lastScrollPosition === scrollPosition ? 0 : (this.lastScrollPosition < scrollPosition ? 1 : -1); // * 1 - bottom, -1 - top\r\n      this.lastScrollPosition = scrollPosition;\r\n\r\n      // lastScrollDirection check is useless here, every callback should decide on its own\r\n      if(this.onAdditionalScroll/*  && this.lastScrollDirection !== 0 */) {\r\n        this.onAdditionalScroll();\r\n      }\r\n\r\n      if(this.checkForTriggers) {\r\n        this.checkForTriggers();\r\n      }\r\n    // });\r\n    }, SCROLL_THROTTLE);\r\n  };\r\n\r\n  public cancelMeasure() {\r\n    if(this.onScrollMeasure) {\r\n      // window.cancelAnimationFrame(this.onScrollMeasure);\r\n      clearTimeout(this.onScrollMeasure);\r\n      this.onScrollMeasure = 0;\r\n    }\r\n  }\r\n}\r\n\r\nexport type SliceSides = 'top' | 'bottom';\r\nexport type SliceSidesContainer = {[k in SliceSides]: boolean};\r\n\r\nexport default class Scrollable extends ScrollableBase {\r\n  public padding: HTMLElement;\r\n\r\n  public loadedAll: SliceSidesContainer = {top: true, bottom: false};\r\n\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, withPaddingContainer?: boolean) {\r\n    super(el, logPrefix);\r\n\r\n    /* if(withPaddingContainer) {\r\n      this.padding = document.createElement('div');\r\n      this.padding.classList.add('scrollable-padding');\r\n      Array.from(this.container.children).forEach((c) => this.padding.append(c));\r\n      this.container.append(this.padding);\r\n    } */\r\n\r\n    this.container.classList.add('scrollable-y');\r\n    this.setListeners();\r\n    this.scrollProperty = 'scrollTop';\r\n  }\r\n\r\n  public setVirtualContainer(el?: HTMLElement) {\r\n    this.splitUp = el;\r\n    this.log('setVirtualContainer:', el, this);\r\n  }\r\n\r\n  public checkForTriggers = () => {\r\n    if((!this.onScrolledTop && !this.onScrolledBottom)) return;\r\n\r\n    if(this.isHeavyAnimationInProgress) {\r\n      this.onScroll();\r\n      return;\r\n    }\r\n\r\n    const scrollHeight = this.container.scrollHeight;\r\n    if(!scrollHeight) { //         \r\n      return;\r\n    }\r\n\r\n    const clientHeight = this.container.clientHeight;\r\n    const maxScrollTop = scrollHeight - clientHeight;\r\n    const scrollTop = this.lastScrollPosition;\r\n\r\n    // this.log('checkForTriggers:', scrollTop, maxScrollTop);\r\n\r\n    if(this.onScrolledTop && scrollTop <= this.onScrollOffset && this.lastScrollDirection <= 0/* && direction === -1 */) {\r\n      this.onScrolledTop();\r\n    }\r\n\r\n    if(this.onScrolledBottom && (maxScrollTop - scrollTop) <= this.onScrollOffset && this.lastScrollDirection >= 0/* && direction === 1 */) {\r\n      this.onScrolledBottom();\r\n    }\r\n  };\r\n\r\n  public prepend(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).prepend(...elements);\r\n  }\r\n\r\n  public append(...elements: (HTMLElement | DocumentFragment)[]) {\r\n    (this.splitUp || this.padding || this.container).append(...elements);\r\n  }\r\n\r\n  public getDistanceToEnd() {\r\n    return this.scrollHeight - Math.round(this.scrollTop + this.container.offsetHeight);\r\n  }\r\n\r\n  get isScrolledDown() {\r\n    return this.getDistanceToEnd() <= 1;\r\n  }\r\n\r\n  set scrollTop(y: number) {\r\n    this.container.scrollTop = y;\r\n  }\r\n\r\n  get scrollTop() {\r\n    // this.log.trace('get scrollTop');\r\n    return this.container.scrollTop;\r\n  }\r\n\r\n  public setScrollTopSilently(value: number) {\r\n    this.lastScrollPosition = value;\r\n    this.ignoreNextScrollEvent();\r\n\r\n    this.scrollTop = value;\r\n  }\r\n\r\n  public ignoreNextScrollEvent() {\r\n    if(this.removeHeavyAnimationListener) {\r\n      this.removeScrollListener();\r\n      this.container.addEventListener('scroll', (e) => {\r\n        cancelEvent(e);\r\n        this.addScrollListener();\r\n      }, {capture: true, passive: false, once: true});\r\n    }\r\n  }\r\n\r\n  get scrollHeight() {\r\n    return this.container.scrollHeight;\r\n  }\r\n}\r\n\r\nexport class ScrollableX extends ScrollableBase {\r\n  constructor(el: HTMLElement, logPrefix = '', public onScrollOffset = 300, public splitCount = 15, public container: HTMLElement = document.createElement('div')) {\r\n    super(el, logPrefix, container);\r\n\r\n    this.container.classList.add('scrollable-x');\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const scrollHorizontally = (e: any) => {\r\n        if(!e.deltaX && this.container.scrollWidth > this.container.clientWidth) {\r\n          this.container.scrollLeft += e.deltaY / 4;\r\n          cancelEvent(e);\r\n        }\r\n      };\r\n\r\n      this.container.addEventListener('wheel', scrollHorizontally, {passive: false});\r\n    }\r\n\r\n    this.scrollProperty = 'scrollLeft';\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport I18n from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\ninterface OpenStreetMapInterface {\r\n  place_id?: number;\r\n  license?: string;\r\n  osm_type?: string;\r\n  osm_id?: number;\r\n  lat?: string;\r\n  lon?: string;\r\n  display_name: string;\r\n  address?: object;\r\n  boundingbox?: object;\r\n}\r\n\r\nexport default class AppNewGroupTab extends SliderSuperTab {\r\n  private avatarEdit: AvatarEdit;\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n  private peerIds: PeerId[];\r\n  private isGeoChat: boolean = false;\r\n  private nextBtn: HTMLButtonElement;\r\n  private groupNameInputField: InputField;\r\n  private list: HTMLUListElement;\r\n  private groupLocationInputField: InputField;\r\n  private userLocationCoords: {lat: number, long: number};\r\n  private userLocationAddress: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-group-container');\r\n    this.setTitle('NewGroup');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.groupNameInputField = new InputField({\r\n      label: 'CreateGroup.NameHolder',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.groupLocationInputField = new InputField({\r\n      label: 'ChatLocation',\r\n      name: 'location',\r\n      canBeEdited: false\r\n    });\r\n\r\n    inputWrapper.append(\r\n      this.groupNameInputField.container,\r\n      this.groupLocationInputField.container\r\n    );\r\n\r\n    this.listenerSetter.add(this.groupNameInputField.input)('input', () => {\r\n      const value = this.groupNameInputField.value;\r\n      let valueCheck = !!value.length && !this.groupNameInputField.input.classList.contains('error');\r\n      if(this.isGeoChat) valueCheck = valueCheck && !!this.userLocationCoords && !!this.userLocationAddress;\r\n      this.nextBtn.classList.toggle('is-visible', !!valueCheck);\r\n    });\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.groupNameInputField.value;\r\n\r\n      let promise: Promise<ChatId>;\r\n      if(this.isGeoChat) {\r\n        if(!this.userLocationAddress || !this.userLocationCoords) return;\r\n        promise = this.managers.appChatsManager.createChannel({\r\n          title,\r\n          about: '',\r\n          geo_point: {\r\n            _: 'inputGeoPoint',\r\n            ...this.userLocationCoords\r\n          },\r\n          address: this.userLocationAddress,\r\n          megagroup: true\r\n        }).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          if(this.peerIds.length) {\r\n            this.managers.appChatsManager.inviteToChannel(chatId, this.peerIds);\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      } else {\r\n        this.nextBtn.disabled = true;\r\n        promise = this.managers.appChatsManager.createChat(title, this.peerIds.map((peerId) => peerId.toUserId())).then((chatId) => {\r\n          if(this.uploadAvatar) {\r\n            this.uploadAvatar().then((inputFile) => {\r\n              this.managers.appChatsManager.editPhoto(chatId, inputFile);\r\n            });\r\n          }\r\n\r\n          return chatId;\r\n        });\r\n      }\r\n\r\n      if(!promise) {\r\n        return;\r\n      }\r\n\r\n      promise.then((chatId) => {\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        appSidebarLeft.selectTab(0);\r\n\r\n        appImManager.setInnerPeer({peerId: chatId.toPeerId(true)});\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const chatsSection = new SettingSection({\r\n      name: 'Members',\r\n      nameArgs: [this.peerIds.length]\r\n    });\r\n\r\n    const list = this.list = appDialogsManager.createChatList({\r\n      new: true\r\n    });\r\n\r\n    chatsSection.content.append(list);\r\n\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.append(section.container, chatsSection.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.groupNameInputField.value = '';\r\n    this.groupLocationInputField.container.classList.add('hide');\r\n    this.nextBtn.disabled = false;\r\n  }\r\n\r\n  public open(peerIds: PeerId[], isGeoChat: boolean = false) {\r\n    this.isGeoChat = isGeoChat;\r\n    this.peerIds = peerIds;\r\n    const result = super.open();\r\n    result.then(() => {\r\n      if(isGeoChat) {\r\n        this.setTitle('NearbyCreateGroup');\r\n        this.groupLocationInputField.container.classList.remove('hide');\r\n        this.groupLocationInputField.setValueSilently(I18n.format('Loading', true));\r\n        this.startLocating();\r\n      } else {\r\n        this.groupLocationInputField.container.classList.add('hide');\r\n      }\r\n\r\n      return Promise.all(this.peerIds.map(async(userId) => {\r\n        const {dom} = appDialogsManager.addDialogNew({\r\n          peerId: userId,\r\n          container: this.list,\r\n          rippleEnabled: false,\r\n          avatarSize: 48\r\n        });\r\n\r\n        dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(userId)));\r\n      }));\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startLocating() {\r\n    navigator.geolocation.getCurrentPosition((location) => {\r\n      this.userLocationCoords = {\r\n        lat: location.coords.latitude,\r\n        long: location.coords.longitude\r\n      };\r\n\r\n      let uri = 'https://nominatim.openstreetmap.org/reverse';\r\n      uri += '?lat='+location.coords.latitude;\r\n      uri += '&lon='+location.coords.longitude;\r\n      uri += '&format=json';\r\n      uri += '&addressdetails=1';\r\n      uri += '&accept-language=en';\r\n      fetch(uri)\r\n      .then((response) => response.json())\r\n      .then((response: OpenStreetMapInterface) => {\r\n        this.userLocationAddress = response.display_name;\r\n        this.groupLocationInputField.setValueSilently(response.display_name);\r\n      });\r\n    }, (error) => {\r\n      if(error instanceof GeolocationPositionError) {\r\n        this.groupLocationInputField.setValueSilently('Location permission denied. Please retry later.');\r\n      } else {\r\n        this.groupLocationInputField.setValueSilently('An error has occurred. Please retry later.');\r\n      }\r\n    });\r\n  }\r\n}\r\n","enum PrivacyType {\n  Everybody = 2,\n  Contacts = 1,\n  Nobody = 0\n}\n\nexport default PrivacyType;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PrivacyRule} from '../../../../layer';\nimport PrivacyType from './privacyType';\n\nexport default function getPrivacyRulesDetails(rules: PrivacyRule[]) {\n  const types: PrivacyType[] = [];\n\n  type peers = {users: UserId[], chats: ChatId[]};\n  const allowPeers: peers = {users: [], chats: []}, disallowPeers: peers = {users: [], chats: []};\n  rules.forEach((rule) => {\n    switch(rule._) {\n      case 'privacyValueAllowAll':\n        types.push(2);\n        break;\n      case 'privacyValueDisallowAll':\n        types.push(0);\n        break;\n      case 'privacyValueAllowContacts':\n        types.push(1);\n        break;\n      /* case 'privacyValueDisallowContacts':\n        types.push('Except My Contacts');\n        break; */\n      case 'privacyValueAllowChatParticipants':\n        allowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueAllowUsers':\n        allowPeers.users.push(...rule.users);\n        break;\n      case 'privacyValueDisallowChatParticipants':\n        disallowPeers.chats.push(...rule.chats);\n        break;\n      case 'privacyValueDisallowUsers':\n        disallowPeers.users.push(...rule.users);\n        break;\n    }\n  });\n\n  return {type: types[0], disallowPeers, allowPeers};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {randomLong} from '../helpers/random';\r\nimport {InputPrivacyKey, InputPrivacyRule} from '../layer';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport getPrivacyRulesDetails from '../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../lib/appManagers/utils/privacy/privacyType';\r\nimport {i18n, join, LangPackKey, _i18n} from '../lib/langPack';\r\nimport RadioField from './radioField';\r\nimport Row, {RadioFormFromRows} from './row';\r\nimport Scrollable from './scrollable';\r\nimport {SettingSection, generateSection} from './sidebarLeft';\r\nimport AppAddMembersTab from './sidebarLeft/tabs/addMembers';\r\nimport {SliderSuperTabEventable} from './sliderTab';\r\n\r\nexport type PrivacySectionStr = LangPackKey | '' | HTMLElement;\r\nexport default class PrivacySection {\r\n  public radioRows: Map<PrivacyType, Row>;\r\n  public radioSection: SettingSection;\r\n  public exceptions: Map<keyof PrivacySection['peerIds'], {\r\n    titleLangKey: LangPackKey,\r\n    key: keyof PrivacySection['peerIds'],\r\n    row: Row,\r\n    icon: string,\r\n    subtitleLangKey: LangPackKey,\r\n    clickable: true\r\n  }>;\r\n  public peerIds: {\r\n    disallow?: PeerId[],\r\n    allow?: PeerId[]\r\n  };\r\n  public type: PrivacyType;\r\n\r\n  constructor(public options: {\r\n    tab: SliderSuperTabEventable,\r\n    title: LangPackKey,\r\n    inputKey: InputPrivacyKey['_'],\r\n    captions?: [PrivacySectionStr, PrivacySectionStr, PrivacySectionStr],\r\n    appendTo?: Scrollable,\r\n    noExceptions?: boolean,\r\n    onRadioChange?: (value: number) => any,\r\n    skipTypes?: PrivacyType[],\r\n    exceptionTexts?: [LangPackKey, LangPackKey],\r\n    managers: AppManagers\r\n  }) {\r\n    if(options.captions) {\r\n      options.captions.reverse();\r\n    }\r\n\r\n    const managers = options.managers;\r\n\r\n    this.radioSection = new SettingSection({name: options.title, caption: true});\r\n\r\n    this.radioRows = new Map();\r\n\r\n    let r: Array<{type: PrivacyType, langKey: LangPackKey}> = [{\r\n      type: PrivacyType.Everybody,\r\n      langKey: 'PrivacySettingsController.Everbody'\r\n    }, {\r\n      type: PrivacyType.Contacts,\r\n      langKey: 'PrivacySettingsController.MyContacts'\r\n    }, {\r\n      type: PrivacyType.Nobody,\r\n      langKey: 'PrivacySettingsController.Nobody'\r\n    }];\r\n\r\n    if(options.skipTypes) {\r\n      r = r.filter((r) => !options.skipTypes.includes(r.type));\r\n    }\r\n\r\n    const random = randomLong();\r\n    r.forEach(({type, langKey}) => {\r\n      const row = new Row({\r\n        radioField: new RadioField({\r\n          langKey,\r\n          name: random,\r\n          value: '' + type\r\n        })\r\n      });\r\n\r\n      this.radioRows.set(type, row);\r\n    });\r\n\r\n    const form = RadioFormFromRows([...this.radioRows.values()], this.onRadioChange);\r\n\r\n    this.radioSection.content.append(form);\r\n    if(options.appendTo) {\r\n      options.appendTo.append(this.radioSection.container);\r\n    }\r\n\r\n    if(!options.noExceptions) {\r\n      const container = generateSection(options.appendTo, 'PrivacyExceptions', 'PrivacySettingsController.PeerInfo');\r\n\r\n      this.exceptions = new Map([[\r\n        'disallow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[0],\r\n          key: 'disallow',\r\n          row: null,\r\n          icon: 'deleteuser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ], [\r\n        'allow',\r\n        {\r\n          titleLangKey: options.exceptionTexts[1],\r\n          key: 'allow',\r\n          row: null,\r\n          icon: 'adduser',\r\n          subtitleLangKey: 'PrivacySettingsController.AddUsers',\r\n          clickable: true\r\n        }\r\n      ]]);\r\n\r\n      this.exceptions.forEach((exception) => {\r\n        exception.row = new Row(exception);\r\n\r\n        exception.row.container.addEventListener('click', () => {\r\n          promise.then(() => {\r\n            const _peerIds = this.peerIds[exception.key];\r\n            options.tab.slider.createTab(AppAddMembersTab).open({\r\n              type: 'privacy',\r\n              skippable: true,\r\n              title: exception.titleLangKey,\r\n              placeholder: 'PrivacyModal.Search.Placeholder',\r\n              takeOut: (newPeerIds) => {\r\n                _peerIds.length = 0;\r\n                _peerIds.push(...newPeerIds);\r\n                exception.row.subtitle.innerHTML = '';\r\n                exception.row.subtitle.append(...this.generateStr(this.splitPeersByType(newPeerIds)));\r\n              },\r\n              selectedPeerIds: _peerIds\r\n            });\r\n          });\r\n        });\r\n\r\n        container.append(exception.row.container);\r\n      });\r\n    }\r\n\r\n    /* setTimeout(() => {\r\n      this.setRadio(PrivacyType.Contacts);\r\n    }, 0); */\r\n\r\n    const promise = managers.appPrivacyManager.getPrivacy(options.inputKey).then((rules) => {\r\n      const details = getPrivacyRulesDetails(rules);\r\n      this.setRadio(details.type);\r\n\r\n      if(this.exceptions) {\r\n        this.peerIds = {};\r\n        ['allow' as const, 'disallow' as const].forEach((k) => {\r\n          const arr = [];\r\n          const from = k === 'allow' ? details.allowPeers : details.disallowPeers;\r\n          arr.push(...from.users.map((id) => id.toPeerId()));\r\n          arr.push(...from.chats.map((id) => id.toPeerId(true)));\r\n          this.peerIds[k] = arr;\r\n          const s = this.exceptions.get(k).row.subtitle;\r\n          s.innerHTML = '';\r\n          s.append(...this.generateStr(from));\r\n        });\r\n      }\r\n\r\n      options.tab.eventListener.addEventListener('destroy', async() => {\r\n        const rules: InputPrivacyRule[] = [];\r\n\r\n        switch(this.type) {\r\n          case PrivacyType.Everybody:\r\n            rules.push({_: 'inputPrivacyValueAllowAll'});\r\n            break;\r\n          case PrivacyType.Contacts:\r\n            rules.push({_: 'inputPrivacyValueAllowContacts'});\r\n            break;\r\n          case PrivacyType.Nobody:\r\n            rules.push({_: 'inputPrivacyValueDisallowAll'});\r\n            break;\r\n        }\r\n\r\n        if(this.exceptions) {\r\n          const a = ([\r\n            ['allow',     'inputPrivacyValueAllowChatParticipants',     'inputPrivacyValueAllowUsers'],\r\n            ['disallow',  'inputPrivacyValueDisallowChatParticipants',  'inputPrivacyValueDisallowUsers']\r\n          ] as Array<[\r\n            'allow' | 'disallow',\r\n            'inputPrivacyValueAllowChatParticipants' | 'inputPrivacyValueDisallowChatParticipants',\r\n            'inputPrivacyValueAllowUsers' | 'inputPrivacyValueDisallowUsers'\r\n          ]>);\r\n          for(const [k, chatKey, usersKey] of a) {\r\n            if(this.exceptions.get(k).row.container.classList.contains('hide')) {\r\n              continue;\r\n            }\r\n\r\n            const _peerIds = this.peerIds[k];\r\n            if(_peerIds) {\r\n              const splitted = this.splitPeersByType(_peerIds);\r\n              if(splitted.chats.length) {\r\n                rules.push({_: chatKey, chats: splitted.chats});\r\n              }\r\n\r\n              if(splitted.users.length) {\r\n                rules.push({\r\n                  _: usersKey,\r\n                  users: await Promise.all(splitted.users.map((id) => managers.appUsersManager.getUserInput(id)))\r\n                });\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        managers.appPrivacyManager.setPrivacy(options.inputKey, rules);\r\n      }, {once: true});\r\n    });\r\n  }\r\n\r\n  private onRadioChange = (value: string | PrivacySection['type']) => {\r\n    value = +value as PrivacySection['type'];\r\n    this.type = value;\r\n\r\n    const caption = this.options.captions[this.type];\r\n    const captionElement = this.radioSection.caption;\r\n    if(!caption) {\r\n      captionElement.innerHTML = '';\r\n    } else if(caption instanceof HTMLElement) {\r\n      replaceContent(captionElement, caption);\r\n    } else {\r\n      _i18n(captionElement, caption);\r\n    }\r\n    captionElement.classList.toggle('hide', !caption);\r\n\r\n    if(this.exceptions) {\r\n      this.exceptions.get('allow').row.container.classList.toggle('hide', this.type === PrivacyType.Everybody);\r\n      this.exceptions.get('disallow').row.container.classList.toggle('hide', this.type === PrivacyType.Nobody);\r\n    }\r\n\r\n    this.options.onRadioChange && this.options.onRadioChange(value);\r\n  };\r\n\r\n  public setRadio(type: PrivacySection['type']) {\r\n    const row = this.radioRows.get(type);\r\n    this.onRadioChange(type);\r\n    row.radioField.input.checked = true;\r\n  }\r\n\r\n  private splitPeersByType(peerIds: PeerId[]) {\r\n    const peers = {users: [] as UserId[], chats: [] as ChatId[]};\r\n    peerIds.forEach((peerId) => {\r\n      peers[peerId.isAnyChat() ? 'chats' : 'users'].push(peerId.isAnyChat() ? peerId.toChatId() : peerId);\r\n    });\r\n\r\n    return peers;\r\n  }\r\n\r\n  private generateStr(peers: {users: UserId[], chats: ChatId[]}) {\r\n    if(!peers.users.length && !peers.chats.length) {\r\n      return [i18n('PrivacySettingsController.AddUsers')];\r\n    }\r\n\r\n    return join([\r\n      peers.users.length ? i18n('Users', [peers.users.length]) : null,\r\n      peers.chats.length ? i18n('Chats', [peers.chats.length]) : null\r\n    ].filter(Boolean), false);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {i18n, LangPackKey} from '../../../../lib/langPack';\r\nimport anchorCopy from '../../../../helpers/dom/anchorCopy';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyPhoneNumberTab extends SliderSuperTabEventable {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-phone-number');\r\n    this.setTitle('PrivacyPhone');\r\n\r\n    const formatted = '+' + (await this.managers.appUsersManager.getSelf()).phone;\r\n    const captionEl = document.createElement('div');\r\n    captionEl.append(\r\n      i18n('PrivacyPhoneInfo'),\r\n      document.createElement('br'),\r\n      document.createElement('br'),\r\n      i18n('PrivacyPhoneInfo4'),\r\n      document.createElement('br'),\r\n      anchorCopy({\r\n        mePath: formatted\r\n      })\r\n    );\r\n\r\n    const phoneSection = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle',\r\n      inputKey: 'inputPrivacyKeyPhoneNumber',\r\n      captions: [captionEl, captionEl, ''],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      onRadioChange: (type) => {\r\n        s.setRadio(PrivacyType.Everybody);\r\n        s.radioSection.container.classList.toggle('hide', type !== PrivacyType.Nobody);\r\n      },\r\n      managers: this.managers\r\n    });\r\n\r\n    const sCaption: LangPackKey = 'PrivacyPhoneInfo3';\r\n    const s = new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyPhoneTitle2',\r\n      inputKey: 'inputPrivacyKeyAddedByPhone',\r\n      captions: [sCaption, sCaption, ''],\r\n      noExceptions: true,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n\r\n    this.scrollable.container.insertBefore(s.radioSection.container, phoneSection.radioSection.container.nextSibling);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {toastNew} from '../../components/toast';\nimport {copyTextToClipboard} from '../clipboard';\nimport cancelEvent from './cancelEvent';\nimport {attachClickEvent} from './clickEvent';\n\nexport default function anchorCopy(options: Partial<{\n  // href: string,\n  mePath: string\n}> = {}) {\n  const anchor = document.createElement('a');\n  anchor.classList.add('anchor-copy');\n\n  if(options.mePath) {\n    const href = 'https://t.me/' + options.mePath;\n    anchor.href = anchor.innerText = href;\n  }\n\n  attachClickEvent(anchor, (e) => {\n    cancelEvent(e);\n    copyTextToClipboard(anchor.href);\n    toastNew({langPackKey: 'LinkCopied'});\n  });\n\n  return anchor;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\n\r\nexport default class AppTwoStepVerificationSetTab extends SliderSuperTab {\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-set');\r\n    this.setTitle('TwoStepVerificationPasswordSet');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: 'TwoStepVerificationPasswordSetInfo',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      emoji,\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const btnReturn = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationPasswordReturnSettings'});\r\n\r\n    attachClickEvent(btnReturn, (e) => {\r\n      this.close();\r\n    });\r\n\r\n    this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n\r\n    inputWrapper.append(btnReturn);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\n\r\nexport function canFocus(isFirstInput: boolean) {\r\n  return !IS_MOBILE_SAFARI || !isFirstInput;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport CodeInputField from '../../../codeInputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport {i18n, _i18n} from '../../../../lib/langPack';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport toggleDisability from '../../../../helpers/dom/toggleDisability';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailConfirmationTab extends SliderSuperTab {\r\n  public codeInputField: CodeInputField;\r\n  public state: AccountPassword;\r\n  public email: string;\r\n  public length: number;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email-confirmation');\r\n    this.setTitle('TwoStepAuth.RecoveryTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    _i18n(section.caption, 'TwoStepAuth.ConfirmEmailCodeDesc', [this.email]);\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.codeInputField = new CodeInputField({\r\n      name: 'recovery-email-code',\r\n      label: 'TwoStepAuth.RecoveryCode',\r\n      length: this.length,\r\n      onFill: (code) => {\r\n        freeze(true);\r\n\r\n        this.managers.passwordManager.confirmPasswordEmail('' + code)\r\n        .then((value) => {\r\n          if(!value) {\r\n\r\n          }\r\n\r\n          goNext();\r\n        })\r\n        .catch((err) => {\r\n          switch(err.type) {\r\n            case 'CODE_INVALID':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeInvalid'));\r\n              break;\r\n\r\n            case 'EMAIL_HASH_EXPIRED':\r\n              inputField.input.classList.add('error');\r\n              replaceContent(inputField.label, i18n('TwoStepAuth.RecoveryCodeExpired'));\r\n              break;\r\n\r\n            default:\r\n              console.error('confirm error', err);\r\n              break;\r\n          }\r\n\r\n          freeze(false);\r\n        });\r\n      }\r\n    });\r\n\r\n    const btnChange = Button('btn-primary btn-primary-transparent primary', {text: 'TwoStepAuth.EmailCodeChangeEmail'});\r\n    const btnResend = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'ResendCode'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const freeze = (disable: boolean) => {\r\n      toggleDisability([inputField.input, btnChange, btnResend], disable);\r\n    };\r\n\r\n    attachClickEvent(btnChange, (e) => {\r\n      freeze(true);\r\n      this.managers.passwordManager.cancelPasswordEmail().then((value) => {\r\n        this.slider.sliceTabsUntilTab(AppTwoStepVerificationEmailTab, this);\r\n        this.close();\r\n      }, () => {\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    attachClickEvent(btnResend, (e) => {\r\n      freeze(true);\r\n      const d = putPreloader(btnResend);\r\n      this.managers.passwordManager.resendPasswordEmail().then((value) => {\r\n        d.remove();\r\n        freeze(false);\r\n      });\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnChange, btnResend);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.codeInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport AppTwoStepVerificationSetTab from './passwordSet';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './emailConfirmation';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport matchEmail from '../../../../lib/richTextProcessor/matchEmail';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationEmailTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n  public hint: string;\r\n  public isFirst = false;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-email');\r\n    this.setTitle('RecoveryEmailTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputContent = section.generateContentElement();\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'recovery-email',\r\n      label: 'RecoveryEmail',\r\n      plainText: true\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    inputField.input.addEventListener('input', (e) => {\r\n      inputField.input.classList.remove('error');\r\n    });\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const goNext = () => {\r\n      this.slider.createTab(AppTwoStepVerificationSetTab).open();\r\n    };\r\n\r\n    const onContinueClick = () => {\r\n      const email = inputField.value.trim();\r\n      const match = matchEmail(email);\r\n      if(!match || match[0].length !== email.length) {\r\n        inputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      toggleButtons(true);\r\n      const d = putPreloader(btnContinue);\r\n\r\n      this.managers.passwordManager.updateSettings({\r\n        hint: this.hint,\r\n        currentPassword: this.plainPassword,\r\n        newPassword: this.newPassword,\r\n        email\r\n      }).then((value) => {\r\n        goNext();\r\n      }, (err) => {\r\n        if(err.type.includes('EMAIL_UNCONFIRMED')) {\r\n          const symbols = +err.type.match(/^EMAIL_UNCONFIRMED_(\\d+)/)[1];\r\n\r\n          const tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n          tab.state = this.state;\r\n          tab.email = email;\r\n          tab.length = symbols;\r\n          tab.open();\r\n        } else {\r\n          console.log('password set error', err);\r\n        }\r\n\r\n        toggleButtons(false);\r\n        d.remove();\r\n      });\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    const toggleButtons = (freeze: boolean) => {\r\n      if(freeze) {\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        btnSkip.setAttribute('disabled', 'true');\r\n      } else {\r\n        btnContinue.removeAttribute('disabled');\r\n        btnSkip.removeAttribute('disabled');\r\n      }\r\n    };\r\n\r\n    attachClickEvent(btnSkip, (e) => {\r\n      const popup = new PopupPeer('popup-skip-email', {\r\n        buttons: [{\r\n          langKey: 'Cancel',\r\n          isCancel: true\r\n        }, {\r\n          langKey: 'YourEmailSkip',\r\n          callback: () => {\r\n            // inputContent.classList.add('sidebar-left-section-disabled');\r\n            toggleButtons(true);\r\n            putPreloader(btnSkip);\r\n            this.managers.passwordManager.updateSettings({\r\n              hint: this.hint,\r\n              currentPassword: this.plainPassword,\r\n              newPassword: this.newPassword,\r\n              email: ''\r\n            }).then(() => {\r\n              goNext();\r\n            }, (err) => {\r\n              toggleButtons(false);\r\n            });\r\n          },\r\n          isDanger: true\r\n        }],\r\n        titleLangKey: 'YourEmailSkipWarning',\r\n        descriptionLangKey: 'YourEmailSkipWarningText'\r\n      });\r\n\r\n      popup.show();\r\n    });\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    inputContent.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport InputField from '../../../inputField';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport {toast} from '../../../toast';\r\nimport I18n from '../../../../lib/langPack';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\n\r\nexport default class AppTwoStepVerificationHintTab extends SliderSuperTab {\r\n  public inputField: InputField;\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-hint');\r\n    this.setTitle('TwoStepAuth.SetupHintTitle');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 160,\r\n      height: 160,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const inputField = this.inputField = new InputField({\r\n      name: 'hint',\r\n      label: 'TwoStepAuth.SetupHintPlaceholder'\r\n    });\r\n\r\n    inputField.input.addEventListener('keypress', (e) => {\r\n      if(e.key === 'Enter') {\r\n        cancelEvent(e);\r\n        return inputField.value ? onContinueClick() : onSkipClick();\r\n      }\r\n    });\r\n\r\n    const goNext = (e?: Event, saveHint?: boolean) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      const hint = saveHint ? inputField.value : undefined;\r\n      if(hint && this.newPassword === hint) {\r\n        toast(I18n.format('PasswordAsHintError', true));\r\n        return;\r\n      }\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.hint = hint;\r\n\r\n      tab.open();\r\n    };\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n    const btnSkip = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'YourEmailSkip'});\r\n\r\n    const onContinueClick = (e?: Event) => goNext(e, true);\r\n    const onSkipClick = (e?: Event) => goNext(e, false);\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n    attachClickEvent(btnSkip, onSkipClick);\r\n\r\n    inputWrapper.append(inputField.container, btnContinue, btnSkip);\r\n\r\n    section.content.append(inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.inputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport Button from '../../../button';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport TrackingMonkey from '../../../monkeys/tracking';\r\nimport AppTwoStepVerificationHintTab from './hint';\r\nimport {InputState} from '../../../inputField';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppTwoStepVerificationReEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public newPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password', 'two-step-verification-re-enter-password');\r\n    this.setTitle('PleaseReEnterPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 're-enter-password',\r\n      label: 'PleaseReEnterPassword'\r\n    });\r\n\r\n    const monkey = new TrackingMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary', {text: 'Continue'});\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(this.newPassword !== passwordInputField.value) {\r\n        passwordInputField.setError();\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    const onContinueClick = (e?: Event) => {\r\n      if(e) {\r\n        cancelEvent(e);\r\n      }\r\n\r\n      if(!verifyInput()) return;\r\n\r\n      const tab = this.slider.createTab(AppTwoStepVerificationHintTab);\r\n      tab.state = this.state;\r\n      tab.plainPassword = this.plainPassword;\r\n      tab.newPassword = this.newPassword;\r\n      tab.open();\r\n    };\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AppTwoStepVerificationTab from '.';\r\nimport {SettingSection} from '../..';\r\nimport cancelEvent from '../../../../helpers/dom/cancelEvent';\r\nimport {canFocus} from '../../../../helpers/dom/canFocus';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport replaceContent from '../../../../helpers/dom/replaceContent';\r\nimport setInnerHTML from '../../../../helpers/dom/setInnerHTML';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport I18n, {i18n} from '../../../../lib/langPack';\r\nimport wrapEmojiText from '../../../../lib/richTextProcessor/wrapEmojiText';\r\nimport Button from '../../../button';\r\nimport {putPreloader} from '../../../putPreloader';\r\nimport PasswordMonkey from '../../../monkeys/password';\r\nimport PasswordInputField from '../../../passwordInputField';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport AppTwoStepVerificationReEnterPasswordTab from './reEnterPassword';\r\n\r\nexport default class AppTwoStepVerificationEnterPasswordTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public passwordInputField: PasswordInputField;\r\n  public plainPassword: string;\r\n  public isFirst = true;\r\n\r\n  protected init() {\r\n    const isNew = !this.state.pFlags.has_password || this.plainPassword;\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-enter-password');\r\n    this.setTitle(isNew ? 'PleaseEnterFirstPassword' : 'PleaseEnterCurrentPassword');\r\n\r\n    const section = new SettingSection({\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const passwordInputField = this.passwordInputField = new PasswordInputField({\r\n      name: 'enter-password',\r\n      label: isNew ? 'PleaseEnterFirstPassword' : (this.state.hint ? undefined : 'LoginPassword'),\r\n      labelText: !isNew && this.state.hint ? wrapEmojiText(this.state.hint) : undefined\r\n    });\r\n\r\n    const monkey = new PasswordMonkey(passwordInputField, 157);\r\n\r\n    const btnContinue = Button('btn-primary btn-color-primary');\r\n    const textEl = new I18n.IntlElement({key: 'Continue'});\r\n\r\n    btnContinue.append(textEl.element);\r\n\r\n    inputWrapper.append(passwordInputField.container, btnContinue);\r\n    section.content.append(monkey.container, inputWrapper);\r\n\r\n    this.scrollable.container.append(section.container);\r\n\r\n    passwordInputField.input.addEventListener('keypress', (e) => {\r\n      if(passwordInputField.input.classList.contains('error')) {\r\n        passwordInputField.input.classList.remove('error');\r\n        textEl.key = 'Continue';\r\n        textEl.update();\r\n      }\r\n\r\n      if(e.key === 'Enter') {\r\n        return onContinueClick();\r\n      }\r\n    });\r\n\r\n    const verifyInput = () => {\r\n      if(!passwordInputField.value.length) {\r\n        passwordInputField.input.classList.add('error');\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    };\r\n\r\n    let onContinueClick: (e?: Event) => void;\r\n    if(!isNew) {\r\n      let getStateInterval: number;\r\n\r\n      const getState = () => {\r\n        // * just to check session relevance\r\n        if(!getStateInterval) {\r\n          getStateInterval = window.setInterval(getState, 10e3);\r\n        }\r\n\r\n        return this.managers.passwordManager.getState().then((_state) => {\r\n          this.state = _state;\r\n\r\n          if(this.state.hint) {\r\n            setInnerHTML(passwordInputField.label, wrapEmojiText(this.state.hint));\r\n          } else {\r\n            replaceContent(passwordInputField.label, i18n('LoginPassword'));\r\n          }\r\n        });\r\n      };\r\n\r\n      const submit = (e?: Event) => {\r\n        if(!verifyInput()) {\r\n          cancelEvent(e);\r\n          return;\r\n        }\r\n\r\n        btnContinue.setAttribute('disabled', 'true');\r\n        textEl.key = 'PleaseWait';\r\n        textEl.update();\r\n        const preloader = putPreloader(btnContinue);\r\n\r\n        const plainPassword = passwordInputField.value;\r\n        this.managers.passwordManager.check(passwordInputField.value, this.state).then((auth) => {\r\n          console.log(auth);\r\n\r\n          if(auth._ === 'auth.authorization') {\r\n            clearInterval(getStateInterval);\r\n            if(monkey) monkey.remove();\r\n            const tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n            tab.state = this.state;\r\n            tab.plainPassword = plainPassword;\r\n            tab.open();\r\n            this.slider.removeTabFromHistory(this);\r\n          }\r\n        }, (err) => {\r\n          btnContinue.removeAttribute('disabled');\r\n          passwordInputField.input.classList.add('error');\r\n\r\n          switch(err.type) {\r\n            default:\r\n              // btnContinue.innerText = err.type;\r\n              textEl.key = 'PASSWORD_HASH_INVALID';\r\n              textEl.update();\r\n              preloader.remove();\r\n              passwordInputField.select();\r\n              break;\r\n          }\r\n\r\n          getState();\r\n        });\r\n      };\r\n\r\n      onContinueClick = submit;\r\n\r\n      getState();\r\n    } else {\r\n      onContinueClick = (e) => {\r\n        if(e) {\r\n          cancelEvent(e);\r\n        }\r\n\r\n        if(!verifyInput()) return;\r\n\r\n        const tab = this.slider.createTab(AppTwoStepVerificationReEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.newPassword = passwordInputField.value;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      };\r\n    }\r\n\r\n    attachClickEvent(btnContinue, onContinueClick);\r\n\r\n    return monkey.load();\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    if(!canFocus(this.isFirst)) return;\r\n    this.passwordInputField.input.focus();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '../..';\r\nimport {attachClickEvent} from '../../../../helpers/dom/clickEvent';\r\nimport {AccountPassword} from '../../../../layer';\r\nimport {_i18n} from '../../../../lib/langPack';\r\nimport Button from '../../../button';\r\nimport PopupPeer from '../../../popups/peer';\r\nimport {SliderSuperTab} from '../../../slider';\r\nimport wrapStickerEmoji from '../../../wrappers/stickerEmoji';\r\nimport AppSettingsTab from '../settings';\r\nimport AppTwoStepVerificationEmailTab from './email';\r\nimport AppTwoStepVerificationEnterPasswordTab from './enterPassword';\r\n\r\nexport default class AppTwoStepVerificationTab extends SliderSuperTab {\r\n  public state: AccountPassword;\r\n  public plainPassword: string;\r\n\r\n  protected init() {\r\n    this.container.classList.add('two-step-verification', 'two-step-verification-main');\r\n    this.setTitle('TwoStepVerificationTitle');\r\n\r\n    const section = new SettingSection({\r\n      captionOld: true,\r\n      noDelimiter: true\r\n    });\r\n\r\n    const emoji = '';\r\n    const stickerContainer = document.createElement('div');\r\n\r\n    wrapStickerEmoji({\r\n      div: stickerContainer,\r\n      width: 168,\r\n      height: 168,\r\n      emoji\r\n    });\r\n\r\n    section.content.append(stickerContainer);\r\n\r\n    const c = section.generateContentElement();\r\n    if(this.state.pFlags.has_password) {\r\n      _i18n(section.caption, 'TwoStepAuth.GenericHelp');\r\n\r\n      const btnChangePassword = Button('btn-primary btn-transparent', {icon: 'edit', text: 'TwoStepAuth.ChangePassword'});\r\n      const btnDisablePassword = Button('btn-primary btn-transparent', {icon: 'passwordoff', text: 'TwoStepAuth.RemovePassword'});\r\n      const btnSetRecoveryEmail = Button('btn-primary btn-transparent', {icon: 'email', text: this.state.pFlags.has_recovery ? 'TwoStepAuth.ChangeEmail' : 'TwoStepAuth.SetupEmail'});\r\n\r\n      attachClickEvent(btnChangePassword, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.open();\r\n      });\r\n\r\n      attachClickEvent(btnDisablePassword, () => {\r\n        const popup = new PopupPeer('popup-disable-password', {\r\n          buttons: [{\r\n            langKey: 'Disable',\r\n            callback: () => {\r\n              this.managers.passwordManager.updateSettings({currentPassword: this.plainPassword}).then(() => {\r\n                this.slider.sliceTabsUntilTab(AppSettingsTab, this);\r\n                this.close();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'TurnPasswordOffQuestionTitle',\r\n          descriptionLangKey: 'TurnPasswordOffQuestion'\r\n        });\r\n\r\n        popup.show();\r\n      });\r\n\r\n      attachClickEvent(btnSetRecoveryEmail, () => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEmailTab);\r\n        tab.state = this.state;\r\n        tab.hint = this.state.hint;\r\n        tab.plainPassword = this.plainPassword;\r\n        tab.newPassword = this.plainPassword;\r\n        tab.isFirst = true;\r\n        tab.open();\r\n      });\r\n\r\n      c.append(btnChangePassword, btnDisablePassword, btnSetRecoveryEmail);\r\n    } else {\r\n      _i18n(section.caption, 'TwoStepAuth.SetPasswordHelp');\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const btnSetPassword = Button('btn-primary btn-color-primary', {text: 'TwoStepVerificationSetPassword'});\r\n\r\n      inputWrapper.append(btnSetPassword);\r\n      c.append(inputWrapper);\r\n\r\n      attachClickEvent(btnSetPassword, (e) => {\r\n        const tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n        tab.state = this.state;\r\n        tab.open();\r\n      });\r\n    }\r\n\r\n    this.scrollable.container.append(section.container);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyLastSeenTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-last-seen');\r\n    this.setTitle('PrivacyLastSeen');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.LastSeenDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'LastSeenTitle',\r\n      inputKey: 'inputPrivacyKeyStatusTimestamp',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyProfilePhotoTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-profile-photo');\r\n    this.setTitle('PrivacyProfilePhoto');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.ProfilePhoto.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyProfilePhotoTitle',\r\n      inputKey: 'inputPrivacyKeyProfilePhoto',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverShare', 'PrivacySettingsController.AlwaysShare'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyForwardMessagesTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-forward-messages');\r\n    this.setTitle('PrivacySettings.Forwards');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.Forwards.CustomHelp';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'PrivacyForwardsTitle',\r\n      inputKey: 'inputPrivacyKeyForwards',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\nimport PrivacyType from '../../../../lib/appManagers/utils/privacy/privacyType';\r\n\r\nexport default class AppPrivacyAddToGroupsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-add-to-groups');\r\n    this.setTitle('PrivacySettings.Groups');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.GroupDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanAddMe',\r\n      inputKey: 'inputPrivacyKeyChatInvite',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      skipTypes: [PrivacyType.Nobody],\r\n      managers: this.managers\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../../sliderTab';\r\nimport PrivacySection from '../../../privacySection';\r\nimport {LangPackKey} from '../../../../lib/langPack';\r\n\r\nexport default class AppPrivacyCallsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('privacy-tab', 'privacy-calls');\r\n    this.setTitle('PrivacySettings.VoiceCalls');\r\n\r\n    const caption: LangPackKey = 'PrivacySettingsController.PhoneCallDescription';\r\n    new PrivacySection({\r\n      tab: this,\r\n      title: 'WhoCanCallMe',\r\n      inputKey: 'inputPrivacyKeyPhoneCall',\r\n      captions: [caption, caption, caption],\r\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n      appendTo: this.scrollable,\r\n      managers: this.managers\r\n    });\r\n\r\n    {\r\n      const caption: LangPackKey = 'PrivacySettingsController.P2p.Desc';\r\n      new PrivacySection({\r\n        tab: this,\r\n        title: 'PrivacyP2PHeader',\r\n        inputKey: 'inputPrivacyKeyPhoneP2P',\r\n        captions: [caption, caption, caption],\r\n        exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\r\n        appendTo: this.scrollable,\r\n        managers: this.managers\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Button from '../../button';\r\nimport Row from '../../row';\r\nimport {Authorization} from '../../../layer';\r\nimport {formatDateAccordingToTodayNew} from '../../../helpers/date';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport {toast} from '../../toast';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport findAndSplice from '../../../helpers/array/findAndSplice';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppActiveSessionsTab extends SliderSuperTabEventable {\r\n  public authorizations: Authorization.authorization[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('active-sessions-container');\r\n    this.setTitle('SessionsTitle');\r\n\r\n    const Session = (auth: Authorization.authorization) => {\r\n      const row = new Row({\r\n        title: [auth.app_name, auth.app_version].join(' '),\r\n        subtitle: [auth.ip, auth.country].join(' - '),\r\n        clickable: true,\r\n        titleRight: auth.pFlags.current ? undefined : formatDateAccordingToTodayNew(new Date(Math.max(auth.date_active, auth.date_created) * 1000))\r\n      });\r\n\r\n      row.container.dataset.hash = '' + auth.hash;\r\n\r\n      const midtitle = document.createElement('div');\r\n      midtitle.classList.add('row-midtitle');\r\n      midtitle.innerHTML = [auth.device_model, auth.system_version || auth.platform].filter(Boolean).join(', ');\r\n\r\n      row.subtitle.parentElement.insertBefore(midtitle, row.subtitle);\r\n\r\n      return row;\r\n    };\r\n\r\n    const authorizations = this.authorizations.slice();\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'CurrentSession',\r\n        caption: 'ClearOtherSessionsHelp'\r\n      });\r\n\r\n      const auth = findAndSplice(authorizations, auth => auth.pFlags.current);\r\n      const session = Session(auth);\r\n\r\n      section.content.append(session.container);\r\n\r\n      if(authorizations.length) {\r\n        const btnTerminate = Button('btn-primary btn-transparent danger', {icon: 'stop', text: 'TerminateAllSessions'});\r\n        attachClickEvent(btnTerminate, (e) => {\r\n          new PopupPeer('revoke-session', {\r\n            buttons: [{\r\n              langKey: 'Terminate',\r\n              isDanger: true,\r\n              callback: () => {\r\n                const toggle = toggleDisability([btnTerminate], true);\r\n                this.managers.apiManager.invokeApi('auth.resetAuthorizations').then((value) => {\r\n                  // toggleDisability([btnTerminate], false);\r\n                  btnTerminate.remove();\r\n                  otherSection.container.remove();\r\n                }, onError).finally(() => {\r\n                  toggle();\r\n                });\r\n              }\r\n            }],\r\n            titleLangKey: 'AreYouSureSessionsTitle',\r\n            descriptionLangKey: 'AreYouSureSessions'\r\n          }).show();\r\n        });\r\n\r\n        section.content.append(btnTerminate);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!authorizations.length) {\r\n      return;\r\n    }\r\n\r\n    const otherSection = new SettingSection({\r\n      name: 'OtherSessions',\r\n      caption: 'SessionsListInfo'\r\n    });\r\n\r\n    authorizations.forEach((auth) => {\r\n      otherSection.content.append(Session(auth).container);\r\n    });\r\n\r\n    this.scrollable.append(otherSection.container);\r\n\r\n    const onError = (err: any) => {\r\n      if(err.type === 'FRESH_RESET_AUTHORISATION_FORBIDDEN') {\r\n        toast(I18n.format('RecentSessions.Error.FreshReset', true));\r\n      }\r\n    };\r\n\r\n    let target: HTMLElement;\r\n    const onTerminateClick = () => {\r\n      const hash = target.dataset.hash;\r\n\r\n      new PopupPeer('revoke-session', {\r\n        buttons: [{\r\n          langKey: 'Terminate',\r\n          isDanger: true,\r\n          callback: () => {\r\n            this.managers.apiManager.invokeApi('account.resetAuthorization', {hash})\r\n            .then((value) => {\r\n              if(value) {\r\n                target.remove();\r\n              }\r\n            }, onError);\r\n          }\r\n        }],\r\n        titleLangKey: 'AreYouSureSessionTitle',\r\n        descriptionLangKey: 'TerminateSessionText'\r\n      }).show();\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'stop',\r\n      text: 'Terminate',\r\n      onClick: onTerminateClick\r\n    }]);\r\n    element.id = 'active-sessions-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    });\r\n\r\n    attachClickEvent(this.scrollable.container, (e) => {\r\n      target = findUpClassName(e.target, 'row');\r\n      if(!target || target.dataset.hash === '0') {\r\n        return;\r\n      }\r\n\r\n      onTerminateClick();\r\n    });\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {SettingSection} from '..';\r\nimport ButtonMenu from '../../buttonMenu';\r\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\r\nimport PopupPickUser from '../../popups/pickUser';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport findUpTag from '../../../helpers/dom/findUpTag';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\nimport getUserStatusString from '../../wrappers/getUserStatusString';\r\nimport {attachContextMenuListener} from '../../../helpers/dom/attachContextMenuListener';\r\nimport positionMenu from '../../../helpers/positionMenu';\r\nimport contextMenuController from '../../../helpers/contextMenuController';\r\n\r\nexport default class AppBlockedUsersTab extends SliderSuperTab {\r\n  public peerIds: PeerId[];\r\n  private menuElement: HTMLElement;\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('blocked-users-container');\r\n    this.setTitle('BlockedUsers');\r\n\r\n    const section = new SettingSection({\r\n      caption: 'BlockedUsersInfo'\r\n    });\r\n\r\n    section.caption.parentElement.prepend(section.caption);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\r\n    this.content.append(btnAdd);\r\n\r\n    attachClickEvent(btnAdd, (e) => {\r\n      new PopupPickUser({\r\n        peerTypes: ['contacts'],\r\n        placeholder: 'BlockModal.Search.Placeholder',\r\n        onSelect: (peerId) => {\r\n          // console.log('block', peerId);\r\n          this.managers.appUsersManager.toggleBlock(peerId, true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const list = appDialogsManager.createChatList();\r\n    this.scrollable.container.classList.add('chatlist-container');\r\n    section.content.append(list);\r\n\r\n    const add = async(peerId: PeerId, append: boolean) => {\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: list,\r\n        rippleEnabled: true,\r\n        avatarSize: 48,\r\n        append\r\n      });\r\n\r\n      const user = await this.managers.appUsersManager.getUser(peerId);\r\n      if(user.pFlags.bot) {\r\n        dom.lastMessageSpan.append('@' + user.username);\r\n      } else {\r\n        if(user.phone) dom.lastMessageSpan.innerHTML = formatUserPhone(user.phone);\r\n        else dom.lastMessageSpan.append(user.username ? '@' + user.username : getUserStatusString(user));\r\n      }\r\n\r\n      // dom.titleSpan.innerHTML = 'Raaid El Syed';\r\n      // dom.lastMessageSpan.innerHTML = '+1 234 567891';\r\n    };\r\n\r\n    for(const peerId of this.peerIds) {\r\n      add(peerId, true);\r\n    }\r\n\r\n    let target: HTMLElement;\r\n    const onUnblock = () => {\r\n      const peerId = target.dataset.peerId.toPeerId();\r\n      this.managers.appUsersManager.toggleBlock(peerId, false);\r\n    };\r\n\r\n    const element = this.menuElement = ButtonMenu([{\r\n      icon: 'lockoff',\r\n      text: 'Unblock',\r\n      onClick: onUnblock,\r\n      options: {listenerSetter: this.listenerSetter}\r\n    }]);\r\n    element.id = 'blocked-users-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    document.getElementById('page-chats').append(element);\r\n\r\n    attachContextMenuListener(this.scrollable.container, (e) => {\r\n      target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      if(e instanceof MouseEvent) e.preventDefault();\r\n      // smth\r\n      if(e instanceof MouseEvent) e.cancelBubble = true;\r\n\r\n      positionMenu(e, element);\r\n      contextMenuController.openBtnMenu(element);\r\n    }, this.listenerSetter);\r\n\r\n    this.listenerSetter.add(rootScope)('peer_block', (update) => {\r\n      const {peerId, blocked} = update;\r\n      const li = list.querySelector(`[data-peer-id=\"${peerId}\"]`);\r\n      if(blocked) {\r\n        if(!li) {\r\n          add(peerId, false);\r\n        }\r\n      } else {\r\n        if(li) {\r\n          li.remove();\r\n        }\r\n      }\r\n    });\r\n\r\n    const LOAD_COUNT = 50;\r\n    let loading = false;\r\n    this.scrollable.onScrolledBottom = () => {\r\n      if(loading) {\r\n        return;\r\n      }\r\n\r\n      loading = true;\r\n      this.managers.appUsersManager.getBlocked(list.childElementCount, LOAD_COUNT).then((res) => {\r\n        for(const peerId of res.peerIds) {\r\n          add(peerId, true);\r\n        }\r\n\r\n        if(res.peerIds.length < LOAD_COUNT || list.childElementCount === res.count) {\r\n          this.scrollable.onScrolledBottom = null;\r\n        }\r\n\r\n        this.scrollable.checkForTriggers();\r\n      }).finally(() => {\r\n        loading = false;\r\n      });\r\n    };\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.scrollable.onScroll();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.menuElement) {\r\n      this.menuElement.remove();\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","export default function convertKeyToInputKey(key: string) {\n  key = key[0].toUpperCase() + key.slice(1);\n  key = 'input' + key;\n  return key;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport PrivacySection from '../../../privacySection';\nimport {LangPackKey} from '../../../../lib/langPack';\n\nexport default class AppPrivacyVoicesTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.container.classList.add('privacy-tab', 'privacy-voices');\n    this.setTitle('PrivacyVoiceMessages');\n\n    const caption: LangPackKey = 'PrivacyVoiceMessagesInfo';\n    new PrivacySection({\n      tab: this,\n      title: 'PrivacyVoiceMessagesTitle',\n      inputKey: 'inputPrivacyKeyVoiceMessages',\n      captions: [caption, caption, caption],\n      exceptionTexts: ['PrivacySettingsController.NeverAllow', 'PrivacySettingsController.AlwaysAllow'],\n      appendTo: this.scrollable,\n      managers: this.managers\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport {AccountPassword, Authorization, InputPrivacyKey, Updates} from '../../../layer';\r\nimport AppPrivacyPhoneNumberTab from './privacy/phoneNumber';\r\nimport AppTwoStepVerificationTab from './2fa';\r\nimport AppTwoStepVerificationEnterPasswordTab from './2fa/enterPassword';\r\nimport AppTwoStepVerificationEmailConfirmationTab from './2fa/emailConfirmation';\r\nimport AppPrivacyLastSeenTab from './privacy/lastSeen';\r\nimport AppPrivacyProfilePhotoTab from './privacy/profilePhoto';\r\nimport AppPrivacyForwardMessagesTab from './privacy/forwardMessages';\r\nimport AppPrivacyAddToGroupsTab from './privacy/addToGroups';\r\nimport AppPrivacyCallsTab from './privacy/calls';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport AppBlockedUsersTab from './blockedUsers';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {i18n, LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\nimport CheckboxField from '../../checkboxField';\r\nimport PopupPeer from '../../popups/peer';\r\nimport Button from '../../button';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport getPrivacyRulesDetails from '../../../lib/appManagers/utils/privacy/getPrivacyRulesDetails';\r\nimport PrivacyType from '../../../lib/appManagers/utils/privacy/privacyType';\r\nimport confirmationPopup, {PopupConfirmationOptions} from '../../confirmationPopup';\r\nimport noop from '../../../helpers/noop';\r\nimport {toastNew} from '../../toast';\r\nimport AppPrivacyVoicesTab from './privacy/voices';\r\n\r\nexport default class AppPrivacyAndSecurityTab extends SliderSuperTabEventable {\r\n  private activeSessionsRow: Row;\r\n  private authorizations: Authorization.authorization[];\r\n\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('dont-u-dare-block-me');\r\n    this.setTitle('PrivacySettings');\r\n\r\n    const SUBTITLE: LangPackKey = 'Loading';\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true, caption: 'SessionsInfo'});\r\n\r\n      let blockedPeerIds: PeerId[];\r\n      const blockedUsersRow = new Row({\r\n        icon: 'deleteuser',\r\n        titleLangKey: 'BlockedUsers',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppBlockedUsersTab);\r\n          tab.peerIds = blockedPeerIds;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      blockedUsersRow.freezed = true;\r\n\r\n      let passwordState: AccountPassword;\r\n      const twoFactorRowOptions = {\r\n        icon: 'lock',\r\n        titleLangKey: 'TwoStepVerification' as LangPackKey,\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: (e: Event) => {\r\n          let tab: AppTwoStepVerificationTab | AppTwoStepVerificationEnterPasswordTab | AppTwoStepVerificationEmailConfirmationTab;\r\n          if(passwordState.pFlags.has_password) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEnterPasswordTab);\r\n          } else if(passwordState.email_unconfirmed_pattern) {\r\n            tab = this.slider.createTab(AppTwoStepVerificationEmailConfirmationTab);\r\n            tab.email = passwordState.email_unconfirmed_pattern;\r\n            tab.length = 6;\r\n            tab.isFirst = true;\r\n            this.managers.passwordManager.resendPasswordEmail();\r\n          } else {\r\n            tab = this.slider.createTab(AppTwoStepVerificationTab);\r\n          }\r\n\r\n          tab.state = passwordState;\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      };\r\n\r\n      const twoFactorRow = new Row(twoFactorRowOptions);\r\n      twoFactorRow.freezed = true;\r\n\r\n      const activeSessionsRow = this.activeSessionsRow = new Row({\r\n        icon: 'activesessions',\r\n        titleLangKey: 'SessionsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.updateActiveSessions();\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      activeSessionsRow.freezed = true;\r\n\r\n      section.content.append(blockedUsersRow.container, twoFactorRow.container, activeSessionsRow.container);\r\n      this.scrollable.append(section.container);\r\n\r\n      const setBlockedCount = (count: number) => {\r\n        if(count) {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('PrivacySettingsController.UserCount', [count]));\r\n        } else {\r\n          replaceContent(blockedUsersRow.subtitle, i18n('BlockedEmpty', [count]));\r\n        }\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('peer_block', () => {\r\n        /* const {blocked, peerId} = update;\r\n        if(!blocked) blockedPeerIds.findAndSplice((p) => p === peerId);\r\n        else blockedPeerIds.unshift(peerId);\r\n        blockedCount += blocked ? 1 : -1;\r\n        setBlockedCount(blockedCount); */\r\n        updateBlocked();\r\n      });\r\n\r\n      const updateBlocked = () => {\r\n        this.managers.appUsersManager.getBlocked().then((res) => {\r\n          blockedUsersRow.freezed = false;\r\n          setBlockedCount(res.count);\r\n          blockedPeerIds = res.peerIds;\r\n        });\r\n      };\r\n\r\n      updateBlocked();\r\n\r\n      this.managers.passwordManager.getState().then((state) => {\r\n        passwordState = state;\r\n        replaceContent(twoFactorRow.subtitle, i18n(state.pFlags.has_password ? 'PrivacyAndSecurity.Item.On' : 'PrivacyAndSecurity.Item.Off'));\r\n        twoFactorRow.freezed = false;\r\n\r\n        // console.log('password state', state);\r\n      });\r\n\r\n      this.updateActiveSessions();\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyTitle', caption: 'GroupsAndChannelsHelp'});\r\n\r\n      section.content.classList.add('privacy-navigation-container');\r\n\r\n      const rowsByKeys: Partial<{\r\n        [key in InputPrivacyKey['_']]: Row\r\n      }> = {};\r\n\r\n      const numberVisibilityRow = rowsByKeys['inputPrivacyKeyPhoneNumber'] = new Row({\r\n        titleLangKey: 'PrivacyPhoneTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyPhoneNumberTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const lastSeenTimeRow = rowsByKeys['inputPrivacyKeyStatusTimestamp'] = new Row({\r\n        titleLangKey: 'LastSeenTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyLastSeenTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const photoVisibilityRow = rowsByKeys['inputPrivacyKeyProfilePhoto'] = new Row({\r\n        titleLangKey: 'PrivacyProfilePhotoTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyProfilePhotoTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const callRow = rowsByKeys['inputPrivacyKeyPhoneCall'] = new Row({\r\n        titleLangKey: 'WhoCanCallMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyCallsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const linkAccountRow = rowsByKeys['inputPrivacyKeyForwards'] = new Row({\r\n        titleLangKey: 'PrivacyForwardsTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyForwardMessagesTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const groupChatsAddRow = rowsByKeys['inputPrivacyKeyChatInvite'] = new Row({\r\n        titleLangKey: 'WhoCanAddMe',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          this.slider.createTab(AppPrivacyAddToGroupsTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const voicesRow = rowsByKeys['inputPrivacyKeyVoiceMessages'] = new Row({\r\n        titleLangKey: 'PrivacyVoiceMessagesTitle',\r\n        subtitleLangKey: SUBTITLE,\r\n        clickable: () => {\r\n          if(!rootScope.premium) {\r\n            toastNew({langPackKey: 'PrivacyVoiceMessagesPremiumOnly'});\r\n          } else {\r\n            this.slider.createTab(AppPrivacyVoicesTab).open();\r\n          }\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const updatePrivacyRow = (key: InputPrivacyKey['_']) => {\r\n        const row = rowsByKeys[key];\r\n        if(!row) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appPrivacyManager.getPrivacy(key).then((rules) => {\r\n          const details = getPrivacyRulesDetails(rules);\r\n          const langKey = details.type === PrivacyType.Everybody ? 'PrivacySettingsController.Everbody' : (details.type === PrivacyType.Contacts ? 'PrivacySettingsController.MyContacts' : 'PrivacySettingsController.Nobody');\r\n          const disallowLength = details.disallowPeers.users.length + details.disallowPeers.chats.length;\r\n          const allowLength = details.allowPeers.users.length + details.allowPeers.chats.length;\r\n\r\n          row.subtitle.innerHTML = '';\r\n          const s = i18n(langKey);\r\n          row.subtitle.append(s);\r\n          if(disallowLength || allowLength) {\r\n            row.subtitle.append(` (${[-disallowLength, allowLength ? '+' + allowLength : 0].filter(Boolean).join(', ')})`);\r\n          }\r\n        });\r\n      };\r\n\r\n      section.content.append(\r\n        numberVisibilityRow.container,\r\n        lastSeenTimeRow.container,\r\n        photoVisibilityRow.container,\r\n        callRow.container,\r\n        linkAccountRow.container,\r\n        groupChatsAddRow.container,\r\n        voicesRow.container\r\n      );\r\n      this.scrollable.append(section.container);\r\n\r\n      for(const key in rowsByKeys) {\r\n        updatePrivacyRow(key as keyof typeof rowsByKeys);\r\n      }\r\n\r\n      rootScope.addEventListener('privacy_update', (update) => {\r\n        updatePrivacyRow(convertKeyToInputKey(update.key._) as any);\r\n      });\r\n    }\r\n\r\n    const promises: Promise<any>[] = [];\r\n\r\n    {\r\n      const section = new SettingSection({name: 'NewChatsFromNonContacts', caption: 'ArchiveAndMuteInfo'});\r\n\r\n      const checkboxField = new CheckboxField({text: 'ArchiveAndMute'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean, destroyed: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        destroyed = true;\r\n        if(enabled === undefined) return;\r\n        this.managers.appPrivacyManager.setGlobalPrivacySettings({\r\n          _: 'globalPrivacySettings',\r\n          archive_and_mute_new_noncontact_peers: checkboxField.checked\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = Promise.all([\r\n        this.managers.apiManager.getAppConfig(),\r\n        this.managers.appPrivacyManager.getGlobalPrivacySettings()\r\n      ]).then(([appConfig, settings]) => {\r\n        if(destroyed) {\r\n          return;\r\n        }\r\n\r\n        const onPremiumToggle = (isPremium: boolean) => {\r\n          section.container.classList.toggle('hide', !isPremium && !appConfig.autoarchive_setting_available);\r\n        };\r\n\r\n        this.listenerSetter.add(rootScope)('premium_toggle', onPremiumToggle);\r\n        onPremiumToggle(rootScope.premium);\r\n\r\n        enabled = settings.archive_and_mute_new_noncontact_peers;\r\n\r\n        checkboxField.setValueSilently(enabled);\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Privacy.SensitiveContent', caption: 'PrivacyAndSecurity.SensitiveDesc'});\r\n      section.container.classList.add('hide');\r\n\r\n      const checkboxField = new CheckboxField({text: 'PrivacyAndSecurity.SensitiveText'});\r\n      const row = new Row({\r\n        checkboxField,\r\n        noCheckboxSubtitle: true\r\n      });\r\n\r\n      section.content.append(row.container);\r\n\r\n      let enabled: boolean;\r\n      this.eventListener.addEventListener('destroy', () => {\r\n        if(enabled === undefined) return;\r\n        const _enabled = row.checkboxField.checked;\r\n        const isChanged = _enabled !== enabled;\r\n        if(!isChanged) {\r\n          return;\r\n        }\r\n\r\n        this.managers.apiManager.invokeApi('account.setContentSettings', {\r\n          sensitive_enabled: _enabled\r\n        });\r\n      }, {once: true});\r\n\r\n      const promise = this.managers.apiManager.invokeApi('account.getContentSettings').then((settings) => {\r\n        if(!settings.pFlags.sensitive_can_change) {\r\n          return;\r\n        }\r\n\r\n        enabled = !!settings.pFlags.sensitive_enabled;\r\n        checkboxField.setValueSilently(enabled);\r\n        section.container.classList.remove('hide');\r\n      });\r\n\r\n      promises.push(promise);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'PrivacyPayments', caption: 'PrivacyPaymentsClearInfo'});\r\n\r\n      const onClearClick = () => {\r\n        const options: PopupConfirmationOptions = {\r\n          titleLangKey: 'PrivacyPaymentsClearAlertTitle',\r\n          descriptionLangKey: 'PrivacyPaymentsClearAlertText',\r\n          button: {\r\n            langKey: 'Clear'\r\n          },\r\n          checkboxes: [{\r\n            text: 'PrivacyClearShipping',\r\n            checked: true\r\n          }, {\r\n            text: 'PrivacyClearPayment',\r\n            checked: true\r\n          }]\r\n        };\r\n\r\n        confirmationPopup(options).then(() => {\r\n          const [info, payment] = options.checkboxes.map((c) => c.checkboxField.checked);\r\n          const toggle = toggleDisability([clearButton], true);\r\n          this.managers.appPaymentsManager.clearSavedInfo(info, payment).then(() => {\r\n            if(!info && !payment) {\r\n              return;\r\n            }\r\n\r\n            toggle();\r\n            toastNew({\r\n              langPackKey: info && payment ? 'PrivacyPaymentsPaymentShippingCleared' : (info ? 'PrivacyPaymentsShippingInfoCleared' : 'PrivacyPaymentsPaymentInfoCleared')\r\n            });\r\n          });\r\n        }, noop);\r\n      };\r\n\r\n      const clearButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyPaymentsClear'});\r\n      this.listenerSetter.add(clearButton)('click', onClearClick);\r\n      section.content.append(clearButton);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'FilterChats'});\r\n\r\n      const onDeleteClick = () => {\r\n        const popup = new PopupPeer('popup-delete-drafts', {\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([deleteButton], true);\r\n              this.managers.appDraftsManager.clearAllDrafts().then(() => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }],\r\n          titleLangKey: 'AreYouSureClearDraftsTitle',\r\n          descriptionLangKey: 'AreYouSureClearDrafts'\r\n        });\r\n\r\n        popup.show();\r\n      };\r\n\r\n      const deleteButton = Button('btn-primary btn-transparent', {icon: 'delete', text: 'PrivacyDeleteCloudDrafts'});\r\n      this.listenerSetter.add(deleteButton)('click', onDeleteClick);\r\n      section.content.append(deleteButton);\r\n\r\n      /* promises.push(apiManager.invokeApi('messages.getAllDrafts').then((drafts) => {\r\n        const draftsRow = new Row({\r\n          titleLangKey: 'PrivacyDeleteCloudDrafts',\r\n          subtitleLangKey: 'Drafts',\r\n          subtitleLangArgs: [(drafts as Updates.updates).updates.length],\r\n          icon: 'delete',\r\n          clickable: onDeleteClick\r\n        });\r\n\r\n        section.content.append(draftsRow.container);\r\n      })); */\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    return Promise.all(promises);\r\n  }\r\n\r\n  public updateActiveSessions() {\r\n    this.managers.apiManager.invokeApi('account.getAuthorizations').then((auths) => {\r\n      this.activeSessionsRow.freezed = false;\r\n      this.authorizations = auths.authorizations;\r\n      _i18n(this.activeSessionsRow.subtitle, 'Privacy.Devices', [this.authorizations.length]);\r\n      // console.log('auths', auths);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport renderImageFromUrl from './dom/renderImageFromUrl';\r\n\r\nexport function averageColorFromCanvas(canvas: HTMLCanvasElement) {\r\n  const context = canvas.getContext('2d');\r\n\r\n  const pixel = new Array(4).fill(0);\r\n  const pixels = context.getImageData(0, 0, canvas.width, canvas.height).data;\r\n  const pixelsLength = pixels.length / 4;\r\n  for(let i = 0; i < pixels.length; i += 4) {\r\n    // const alphaPixel = pixels[i + 3];\r\n    pixel[0] += pixels[i]/*  * (alphaPixel / 255) */;\r\n    pixel[1] += pixels[i + 1]/*  * (alphaPixel / 255) */;\r\n    pixel[2] += pixels[i + 2]/*  * (alphaPixel / 255) */;\r\n    pixel[3] += pixels[i + 3];\r\n  }\r\n\r\n  const outPixel = new Uint8ClampedArray(4);\r\n  outPixel[0] = pixel[0] / pixelsLength;\r\n  outPixel[1] = pixel[1] / pixelsLength;\r\n  outPixel[2] = pixel[2] / pixelsLength;\r\n  outPixel[3] = pixel[3] / pixelsLength;\r\n  // outPixel[3] = 255;\r\n  return outPixel;\r\n}\r\n\r\nexport function averageColorFromImageSource(imageSource: CanvasImageSource, width: number, height: number) {\r\n  const canvas = document.createElement('canvas');\r\n  const ratio = width / height;\r\n  const DIMENSIONS = 50;\r\n  if(ratio === 1) {\r\n    canvas.width = DIMENSIONS;\r\n    canvas.height = canvas.width / ratio;\r\n  } else if(ratio > 1) {\r\n    canvas.height = DIMENSIONS;\r\n    canvas.width = canvas.height / ratio;\r\n  } else {\r\n    canvas.width = canvas.height = DIMENSIONS;\r\n  }\r\n\r\n  const context = canvas.getContext('2d');\r\n  context.drawImage(imageSource, 0, 0, width, height, 0, 0, canvas.width, canvas.height);\r\n  return averageColorFromCanvas(canvas);\r\n}\r\n\r\nexport function averageColor(imageUrl: string) {\r\n  const img = document.createElement('img');\r\n  return new Promise<Uint8ClampedArray>((resolve) => {\r\n    renderImageFromUrl(img, imageUrl, () => {\r\n      resolve(averageColorFromImageSource(img, img.naturalWidth, img.naturalHeight));\r\n    });\r\n  });\r\n};\r\n","import {rgbaToHsla} from './color';\r\n\r\n// * https://github.com/TelegramMessenger/Telegram-iOS/blob/3d062fff78cc6b287c74e6171f855a3500c0156d/submodules/TelegramPresentationData/Sources/PresentationData.swift#L453\r\nexport default function highlightningColor(rgba: [number, number, number, number?]) {\r\n  let {h, s, l} = rgbaToHsla(rgba[0], rgba[1], rgba[2]);\r\n  if(s > 0) {\r\n    s = Math.min(100, s + 5 + 0.1 * (100 - s));\r\n  }\r\n  l = Math.max(0, l * .65);\r\n\r\n  const hsla = `hsla(${h}, ${s}%, ${l}%, .4)`;\r\n  return hsla;\r\n}\r\n","import {ColorHsla, ColorRgba, hexaToHsla, hslaToRgba, rgbaToHexa as rgbaToHexa, rgbaToHsla} from '../helpers/color';\r\nimport attachGrabListeners from '../helpers/dom/attachGrabListeners';\r\nimport clamp from '../helpers/number/clamp';\r\nimport InputField, {InputState} from './inputField';\r\n\r\nexport type ColorPickerColor = {\r\n  hsl: string;\r\n  rgb: string;\r\n  hex: string;\r\n  hsla: string;\r\n  rgba: string;\r\n  hexa: string;\r\n  rgbaArray: ColorRgba;\r\n};\r\n\r\nexport default class ColorPicker {\r\n  private static BASE_CLASS = 'color-picker';\r\n  public container: HTMLElement;\r\n\r\n  private boxRect: DOMRect;\r\n  // private boxDraggerRect: DOMRect;\r\n  private hueRect: DOMRect;\r\n  // private hueDraggerRect: DOMRect;\r\n\r\n  private hue = 0;\r\n  private saturation = 100;\r\n  private lightness = 50;\r\n  private alpha = 1;\r\n  private elements: {\r\n    box: SVGSVGElement,\r\n    boxDragger: SVGSVGElement,\r\n    sliders: HTMLElement,\r\n    hue: SVGSVGElement,\r\n    hueDragger: SVGSVGElement,\r\n    saturation: SVGLinearGradientElement,\r\n  } = {} as any;\r\n  private hexInputField: InputField;\r\n  private rgbInputField: InputField;\r\n  public onChange: (color: ReturnType<ColorPicker['getCurrentColor']>) => void;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(ColorPicker.BASE_CLASS);\r\n\r\n    const html = `\r\n      <svg class=\"${ColorPicker.BASE_CLASS + '-box'}\" viewBox=\"0 0 380 198\">\r\n        <defs>\r\n          <linearGradient id=\"color-picker-saturation\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\">\r\n            <stop offset=\"0%\" stop-color=\"#fff\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"hsl(0,100%,50%)\"></stop>\r\n          </linearGradient>\r\n          <linearGradient id=\"color-picker-brightness\" x1=\"0%\" y1=\"0%\" x2=\"0%\" y2=\"100%\">\r\n            <stop offset=\"0%\" stop-color=\"rgba(0,0,0,0)\"></stop>\r\n            <stop offset=\"100%\" stop-color=\"#000\"></stop>\r\n          </linearGradient>\r\n          <pattern id=\"color-picker-pattern\" width=\"100%\" height=\"100%\">\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-saturation)\"></rect>\r\n            <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"url(#color-picker-brightness)\"></rect>\r\n          </pattern>\r\n        </defs>\r\n        <rect rx=\"10\" ry=\"10\" x=\"0\" y=\"0\" width=\"380\" height=\"198\" fill=\"url(#color-picker-pattern)\"></rect>\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-box-dragger'}\" x=\"0\" y=\"0\">\r\n          <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n        </svg>\r\n      </svg>\r\n      <div class=\"${ColorPicker.BASE_CLASS + '-sliders'}\">\r\n        <svg class=\"${ColorPicker.BASE_CLASS + '-color-slider'}\" viewBox=\"0 0 380 24\">\r\n          <defs>\r\n            <linearGradient id=\"hue\" x1=\"100%\" y1=\"0%\" x2=\"0%\" y2=\"0%\">\r\n              <stop offset=\"0%\" stop-color=\"#f00\"></stop>\r\n              <stop offset=\"16.666%\" stop-color=\"#f0f\"></stop>\r\n              <stop offset=\"33.333%\" stop-color=\"#00f\"></stop>\r\n              <stop offset=\"50%\" stop-color=\"#0ff\"></stop>\r\n              <stop offset=\"66.666%\" stop-color=\"#0f0\"></stop>\r\n              <stop offset=\"83.333%\" stop-color=\"#ff0\"></stop>\r\n              <stop offset=\"100%\" stop-color=\"#f00\"></stop>\r\n            </linearGradient>\r\n          </defs>\r\n          <rect rx=\"4\" ry=\"4\" x=\"0\" y=\"9\" width=\"380\" height=\"8\" fill=\"url(#hue)\"></rect>\r\n          <svg class=\"${ColorPicker.BASE_CLASS + '-dragger'} ${ColorPicker.BASE_CLASS + '-color-slider-dragger'}\" x=\"0\" y=\"13\">\r\n            <circle r=\"11\" fill=\"inherit\" stroke=\"#fff\" stroke-width=\"2\"></circle>\r\n          </svg>\r\n        </svg>\r\n      </div>\r\n    `;\r\n\r\n    this.container.innerHTML = html;\r\n\r\n    this.elements.box = this.container.firstElementChild as any;\r\n    this.elements.boxDragger = this.elements.box.lastElementChild as any;\r\n    this.elements.saturation = this.elements.box.firstElementChild.firstElementChild as any;\r\n\r\n    this.elements.sliders = this.elements.box.nextElementSibling as any;\r\n\r\n    this.elements.hue = this.elements.sliders.firstElementChild as any;\r\n    this.elements.hueDragger = this.elements.hue.lastElementChild as any;\r\n\r\n    this.hexInputField = new InputField({plainText: true, label: 'Appearance.Color.Hex'});\r\n    this.rgbInputField = new InputField({plainText: true, label: 'Appearance.Color.RGB'});\r\n\r\n    const inputs = document.createElement('div');\r\n    inputs.className = ColorPicker.BASE_CLASS + '-inputs';\r\n    inputs.append(this.hexInputField.container, this.rgbInputField.container);\r\n    this.container.append(inputs);\r\n\r\n    this.hexInputField.input.addEventListener('input', () => {\r\n      let value = this.hexInputField.value.replace(/#/g, '').slice(0, 6);\r\n\r\n      const match = value.match(/([a-fA-F\\d]+)/);\r\n      const valid = match && match[0].length === value.length && [/* 3, 4,  */6].includes(value.length);\r\n      this.hexInputField.setState(valid ? InputState.Neutral : InputState.Error);\r\n\r\n      value = '#' + value;\r\n      this.hexInputField.setValueSilently(value);\r\n\r\n      if(valid) {\r\n        this.setColor(value, false, true);\r\n      }\r\n    });\r\n\r\n    // patched https://stackoverflow.com/a/34029238/6758968\r\n    const rgbRegExp = /^(?:rgb)?\\(?([01]?\\d\\d?|2[0-4]\\d|25[0-5])(?:\\W+)([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\W+(?:([01]?\\d\\d?|2[0-4]\\d|25[0-5])\\)?)$/;\r\n    this.rgbInputField.input.addEventListener('input', () => {\r\n      const match = this.rgbInputField.value.match(rgbRegExp);\r\n      this.rgbInputField.setState(match ? InputState.Neutral : InputState.Error);\r\n\r\n      if(match) {\r\n        this.setColor(rgbaToHsla(+match[1], +match[2], +match[3]), true, false);\r\n      }\r\n    });\r\n\r\n    this.attachBoxListeners();\r\n    this.attachHueListeners();\r\n  }\r\n\r\n  private onGrabStart = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = 'grabbing';\r\n  };\r\n\r\n  private onGrabEnd = () => {\r\n    document.documentElement.style.cursor = this.elements.boxDragger.style.cursor = '';\r\n  };\r\n\r\n  private attachBoxListeners() {\r\n    attachGrabListeners(this.elements.box as any, () => {\r\n      this.onGrabStart();\r\n      this.boxRect = this.elements.box.getBoundingClientRect();\r\n      // this.boxDraggerRect = this.elements.boxDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.saturationHandler(pos.x, pos.y);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  private attachHueListeners() {\r\n    attachGrabListeners(this.elements.hue as any, () => {\r\n      this.onGrabStart();\r\n      this.hueRect = this.elements.hue.getBoundingClientRect();\r\n      // this.hueDraggerRect = this.elements.hueDragger.getBoundingClientRect();\r\n    }, (pos) => {\r\n      this.hueHandler(pos.x);\r\n    }, () => {\r\n      this.onGrabEnd();\r\n    });\r\n  }\r\n\r\n  public setColor(color: ColorHsla | string, updateHexInput = true, updateRgbInput = true) {\r\n    if(color === undefined) { // * set to red\r\n      color = {\r\n        h: 0,\r\n        s: 100,\r\n        l: 50,\r\n        a: 1\r\n      };\r\n    } else if(typeof(color) === 'string') {\r\n      if(color[0] === '#') {\r\n        color = hexaToHsla(color);\r\n      } else {\r\n        const rgb = color.match(/[.?\\d]+/g);\r\n        color = rgbaToHsla(+rgb[0], +rgb[1], +rgb[2], rgb[3] === undefined ? 1 : +rgb[3]);\r\n      }\r\n    }\r\n\r\n    // Set box\r\n    this.boxRect = this.elements.box.getBoundingClientRect();\r\n\r\n    const boxX = this.boxRect.width / 100 * color.s;\r\n    const percentY = 100 - (color.l / (100 - color.s / 2)) * 100;\r\n    const boxY = this.boxRect.height / 100 * percentY;\r\n\r\n    this.saturationHandler(this.boxRect.left + boxX, this.boxRect.top + boxY, false);\r\n\r\n    // Set hue\r\n    this.hueRect = this.elements.hue.getBoundingClientRect();\r\n\r\n    const percentHue = color.h / 360;\r\n    const hueX = this.hueRect.left + this.hueRect.width * percentHue;\r\n\r\n    this.hueHandler(hueX, false);\r\n\r\n    // Set values\r\n    this.hue = color.h;\r\n    this.saturation = color.s;\r\n    this.lightness = color.l;\r\n    this.alpha = color.a;\r\n\r\n    this.updatePicker(updateHexInput, updateRgbInput);\r\n  };\r\n\r\n  public getCurrentColor(): ColorPickerColor {\r\n    const rgbaArray = hslaToRgba(this.hue, this.saturation, this.lightness, this.alpha);\r\n    const hexa = rgbaToHexa(rgbaArray);\r\n    const hex = hexa.slice(0, -2);\r\n\r\n    return {\r\n      hsl: `hsl(${this.hue}, ${this.saturation}%, ${this.lightness}%)`,\r\n      rgb: `rgb(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]})`,\r\n      hex: hex,\r\n      hsla: `hsla(${this.hue}, ${this.saturation}%, ${this.lightness}%, ${this.alpha})`,\r\n      rgba: `rgba(${rgbaArray[0]}, ${rgbaArray[1]}, ${rgbaArray[2]}, ${rgbaArray[3]})`,\r\n      hexa: hexa,\r\n      rgbaArray: rgbaArray\r\n    };\r\n  }\r\n\r\n  public updatePicker(updateHexInput = true, updateRgbInput = true) {\r\n    const color = this.getCurrentColor();\r\n    this.elements.boxDragger.setAttributeNS(null, 'fill', color.hex);\r\n\r\n    if(updateHexInput) {\r\n      this.hexInputField.setValueSilently(color.hex);\r\n      this.hexInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(updateRgbInput) {\r\n      this.rgbInputField.setValueSilently(color.rgbaArray.slice(0, -1).join(', '));\r\n      this.rgbInputField.setState(InputState.Neutral);\r\n    }\r\n\r\n    if(this.onChange) {\r\n      this.onChange(color);\r\n    }\r\n  }\r\n\r\n  private hueHandler(pageX: number, update = true) {\r\n    const eventX = clamp(pageX - this.hueRect.left, 0, this.hueRect.width);\r\n\r\n    const percents = eventX / this.hueRect.width;\r\n    this.hue = Math.round(360 * percents);\r\n\r\n    const hsla = `hsla(${this.hue}, 100%, 50%, ${this.alpha})`;\r\n\r\n    this.elements.hueDragger.setAttributeNS(null, 'x', (percents * 100) + '%');\r\n    this.elements.hueDragger.setAttributeNS(null, 'fill', hsla);\r\n\r\n    this.elements.saturation.lastElementChild.setAttributeNS(null, 'stop-color', hsla);\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  }\r\n\r\n  private saturationHandler(pageX: number, pageY: number, update = true) {\r\n    const maxX = this.boxRect.width;\r\n    const maxY = this.boxRect.height;\r\n\r\n    const eventX = clamp(pageX - this.boxRect.left, 0, maxX);\r\n    const eventY = clamp(pageY - this.boxRect.top, 0, maxY);\r\n\r\n    const posX = eventX / maxX * 100;\r\n    const posY = eventY / maxY * 100;\r\n\r\n    const boxDragger = this.elements.boxDragger;\r\n    boxDragger.setAttributeNS(null, 'x', posX + '%');\r\n    boxDragger.setAttributeNS(null, 'y', posY + '%');\r\n\r\n    const saturation = clamp(posX, 0, 100);\r\n\r\n    const lightnessX = 100 - saturation / 2;\r\n    const lightnessY = 100 - clamp(posY, 0, 100);\r\n\r\n    const lightness = clamp(lightnessY / 100 * lightnessX, 0, 100);\r\n\r\n    this.saturation = saturation;\r\n    this.lightness = lightness;\r\n\r\n    if(update) {\r\n      this.updatePicker();\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {Theme} from '../../../config/state';\r\nimport {hexaToRgba} from '../../../helpers/color';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport throttle from '../../../helpers/schedulers/throttle';\r\nimport themeController from '../../../helpers/themeController';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport ColorPicker, {ColorPickerColor} from '../../colorPicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppBackgroundColorTab extends SliderSuperTab {\r\n  private colorPicker: ColorPicker;\r\n  private grid: HTMLElement;\r\n  private applyColor: (hex: string, updateColorPicker?: boolean) => void;\r\n  private theme: Theme;\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-color-container');\r\n    this.setTitle('SetColor');\r\n\r\n    this.theme = themeController.getTheme();\r\n\r\n    const section = new SettingSection({});\r\n    this.colorPicker = new ColorPicker();\r\n\r\n    section.content.append(this.colorPicker.container);\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    const gridSection = new SettingSection({});\r\n\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n\r\n    const colors = [\r\n      '#E6EBEE',\r\n      '#B2CEE1',\r\n      '#008DD0',\r\n      '#C6E7CB',\r\n      '#C4E1A6',\r\n      '#60B16E',\r\n      '#CCD0AF',\r\n      '#A6A997',\r\n      '#7A7072',\r\n      '#FDD7AF',\r\n      '#FDB76E',\r\n      '#DD8851'\r\n    ];\r\n\r\n    colors.forEach((color) => {\r\n      const item = document.createElement('div');\r\n      item.classList.add('grid-item');\r\n      item.dataset.color = color.toLowerCase();\r\n\r\n      // * need for transform scale\r\n      const media = document.createElement('div');\r\n      media.classList.add('grid-item-media');\r\n      media.style.backgroundColor = color;\r\n\r\n      item.append(media);\r\n      grid.append(item);\r\n    });\r\n\r\n    attachClickEvent(grid, (e) => {\r\n      const target = findUpClassName(e.target, 'grid-item');\r\n      if(!target || target.classList.contains('active')) {\r\n        return;\r\n      }\r\n\r\n      const color = target.dataset.color;\r\n      if(!color) {\r\n        return;\r\n      }\r\n\r\n      this.applyColor(color);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    gridSection.content.append(grid);\r\n    this.scrollable.append(gridSection.container);\r\n\r\n    this.applyColor = throttle(this._applyColor, 16, true);\r\n  }\r\n\r\n  private setActive() {\r\n    const active = this.grid.querySelector('.active');\r\n    const background = this.theme.background;\r\n    const target = background.color ? this.grid.querySelector(`.grid-item[data-color=\"${background.color}\"]`) : null;\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  }\r\n\r\n  private _applyColor = (hex: string, updateColorPicker = true) => {\r\n    if(updateColorPicker) {\r\n      this.colorPicker.setColor(hex);\r\n    } else {\r\n      const rgba = hexaToRgba(hex);\r\n      const background = this.theme.background;\r\n      const hsla = highlightningColor(rgba);\r\n\r\n      background.id = '2';\r\n      background.intensity = 0;\r\n      background.slug = '';\r\n      background.color = hex.toLowerCase();\r\n      background.highlightningColor = hsla;\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.setActive();\r\n    }\r\n  };\r\n\r\n  private onColorChange = (color: ColorPickerColor) => {\r\n    this.applyColor(color.hex, false);\r\n  };\r\n\r\n  onOpen() {\r\n    setTimeout(() => {\r\n      const background = this.theme.background;\r\n\r\n      const color = (background.color || '').split(',')[0];\r\n      const isColored = !!color && !background.slug;\r\n\r\n      // * set active if type is color\r\n      if(isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n\r\n      this.colorPicker.setColor(color || '#cccccc');\r\n\r\n      if(!isColored) {\r\n        this.colorPicker.onChange = this.onColorChange;\r\n      }\r\n    }, 0);\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.colorPicker.onChange = undefined;\r\n    this.colorPicker = undefined;\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection} from '..';\r\nimport {averageColor, averageColorFromCanvas} from '../../../helpers/averageColor';\r\nimport blur from '../../../helpers/blur';\r\nimport deferredPromise, {CancellablePromise} from '../../../helpers/cancellablePromise';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport findUpClassName from '../../../helpers/dom/findUpClassName';\r\nimport highlightningColor from '../../../helpers/highlightningColor';\r\nimport copy from '../../../helpers/object/copy';\r\nimport sequentialDom from '../../../helpers/sequentialDom';\r\nimport ChatBackgroundGradientRenderer from '../../chat/gradientRenderer';\r\nimport {Document, PhotoSize, WallPaper} from '../../../layer';\r\nimport {MyDocument} from '../../../lib/appManagers/appDocsManager';\r\nimport appDownloadManager, {AppDownloadManager, DownloadBlob} from '../../../lib/appManagers/appDownloadManager';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport ProgressivePreloader from '../../preloader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppBackgroundColorTab from './backgroundColor';\r\nimport choosePhotoSize from '../../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport {STATE_INIT, Theme} from '../../../config/state';\r\nimport themeController from '../../../helpers/themeController';\r\nimport requestFile from '../../../helpers/files/requestFile';\r\nimport {renderImageFromUrlPromise} from '../../../helpers/dom/renderImageFromUrl';\r\nimport scaleMediaElement from '../../../helpers/canvas/scaleMediaElement';\r\nimport {MediaSize} from '../../../helpers/mediaSize';\r\nimport wrapPhoto from '../../wrappers/photo';\r\n\r\nexport default class AppBackgroundTab extends SliderSuperTab {\r\n  private grid: HTMLElement;\r\n  private tempId = 0;\r\n  private clicked: Set<DocId> = new Set();\r\n  private blurCheckboxField: CheckboxField;\r\n\r\n  private wallPapersByElement: Map<HTMLElement, WallPaper> = new Map();\r\n  private elementsByKey: Map<string, HTMLElement> = new Map();\r\n\r\n  private get theme() {\r\n    return themeController.getTheme();\r\n  }\r\n\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('background-container', 'background-image-container');\r\n    this.setTitle('ChatBackground');\r\n\r\n    {\r\n      const container = generateSection(this.scrollable);\r\n\r\n      const uploadButton = Button('btn-primary btn-transparent', {icon: 'cameraadd', text: 'ChatBackground.UploadWallpaper'});\r\n      const colorButton = Button('btn-primary btn-transparent', {icon: 'colorize', text: 'SetColor'});\r\n      const resetButton = Button('btn-primary btn-transparent', {icon: 'favourites', text: 'Appearance.Reset'});\r\n\r\n      attachClickEvent(uploadButton, this.onUploadClick, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(colorButton, () => {\r\n        this.slider.createTab(AppBackgroundColorTab).open();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      attachClickEvent(resetButton, this.onResetClick, {listenerSetter: this.listenerSetter});\r\n\r\n      const blurCheckboxField = this.blurCheckboxField = new CheckboxField({\r\n        text: 'ChatBackground.Blur',\r\n        name: 'blur',\r\n        checked: this.theme.background.blur,\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(blurCheckboxField.input)('change', async() => {\r\n        this.theme.background.blur = blurCheckboxField.input.checked;\r\n        await this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n        // * wait for animation end\r\n        setTimeout(() => {\r\n          const active = grid.querySelector('.active') as HTMLElement;\r\n          if(!active) return;\r\n\r\n          const wallpaper = this.wallPapersByElement.get(active);\r\n          if((wallpaper as WallPaper.wallPaper).pFlags.pattern || wallpaper._ === 'wallPaperNoFile') {\r\n            return;\r\n          }\r\n\r\n          this.setBackgroundDocument(wallpaper);\r\n        }, 100);\r\n      });\r\n\r\n      container.append(uploadButton, colorButton, resetButton, blurCheckboxField.label);\r\n    }\r\n\r\n    rootScope.addEventListener('background_change', this.setActive);\r\n\r\n    this.managers.appDocsManager.getWallPapers().then((wallPapers) => {\r\n      wallPapers.forEach((wallPaper) => {\r\n        this.addWallPaper(wallPaper);\r\n      });\r\n    });\r\n\r\n    const gridContainer = generateSection(this.scrollable);\r\n    const grid = this.grid = document.createElement('div');\r\n    grid.classList.add('grid');\r\n    attachClickEvent(grid, this.onGridClick, {listenerSetter: this.listenerSetter});\r\n    gridContainer.append(grid);\r\n  }\r\n\r\n  private onUploadClick = () => {\r\n    requestFile('image/x-png,image/png,image/jpeg').then(async(file) => {\r\n      if(file.name.endsWith('.png')) {\r\n        const img = document.createElement('img');\r\n        const url = URL.createObjectURL(file);\r\n        await renderImageFromUrlPromise(img, url, false);\r\n        const mimeType = 'image/jpeg';\r\n        const {blob} = await scaleMediaElement({media: img, size: new MediaSize(img.naturalWidth, img.naturalHeight), mimeType});\r\n        file = new File([blob], file.name.replace(/\\.png$/, '.jpg'), {type: mimeType});\r\n      }\r\n\r\n      const wallPaper = await this.managers.appDocsManager.prepareWallPaperUpload(file);\r\n      const uploadPromise = this.managers.appDocsManager.uploadWallPaper(wallPaper.id);\r\n      const uploadDeferred: CancellablePromise<any> = appDownloadManager.getNewDeferredForUpload(file.name, uploadPromise);\r\n\r\n      const deferred = deferredPromise<void>();\r\n      deferred.addNotifyListener = uploadDeferred.addNotifyListener;\r\n      deferred.cancel = uploadDeferred.cancel;\r\n\r\n      uploadDeferred.then((wallPaper) => {\r\n        this.clicked.delete(key);\r\n        this.elementsByKey.delete(key);\r\n        this.wallPapersByElement.set(container, wallPaper);\r\n        const newKey = this.getWallPaperKey(wallPaper);\r\n        this.elementsByKey.set(newKey, container);\r\n\r\n        this.setBackgroundDocument(wallPaper).then(deferred.resolve, deferred.reject);\r\n      }, deferred.reject);\r\n\r\n      const key = this.getWallPaperKey(wallPaper);\r\n      deferred.catch(() => {\r\n        container.remove();\r\n      });\r\n\r\n      const preloader = new ProgressivePreloader({\r\n        isUpload: true,\r\n        cancelable: true,\r\n        tryAgainOnFail: false\r\n      });\r\n\r\n      const container = this.addWallPaper(wallPaper, false);\r\n      this.clicked.add(key);\r\n\r\n      preloader.attach(container, false, deferred);\r\n    });\r\n  };\r\n\r\n  private onResetClick = () => {\r\n    const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === this.theme.name);\r\n    if(defaultTheme) {\r\n      ++this.tempId;\r\n      this.theme.background = copy(defaultTheme.background);\r\n      this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n      appImManager.applyCurrentTheme(undefined, undefined, true);\r\n      this.blurCheckboxField.setValueSilently(this.theme.background.blur);\r\n    }\r\n  };\r\n\r\n  private getColorsFromWallPaper(wallPaper: WallPaper) {\r\n    return wallPaper.settings ? [\r\n      wallPaper.settings.background_color,\r\n      wallPaper.settings.second_background_color,\r\n      wallPaper.settings.third_background_color,\r\n      wallPaper.settings.fourth_background_color\r\n    ].filter(Boolean).map((color) => '#' + color.toString(16)).join(',') : '';\r\n  }\r\n\r\n  private getWallPaperKey(wallPaper: WallPaper) {\r\n    return '' + wallPaper.id;\r\n  }\r\n\r\n  private getWallPaperKeyFromTheme(theme: Theme) {\r\n    return '' + theme.background.id;\r\n  }\r\n\r\n  private addWallPaper(wallPaper: WallPaper, append = true) {\r\n    const colors = this.getColorsFromWallPaper(wallPaper);\r\n    const hasFile = wallPaper._ === 'wallPaper';\r\n    if((hasFile && wallPaper.pFlags.pattern && !colors)/*  ||\r\n      (wallpaper.document as MyDocument).mime_type.indexOf('application/') === 0 */) {\r\n      return;\r\n    }\r\n\r\n    const isDark = !!wallPaper.pFlags.dark;\r\n\r\n    const doc = hasFile ? wallPaper.document as Document.document : undefined;\r\n\r\n    const container = document.createElement('div');\r\n    container.classList.add('grid-item');\r\n\r\n    container.dataset.id = '' + wallPaper.id;\r\n\r\n    const key = this.getWallPaperKey(wallPaper);\r\n    this.wallPapersByElement.set(container, wallPaper);\r\n    this.elementsByKey.set(key, container);\r\n\r\n    const media = document.createElement('div');\r\n    media.classList.add('grid-item-media');\r\n\r\n    let wrapped: ReturnType<typeof wrapPhoto>, size: ReturnType<typeof choosePhotoSize>;\r\n    if(hasFile) {\r\n      size = choosePhotoSize(doc, 200, 200);\r\n      wrapped = wrapPhoto({\r\n        photo: doc,\r\n        message: null,\r\n        container: media,\r\n        withoutPreloader: true,\r\n        size: size,\r\n        noFadeIn: wallPaper.pFlags.pattern\r\n      });\r\n\r\n      if(wallPaper.pFlags.pattern) {\r\n        media.classList.add('is-pattern');\r\n      }\r\n\r\n      wrapped.then(async({loadPromises, images}) => {\r\n        await loadPromises.thumb || loadPromises.full;\r\n        return images;\r\n      }).then((images) => {\r\n        if(wallPaper.pFlags.pattern) {\r\n          if(isDark) {\r\n            images.full.style.display = 'none';\r\n            if(images.thumb) {\r\n              images.thumb.style.display = 'none';\r\n            }\r\n          } else if(wallPaper.settings?.intensity) {\r\n            images.full.style.opacity = '' + Math.abs(wallPaper.settings.intensity) / 100;\r\n          }\r\n        }\r\n\r\n        sequentialDom.mutate(() => {\r\n          container.append(media);\r\n        });\r\n      });\r\n    } else {\r\n      container.append(media);\r\n    }\r\n\r\n    if(wallPaper.settings && wallPaper.settings.background_color !== undefined) {\r\n      const {canvas} = ChatBackgroundGradientRenderer.create(colors);\r\n      canvas.classList.add('background-colors-canvas');\r\n\r\n      if(isDark && hasFile) {\r\n        wrapped.then(({loadPromises}) => {\r\n          loadPromises.full.then(async() => {\r\n            const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc, size.type);\r\n            canvas.style.webkitMaskImage = `url(${cacheContext.url})`;\r\n            canvas.style.opacity = '' + (wallPaper.pFlags.dark ? 100 + wallPaper.settings.intensity : wallPaper.settings.intensity) / 100;\r\n            media.append(canvas);\r\n          });\r\n        });\r\n      } else {\r\n        media.append(canvas);\r\n      }\r\n    }\r\n\r\n    if(this.getWallPaperKeyFromTheme(this.theme) === key) {\r\n      container.classList.add('active');\r\n    }\r\n\r\n    this.grid[append ? 'append' : 'prepend'](container);\r\n\r\n    return container;\r\n  }\r\n\r\n  private onGridClick = (e: MouseEvent | TouchEvent) => {\r\n    const target = findUpClassName(e.target, 'grid-item') as HTMLElement;\r\n    if(!target) return;\r\n\r\n    const wallpaper = this.wallPapersByElement.get(target);\r\n    if(wallpaper._ === 'wallPaperNoFile') {\r\n      this.setBackgroundDocument(wallpaper);\r\n      return;\r\n    }\r\n\r\n    const key = this.getWallPaperKey(wallpaper);\r\n    if(this.clicked.has(key)) return;\r\n    this.clicked.add(key);\r\n\r\n    const doc = wallpaper.document as MyDocument;\r\n    const preloader = new ProgressivePreloader({\r\n      cancelable: true,\r\n      tryAgainOnFail: false\r\n    });\r\n\r\n    const load = async() => {\r\n      const promise = this.setBackgroundDocument(wallpaper);\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(!cacheContext.url || this.theme.background.blur) {\r\n        preloader.attach(target, true, promise);\r\n      }\r\n    };\r\n\r\n    preloader.construct();\r\n\r\n    attachClickEvent(target, (e) => {\r\n      if(preloader.preloader.parentElement) {\r\n        preloader.onClick(e);\r\n        preloader.detach();\r\n      } else {\r\n        load();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    load();\r\n\r\n    // console.log(doc);\r\n  };\r\n\r\n  private saveToCache = (slug: string, url: string) => {\r\n    fetch(url).then((response) => {\r\n      appImManager.cacheStorage.save('backgrounds/' + slug, response);\r\n    });\r\n  };\r\n\r\n  private setBackgroundDocument = (wallPaper: WallPaper) => {\r\n    const _tempId = ++this.tempId;\r\n    const middleware = () => _tempId === this.tempId;\r\n\r\n    const doc = (wallPaper as WallPaper.wallPaper).document as MyDocument;\r\n    const deferred = deferredPromise<void>();\r\n    let download: Promise<void> | ReturnType<AppDownloadManager['downloadMediaURL']>;\r\n    if(doc) {\r\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId: appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : 0});\r\n      deferred.addNotifyListener = download.addNotifyListener;\r\n      deferred.cancel = download.cancel;\r\n    } else {\r\n      download = Promise.resolve();\r\n    }\r\n\r\n    download.then(async() => {\r\n      if(!middleware()) {\r\n        deferred.resolve();\r\n        return;\r\n      }\r\n\r\n      const background = this.theme.background;\r\n      const onReady = (url?: string) => {\r\n        // const perf = performance.now();\r\n        let getPixelPromise: Promise<Uint8ClampedArray>;\r\n        if(url && !this.theme.background.color) {\r\n          getPixelPromise = averageColor(url);\r\n        } else {\r\n          const {canvas} = ChatBackgroundGradientRenderer.create(this.getColorsFromWallPaper(wallPaper));\r\n          getPixelPromise = Promise.resolve(averageColorFromCanvas(canvas));\r\n        }\r\n\r\n        getPixelPromise.then((pixel) => {\r\n          if(!middleware()) {\r\n            deferred.resolve();\r\n            return;\r\n          }\r\n\r\n          const hsla = highlightningColor(Array.from(pixel) as any);\r\n          // const hsla = 'rgba(0, 0, 0, 0.3)';\r\n          // console.log(doc, hsla, performance.now() - perf);\r\n\r\n          const slug = (wallPaper as WallPaper.wallPaper).slug ?? '';\r\n          background.id = wallPaper.id;\r\n          background.intensity = wallPaper.settings?.intensity ?? 0;\r\n          background.color = this.getColorsFromWallPaper(wallPaper);\r\n          background.slug = slug;\r\n          background.highlightningColor = hsla;\r\n          this.managers.appStateManager.pushToState('settings', rootScope.settings);\r\n\r\n          if(slug) {\r\n            this.saveToCache(slug, url);\r\n          }\r\n\r\n          appImManager.applyCurrentTheme(slug, url, true).then(deferred.resolve);\r\n        });\r\n      };\r\n\r\n      if(!doc) {\r\n        onReady();\r\n        return;\r\n      }\r\n\r\n      const cacheContext = await this.managers.thumbsStorage.getCacheContext(doc);\r\n      if(background.blur) {\r\n        setTimeout(() => {\r\n          const {canvas, promise} = blur(cacheContext.url, 12, 4)\r\n          promise.then(() => {\r\n            if(!middleware()) {\r\n              deferred.resolve();\r\n              return;\r\n            }\r\n\r\n            onReady(canvas.toDataURL());\r\n          });\r\n        }, 200);\r\n      } else {\r\n        onReady(cacheContext.url);\r\n      }\r\n    });\r\n\r\n    return deferred;\r\n  };\r\n\r\n  private setActive = () => {\r\n    const active = this.grid.querySelector('.active');\r\n    const target = this.elementsByKey.get(this.getWallPaperKeyFromTheme(this.theme));\r\n    if(active === target) {\r\n      return;\r\n    }\r\n\r\n    if(active) {\r\n      active.classList.remove('active');\r\n    }\r\n\r\n    if(target) {\r\n      target.classList.add('active');\r\n    }\r\n  };\r\n}\r\n","export default function requestFile(accept?: string) {\n  const input = document.createElement('input');\n  input.type = 'file';\n  input.style.display = 'none';\n\n  if(accept) {\n    input.accept = accept;\n  }\n\n  document.body.append(input);\n\n  const promise = new Promise<File>((resolve, reject) => {\n    input.addEventListener('change', (e: any) => {\n      const file: File = e.target.files[0];\n      if(!file) {\n        reject('NO_FILE_SELECTED');\n        return;\n      }\n\n      resolve(file);\n    }, {once: true});\n  }).finally(() => {\n    input.remove();\n  });\n\n  input.click();\n\n  return promise;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SettingSection} from '..';\nimport {AvailableReaction} from '../../../layer';\nimport RadioField from '../../radioField';\nimport Row, {RadioFormFromRows} from '../../row';\nimport SliderSuperTab from '../../sliderTab';\nimport wrapStickerToRow from '../../wrappers/stickerToRow';\n\nexport default class AppQuickReactionTab extends SliderSuperTab {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DoubleTapSetting');\n    this.container.classList.add('quick-reaction-container');\n\n    return Promise.all([\n      this.managers.appReactionsManager.getQuickReaction(),\n      this.managers.appReactionsManager.getAvailableReactions()\n    ]).then(([quickReaction, availableReactions]) => {\n      availableReactions = availableReactions.filter((reaction) => !reaction.pFlags.inactive);\n\n      const section = new SettingSection();\n\n      const name = 'quick-reaction';\n      const rows = availableReactions.map((availableReaction) => {\n        const radioField = new RadioField({\n          name,\n          text: availableReaction.title,\n          value: availableReaction.reaction,\n          alignRight: true\n        });\n\n        const row = new Row({\n          radioField,\n          havePadding: true\n        });\n\n        radioField.main.classList.add('quick-reaction-title');\n\n        wrapStickerToRow({\n          row,\n          doc: availableReaction.static_icon,\n          size: 'small'\n        });\n\n        if(availableReaction.reaction === (quickReaction as AvailableReaction).reaction) {\n          radioField.setValueSilently(true);\n        }\n\n        return row;\n      });\n\n      const form = RadioFormFromRows(rows, (value) => {\n        this.managers.appReactionsManager.setDefaultReaction({_: 'reactionEmoji', emoticon: value});\n      });\n\n      section.content.append(form);\n      this.scrollable.append(section.container);\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {generateSection, SettingSection} from '..';\r\nimport RangeSelector from '../../rangeSelector';\r\nimport Button from '../../button';\r\nimport CheckboxField from '../../checkboxField';\r\nimport RadioField from '../../radioField';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {IS_APPLE} from '../../../environment/userAgent';\r\nimport Row from '../../row';\r\nimport AppBackgroundTab from './background';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport assumeType from '../../../helpers/assumeType';\r\nimport {AvailableReaction, MessagesAllStickers, StickerSet} from '../../../layer';\r\nimport LazyLoadQueue from '../../lazyLoadQueue';\r\nimport PopupStickers from '../../popups/stickers';\r\nimport eachMinute from '../../../helpers/eachMinute';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport IS_GEOLOCATION_SUPPORTED from '../../../environment/geolocationSupport';\r\nimport AppQuickReactionTab from './quickReaction';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {State} from '../../../config/state';\r\nimport wrapStickerSetThumb from '../../wrappers/stickerSetThumb';\r\nimport wrapStickerToRow from '../../wrappers/stickerToRow';\r\n\r\nexport class RangeSettingSelector {\r\n  public container: HTMLDivElement;\r\n  public valueContainer: HTMLElement;\r\n  private range: RangeSelector;\r\n\r\n  public onChange: (value: number) => void;\r\n\r\n  constructor(\r\n    name: LangPackKey,\r\n    step: number,\r\n    initialValue: number,\r\n    minValue: number,\r\n    maxValue: number,\r\n    writeValue = true\r\n  ) {\r\n    const BASE_CLASS = 'range-setting-selector';\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add(BASE_CLASS);\r\n\r\n    const details = document.createElement('div');\r\n    details.classList.add(BASE_CLASS + '-details');\r\n\r\n    const nameDiv = document.createElement('div');\r\n    nameDiv.classList.add(BASE_CLASS + '-name');\r\n    _i18n(nameDiv, name);\r\n\r\n    const valueDiv = this.valueContainer = document.createElement('div');\r\n    valueDiv.classList.add(BASE_CLASS + '-value');\r\n\r\n    if(writeValue) {\r\n      valueDiv.innerHTML = '' + initialValue;\r\n    }\r\n\r\n    details.append(nameDiv, valueDiv);\r\n\r\n    this.range = new RangeSelector({\r\n      step,\r\n      min: minValue,\r\n      max: maxValue\r\n    }, initialValue);\r\n    this.range.setListeners();\r\n    this.range.setHandlers({\r\n      onScrub: value => {\r\n        if(this.onChange) {\r\n          this.onChange(value);\r\n        }\r\n\r\n        if(writeValue) {\r\n          // console.log('font size scrub:', value);\r\n          valueDiv.innerText = '' + value;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.container.append(details, this.range.container);\r\n  }\r\n}\r\n\r\nexport default class AppGeneralSettingsTab extends SliderSuperTabEventable {\r\n  init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('general-settings-container');\r\n    this.setTitle('General');\r\n\r\n    const section = generateSection.bind(null, this.scrollable);\r\n\r\n    {\r\n      const container = section('Settings');\r\n\r\n      const range = new RangeSettingSelector('TextSize', 1, rootScope.settings.messagesTextSize, 12, 20);\r\n      range.onChange = (value) => {\r\n        rootScope.managers.appStateManager.setByKey('settings.messagesTextSize', value);\r\n      };\r\n\r\n      const chatBackgroundButton = Button('btn-primary btn-transparent', {icon: 'image', text: 'ChatBackground'});\r\n\r\n      attachClickEvent(chatBackgroundButton, () => {\r\n        this.slider.createTab(AppBackgroundTab).open();\r\n      });\r\n\r\n      const animationsCheckboxField = new CheckboxField({\r\n        text: 'EnableAnimations',\r\n        name: 'animations',\r\n        stateKey: 'settings.animationsEnabled',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(range.container, chatBackgroundButton, animationsCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const container = section('General.Keyboard');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'send-shortcut';\r\n      const stateKey = 'settings.sendShortcut';\r\n\r\n      const enterRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'General.SendShortcut.Enter',\r\n          name,\r\n          value: 'enter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.ShiftEnter'\r\n      });\r\n\r\n      const ctrlEnterRow = new Row({\r\n        radioField: new RadioField({\r\n          name,\r\n          value: 'ctrlEnter',\r\n          stateKey\r\n        }),\r\n        subtitleLangKey: 'General.SendShortcut.NewLine.Enter'\r\n      });\r\n      _i18n(ctrlEnterRow.radioField.main, 'General.SendShortcut.CtrlEnter', [IS_APPLE ? '' : 'Ctrl']);\r\n\r\n      form.append(enterRow.container, ctrlEnterRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    if(IS_GEOLOCATION_SUPPORTED) {\r\n      const container = section('DistanceUnitsTitle');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'distance-unit';\r\n      const stateKey = 'settings.distanceUnit';\r\n\r\n      const kilometersRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsKilometers',\r\n          name,\r\n          value: 'kilometers',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      const milesRow = new Row({\r\n        radioField: new RadioField({\r\n          langKey: 'DistanceUnitsMiles',\r\n          name,\r\n          value: 'miles',\r\n          stateKey\r\n        })\r\n      });\r\n\r\n      form.append(kilometersRow.container, milesRow.container);\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('General.TimeFormat');\r\n\r\n      const form = document.createElement('form');\r\n\r\n      const name = 'time-format';\r\n      const stateKey = 'settings.timeFormat';\r\n\r\n      const formats: [State['settings']['timeFormat'], LangPackKey][] = [\r\n        ['h12', 'General.TimeFormat.h12'],\r\n        ['h23', 'General.TimeFormat.h23']\r\n      ];\r\n\r\n      const rows = formats.map(([format, langPackKey]) => {\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            langKey: langPackKey,\r\n            name,\r\n            value: format,\r\n            stateKey\r\n          })\r\n        });\r\n\r\n        return row;\r\n      });\r\n\r\n      const cancel = eachMinute(() => {\r\n        const date = new Date();\r\n\r\n        formats.forEach(([format], idx) => {\r\n          const str = date.toLocaleTimeString('en-us-u-hc-' + format, {\r\n            hour: '2-digit',\r\n            minute: '2-digit'\r\n          });\r\n\r\n          rows[idx].subtitle.textContent = str;\r\n        });\r\n      });\r\n\r\n      this.eventListener.addEventListener('destroy', cancel);\r\n\r\n      form.append(...rows.map((row) => row.container));\r\n      container.append(form);\r\n    }\r\n\r\n    {\r\n      const container = section('Emoji');\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.EmojiPrediction',\r\n        name: 'suggest-emoji',\r\n        stateKey: 'settings.emoji.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const bigCheckboxField = new CheckboxField({\r\n        text: 'GeneralSettings.BigEmoji',\r\n        name: 'emoji-big',\r\n        stateKey: 'settings.emoji.big',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      container.append(suggestCheckboxField.label, bigCheckboxField.label);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({name: 'Telegram.InstalledStickerPacksController', caption: 'StickersBotInfo'});\r\n\r\n      const reactionsRow = new Row({\r\n        titleLangKey: 'DoubleTapSetting',\r\n        havePadding: true,\r\n        clickable: () => {\r\n          this.slider.createTab(AppQuickReactionTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const renderQuickReaction = () => {\r\n        this.managers.appReactionsManager.getQuickReaction().then((reaction) => {\r\n          if(reaction._ === 'availableReaction') {\r\n            return reaction.static_icon;\r\n          } else {\r\n            return this.managers.appEmojiManager.getCustomEmojiDocument(reaction.document_id);\r\n          }\r\n        }).then((doc) => {\r\n          wrapStickerToRow({\r\n            row: reactionsRow,\r\n            doc,\r\n            size: 'small'\r\n          });\r\n        });\r\n      };\r\n\r\n      renderQuickReaction();\r\n\r\n      this.listenerSetter.add(rootScope)('quick_reaction', renderQuickReaction);\r\n\r\n      const suggestCheckboxField = new CheckboxField({\r\n        text: 'Stickers.SuggestStickers',\r\n        name: 'suggest',\r\n        stateKey: 'settings.stickers.suggest',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      const loopCheckboxField = new CheckboxField({\r\n        text: 'InstalledStickers.LoopAnimated',\r\n        name: 'loop',\r\n        stateKey: 'settings.stickers.loop',\r\n        withRipple: true,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const stickerSets: {[id: string]: Row} = {};\r\n\r\n      const stickersContent = section.generateContentElement();\r\n\r\n      const lazyLoadQueue = new LazyLoadQueue();\r\n      const renderStickerSet = (stickerSet: StickerSet.stickerSet, method: 'append' | 'prepend' = 'append') => {\r\n        const row = new Row({\r\n          title: wrapEmojiText(stickerSet.title),\r\n          subtitleLangKey: 'Stickers',\r\n          subtitleLangArgs: [stickerSet.count],\r\n          havePadding: true,\r\n          clickable: () => {\r\n            new PopupStickers({id: stickerSet.id, access_hash: stickerSet.access_hash}).show();\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        stickerSets[stickerSet.id] = row;\r\n\r\n        const div = document.createElement('div');\r\n        div.classList.add('row-media');\r\n\r\n        wrapStickerSetThumb({\r\n          set: stickerSet,\r\n          container: div,\r\n          group: 'GENERAL-SETTINGS',\r\n          lazyLoadQueue,\r\n          width: 48,\r\n          height: 48,\r\n          autoplay: true\r\n        });\r\n\r\n        row.container.append(div);\r\n\r\n        stickersContent[method](row.container);\r\n      };\r\n\r\n      this.managers.appStickersManager.getAllStickers().then((allStickers) => {\r\n        assumeType<MessagesAllStickers.messagesAllStickers>(allStickers);\r\n        for(const stickerSet of allStickers.sets) {\r\n          renderStickerSet(stickerSet);\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_installed', (set) => {\r\n        if(!stickerSets[set.id]) {\r\n          renderStickerSet(set, 'prepend');\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('stickers_deleted', (set) => {\r\n        if(stickerSets[set.id]) {\r\n          stickerSets[set.id].container.remove();\r\n          delete stickerSets[set.id];\r\n        }\r\n      });\r\n\r\n      section.content.append(reactionsRow.container, suggestCheckboxField.label, loopCheckboxField.label);\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport eachTimeout from './eachTimeout';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachMinute(callback: () => any, runFirst = true) {\n  return eachTimeout(callback, () => (60 - new Date().getSeconds()) * 1000, runFirst);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../environment/ctx';\nimport noop from './noop';\n\n// It's better to use timeout instead of interval, because interval can be corrupted\nexport default function eachTimeout(callback: () => any, getNextTimeout: () => number, runFirst = true) {\n  const cancel = () => {\n    clearTimeout(timeout);\n  };\n\n  // replace callback to run noop and restore after\n  const _callback = callback;\n  if(!runFirst) {\n    callback = noop;\n  }\n\n  let timeout: number;\n  (function run() {\n    callback();\n    timeout = ctx.setTimeout(run, getNextTimeout());\n  })();\n\n  callback = _callback;\n\n  return cancel;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport EditPeer from '../../editPeer';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {i18n, i18n_} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {generateSection, SettingSection} from '..';\r\n\r\n// TODO:         - (    ,    ,      )\r\n\r\nexport default class AppEditProfileTab extends SliderSuperTab {\r\n  private firstNameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private bioInputField: InputField;\r\n  private usernameInputField: InputField;\r\n\r\n  private profileUrlContainer: HTMLDivElement;\r\n  private profileUrlAnchor: HTMLAnchorElement;\r\n\r\n  private editPeer: EditPeer;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-profile-container');\r\n    this.setTitle('EditAccount.Title');\r\n\r\n    const inputFields: InputField[] = [];\r\n\r\n    {\r\n      const section = generateSection(this.scrollable, undefined, 'Bio.Description');\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      const appConfig = await this.managers.apiManager.getAppConfig();\r\n      this.firstNameInputField = new InputField({\r\n        label: 'EditProfile.FirstNameLabel',\r\n        name: 'first-name',\r\n        maxLength: 70\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'Login.Register.LastName.Placeholder',\r\n        name: 'last-name',\r\n        maxLength: 64\r\n      });\r\n      this.bioInputField = new InputField({\r\n        label: 'EditProfile.BioLabel',\r\n        name: 'bio',\r\n        maxLength: rootScope.premium ? appConfig.about_length_limit_premium : appConfig.about_length_limit_default\r\n      });\r\n\r\n      inputWrapper.append(this.firstNameInputField.container, this.lastNameInputField.container, this.bioInputField.container);\r\n\r\n      const caption = document.createElement('div');\r\n      caption.classList.add('caption');\r\n      i18n_({element: caption, key: 'Bio.Description'});\r\n\r\n      inputFields.push(this.firstNameInputField, this.lastNameInputField, this.bioInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: rootScope.myId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n    }\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'EditAccount.Username',\r\n        caption: true\r\n      });\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.usernameInputField = new UsernameInputField({\r\n        label: 'EditProfile.Username.Label',\r\n        name: 'username',\r\n        plainText: true,\r\n        listenerSetter: this.listenerSetter,\r\n        onChange: () => {\r\n          this.editPeer.handleChange();\r\n          this.setProfileUrl();\r\n        },\r\n        availableText: 'EditProfile.Username.Available',\r\n        takenText: 'EditProfile.Username.Taken',\r\n        invalidText: 'EditProfile.Username.Invalid'\r\n      }, this.managers);\r\n\r\n      inputWrapper.append(this.usernameInputField.container);\r\n\r\n      const caption = section.caption;\r\n      caption.append(i18n('UsernameSettings.ChangeDescription'));\r\n      caption.append(document.createElement('br'), document.createElement('br'));\r\n\r\n      const profileUrlContainer = this.profileUrlContainer = document.createElement('div');\r\n      profileUrlContainer.classList.add('profile-url-container');\r\n\r\n      const profileUrlAnchor = this.profileUrlAnchor = document.createElement('a');\r\n      profileUrlAnchor.classList.add('profile-url');\r\n      profileUrlAnchor.href = '#';\r\n      profileUrlAnchor.target = '_blank';\r\n\r\n      profileUrlContainer.append(i18n('UsernameHelpLink', [profileUrlAnchor]));\r\n\r\n      caption.append(profileUrlContainer);\r\n\r\n      inputFields.push(this.usernameInputField);\r\n      section.content.append(inputWrapper);\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    attachClickEvent(this.editPeer.nextBtn, () => {\r\n      this.editPeer.nextBtn.disabled = true;\r\n\r\n      const promises: Promise<any>[] = [];\r\n\r\n      promises.push(this.managers.appProfileManager.updateProfile(this.firstNameInputField.value, this.lastNameInputField.value, this.bioInputField.value).then(() => {\r\n        this.close();\r\n      }, (err) => {\r\n        console.error('updateProfile error:', err);\r\n      }));\r\n\r\n      if(this.editPeer.uploadAvatar) {\r\n        promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        }));\r\n      }\r\n\r\n      if(this.usernameInputField.isValidToChange()) {\r\n        promises.push(this.managers.appUsersManager.updateUsername(this.usernameInputField.value));\r\n      }\r\n\r\n      Promise.race(promises).finally(() => {\r\n        this.editPeer.nextBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const user = await this.managers.appUsersManager.getSelf();\r\n\r\n    const userFull = await this.managers.appProfileManager.getProfile(user.id, true);\r\n\r\n    this.firstNameInputField.setOriginalValue(user.first_name, true);\r\n    this.lastNameInputField.setOriginalValue(user.last_name, true);\r\n    this.bioInputField.setOriginalValue(userFull.about, true);\r\n    this.usernameInputField.setOriginalValue(user.username, true);\r\n\r\n    this.setProfileUrl();\r\n    this.editPeer.handleChange();\r\n  }\r\n\r\n  private setProfileUrl() {\r\n    if(this.usernameInputField.input.classList.contains('error') || !this.usernameInputField.value.length) {\r\n      this.profileUrlContainer.style.display = 'none';\r\n    } else {\r\n      this.profileUrlContainer.style.display = '';\r\n      const url = 'https://t.me/' + this.usernameInputField.value;\r\n      this.profileUrlAnchor.innerText = url;\r\n      this.profileUrlAnchor.href = url;\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport {InputNotifyPeer, Update} from '../../../layer';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {LangPackKey} from '../../../lib/langPack';\r\nimport copy from '../../../helpers/object/copy';\r\nimport convertKeyToInputKey from '../../../helpers/string/convertKeyToInputKey';\r\nimport {MUTE_UNTIL} from '../../../lib/mtproto/mtproto_config';\r\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\r\n\r\ntype InputNotifyKey = Exclude<InputNotifyPeer['_'], 'inputNotifyPeer'>;\r\n\r\nexport default class AppNotificationsTab extends SliderSuperTabEventable {\r\n  protected init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('notifications-container', 'with-border');\r\n    this.setTitle('Telegram.NotificationSettingsViewController');\r\n\r\n    const NotifySection = (options: {\r\n      name: LangPackKey,\r\n      typeText: LangPackKey,\r\n      inputKey: InputNotifyKey,\r\n    }) => {\r\n      const section = new SettingSection({\r\n        name: options.name\r\n      });\r\n\r\n      const enabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: options.typeText, checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const previewEnabledRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'MessagePreview', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      section.content.append(enabledRow.container, previewEnabledRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      const inputNotifyPeer = {_: options.inputKey};\r\n      const ret = this.managers.appNotificationsManager.getNotifySettings(inputNotifyPeer);\r\n      (ret instanceof Promise ? ret : Promise.resolve(ret)).then((notifySettings) => {\r\n        const applySettings = async() => {\r\n          const muted = await this.managers.appNotificationsManager.isMuted(notifySettings);\r\n          enabledRow.checkboxField.checked = !muted;\r\n          previewEnabledRow.checkboxField.checked = notifySettings.show_previews;\r\n\r\n          return muted;\r\n        };\r\n\r\n        applySettings();\r\n\r\n        this.eventListener.addEventListener('destroy', async() => {\r\n          const mute = !enabledRow.checkboxField.checked;\r\n          const showPreviews = previewEnabledRow.checkboxField.checked;\r\n\r\n          if(mute === (await this.managers.appNotificationsManager.isMuted(notifySettings)) && showPreviews === notifySettings.show_previews) {\r\n            return;\r\n          }\r\n\r\n          const inputSettings: any = copy(notifySettings);\r\n          inputSettings._ = 'inputPeerNotifySettings';\r\n          inputSettings.mute_until = mute ? MUTE_UNTIL : 0;\r\n          inputSettings.show_previews = showPreviews;\r\n\r\n          this.managers.appNotificationsManager.updateNotifySettings(inputNotifyPeer, inputSettings);\r\n        }, {once: true});\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', (update: Update.updateNotifySettings) => {\r\n          const inputKey = convertKeyToInputKey(update.peer._) as any;\r\n          if(options.inputKey === inputKey) {\r\n            notifySettings = update.notify_settings;\r\n            applySettings();\r\n          }\r\n        });\r\n      });\r\n    };\r\n\r\n    NotifySection({\r\n      name: 'NotificationsPrivateChats',\r\n      typeText: 'NotificationsForPrivateChats',\r\n      inputKey: 'inputNotifyUsers'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsGroups',\r\n      typeText: 'NotificationsForGroups',\r\n      inputKey: 'inputNotifyChats'\r\n    });\r\n\r\n    NotifySection({\r\n      name: 'NotificationsChannels',\r\n      typeText: 'NotificationsForChannels',\r\n      inputKey: 'inputNotifyBroadcasts'\r\n    });\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'NotificationsOther'\r\n      });\r\n\r\n      const contactsSignUpRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'ContactJoined', checked: true}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      const soundRow = new Row({\r\n        checkboxField: new CheckboxField({text: 'Notifications.Sound', checked: true, stateKey: 'settings.notifications.sound', listenerSetter: this.listenerSetter}),\r\n        subtitleLangKey: 'Loading',\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n\r\n      apiManagerProxy.getState().then((state) => {\r\n        soundRow.checkboxField.checked = state.settings.notifications.sound;\r\n      });\r\n\r\n      section.content.append(contactsSignUpRow.container, soundRow.container);\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      this.managers.appNotificationsManager.getContactSignUpNotification().then((enabled) => {\r\n        contactsSignUpRow.checkboxField.checked = enabled;\r\n\r\n        this.eventListener.addEventListener('destroy', () => {\r\n          const _enabled = contactsSignUpRow.checkboxField.checked;\r\n          if(enabled !== _enabled) {\r\n            this.managers.appNotificationsManager.setContactSignUpNotification(!_enabled);\r\n          }\r\n        }, {once: true});\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SettingSection} from '..';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport I18n from '../../../lib/langPack';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SliderSuperTab} from '../../slider'\r\n\r\nexport default class AppLanguageTab extends SliderSuperTab {\r\n  protected async init() {\r\n    this.header.classList.add('with-border');\r\n    this.container.classList.add('language-container');\r\n    this.setTitle('Telegram.LanguageViewController');\r\n\r\n    const section = new SettingSection({});\r\n\r\n    const radioRows: Map<string, Row> = new Map();\r\n\r\n    const promise = Promise.all([\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'web'\r\n      }),\r\n      this.managers.apiManager.invokeApiCacheable('langpack.getLanguages', {\r\n        lang_pack: 'macos'\r\n      }),\r\n    ]).then(([languages1, languages2]) => {\r\n      const rendered: Set<string> = new Set();\r\n      const webLangCodes = languages1.map((language) => language.lang_code);\r\n\r\n      const random = randomLong();\r\n      languages1.concat(languages2).forEach((language) => {\r\n        if(rendered.has(language.lang_code)) return;\r\n        rendered.add(language.lang_code);\r\n\r\n        const row = new Row({\r\n          radioField: new RadioField({\r\n            text: language.name,\r\n            name: random,\r\n            value: language.lang_code\r\n          }),\r\n          subtitle: language.native_name\r\n        });\r\n\r\n        radioRows.set(language.lang_code, row);\r\n      });\r\n\r\n      const form = RadioFormFromRows([...radioRows.values()], (value) => {\r\n        I18n.getLangPack(value, webLangCodes.includes(value));\r\n      });\r\n\r\n      I18n.getCacheLangPack().then((langPack) => {\r\n        const row = radioRows.get(langPack.lang_code);\r\n        if(!row) {\r\n          console.error('no row', row, langPack);\r\n          return;\r\n        }\r\n\r\n        row.radioField.setValueSilently(true);\r\n      });\r\n\r\n      section.content.append(form);\r\n    });\r\n\r\n    this.scrollable.append(section.container);\r\n\r\n    return promise;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../../../../helpers/listenerSetter';\nimport {SettingSection} from '../..';\nimport {LangPackKey} from '../../../../lib/langPack';\nimport CheckboxField from '../../../checkboxField';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\n\nexport function autoDownloadPeerTypeSection(type: 'photo' | 'video' | 'file', title: LangPackKey, listenerSetter: ListenerSetter) {\n  const section = new SettingSection({name: title});\n\n  const key = 'settings.autoDownload.' + type + '.';\n  const contactsCheckboxField = new CheckboxField({\n    text: 'AutodownloadContacts',\n    name: 'contacts',\n    stateKey: key + 'contacts',\n    withRipple: true,\n    listenerSetter\n  });\n  const privateCheckboxField = new CheckboxField({\n    text: 'AutodownloadPrivateChats',\n    name: 'private',\n    stateKey: key + 'private',\n    withRipple: true,\n    listenerSetter\n  });\n  const groupsCheckboxField = new CheckboxField({\n    text: 'AutodownloadGroupChats',\n    name: 'groups',\n    stateKey: key + 'groups',\n    withRipple: true,\n    listenerSetter\n  });\n  const channelsCheckboxField = new CheckboxField({\n    text: 'AutodownloadChannels',\n    name: 'channels',\n    stateKey: key + 'channels',\n    withRipple: true,\n    listenerSetter\n  });\n\n  section.content.append(\n    contactsCheckboxField.label,\n    privateCheckboxField.label,\n    groupsCheckboxField.label,\n    channelsCheckboxField.label\n  );\n\n  return section;\n}\n\nexport default class AppAutoDownloadPhotoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadPhotos');\n\n    const section = autoDownloadPeerTypeSection('photo', 'AutoDownloadPhotosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport formatBytes from '../../../../helpers/formatBytes';\nimport debounce from '../../../../helpers/schedulers/debounce';\nimport I18n from '../../../../lib/langPack';\nimport rootScope from '../../../../lib/rootScope';\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {RangeSettingSelector} from '../generalSettings';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadFileTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadFiles');\n\n    const debouncedSave = debounce((sizeMax: number) => {\n      this.managers.appStateManager.setByKey('settings.autoDownloadNew.file_size_max', sizeMax);\n    }, 200, false, true);\n\n    const section = autoDownloadPeerTypeSection('file', 'AutoDownloadFilesTitle', this.listenerSetter);\n\n    const MIN = 512 * 1024;\n    // const MAX = 2 * 1024 * 1024 * 1024;\n    const MAX = 20 * 1024 * 1024;\n    const MAX_RANGE = MAX - MIN;\n\n    const sizeMax = rootScope.settings.autoDownloadNew.file_size_max;\n    const value = Math.sqrt(Math.sqrt((sizeMax - MIN) / MAX_RANGE));\n    const upTo = new I18n.IntlElement({\n      key: 'AutodownloadSizeLimitUpTo',\n      args: [formatBytes(sizeMax)]\n    });\n    const range = new RangeSettingSelector('AutoDownloadMaxFileSize', 0.01, value, 0, 1, false);\n    range.onChange = (value) => {\n      const sizeMax = (value ** 4 * MAX_RANGE + MIN) | 0;\n\n      upTo.compareAndUpdate({args: [formatBytes(sizeMax)]});\n\n      debouncedSave(sizeMax);\n    };\n\n    range.valueContainer.append(upTo.element);\n\n    section.content.append(range.container);\n\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTabEventable} from '../../../sliderTab';\nimport {autoDownloadPeerTypeSection} from './photo';\n\nexport default class AppAutoDownloadVideoTab extends SliderSuperTabEventable {\n  protected init() {\n    this.header.classList.add('with-border');\n    this.setTitle('AutoDownloadVideos');\n\n    const section = autoDownloadPeerTypeSection('video', 'AutoDownloadVideosTitle', this.listenerSetter);\n    this.scrollable.append(section.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AutoDownloadPeerTypeSettings, STATE_INIT} from '../../../config/state';\nimport {SettingSection} from '..';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport formatBytes from '../../../helpers/formatBytes';\nimport copy from '../../../helpers/object/copy';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {FormatterArguments, i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport Button from '../../button';\nimport CheckboxField from '../../checkboxField';\nimport confirmationPopup from '../../confirmationPopup';\nimport Row from '../../row';\nimport {SliderSuperTabEventable, SliderSuperTabEventableConstructable} from '../../sliderTab';\nimport AppAutoDownloadFileTab from './autoDownload/file';\nimport AppAutoDownloadPhotoTab from './autoDownload/photo';\nimport AppAutoDownloadVideoTab from './autoDownload/video';\nimport apiManagerProxy from '../../../lib/mtproto/mtprotoworker';\n\nconst AUTO_DOWNLOAD_FOR_KEYS: {[k in keyof AutoDownloadPeerTypeSettings]: LangPackKey} = {\n  contacts: 'AutoDownloadContacts',\n  private: 'AutoDownloadPm',\n  groups: 'AutoDownloadGroups',\n  channels: 'AutoDownloadChannels'\n};\n\nexport default class AppDataAndStorageTab extends SliderSuperTabEventable {\n  protected async init() {\n    this.header.classList.add('with-border');\n    this.setTitle('DataSettings');\n\n    {\n      const section = new SettingSection({name: 'AutomaticMediaDownload', caption: 'AutoDownloadAudioInfo'});\n\n      const state = await apiManagerProxy.getState();\n\n      const autoCheckboxField = new CheckboxField({\n        text: 'AutoDownloadMedia',\n        name: 'auto',\n        checked: !state.settings.autoDownloadNew.pFlags.disabled,\n        withRipple: true\n      });\n\n      const onChange = () => {\n        toggleDisability([resetButton],\n          deepEqual(state.settings.autoDownload, STATE_INIT.settings.autoDownload) &&\n          deepEqual(state.settings.autoDownloadNew, STATE_INIT.settings.autoDownloadNew));\n      };\n\n      const setSubtitles = () => {\n        this.setAutoDownloadSubtitle(photoRow, state.settings.autoDownload.photo /* state.settings.autoDownloadNew.photo_size_max */);\n        this.setAutoDownloadSubtitle(videoRow, state.settings.autoDownload.video/* , state.settings.autoDownloadNew.video_size_max */);\n        this.setAutoDownloadSubtitle(fileRow, state.settings.autoDownload.file, state.settings.autoDownloadNew.file_size_max);\n      };\n\n      const openTab = (tabConstructor: SliderSuperTabEventableConstructable) => {\n        const tab = this.slider.createTab(tabConstructor);\n        tab.open();\n\n        this.listenerSetter.add(tab.eventListener)('destroy', () => {\n          setSubtitles();\n          onChange();\n        }, {once: true});\n      };\n\n      const photoRow = new Row({\n        titleLangKey: 'AutoDownloadPhotos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadPhotoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const videoRow = new Row({\n        titleLangKey: 'AutoDownloadVideos',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadVideoTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const fileRow = new Row({\n        titleLangKey: 'AutoDownloadFiles',\n        subtitle: '',\n        clickable: () => {\n          openTab(AppAutoDownloadFileTab);\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const resetButton = Button('btn-primary btn-transparent primary', {icon: 'delete', text: 'ResetAutomaticMediaDownload'});\n      attachClickEvent(resetButton, () => {\n        confirmationPopup({\n          titleLangKey: 'ResetAutomaticMediaDownloadAlertTitle',\n          descriptionLangKey: 'ResetAutomaticMediaDownloadAlert',\n          button: {\n            langKey: 'Reset'\n          }\n        }).then(() => {\n          const settings = rootScope.settings;\n          settings.autoDownloadNew = copy(STATE_INIT.settings.autoDownloadNew);\n          settings.autoDownload = copy(STATE_INIT.settings.autoDownload);\n          state.settings = settings;\n          this.managers.appStateManager.setByKey('settings', settings);\n\n          setSubtitles();\n          autoCheckboxField.checked = !state.settings.autoDownloadNew.pFlags.disabled;\n        });\n      });\n\n      const onDisabledChange = () => {\n        const disabled = !autoCheckboxField.checked;\n\n        const settings = rootScope.settings;\n        if(disabled) {\n          settings.autoDownloadNew.pFlags.disabled = true;\n        } else {\n          delete settings.autoDownloadNew.pFlags.disabled;\n        }\n\n        [photoRow, videoRow, fileRow].forEach((row) => {\n          row.container.classList.toggle('is-disabled', disabled);\n        });\n\n        this.managers.appStateManager.setByKey('settings', settings);\n\n        onChange();\n      };\n\n      autoCheckboxField.input.addEventListener('change', onDisabledChange);\n      onDisabledChange();\n      setSubtitles();\n\n      section.content.append(\n        autoCheckboxField.label,\n        photoRow.container,\n        videoRow.container,\n        fileRow.container,\n        resetButton\n      );\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({name: 'AutoplayMedia'});\n\n      const gifsCheckboxField = new CheckboxField({\n        text: 'AutoplayGIF',\n        name: 'gifs',\n        stateKey: 'settings.autoPlay.gifs',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n      const videosCheckboxField = new CheckboxField({\n        text: 'AutoplayVideo',\n        name: 'videos',\n        stateKey: 'settings.autoPlay.videos',\n        withRipple: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      section.content.append(gifsCheckboxField.label, videosCheckboxField.label);\n\n      this.scrollable.append(section.container);\n    }\n  }\n\n  private setAutoDownloadSubtitle(row: Row, settings: AutoDownloadPeerTypeSettings, sizeMax?: number) {\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n\n    const peerKeys = Object.keys(settings) as (keyof typeof AUTO_DOWNLOAD_FOR_KEYS)[];\n    const enabledKeys = peerKeys.map((key) => settings[key] ? AUTO_DOWNLOAD_FOR_KEYS[key] : undefined).filter(Boolean);\n    if(!enabledKeys.length || sizeMax === 0) {\n      key = 'AutoDownloadOff';\n    } else {\n      const isAll = enabledKeys.length === peerKeys.length;\n      if(sizeMax !== undefined) {\n        key = isAll ? 'AutoDownloadUpToOnAllChats' : 'AutoDownloadOnUpToFor';\n        args.push(formatBytes(sizeMax));\n      } else {\n        key = isAll ? 'AutoDownloadOnAllChats' : 'AutoDownloadOnFor';\n      }\n\n      if(!isAll) {\n        const fragment = document.createElement('span');\n        fragment.append(...join(enabledKeys.map((key) => i18n(key)), true, false));\n        args.push(fragment);\n      }\n    }\n\n    replaceContent(row.subtitle, i18n(key, args));\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport Button from '../../button';\r\nimport AppPrivacyAndSecurityTab from './privacyAndSecurity';\r\nimport AppGeneralSettingsTab from './generalSettings';\r\nimport AppEditProfileTab from './editProfile';\r\nimport AppChatFoldersTab from './chatFolders';\r\nimport AppNotificationsTab from './notifications';\r\nimport AppLanguageTab from './language';\r\nimport lottieLoader from '../../../lib/rlottie/lottieLoader';\r\nimport PopupPeer from '../../popups/peer';\r\nimport AppDataAndStorageTab from './dataAndStorage';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport PeerProfile from '../../peerProfile';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {SettingSection} from '..';\r\nimport Row from '../../row';\r\nimport AppActiveSessionsTab from './activeSessions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SliderSuperTabConstructable} from '../../sliderTab';\r\nimport PopupAvatar from '../../popups/avatar';\r\nimport {AccountAuthorizations, Authorization} from '../../../layer';\r\nimport PopupElement from '../../popups';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n// import AppMediaViewer from \"../../appMediaViewerNew\";\r\n\r\nexport default class AppSettingsTab extends SliderSuperTab {\r\n  private buttons: {\r\n    edit: HTMLButtonElement,\r\n    folders: HTMLButtonElement,\r\n    general: HTMLButtonElement,\r\n    notifications: HTMLButtonElement,\r\n    storage: HTMLButtonElement,\r\n    privacy: HTMLButtonElement,\r\n  } = {} as any;\r\n  private profile: PeerProfile;\r\n\r\n  private languageRow: Row;\r\n  private devicesRow: Row;\r\n\r\n  private authorizations: Authorization.authorization[];\r\n  private getAuthorizationsPromise: Promise<AccountAuthorizations.accountAuthorizations>;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('settings-container');\r\n    this.setTitle('Settings');\r\n\r\n    const btnMenu = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [{\r\n      icon: 'logout',\r\n      text: 'EditAccount.Logout',\r\n      onClick: () => {\r\n        new PopupPeer('logout', {\r\n          titleLangKey: 'LogOut',\r\n          descriptionLangKey: 'LogOut.Description',\r\n          buttons: [{\r\n            langKey: 'LogOut',\r\n            callback: () => {\r\n              this.managers.apiManager.logOut();\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    }]);\r\n\r\n    this.buttons.edit = ButtonIcon('edit');\r\n\r\n    this.header.append(this.buttons.edit, btnMenu);\r\n\r\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter, false);\r\n    this.profile.init();\r\n    this.profile.setPeer(rootScope.myId);\r\n    const fillPromise = this.profile.fillProfileElements();\r\n\r\n    const changeAvatarBtn = Button('btn-circle btn-corner z-depth-1 profile-change-avatar', {icon: 'cameraadd'});\r\n    attachClickEvent(changeAvatarBtn, () => {\r\n      const canvas = document.createElement('canvas');\r\n      PopupElement.createPopup(PopupAvatar).open(canvas, (upload) => {\r\n        upload().then((inputFile) => {\r\n          return this.managers.appProfileManager.uploadProfilePhoto(inputFile);\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n    this.profile.element.lastElementChild.firstElementChild.append(changeAvatarBtn);\r\n\r\n    const updateChangeAvatarBtn = async() => {\r\n      const user = await this.managers.appUsersManager.getSelf();\r\n      changeAvatarBtn.classList.toggle('hide', user.photo?._ !== 'userProfilePhoto');\r\n    };\r\n\r\n    updateChangeAvatarBtn();\r\n    this.listenerSetter.add(rootScope)('avatar_update', (peerId) => {\r\n      if(rootScope.myId === peerId) {\r\n        updateChangeAvatarBtn();\r\n      }\r\n    });\r\n\r\n    /* const div = document.createElement('div');\r\n    //div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem 0 10rem auto;';\r\n    //div.style.width = '135px';\r\n    //div.style.height = '100px';\r\n    div.style.cssText = 'border-radius: 8px; overflow: hidden; width: 396px; height: 264px; flex: 0 0 auto; position: relative; margin: 10rem auto 10rem 0;';\r\n    div.style.width = '135px';\r\n    div.style.height = '100px';\r\n\r\n    const img = document.createElement('img');\r\n    img.src = 'assets/img/pepe.jpg';\r\n    img.classList.add('media-photo');\r\n    img.style.cssText = 'max-width: 100%;max-height: 100%;';\r\n\r\n    div.append(img);\r\n\r\n    div.addEventListener('click', () => {\r\n      new AppMediaViewer().setSearchContext({peerId: 61004386, inputFilter: 'inputMessagesFilterPhotos'}).openMedia({\r\n        _: 'message',\r\n        mid: 1,\r\n        peerId: 61004386,\r\n        fromId: 61004386,\r\n        message: '',\r\n        media: {\r\n          _: 'messageMediaPhoto',\r\n          photo: {\r\n            _: 'photo',\r\n            url: img.src,\r\n            downloaded: 111,\r\n            sizes: [{\r\n              _: 'photoSize',\r\n              type: 'x',\r\n              w: 618,\r\n              h: 412\r\n            }]\r\n          }\r\n        },\r\n        date: Date.now() / 1000 | 0\r\n      }, img);\r\n    });\r\n\r\n    this.scrollable.append(div); */\r\n\r\n    const buttonsDiv = document.createElement('div');\r\n    buttonsDiv.classList.add('profile-buttons');\r\n\r\n    const b: [string, LangPackKey, SliderSuperTabConstructable][] = [\r\n      ['unmute', 'AccountSettings.Notifications', AppNotificationsTab],\r\n      ['data', 'DataSettings', AppDataAndStorageTab],\r\n      ['lock', 'AccountSettings.PrivacyAndSecurity', AppPrivacyAndSecurityTab],\r\n      ['settings', 'Telegram.GeneralSettingsViewController', AppGeneralSettingsTab],\r\n      ['folder', 'AccountSettings.Filters', AppChatFoldersTab]\r\n    ];\r\n\r\n    const rows = b.map(([icon, langPackKey, tabConstructor]) => {\r\n      return new Row({\r\n        titleLangKey: langPackKey,\r\n        icon,\r\n        clickable: () => {\r\n          this.slider.createTab(tabConstructor).open();\r\n          // new tabConstructor(this.slider, true).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n    });\r\n\r\n    rows.push(\r\n      this.devicesRow = new Row({\r\n        titleLangKey: 'Devices',\r\n        titleRightSecondary: ' ',\r\n        icon: 'activesessions',\r\n        clickable: async() => {\r\n          if(!this.authorizations) {\r\n            await this.updateActiveSessions();\r\n          }\r\n\r\n          const tab = this.slider.createTab(AppActiveSessionsTab);\r\n          tab.authorizations = this.authorizations;\r\n          tab.eventListener.addEventListener('destroy', () => {\r\n            this.authorizations = undefined;\r\n            this.updateActiveSessions(true);\r\n          }, {once: true});\r\n          tab.open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      }),\r\n\r\n      this.languageRow = new Row({\r\n        titleLangKey: 'AccountSettings.Language',\r\n        titleRightSecondary: i18n('LanguageName'),\r\n        icon: 'language',\r\n        clickable: () => {\r\n          this.slider.createTab(AppLanguageTab).open();\r\n        },\r\n        listenerSetter: this.listenerSetter\r\n      })\r\n    );\r\n\r\n    buttonsDiv.append(...rows.map((row) => row.container));\r\n\r\n    // const profileSection = new SettingSection({fullWidth: true, noPaddingTop: true});\r\n    // profileSection.content.append(this.profile.element);\r\n\r\n    const buttonsSection = new SettingSection();\r\n    buttonsSection.content.append(buttonsDiv);\r\n\r\n    this.scrollable.append(this.profile.element/* profileSection.container */, buttonsSection.container);\r\n\r\n    attachClickEvent(this.buttons.edit, () => {\r\n      const tab = this.slider.createTab(AppEditProfileTab);\r\n      tab.open();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    lottieLoader.loadLottieWorkers();\r\n\r\n    this.updateActiveSessions();\r\n\r\n    await fillPromise;\r\n  }\r\n\r\n  private getAuthorizations(overwrite?: boolean) {\r\n    if(this.getAuthorizationsPromise && !overwrite) return this.getAuthorizationsPromise;\r\n\r\n    const promise = this.getAuthorizationsPromise = this.managers.apiManager.invokeApi('account.getAuthorizations')\r\n    .finally(() => {\r\n      if(this.getAuthorizationsPromise === promise) {\r\n        this.getAuthorizationsPromise = undefined;\r\n      }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n\r\n  public updateActiveSessions(overwrite?: boolean) {\r\n    return this.getAuthorizations(overwrite).then((auths) => {\r\n      this.authorizations = auths.authorizations;\r\n      this.devicesRow.titleRight.textContent = '' + this.authorizations.length;\r\n    });\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.profile.destroy();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarLeft, {SettingSection} from '..';\r\nimport {InputFile} from '../../../layer';\r\nimport InputField from '../../inputField';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AvatarEdit from '../../avatarEdit';\r\nimport AppAddMembersTab from './addMembers';\r\nimport {_i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport appImManager from '../../../lib/appManagers/appImManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppNewChannelTab extends SliderSuperTab {\r\n  private uploadAvatar: () => Promise<InputFile> = null;\r\n\r\n  private channelNameInputField: InputField;\r\n  private channelDescriptionInputField: InputField;\r\n  private nextBtn: HTMLButtonElement;\r\n  private avatarEdit: AvatarEdit;\r\n\r\n  protected init() {\r\n    this.container.classList.add('new-channel-container');\r\n    this.setTitle('NewChannel');\r\n\r\n    this.avatarEdit = new AvatarEdit((_upload) => {\r\n      this.uploadAvatar = _upload;\r\n    });\r\n\r\n    const section = new SettingSection({\r\n      caption: 'Channel.DescriptionHolderDescrpiton'\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.channelNameInputField = new InputField({\r\n      label: 'EnterChannelName',\r\n      maxLength: 128\r\n    });\r\n\r\n    this.channelDescriptionInputField = new InputField({\r\n      label: 'DescriptionOptionalPlaceholder',\r\n      maxLength: 255\r\n    });\r\n\r\n    inputWrapper.append(this.channelNameInputField.container, this.channelDescriptionInputField.container);\r\n\r\n    const onLengthChange = () => {\r\n      this.nextBtn.classList.toggle('is-visible', !!this.channelNameInputField.value.length &&\r\n        !this.channelNameInputField.input.classList.contains('error') &&\r\n        !this.channelDescriptionInputField.input.classList.contains('error'));\r\n    };\r\n\r\n    this.channelNameInputField.input.addEventListener('input', onLengthChange);\r\n    this.channelDescriptionInputField.input.addEventListener('input', onLengthChange);\r\n\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n\r\n    attachClickEvent(this.nextBtn, () => {\r\n      const title = this.channelNameInputField.value;\r\n      const about = this.channelDescriptionInputField.value;\r\n\r\n      this.nextBtn.disabled = true;\r\n      this.managers.appChatsManager.createChannel({\r\n        title,\r\n        about,\r\n        broadcast: true\r\n      }).then((channelId) => {\r\n        if(this.uploadAvatar) {\r\n          this.uploadAvatar().then((inputFile) => {\r\n            this.managers.appChatsManager.editPhoto(channelId, inputFile);\r\n          });\r\n        }\r\n\r\n        appImManager.setInnerPeer({peerId: channelId.toPeerId(true)});\r\n\r\n        appSidebarLeft.removeTabFromHistory(this);\r\n        this.slider.createTab(AppAddMembersTab).open({\r\n          type: 'channel',\r\n          skippable: true,\r\n          title: 'GroupAddMembers',\r\n          placeholder: 'SendMessageTo',\r\n          takeOut: (peerIds) => {\r\n            return this.managers.appChatsManager.inviteToChannel(channelId, peerIds);\r\n          }\r\n        });\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.content.append(this.nextBtn);\r\n    section.content.append(this.avatarEdit.container, inputWrapper);\r\n    this.scrollable.append(section.container);\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    this.avatarEdit.clear();\r\n    this.uploadAvatar = null;\r\n    this.channelNameInputField.value = '';\r\n    this.channelDescriptionInputField.value = '';\r\n    this.nextBtn.disabled = false;\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport EditPeer from '../editPeer';\nimport {_i18n} from '../../lib/langPack';\nimport TelInputField from '../telInputField';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport {toastNew} from '../toast';\n\nexport default class PopupCreateContact extends PopupElement {\n  constructor() {\n    super('popup-create-contact popup-send-photo popup-new-media', {closable: true, withConfirm: 'Add', title: 'AddContactTitle'});\n    this.construct();\n  }\n\n  private async construct() {\n    attachClickEvent(this.btnConfirm, () => {\n      const promise = this.managers.appUsersManager.importContact(nameInputField.value, lastNameInputField.value, telInputField.value);\n\n      promise.then(() => {\n        this.hide();\n      }, (err) => {\n        if(err.type === 'NO_USER') {\n          toastNew({langPackKey: 'Contacts.PhoneNumber.NotRegistred'});\n          editPeer.disabled = false;\n        }\n      });\n\n      editPeer.lockWithPromise(promise);\n    }, {listenerSetter: this.listenerSetter});\n\n    const inputFields: InputField[] = [];\n    const div = document.createElement('div');\n    div.classList.add('name-fields');\n    const nameInputField = new InputField({\n      label: 'FirstName',\n      name: 'create-contact-name',\n      maxLength: 70,\n      required: true\n    });\n    const lastNameInputField = new InputField({\n      label: 'LastName',\n      name: 'create-contact-lastname',\n      maxLength: 70\n    });\n    const telInputField = new TelInputField({required: true});\n    inputFields.push(nameInputField, lastNameInputField, telInputField);\n\n    const onInput = () => {\n      const name = nameInputField.value + ' ' + lastNameInputField.value;\n      // const abbr = getAbbreviation(name);\n      editPeer.avatarElem.peerTitle = name;\n      editPeer.avatarElem.update();\n    };\n\n    this.listenerSetter.add(nameInputField.input)('input', onInput);\n    this.listenerSetter.add(lastNameInputField.input)('input', onInput);\n\n    telInputField.validate = () => {\n      return !!telInputField.value.match(/\\d/);\n    };\n\n    const user = await this.managers.appUsersManager.getSelf();\n    const formatted = formatPhoneNumber(user.phone);\n    if(formatted.code) {\n      telInputField.value = '+' + formatted.code.country_code;\n    }\n\n    const editPeer = new EditPeer({\n      inputFields,\n      listenerSetter: this.listenerSetter,\n      doNotEditAvatar: true,\n      nextBtn: this.btnConfirm,\n      avatarSize: 100\n    });\n\n    div.append(nameInputField.container, lastNameInputField.container, editPeer.avatarElem);\n    this.container.append(div, telInputField.container);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SliderSuperTab} from '../../slider';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport InputSearch from '../../inputSearch';\nimport {IS_MOBILE} from '../../../environment/userAgent';\nimport {canFocus} from '../../../helpers/dom/canFocus';\nimport windowSize from '../../../helpers/windowSize';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PopupCreateContact from '../../popups/createContact';\nimport SortedUserList from '../../sortedUserList';\nimport {getMiddleware} from '../../../helpers/middleware';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport rootScope from '../../../lib/rootScope';\nimport PopupElement from '../../popups';\n\n// TODO:    ,      \n\nexport default class AppContactsTab extends SliderSuperTab {\n  private inputSearch: InputSearch;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private sortedUserList: SortedUserList;\n\n  protected init() {\n    this.container.id = 'contacts-container';\n\n    // this.list = appDialogsManager.createChatList(/* {avatarSize: 48, handheldsSize: 66} */);\n\n    const btnAdd = ButtonCorner({icon: 'add', className: 'is-visible'});\n    this.content.append(btnAdd);\n\n    attachClickEvent(btnAdd, () => {\n      PopupElement.createPopup(PopupCreateContact);\n    }, {listenerSetter: this.listenerSetter});\n\n    this.inputSearch = new InputSearch('Search', (value) => {\n      this.openContacts(value);\n    });\n\n    this.listenerSetter.add(rootScope)('contacts_update', async(userId) => {\n      const isContact = await this.managers.appUsersManager.isContact(userId);\n      const peerId = userId.toPeerId();\n      if(isContact) this.sortedUserList.add(peerId);\n      else this.sortedUserList.delete(peerId);\n    });\n\n    this.title.replaceWith(this.inputSearch.container);\n\n    this.middleware = getMiddleware();\n\n    // preload contacts\n    // appUsersManager.getContacts();\n  }\n\n  protected createList() {\n    const sortedUserList = new SortedUserList({\n      managers: this.managers\n    });\n    const list = sortedUserList.list;\n    list.id = 'contacts';\n    list.classList.add('contacts-container');\n    appDialogsManager.setListClickListener(list, () => {\n      this.close();\n    }, undefined, true);\n    return sortedUserList;\n  }\n\n  protected onClose() {\n    this.middleware.clean();\n    /* // need to clear, and left 1 page for smooth slide\n    let pageCount = appPhotosManager.windowH / 72 * 1.25 | 0;\n    (Array.from(this.list.children) as HTMLElement[]).slice(pageCount).forEach((el) => el.remove()); */\n  }\n\n  protected onOpenAfterTimeout() {\n    if(IS_MOBILE || !canFocus(true)) return;\n    this.inputSearch.input.focus();\n  }\n\n  public openContacts(query?: string) {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.middleware.clean();\n    const middleware = this.middleware.get();\n    this.scrollable.onScrolledBottom = null;\n    this.scrollable.container.textContent = '';\n\n    this.managers.appUsersManager.getContactsPeerIds(query, undefined, 'online').then((contacts) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const sortedUserList = this.sortedUserList = this.createList();\n\n      let renderPage = () => {\n        const pageCount = windowSize.height / 72 * 1.25 | 0;\n        const arr = contacts.splice(0, pageCount); //  splice!\n\n        arr.forEach((peerId) => {\n          sortedUserList.add(peerId);\n        });\n\n        if(!contacts.length) {\n          renderPage = undefined;\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      renderPage();\n      this.scrollable.onScrolledBottom = () => {\n        if(renderPage) {\n          renderPage();\n        } else {\n          this.scrollable.onScrolledBottom = null;\n        }\n      };\n\n      replaceContent(this.scrollable.container, sortedUserList.list);\n    });\n  }\n\n  public open() {\n    this.openContacts();\n    return super.open();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport {SliderSuperTab} from '../../slider';\nimport {FOLDER_ID_ARCHIVE, REAL_FOLDER_ID} from '../../../lib/mtproto/mtproto_config';\n\nexport default class AppArchivedTab extends SliderSuperTab {\n  private static filterId: REAL_FOLDER_ID = FOLDER_ID_ARCHIVE;\n  private wasFilterId: number;\n\n  protected init() {\n    this.wasFilterId = appDialogsManager.filterId;\n\n    this.container.id = 'chats-archived-container';\n    this.setTitle('ArchivedChats');\n\n    if(!appDialogsManager.sortedLists[AppArchivedTab.filterId]) {\n      const chatList = appDialogsManager.createChatList();\n      const scrollable = appDialogsManager.generateScrollable(chatList, {\n        title: undefined,\n        id: AppArchivedTab.filterId,\n        localId: FOLDER_ID_ARCHIVE\n      });\n      scrollable.container.append(chatList);\n      appDialogsManager.setListClickListener(chatList, null, true);\n      // appDialogsManager.setListClickListener(archivedChatList, null, true); // * to test peer changing\n    }\n\n    const scrollable = appDialogsManager.scrollables[AppArchivedTab.filterId];\n    this.scrollable.container.replaceWith(scrollable.container);\n    // ! DO NOT UNCOMMENT NEXT LINE - chats will stop loading on scroll after closing the tab\n    // this.scrollable = scrollable;\n    return appDialogsManager.setFilterIdAndChangeTab(AppArchivedTab.filterId).then(({cached, renderPromise}) => {\n      if(cached) {\n        return renderPromise;\n      }\n    });\n  }\n\n  // ,   ,         ...\n  onOpenAfterTimeout() {\n    appDialogsManager.sortedLists[this.wasFilterId].clear();\n  }\n\n  onClose() {\n    appDialogsManager.setFilterIdAndChangeTab(this.wasFilterId);\n  }\n\n  onCloseAfterTimeout() {\n    appDialogsManager.sortedLists[AppArchivedTab.filterId].clear();\n    return super.onCloseAfterTimeout();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport AppNewGroupTab from './newGroup';\r\nimport {toast} from '../../toast';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport {i18n, join, _i18n} from '../../../lib/langPack';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport wrapSticker from '../../wrappers/sticker';\r\nimport SortedUserList from '../../sortedUserList';\r\nimport {PeerLocated, Update, Updates} from '../../../layer';\r\nimport {SettingChatListSection} from '..';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport confirmationPopup from '../../confirmationPopup';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../../lazyLoadQueue';\r\n\r\nexport default class AppPeopleNearbyTab extends SliderSuperTab {\r\n  private latestLocationSaved: {latitude: number, longitude: number, accuracy: number};\r\n  private isLocationWatched: boolean = false;\r\n  private errorCategory: HTMLElement;\r\n  private retryBtn: HTMLButtonElement;\r\n  private btnOptions: HTMLButtonElement;\r\n  private menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean})[];\r\n\r\n  protected lazyLoadQueue: LazyLoadQueue;\r\n  protected peopleSection: SettingChatListSection;\r\n  protected chatsSection: SettingChatListSection;\r\n\r\n  protected locatedPeers: Map<PeerId, PeerLocated.peerLocated>;\r\n\r\n  // protected async init() {\r\n  //   this.container.classList.add('people-nearby-container');\r\n  //   this.setTitle('PeopleNearby');\r\n\r\n  //   this.errorCategory = document.createElement('div');\r\n  //   this.errorCategory.classList.add('text', 'hide', 'nearby-error');\r\n\r\n  //   this.retryBtn = ButtonCorner({icon: 'check'});\r\n\r\n  //   const emoji = '';\r\n  //   const doc = await this.managers.appStickersManager.getAnimatedEmojiSticker(emoji);\r\n  //   const stickerContainer = document.createElement('div');\r\n  //   stickerContainer.classList.add('sticker-container');\r\n\r\n  //   if(doc) {\r\n  //     wrapSticker({\r\n  //       doc,\r\n  //       div: stickerContainer,\r\n  //       loop: false,\r\n  //       play: true,\r\n  //       width: 86,\r\n  //       height: 86,\r\n  //       emoji,\r\n  //       needUpscale: true\r\n  //     }).then(() => {\r\n  //       // this.animation = player;\r\n  //     });\r\n  //   } else {\r\n  //     stickerContainer.classList.add('media-sticker-wrapper');\r\n  //   }\r\n\r\n  //   const caption = document.createElement('div');\r\n  //   caption.classList.add('caption');\r\n  //   _i18n(caption, 'PeopleNearbyInfo2');\r\n\r\n  //   this.locatedPeers = new Map();\r\n\r\n  //   const m = () => {\r\n  //     const sortedUserList = new SortedUserList({\r\n  //       avatarSize: 42,\r\n  //       createChatListOptions: {\r\n  //         dialogSize: 48,\r\n  //         new: true\r\n  //       },\r\n  //       autonomous: false,\r\n  //       onUpdate: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         const elements: HTMLElement[] = [\r\n  //           this.parseDistance(peer.distance)\r\n  //         ];\r\n\r\n  //         if(!element.id.isUser()) {\r\n  //           elements.push(this.managers.appProfileManager.getChatMembersString(element.id.toChatId()));\r\n  //         }\r\n\r\n  //         element.dom.lastMessageSpan.textContent = '';\r\n  //         element.dom.lastMessageSpan.append(...join(elements, false));\r\n  //       },\r\n  //       getIndex: (element) => {\r\n  //         const peer = this.locatedPeers.get(element.id);\r\n  //         return 0x7FFFFFFF - peer.distance;\r\n  //       },\r\n  //       appUsersManager: this.managers.appUsersManager\r\n  //     });\r\n\r\n  //     appDialogsManager.setListClickListener(sortedUserList.list, undefined, undefined, false);\r\n\r\n  //     return sortedUserList;\r\n  //   };\r\n\r\n  //   const peopleSection = this.peopleSection = new SettingChatListSection({\r\n  //     name: 'PeopleNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const chatsSection = this.chatsSection = new SettingChatListSection({\r\n  //     name: 'ChatsNearbyHeader',\r\n  //     sortedList: m()\r\n  //   });\r\n\r\n  //   const btnMakeVisible = peopleSection.makeButton({\r\n  //     text: 'MakeMyselfVisible',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnMakeInvisible = peopleSection.makeButton({\r\n  //     text: 'StopShowingMe',\r\n  //     icon: 'location'\r\n  //   });\r\n\r\n  //   const btnCreateGroup = chatsSection.makeButton({\r\n  //     text: 'NearbyCreateGroup',\r\n  //     icon: 'newgroup'\r\n  //   });\r\n\r\n  //   attachClickEvent(btnMakeVisible, () => {\r\n  //     confirmationPopup({\r\n  //       titleLangKey: 'MakeMyselfVisibleTitle',\r\n  //       descriptionLangKey: 'MakeMyselfVisibleInfo',\r\n  //       button: {\r\n  //         langKey: 'OK'\r\n  //       }\r\n  //     }).then(() => {\r\n  //       this.startWatching();\r\n  //     });\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnMakeInvisible, () => {\r\n  //     this.stopWatching();\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   attachClickEvent(btnCreateGroup, () => {\r\n  //     this.slider.createTab(AppNewGroupTab).open([], true);\r\n  //   }, {listenerSetter: this.listenerSetter});\r\n\r\n  //   btnMakeVisible.classList.add('primary');\r\n  //   btnMakeInvisible.classList.add('danger');\r\n  //   btnCreateGroup.classList.add('primary');\r\n\r\n  //   this.content.append(this.retryBtn);\r\n  //   this.scrollable.append(\r\n  //     stickerContainer,\r\n  //     caption,\r\n  //     peopleSection.container,\r\n  //     chatsSection.container,\r\n  //     this.errorCategory\r\n  //   );\r\n  // }\r\n\r\n  private parseDistance(distance: number) {\r\n    if(rootScope.settings.distanceUnit === 'miles') {\r\n      if(distance > 1609.34) {\r\n        return i18n('MilesAway', [Math.round(distance / 1609)]);\r\n      } else {\r\n        return i18n('FootsAway', [Math.round(distance * 3.281)]);\r\n      }\r\n    } else {\r\n      if(distance >= 1000) {\r\n        return i18n('KMetersAway2', [distance / 1000]);\r\n      } else {\r\n        return i18n('MetersAway2', [distance]);\r\n      }\r\n    }\r\n  }\r\n\r\n  public open() {\r\n    const result = super.open();\r\n    result.then(() => {\r\n      this.retryBtn.classList.remove('is-visible');\r\n      navigator.geolocation.getCurrentPosition((location) => {\r\n        this.latestLocationSaved = {\r\n          latitude: location.coords.latitude,\r\n          longitude: location.coords.longitude,\r\n          accuracy: location.coords.accuracy\r\n        };\r\n\r\n        console.log(this.latestLocationSaved);\r\n\r\n        this.managers.appUsersManager.getLocated(\r\n          location.coords.latitude,\r\n          location.coords.longitude,\r\n          location.coords.accuracy\r\n        ).then((response) => {\r\n          const update = (response as Updates.updates).updates[0] as Update.updatePeerLocated;\r\n          const peers = update.peers as PeerLocated.peerLocated[];\r\n          const orderedPeers = peers.sort((a, b) => a.distance - b.distance);\r\n          const groupsCounter = peers.filter((e) => e.peer._ == 'peerChannel').length;\r\n          const usersCounter = peers.filter((e) => e.peer._ != 'peerChannel').length;\r\n          orderedPeers?.forEach((peer) => {\r\n            const peerId = getPeerId(peer.peer);\r\n            const section = peerId.isUser() ? this.peopleSection : this.chatsSection;\r\n            this.locatedPeers.set(peerId, peer);\r\n            section.sortedList.add(peerId);\r\n          });\r\n\r\n          this.errorCategory.classList.toggle('hide', !!(usersCounter || groupsCounter));\r\n          this.errorCategory.innerHTML = 'No groups or channels found around you.';\r\n        });\r\n      }, (error) => {\r\n        this.errorCategory.classList.remove('hide');\r\n        this.retryBtn.classList.add('is-visible');\r\n        this.retryBtn.addEventListener('click', this.open);\r\n        if(error instanceof GeolocationPositionError) {\r\n          this.errorCategory.innerHTML = 'Location permission denied. Click below to retry.';\r\n        } else {\r\n          this.errorCategory.innerHTML = 'An error has occurred. Please retry later clicking the button below.';\r\n        }\r\n      });\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  private startWatching() {\r\n    if(!this.latestLocationSaved || this.isLocationWatched) return;\r\n    this.isLocationWatched = true;\r\n\r\n    toast('Your position is now being shared. Do not close the page or it will be suspended.');\r\n\r\n    this.managers.appUsersManager.getLocated(\r\n      this.latestLocationSaved.latitude,\r\n      this.latestLocationSaved.longitude,\r\n      this.latestLocationSaved.accuracy,\r\n      true, // background parameter\r\n      0x7fffffff // self_expires parameter\r\n    );\r\n\r\n    navigator.geolocation.watchPosition((result) => {\r\n      const isLongitudeDifferent = result.coords.longitude !== this.latestLocationSaved.longitude;\r\n      const isLatitudeDifferent = result.coords.latitude !== this.latestLocationSaved.latitude;\r\n      const distanceCheck = this.calculateDistance(\r\n        result.coords.latitude, result.coords.longitude,\r\n        this.latestLocationSaved.latitude, this.latestLocationSaved.longitude\r\n      ) > 100;\r\n\r\n      if((isLatitudeDifferent || isLongitudeDifferent) && distanceCheck) {\r\n        this.managers.appUsersManager.getLocated(\r\n          result.coords.latitude,\r\n          result.coords.longitude,\r\n          result.coords.accuracy,\r\n          true, // background parameter\r\n          0x7fffffff // self_expires parameter\r\n        );\r\n        this.latestLocationSaved = {\r\n          latitude: result.coords.latitude,\r\n          longitude: result.coords.longitude,\r\n          accuracy: result.coords.accuracy\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  private stopWatching() {\r\n    if(!this.isLocationWatched) return;\r\n    this.isLocationWatched = false;\r\n    toast('The sharing of your position has been stopped. You will no longer be visible to other users.');\r\n    this.managers.appUsersManager.getLocated(\r\n      0, // latitude parameter\r\n      0, // longitude parameter\r\n      0, // accuracy parameter\r\n      false, // background parameter\r\n      0 // self_expires parameter\r\n    );\r\n  }\r\n\r\n  private calculateDistance(lat1: number, long1: number, lat2: number, long2: number) {\r\n    const p = 0.017453292519943295; // Math.PI/180\r\n    return (\r\n      12742 * Math.asin(\r\n        Math.sqrt(\r\n          (0.5 - Math.cos((lat2 - lat1) * p)) +\r\n          (\r\n            Math.cos(lat1 * p) * Math.cos(lat2 * p) *\r\n            (1 - Math.cos((long2 - long1) * p)/2)\r\n          )\r\n        )\r\n      )\r\n    );\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport {SearchGroup} from '../appSearch';\nimport '../avatar';\nimport Scrollable, {ScrollableX} from '../scrollable';\nimport InputSearch from '../inputSearch';\nimport SidebarSlider from '../slider';\nimport {TransitionSlider} from '../transition';\nimport AppNewGroupTab from './tabs/newGroup';\nimport AppSearchSuper from '../appSearchSuper.';\nimport {DateData, fillTipDates} from '../../helpers/date';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport AppSettingsTab from './tabs/settings';\nimport AppNewChannelTab from './tabs/newChannel';\nimport AppContactsTab from './tabs/contacts';\nimport AppArchivedTab from './tabs/archivedTab';\nimport AppAddMembersTab from './tabs/addMembers';\nimport I18n, {FormatterArguments, i18n, i18n_, LangPackKey} from '../../lib/langPack';\nimport AppPeopleNearbyTab from './tabs/peopleNearby';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport CheckboxField from '../checkboxField';\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport PeerTitle from '../peerTitle';\nimport App from '../../config/app';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport sessionStorage from '../../lib/sessionStorage';\nimport {attachClickEvent, CLICK_EVENT_NAME, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport ButtonIcon from '../buttonIcon';\nimport confirmationPopup from '../confirmationPopup';\nimport IS_GEOLOCATION_SUPPORTED from '../../environment/geolocationSupport';\nimport type SortedUserList from '../sortedUserList';\nimport Button, {ButtonOptions} from '../button';\nimport noop from '../../helpers/noop';\nimport ripple from '../ripple';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport AvatarElement from '../avatar';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\nexport const LEFT_COLUMN_ACTIVE_CLASSNAME = 'is-left-column-shown';\n\nexport class AppSidebarLeft extends SidebarSlider {\n  private toolsBtn: HTMLElement;\n  private backBtn: HTMLButtonElement;\n  // private searchInput = document.getElementById('global-search') as HTMLInputElement;\n  private inputSearch: InputSearch;\n\n  public archivedCount: HTMLSpanElement;\n\n  private newBtnMenu: HTMLElement;\n\n  // private log = logger('SL');\n\n  private searchGroups: {[k in 'contacts' | 'globalContacts' | 'messages' | 'people' | 'recent']: SearchGroup} = {} as any;\n  private searchSuper: AppSearchSuper;\n\n  private updateBtn: HTMLElement;\n  private hasUpdate: boolean;\n\n  constructor() {\n    super({\n      sidebarEl: document.getElementById('column-left') as HTMLDivElement,\n      navigationType: 'left'\n    });\n  }\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n    // this._selectTab(0); // make first tab as default\n\n    this.inputSearch = new InputSearch('Search');\n    const sidebarHeader = this.sidebarEl.querySelector('.item-main .sidebar-header');\n    sidebarHeader.append(this.inputSearch.container);\n\n    const onNewGroupClick = () => {\n      this.createTab(AppAddMembersTab).open({\n        type: 'chat',\n        skippable: false,\n        takeOut: (peerIds) => {\n          this.createTab(AppNewGroupTab).open(peerIds);\n        },\n        title: 'GroupAddMembers',\n        placeholder: 'SendMessageTo'\n      });\n    };\n\n    const onContactsClick = () => {\n      this.createTab(AppContactsTab).open();\n    };\n\n    // this.toolsBtn = this.sidebarEl.querySelector('.sidebar-tools-button') as HTMLButtonElement;\n    this.backBtn = this.sidebarEl.querySelector('.sidebar-back-button') as HTMLButtonElement;\n\n    const btnArchive: typeof menuButtons[0] = {\n      icon: 'archive',\n      text: 'ArchivedChats',\n      onClick: () => {\n        this.createTab(AppArchivedTab).open();\n      },\n      verify: async() => {\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(1, false);\n        return !!folder.length || !(await this.managers.dialogsStorage.isDialogsLoaded(1));\n      }\n    };\n\n    const themeCheckboxField = new CheckboxField({\n      toggle: true,\n      checked: themeController.getTheme().name === 'night'\n    });\n    themeCheckboxField.input.addEventListener('change', async() => {\n      await this.managers.appStateManager.setByKey('settings.theme', themeCheckboxField.input.checked ? 'night' : 'day');\n      rootScope.dispatchEvent('theme_change');\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      themeCheckboxField.setValueSilently(themeController.getTheme().name === 'night');\n    });\n\n    const menuButtons: (ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>})[] = [{\n      icon: 'saved',\n      text: 'SavedMessages',\n      onClick: () => {\n        setTimeout(() => { // menu doesn't close if no timeout (lol)\n          appImManager.setPeer({\n            peerId: appImManager.myId\n          });\n        }, 0);\n      }\n    }, btnArchive, {\n      icon: 'user',\n      text: 'Contacts',\n      onClick: onContactsClick\n    }, IS_GEOLOCATION_SUPPORTED ? {\n      icon: 'group',\n      text: 'PeopleNearby',\n      onClick: () => {\n        this.createTab(AppPeopleNearbyTab).open();\n      }\n    } : undefined, {\n      icon: 'settings',\n      text: 'Settings',\n      onClick: () => {\n        this.createTab(AppSettingsTab).open();\n      }\n    }, {\n      icon: 'darkmode',\n      text: 'DarkMode',\n      onClick: () => {\n\n      },\n      checkboxField: themeCheckboxField\n    }, {\n      icon: 'animations',\n      text: 'Animations',\n      onClick: () => {\n\n      },\n      checkboxField: new CheckboxField({\n        toggle: true,\n        checked: true,\n        stateKey: 'settings.animationsEnabled'\n      })\n    }, {\n      icon: 'help',\n      text: 'TelegramFeatures',\n      onClick: () => {\n        const url = I18n.format('TelegramFeaturesUrl', true);\n        appImManager.openUrl(url);\n      }\n    }, {\n      icon: 'bug',\n      text: 'ReportBug',\n      onClick: () => {\n        const a = document.createElement('a');\n        a.target = '_blank';\n        a.href = 'https://bugs.telegram.org/?tag_ids=40&sort=time';\n        document.body.append(a);\n        a.click();\n        setTimeout(() => {\n          a.remove();\n        }, 0);\n      }\n    }, {\n      icon: 'char z',\n      text: 'ChatList.Menu.SwitchTo.Z',\n      onClick: () => {\n        Promise.all([\n          sessionStorage.set({kz_version: 'Z'}),\n          sessionStorage.delete('tgme_sync')\n        ]).then(() => {\n          location.href = 'https://web.telegram.org/z/';\n        });\n      },\n      verify: () => App.isMainDomain\n    }, {\n      icon: 'char w',\n      text: 'ChatList.Menu.SwitchTo.Webogram',\n      onClick: () => {\n        sessionStorage.delete('tgme_sync').then(() => {\n          location.href = 'https://web.telegram.org/?legacy=1';\n        });\n      },\n      verify: () => App.isMainDomain\n    }];\n\n    const filteredButtons = menuButtons.filter(Boolean);\n\n    this.toolsBtn = ButtonMenuToggle({}, 'bottom-right', filteredButtons, async(e) => {\n      await Promise.all(filteredButtons.map(async(button) => {\n        if(button.verify) {\n          button.element.classList.toggle('hide', !(await button.verify()));\n        }\n      }));\n    });\n    this.toolsBtn.classList.remove('tgico-more');\n    this.toolsBtn.classList.add('sidebar-tools-button', 'is-visible');\n\n    this.backBtn.parentElement.insertBefore(this.toolsBtn, this.backBtn);\n\n    const btnMenu = this.toolsBtn.querySelector('.btn-menu') as HTMLElement;\n\n    const btnMenuFooter = document.createElement('a');\n    btnMenuFooter.href = 'https://github.com/morethanwords/tweb/blob/master/CHANGELOG.md';\n    btnMenuFooter.target = '_blank';\n    btnMenuFooter.rel = 'noopener noreferrer';\n    btnMenuFooter.classList.add('btn-menu-footer');\n    btnMenuFooter.addEventListener(CLICK_EVENT_NAME, (e) => {\n      e.stopPropagation();\n      contextMenuController.close();\n    });\n    const t = document.createElement('span');\n    t.classList.add('btn-menu-footer-text');\n    t.innerHTML = 'Telegram Web' + App.suffix + ' '/* ' alpha ' */ + App.versionFull;\n    btnMenuFooter.append(t);\n    btnMenu.classList.add('has-footer');\n    btnMenu.append(btnMenuFooter);\n\n    this.newBtnMenu = ButtonMenuToggle({}, 'top-left', [{\n      icon: 'newchannel',\n      text: 'NewChannel',\n      onClick: () => {\n        this.createTab(AppNewChannelTab).open();\n      }\n    }, {\n      icon: 'newgroup',\n      text: 'NewGroup',\n      onClick: onNewGroupClick\n    }, {\n      icon: 'newprivate',\n      text: 'NewPrivateChat',\n      onClick: onContactsClick\n    }]);\n    this.newBtnMenu.className = 'btn-circle rp btn-corner z-depth-1 btn-menu-toggle animated-button-icon';\n    this.newBtnMenu.insertAdjacentHTML('afterbegin', `\n    <span class=\"tgico tgico-newchat_filled\"></span>\n    <span class=\"tgico tgico-close\"></span>\n    `);\n    this.newBtnMenu.id = 'new-menu';\n    sidebarHeader.nextElementSibling.append(this.newBtnMenu);\n\n    this.updateBtn = document.createElement('div');\n    // this.updateBtn.classList.add('btn-update');\n    this.updateBtn.className = 'btn-circle rp btn-corner z-depth-1 btn-update is-hidden';\n    ripple(this.updateBtn);\n    this.updateBtn.append(i18n('Update'));\n    // const weave = new TopbarWeave();\n    // const weaveContainer = weave.render('btn-update-weave');\n    // this.updateBtn.prepend(weaveContainer);\n\n    attachClickEvent(this.updateBtn, () => {\n      if(this.updateBtn.classList.contains('is-hidden')) {\n        return;\n      }\n\n      location.reload();\n    });\n\n    sidebarHeader.nextElementSibling.append(this.updateBtn);\n\n    // setTimeout(() => {\n    //   weave.componentDidMount();\n    //   weave.setCurrentState(GROUP_CALL_STATE.MUTED, true);\n    //   weave.setAmplitude(0);\n    //   weave.handleBlur();\n    // }, 1e3);\n\n    this.inputSearch.input.addEventListener('focus', () => this.initSearch(), {once: true});\n\n    // parseMenuButtonsTo(this.newButtons, this.newBtnMenu.firstElementChild.children);\n\n    this.archivedCount = document.createElement('span');\n    this.archivedCount.className = 'archived-count badge badge-24 badge-gray';\n\n    btnArchive.element.append(this.archivedCount);\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      if(folder.id === 1) {\n        // const count = folder.unreadMessagesCount;\n        const count = folder.unreadPeerIds.size;\n        this.archivedCount.innerText = '' + formatNumber(count, 1);\n        this.archivedCount.classList.toggle('hide', !count);\n      }\n    });\n\n    this.managers.appUsersManager.getTopPeers('correspondents');\n\n    // Focus search input by pressing Escape\n    const navigationItem: NavigationItem = {\n      type: 'global-search-focus',\n      onPop: () => {\n        setTimeout(() => {\n          this.inputSearch.input.focus();\n        }, 0);\n\n        return false;\n      },\n      noHistory: true\n    };\n    appNavigationController.pushItem(navigationItem);\n\n    apiManagerProxy.getState().then((state) => {\n      const CHECK_UPDATE_INTERVAL = 1800e3;\n      const checkUpdateInterval = setInterval(() => {\n        fetch('version', {cache: 'no-cache'})\n        .then((res) => (res.status === 200 && res.ok && res.text()) || Promise.reject())\n        .then((text) => {\n          if(text !== App.versionFull) {\n            this.hasUpdate = true;\n            clearInterval(checkUpdateInterval);\n\n            if(!this.newBtnMenu.classList.contains('is-hidden')) {\n              this.updateBtn.classList.remove('is-hidden');\n            }\n          }\n        })\n        .catch(noop);\n      }, CHECK_UPDATE_INTERVAL);\n    });\n  }\n\n  private initSearch() {\n    const searchContainer = this.sidebarEl.querySelector('#search-container') as HTMLDivElement;\n\n    const scrollable = new Scrollable(searchContainer);\n\n    const close = () => {\n      // setTimeout(() => {\n      simulateClickEvent(this.backBtn);\n      // }, 0);\n    };\n\n    this.searchGroups = {\n      contacts: new SearchGroup('SearchAllChatsShort', 'contacts', undefined, undefined, undefined, undefined, close),\n      globalContacts: new SearchGroup('GlobalSearch', 'contacts', undefined, undefined, undefined, undefined, close),\n      messages: new SearchGroup('SearchMessages', 'messages'),\n      people: new SearchGroup(false, 'contacts', true, 'search-group-people', true, false, close, true),\n      recent: new SearchGroup('Recent', 'contacts', true, 'search-group-recent', true, true, close)\n    };\n\n    const searchSuper = this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'FilterChats',\n        type: 'chats'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable,\n      searchGroups: this.searchGroups,\n      asChatList: true,\n      hideEmptyTabs: false,\n      showSender: true,\n      managers: this.managers\n    });\n\n    searchContainer.prepend(searchSuper.nav.parentElement.parentElement);\n    scrollable.container.append(searchSuper.container);\n\n    const resetSearch = () => {\n      searchSuper.setQuery({\n        peerId: ''.toPeerId(),\n        folderId: 0\n      });\n      searchSuper.selectTab(0);\n      searchSuper.load(true);\n    };\n\n    resetSearch();\n\n    const pickedElements: HTMLElement[] = [];\n    let selectedPeerId: PeerId = ''.toPeerId();\n    let selectedMinDate = 0;\n    let selectedMaxDate = 0;\n    const updatePicked = () => {\n      // (this.inputSearch.input as HTMLInputElement).placeholder = pickedElements.length ? 'Search' : 'Telegram Search';\n      this.inputSearch.container.classList.toggle('is-picked-twice', pickedElements.length === 2);\n      this.inputSearch.container.classList.toggle('is-picked', !!pickedElements.length);\n\n      if(pickedElements.length) {\n        this.inputSearch.input.style.setProperty('--paddingLeft', (pickedElements[pickedElements.length - 1].getBoundingClientRect().right - this.inputSearch.input.getBoundingClientRect().left) + 'px');\n      } else {\n        this.inputSearch.input.style.removeProperty('--paddingLeft');\n      }\n    };\n\n    const helper = document.createElement('div');\n    helper.classList.add('search-helper');\n    helper.addEventListener('click', (e) => {\n      const target = findUpClassName(e.target, 'selector-user');\n      if(!target) {\n        return;\n      }\n\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        const [_, minDate, maxDate] = key.split('_');\n        selectedMinDate = +minDate;\n        selectedMaxDate = +maxDate;\n      } else {\n        selectedPeerId = key.toPeerId();\n      }\n\n      target.addEventListener('click', () => {\n        unselectEntity(target);\n      });\n\n      this.inputSearch.container.append(target);\n      this.inputSearch.onChange(this.inputSearch.value = '');\n      pickedElements.push(target);\n      updatePicked();\n    });\n\n    searchSuper.nav.parentElement.append(helper);\n\n    const renderEntity = (key: PeerId | string, title?: string | HTMLElement) => {\n      const div = document.createElement('div');\n      div.classList.add('selector-user'/* , 'scale-in' */);\n\n      const avatarEl = new AvatarElement();\n      avatarEl.classList.add('selector-user-avatar', 'tgico', 'avatar-30');\n      avatarEl.isDialog = true;\n\n      div.dataset.key = '' + key;\n      if(key.isPeerId()) {\n        if(title === undefined) {\n          title = new PeerTitle({peerId: key.toPeerId()}).element;\n        }\n\n        avatarEl.updateWithOptions({peerId: key as PeerId});\n      } else {\n        avatarEl.classList.add('tgico-calendarfilter');\n      }\n\n      if(title) {\n        if(typeof(title) === 'string') {\n          div.innerHTML = title;\n        } else {\n          replaceContent(div, title);\n          div.append(title);\n        }\n      }\n\n      div.insertAdjacentElement('afterbegin', avatarEl);\n\n      return div;\n    };\n\n    const unselectEntity = (target: HTMLElement) => {\n      const key = target.dataset.key;\n      if(key.indexOf('date_') === 0) {\n        selectedMinDate = selectedMaxDate = 0;\n      } else {\n        selectedPeerId = ''.toPeerId();\n      }\n\n      target.remove();\n      indexOfAndSplice(pickedElements, target);\n\n      setTimeout(() => {\n        updatePicked();\n        this.inputSearch.onChange(this.inputSearch.value);\n      }, 0);\n    };\n\n    this.inputSearch.onClear = () => {\n      pickedElements.forEach((el) => {\n        unselectEntity(el);\n      });\n    };\n\n    this.inputSearch.onChange = (value) => {\n      searchSuper.cleanupHTML();\n      searchSuper.setQuery({\n        peerId: selectedPeerId,\n        folderId: selectedPeerId ? undefined : 0,\n        query: value,\n        minDate: selectedMinDate,\n        maxDate: selectedMaxDate\n      });\n      searchSuper.load(true);\n\n      helper.innerHTML = '';\n      searchSuper.nav.classList.remove('hide');\n      if(!value) {\n      }\n\n      if(!selectedPeerId && value.trim()) {\n        const middleware = searchSuper.middleware.get();\n        Promise.all([\n          // appMessagesManager.getConversationsAll(value).then((dialogs) => dialogs.map((d) => d.peerId)),\n          this.managers.appMessagesManager.getConversations(value).then(({dialogs}) => dialogs.map((d) => d.peerId)),\n          this.managers.appUsersManager.getContactsPeerIds(value, true)\n        ]).then((results) => {\n          if(!middleware()) return;\n          const peerIds = new Set(results[0].concat(results[1]));\n\n          peerIds.forEach((peerId) => {\n            helper.append(renderEntity(peerId));\n          });\n\n          searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n          // console.log('got peerIds by value:', value, [...peerIds]);\n        });\n      }\n\n      if(!selectedMinDate && value.trim()) {\n        const dates: DateData[] = [];\n        fillTipDates(value, dates);\n        dates.forEach((dateData) => {\n          helper.append(renderEntity('date_' + dateData.minDate + '_' + dateData.maxDate, dateData.title));\n        });\n\n        searchSuper.nav.classList.toggle('hide', !!helper.innerHTML);\n      }\n    };\n\n    searchSuper.tabs.inputMessagesFilterEmpty.addEventListener('mousedown', (e) => {\n      const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG) as HTMLElement;\n      if(!target) {\n        return;\n      }\n\n      const searchGroup = findUpClassName(target, 'search-group');\n      if(!searchGroup || searchGroup.classList.contains('search-group-recent') || searchGroup.classList.contains('search-group-people')) {\n        return;\n      }\n\n      const peerId = target.getAttribute('data-peer-id').toPeerId();\n      this.managers.appUsersManager.pushRecentSearch(peerId);\n    }, {capture: true});\n\n    const peopleContainer = document.createElement('div');\n    peopleContainer.classList.add('search-group-scrollable');\n    peopleContainer.append(this.searchGroups.people.list);\n    this.searchGroups.people.container.append(peopleContainer);\n    const peopleScrollable = new ScrollableX(peopleContainer);\n\n    let first = true;\n    let hideNewBtnMenuTimeout: number;\n    // const transition = Transition.bind(null, searchContainer.parentElement, 150);\n    const transition = TransitionSlider(searchContainer.parentElement, 'zoom-fade', 150, (id) => {\n      if(hideNewBtnMenuTimeout) clearTimeout(hideNewBtnMenuTimeout);\n\n      if(id === 0 && !first) {\n        searchSuper.selectTab(0, false);\n        this.inputSearch.onClearClick();\n        hideNewBtnMenuTimeout = window.setTimeout(() => {\n          hideNewBtnMenuTimeout = 0;\n          this.newBtnMenu.classList.remove('is-hidden');\n          this.hasUpdate && this.updateBtn.classList.remove('is-hidden');\n        }, 150);\n      }\n\n      first = false;\n    });\n\n    transition(0);\n\n    const activeClassName = 'is-visible';\n    const onFocus = () => {\n      this.toolsBtn.classList.remove(activeClassName);\n      this.backBtn.classList.add(activeClassName);\n      this.newBtnMenu.classList.add('is-hidden');\n      this.updateBtn.classList.add('is-hidden');\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', true);\n\n      const navigationType: NavigationItem['type'] = 'global-search';\n      if(!IS_MOBILE_SAFARI && !appNavigationController.findItemByType(navigationType)) {\n        appNavigationController.pushItem({\n          onPop: () => {\n            close();\n          },\n          type: navigationType\n        });\n      }\n\n      transition(1);\n    };\n\n    this.inputSearch.input.addEventListener('focus', onFocus);\n    onFocus();\n\n    attachClickEvent(this.backBtn, (e) => {\n      this.toolsBtn.classList.add(activeClassName);\n      this.backBtn.classList.remove(activeClassName);\n      this.toolsBtn.parentElement.firstElementChild.classList.toggle('state-back', false);\n\n      appNavigationController.removeByType('global-search');\n\n      transition(0);\n    });\n\n    const clearRecentSearchBtn = ButtonIcon('close');\n    this.searchGroups.recent.nameEl.append(clearRecentSearchBtn);\n    clearRecentSearchBtn.addEventListener('click', () => {\n      confirmationPopup({\n        descriptionLangKey: 'Search.Confirm.ClearHistory',\n        button: {\n          langKey: 'ClearButton',\n          isDanger: true\n        }\n      }).then(() => {\n        return this.managers.appUsersManager.clearRecentSearch().then(() => {\n          this.searchGroups.recent.clear();\n        });\n      });\n    });\n  }\n}\n\nexport type SettingSectionOptions = {\n  name?: LangPackKey,\n  nameArgs?: FormatterArguments,\n  caption?: LangPackKey | true,\n  captionArgs?: FormatterArguments,\n  captionOld?: SettingSectionOptions['caption'],\n  noDelimiter?: boolean,\n  fakeGradientDelimiter?: boolean,\n  noShadow?: boolean,\n  // fullWidth?: boolean,\n  // noPaddingTop?: boolean\n};\n\nconst className = 'sidebar-left-section';\nexport class SettingSection {\n  public container: HTMLElement;\n  public innerContainer: HTMLElement;\n  public content: HTMLElement;\n  public title: HTMLElement;\n  public caption: HTMLElement;\n\n  private fullWidth: boolean;\n\n  constructor(options: SettingSectionOptions = {}) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className + '-container');\n\n    const innerContainer = this.innerContainer = document.createElement('div');\n    innerContainer.classList.add(className);\n\n    if(options.noShadow) {\n      innerContainer.classList.add('no-shadow');\n    }\n\n    if(options.fakeGradientDelimiter) {\n      innerContainer.append(generateDelimiter());\n      innerContainer.classList.add('with-fake-delimiter');\n    } else if(!options.noDelimiter) {\n      const hr = document.createElement('hr');\n      innerContainer.append(hr);\n    } else {\n      innerContainer.classList.add('no-delimiter');\n    }\n\n    // if(options.fullWidth) {\n    //   this.fullWidth = true;\n    // }\n\n    // if(options.noPaddingTop) {\n    //   innerContainer.classList.add('no-padding-top');\n    // }\n\n    const content = this.content = this.generateContentElement();\n\n    if(options.name) {\n      const title = this.title = document.createElement('div');\n      title.classList.add('sidebar-left-h2', className + '-name');\n      i18n_({element: title, key: options.name, args: options.nameArgs});\n      content.append(title);\n    }\n\n    container.append(innerContainer);\n\n    const caption = options.caption ?? options.captionOld;\n    if(caption) {\n      const el = this.caption = this.generateContentElement();\n      el.classList.add(className + '-caption');\n\n      if(!options.captionOld) {\n        container.append(el);\n      }\n\n      if(caption !== true) {\n        i18n_({element: el, key: caption, args: options.captionArgs});\n      }\n    }\n  }\n\n  public generateContentElement() {\n    const content = document.createElement('div');\n    content.classList.add(className + '-content');\n\n    // if(this.fullWidth) {\n    //   content.classList.add('full-width');\n    // }\n\n    this.innerContainer.append(content);\n    return content;\n  }\n}\n\nexport const generateSection = (appendTo: Scrollable, name?: LangPackKey, caption?: LangPackKey) => {\n  const section = new SettingSection({name, caption});\n  appendTo.append(section.container);\n  return section.content;\n};\n\nexport const generateDelimiter = () => {\n  const delimiter = document.createElement('div');\n  delimiter.classList.add('gradient-delimiter');\n  return delimiter;\n};\n\nexport class SettingChatListSection extends SettingSection {\n  public sortedList: SortedUserList;\n\n  constructor(options: SettingSectionOptions & {sortedList: SortedUserList}) {\n    super(options);\n\n    this.sortedList = options.sortedList;\n\n    this.content.append(this.sortedList.list);\n  }\n\n  public makeButton(options: ButtonOptions) {\n    const button = Button('folder-category-button btn btn-primary btn-transparent', options);\n    if(this.title) this.content.insertBefore(button, this.title.nextSibling);\n    else this.content.prepend(button);\n    return button;\n  }\n}\n\nconst appSidebarLeft = new AppSidebarLeft();\nMOUNT_CLASS_TO.appSidebarLeft = appSidebarLeft;\nexport default appSidebarLeft;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport {LangPackKey, _i18n} from '../../../lib/langPack';\r\nimport ButtonCorner from '../../buttonCorner';\r\n\r\nexport default class AppAddMembersTab extends SliderSuperTab {\r\n  private nextBtn: HTMLButtonElement;\r\n  private selector: AppSelectPeers;\r\n  private peerType: 'channel' | 'chat' | 'privacy';\r\n  private takeOut: (peerIds: PeerId[]) => Promise<any> | false | void;\r\n  private skippable: boolean;\r\n\r\n  protected init() {\r\n    this.container.classList.add('add-members-container');\r\n    this.nextBtn = ButtonCorner({icon: 'arrow_next'});\r\n    this.content.append(this.nextBtn);\r\n    this.scrollable.container.remove();\r\n\r\n    this.nextBtn.addEventListener('click', () => {\r\n      const peerIds = this.selector.getSelected().map((sel) => sel.toPeerId());\r\n\r\n      if(this.skippable) {\r\n        this.takeOut(peerIds);\r\n        this.close();\r\n      } else {\r\n        const promise = this.takeOut(peerIds);\r\n\r\n        if(promise instanceof Promise) {\r\n          this.attachToPromise(promise);\r\n        } else if(promise === undefined) {\r\n          this.close();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  public attachToPromise(promise: Promise<any>) {\r\n    const removeLoader = setButtonLoader(this.nextBtn, 'arrow_next');\r\n\r\n    promise.then(() => {\r\n      this.close();\r\n    }, () => {\r\n      removeLoader();\r\n    });\r\n  }\r\n\r\n  public open(options: {\r\n    title: LangPackKey,\r\n    placeholder: LangPackKey,\r\n    type: AppAddMembersTab['peerType'],\r\n    takeOut?: AppAddMembersTab['takeOut'],\r\n    skippable: boolean,\r\n    selectedPeerIds?: PeerId[]\r\n  }) {\r\n    const ret = super.open();\r\n\r\n    this.setTitle(options.title);\r\n    this.peerType = options.type;\r\n    this.takeOut = options.takeOut;\r\n    this.skippable = options.skippable;\r\n\r\n    const isPrivacy = this.peerType === 'privacy';\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.content,\r\n      onChange: this.skippable ? null : (length) => {\r\n        this.nextBtn.classList.toggle('is-visible', !!length);\r\n      },\r\n      peerType: [isPrivacy ? 'dialogs' : 'contacts'],\r\n      placeholder: options.placeholder,\r\n      exceptSelf: isPrivacy,\r\n      filterPeerTypeBy: isPrivacy ? ['isAnyGroup', 'isUser'] : undefined,\r\n      managers: this.managers\r\n    });\r\n\r\n    if(options.selectedPeerIds) {\r\n      this.selector.addInitial(options.selectedPeerIds);\r\n    }\r\n\r\n    this.nextBtn.classList.add('tgico-arrow_next');\r\n    this.nextBtn.innerHTML = '';\r\n    this.nextBtn.disabled = false;\r\n    this.nextBtn.classList.toggle('is-visible', this.skippable);\r\n\r\n    return ret;\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDialogFilter} from '../../../lib/storages/filters';\r\nimport type {DialogFilterSuggested} from '../../../layer';\r\nimport type _rootScope from '../../../lib/rootScope';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {toast} from '../../toast';\r\nimport Button from '../../button';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppEditFolderTab from './editFolder';\r\nimport Row from '../../row';\r\nimport {SettingSection} from '..';\r\nimport {i18n, i18n_, LangPackKey, join} from '../../../lib/langPack';\r\nimport cancelEvent from '../../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport positionElementByIndex from '../../../helpers/dom/positionElementByIndex';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\n\r\nexport default class AppChatFoldersTab extends SliderSuperTab {\r\n  private createFolderBtn: HTMLElement;\r\n  private foldersSection: SettingSection;\r\n  private suggestedSection: SettingSection;\r\n  private stickerContainer: HTMLElement;\r\n  private animation: RLottiePlayer;\r\n\r\n  private filtersRendered: {[filterId: number]: Row} = {};\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  private async renderFolder(\r\n    dialogFilter: DialogFilterSuggested | MyDialogFilter,\r\n    container?: HTMLElement,\r\n    row?: Row,\r\n    append?: boolean\r\n  ) {\r\n    let filter: MyDialogFilter;\r\n    let description = '';\r\n    const d: HTMLElement[] = [];\r\n    if(dialogFilter._ === 'dialogFilterSuggested') {\r\n      filter = dialogFilter.filter as MyDialogFilter;\r\n      description = dialogFilter.description;\r\n    } else {\r\n      filter = dialogFilter;\r\n\r\n      const enabledFilters = Object.keys(filter.pFlags).length;\r\n      /* (['include_peers', 'exclude_peers'] as ['include_peers', 'exclude_peers']).forEach((key) => {\r\n        enabledFilters += +!!filter[key].length;\r\n      }); */\r\n\r\n      if(enabledFilters === 1) {\r\n        const pFlags = filter.pFlags;\r\n        let k: LangPackKey;\r\n        if(pFlags.contacts) k = 'FilterAllContacts';\r\n        else if(pFlags.non_contacts) k = 'FilterAllNonContacts';\r\n        else if(pFlags.groups) k = 'FilterAllGroups';\r\n        else if(pFlags.broadcasts) k = 'FilterAllChannels';\r\n        else if(pFlags.bots) k = 'FilterAllBots';\r\n\r\n        if(k) {\r\n          d.push(i18n(k));\r\n        }\r\n      }\r\n\r\n      if(!d.length) {\r\n        const folder = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n        let chats = 0, channels = 0, groups = 0;\r\n        await Promise.all(folder.map(async(dialog) => {\r\n          if(await this.managers.appPeersManager.isAnyGroup(dialog.peerId)) groups++;\r\n          else if(await this.managers.appPeersManager.isBroadcast(dialog.peerId)) channels++;\r\n          else chats++;\r\n        }));\r\n\r\n        if(chats) d.push(i18n('Chats', [chats]));\r\n        if(channels) d.push(i18n('Channels', [channels]));\r\n        if(groups) d.push(i18n('Groups', [groups]));\r\n      }\r\n    }\r\n\r\n    if(!row) {\r\n      row = new Row({\r\n        title: filter.id === FOLDER_ID_ALL ? i18n('FilterAllChats') : wrapEmojiText(filter.title),\r\n        subtitle: description,\r\n        clickable: filter.id !== FOLDER_ID_ALL,\r\n        buttonRightLangKey: dialogFilter._ === 'dialogFilterSuggested' ? 'Add' : undefined\r\n      });\r\n\r\n      if(d.length) {\r\n        row.subtitle.append(...join(d));\r\n      }\r\n\r\n      if(dialogFilter._ === 'dialogFilter') {\r\n        const filterId = filter.id;\r\n        if(!this.filtersRendered[filter.id] && filter.id !== FOLDER_ID_ALL) {\r\n          attachClickEvent(row.container, async() => {\r\n            this.slider.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(filterId));\r\n          }, {listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.filtersRendered[filter.id] = row;\r\n      }\r\n    } else {\r\n      if(filter.id !== FOLDER_ID_ALL) {\r\n        replaceContent(row.title, wrapEmojiText(filter.title));\r\n      }\r\n\r\n      row.subtitle.textContent = '';\r\n      row.subtitle.append(...join(d));\r\n    }\r\n\r\n    const div = row.container;\r\n\r\n    if(append) {\r\n      const localId = (filter as MyDialogFilter).localId;\r\n      if(localId !== undefined) {\r\n        // ! header will be at 0 index\r\n        positionElementByIndex(div, div.parentElement || container, localId);\r\n      } else if(container) {\r\n        container.append(div);\r\n      }\r\n    }\r\n\r\n    return row;\r\n  }\r\n\r\n  protected async init() {\r\n    this.container.classList.add('chat-folders-container');\r\n    this.setTitle('ChatList.Filter.List.Title');\r\n\r\n    this.scrollable.container.classList.add('chat-folders');\r\n\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    const caption = document.createElement('div');\r\n    caption.classList.add('caption');\r\n    i18n_({element: caption, key: 'ChatList.Filter.Header'});\r\n\r\n    this.createFolderBtn = Button('btn-primary btn-color-primary btn-control tgico', {\r\n      text: 'ChatList.Filter.NewTitle',\r\n      icon: 'add'\r\n    });\r\n\r\n    this.foldersSection = new SettingSection({\r\n      name: 'Filters'\r\n    });\r\n    this.foldersSection.container.style.display = 'none';\r\n\r\n    this.suggestedSection = new SettingSection({\r\n      name: 'FilterRecommended'\r\n    });\r\n    this.suggestedSection.container.style.display = 'none';\r\n\r\n    this.scrollable.append(this.stickerContainer, caption, this.createFolderBtn, this.foldersSection.container, this.suggestedSection.container);\r\n\r\n    attachClickEvent(this.createFolderBtn, async() => {\r\n      if(!(await this.canCreateFolder())) {\r\n        toast('Sorry, you can\\'t create more folders.');\r\n      } else {\r\n        this.slider.createTab(AppEditFolderTab).open();\r\n      }\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onFiltersContainerUpdate = () => {\r\n      this.foldersSection.container.style.display = Object.keys(this.filtersRendered).length ? '' : 'none';\r\n    };\r\n\r\n    this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n      for(const filter of filters) {\r\n        if(filter.id === FOLDER_ID_ARCHIVE) {\r\n          continue;\r\n        }\r\n\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      this.toggleAllChats();\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_update', async(filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        await this.renderFolder(filter, null, filterRendered);\r\n      } else if(filter.id !== FOLDER_ID_ARCHIVE) {\r\n        await this.renderFolder(filter, this.foldersSection.content, undefined, true);\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n\r\n      this.getSuggestedFilters();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_delete', (filter) => {\r\n      const filterRendered = this.filtersRendered[filter.id];\r\n      if(filterRendered) {\r\n        /* for(const suggested of this.suggestedFilters) {\r\n          if(deepEqual(suggested.filter, filter)) {\r\n\r\n          }\r\n        } */\r\n        this.getSuggestedFilters();\r\n\r\n        filterRendered.container.remove();\r\n        delete this.filtersRendered[filter.id];\r\n      }\r\n\r\n      onFiltersContainerUpdate();\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('filter_order', (order) => {\r\n      order.filter((filterId) => !!this.filtersRendered[filterId]).forEach((filterId, idx) => {\r\n        const filterRendered = this.filtersRendered[filterId];\r\n        const container = filterRendered.container;\r\n        positionElementByIndex(container, container.parentElement, idx + 1); // ! + 1 due to header\r\n      });\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('premium_toggle', () => {\r\n      this.toggleAllChats();\r\n    });\r\n\r\n    this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n      container: this.stickerContainer,\r\n      loop: false,\r\n      autoplay: false,\r\n      width: 86,\r\n      height: 86\r\n    }, 'Folders_1').then((player) => {\r\n      this.animation = player;\r\n\r\n      return lottieLoader.waitForFirstFrame(player);\r\n    });\r\n\r\n    this.getSuggestedFilters()\r\n\r\n    /* return Promise.all([\r\n      this.loadAnimationPromise\r\n    ]); */\r\n    return this.loadAnimationPromise;\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private toggleAllChats() {\r\n    const filterRendered = this.filtersRendered[FOLDER_ID_ALL];\r\n    filterRendered.container.classList.toggle('hide', !rootScope.premium);\r\n  }\r\n\r\n  private async canCreateFolder() {\r\n    const [appConfig, filters] = await Promise.all([\r\n      this.managers.apiManager.getAppConfig(),\r\n      this.managers.filtersStorage.getDialogFilters()\r\n    ]);\r\n\r\n    const filtersLength = filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).length;\r\n    return filtersLength < (rootScope.premium ? appConfig.dialog_filters_limit_premium : appConfig.dialog_filters_limit_default);\r\n  }\r\n\r\n  private getSuggestedFilters() {\r\n    return this.managers.filtersStorage.getSuggestedDialogsFilters().then(async(suggestedFilters) => {\r\n      this.suggestedSection.container.style.display = suggestedFilters.length ? '' : 'none';\r\n      Array.from(this.suggestedSection.content.children).slice(1).forEach((el) => el.remove());\r\n\r\n      for(const filter of suggestedFilters) {\r\n        const row = await this.renderFolder(filter);\r\n        this.suggestedSection.content.append(row.container);\r\n\r\n        const button = row.buttonRight;\r\n        attachClickEvent(button, async(e) => {\r\n          cancelEvent(e);\r\n\r\n          if(!(await this.canCreateFolder())) {\r\n            toast('Sorry, you can\\'t create more folders.');\r\n            return;\r\n          }\r\n\r\n          button.setAttribute('disabled', 'true');\r\n\r\n          const f = filter.filter as MyDialogFilter;\r\n          f.includePeerIds = [];\r\n          f.excludePeerIds = [];\r\n          f.pinnedPeerIds = [];\r\n\r\n          this.managers.filtersStorage.createDialogFilter(f, true).then((bool) => {\r\n            if(bool) {\r\n              row.container.remove();\r\n            }\r\n          }).finally(() => {\r\n            button.removeAttribute('disabled');\r\n          });\r\n        }, {listenerSetter: this.listenerSetter});\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport AppSelectPeers from '../../appSelectPeers';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport AppEditFolderTab from './editFolder';\r\nimport I18n, {i18n, LangPackKey, _i18n, join} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport {toast} from '../../toast';\r\nimport copy from '../../../helpers/object/copy';\r\nimport forEachReverse from '../../../helpers/array/forEachReverse';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\nimport {REAL_FOLDERS} from '../../../lib/mtproto/mtproto_config';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport {MTAppConfig} from '../../../lib/mtproto/appConfig';\r\nimport {attachClickEvent, simulateClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nexport default class AppIncludedChatsTab extends SliderSuperTab {\r\n  private editFolderTab: AppEditFolderTab;\r\n  private confirmBtn: HTMLElement;\r\n\r\n  private selector: AppSelectPeers;\r\n  private type: 'included' | 'excluded';\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private dialogsByFilters: Map<DialogFilter, Set<PeerId>>;\r\n  private limit: number;\r\n\r\n  protected init() {\r\n    this.content.remove();\r\n    this.container.classList.add('included-chatlist-container');\r\n    this.confirmBtn = ButtonIcon('check btn-confirm blue', {noRipple: true});\r\n    this.confirmBtn.style.display = 'none';\r\n\r\n    this.header.append(this.confirmBtn);\r\n\r\n    attachClickEvent(this.confirmBtn, async() => {\r\n      const selected = this.selector.getSelected();\r\n\r\n      // this.filter.pFlags = {};\r\n\r\n      if(this.type === 'included') {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') === 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      } else {\r\n        for(const key in this.filter.pFlags) {\r\n          if(key.indexOf('exclude_') !== 0) {\r\n            continue;\r\n          }\r\n\r\n          // @ts-ignore\r\n          delete this.filter.pFlags[key];\r\n        }\r\n      }\r\n\r\n      const peerIds: PeerId[] = [];\r\n      for(const key of selected) {\r\n        if(key.isPeerId()) {\r\n          peerIds.push(key.toPeerId());\r\n        } else {\r\n          // @ts-ignore\r\n          this.filter.pFlags[key] = true;\r\n        }\r\n      }\r\n\r\n      let cmp: (peerId: PeerId) => boolean;\r\n      if(this.type === 'included') {\r\n        cmp = (peerId) => peerIds.includes(peerId);\r\n      } else {\r\n        cmp = (peerId) => !peerIds.includes(peerId);\r\n      }\r\n\r\n      forEachReverse(this.filter.pinnedPeerIds, (peerId, idx) => {\r\n        if(!cmp(peerId)) {\r\n          this.filter.pinnedPeerIds.splice(idx, 1);\r\n          this.filter.pinned_peers.splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      const other = this.type === 'included' ? 'excludePeerIds' : 'includePeerIds';\r\n      const otherLegacy = this.type === 'included' ? 'exclude_peers' : 'include_peers';\r\n      forEachReverse(this.filter[other], (peerId, idx) => {\r\n        if(peerIds.includes(peerId)) {\r\n          this.filter[other].splice(idx, 1);\r\n          this.filter[otherLegacy].splice(idx, 1);\r\n        }\r\n      });\r\n\r\n      this.filter[this.type === 'included' ? 'includePeerIds' : 'excludePeerIds'] = peerIds;\r\n      this.filter[this.type === 'included' ? 'include_peers' : 'exclude_peers'] = await Promise.all(peerIds.map((peerId) => this.managers.appPeersManager.getInputPeerById(peerId)));\r\n      // this.filter.pinned_peers = this.filter.pinned_peers.filter((peerId) => this.filter.include_peers.includes(peerId));\r\n\r\n      this.editFolderTab.setFilter(this.filter, false);\r\n      this.close();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    const onAppConfig = (appConfig: MTAppConfig) => {\r\n      this.limit = rootScope.premium ? appConfig.dialog_filters_chats_limit_premium : appConfig.dialog_filters_chats_limit_default;\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('app_config', onAppConfig);\r\n\r\n    this.dialogsByFilters = new Map();\r\n    return Promise.all([\r\n      this.managers.filtersStorage.getDialogFilters().then(async(filters) => {\r\n        await Promise.all(filters.filter((filter) => !REAL_FOLDERS.has(filter.id)).map(async(filter) => {\r\n          const dialogs = await this.managers.dialogsStorage.getFolderDialogs(filter.id);\r\n          const peerIds = dialogs.map((d) => d.peerId);\r\n          this.dialogsByFilters.set(filter, new Set(peerIds));\r\n        }));\r\n      }),\r\n\r\n      this.managers.apiManager.getAppConfig().then((appConfig) => {\r\n        onAppConfig(appConfig);\r\n      })\r\n    ]);\r\n  }\r\n\r\n  checkbox(selected?: boolean) {\r\n    const checkboxField = new CheckboxField({\r\n      round: true\r\n    });\r\n    if(selected) {\r\n      checkboxField.input.checked = selected;\r\n    }\r\n\r\n    return checkboxField.label;\r\n  }\r\n\r\n  renderResults = async(peerIds: PeerId[]) => {\r\n    // const other = this.type === 'included' ? this.filter.exclude_peers : this.filter.include_peers;\r\n\r\n    await this.managers.appUsersManager.getContacts();\r\n    peerIds.forEach((peerId) => {\r\n      // if(other.includes(peerId)) return;\r\n\r\n      const {dom} = appDialogsManager.addDialogNew({\r\n        peerId: peerId,\r\n        container: this.selector.scrollable,\r\n        rippleEnabled: true,\r\n        avatarSize: 46\r\n      });\r\n\r\n      const selected = this.selector.selected.has(peerId);\r\n      dom.containerEl.append(this.checkbox(selected));\r\n      // if(selected) dom.listEl.classList.add('active');\r\n\r\n      const foundInFilters: HTMLElement[] = [];\r\n      this.dialogsByFilters.forEach((dialogs, filter) => {\r\n        if(dialogs.has(peerId)) {\r\n          const span = document.createElement('span');\r\n          setInnerHTML(span, wrapEmojiText(filter.title));\r\n          foundInFilters.push(span);\r\n        }\r\n      });\r\n\r\n      const joined = join(foundInFilters, false);\r\n      joined.forEach((el) => {\r\n        dom.lastMessageSpan.append(el);\r\n      });\r\n    });\r\n  };\r\n\r\n  onOpen() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    this.confirmBtn.style.display = this.type === 'excluded' ? '' : 'none';\r\n    this.setTitle(this.type === 'included' ? 'FilterAlwaysShow' : 'FilterNeverShow');\r\n\r\n    const filter = this.filter;\r\n\r\n    const categoriesSection = new SettingSection({\r\n      noDelimiter: true,\r\n      name: 'FilterChatTypes'\r\n    });\r\n\r\n    categoriesSection.container.classList.add('folder-categories');\r\n\r\n    let details: {[flag: string]: {ico: string, text: LangPackKey}};\r\n    if(this.type === 'excluded') {\r\n      details = {\r\n        exclude_muted: {ico: 'mute', text: 'ChatList.Filter.MutedChats'},\r\n        exclude_archived: {ico: 'archive', text: 'ChatList.Filter.Archive'},\r\n        exclude_read: {ico: 'readchats', text: 'ChatList.Filter.ReadChats'}\r\n      };\r\n    } else {\r\n      details = {\r\n        contacts: {ico: 'newprivate', text: 'ChatList.Filter.Contacts'},\r\n        non_contacts: {ico: 'noncontacts', text: 'ChatList.Filter.NonContacts'},\r\n        groups: {ico: 'group', text: 'ChatList.Filter.Groups'},\r\n        broadcasts: {ico: 'newchannel', text: 'ChatList.Filter.Channels'},\r\n        bots: {ico: 'bots', text: 'ChatList.Filter.Bots'}\r\n      };\r\n    }\r\n\r\n    const f = document.createDocumentFragment();\r\n    for(const key in details) {\r\n      const button = Button('btn-primary btn-transparent folder-category-button', {icon: details[key].ico, text: details[key].text});\r\n      button.dataset.peerId = key;\r\n      button.append(this.checkbox());\r\n      f.append(button);\r\n    }\r\n    categoriesSection.content.append(f);\r\n\r\n    // ///////////////\r\n\r\n    const selectedPeers = (this.type === 'included' ? filter.includePeerIds : filter.excludePeerIds).slice();\r\n\r\n    this.selector = new AppSelectPeers({\r\n      appendTo: this.container,\r\n      onChange: this.onSelectChange,\r\n      peerType: ['dialogs'],\r\n      renderResultsFunc: this.renderResults,\r\n      placeholder: 'Search',\r\n      sectionNameLangPackKey: 'FilterChats',\r\n      managers: this.managers\r\n    });\r\n    this.selector.selected = new Set(selectedPeers);\r\n\r\n    let addedInitial = false;\r\n    const _add = this.selector.add.bind(this.selector);\r\n    this.selector.add = (peerId, title, scroll) => {\r\n      if(this.selector.selected.size >= this.limit && addedInitial && !details[peerId]) {\r\n        const el: HTMLInputElement = this.selector.list.querySelector(`[data-peer-id=\"${peerId}\"] [type=\"checkbox\"]`);\r\n        if(el) {\r\n          setTimeout(() => {\r\n            el.checked = false;\r\n          }, 0);\r\n        }\r\n\r\n        const str = I18n.format(this.type === 'excluded' ? 'ChatList.Filter.Exclude.LimitReached': 'ChatList.Filter.Include.LimitReached', true);\r\n        toast(str);\r\n        return;\r\n      }\r\n\r\n      const div = _add(peerId, details[peerId] ? i18n(details[peerId].text) : undefined, scroll);\r\n      if(details[peerId]) {\r\n        div.querySelector('avatar-element').classList.add('tgico-' + details[peerId].ico);\r\n      }\r\n      return div;\r\n    };\r\n\r\n    this.selector.scrollable.container.append(categoriesSection.container, this.selector.scrollable.container.lastElementChild);\r\n\r\n    this.selector.addInitial(selectedPeers);\r\n    addedInitial = true;\r\n\r\n    for(const flag in filter.pFlags) {\r\n      // @ts-ignore\r\n      if(details.hasOwnProperty(flag) && !!filter.pFlags[flag]) {\r\n        simulateClickEvent(categoriesSection.content.querySelector(`[data-peer-id=\"${flag}\"]`) as HTMLElement);\r\n      }\r\n    }\r\n  }\r\n\r\n  onSelectChange = (length: number) => {\r\n    // const changed = !deepEqual(this.filter, this.originalFilter);\r\n    if(this.type === 'included') {\r\n      this.confirmBtn.style.display = length ? '' : 'none';\r\n    }\r\n  };\r\n\r\n  onCloseAfterTimeout() {\r\n    if(this.selector) {\r\n      this.selector.container.remove();\r\n      this.selector = null;\r\n    }\r\n\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n\r\n  /**\r\n   * Do not ignore arguments!\r\n   */\r\n  public open(filter?: DialogFilter, type?: 'included' | 'excluded', editFolderTab?: AppIncludedChatsTab['editFolderTab']) {\r\n    this.originalFilter = filter;\r\n    this.filter = copy(this.originalFilter);\r\n    this.type = type;\r\n    this.editFolderTab = editFolderTab;\r\n\r\n    return super.open();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport {MyDialogFilter as DialogFilter} from '../../../lib/storages/filters';\r\nimport lottieLoader, {LottieLoader} from '../../../lib/rlottie/lottieLoader';\r\nimport {SliderSuperTab} from '../../slider';\r\nimport {toast} from '../../toast';\r\nimport InputField from '../../inputField';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport ButtonMenuToggle from '../../buttonMenuToggle';\r\nimport {ButtonMenuItemOptions} from '../../buttonMenu';\r\nimport Button from '../../button';\r\nimport AppIncludedChatsTab from './includedChats';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport {SettingSection} from '..';\r\nimport PopupPeer from '../../popups/peer';\r\nimport RLottiePlayer from '../../../lib/rlottie/rlottiePlayer';\r\nimport copy from '../../../helpers/object/copy';\r\nimport deepEqual from '../../../helpers/object/deepEqual';\r\nimport documentFragmentToHTML from '../../../helpers/dom/documentFragmentToHTML';\r\nimport wrapDraftText from '../../../lib/richTextProcessor/wrapDraftText';\r\nimport filterAsync from '../../../helpers/array/filterAsync';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\n\r\nconst MAX_FOLDER_NAME_LENGTH = 12;\r\n\r\nexport default class AppEditFolderTab extends SliderSuperTab {\r\n  private caption: HTMLElement;\r\n  private stickerContainer: HTMLElement;\r\n\r\n  private confirmBtn: HTMLElement;\r\n  private menuBtn: HTMLElement;\r\n  private nameInputField: InputField;\r\n\r\n  private includePeerIds: SettingSection;\r\n  private excludePeerIds: SettingSection;\r\n  private flags: {[k in 'contacts' | 'non_contacts' | 'groups' | 'broadcasts' | 'bots' | 'exclude_muted' | 'exclude_archived' | 'exclude_read']: HTMLElement} = {} as any;\r\n\r\n  private animation: RLottiePlayer;\r\n  private filter: DialogFilter;\r\n  private originalFilter: DialogFilter;\r\n\r\n  private type: 'edit' | 'create';\r\n  private loadAnimationPromise: ReturnType<LottieLoader['waitForFirstFrame']>;\r\n\r\n  protected init() {\r\n    this.container.classList.add('edit-folder-container');\r\n    this.caption = document.createElement('div');\r\n    this.caption.classList.add('caption');\r\n    this.caption.append(i18n('FilterIncludeExcludeInfo'));\r\n    this.stickerContainer = document.createElement('div');\r\n    this.stickerContainer.classList.add('sticker-container');\r\n\r\n    this.confirmBtn = ButtonIcon('check btn-confirm hide blue');\r\n    const deleteFolderButton: ButtonMenuItemOptions = {\r\n      icon: 'delete danger',\r\n      text: 'FilterMenuDelete',\r\n      onClick: () => {\r\n        new PopupPeer('filter-delete', {\r\n          titleLangKey: 'ChatList.Filter.Confirm.Remove.Header',\r\n          descriptionLangKey: 'ChatList.Filter.Confirm.Remove.Text',\r\n          buttons: [{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              deleteFolderButton.element.setAttribute('disabled', 'true');\r\n              this.managers.filtersStorage.updateDialogFilter(this.filter, true).then((bool) => {\r\n                if(bool) {\r\n                  this.close();\r\n                }\r\n              }).finally(() => {\r\n                deleteFolderButton.element.removeAttribute('disabled');\r\n              });\r\n            },\r\n            isDanger: true\r\n          }]\r\n        }).show();\r\n      }\r\n    };\r\n    this.menuBtn = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', [deleteFolderButton]);\r\n    this.menuBtn.classList.add('hide');\r\n\r\n    this.header.append(this.confirmBtn, this.menuBtn);\r\n\r\n    const inputSection = new SettingSection({});\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    this.nameInputField = new InputField({\r\n      label: 'FilterNameHint',\r\n      maxLength: MAX_FOLDER_NAME_LENGTH\r\n    });\r\n\r\n    inputWrapper.append(this.nameInputField.container);\r\n    inputSection.content.append(inputWrapper);\r\n\r\n    const generateList = (className: string, h2Text: LangPackKey, buttons: {icon: string, name?: string, withRipple?: true, text: LangPackKey}[], to: any) => {\r\n      const section = new SettingSection({\r\n        name: h2Text,\r\n        noDelimiter: true\r\n      });\r\n\r\n      section.container.classList.add('folder-list', className);\r\n\r\n      const categories = section.generateContentElement();\r\n      categories.classList.add('folder-categories');\r\n\r\n      buttons.forEach((o) => {\r\n        const button = Button('folder-category-button btn btn-primary btn-transparent', {\r\n          icon: o.icon,\r\n          text: o.text,\r\n          noRipple: o.withRipple ? undefined : true\r\n        });\r\n\r\n        if(o.name) {\r\n          to[o.name] = button;\r\n        }\r\n\r\n        categories.append(button);\r\n      });\r\n\r\n      return section;\r\n    };\r\n\r\n    this.includePeerIds = generateList('folder-list-included', 'FilterInclude', [{\r\n      icon: 'add primary',\r\n      text: 'ChatList.Filter.Include.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.Contacts',\r\n      icon: 'newprivate',\r\n      name: 'contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.NonContacts',\r\n      icon: 'noncontacts',\r\n      name: 'non_contacts'\r\n    }, {\r\n      text: 'ChatList.Filter.Groups',\r\n      icon: 'group',\r\n      name: 'groups'\r\n    }, {\r\n      text: 'ChatList.Filter.Channels',\r\n      icon: 'channel',\r\n      name: 'broadcasts'\r\n    }, {\r\n      text: 'ChatList.Filter.Bots',\r\n      icon: 'bots',\r\n      name: 'bots'\r\n    }], this.flags);\r\n\r\n    this.excludePeerIds = generateList('folder-list-excluded', 'FilterExclude', [{\r\n      icon: 'minus primary',\r\n      text: 'ChatList.Filter.Exclude.AddChat',\r\n      withRipple: true\r\n    }, {\r\n      text: 'ChatList.Filter.MutedChats',\r\n      icon: 'mute',\r\n      name: 'exclude_muted'\r\n    }, {\r\n      text: 'ChatList.Filter.Archive',\r\n      icon: 'archive',\r\n      name: 'exclude_archived'\r\n    }, {\r\n      text: 'ChatList.Filter.ReadChats',\r\n      icon: 'readchats',\r\n      name: 'exclude_read'\r\n    }], this.flags);\r\n\r\n    this.scrollable.append(this.stickerContainer, this.caption, inputSection.container, this.includePeerIds.container, this.excludePeerIds.container);\r\n\r\n    const includedFlagsContainer = this.includePeerIds.container.querySelector('.folder-categories');\r\n    const excludedFlagsContainer = this.excludePeerIds.container.querySelector('.folder-categories');\r\n\r\n    attachClickEvent(includedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'included', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(excludedFlagsContainer.querySelector('.btn') as HTMLElement, () => {\r\n      this.slider.createTab(AppIncludedChatsTab).open(this.filter, 'excluded', this);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    attachClickEvent(this.confirmBtn, () => {\r\n      if(this.nameInputField.input.classList.contains('error')) {\r\n        return;\r\n      }\r\n\r\n      if(!this.nameInputField.value.trim()) {\r\n        this.nameInputField.input.classList.add('error');\r\n        return;\r\n      }\r\n\r\n      let include = (Array.from(includedFlagsContainer.children) as HTMLElement[]).slice(1).reduce((acc, el) => acc + +!el.style.display, 0);\r\n      include += this.filter.include_peers.length;\r\n\r\n      if(!include) {\r\n        toast('Please choose at least one chat for this folder.');\r\n        return;\r\n      }\r\n\r\n      this.confirmBtn.setAttribute('disabled', 'true');\r\n\r\n      let promise: Promise<boolean>;\r\n      if(!this.filter.id) {\r\n        promise = this.managers.filtersStorage.createDialogFilter(this.filter);\r\n      } else {\r\n        promise = this.managers.filtersStorage.updateDialogFilter(this.filter);\r\n      }\r\n\r\n      promise.then((bool) => {\r\n        if(bool) {\r\n          this.close();\r\n        }\r\n      }).catch((err) => {\r\n        if(err.type === 'DIALOG_FILTERS_TOO_MUCH') {\r\n          toast('Sorry, you can\\'t create more folders.');\r\n        } else {\r\n          console.error('updateDialogFilter error:', err);\r\n        }\r\n      }).finally(() => {\r\n        this.confirmBtn.removeAttribute('disabled');\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(this.nameInputField.input)('input', () => {\r\n      this.filter.title = this.nameInputField.value;\r\n      this.editCheckForChange();\r\n    });\r\n\r\n    const reloadMissingPromises: Promise<any>[] = this.type === 'edit' ? [\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'pinned_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'include_peers'),\r\n      this.managers.filtersStorage.reloadMissingPeerIds(this.filter.id, 'exclude_peers')\r\n    ] : [];\r\n\r\n    return Promise.all([\r\n      this.loadAnimationPromise = lottieLoader.loadAnimationAsAsset({\r\n        container: this.stickerContainer,\r\n        loop: false,\r\n        autoplay: false,\r\n        width: 86,\r\n        height: 86\r\n      }, 'Folders_2').then((player) => {\r\n        this.animation = player;\r\n\r\n        return lottieLoader.waitForFirstFrame(player);\r\n      }),\r\n\r\n      ...reloadMissingPromises\r\n    ]);\r\n  }\r\n\r\n  onOpenAfterTimeout() {\r\n    this.loadAnimationPromise.then(() => {\r\n      this.animation.autoplay = true;\r\n      this.animation.play();\r\n    });\r\n  }\r\n\r\n  private onCreateOpen() {\r\n    // this.caption.style.display = '';\r\n    this.setTitle('FilterNew');\r\n    this.menuBtn.classList.add('hide');\r\n    this.confirmBtn.classList.remove('hide');\r\n    this.nameInputField.value = '';\r\n\r\n    for(const flag in this.flags) {\r\n      // @ts-ignore\r\n      this.flags[flag].style.display = 'none';\r\n    }\r\n  }\r\n\r\n  private onEditOpen() {\r\n    // this.caption.style.display = 'none';\r\n    this.setTitle(this.type === 'create' ? 'FilterNew' : 'FilterHeaderEdit');\r\n\r\n    if(this.type === 'edit') {\r\n      this.menuBtn.classList.remove('hide');\r\n      this.confirmBtn.classList.add('hide');\r\n    }\r\n\r\n    const filter = this.filter;\r\n    this.nameInputField.value = documentFragmentToHTML(wrapDraftText(filter.title));\r\n\r\n    for(const flag in this.flags) {\r\n      this.flags[flag as keyof AppEditFolderTab['flags']].style.display = !!filter.pFlags[flag as keyof AppEditFolderTab['flags']] ? '' : 'none';\r\n    }\r\n\r\n    (['includePeerIds' as const, 'excludePeerIds' as const]).forEach(async(key) => {\r\n      const section = this[key];\r\n      const ul = appDialogsManager.createChatList({ignoreClick: true});\r\n\r\n      let peers = filter[key];\r\n\r\n      // filter peers where we're kicked\r\n      const hasPeer = async(peerId: PeerId) => {\r\n        return !!(await this.managers.appMessagesManager.getDialogOnly(peerId)) || (peerId.isUser() ? (await this.managers.appUsersManager.getUser(peerId.toUserId()))._ === 'user' : false);\r\n      };\r\n\r\n      const filtered = await filterAsync(peers, (peerId) => hasPeer(peerId));\r\n      peers.length = 0;\r\n      peers.push(...filtered);\r\n\r\n      peers = peers.slice();\r\n\r\n      const renderMore = async(_length: number) => {\r\n        for(let i = 0, length = Math.min(peers.length, _length); i < length; ++i) {\r\n          const peerId = peers.shift();\r\n          if(peerId.isUser() ? false : !(await this.managers.appMessagesManager.getDialogOnly(peerId))) {\r\n            continue;\r\n          }\r\n\r\n          const {dom} = appDialogsManager.addDialogNew({\r\n            peerId: peerId,\r\n            container: ul,\r\n            rippleEnabled: false,\r\n            meAsSaved: true,\r\n            avatarSize: 32\r\n          });\r\n          dom.lastMessageSpan.parentElement.remove();\r\n        }\r\n\r\n        if(peers.length) {\r\n          showMore.lastElementChild.replaceWith(i18n('FilterShowMoreChats', [peers.length]));\r\n        } else if(showMore) {\r\n          showMore.remove();\r\n        }\r\n      };\r\n\r\n      section.generateContentElement().append(ul);\r\n\r\n      let showMore: HTMLElement;\r\n      if(peers.length) {\r\n        const content = section.generateContentElement();\r\n        showMore = Button('folder-category-button btn btn-primary btn-transparent', {icon: 'down'});\r\n        showMore.classList.add('load-more', 'rp-overflow');\r\n        attachClickEvent(showMore, () => renderMore(20), {listenerSetter: this.listenerSetter});\r\n        showMore.append(i18n('FilterShowMoreChats', [peers.length]));\r\n\r\n        content.append(showMore);\r\n      }\r\n\r\n      renderMore(4);\r\n    });\r\n  }\r\n\r\n  editCheckForChange() {\r\n    if(this.type === 'edit') {\r\n      const changed = !deepEqual(this.originalFilter, this.filter);\r\n      this.confirmBtn.classList.toggle('hide', !changed);\r\n      this.menuBtn.classList.toggle('hide', changed);\r\n    }\r\n  };\r\n\r\n  setFilter(filter: DialogFilter, firstTime: boolean) {\r\n    if(this.container) {\r\n      // cleanup\r\n      Array.from(this.container.querySelectorAll('ul, .load-more')).forEach((el) => el.remove());\r\n    }\r\n\r\n    if(firstTime) {\r\n      this.originalFilter = filter;\r\n      this.filter = copy(filter);\r\n    } else {\r\n      this.filter = filter;\r\n      this.onEditOpen();\r\n      this.editCheckForChange();\r\n    }\r\n  }\r\n\r\n  public open(filter?: DialogFilter) {\r\n    if(filter === undefined) {\r\n      this.setFilter({\r\n        _: 'dialogFilter',\r\n        id: 0,\r\n        title: '',\r\n        pFlags: {},\r\n        pinned_peers: [],\r\n        include_peers: [],\r\n        exclude_peers: [],\r\n        pinnedPeerIds: [],\r\n        includePeerIds: [],\r\n        excludePeerIds: []\r\n      }, true);\r\n      this.type = 'create';\r\n    } else {\r\n      this.setFilter(filter, true);\r\n      this.type = 'edit';\r\n    }\r\n\r\n    return super.open().then(() => {\r\n      if(this.type === 'edit') {\r\n        this.setFilter(this.originalFilter, true);\r\n        this.onEditOpen();\r\n      } else {\r\n        this.onCreateOpen();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport SidebarSlider from '../slider';\r\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\r\nimport AppSharedMediaTab from './tabs/sharedMedia';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport const RIGHT_COLUMN_ACTIVE_CLASSNAME = 'is-right-column-shown';\r\n\r\nexport class AppSidebarRight extends SidebarSlider {\r\n  private isColumnProportionSet = false;\r\n  private sharedMediaTab: AppSharedMediaTab;\r\n\r\n  constructor() {\r\n    super({\r\n      sidebarEl: document.getElementById('column-right') as HTMLElement,\r\n      canHideFirst: true,\r\n      navigationType: 'right'\r\n    });\r\n  }\r\n\r\n  construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n\r\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\r\n      if(to === ScreenSize.medium && from !== ScreenSize.mobile) {\r\n        this.toggleSidebar(false);\r\n      }\r\n    });\r\n\r\n    mediaSizes.addEventListener('resize', () => {\r\n      this.setColumnProportion();\r\n    });\r\n  }\r\n\r\n  public createSharedMediaTab() {\r\n    const tab = this.createTab(AppSharedMediaTab, true);\r\n    tab.slider = this;\r\n    // this.tabsContainer.prepend(tab.container);\r\n    return tab;\r\n  }\r\n\r\n  public replaceSharedMediaTab(tab?: AppSharedMediaTab) {\r\n    const previousTab = this.sharedMediaTab;\r\n    if(previousTab) {\r\n      const idx = this.historyTabIds.indexOf(previousTab);\r\n\r\n      if(this._selectTab.getFrom() === previousTab.container) {\r\n        this._selectTab.setFrom(tab.container);\r\n      }\r\n\r\n      if(tab) {\r\n        if(idx !== -1) {\r\n          this.historyTabIds[idx] = tab;\r\n        }\r\n\r\n        const wasActive = previousTab.container.classList.contains('active');\r\n        if(wasActive) {\r\n          tab.container.classList.add('active');\r\n        }\r\n\r\n        previousTab.container.replaceWith(tab.container);\r\n      } else {\r\n        if(idx !== -1) {\r\n          this.historyTabIds.splice(idx, 1);\r\n        }\r\n\r\n        previousTab.container.remove();\r\n      }\r\n    } else {\r\n      this.tabsContainer.prepend(tab.container);\r\n    }\r\n\r\n    this.sharedMediaTab = tab;\r\n  }\r\n\r\n  public onCloseTab(id: number, animate: boolean, isNavigation?: boolean) {\r\n    if(!this.historyTabIds.length) {\r\n      this.toggleSidebar(false, animate);\r\n    }\r\n\r\n    super.onCloseTab(id, animate, isNavigation);\r\n  }\r\n\r\n  private setColumnProportion() {\r\n    const proportion = this.sidebarEl.scrollWidth / this.sidebarEl.previousElementSibling.scrollWidth;\r\n    document.documentElement.style.setProperty('--right-column-proportion', '' + proportion);\r\n  }\r\n\r\n  public toggleSidebar(enable?: boolean, animate?: boolean) {\r\n    const active = document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME);\r\n    let willChange: boolean;\r\n    if(enable !== undefined) {\r\n      if(enable) {\r\n        if(!active) {\r\n          willChange = true;\r\n        }\r\n      } else if(active) {\r\n        willChange = true;\r\n      }\r\n    } else {\r\n      willChange = true;\r\n    }\r\n\r\n    if(!willChange) return Promise.resolve();\r\n\r\n    if(!active && !this.historyTabIds.length) {\r\n      this.sharedMediaTab.open();\r\n    }\r\n\r\n    if(!this.isColumnProportionSet) {\r\n      this.setColumnProportion();\r\n      this.isColumnProportionSet = true;\r\n    }\r\n\r\n    const animationPromise = appImManager.selectTab(active ? 1 : 2, animate);\r\n    document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, enable);\r\n    return animationPromise;\r\n\r\n    /* return new Promise((resolve, reject) => {\r\n      const hidden: {element: HTMLDivElement, height: number}[] = [];\r\n      const observer = new IntersectionObserver((entries) => {\r\n        for(const entry of entries) {\r\n          const bubble = entry.target as HTMLDivElement;\r\n          if(!entry.isIntersecting) {\r\n            hidden.push({element: bubble, height: bubble.scrollHeight});\r\n          }\r\n        }\r\n\r\n        for(const item of hidden) {\r\n          item.element.style.minHeight = item.height + 'px';\r\n          (item.element.firstElementChild as HTMLElement).style.display = 'none';\r\n          item.element.style.width = '1px';\r\n        }\r\n\r\n        //console.log('hidden', hidden);\r\n        observer.disconnect();\r\n\r\n        set();\r\n\r\n        setTimeout(() => {\r\n          for(const item of hidden) {\r\n            item.element.style.minHeight = '';\r\n            item.element.style.width = '';\r\n            (item.element.firstElementChild as HTMLElement).style.display = '';\r\n          }\r\n\r\n          resolve();\r\n        }, 200);\r\n      });\r\n\r\n      const length = Object.keys(appImManager.bubbles).length;\r\n      if(length) {\r\n        for(const i in appImManager.bubbles) {\r\n          observer.observe(appImManager.bubbles[i]);\r\n        }\r\n      } else {\r\n        set();\r\n        setTimeout(resolve, 200);\r\n      }\r\n    }); */\r\n  }\r\n}\r\n\r\nconst appSidebarRight = new AppSidebarRight();\r\nMOUNT_CLASS_TO.appSidebarRight = appSidebarRight;\r\nexport default appSidebarRight;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport CheckboxField from '../../checkboxField';\r\nimport Button from '../../button';\r\nimport PeerTitle from '../../peerTitle';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport PopupPeer from '../../popups/peer';\r\nimport {addCancelButton} from '../../popups';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\r\nimport formatUserPhone from '../../wrappers/formatUserPhone';\r\n\r\nexport default class AppEditContactTab extends SliderSuperTab {\r\n  private nameInputField: InputField;\r\n  private lastNameInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  public peerId: PeerId;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'edit-contact-container');\r\n    const isNew = !(await this.managers.appUsersManager.isContact(this.peerId.toUserId()));\r\n    this.setTitle(isNew ? 'AddContactTitle' : 'Edit');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.nameInputField = new InputField({\r\n        label: 'FirstName',\r\n        name: 'contact-name',\r\n        maxLength: 70,\r\n        required: true\r\n      });\r\n      this.lastNameInputField = new InputField({\r\n        label: 'LastName',\r\n        name: 'contact-lastname',\r\n        maxLength: 70\r\n      });\r\n\r\n      if(this.peerId) {\r\n        const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n        if(isNew) {\r\n          this.nameInputField.setDraftValue(user.first_name);\r\n          this.lastNameInputField.setDraftValue(user.last_name);\r\n        } else {\r\n          this.nameInputField.setOriginalValue(user.first_name);\r\n          this.lastNameInputField.setOriginalValue(user.last_name);\r\n        }\r\n      }\r\n\r\n      inputWrapper.append(this.nameInputField.container, this.lastNameInputField.container);\r\n      inputFields.push(this.nameInputField, this.lastNameInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId: this.peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter,\r\n        doNotEditAvatar: true\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      if(this.peerId) {\r\n        const div = document.createElement('div');\r\n        div.classList.add('avatar-edit');\r\n        div.append(this.editPeer.avatarElem);\r\n\r\n        const notificationsCheckboxField = new CheckboxField({\r\n          text: 'Notifications'\r\n        });\r\n\r\n        notificationsCheckboxField.input.addEventListener('change', (e) => {\r\n          if(!e.isTrusted) {\r\n            return;\r\n          }\r\n\r\n          this.managers.appMessagesManager.togglePeerMute(this.peerId);\r\n        });\r\n\r\n        this.listenerSetter.add(rootScope)('notify_settings', async(update) => {\r\n          if(update.peer._ !== 'notifyPeer') return;\r\n          const peerId = getPeerId(update.peer.peer);\r\n          if(this.peerId === peerId) {\r\n            const enabled = !(await this.managers.appNotificationsManager.isMuted(update.notify_settings));\r\n            if(enabled !== notificationsCheckboxField.checked) {\r\n              notificationsCheckboxField.checked = enabled;\r\n            }\r\n          }\r\n        });\r\n\r\n        const profileNameDiv = document.createElement('div');\r\n        profileNameDiv.classList.add('profile-name');\r\n        profileNameDiv.append(new PeerTitle({\r\n          peerId: this.peerId\r\n        }).element);\r\n        // profileNameDiv.innerHTML = 'Karen Stanford';\r\n\r\n        const profileSubtitleDiv = document.createElement('div');\r\n        profileSubtitleDiv.classList.add('profile-subtitle');\r\n        profileSubtitleDiv.append(i18n('EditContact.OriginalName'));\r\n\r\n        section.content.append(div, profileNameDiv, profileSubtitleDiv, inputWrapper);\r\n\r\n        if(!isNew) {\r\n          const notificationsRow = new Row({\r\n            checkboxField: notificationsCheckboxField,\r\n            listenerSetter: this.listenerSetter\r\n          });\r\n\r\n          const enabled = !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false));\r\n          notificationsCheckboxField.checked = enabled;\r\n\r\n          section.content.append(notificationsRow.container);\r\n        } else {\r\n          const user = await this.managers.appUsersManager.getUser(this.peerId);\r\n\r\n          const phoneRow = new Row({\r\n            icon: 'phone',\r\n            titleLangKey: user.phone ? undefined : 'MobileHidden',\r\n            title: user.phone ? formatUserPhone(user.phone)  : undefined,\r\n            subtitleLangKey: user.phone ? 'Phone' : 'MobileHiddenExceptionInfo',\r\n            subtitleLangArgs: user.phone ? undefined : [new PeerTitle({peerId: this.peerId}).element]\r\n          });\r\n\r\n          section.content.append(phoneRow.container);\r\n        }\r\n      } else {\r\n        section.content.append(inputWrapper);\r\n      }\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, async() => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        this.managers.appUsersManager.addContact(\r\n          this.peerId,\r\n          this.nameInputField.value,\r\n          this.lastNameInputField.value,\r\n          (await this.managers.appUsersManager.getUser(this.peerId)).phone\r\n        ).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n    }\r\n\r\n    if(!isNew) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'PeerInfo.DeleteContact'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupPeer('popup-delete-contact', {\r\n          peerId: this.peerId,\r\n          titleLangKey: 'DeleteContact',\r\n          descriptionLangKey: 'AreYouSureDeleteContact',\r\n          buttons: addCancelButton([{\r\n            langKey: 'Delete',\r\n            callback: () => {\r\n              const toggle = toggleDisability([btnDelete], true);\r\n\r\n              this.managers.appUsersManager.deleteContacts([this.peerId]).then(() => {\r\n                this.close();\r\n              }, () => {\r\n                toggle();\r\n              });\r\n            },\r\n            isDanger: true\r\n          }])\r\n        }).show();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {copyTextToClipboard} from '../../../helpers/clipboard';\r\nimport {randomLong} from '../../../helpers/random';\r\nimport {Chat, ChatFull, ExportedChatInvite} from '../../../layer';\r\nimport Button from '../../button';\r\nimport {setButtonLoader} from '../../putPreloader';\r\nimport RadioField from '../../radioField';\r\nimport Row, {RadioFormFromRows} from '../../row';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport {toast} from '../../toast';\r\nimport {UsernameInputField} from '../../usernameInputField';\r\nimport {SliderSuperTabEventable} from '../../sliderTab';\r\nimport I18n from '../../../lib/langPack';\r\nimport PopupPeer from '../../popups/peer';\r\nimport ButtonCorner from '../../buttonCorner';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport rootScope from '../../../lib/rootScope';\r\n\r\nexport default class AppChatTypeTab extends SliderSuperTabEventable {\r\n  public chatId: ChatId;\r\n  public chatFull: ChatFull;\r\n\r\n  protected async init() {\r\n    this.container.classList.add('edit-peer-container', 'group-type-container');\r\n\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n\r\n    this.setTitle(isBroadcast ? 'ChannelType' : 'GroupType');\r\n\r\n    const section = new SettingSection({\r\n      name: isBroadcast ? 'ChannelType' : 'GroupType'\r\n    });\r\n\r\n    const random = randomLong();\r\n    const privateRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPrivate' : 'MegaPrivate',\r\n        name: random,\r\n        value: 'private'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateInfo' : 'MegaPrivateInfo'\r\n    });\r\n    const publicRow = new Row({\r\n      radioField: new RadioField({\r\n        langKey: isBroadcast ? 'ChannelPublic' : 'MegaPublic',\r\n        name: random,\r\n        value: 'public'\r\n      }),\r\n      subtitleLangKey: isBroadcast ? 'ChannelPublicInfo' : 'MegaPublicInfo'\r\n    });\r\n    const form = RadioFormFromRows([privateRow, publicRow], (value) => {\r\n      const a = [privateSection, publicSection];\r\n      if(value === 'public') a.reverse();\r\n\r\n      a[0].container.classList.remove('hide');\r\n      a[1].container.classList.add('hide');\r\n\r\n      onChange();\r\n    });\r\n\r\n    const chat: Chat = await this.managers.appChatsManager.getChat(this.chatId);\r\n\r\n    section.content.append(form);\r\n\r\n    const privateSection = new SettingSection({});\r\n\r\n    // let revoked = false;\r\n    const linkRow = new Row({\r\n      title: (this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link,\r\n      subtitleLangKey: isBroadcast ? 'ChannelPrivateLinkHelp' : 'MegaPrivateLinkHelp',\r\n      clickable: () => {\r\n        copyTextToClipboard((this.chatFull.exported_invite as ExportedChatInvite.chatInviteExported).link);\r\n        toast(I18n.format('LinkCopied', true));\r\n      },\r\n      listenerSetter: this.listenerSetter\r\n    });\r\n\r\n    const btnRevoke = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'RevokeLink'});\r\n\r\n    attachClickEvent(btnRevoke, () => {\r\n      new PopupPeer('revoke-link', {\r\n        buttons: [{\r\n          langKey: 'RevokeButton',\r\n          callback: () => {\r\n            const toggle = toggleDisability([btnRevoke], true);\r\n\r\n            this.managers.appProfileManager.getChatInviteLink(this.chatId, true).then((link) => {\r\n              toggle();\r\n              linkRow.title.innerHTML = link;\r\n              // revoked = true;\r\n              // onChange();\r\n            });\r\n          }\r\n        }],\r\n        titleLangKey: 'RevokeLink',\r\n        descriptionLangKey: 'RevokeAlert'\r\n      }).show();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    privateSection.content.append(linkRow.container, btnRevoke);\r\n\r\n    const publicSection = new SettingSection({\r\n      caption: isBroadcast ? 'Channel.UsernameAboutChannel' : 'Channel.UsernameAboutGroup',\r\n      noDelimiter: true\r\n    });\r\n\r\n    const inputWrapper = document.createElement('div');\r\n    inputWrapper.classList.add('input-wrapper');\r\n\r\n    const placeholder = 't.me/';\r\n\r\n    const onChange = () => {\r\n      const changed = (privateRow.radioField.checked && (originalValue !== placeholder/*  || revoked */)) ||\r\n        (linkInputField.isValidToChange() && linkInputField.input.classList.contains('valid'));\r\n      applyBtn.classList.toggle('is-visible', changed);\r\n    };\r\n\r\n    const linkInputField = new UsernameInputField({\r\n      label: 'SetUrlPlaceholder',\r\n      name: 'group-public-link',\r\n      plainText: true,\r\n      listenerSetter: this.listenerSetter,\r\n      availableText: 'Link.Available',\r\n      invalidText: 'Link.Invalid',\r\n      takenText: 'Link.Taken',\r\n      onChange: onChange,\r\n      peerId: this.chatId.toPeerId(true),\r\n      head: placeholder\r\n    }, this.managers);\r\n\r\n    const originalValue = placeholder + ((chat as Chat.channel).username || '');\r\n\r\n    inputWrapper.append(linkInputField.container)\r\n    publicSection.content.append(inputWrapper);\r\n\r\n    const applyBtn = ButtonCorner({icon: 'check', className: 'is-visible'});\r\n    this.content.append(applyBtn);\r\n\r\n    attachClickEvent(applyBtn, () => {\r\n      /* const unsetLoader =  */setButtonLoader(applyBtn);\r\n      const username = publicRow.radioField.checked ? linkInputField.getValue() : '';\r\n      this.managers.appChatsManager.migrateChat(this.chatId).then((channelId) => {\r\n        return this.managers.appChatsManager.updateUsername(channelId, username);\r\n      }).then(() => {\r\n        // unsetLoader();\r\n        this.close();\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    (originalValue !== placeholder ? publicRow : privateRow).radioField.checked = true;\r\n    linkInputField.setOriginalValue(originalValue);\r\n\r\n    this.scrollable.append(section.container, privateSection.container, publicSection.container);\r\n\r\n    {\r\n      const section = new SettingSection({\r\n        name: 'SavingContentTitle',\r\n        caption: isBroadcast ? 'RestrictSavingContentInfoChannel' : 'RestrictSavingContentInfoGroup'\r\n      });\r\n\r\n      const checkboxField = new CheckboxField({\r\n        text: 'RestrictSavingContent',\r\n        withRipple: true\r\n      });\r\n\r\n      this.listenerSetter.add(checkboxField.input)('change', () => {\r\n        const toggle = checkboxField.toggleDisability(true);\r\n        this.managers.appChatsManager.toggleNoForwards(this.chatId, checkboxField.checked).then(() => {\r\n          toggle();\r\n        });\r\n      });\r\n\r\n      const onChatUpdate = () => {\r\n        checkboxField.setValueSilently(!!(chat as Chat.channel).pFlags.noforwards);\r\n      };\r\n\r\n      this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n        if(this.chatId === chatId) {\r\n          onChatUpdate();\r\n        }\r\n      });\r\n\r\n      onChatUpdate();\r\n\r\n      section.content.append(checkboxField.label);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\nimport deepEqual from '../../../helpers/object/deepEqual';\nimport {ChannelParticipant} from '../../../layer';\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\nimport Button from '../../button';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport getUserStatusString from '../../wrappers/getUserStatusString';\nimport {ChatPermissions} from './groupPermissions';\n\nexport default class AppUserPermissionsTab extends SliderSuperTabEventable {\n  public participant: ChannelParticipant;\n  public chatId: ChatId;\n  public userId: UserId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'user-permissions-container');\n    this.setTitle('UserRestrictions');\n\n    let destroyListener: () => void;\n\n    {\n      const section = new SettingSection({\n        name: 'UserRestrictionsCanDo'\n      });\n\n      const div = document.createElement('div');\n      div.classList.add('chatlist-container');\n      section.content.insertBefore(div, section.title);\n\n      const list = appDialogsManager.createChatList({new: true});\n      div.append(list);\n\n      const {dom} = appDialogsManager.addDialogNew({\n        peerId: this.userId.toPeerId(false),\n        container: list,\n        rippleEnabled: true,\n        avatarSize: 48\n      });\n\n      dom.lastMessageSpan.append(getUserStatusString(await this.managers.appUsersManager.getUser(this.userId)));\n\n      const p = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content,\n        participant: this.participant._ === 'channelParticipantBanned' ? this.participant : undefined\n      }, this.managers);\n\n      destroyListener = () => {\n        // appChatsManager.editChatDefaultBannedRights(this.chatId, p.takeOut());\n        const rights = p.takeOut();\n        if(this.participant._ === 'channelParticipantBanned' && deepEqual(this.participant.banned_rights.pFlags, rights.pFlags)) {\n          return;\n        }\n\n        this.managers.appChatsManager.editBanned(this.chatId, this.participant, rights);\n      };\n\n      this.eventListener.addEventListener('destroy', destroyListener, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({});\n\n      if(this.participant._ === 'channelParticipantBanned') {\n        const btnDeleteException = Button('btn-primary btn-transparent danger', {icon: 'delete', text: 'GroupPermission.Delete'});\n\n        attachClickEvent(btnDeleteException, () => {\n          const toggle = toggleDisability([btnDeleteException], true);\n          this.managers.appChatsManager.clearChannelParticipantBannedRights(this.chatId, this.participant).then(() => {\n            this.eventListener.removeEventListener('destroy', destroyListener);\n            this.close();\n          }, () => {\n            toggle();\n          });\n        }, {listenerSetter: this.listenerSetter});\n\n        section.content.append(btnDeleteException);\n      }\n\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'deleteuser', text: 'UserRestrictionsBlock'});\n\n      attachClickEvent(btnDelete, () => {\n        const toggle = toggleDisability([btnDelete], true);\n        this.managers.appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n          this.eventListener.removeEventListener('destroy', destroyListener);\n          this.close();\n        });\n        /* new PopupPeer('popup-group-kick-user', {\n          peerId: -this.chatId,\n          title: 'Ban User?',\n          description: `Are you sure you want to ban <b>${appPeersManager.getPeerTitle(this.userId)}</b>`,\n          buttons: addCancelButton([{\n            text: 'BAN',\n            callback: () => {\n              const toggle = toggleDisability([btnDelete], true);\n\n              appChatsManager.kickFromChannel(this.chatId, this.participant).then(() => {\n                this.eventListener.removeEventListener('destroy', destroyListener);\n                this.close();\n              }, () => {\n                toggle();\n              });\n            },\n            isDanger: true\n          }])\n        }).show(); */\n      }, {listenerSetter: this.listenerSetter});\n\n      section.content.append(btnDelete);\n\n      this.scrollable.append(section.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport findUpTag from '../../../helpers/dom/findUpTag';\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport ListenerSetter from '../../../helpers/listenerSetter';\nimport ScrollableLoader from '../../../helpers/scrollableLoader';\nimport {ChannelParticipant, Chat, ChatBannedRights, Update} from '../../../layer';\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../../../lib/appManagers/appDialogsManager';\nimport {AppManagers} from '../../../lib/appManagers/managers';\nimport combineParticipantBannedRights from '../../../lib/appManagers/utils/chats/combineParticipantBannedRights';\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\nimport getPeerId from '../../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {i18n, join, LangPackKey} from '../../../lib/langPack';\nimport rootScope from '../../../lib/rootScope';\nimport CheckboxField from '../../checkboxField';\nimport PopupPickUser from '../../popups/pickUser';\nimport Row from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport {toast} from '../../toast';\nimport AppUserPermissionsTab from './userPermissions';\n\nexport class ChatPermissions {\n  public v: Array<{\n    flags: ChatRights[],\n    text: LangPackKey,\n    exceptionText: LangPackKey,\n    checkboxField?: CheckboxField,\n  }>;\n  private toggleWith: Partial<{[chatRight in ChatRights]: ChatRights[]}>;\n\n  constructor(private options: {\n    chatId: ChatId,\n    listenerSetter: ListenerSetter,\n    appendTo: HTMLElement,\n    participant?: ChannelParticipant.channelParticipantBanned\n  }, private managers: AppManagers) {\n    this.construct();\n  }\n\n  public async construct() {\n    this.v = [\n      {flags: ['send_messages'], text: 'UserRestrictionsSend', exceptionText: 'UserRestrictionsNoSend'},\n      {flags: ['send_media'], text: 'UserRestrictionsSendMedia', exceptionText: 'UserRestrictionsNoSendMedia'},\n      {flags: ['send_stickers', 'send_gifs'], text: 'UserRestrictionsSendStickers', exceptionText: 'UserRestrictionsNoSendStickers'},\n      {flags: ['send_polls'], text: 'UserRestrictionsSendPolls', exceptionText: 'UserRestrictionsNoSendPolls'},\n      {flags: ['embed_links'], text: 'UserRestrictionsEmbedLinks', exceptionText: 'UserRestrictionsNoEmbedLinks'},\n      {flags: ['invite_users'], text: 'UserRestrictionsInviteUsers', exceptionText: 'UserRestrictionsNoInviteUsers'},\n      {flags: ['pin_messages'], text: 'UserRestrictionsPinMessages', exceptionText: 'UserRestrictionsNoPinMessages'},\n      {flags: ['change_info'], text: 'UserRestrictionsChangeInfo', exceptionText: 'UserRestrictionsNoChangeInfo'}\n    ];\n\n    this.toggleWith = {\n      'send_messages': ['send_media', 'send_stickers', 'send_polls', 'embed_links']\n    };\n\n    const options = this.options;\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(options.chatId);\n    const defaultBannedRights = chat.default_banned_rights;\n    const rights = options.participant ? combineParticipantBannedRights(chat as Chat.channel, options.participant.banned_rights) : defaultBannedRights;\n\n    const restrictionText: LangPackKey = options.participant ? 'UserRestrictionsDisabled' : 'EditCantEditPermissionsPublic';\n    for(const info of this.v) {\n      const mainFlag = info.flags[0];\n      info.checkboxField = new CheckboxField({\n        text: info.text,\n        checked: hasRights(chat, mainFlag, rights),\n        restriction: true,\n        withRipple: true\n      });\n\n      if((\n        options.participant &&\n          defaultBannedRights.pFlags[mainFlag as keyof typeof defaultBannedRights['pFlags']]\n      ) || (\n        (chat as Chat.channel).username &&\n          (\n            info.flags.includes('pin_messages') ||\n            info.flags.includes('change_info')\n          )\n      )\n      ) {\n        info.checkboxField.input.disabled = true;\n\n        /* options.listenerSetter.add(info.checkboxField.input)('change', (e) => {\n          if(!e.isTrusted) {\n            return;\n          }\n\n          cancelEvent(e);\n          toast('This option is disabled for all members in Group Permissions.');\n          info.checkboxField.checked = false;\n        }); */\n\n        attachClickEvent(info.checkboxField.label, (e) => {\n          toast(I18n.format(restrictionText, true));\n        }, {listenerSetter: options.listenerSetter});\n      }\n\n      if(this.toggleWith[mainFlag]) {\n        options.listenerSetter.add(info.checkboxField.input)('change', () => {\n          if(!info.checkboxField.checked) {\n            const other = this.v.filter((i) => this.toggleWith[mainFlag].includes(i.flags[0]));\n            other.forEach((info) => {\n              info.checkboxField.checked = false;\n            });\n          }\n        });\n      }\n\n      options.appendTo.append(info.checkboxField.label);\n    }\n  }\n\n  public takeOut() {\n    const rights: ChatBannedRights = {\n      _: 'chatBannedRights',\n      until_date: 0x7FFFFFFF,\n      pFlags: {}\n    };\n\n    for(const info of this.v) {\n      const banned = !info.checkboxField.checked;\n      if(banned) {\n        info.flags.forEach((flag) => {\n          // @ts-ignore\n          rights.pFlags[flag] = true;\n        });\n      }\n    }\n\n    return rights;\n  }\n}\n\nexport default class AppGroupPermissionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.container.classList.add('edit-peer-container', 'group-permissions-container');\n    this.setTitle('ChannelPermissions');\n\n    let chatPermissions: ChatPermissions;\n    {\n      const section = new SettingSection({\n        name: 'ChannelPermissionsHeader'\n      });\n\n      chatPermissions = new ChatPermissions({\n        chatId: this.chatId,\n        listenerSetter: this.listenerSetter,\n        appendTo: section.content\n      }, this.managers);\n\n      this.eventListener.addEventListener('destroy', () => {\n        this.managers.appChatsManager.editChatDefaultBannedRights(this.chatId, chatPermissions.takeOut());\n      }, {once: true});\n\n      this.scrollable.append(section.container);\n    }\n\n    {\n      const section = new SettingSection({\n        name: 'PrivacyExceptions'\n      });\n\n      const addExceptionRow = new Row({\n        titleLangKey: 'ChannelAddException',\n        subtitleLangKey: 'Loading',\n        icon: 'adduser',\n        clickable: () => {\n          new PopupPickUser({\n            peerTypes: ['channelParticipants'],\n            onSelect: (peerId) => {\n              setTimeout(() => {\n                openPermissions(peerId);\n              }, 0);\n            },\n            placeholder: 'ExceptionModal.Search.Placeholder',\n            peerId: -this.chatId\n          });\n        },\n        listenerSetter: this.listenerSetter\n      });\n\n      const openPermissions = async(peerId: PeerId) => {\n        let participant: AppUserPermissionsTab['participant'];\n        try {\n          participant = await this.managers.appProfileManager.getChannelParticipant(this.chatId, peerId) as any;\n        } catch(err) {\n          toast('User is no longer participant');\n          return;\n        }\n\n        const tab = this.slider.createTab(AppUserPermissionsTab);\n        tab.participant = participant;\n        tab.chatId = this.chatId;\n        tab.userId = peerId;\n        tab.open();\n      };\n\n      section.content.append(addExceptionRow.container);\n\n      /* const removedUsersRow = new Row({\n        titleLangKey: 'ChannelBlockedUsers',\n        subtitleLangKey: 'NoBlockedUsers',\n        icon: 'deleteuser',\n        clickable: true\n      });\n\n      section.content.append(removedUsersRow.container); */\n\n      const c = section.generateContentElement();\n      c.classList.add('chatlist-container');\n\n      const list = appDialogsManager.createChatList({new: true});\n      c.append(list);\n\n      attachClickEvent(list, (e) => {\n        const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(!target) return;\n\n        const peerId = target.dataset.peerId.toPeerId();\n        openPermissions(peerId);\n      }, {listenerSetter: this.listenerSetter});\n\n      const setSubtitle = async(li: Element, participant: ChannelParticipant.channelParticipantBanned) => {\n        const bannedRights = participant.banned_rights;// appChatsManager.combineParticipantBannedRights(this.chatId, participant.banned_rights);\n        const defaultBannedRights = ((await this.managers.appChatsManager.getChat(this.chatId)) as Chat.channel).default_banned_rights;\n        // const combinedRights = appChatsManager.combineParticipantBannedRights(this.chatId, bannedRights);\n\n        const cantWhat: LangPackKey[] = []/* , canWhat: LangPackKey[] = [] */;\n        chatPermissions.v.forEach((info) => {\n          const mainFlag = info.flags[0];\n          // @ts-ignore\n          if(bannedRights.pFlags[mainFlag] && !defaultBannedRights.pFlags[mainFlag]) {\n            cantWhat.push(info.exceptionText);\n          // @ts-ignore\n          }/*  else if(!combinedRights.pFlags[mainFlag]) {\n            canWhat.push(info.exceptionText);\n          } */\n        });\n\n        const el = li.querySelector('.user-last-message') as HTMLElement;\n\n        if(cantWhat.length) {\n          el.innerHTML = '';\n          el.append(...join(cantWhat.map((t) => i18n(t)), false));\n        }/*  else if(canWhat.length) {\n          str = 'Can ' + canWhat.join(canWhat.length === 2 ? ' and ' : ', ');\n        } */\n\n        el.classList.toggle('hide', !cantWhat.length);\n      };\n\n      const add = (participant: ChannelParticipant.channelParticipantBanned, append: boolean) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: getPeerId(participant.peer),\n          container: list,\n          rippleEnabled: true,\n          avatarSize: 48,\n          append\n        });\n\n        setSubtitle(dom.listEl, participant);\n\n        // dom.titleSpan.innerHTML = 'Chinaza Akachi';\n        // dom.lastMessageSpan.innerHTML = 'Can Add Users and Pin Messages';\n      };\n\n      // this.listenerSetter.add(rootScope)('updateChannelParticipant', (update: Update.updateChannelParticipant) => {\n      //   const needAdd = update.new_participant?._ === 'channelParticipantBanned' && !update.new_participant.banned_rights.pFlags.view_messages;\n      //   const li = list.querySelector(`[data-peer-id=\"${update.user_id}\"]`);\n      //   if(needAdd) {\n      //     if(!li) {\n      //       add(update.new_participant as ChannelParticipant.channelParticipantBanned, false);\n      //     } else {\n      //       setSubtitle(li, update.new_participant as ChannelParticipant.channelParticipantBanned);\n      //     }\n\n      //     if(update.prev_participant?._ !== 'channelParticipantBanned') {\n      //       ++exceptionsCount;\n      //     }\n      //   } else {\n      //     if(li) {\n      //       li.remove();\n      //     }\n\n      //     if(update.prev_participant?._ === 'channelParticipantBanned') {\n      //       --exceptionsCount;\n      //     }\n      //   }\n\n      //   setLength();\n      // });\n\n      const setLength = () => {\n        replaceContent(addExceptionRow.subtitle, i18n(exceptionsCount ? 'Permissions.ExceptionsCount' : 'Permissions.NoExceptions', [exceptionsCount]));\n      };\n\n      let exceptionsCount = 0;\n      let loader: ScrollableLoader;\n      const setLoader = () => {\n        const LOAD_COUNT = 50;\n        loader = new ScrollableLoader({\n          scrollable: this.scrollable,\n          getPromise: () => {\n            return this.managers.appProfileManager.getChannelParticipants(this.chatId, {_: 'channelParticipantsBanned', q: ''}, LOAD_COUNT, list.childElementCount).then((res) => {\n              for(const participant of res.participants) {\n                add(participant as ChannelParticipant.channelParticipantBanned, true);\n              }\n\n              exceptionsCount = res.count;\n              setLength();\n\n              return res.participants.length < LOAD_COUNT || res.count === list.childElementCount;\n            });\n          }\n        });\n\n        return loader.load();\n      };\n\n      this.scrollable.append(section.container);\n\n      if(await this.managers.appChatsManager.isChannel(this.chatId)) {\n        await setLoader();\n      } else {\n        setLength();\n\n        this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n          if(this.chatId === migrateFrom) {\n            this.chatId = migrateTo;\n            setLoader();\n          }\n        });\n      }\n    }\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport copy from '../../../../helpers/object/copy';\nimport {ChatBannedRights, Chat} from '../../../../layer';\n\nexport default function combineParticipantBannedRights(chat: Chat.channel, rights: ChatBannedRights) {\n  if(chat.default_banned_rights) {\n    rights = copy(rights);\n    const defaultRights = chat.default_banned_rights.pFlags;\n    for(const i in defaultRights) {\n      // @ts-ignore\n      rights.pFlags[i] = defaultRights[i];\n    }\n  }\n\n  return rights;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../../helpers/dom/replaceContent';\nimport debounce from '../../../helpers/schedulers/debounce';\nimport {ChatReactions, Reaction} from '../../../layer';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport CheckboxField from '../../checkboxField';\nimport Row, {RadioFormFromValues} from '../../row';\nimport {SettingSection} from '../../sidebarLeft';\nimport {SliderSuperTabEventable} from '../../sliderTab';\nimport wrapStickerToRow from '../../wrappers/stickerToRow';\n\nexport default class AppChatReactionsTab extends SliderSuperTabEventable {\n  public chatId: ChatId;\n\n  protected async init() {\n    this.setTitle('Reactions');\n\n    const availableReactions = await this.managers.appReactionsManager.getActiveAvailableReactions();\n    const chatFull = await this.managers.appProfileManager.getChatFull(this.chatId);\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\n\n    let _chatReactions = chatFull.available_reactions ?? {_: 'chatReactionsNone'};\n    let chatReactions = _chatReactions;\n    let emoticons = new Set(_chatReactions._ === 'chatReactionsSome' ? _chatReactions.reactions.map((reaction) => (reaction as Reaction.reactionEmoji).emoticon) : []);\n\n    const makeReactionFromEmoticons = (emoticons: Array<string>): Reaction[] => emoticons.map((emoticon) => ({_: 'reactionEmoji', emoticon}));\n\n    const getCaptionLangPackKey = (): LangPackKey => {\n      if(isBroadcast) {\n        return 'EnableReactionsChannelInfo';\n      }\n\n      return chatReactions._ === 'chatReactionsAll' ? 'EnableAllReactionsInfo' : (chatReactions._ === 'chatReactionsNone' ? 'DisableReactionsInfo' : 'EnableSomeReactionsInfo');\n    };\n\n    const toggleSection = new SettingSection({\n      name: isBroadcast ? undefined : 'AvailableReactions',\n      caption: getCaptionLangPackKey()\n    });\n\n    const reactionsSection = new SettingSection({\n      name: 'OnlyAllowThisReactions'\n    });\n\n    const toggleCheckboxFieldsByEmoticons = () => {\n      const r: Reaction.reactionEmoji[] = (chatReactions as ChatReactions.chatReactionsSome).reactions as any ?? [];\n      emoticons = new Set(r.map(({emoticon}) => emoticon));\n      checkboxFieldsByEmoticon.forEach((checkboxField, emoticon) => {\n        checkboxField.setValueSilently(emoticons.has(emoticon));\n      });\n    };\n\n    let toggleCheckboxField: CheckboxField;\n    if(isBroadcast) {\n      toggleCheckboxField = new CheckboxField({toggle: true, checked: _chatReactions._ === 'chatReactionsSome'});\n      const toggleRow = new Row({\n        checkboxField: toggleCheckboxField,\n        titleLangKey: 'EnableReactions',\n        listenerSetter: this.listenerSetter\n      });\n\n      toggleSection.content.append(toggleRow.container);\n\n      this.listenerSetter.add(toggleCheckboxField.input)('change', () => {\n        let save = true;\n        if(!toggleCheckboxField.checked) {\n          chatReactions = {_: 'chatReactionsNone'};\n        } else if(checkboxFields.every((checkboxField) => !checkboxField.checked)) {\n          chatReactions = {_: 'chatReactionsSome', reactions: makeReactionFromEmoticons(availableReactions.map(({reaction}) => reaction))};\n        } else if(chatReactions._ !== 'chatReactionsSome') {\n          chatReactions = {_: 'chatReactionsSome', reactions: makeReactionFromEmoticons(Array.from(emoticons))};\n        } else {\n          save = false;\n        }\n\n        if(save) {\n          toggleCheckboxFieldsByEmoticons();\n          saveReactionsDebounced();\n        }\n      });\n    } else {\n      const a: [ChatReactions['_'], LangPackKey][] = [\n        ['chatReactionsAll', 'AllReactions'],\n        ['chatReactionsSome', 'SomeReactions'],\n        ['chatReactionsNone', 'NoReactions']\n      ];\n\n      const onChange = () => {\n        reactionsSection.container.classList.toggle('hide', chatReactions._ !== 'chatReactionsSome');\n      };\n\n      let value = _chatReactions._;\n      const form = RadioFormFromValues(a.map(([value, langPackKey]) => {\n        return {\n          langPackKey,\n          value,\n          checked: _chatReactions._ === value\n        };\n      }), (_value) => {\n        value = _value as any;\n\n        if(value === 'chatReactionsAll') {\n          chatReactions = {\n            _: value,\n            pFlags: {\n              allow_custom: true\n            }\n          };\n        } else if(value === 'chatReactionsNone') {\n          chatReactions = {\n            _: value\n          };\n        } else {\n          chatReactions = {\n            _: value,\n            reactions: makeReactionFromEmoticons(['', ''])\n          };\n        }\n\n        replaceContent(toggleSection.caption, i18n(getCaptionLangPackKey()));\n        toggleCheckboxFieldsByEmoticons();\n        saveReactionsDebounced();\n        onChange();\n      });\n\n      toggleSection.content.append(form);\n      onChange();\n    }\n\n    const checkboxFieldsByEmoticon: Map<string, CheckboxField> = new Map();\n    const checkboxFields = availableReactions.map((availableReaction) => {\n      const emoticon = availableReaction.reaction;\n      const checkboxField = new CheckboxField({\n        toggle: true,\n        checked: emoticons.has(emoticon)\n      });\n\n      checkboxFieldsByEmoticon.set(emoticon, checkboxField);\n\n      this.listenerSetter.add(checkboxField.input)('change', () => {\n        if(checkboxField.checked) {\n          emoticons.add(emoticon);\n\n          if(toggleCheckboxField && !toggleCheckboxField.checked) {\n            toggleCheckboxField.checked = true;\n          }\n        } else {\n          emoticons.delete(emoticon);\n\n          if(toggleCheckboxField?.checked && !emoticons.size) {\n            toggleCheckboxField.checked = false;\n          }\n        }\n\n        saveReactionsDebounced();\n      });\n\n      const row = new Row({\n        checkboxField,\n        title: availableReaction.title,\n        havePadding: true,\n        listenerSetter: this.listenerSetter\n      });\n\n      wrapStickerToRow({\n        row,\n        doc: availableReaction.static_icon,\n        size: 'small'\n      });\n\n      reactionsSection.content.append(row.container);\n\n      return checkboxField;\n    });\n\n    const saveReactions = async() => {\n      saveReactionsDebounced.clearTimeout();\n      // const newReactions = Array.from(enabledReactions);\n      // if([...newReactions].sort().join() === [...originalReactions].sort().join()) {\n      //   return;\n      // }\n\n      if(chatReactions._ === 'chatReactionsSome') {\n        chatReactions.reactions = makeReactionFromEmoticons(Array.from(emoticons));\n      }\n\n      // const r = (chatReactions as ChatReactions.chatReactionsSome).reactions;\n      // if(r?.length === availableReactions.length) {\n      //   chatReactions = {_: 'chatReactionsAll'};\n      // }\n\n      this.managers.appChatsManager.setChatAvailableReactions(this.chatId, chatReactions);\n      _chatReactions = chatReactions;\n    };\n\n    const saveReactionsDebounced = debounce(saveReactions, 3000, false, true);\n\n    this.eventListener.addEventListener('destroy', () => {\n      if(saveReactionsDebounced.isDebounced()) {\n        saveReactions();\n      }\n    }, {once: true});\n\n    this.scrollable.append(toggleSection.container, reactionsSection.container);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider'\r\nimport InputField from '../../inputField';\r\nimport EditPeer from '../../editPeer';\r\nimport {SettingSection} from '../../sidebarLeft';\r\nimport Row from '../../row';\r\nimport Button from '../../button';\r\nimport {ChatRights} from '../../../lib/appManagers/appChatsManager';\r\nimport {Chat, ChatFull} from '../../../layer';\r\nimport AppChatTypeTab from './chatType';\r\nimport rootScope from '../../../lib/rootScope';\r\nimport AppGroupPermissionsTab from './groupPermissions';\r\nimport {i18n, LangPackKey} from '../../../lib/langPack';\r\nimport PopupDeleteDialog from '../../popups/deleteDialog';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport toggleDisability from '../../../helpers/dom/toggleDisability';\r\nimport CheckboxField from '../../checkboxField';\r\nimport AppChatReactionsTab from './chatReactions';\r\nimport hasRights from '../../../lib/appManagers/utils/chats/hasRights';\r\nimport replaceContent from '../../../helpers/dom/replaceContent';\r\n\r\nexport default class AppEditChatTab extends SliderSuperTab {\r\n  private chatNameInputField: InputField;\r\n  private descriptionInputField: InputField;\r\n  private editPeer: EditPeer;\r\n  private tempId: number;\r\n  public chatId: ChatId;\r\n\r\n  protected async _init() {\r\n    // * cleanup prev\r\n    this.listenerSetter.removeAll();\r\n    this.scrollable.container.innerHTML = '';\r\n    this.tempId ??= 0;\r\n    const tempId = ++this.tempId;\r\n\r\n    this.container.classList.add('edit-peer-container', 'edit-group-container');\r\n    this.setTitle('Edit');\r\n\r\n    let chatFull = await this.managers.appProfileManager.getChatFull(this.chatId, true);\r\n\r\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(this.chatId);\r\n    const isBroadcast = await this.managers.appChatsManager.isBroadcast(this.chatId);\r\n    const isChannel = await this.managers.appChatsManager.isChannel(this.chatId);\r\n\r\n    const chatUpdateListeners: (() => void)[] = [];\r\n    const addChatUpdateListener = (callback: () => void) => {\r\n      chatUpdateListeners.push(callback);\r\n    };\r\n\r\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatUpdateListeners.forEach((callback) => callback());\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('chat_full_update', async(chatId) => {\r\n      if(this.chatId === chatId) {\r\n        chatFull = await this.managers.appProfileManager.getCachedFullChat(chatId) || chatFull;\r\n      }\r\n    });\r\n\r\n    const peerId = this.chatId.toPeerId(true);\r\n    const canChangeType = await this.managers.appChatsManager.hasRights(this.chatId, 'change_type');\r\n    const canChangePermissions = await this.managers.appChatsManager.hasRights(this.chatId, 'change_permissions');\r\n\r\n    {\r\n      const section = new SettingSection({noDelimiter: true});\r\n      const inputFields: InputField[] = [];\r\n\r\n      const inputWrapper = document.createElement('div');\r\n      inputWrapper.classList.add('input-wrapper');\r\n\r\n      this.chatNameInputField = new InputField({\r\n        label: isBroadcast ? 'EnterChannelName' : 'CreateGroup.NameHolder',\r\n        name: 'chat-name',\r\n        maxLength: 255,\r\n        required: true\r\n      });\r\n      this.descriptionInputField = new InputField({\r\n        label: 'DescriptionPlaceholder',\r\n        name: 'chat-description',\r\n        maxLength: 255\r\n      });\r\n\r\n      this.chatNameInputField.setOriginalValue(chat.title);\r\n      this.descriptionInputField.setOriginalValue(chatFull.about);\r\n\r\n      inputWrapper.append(this.chatNameInputField.container, this.descriptionInputField.container);\r\n\r\n      inputFields.push(this.chatNameInputField, this.descriptionInputField);\r\n\r\n      this.editPeer = new EditPeer({\r\n        peerId,\r\n        inputFields,\r\n        listenerSetter: this.listenerSetter\r\n      });\r\n      this.content.append(this.editPeer.nextBtn);\r\n\r\n      section.content.append(this.editPeer.avatarEdit.container, inputWrapper);\r\n\r\n      if(canChangeType) {\r\n        const chatTypeRow = new Row({\r\n          titleLangKey: isBroadcast ? 'ChannelType' : 'GroupType',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatTypeTab);\r\n            tab.chatId = this.chatId;\r\n            tab.chatFull = chatFull;\r\n            tab.open();\r\n\r\n            this.listenerSetter.add(tab.eventListener)('destroy', setChatTypeSubtitle);\r\n          },\r\n          icon: 'lock',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setChatTypeSubtitle = () => {\r\n          chatTypeRow.subtitle.textContent = '';\r\n\r\n          let key: LangPackKey;\r\n          if(isBroadcast) {\r\n            key = (chat as Chat.channel).username ? 'TypePublic' : 'TypePrivate';\r\n          } else {\r\n            key = (chat as Chat.channel).username ? 'TypePublicGroup' : 'TypePrivateGroup';\r\n          }\r\n\r\n          chatTypeRow.subtitle.append(i18n(key));\r\n        };\r\n\r\n        setChatTypeSubtitle();\r\n        section.content.append(chatTypeRow.container);\r\n      }\r\n\r\n      if(canChangeType || canChangePermissions) {\r\n        const reactionsRow = new Row({\r\n          titleLangKey: 'Reactions',\r\n          icon: 'reactions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppChatReactionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open().then(() => {\r\n              if(this.tempId !== tempId) {\r\n                return;\r\n              }\r\n\r\n              this.listenerSetter.add(tab.eventListener)('destroy', setReactionsLength);\r\n            });\r\n          },\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const availableReactions = await this.managers.appReactionsManager.getAvailableReactions();\r\n        const availableReactionsLength = availableReactions.filter((availableReaction) => !availableReaction.pFlags.inactive).length;\r\n        const setReactionsLength = () => {\r\n          const chatAvailableReactions = chatFull.available_reactions ?? {_: 'chatReactionsNone'};\r\n          if(chatAvailableReactions._ === 'chatReactionsSome') {\r\n            const length = chatAvailableReactions.reactions.length;\r\n            if(length === availableReactionsLength) {\r\n              replaceContent(reactionsRow.subtitle, i18n('ReactionsAll'));\r\n            } else {\r\n              reactionsRow.subtitle.textContent = length + '/' + availableReactionsLength;\r\n            }\r\n          } else {\r\n            replaceContent(reactionsRow.subtitle, i18n(chatAvailableReactions._ === 'chatReactionsAll' ? 'ReactionsAll' : 'Checkbox.Disabled'));\r\n          }\r\n        };\r\n\r\n        setReactionsLength();\r\n\r\n        section.content.append(reactionsRow.container);\r\n      }\r\n\r\n      if(canChangePermissions && !isBroadcast) {\r\n        const flags = [\r\n          'send_messages',\r\n          'send_media',\r\n          'send_stickers',\r\n          'send_polls',\r\n          'embed_links',\r\n          'invite_users',\r\n          'pin_messages',\r\n          'change_info'\r\n        ] as ChatRights[];\r\n\r\n        const permissionsRow = new Row({\r\n          titleLangKey: 'ChannelPermissions',\r\n          clickable: () => {\r\n            const tab = this.slider.createTab(AppGroupPermissionsTab);\r\n            tab.chatId = this.chatId;\r\n            tab.open();\r\n          },\r\n          icon: 'permissions',\r\n          listenerSetter: this.listenerSetter\r\n        });\r\n\r\n        const setPermissionsLength = async() => {\r\n          const chat = await this.managers.appChatsManager.getChatTyped(this.chatId);\r\n          permissionsRow.subtitle.innerHTML = flags.reduce((acc, f) => acc + +hasRights(chat, f, (chat as Chat.chat).default_banned_rights), 0) + '/' + flags.length;\r\n        };\r\n\r\n        setPermissionsLength();\r\n        section.content.append(permissionsRow.container);\r\n\r\n        this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\r\n          if(this.chatId === chatId) {\r\n            setPermissionsLength();\r\n          }\r\n        });\r\n      }\r\n\r\n      /* const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + ((chatFull as ChatFull.channelFull).admins_count || 1),\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      this.scrollable.append(section.container);\r\n\r\n      attachClickEvent(this.editPeer.nextBtn, () => {\r\n        this.editPeer.nextBtn.disabled = true;\r\n\r\n        const promises: Promise<any>[] = [];\r\n\r\n        const id = this.chatId;\r\n        if(this.chatNameInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editTitle(id, this.chatNameInputField.value));\r\n        }\r\n\r\n        if(this.descriptionInputField.isValidToChange()) {\r\n          promises.push(this.managers.appChatsManager.editAbout(id, this.descriptionInputField.value));\r\n        }\r\n\r\n        if(this.editPeer.uploadAvatar) {\r\n          promises.push(this.editPeer.uploadAvatar().then((inputFile) => {\r\n            return this.managers.appChatsManager.editPhoto(id, inputFile);\r\n          }));\r\n        }\r\n\r\n        Promise.race(promises).finally(() => {\r\n          this.editPeer.nextBtn.removeAttribute('disabled');\r\n          this.close();\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n\r\n      /* if(appChatsManager.hasRights(-this.peerId, 'change_info')) {\r\n        const discussionRow = new Row({\r\n          titleLangKey: 'PeerInfo.Discussion',\r\n          subtitleLangKey: 'PeerInfo.Discussion.Add',\r\n          clickable: true,\r\n          icon: 'message'\r\n        });\r\n\r\n        section.content.append(discussionRow.container);\r\n      }\r\n\r\n      const administratorsRow = new Row({\r\n        titleLangKey: 'PeerInfo.Administrators',\r\n        subtitle: '' + chatFull.admins_count,\r\n        icon: 'admin',\r\n        clickable: true\r\n      });\r\n\r\n      section.content.append(administratorsRow.container); */\r\n\r\n      if(isBroadcast && await this.managers.appChatsManager.hasRights(this.chatId, 'change_info')) {\r\n        const signMessagesCheckboxField = new CheckboxField({\r\n          text: 'PeerInfo.SignMessages',\r\n          checked: !!(chat as Chat.channel).pFlags.signatures,\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(signMessagesCheckboxField.input)('change', () => {\r\n          const toggle = signMessagesCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.toggleSignatures(this.chatId, signMessagesCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        addChatUpdateListener(() => {\r\n          signMessagesCheckboxField.setValueSilently(!!(chat as Chat.channel).pFlags.signatures);\r\n        });\r\n\r\n        section.content.append(signMessagesCheckboxField.label);\r\n      }\r\n    }\r\n\r\n    if(!isBroadcast) {\r\n      const section = new SettingSection({\r\n\r\n      });\r\n\r\n      /* const membersRow = new Row({\r\n        titleLangKey: isBroadcast ? 'PeerInfo.Subscribers' : 'GroupMembers',\r\n        icon: 'newgroup',\r\n        clickable: true\r\n      });\r\n\r\n      membersRow.subtitle.append(i18n('Subscribers', [numberThousandSplitter(335356)]));\r\n\r\n      section.content.append(membersRow.container); */\r\n\r\n      if(!isBroadcast && canChangeType) {\r\n        const showChatHistoryCheckboxField = new CheckboxField({\r\n          text: 'ChatHistory',\r\n          withRipple: true\r\n        });\r\n\r\n        this.listenerSetter.add(showChatHistoryCheckboxField.input)('change', () => {\r\n          const toggle = showChatHistoryCheckboxField.toggleDisability(true);\r\n          this.managers.appChatsManager.togglePreHistoryHidden(this.chatId, !showChatHistoryCheckboxField.checked).then(() => {\r\n            toggle();\r\n          });\r\n        });\r\n\r\n        // ! it won't be updated because chatFull will be old\r\n        const onChatUpdate = () => {\r\n          showChatHistoryCheckboxField.setValueSilently(isChannel && !(chatFull as ChatFull.channelFull).pFlags.hidden_prehistory);\r\n        };\r\n\r\n        onChatUpdate();\r\n        addChatUpdateListener(onChatUpdate);\r\n\r\n        section.content.append(showChatHistoryCheckboxField.label);\r\n      }\r\n\r\n      if(section.content.childElementCount) {\r\n        this.scrollable.append(section.container);\r\n      }\r\n    }\r\n\r\n    if(await this.managers.appChatsManager.hasRights(this.chatId, 'delete_chat')) {\r\n      const section = new SettingSection({});\r\n\r\n      const btnDelete = Button('btn-primary btn-transparent danger', {icon: 'delete', text: isBroadcast ? 'PeerInfo.DeleteChannel' : 'DeleteAndExitButton'});\r\n\r\n      attachClickEvent(btnDelete, () => {\r\n        new PopupDeleteDialog(peerId/* , 'delete' */, undefined, (promise) => {\r\n          const toggle = toggleDisability([btnDelete], true);\r\n          promise.then(() => {\r\n            this.close();\r\n          }, () => {\r\n            toggle();\r\n          });\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      section.content.append(btnDelete);\r\n\r\n      this.scrollable.append(section.container);\r\n    }\r\n\r\n    if(!isChannel) {\r\n      // ! this one will fire earlier than tab's closeAfterTimeout (destroy) event and listeners will be erased, so destroy won't fire\r\n      this.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\r\n        if(peerId === migrateFrom) {\r\n          this.chatId = migrateTo.toChatId();\r\n          this._init();\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  protected init() {\r\n    return this._init();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../../lib/rootScope';\nimport AppSearchSuper, {SearchSuperType} from '../../appSearchSuper.';\nimport SidebarSlider, {SliderSuperTab} from '../../slider';\nimport {TransitionSlider} from '../../transition';\nimport AppEditChatTab from './editChat';\nimport PeerTitle from '../../peerTitle';\nimport AppEditContactTab from './editContact';\nimport Button from '../../button';\nimport ButtonIcon from '../../buttonIcon';\nimport {i18n, LangPackKey} from '../../../lib/langPack';\nimport {toastNew} from '../../toast';\nimport AppAddMembersTab from '../../sidebarLeft/tabs/addMembers';\nimport PopupPickUser from '../../popups/pickUser';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerCheckboxOptions} from '../../popups/peer';\nimport ButtonCorner from '../../buttonCorner';\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\nimport PeerProfile from '../../peerProfile';\nimport {Message} from '../../../layer';\n\nconst historiesStorage: {\n  [peerId: PeerId]: Partial<{\n    [type in SearchSuperType]: {mid: number, peerId: PeerId}[]\n  }>\n} = {};\n\n// TODO:    \nexport default class AppSharedMediaTab extends SliderSuperTab {\n  private editBtn: HTMLElement;\n\n  private peerId: PeerId;\n  private threadId = 0;\n\n  private searchSuper: AppSearchSuper;\n\n  private profile: PeerProfile;\n  private peerChanged: boolean;\n\n  constructor(slider: SidebarSlider) {\n    super(slider, false);\n  }\n\n  public init() {\n    // const perf = performance.now();\n\n    this.container.classList.add('shared-media-container', 'profile-container');\n\n    // * header\n    const newCloseBtn = Button('btn-icon sidebar-close-button', {noRipple: true});\n    this.closeBtn.replaceWith(newCloseBtn);\n    this.closeBtn = newCloseBtn;\n\n    const animatedCloseIcon = document.createElement('div');\n    animatedCloseIcon.classList.add('animated-close-icon');\n    newCloseBtn.append(animatedCloseIcon);\n\n    const transitionContainer = document.createElement('div');\n    transitionContainer.className = 'transition slide-fade';\n\n    const transitionFirstItem = document.createElement('div');\n    transitionFirstItem.classList.add('transition-item');\n\n    this.title.append(i18n('Profile'));\n    this.editBtn = ButtonIcon('edit');\n    // const moreBtn = ButtonIcon('more');\n\n    transitionFirstItem.append(this.title, this.editBtn/* , moreBtn */);\n\n    const transitionLastItem = document.createElement('div');\n    transitionLastItem.classList.add('transition-item');\n\n    const secondTitle: HTMLElement = this.title.cloneNode() as any;\n    secondTitle.append(i18n('PeerInfo.SharedMedia'));\n\n    transitionLastItem.append(secondTitle);\n\n    transitionContainer.append(transitionFirstItem, transitionLastItem);\n\n    this.header.append(transitionContainer);\n\n    // * body\n\n    this.profile = new PeerProfile(this.managers, this.scrollable, this.listenerSetter);\n    this.profile.init();\n\n    this.scrollable.append(this.profile.element);\n\n    const HEADER_HEIGHT = 56;\n    this.scrollable.onAdditionalScroll = () => {\n      const rect = this.searchSuper.nav.getBoundingClientRect();\n      if(!rect.width) return;\n\n      const top = rect.top - 1;\n      setIsSharedMedia(top <= HEADER_HEIGHT);\n    };\n\n    const setIsSharedMedia = (isSharedMedia: boolean) => {\n      animatedCloseIcon.classList.toggle('state-back', isSharedMedia);\n      this.searchSuper.container.classList.toggle('is-full-viewport', isSharedMedia);\n      transition(+isSharedMedia);\n\n      if(!isSharedMedia) {\n        this.searchSuper.cleanScrollPositions();\n      }\n    };\n\n    const transition = TransitionSlider(transitionContainer, 'slide-fade', 400, null, false);\n\n    transition(0);\n\n    attachClickEvent(this.closeBtn, (e) => {\n      if(this.closeBtn.firstElementChild.classList.contains('state-back')) {\n        this.scrollable.scrollIntoViewNew({\n          element: this.scrollable.container.firstElementChild as HTMLElement,\n          position: 'start'\n        });\n        transition(0);\n        animatedCloseIcon.classList.remove('state-back');\n      } else if(!this.scrollable.isHeavyAnimationInProgress) {\n        this.slider.onCloseBtnClick();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    attachClickEvent(this.editBtn, (e) => {\n      let tab: AppEditChatTab | AppEditContactTab;\n      if(this.peerId.isAnyChat()) {\n        tab = this.slider.createTab(AppEditChatTab);\n      } else {\n        tab = this.slider.createTab(AppEditContactTab);\n      }\n\n      if(tab) {\n        if(tab instanceof AppEditChatTab) {\n          tab.chatId = this.peerId.toChatId();\n        } else {\n          tab.peerId = this.peerId;\n        }\n\n        tab.open();\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    this.listenerSetter.add(rootScope)('contacts_update', (userId) => {\n      if(this.peerId === userId) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', (chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        this.toggleEditBtn();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\n      this.renderNewMessages(message);\n    });\n\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\n      this.deleteDeletedMessages(peerId, Array.from(msgs));\n    });\n\n    // Calls when message successfully sent and we have an id\n    this.listenerSetter.add(rootScope)('message_sent', ({message}) => {\n      this.renderNewMessages(message);\n    });\n\n    // this.container.prepend(this.closeBtn.parentElement);\n\n    this.searchSuper = new AppSearchSuper({\n      mediaTabs: [{\n        inputFilter: 'inputMessagesFilterEmpty',\n        name: 'PeerMedia.Members',\n        type: 'members'\n      }, {\n        inputFilter: 'inputMessagesFilterPhotoVideo',\n        name: 'SharedMediaTab2',\n        type: 'media'\n      }, {\n        inputFilter: 'inputMessagesFilterDocument',\n        name: 'SharedFilesTab2',\n        type: 'files'\n      }, {\n        inputFilter: 'inputMessagesFilterUrl',\n        name: 'SharedLinksTab2',\n        type: 'links'\n      }, {\n        inputFilter: 'inputMessagesFilterMusic',\n        name: 'SharedMusicTab2',\n        type: 'music'\n      }, {\n        inputFilter: 'inputMessagesFilterRoundVoice',\n        name: 'SharedVoiceTab2',\n        type: 'voice'\n      }],\n      scrollable: this.scrollable,\n      onChangeTab: (mediaTab) => {\n        const timeout = mediaTab.type === 'members' && rootScope.settings.animationsEnabled ? 250 : 0;\n        setTimeout(() => {\n          btnAddMembers.classList.toggle('is-hidden', mediaTab.type !== 'members');\n        }, timeout);\n      },\n      managers: this.managers\n    });\n\n    this.searchSuper.scrollStartCallback = () => {\n      setIsSharedMedia(true);\n    };\n\n    this.profile.element.append(this.searchSuper.container);\n\n    const btnAddMembers = ButtonCorner({icon: 'addmember_filled'});\n    this.content.append(btnAddMembers);\n\n    attachClickEvent(btnAddMembers, async() => {\n      const peerId = this.peerId;\n      const id = this.peerId.toChatId();\n      const isChannel = await this.managers.appChatsManager.isChannel(id);\n\n      const showConfirmation = (peerIds: PeerId[], callback: (checked: PopupPeerButtonCallbackCheckboxes) => void) => {\n        let titleLangKey: LangPackKey, titleLangArgs: any[],\n          descriptionLangKey: LangPackKey, descriptionLangArgs: any[],\n          checkboxes: PopupPeerCheckboxOptions[];\n\n        if(peerIds.length > 1) {\n          titleLangKey = 'AddMembersAlertTitle';\n          titleLangArgs = [i18n('Members', [peerIds.length])];\n          descriptionLangKey = 'AddMembersAlertCountText';\n          descriptionLangArgs = peerIds.map((peerId) => {\n            const b = document.createElement('b');\n            b.append(new PeerTitle({peerId}).element);\n            return b;\n          });\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddMembersForwardMessages',\n              checked: true\n            }];\n          }\n        } else {\n          titleLangKey = 'AddOneMemberAlertTitle';\n          descriptionLangKey = 'AddMembersAlertNamesText';\n          const b = document.createElement('b');\n          b.append(new PeerTitle({\n            peerId: peerIds[0]\n          }).element);\n          descriptionLangArgs = [b];\n\n          if(!isChannel) {\n            checkboxes = [{\n              text: 'AddOneMemberForwardMessages',\n              textArgs: [new PeerTitle({peerId: peerIds[0]}).element],\n              checked: true\n            }];\n          }\n        }\n\n        descriptionLangArgs.push(new PeerTitle({\n          peerId\n        }).element);\n\n        new PopupPeer('popup-add-members', {\n          peerId,\n          titleLangKey,\n          descriptionLangKey,\n          descriptionLangArgs,\n          buttons: [{\n            langKey: 'Add',\n            callback\n          }],\n          checkboxes\n        }).show();\n      };\n\n      const onError = (err: any) => {\n        if(err.type === 'USER_PRIVACY_RESTRICTED') {\n          toastNew({langPackKey: 'InviteToGroupError'});\n        }\n      };\n\n      if(isChannel) {\n        const tab = this.slider.createTab(AppAddMembersTab);\n        tab.open({\n          type: 'channel',\n          skippable: false,\n          takeOut: (peerIds) => {\n            showConfirmation(peerIds, () => {\n              const promise = this.managers.appChatsManager.inviteToChannel(id, peerIds);\n              promise.catch(onError);\n              tab.attachToPromise(promise);\n            });\n\n            return false;\n          },\n          title: 'GroupAddMembers',\n          placeholder: 'SendMessageTo'\n        });\n      } else {\n        new PopupPickUser({\n          peerTypes: ['contacts'],\n          placeholder: 'Search',\n          onSelect: (peerId) => {\n            setTimeout(() => {\n              showConfirmation([peerId], (checked) => {\n                this.managers.appChatsManager.addChatUser(id, peerId, checked.size ? undefined : 0)\n                .catch(onError);\n              });\n            }, 0);\n          }\n        });\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    // console.log('construct shared media time:', performance.now() - perf);\n  }\n\n  public async renderNewMessages(message: Message.message | Message.messageService) {\n    if(this.init) return; // * not inited yet\n\n    const {peerId} = message;\n    if(!historiesStorage[peerId]) return;\n\n    for(const mediaTab of this.searchSuper.mediaTabs) {\n      const inputFilter = mediaTab.inputFilter;\n      const history = historiesStorage[peerId][inputFilter];\n      if(!history) {\n        continue;\n      }\n\n      const filtered = this.searchSuper.filterMessagesByType([message], inputFilter).filter((message) => !history.find((m) => m.mid === message.mid && m.peerId === message.peerId));\n      if(filtered.length) {\n        history.unshift(...filtered.map((message) => ({mid: message.mid, peerId: message.peerId})));\n\n        if(this.peerId === peerId && this.searchSuper.usedFromHistory[inputFilter] !== -1) {\n          this.searchSuper.usedFromHistory[inputFilter] += filtered.length;\n          this.searchSuper.performSearchResult(filtered, mediaTab, false);\n        }\n      }\n    }\n  }\n\n  public deleteDeletedMessages(peerId: PeerId, mids: number[]) {\n    if(this.init) return; // * not inited yet\n\n    if(!historiesStorage[peerId]) return;\n\n    for(const mid of mids) {\n      for(const type of this.searchSuper.mediaTabs) {\n        const inputFilter = type.inputFilter;\n\n        const history = historiesStorage[peerId][inputFilter];\n        if(!history) continue;\n\n        const idx = history.findIndex((m) => m.mid === mid);\n        if(idx === -1) {\n          continue;\n        }\n\n        history.splice(idx, 1);\n\n        if(this.peerId === peerId) {\n          const container = this.searchSuper.tabs[inputFilter];\n          const div = container.querySelector(`[data-mid=\"${mid}\"][data-peer-id=\"${peerId}\"]`) as HTMLElement;\n          if(div) {\n            if(this.searchSuper.selection.isSelecting) {\n              this.searchSuper.selection.toggleByElement(div);\n            }\n\n            div.remove();\n          }\n\n          if(this.searchSuper.usedFromHistory[inputFilter] >= (idx + 1)) {\n            --this.searchSuper.usedFromHistory[inputFilter];\n          }\n        }\n\n        // can have element in different tabs somehow\n        // break;\n      }\n    }\n\n    this.scrollable.onScroll();\n  }\n\n  public async cleanupHTML() {\n    // const perf = performance.now();\n    this.profile.cleanupHTML();\n    this.editBtn.classList.add('hide');\n    this.searchSuper.cleanupHTML(true);\n    this.container.classList.toggle('can-add-members', await this.searchSuper.canViewMembers() && await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'invite_users'));\n    // console.log('cleanupHTML shared media time:', performance.now() - perf);\n  }\n\n  public setLoadMutex(promise: Promise<any>) {\n    this.searchSuper.loadMutex = promise;\n  }\n\n  public setPeer(peerId: PeerId, threadId = 0) {\n    if(this.peerId === peerId && this.threadId === threadId) return false;\n\n    this.peerId = peerId;\n    this.threadId = threadId;\n    this.peerChanged = true;\n\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    this.searchSuper.setQuery({\n      peerId,\n      // threadId,\n      historyStorage: historiesStorage[peerId] ??= {}\n    });\n\n    this.profile.setPeer(peerId, threadId);\n\n    return true;\n  }\n\n  public async fillProfileElements() {\n    if(!this.peerChanged) {\n      return;\n    }\n\n    this.peerChanged = false;\n    await this.cleanupHTML();\n    await this.toggleEditBtn();\n    await this.profile.fillProfileElements();\n  }\n\n  private async toggleEditBtn() {\n    let show: boolean;\n    if(this.peerId.isUser()) {\n      show = this.peerId !== rootScope.myId && await this.managers.appUsersManager.isContact(this.peerId.toUserId());\n    } else {\n      show = await this.managers.appChatsManager.hasRights(this.peerId.toChatId(), 'change_info');\n    }\n\n    this.editBtn.classList.toggle('hide', !show);\n  }\n\n  public loadSidebarMedia(single: boolean, justLoad?: boolean) {\n    this.searchSuper.load(single, justLoad);\n  }\n\n  onOpenAfterTimeout() {\n    this.scrollable.onScroll();\n  }\n\n  public destroy() {\n    this.destroyable = true;\n    this.onCloseAfterTimeout();\n    this.profile.destroy();\n    this.searchSuper.destroy();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\n\r\nconst SetTransition = (\r\n  element: HTMLElement,\r\n  className: string,\r\n  forwards: boolean,\r\n  duration: number,\r\n  onTransitionEnd?: () => void,\r\n  useRafs?: number,\r\n  onTransitionStart?: () => void\r\n) => {\r\n  const {timeout, raf} = element.dataset;\r\n  if(timeout !== undefined) {\r\n    clearTimeout(+timeout);\r\n  }\r\n\r\n  // useRafs = undefined;\r\n  // duration = 0;\r\n\r\n  if(raf !== undefined) {\r\n    window.cancelAnimationFrame(+raf);\r\n    if(!useRafs) {\r\n      delete element.dataset.raf;\r\n    }\r\n  }\r\n\r\n  // if(forwards && className && element.classList.contains(className) && !element.classList.contains('animating')) {\r\n  //   return;\r\n  // }\r\n\r\n  if(useRafs && rootScope.settings.animationsEnabled && duration) {\r\n    element.dataset.raf = '' + window.requestAnimationFrame(() => {\r\n      delete element.dataset.raf;\r\n      SetTransition(element, className, forwards, duration, onTransitionEnd, useRafs - 1, onTransitionStart);\r\n    });\r\n\r\n    return;\r\n  }\r\n\r\n  if(forwards && className) {\r\n    element.classList.add(className);\r\n  }\r\n\r\n  const afterTimeout = () => {\r\n    delete element.dataset.timeout;\r\n    if(!forwards && className) {\r\n      element.classList.remove('backwards', className);\r\n    }\r\n\r\n    element.classList.remove('animating');\r\n\r\n    onTransitionEnd?.();\r\n  };\r\n\r\n  onTransitionStart?.();\r\n  if(!rootScope.settings.animationsEnabled || !duration) {\r\n    element.classList.remove('animating', 'backwards');\r\n    afterTimeout();\r\n    return;\r\n  }\r\n\r\n  element.classList.add('animating');\r\n\r\n  element.classList.toggle('backwards', !forwards);\r\n  element.dataset.timeout = '' + setTimeout(afterTimeout, duration);\r\n};\r\n\r\nexport default SetTransition;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {horizontalMenu} from './horizontalMenu';\r\nimport {TransitionSlider} from './transition';\r\nimport appNavigationController, {NavigationItem} from './appNavigationController';\r\nimport SliderSuperTab, {SliderSuperTabConstructable, SliderTab} from './sliderTab';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport indexOfAndSplice from '../helpers/array/indexOfAndSplice';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nconst TRANSITION_TIME = 250;\r\n\r\nexport type {SliderTab};\r\nexport {SliderSuperTab};\r\n\r\nexport default class SidebarSlider {\r\n  protected _selectTab: ReturnType<typeof horizontalMenu>;\r\n  public historyTabIds: (number | SliderSuperTab)[] = []; // * key is any, since right sidebar is ugly nowz\r\n  public tabsContainer: HTMLElement;\r\n  public sidebarEl: HTMLElement;\r\n  public tabs: Map<any, SliderTab>; // * key is any, since right sidebar is ugly now\r\n  private canHideFirst = false;\r\n  private navigationType: NavigationItem['type'];\r\n  protected managers: AppManagers;\r\n\r\n  constructor(options: {\r\n    sidebarEl: SidebarSlider['sidebarEl'],\r\n    tabs?: SidebarSlider['tabs'],\r\n    canHideFirst?: SidebarSlider['canHideFirst'],\r\n    navigationType: SidebarSlider['navigationType']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    if(!this.tabs) {\r\n      this.tabs = new Map();\r\n    }\r\n\r\n    this.tabsContainer = this.sidebarEl.querySelector('.sidebar-slider');\r\n    this._selectTab = TransitionSlider(this.tabsContainer, 'navigation', TRANSITION_TIME);\r\n    if(!this.canHideFirst) {\r\n      this._selectTab(0);\r\n    }\r\n\r\n    Array.from(this.sidebarEl.querySelectorAll('.sidebar-close-button') as any as HTMLElement[]).forEach((el) => {\r\n      attachClickEvent(el, this.onCloseBtnClick);\r\n    });\r\n  }\r\n\r\n  public onCloseBtnClick = () => {\r\n    const item = appNavigationController.findItemByType(this.navigationType);\r\n    if(item) {\r\n      appNavigationController.back(this.navigationType);\r\n    } else if(this.historyTabIds.length) {\r\n      this.closeTab(this.historyTabIds[this.historyTabIds.length - 1]);\r\n    }\r\n    // this.closeTab();\r\n  };\r\n\r\n  public closeTab = (id?: number | SliderSuperTab, animate?: boolean, isNavigation?: boolean) => {\r\n    if(id !== undefined && this.historyTabIds[this.historyTabIds.length - 1] !== id) {\r\n      return false;\r\n    }\r\n\r\n    // console.log('sidebar-close-button click:', this.historyTabIDs);\r\n    const closingId = this.historyTabIds.pop(); // pop current\r\n    this.onCloseTab(closingId, animate, isNavigation);\r\n\r\n    const tab = this.historyTabIds[this.historyTabIds.length - 1];\r\n    this._selectTab(tab !== undefined ? (tab instanceof SliderSuperTab ? tab.container : tab) : (this.canHideFirst ? -1 : 0), animate);\r\n    return true;\r\n  };\r\n\r\n  public selectTab(id: number | SliderSuperTab): boolean {\r\n    /* if(id instanceof SliderSuperTab) {\r\n      id = id.id;\r\n    } */\r\n\r\n    if(this.historyTabIds[this.historyTabIds.length - 1] === id) {\r\n      return false;\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onOpen) {\r\n        tab.onOpen();\r\n      }\r\n\r\n      if(tab.onOpenAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onOpenAfterTimeout();\r\n        }, TRANSITION_TIME);\r\n      }\r\n    }\r\n\r\n    // if(!this.canHideFirst || this.historyTabIds.length) {\r\n    appNavigationController.pushItem({\r\n      type: this.navigationType,\r\n      onPop: (canAnimate) => {\r\n        this.closeTab(undefined, canAnimate, true);\r\n        return true;\r\n      }\r\n    });\r\n    // }\r\n\r\n    this.historyTabIds.push(id);\r\n    this._selectTab(id instanceof SliderSuperTab ? id.container : id);\r\n    return true;\r\n  }\r\n\r\n  public removeTabFromHistory(id: number | SliderSuperTab) {\r\n    indexOfAndSplice(this.historyTabIds, id);\r\n    this.onCloseTab(id, undefined);\r\n  }\r\n\r\n  public sliceTabsUntilTab(tabConstructor: SliderSuperTabConstructable, preserveTab: SliderSuperTab) {\r\n    for(let i = this.historyTabIds.length - 1; i >= 0; --i) {\r\n      const tab = this.historyTabIds[i];\r\n      if(tab === preserveTab) continue;\r\n      else if(tab instanceof tabConstructor) {\r\n        break;\r\n      }\r\n\r\n      this.removeTabFromHistory(tab);\r\n      // appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n  }\r\n\r\n  public getTab<T extends SliderSuperTab>(tabConstructor: SliderSuperTabConstructable<T>) {\r\n    return this.historyTabIds.find((t) => t instanceof tabConstructor) as T;\r\n  }\r\n\r\n  public isTabExists(tabConstructor: SliderSuperTabConstructable) {\r\n    return !!this.getTab(tabConstructor);\r\n  }\r\n\r\n  protected onCloseTab(id: number | SliderSuperTab, animate: boolean, isNavigation?: boolean) {\r\n    if(!isNavigation) {\r\n      appNavigationController.removeByType(this.navigationType, true);\r\n    }\r\n\r\n    const tab: SliderTab = id instanceof SliderSuperTab ? id : this.tabs.get(id);\r\n    if(tab) {\r\n      if(tab.onClose) {\r\n        tab.onClose();\r\n      }\r\n\r\n      if(tab.onCloseAfterTimeout) {\r\n        setTimeout(() => {\r\n          tab.onCloseAfterTimeout();\r\n        }, TRANSITION_TIME + 30);\r\n      }\r\n    }\r\n  }\r\n\r\n  public addTab(tab: SliderSuperTab) {\r\n    if(!tab.container.parentElement) {\r\n      this.tabsContainer.append(tab.container);\r\n\r\n      if(tab.closeBtn) {\r\n        tab.closeBtn.addEventListener('click', this.onCloseBtnClick);\r\n      }\r\n    }\r\n  }\r\n\r\n  public createTab<T extends SliderSuperTab>(ctor: SliderSuperTabConstructable<T>, doNotAppend?: boolean) {\r\n    const tab = new ctor(doNotAppend ? undefined : this, true);\r\n    tab.managers = this.managers;\r\n    return tab;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport {i18n, LangPackKey} from '../lib/langPack';\r\nimport ButtonIcon from './buttonIcon';\r\nimport Scrollable from './scrollable';\r\nimport SidebarSlider from './slider';\r\n\r\nexport interface SliderTab {\r\n  onOpen?: () => void,\r\n  onOpenAfterTimeout?: () => void,\r\n  onClose?: () => void,\r\n  onCloseAfterTimeout?: () => void\r\n}\r\n\r\nexport interface SliderSuperTabConstructable<T extends SliderSuperTab = any> {\r\n  new(slider: SidebarSlider, destroyable: boolean): T;\r\n}\r\n\r\nexport interface SliderSuperTabEventableConstructable {\r\n  new(slider: SidebarSlider, destroyable: boolean): SliderSuperTabEventable;\r\n}\r\n\r\nexport default class SliderSuperTab implements SliderTab {\r\n  public container: HTMLElement;\r\n\r\n  public header: HTMLElement;\r\n  public closeBtn: HTMLElement;\r\n  public title: HTMLElement;\r\n\r\n  public content: HTMLElement;\r\n  public scrollable: Scrollable;\r\n\r\n  public slider: SidebarSlider;\r\n  public destroyable: boolean;\r\n  public listenerSetter: ListenerSetter;\r\n\r\n  public managers: AppManagers;\r\n\r\n  constructor(slider: SidebarSlider, destroyable?: boolean) {\r\n    this._constructor(slider, destroyable);\r\n  }\r\n\r\n  public _constructor(slider: SidebarSlider, destroyable = true): any {\r\n    this.slider = slider;\r\n    this.destroyable = destroyable;\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('tabs-tab', 'sidebar-slider-item');\r\n\r\n    // * Header\r\n    this.header = document.createElement('div');\r\n    this.header.classList.add('sidebar-header');\r\n\r\n    this.closeBtn = ButtonIcon('left sidebar-close-button', {noRipple: true});\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add('sidebar-header__title');\r\n    this.header.append(this.closeBtn, this.title);\r\n\r\n    // * Content\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add('sidebar-content');\r\n\r\n    this.scrollable = new Scrollable(this.content, undefined, undefined, true);\r\n\r\n    this.container.append(this.header, this.content);\r\n\r\n    if(this.slider) {\r\n      this.slider.addTab(this);\r\n    }\r\n\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public close() {\r\n    return this.slider.closeTab(this);\r\n  }\r\n\r\n  public async open(...args: any[]) {\r\n    if(this.init) {\r\n      try {\r\n        const result = this.init();\r\n        this.init = null;\r\n\r\n        if(result instanceof Promise) {\r\n          await result;\r\n        }\r\n      } catch(err) {\r\n        console.error('open tab error', err);\r\n      }\r\n    }\r\n\r\n    this.slider.selectTab(this);\r\n  }\r\n\r\n  protected init(): Promise<any> | any {\r\n\r\n  }\r\n\r\n  public onCloseAfterTimeout() {\r\n    if(this.destroyable) { // ! WARNING,            !\r\n      this.slider.tabs.delete(this);\r\n      this.container.remove();\r\n      this.scrollable.destroy();\r\n      this.listenerSetter?.removeAll();\r\n    }\r\n  }\r\n\r\n  protected setTitle(key: LangPackKey) {\r\n    this.title.innerHTML = '';\r\n    this.title.append(i18n(key));\r\n  }\r\n}\r\n\r\nexport class SliderSuperTabEventable extends SliderSuperTab {\r\n  public eventListener: EventListenerBase<{\r\n    destroy: () => void\r\n  }>;\r\n\r\n  constructor(slider: SidebarSlider) {\r\n    super(slider);\r\n    this.eventListener = new EventListenerBase();\r\n  }\r\n\r\n  onCloseAfterTimeout() {\r\n    this.eventListener.dispatchEvent('destroy');\r\n    this.eventListener.cleanup();\r\n    return super.onCloseAfterTimeout();\r\n  }\r\n}\r\n\r\n/* // @ts-ignore\r\ninterface SliderSuperEventsTab extends SliderSuperTab, EventListenerBase<{}> {\r\n  superConstructor: (...args: any[]) => any;\r\n}\r\nclass SliderSuperEventsTab implements SliderSuperEventsTab {\r\n  constructor(slider: SidebarSlider) {\r\n    this.superConstructor([slider, true]);\r\n  }\r\n}\r\napplyMixins(SliderSuperEventsTab, [SliderSuperTab, EventListenerBase]);\r\n\r\n(window as any).lol = SliderSuperEventsTab\r\n\r\nexport {SliderSuperEventsTab}; */\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {AppDialogsManager, DialogDom} from '../lib/appManagers/appDialogsManager';\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\nimport isInDOM from '../helpers/dom/isInDOM';\nimport positionElementByIndex from '../helpers/dom/positionElementByIndex';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport {fastRaf} from '../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../helpers/sortedList';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport getUserStatusString from './wrappers/getUserStatusString';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\ninterface SortedUser extends SortedElementBase {\n  dom: DialogDom\n}\n\nexport default class SortedUserList extends SortedList<SortedUser> {\n  protected static SORT_INTERVAL = 30e3;\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 48;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0];\n  protected onListLengthChange: () => void;\n  protected getIndex: (element: SortedUser) => number;\n  protected onUpdate: (element: SortedUser) => void;\n  protected managers: AppManagers;\n\n  constructor(options: Partial<{\n    lazyLoadQueue: SortedUserList['lazyLoadQueue'],\n    avatarSize: SortedUserList['avatarSize'],\n    rippleEnabled: SortedUserList['rippleEnabled'],\n    createChatListOptions: SortedUserList['createChatListOptions'],\n    autonomous: SortedUserList['autonomous'],\n    onListLengthChange: SortedUserList['onListLengthChange'],\n    getIndex: SortedUserList['getIndex'],\n    onUpdate: SortedUserList['onUpdate']\n  }> & {\n    managers: SortedUserList['managers']\n  }) {\n    super({\n      getIndex: options.getIndex || ((element) => this.managers.appUsersManager.getUserStatusForSort(element.id)),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onUpdate: options.onUpdate || (async(element) => {\n        const status = getUserStatusString(await this.managers.appUsersManager.getUser(element.id));\n        replaceContent(element.dom.lastMessageSpan, status);\n      }),\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength && this.onListLengthChange) {\n          this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        (base as SortedUser).dom = dom;\n        return base as SortedUser;\n      },\n      updateElementWith: fastRaf,\n      updateListWith: async(callback) => {\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        await getHeavyAnimationPromise();\n\n        if(!isInDOM(this.list)) {\n          return callback(false);\n        }\n\n        callback(true);\n      }\n    });\n\n    safeAssign(this, options);\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n\n    let timeout: number;\n    const doTimeout = () => {\n      timeout = window.setTimeout(() => {\n        this.updateList((good) => {\n          if(good) {\n            doTimeout();\n          }\n        });\n      }, SortedUserList.SORT_INTERVAL);\n    };\n\n    doTimeout();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {simulateClickEvent, attachClickEvent} from '../helpers/dom/clickEvent';\nimport findUpAsChild from '../helpers/dom/findUpAsChild';\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport getVisibleRect from '../helpers/dom/getVisibleRect';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport {makeMediaSize} from '../helpers/mediaSize';\nimport {getMiddleware, Middleware} from '../helpers/middleware';\nimport {doubleRaf} from '../helpers/schedulers';\nimport pause from '../helpers/schedulers/pause';\nimport windowSize from '../helpers/windowSize';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport getStickerEffectThumb from '../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../lib/rlottie/rlottiePlayer';\nimport rootScope from '../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from './animationIntersector';\nimport SetTransition from './singleTransition';\nimport wrapSticker from './wrappers/sticker';\nimport {STICKER_EFFECT_MULTIPLIER} from './wrappers/sticker';\n\nlet hasViewer = false;\nexport default function attachStickerViewerListeners({listenTo, listenerSetter, selector}: {\n  listenerSetter: ListenerSetter,\n  listenTo: HTMLElement,\n  selector?: string\n}) {\n  if(IS_TOUCH_SUPPORTED) {\n    return;\n  }\n\n  const findTarget = (e: MouseEvent, checkForParent?: boolean) => {\n    const s = selector || `.media-sticker-wrapper`;\n    const el = (e.target as HTMLElement).closest(s) as HTMLElement;\n    return el && (!checkForParent || findUpAsChild(el, listenTo)) ? el : undefined;\n  };\n\n  const managers = rootScope.managers;\n\n  listenerSetter.add(listenTo)('mousedown', (e) => {\n    if(hasViewer || e.buttons > 1 || e.button !== 0) return;\n    let mediaContainer = findTarget(e);\n    if(!mediaContainer) {\n      return;\n    }\n\n    // const img: HTMLImageElement = mediaContainer.querySelector('img.media-sticker');\n\n    const docId = mediaContainer.dataset.docId;\n    if(!docId) {\n      return;\n    }\n\n    const className = 'sticker-viewer';\n    const group: AnimationItemGroup = 'STICKER-VIEWER';\n    const openDuration = 200;\n    const switchDuration = 200;\n    const previousGroup = animationIntersector.getOnlyOnePlayableGroup();\n    const _middleware = getMiddleware();\n    let container: HTMLElement, previousTransformer: HTMLElement;\n\n    const doThatSticker = async({mediaContainer, doc, middleware, lockGroups, isSwitching}: {\n      mediaContainer: HTMLElement,\n      doc: MyDocument,\n      middleware: Middleware,\n      lockGroups?: boolean,\n      isSwitching?: boolean\n    }) => {\n      const effectThumb = getStickerEffectThumb(doc);\n      const mediaRect: DOMRect = mediaContainer.getBoundingClientRect();\n      const s = makeMediaSize(doc.w, doc.h);\n      const size = effectThumb ? 280 : 360;\n      const boxSize = makeMediaSize(size, size);\n      const fitted = mediaRect.width === mediaRect.height ? boxSize : s.aspectFitted(boxSize);\n\n      const bubble = findUpClassName(mediaContainer, 'bubble');\n      const isOut = bubble ? bubble.classList.contains('is-out') : true;\n\n      const transformer = document.createElement('div');\n      transformer.classList.add(className + '-transformer');\n\n      const stickerContainer = document.createElement('div');\n      stickerContainer.classList.add(className + '-sticker');\n      /* transformer.style.width =  */stickerContainer.style.width = fitted.width + 'px';\n      /* transformer.style.height =  */stickerContainer.style.height = fitted.height + 'px';\n\n      const stickerEmoji = document.createElement('div');\n      stickerEmoji.classList.add(className + '-emoji');\n      stickerEmoji.append(wrapEmojiText(doc.stickerEmojiRaw));\n\n      if(effectThumb) {\n        const margin = (size * STICKER_EFFECT_MULTIPLIER - size) / 3 * (isOut ? 1 : -1);\n        transformer.classList.add('has-effect');\n        // const property = `--margin-${isOut ? 'right' : 'left'}`;\n        // stickerContainer.style.setProperty(property, `${margin * 2}px`);\n        transformer.style.setProperty('--translateX', `${margin}px`);\n        stickerEmoji.style.setProperty('--translateX', `${-margin}px`);\n      }\n\n      const overflowElement = findUpClassName(mediaContainer, 'scrollable');\n      const visibleRect = getVisibleRect(mediaContainer, overflowElement, true, mediaRect);\n      if(visibleRect.overflow.vertical || visibleRect.overflow.horizontal) {\n        stickerContainer.classList.add('is-overflow');\n      }\n\n      // if(img) {\n      //   const ratio = img.naturalWidth / img.naturalHeight;\n      //   if((mediaRect.width / mediaRect.height).toFixed(1) !== ratio.toFixed(1)) {\n\n      //     mediaRect = mediaRect.toJSON();\n      //   }\n      // }\n\n      const rect = mediaContainer.getBoundingClientRect();\n      const scaleX = rect.width / fitted.width;\n      const scaleY = rect.height / fitted.height;\n      const transformX = rect.left - (windowSize.width - rect.width) / 2;\n      const transformY = rect.top - (windowSize.height - rect.height) / 2;\n      transformer.style.transform = `translate(${transformX}px, ${transformY}px) scale(${scaleX}, ${scaleY})`;\n      if(isSwitching) transformer.classList.add('is-switching');\n      transformer.append(stickerContainer, stickerEmoji);\n      container.append(transformer);\n\n      const o = await wrapSticker({\n        doc,\n        div: stickerContainer,\n        group,\n        width: fitted.width,\n        height: fitted.height,\n        play: false,\n        loop: true,\n        middleware,\n        managers,\n        needFadeIn: false,\n        isOut,\n        withThumb: false,\n        relativeEffect: true,\n        loopEffect: true\n      }).then(({render}) => render);\n      if(!middleware()) return;\n\n      if(!container.parentElement) {\n        document.body.append(container);\n      }\n\n      const player = Array.isArray(o) ? o[0] : o;\n\n      const firstFramePromise = player instanceof RLottiePlayer ?\n        new Promise<void>((resolve) => player.addEventListener('firstFrame', resolve, {once: true})) :\n        Promise.resolve();\n      await Promise.all([firstFramePromise, doubleRaf()]);\n      await pause(0); // ! need it because firstFrame will be called just from the loop\n      if(!middleware()) return;\n\n      if(lockGroups) {\n        animationIntersector.setOnlyOnePlayableGroup(group);\n        animationIntersector.checkAnimations(true);\n      }\n\n      if(player instanceof RLottiePlayer) {\n        const prevPlayer = lottieLoader.getAnimation(mediaContainer);\n        player.curFrame = prevPlayer.curFrame;\n        player.play();\n        await new Promise<void>((resolve) => {\n          let i = 0;\n          const c = () => {\n            if(++i === 2) {\n              resolve();\n              player.removeEventListener('enterFrame', c);\n            }\n          };\n\n          player.addEventListener('enterFrame', c);\n        });\n        if(!middleware()) return;\n        player.pause();\n      } else if(player instanceof HTMLVideoElement) {\n        player.currentTime = (mediaContainer.querySelector('video') as HTMLVideoElement).currentTime;\n      }\n\n      return {\n        ready: () => {\n          if(player instanceof RLottiePlayer || player instanceof HTMLVideoElement) {\n            player.play();\n          }\n\n          if(effectThumb) {\n            simulateClickEvent(stickerContainer);\n          }\n        },\n        transformer\n      };\n    };\n\n    const timeout = window.setTimeout(async() => {\n      document.removeEventListener('mousemove', onMousePreMove);\n\n      container = document.createElement('div');\n      container.classList.add(className);\n      hasViewer = true;\n\n      const middleware = _middleware.get();\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let result: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        result = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          lockGroups: true\n        });\n        if(!result) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = result;\n\n      previousTransformer = transformer;\n\n      SetTransition(container, 'is-visible', true, openDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n\n      document.addEventListener('mousemove', onMouseMove);\n    }, 125);\n\n    const onMouseMove = async(e: MouseEvent) => {\n      const newMediaContainer = findTarget(e, true);\n      if(!newMediaContainer || mediaContainer === newMediaContainer) {\n        return;\n      }\n\n      const docId = newMediaContainer.dataset.docId;\n      if(!docId) {\n        return;\n      }\n\n      mediaContainer = newMediaContainer;\n      _middleware.clean();\n      const middleware = _middleware.get();\n\n      const doc = await managers.appDocsManager.getDoc(docId);\n      if(!middleware()) return;\n\n      let r: Awaited<ReturnType<typeof doThatSticker>>;\n      try {\n        r = await doThatSticker({\n          doc,\n          mediaContainer,\n          middleware,\n          isSwitching: true\n        });\n        if(!r) return;\n      } catch(err) {\n        return;\n      }\n\n      const {ready, transformer} = r;\n\n      const _previousTransformer = previousTransformer;\n      SetTransition(_previousTransformer, 'is-switching', true, switchDuration, () => {\n        _previousTransformer.remove();\n      });\n\n      previousTransformer = transformer;\n\n      SetTransition(transformer, 'is-switching', false, switchDuration, () => {\n        if(!middleware()) return;\n        ready();\n      });\n    };\n\n    const onMousePreMove = (e: MouseEvent) => {\n      if(!findUpAsChild(e.target as HTMLElement, mediaContainer)) {\n        onMouseUp();\n      }\n    };\n\n    const onMouseUp = () => {\n      clearTimeout(timeout);\n      _middleware.clean();\n\n      if(container) {\n        SetTransition(container, 'is-visible', false, openDuration, () => {\n          container.remove();\n          animationIntersector.setOnlyOnePlayableGroup(previousGroup);\n          animationIntersector.checkAnimations(false);\n          hasViewer = false;\n        });\n\n        attachClickEvent(document.body, cancelEvent, {capture: true, once: true});\n      }\n\n      document.removeEventListener('mousemove', onMousePreMove);\n      document.removeEventListener('mousemove', onMouseMove);\n      document.removeEventListener('mouseup', onMouseUp, {capture: true});\n    };\n\n    document.addEventListener('mousemove', onMousePreMove);\n    document.addEventListener('mouseup', onMouseUp, {once: true, capture: true});\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class StickyIntersector {\r\n  private headersObserver: IntersectionObserver;\r\n  private elementsObserver: IntersectionObserver;\r\n\r\n  constructor(private container: HTMLElement, private handler: (stuck: boolean, target: HTMLElement) => void) {\r\n    this.observeHeaders();\r\n    this.observeElements();\r\n  }\r\n\r\n  /**\r\n   * Sets up an intersection observer to notify when elements with the class\r\n   * `.sticky_sentinel--top` become visible/invisible at the top of the container.\r\n   * @param {!Element} container\r\n   */\r\n  private observeHeaders() {\r\n    this.headersObserver = new IntersectionObserver((entries) => {\r\n      for(const entry of entries) {\r\n        const targetInfo = entry.boundingClientRect;\r\n        const stickyTarget = entry.target.parentElement;\r\n        const rootBoundsInfo = entry.rootBounds;\r\n\r\n        // Started sticking.\r\n        if(targetInfo.bottom < rootBoundsInfo.top) {\r\n          this.handler(true, stickyTarget);\r\n        }\r\n\r\n        // Stopped sticking.\r\n        if(targetInfo.bottom >= rootBoundsInfo.top &&\r\n            targetInfo.bottom < rootBoundsInfo.bottom) {\r\n          this.handler(false, stickyTarget);\r\n        }\r\n      }\r\n    }, {threshold: 0, root: this.container});\r\n  }\r\n\r\n  private observeElements() {\r\n    this.elementsObserver = new IntersectionObserver((entries) => {\r\n      const entry = entries\r\n      .filter((entry) => entry.boundingClientRect.top < entry.rootBounds.top)\r\n      .sort((a, b) => a.boundingClientRect.top - b.boundingClientRect.top)[0];\r\n      if(!entry) return;\r\n\r\n      const container = entry.isIntersecting ? entry.target : entry.target.nextElementSibling;\r\n      this.handler(true, container as HTMLElement);\r\n    }, {root: this.container});\r\n  }\r\n\r\n  /**\r\n   * @param {!Element} container\r\n   * @param {string} className\r\n   */\r\n  private addSentinel(container: HTMLElement, className: string) {\r\n    const sentinel = document.createElement('div');\r\n    sentinel.classList.add('sticky_sentinel', className);\r\n    return container.appendChild(sentinel);\r\n  }\r\n\r\n  /**\r\n   * Notifies when elements w/ the `sticky` class begin to stick or stop sticking.\r\n   * Note: the elements should be children of `container`.\r\n   * @param {!Element} container\r\n   */\r\n  public observeStickyHeaderChanges(element: HTMLElement) {\r\n    const headerSentinel = this.addSentinel(element, 'sticky_sentinel--top');\r\n    this.headersObserver.observe(headerSentinel);\r\n\r\n    this.elementsObserver.observe(element);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.headersObserver.disconnect();\r\n    this.elementsObserver.disconnect();\r\n  }\r\n\r\n  public unobserve(element: HTMLElement, headerSentinel: HTMLElement) {\r\n    this.elementsObserver.unobserve(element);\r\n    this.headersObserver.unobserve(headerSentinel);\r\n  }\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from '../helpers/object/safeAssign';\r\nimport contextMenuController from '../helpers/contextMenuController';\r\n\r\nconst getEvent = (e: TouchEvent | MouseEvent) => {\r\n  return (e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent;\r\n};\r\n\r\nconst attachGlobalListenerTo = window;\r\n\r\nlet RESET_GLOBAL = false;\r\ncontextMenuController.addEventListener('toggle', (visible) => {\r\n  RESET_GLOBAL = visible;\r\n});\r\n\r\nexport type SwipeHandlerOptions = {\r\n  element: SwipeHandler['element'],\r\n  onSwipe: SwipeHandler['onSwipe'],\r\n  verifyTouchTarget?: SwipeHandler['verifyTouchTarget'],\r\n  onFirstSwipe?: SwipeHandler['onFirstSwipe'],\r\n  onReset?: SwipeHandler['onReset'],\r\n  cursor?: SwipeHandler['cursor'],\r\n  cancelEvent?: SwipeHandler['cancelEvent'],\r\n  listenerOptions?: SwipeHandler['listenerOptions']\r\n};\r\n\r\nexport default class SwipeHandler {\r\n  private element: HTMLElement;\r\n  private onSwipe: (xDiff: number, yDiff: number, e: TouchEvent | MouseEvent) => boolean | void;\r\n  private verifyTouchTarget: (evt: TouchEvent | MouseEvent) => boolean | Promise<boolean>;\r\n  private onFirstSwipe: () => void;\r\n  private onReset: () => void;\r\n  private cursor: 'grabbing' | 'move' | 'row-resize' | 'col-resize' | 'nesw-resize' | 'nwse-resize' | 'ne-resize' | 'se-resize' | 'sw-resize' | 'nw-resize' | 'n-resize' | 'e-resize' | 's-resize' | 'w-resize' | '' = 'grabbing';\r\n  private cancelEvent = true;\r\n  private listenerOptions: boolean | AddEventListenerOptions = false;\r\n  private setCursorTo: HTMLElement;\r\n\r\n  private hadMove = false;\r\n  private xDown: number = null;\r\n  private yDown: number = null;\r\n\r\n  constructor(options: SwipeHandlerOptions) {\r\n    safeAssign(this, options);\r\n\r\n    this.setCursorTo = this.element;\r\n\r\n    this.setListeners();\r\n  }\r\n\r\n  public setListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.addEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.addEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.addEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public removeListeners() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.removeEventListener('mousedown', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('mouseup', this.reset);\r\n    } else {\r\n      this.element.removeEventListener('touchstart', this.handleStart, this.listenerOptions);\r\n      attachGlobalListenerTo.removeEventListener('touchend', this.reset);\r\n    }\r\n  }\r\n\r\n  public setCursor(cursor: SwipeHandler['cursor']) {\r\n    this.cursor = cursor;\r\n\r\n    if(!IS_TOUCH_SUPPORTED && this.hadMove) {\r\n      this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n    }\r\n  }\r\n\r\n  reset = (e?: Event) => {\r\n    /* if(e) {\r\n      cancelEvent(e);\r\n    } */\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.removeEventListener('touchmove', this.handleMove, {capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.removeEventListener('mousemove', this.handleMove);\r\n      this.setCursorTo.style.cursor = '';\r\n    }\r\n\r\n    if(this.onReset && this.hadMove) {\r\n      this.onReset();\r\n    }\r\n\r\n    this.xDown = this.yDown = null;\r\n    this.hadMove = false;\r\n  };\r\n\r\n  handleStart = async(_e: TouchEvent | MouseEvent) => {\r\n    const e = getEvent(_e);\r\n    if(this.verifyTouchTarget && !(await this.verifyTouchTarget(_e))) {\r\n      return this.reset();\r\n    }\r\n\r\n    this.xDown = e.clientX;\r\n    this.yDown = e.clientY;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachGlobalListenerTo.addEventListener('touchmove', this.handleMove, {passive: false, capture: true});\r\n    } else {\r\n      attachGlobalListenerTo.addEventListener('mousemove', this.handleMove, false);\r\n    }\r\n  };\r\n\r\n  handleMove = (_e: TouchEvent | MouseEvent) => {\r\n    if(this.xDown === null || this.yDown === null || RESET_GLOBAL) {\r\n      this.reset();\r\n      return;\r\n    }\r\n\r\n    if(this.cancelEvent) {\r\n      cancelEvent(_e);\r\n    }\r\n\r\n    const e = getEvent(_e);\r\n    const xUp = e.clientX;\r\n    const yUp = e.clientY;\r\n\r\n    const xDiff = this.xDown - xUp;\r\n    const yDiff = this.yDown - yUp;\r\n\r\n    if(!this.hadMove) {\r\n      if(!xDiff && !yDiff) {\r\n        return;\r\n      }\r\n\r\n      this.hadMove = true;\r\n\r\n      if(!IS_TOUCH_SUPPORTED) {\r\n        this.setCursorTo.style.setProperty('cursor', this.cursor, 'important');\r\n      }\r\n\r\n      if(this.onFirstSwipe) {\r\n        this.onFirstSwipe();\r\n      }\r\n    }\r\n\r\n    // if(Math.abs(xDiff) > Math.abs(yDiff)) { /*most significant*/\r\n    //   if(xDiff > 0) { /* left swipe */\r\n\r\n    //   } else { /* right swipe */\r\n\r\n    //   }\r\n    // } else {\r\n    //   if(yDiff > 0) { /* up swipe */\r\n\r\n    //   } else { /* down swipe */\r\n\r\n    //   }\r\n    // }\r\n\r\n    /* reset values */\r\n    const onSwipeResult = this.onSwipe(xDiff, yDiff, _e);\r\n    if(onSwipeResult !== undefined && onSwipeResult) {\r\n      this.reset();\r\n    }\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport placeCaretAtEnd from '../helpers/dom/placeCaretAtEnd';\nimport {formatPhoneNumber} from '../helpers/formatPhoneNumber';\nimport {IS_APPLE, IS_ANDROID, IS_APPLE_MOBILE} from '../environment/userAgent';\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport InputField, {InputFieldOptions} from './inputField';\n\nexport default class TelInputField extends InputField {\n  private pasted = false;\n  public lastValue = '';\n\n  constructor(options: InputFieldOptions & {\n    onInput?: (formatted: ReturnType<typeof formatPhoneNumber>) => void\n  } = {}) {\n    super({\n      label: 'Contacts.PhoneNumber.Placeholder',\n      // plainText: true,\n      name: 'phone',\n      ...options\n    });\n\n    this.container.classList.add('input-field-phone');\n\n    const telEl = this.input;\n    if(telEl instanceof HTMLInputElement) {\n      telEl.type = 'tel';\n      telEl.autocomplete = 'rr55RandomRR55';\n    } else {\n      telEl.inputMode = 'decimal';\n\n      const pixelRatio = window.devicePixelRatio;\n      if(pixelRatio > 1) {\n        let letterSpacing: number;\n        if(IS_APPLE) {\n          letterSpacing = pixelRatio * -.16;\n        } else if(IS_ANDROID) {\n          letterSpacing = 0;\n        }\n\n        telEl.style.setProperty('--letter-spacing', letterSpacing + 'px');\n      }\n\n      const originalFunc = this.setValueSilently.bind(this);\n      this.setValueSilently = (value) => {\n        originalFunc(value);\n        placeCaretAtEnd(this.input, true);\n      };\n    }\n\n    telEl.addEventListener('input', () => {\n      // console.log('input', this.value);\n      telEl.classList.remove('error');\n\n      const value = this.value;\n      const diff = Math.abs(value.length - this.lastValue.length);\n      if(diff > 1 && !this.pasted && IS_APPLE_MOBILE) {\n        this.setValueSilently(this.lastValue + value);\n      }\n\n      this.pasted = false;\n\n      this.setLabel();\n\n      let formattedPhoneNumber: ReturnType<typeof formatPhoneNumber>;\n      let formatted: string, country: HelpCountry, countryCode: HelpCountryCode, leftPattern = '';\n      if(this.value.replace(/\\++/, '+') === '+') {\n        this.setValueSilently('+');\n      } else {\n        formattedPhoneNumber = formatPhoneNumber(this.value);\n        formatted = formattedPhoneNumber.formatted;\n        country = formattedPhoneNumber.country;\n        leftPattern = formattedPhoneNumber.leftPattern;\n        countryCode = formattedPhoneNumber.code;\n        this.setValueSilently(this.lastValue = formatted ? '+' + formatted : '');\n      }\n\n      telEl.dataset.leftPattern = leftPattern/* .replace(/X/g, '0') */;\n\n      // console.log(formatted, country);\n\n      options.onInput && options.onInput(formattedPhoneNumber);\n    });\n\n    telEl.addEventListener('paste', () => {\n      this.pasted = true;\n      // console.log('paste', telEl.value);\n    });\n\n    /* telEl.addEventListener('change', (e) => {\n      console.log('change', telEl.value);\n    }); */\n\n    telEl.addEventListener('keypress', (e) => {\n      // console.log('keypress', this.value);\n      const key = e.key;\n      if(/\\D/.test(key) && !(e.metaKey || e.ctrlKey) && key !== 'Backspace' && !(key === '+' && e.shiftKey/*  && !this.value */)) {\n        e.preventDefault();\n        return false;\n      }\n    });\n\n    /* telEl.addEventListener('focus', function(this: typeof telEl, e) {\n      this.removeAttribute('readonly'); // fix autocomplete\n    });*/\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport OverlayClickHandler from '../helpers/overlayClickHandler';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\n\r\nconst toastEl = document.createElement('div');\r\ntoastEl.classList.add('toast');\r\nlet timeout: number;\r\n\r\nconst x = new OverlayClickHandler('toast');\r\nx.addEventListener('toggle', (open) => {\r\n  if(!open) {\r\n    hideToast();\r\n  }\r\n});\r\n\r\nexport function hideToast() {\r\n  x.close();\r\n\r\n  toastEl.classList.remove('is-visible');\r\n  timeout && clearTimeout(+timeout);\r\n\r\n  timeout = window.setTimeout(() => {\r\n    toastEl.remove();\r\n    timeout = undefined;\r\n  }, 200);\r\n}\r\n\r\nexport function toast(content: string | Node, onClose?: () => void) {\r\n  x.close();\r\n\r\n  replaceContent(toastEl, content);\r\n\r\n  if(!toastEl.parentElement) {\r\n    document.body.append(toastEl);\r\n    void toastEl.offsetLeft; // reflow\r\n  }\r\n\r\n  toastEl.classList.add('is-visible');\r\n\r\n  timeout && clearTimeout(+timeout);\r\n  x.open(toastEl);\r\n\r\n  timeout = window.setTimeout(hideToast, 3000);\r\n\r\n  if(onClose) {\r\n    x.addEventListener('toggle', onClose, {once: true});\r\n  }\r\n}\r\n\r\nexport function toastNew(options: Partial<{\r\n  langPackKey: LangPackKey,\r\n  langPackArguments: FormatterArguments,\r\n  onClose: () => void\r\n}>) {\r\n  toast(i18n(options.langPackKey, options.langPackArguments), options.onClose);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../lib/rootScope';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport whichChild from '../helpers/dom/whichChild';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\n\r\nfunction slideNavigation(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.filter = `brightness(80%)`;\r\n  elements[0].style.transform = `translate3d(${-width * .25}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  tabContent.style.filter = '';\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = prevTabContent.style.filter = '';\r\n  };\r\n}\r\n\r\nfunction slideTabs(tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) {\r\n  // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n  // const scrollableContainer = findUpClassName(tabContent, 'scrollable-y');\r\n  // if(scrollableContainer && scrollableContainer.style.overflowY !== 'hidden') {\r\n  //   // const scrollBarWidth = scrollableContainer.offsetWidth - scrollableContainer.clientWidth;\r\n  //   scrollableContainer.style.overflowY = 'hidden';\r\n  //   // scrollableContainer.style.paddingRight = `${scrollBarWidth}px`;\r\n  //   // this.container.classList.add('sliding');\r\n  // }\r\n\r\n  // window.requestAnimationFrame(() => {\r\n  const width = prevTabContent.getBoundingClientRect().width;\r\n  /* tabContent.style.setProperty('--width', width + 'px');\r\n    prevTabContent.style.setProperty('--width', width + 'px');\r\n\r\n    tabContent.classList.add('active'); */\r\n  // void tabContent.offsetWidth; // reflow\r\n  const elements = [tabContent, prevTabContent];\r\n  if(toRight) elements.reverse();\r\n  elements[0].style.transform = `translate3d(${-width}px, 0, 0)`;\r\n  elements[1].style.transform = `translate3d(${width}px, 0, 0)`;\r\n\r\n  tabContent.classList.add('active');\r\n  void tabContent.offsetWidth; // reflow\r\n\r\n  tabContent.style.transform = '';\r\n  // });\r\n\r\n  return () => {\r\n    prevTabContent.style.transform = '';\r\n\r\n    // if(scrollableContainer) {\r\n    //   // Jolly Cobra's // Workaround for scrollable content flickering during animation.\r\n    //   if(isSafari) { // ! safari doesn't respect sticky header, so it flicks when overflow is changing\r\n    //     scrollableContainer.style.display = 'none';\r\n    //   }\r\n\r\n    //   scrollableContainer.style.overflowY = '';\r\n\r\n    //   if(isSafari) {\r\n    //     void scrollableContainer.offsetLeft; // reflow\r\n    //     scrollableContainer.style.display = '';\r\n    //   }\r\n\r\n    //   // scrollableContainer.style.paddingRight = '0';\r\n    //   // this.container.classList.remove('sliding');\r\n    // }\r\n  };\r\n}\r\n\r\nexport const TransitionSlider = (\r\n  content: HTMLElement,\r\n  type: 'tabs' | 'navigation' | 'zoom-fade' | 'slide-fade' | 'none'/*  | 'counter' */,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  let animationFunction: TransitionFunction = null;\r\n\r\n  switch(type) {\r\n    case 'tabs':\r\n      animationFunction = slideTabs;\r\n      break;\r\n    case 'navigation':\r\n      animationFunction = slideNavigation;\r\n      break;\r\n    /* default:\r\n      break; */\r\n  }\r\n\r\n  content.dataset.animation = type;\r\n\r\n  return Transition(content, animationFunction, transitionTime, onTransitionEnd, isHeavy, undefined, undefined, listenerSetter);\r\n};\r\n\r\ntype TransitionFunction = (tabContent: HTMLElement, prevTabContent: HTMLElement, toRight: boolean) => void | (() => void);\r\n\r\nconst Transition = (\r\n  content: HTMLElement,\r\n  animationFunction: TransitionFunction,\r\n  transitionTime: number,\r\n  onTransitionEnd?: (id: number) => void,\r\n  isHeavy = true,\r\n  once = false,\r\n  withAnimationListener = true,\r\n  listenerSetter?: ListenerSetter\r\n) => {\r\n  const onTransitionEndCallbacks: Map<HTMLElement, Function> = new Map();\r\n  let animationDeferred: CancellablePromise<void>;\r\n  // let animationStarted = 0;\r\n  let from: HTMLElement = null;\r\n\r\n  if(withAnimationListener) {\r\n    const listenerName = animationFunction ? 'transitionend' : 'animationend';\r\n\r\n    const onEndEvent = (e: TransitionEvent | AnimationEvent) => {\r\n      cancelEvent(e);\r\n\r\n      if((e.target as HTMLElement).parentElement !== content) {\r\n        return;\r\n      }\r\n\r\n      // console.log('Transition: transitionend', /* content, */ e, selectTab.prevId, performance.now() - animationStarted);\r\n\r\n      const callback = onTransitionEndCallbacks.get(e.target as HTMLElement);\r\n      callback?.();\r\n\r\n      if(e.target !== from) {\r\n        return;\r\n      }\r\n\r\n      if(!animationDeferred && isHeavy) return;\r\n\r\n      if(animationDeferred) {\r\n        animationDeferred.resolve();\r\n        animationDeferred = undefined;\r\n      }\r\n\r\n      if(onTransitionEnd) {\r\n        onTransitionEnd(selectTab.prevId());\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      if(once) {\r\n        if(listenerSetter) listenerSetter.removeManual(content, listenerName, onEndEvent);\r\n        else content.removeEventListener(listenerName, onEndEvent/* , {capture: false} */);\r\n        from = animationDeferred = undefined;\r\n        onTransitionEndCallbacks.clear();\r\n      }\r\n    };\r\n\r\n    // TODO: check for transition type (transform, etc) using by animationFunction\r\n    if(listenerSetter) listenerSetter.add(content)(listenerName, onEndEvent);\r\n    else content.addEventListener(listenerName, onEndEvent/* , {passive: true, capture: false} */);\r\n  }\r\n\r\n  function selectTab(id: number | HTMLElement, animate = true, overrideFrom?: typeof from) {\r\n    if(overrideFrom) {\r\n      from = overrideFrom;\r\n    }\r\n\r\n    if(id instanceof HTMLElement) {\r\n      id = whichChild(id);\r\n    }\r\n\r\n    const prevId = selectTab.prevId();\r\n    if(id === prevId) return false;\r\n\r\n    // console.log('selectTab id:', id);\r\n\r\n    const to = content.children[id] as HTMLElement;\r\n\r\n    if(!rootScope.settings.animationsEnabled || prevId === -1) {\r\n      animate = false;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      const timeout = content.dataset.timeout;\r\n      if(timeout !== undefined) {\r\n        clearTimeout(+timeout);\r\n      }\r\n\r\n      delete content.dataset.timeout;\r\n    }\r\n\r\n    if(!animate) {\r\n      if(from) from.classList.remove('active', 'to', 'from');\r\n      else if(to) { // fix instant opening back from closed slider (e.g. instant closening and opening right sidebar)\r\n        const callback = onTransitionEndCallbacks.get(to);\r\n        callback?.();\r\n      }\r\n\r\n      if(to) {\r\n        to.classList.remove('to', 'from');\r\n        to.classList.add('active');\r\n      }\r\n\r\n      content.classList.remove('animating', 'backwards', 'disable-hover');\r\n\r\n      from = to;\r\n\r\n      if(onTransitionEnd) onTransitionEnd(id);\r\n      return;\r\n    }\r\n\r\n    if(!withAnimationListener) {\r\n      content.dataset.timeout = '' + window.setTimeout(() => {\r\n        to.classList.remove('to');\r\n        from && from.classList.remove('from');\r\n        content.classList.remove('animating', 'backwards', 'disable-hover');\r\n        delete content.dataset.timeout;\r\n      }, transitionTime);\r\n    }\r\n\r\n    if(from) {\r\n      from.classList.remove('to');\r\n      from.classList.add('from');\r\n    }\r\n\r\n    content.classList.add('animating'/* , 'disable-hover' */);\r\n    const toRight = prevId < id;\r\n    content.classList.toggle('backwards', !toRight);\r\n\r\n    let onTransitionEndCallback: ReturnType<TransitionFunction>;\r\n    if(!to) {\r\n      // prevTabContent.classList.remove('active');\r\n    } else {\r\n      if(animationFunction) {\r\n        onTransitionEndCallback = animationFunction(to, from, toRight);\r\n      } else {\r\n        to.classList.add('active');\r\n      }\r\n\r\n      to.classList.remove('from');\r\n      to.classList.add('to');\r\n    }\r\n\r\n    if(to) {\r\n      onTransitionEndCallbacks.set(to, () => {\r\n        to.classList.remove('to');\r\n        onTransitionEndCallbacks.delete(to);\r\n      });\r\n    }\r\n\r\n    if(from/*  && false */) {\r\n      let timeout: number;\r\n      const _from = from;\r\n      const callback = () => {\r\n        clearTimeout(timeout);\r\n        _from.classList.remove('active', 'from');\r\n\r\n        if(onTransitionEndCallback) {\r\n          onTransitionEndCallback?.();\r\n        }\r\n\r\n        onTransitionEndCallbacks.delete(_from);\r\n      };\r\n\r\n      if(to) {\r\n        timeout = window.setTimeout(callback, transitionTime + 100); // something happened to container\r\n        onTransitionEndCallbacks.set(_from, callback);\r\n      } else {\r\n        timeout = window.setTimeout(callback, transitionTime);\r\n        onTransitionEndCallbacks.set(_from, () => {\r\n          clearTimeout(timeout);\r\n          onTransitionEndCallbacks.delete(_from);\r\n        });\r\n      }\r\n\r\n      if(isHeavy) {\r\n        if(!animationDeferred) {\r\n          animationDeferred = deferredPromise<void>();\r\n          // animationStarted = performance.now();\r\n        }\r\n\r\n        dispatchHeavyAnimationEvent(animationDeferred, transitionTime * 2);\r\n      }\r\n    }\r\n\r\n    from = to;\r\n  }\r\n\r\n  // selectTab.prevId = -1;\r\n  selectTab.prevId = () => from ? whichChild(from) : -1;\r\n  selectTab.getFrom = () => from;\r\n  selectTab.setFrom = (_from: HTMLElement) => from = _from;\r\n\r\n  return selectTab;\r\n};\r\n\r\nexport default Transition;\r\n","export default function isUsernameValid(username: string) {\n  return ((username.length >= 5 && username.length <= 32) || !username.length) && /^[a-zA-Z0-9_]*$/.test(username);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport debounce from '../helpers/schedulers/debounce';\r\nimport {LangPackKey} from '../lib/langPack';\r\nimport InputField, {InputFieldOptions, InputState} from './inputField';\r\nimport isUsernameValid from '../lib/richTextProcessor/isUsernameValid';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\n\r\nexport class UsernameInputField extends InputField {\r\n  private checkUsernamePromise: Promise<any>;\r\n  private checkUsernameDebounced: (username: string) => void;\r\n  public options: InputFieldOptions & {\r\n    peerId?: PeerId,\r\n    listenerSetter: ListenerSetter,\r\n    onChange?: () => void,\r\n    invalidText: LangPackKey,\r\n    takenText: LangPackKey,\r\n    availableText: LangPackKey,\r\n    head?: string\r\n  };\r\n\r\n  constructor(\r\n    options: UsernameInputField['options'],\r\n    private managers: AppManagers\r\n  ) {\r\n    super(options);\r\n\r\n    this.checkUsernameDebounced = debounce(this.checkUsername.bind(this), 150, false, true);\r\n\r\n    options.listenerSetter.add(this.input)('input', () => {\r\n      const value = this.getValue();\r\n\r\n      // console.log('userNameInput:', value);\r\n      if(value === this.originalValue || !value.length) {\r\n        this.setState(InputState.Neutral);\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      } else if(!isUsernameValid(value)) { // does not check the last underscore\r\n        this.setError(this.options.invalidText);\r\n      } else {\r\n        this.setState(InputState.Neutral);\r\n      }\r\n\r\n      if(this.input.classList.contains('error')) {\r\n        this.options.onChange && this.options.onChange();\r\n        return;\r\n      }\r\n\r\n      this.checkUsernameDebounced(value);\r\n    });\r\n  }\r\n\r\n  public getValue() {\r\n    let value = this.value;\r\n    if(this.options.head) {\r\n      value = value.slice(this.options.head.length);\r\n      this.setValueSilently(this.options.head + value);\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  private checkUsername(username: string) {\r\n    if(this.checkUsernamePromise) return;\r\n\r\n    if(this.options.peerId) {\r\n      this.checkUsernamePromise = this.managers.appChatsManager.checkUsername(this.options.peerId.toChatId(), username);\r\n    } else {\r\n      this.checkUsernamePromise = this.managers.appUsersManager.checkUsername(username);\r\n    }\r\n\r\n    this.checkUsernamePromise.then((available) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      if(available) {\r\n        this.setState(InputState.Valid, this.options.availableText);\r\n      } else {\r\n        this.setError(this.options.takenText);\r\n      }\r\n    }, (err) => {\r\n      if(this.getValue() !== username) return;\r\n\r\n      switch(err.type) {\r\n        case 'USERNAME_INVALID': {\r\n          this.setError(this.options.invalidText);\r\n          break;\r\n        }\r\n      }\r\n    }).then(() => {\r\n      this.checkUsernamePromise = undefined;\r\n      this.options.onChange && this.options.onChange();\r\n\r\n      const value = this.getValue();\r\n      if(value !== username && this.isValidToChange() && isUsernameValid(value)) {\r\n        this.checkUsername(value);\r\n      }\r\n    });\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\ntype TargetType = HTMLElement;\r\nexport type OnVisibilityChangeItem = {target: TargetType, visible: boolean, entry: IntersectionObserverEntry};\r\nexport type OnVisibilityChange = (item: OnVisibilityChangeItem) => void;\r\n\r\nexport default class VisibilityIntersector {\r\n  private observer: IntersectionObserver;\r\n  private items: Map<TargetType, boolean> = new Map();\r\n  private locked = false;\r\n\r\n  constructor(onVisibilityChange: OnVisibilityChange, options?: IntersectionObserverInit) {\r\n    this.observer = new IntersectionObserver((entries) => {\r\n      if(this.locked) {\r\n        return;\r\n      }\r\n\r\n      const changed: OnVisibilityChangeItem[] = [];\r\n\r\n      entries.forEach((entry) => {\r\n        const target = entry.target as TargetType;\r\n\r\n        if(this.items.get(target) === entry.isIntersecting) {\r\n          return;\r\n        } else {\r\n          this.items.set(target, entry.isIntersecting);\r\n        }\r\n\r\n        /* if(entry.isIntersecting) {\r\n          console.log('ooo', entry);\r\n        } */\r\n\r\n        /* if(this.locked) {\r\n          return;\r\n        } */\r\n\r\n        const change: typeof changed[0] = {target, visible: entry.isIntersecting, entry};\r\n\r\n        // ! order will be incorrect so can't use it\r\n        // changed[entry.isIntersecting ? 'unshift' : 'push'](change);\r\n        changed.push(change);\r\n\r\n        // onVisibilityChange(target, entry.isIntersecting);\r\n      });\r\n\r\n      changed.forEach((item) => {\r\n        onVisibilityChange(item);\r\n      });\r\n    }, options);\r\n  }\r\n\r\n  public getVisible() {\r\n    const items: TargetType[] = [];\r\n    this.items.forEach((value, key) => {\r\n      if(value) {\r\n        items.push(key);\r\n      }\r\n    });\r\n\r\n    return items;\r\n  }\r\n\r\n  public clearVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.items.set(target, false);\r\n    }\r\n  }\r\n\r\n  public isVisible(target: TargetType) {\r\n    return this.items.get(target);\r\n  }\r\n\r\n  public disconnect() {\r\n    this.observer.disconnect();\r\n    this.items.clear();\r\n  }\r\n\r\n  public refresh() {\r\n    this.observer.disconnect();\r\n\r\n    // window.requestAnimationFrame(() => {\r\n    const targets = [...this.items.keys()];\r\n    for(const target of targets) {\r\n      // this.items.set(target, false);\r\n      this.observer.observe(target);\r\n    }\r\n    // });\r\n  }\r\n\r\n  public refreshVisible() {\r\n    const visible = this.getVisible();\r\n    for(const target of visible) {\r\n      this.observer.unobserve(target);\r\n    }\r\n\r\n    for(const target of visible) {\r\n      this.observer.observe(target);\r\n    }\r\n  }\r\n\r\n  public observe(target: TargetType) {\r\n    this.items.set(target, false);\r\n    this.observer.observe(target);\r\n  }\r\n\r\n  public unobserve(target: TargetType) {\r\n    this.observer.unobserve(target);\r\n    this.items.delete(target);\r\n  }\r\n\r\n  public unlock() {\r\n    this.locked = false;\r\n  }\r\n\r\n  public unlockAndRefresh() {\r\n    this.unlock();\r\n    this.refresh();\r\n  }\r\n\r\n  public lock() {\r\n    this.locked = true;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport rootScope from '../lib/rootScope';\nimport appMediaPlaybackController from './appMediaPlaybackController';\nimport RangeSelector from './rangeSelector';\n\nexport default class VolumeSelector extends RangeSelector {\n  private static ICONS = ['volume_off', 'volume_mute', 'volume_down', 'volume_up'];\n  public btn: HTMLElement;\n  protected icon: HTMLSpanElement;\n\n  constructor(protected listenerSetter: ListenerSetter, protected vertical = false) {\n    super({\n      step: 0.01,\n      min: 0,\n      max: 1,\n      vertical\n    }, 1);\n\n    this.setListeners();\n    this.setHandlers({\n      onScrub: currentTime => {\n        const value = Math.max(Math.min(currentTime, 1), 0);\n\n        // console.log('volume scrub:', currentTime, value);\n\n        appMediaPlaybackController.muted = false;\n        appMediaPlaybackController.volume = value;\n      }\n\n      /* onMouseUp: (e) => {\n        cancelEvent(e.event);\n      } */\n    });\n\n    const className = 'player-volume';\n    const btn = this.btn = document.createElement('div');\n    btn.classList.add('btn-icon', className);\n    const icon = this.icon = document.createElement('span');\n    icon.classList.add(className + '__icon');\n\n    btn.append(icon, this.container);\n\n    attachClickEvent(icon, this.onMuteClick, {listenerSetter: this.listenerSetter});\n    this.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.setVolume);\n\n    this.setVolume();\n  }\n\n  private onMuteClick = (e?: Event) => {\n    e && cancelEvent(e);\n    appMediaPlaybackController.muted = !appMediaPlaybackController.muted;\n  };\n\n  public setVolume = () => {\n    // const volume = video.volume;\n    const {volume, muted} = appMediaPlaybackController;\n    let d: string;\n    let iconIndex: number;\n    if(!volume || muted) {\n      iconIndex = 0;\n    } else if(volume > .5) {\n      iconIndex = 3;\n    } else if(volume > 0 && volume < .25) {\n      iconIndex = 1;\n    } else {\n      iconIndex = 2;\n    }\n\n    VolumeSelector.ICONS.forEach((icon) => this.icon.classList.remove('tgico-' + icon));\n    this.icon.classList.add('tgico-' + VolumeSelector.ICONS[iconIndex]);\n\n    if(!this.mousedown) {\n      this.setProgress(muted ? 0 : volume);\n    }\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MediaSize} from '../../helpers/mediaSize';\nimport {Middleware} from '../../helpers/middleware';\nimport {MessageEntity} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\n\nexport default function wrapCustomEmoji({\n  docIds,\n  loadPromises,\n  middleware,\n  lazyLoadQueue,\n  size,\n  animationGroup\n}: {\n  docIds: DocId[],\n  loadPromises?: Promise<any>[],\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  size?: MediaSize,\n  animationGroup?: AnimationItemGroup\n}) {\n  let text = '';\n  const entities: MessageEntity[] = [];\n  docIds.forEach((docId) => {\n    entities.push({\n      _: 'messageEntityCustomEmoji',\n      offset: text.length,\n      length: 1,\n      document_id: docId\n    });\n\n    text += ' ';\n  });\n\n  const wrapped = wrapRichText(text, {\n    entities,\n    loadPromises,\n    animationGroup,\n    customEmojiSize: size,\n    middleware,\n    lazyLoadQueue\n  });\n\n  return wrapped;\n}\n\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {CancellablePromise} from '../../helpers/cancellablePromise';\nimport {clearBadCharsAndTrim} from '../../helpers/cleanSearchText';\nimport {formatFullSentTime} from '../../helpers/date';\nimport {simulateClickEvent, attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport formatBytes from '../../helpers/formatBytes';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport noop from '../../helpers/noop';\nimport {Message, MessageMedia, WebPage} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager, {Progress} from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getDownloadMediaDetails from '../../lib/appManagers/utils/download/getDownloadMediaDetails';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport {joinElementsWith} from '../../lib/langPack';\nimport {MAX_FILE_SAVE_SIZE} from '../../lib/mtproto/mtproto_config';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport AudioElement from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport {MiddleEllipsisElement} from '../middleEllipsis';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\nimport wrapSenderToPeer from './senderToPeer';\nimport wrapSentTime from './sentTime';\n\nrootScope.addEventListener('document_downloading', (docId) => {\n  const elements = Array.from(document.querySelectorAll(`.document[data-doc-id=\"${docId}\"]`)) as HTMLElement[];\n  elements.forEach((element) => {\n    if(element.querySelector('.preloader-container.manual')) {\n      simulateClickEvent(element);\n    }\n  });\n});\n\nexport default async function wrapDocument({message, withTime, fontWeight, voiceAsMusic, showSender, searchContext, loadPromises, autoDownloadSize, lazyLoadQueue, sizeType, managers = rootScope.managers, cacheContext}: {\n  message: Message.message,\n  withTime?: boolean,\n  fontWeight?: number,\n  voiceAsMusic?: boolean,\n  showSender?: boolean,\n  searchContext?: MediaSearchContext,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers,\n  cacheContext?: ThumbCache\n}): Promise<HTMLElement> {\n  if(!fontWeight) fontWeight = 500;\n  if(!sizeType) sizeType = '' as any;\n  const noAutoDownload = autoDownloadSize === 0;\n\n  const doc = ((message.media as MessageMedia.messageMediaDocument).document || ((message.media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document) as MyDocument;\n  const uploadFileName = message?.uploadingFileName;\n  if(doc.type === 'audio' || doc.type === 'voice' || doc.type === 'round') {\n    const audioElement = new AudioElement();\n    audioElement.withTime = withTime;\n    audioElement.message = message;\n    audioElement.noAutoDownload = noAutoDownload;\n    audioElement.lazyLoadQueue = lazyLoadQueue;\n    audioElement.loadPromises = loadPromises;\n\n    if(voiceAsMusic) audioElement.voiceAsMusic = voiceAsMusic;\n    if(searchContext) audioElement.searchContext = searchContext;\n    if(showSender) audioElement.showSender = showSender;\n\n    audioElement.dataset.fontWeight = '' + fontWeight;\n    audioElement.dataset.sizeType = sizeType;\n    await audioElement.render();\n    return audioElement;\n  }\n\n  const extSplitted = doc.file_name ? doc.file_name.split('.') : '';\n  let ext = '';\n  ext = extSplitted.length > 1 && Array.isArray(extSplitted) ?\n    clearBadCharsAndTrim(extSplitted.pop().split(' ', 1)[0].toLowerCase()) :\n    'file';\n\n  const docDiv = document.createElement('div');\n  docDiv.classList.add('document', `ext-${ext}`);\n  docDiv.dataset.docId = '' + doc.id;\n  (docDiv as any).doc = doc;\n\n  // return docDiv;\n\n  const icoDiv = document.createElement('div');\n  icoDiv.classList.add('document-ico');\n  let icoTextEl: HTMLElement;\n\n  const hadContext = !!cacheContext;\n  const getCacheContext = () => {\n    return hadContext ? cacheContext : managers.thumbsStorage.getCacheContext(doc);\n  };\n\n  cacheContext = await getCacheContext();\n  let hasThumb = false;\n  if((doc.thumbs?.length || (message.pFlags.is_outgoing && cacheContext.url && doc.type === 'photo'))/*  && doc.mime_type !== 'image/gif' */) {\n    docDiv.classList.add('document-with-thumb');\n    hasThumb = true;\n\n    const imgs: (HTMLImageElement | HTMLCanvasElement | HTMLVideoElement)[] = [];\n    // ! WARNING, use thumbs for check when thumb will be generated for media\n    if(message.pFlags.is_outgoing && ['photo', 'video'].includes(doc.type)) {\n      icoDiv.innerHTML = `<img src=\"${cacheContext.url}\">`;\n      imgs.push(icoDiv.firstElementChild as HTMLImageElement);\n    } else {\n      const perf = performance.now();\n      const wrapped = await wrapPhoto({\n        photo: doc,\n        message: null,\n        container: icoDiv,\n        boxWidth: 54,\n        boxHeight: 54,\n        loadPromises,\n        withoutPreloader: true,\n        lazyLoadQueue,\n        size: choosePhotoSize(doc, 54, 54, true),\n        managers\n      });\n      // console.log('was wrapping photo', performance.now() - perf);\n      icoDiv.style.width = icoDiv.style.height = '';\n      if(wrapped.images.thumb) imgs.push(wrapped.images.thumb);\n      if(wrapped.images.full) imgs.push(wrapped.images.full);\n    }\n\n    imgs.forEach((img) => img.classList.add('document-thumb'));\n  } else {\n    icoTextEl = document.createElement('span');\n    icoTextEl.classList.add('document-ico-text');\n    icoTextEl.innerText = ext;\n    icoDiv.append(icoTextEl);\n  }\n\n  // let fileName = stringMiddleOverflow(doc.file_name || 'Unknown.file', 26);\n  const fileName = doc.file_name ? wrapPlainText(doc.file_name) : 'Unknown.file';\n  const descriptionEl = document.createElement('div');\n  descriptionEl.classList.add('document-description');\n  const bytesContainer = document.createElement('span');\n  const bytesEl = formatBytes(doc.size);\n  const bytesJoiner = ' / ';\n\n  const descriptionParts: (HTMLElement | string | DocumentFragment)[] = [bytesEl];\n\n  if(withTime) {\n    descriptionParts.push(formatFullSentTime(message.date));\n  }\n\n  if(showSender) {\n    descriptionParts.push(await wrapSenderToPeer(message));\n  }\n\n  if(!withTime && !showSender) {\n    const b = document.createElement('span');\n    const bytesMaxEl = formatBytes(doc.size);\n    b.append(bytesJoiner, bytesMaxEl);\n    b.style.visibility = 'hidden';\n    descriptionParts.push(b);\n  }\n\n  docDiv.innerHTML = `\n  ${(cacheContext.downloaded && !uploadFileName) || !message.mid || !hasThumb ? '' : `<div class=\"document-download\"></div>`}\n  <div class=\"document-name\"></div>\n  <div class=\"document-size\"></div>\n  `;\n\n  const nameDiv = docDiv.querySelector('.document-name') as HTMLElement;\n  const middleEllipsisEl = new MiddleEllipsisElement();\n  middleEllipsisEl.dataset.fontWeight = '' + fontWeight;\n  middleEllipsisEl.dataset.sizeType = sizeType;\n  middleEllipsisEl.textContent = fileName;\n  // setInnerHTML(middleEllipsisEl, fileName);\n\n  // * new media popup\n  if(!message.mid) {\n    docDiv.classList.add('downloaded');\n  }\n\n  nameDiv.append(middleEllipsisEl);\n\n  if(showSender) {\n    nameDiv.append(wrapSentTime(message));\n  }\n\n  const sizeDiv = docDiv.querySelector('.document-size') as HTMLElement;\n  bytesContainer.append(...joinElementsWith(descriptionParts, '  '));\n  sizeDiv.append(bytesContainer);\n\n  docDiv.prepend(icoDiv);\n\n  if(!uploadFileName && message.pFlags.is_outgoing && !message.mid) {\n    return docDiv;\n  }\n\n  let downloadDiv: HTMLElement, preloader: ProgressivePreloader = null;\n  const onLoad = () => {\n    docDiv.classList.remove('downloading');\n\n    if(/* !hasThumb ||  */(doc.size > MAX_FILE_SAVE_SIZE && !uploadFileName)) {\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.preloader.classList.add('manual');\n      preloader.setDownloadFunction(load);\n      return;\n    }\n\n    if(doc.size <= MAX_FILE_SAVE_SIZE) {\n      docDiv.classList.add('downloaded');\n    }\n\n    if(downloadDiv) {\n      if(downloadDiv !== icoDiv) {\n        const _downloadDiv = downloadDiv;\n        setTimeout(() => {\n          _downloadDiv.remove();\n        }, 200);\n      }\n\n      downloadDiv = null;\n    }\n\n    if(preloader) {\n      preloader = null;\n    }\n  };\n\n  const addByteProgress = (promise: CancellablePromise<any>) => {\n    docDiv.classList.add('downloading');\n\n    const sizeContainer = document.createElement('span');\n    const _bytesContainer = formatBytes(doc.size);\n    sizeContainer.style.position = 'absolute';\n    sizeContainer.style.left = '0';\n    promise.then(onLoad, noop).finally(() => {\n      // sizeContainer.replaceWith(bytesContainer);\n      bytesContainer.style.visibility = '';\n      sizeContainer.remove();\n      // b && b.classList.remove('hide');\n    });\n\n    // b && b.classList.add('hide');\n\n    const format = (bytes: number) => formatBytes(bytes);\n    let d = format(0);\n    bytesContainer.style.visibility = 'hidden';\n    // bytesContainer.replaceWith(sizeContainer);\n    sizeContainer.append(d, bytesJoiner, _bytesContainer);\n    bytesContainer.parentElement.append(sizeContainer);\n    promise.addNotifyListener((progress: Progress) => {\n      const _d = format(progress.done);\n      d.replaceWith(_d);\n      d = _d;\n    });\n  };\n\n  // ! DO NOT USE ASYNC/AWAIT HERE ! SAFARI WON'T LET DOWNLOAD THE FILE BECAUSE OF ASYNC\n  const load = (e?: Event) => {\n    const save = !e || e.isTrusted;\n    const doc = (docDiv as any).doc;\n    // const doc = await managers.appDocsManager.getDoc(docDiv.dataset.docId);\n    let download: CancellablePromise<any>;\n    const queueId = appImManager.chat.bubbles ? appImManager.chat.bubbles.lazyLoadQueue.queueId : undefined;\n    if(!save) {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId}, true);\n    } else if(doc.type === 'pdf') {\n      const canOpenAfter = /* managers.appDocsManager.downloading.has(doc.id) ||  */!preloader || preloader.detached;\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n      if(canOpenAfter) {\n        download.then(() => {\n          setTimeout(async() => { // wait for preloader animation end\n            const url = (await getCacheContext()).url;\n            window.open(url);\n          }, rootScope.settings.animationsEnabled ? 250 : 0);\n        });\n      }\n    } else if(MEDIA_MIME_TYPES_SUPPORTED.has(doc.mime_type) && doc.thumbs?.length) {\n      download = appDownloadManager.downloadMediaURL({media: doc, queueId});\n    } else {\n      download = appDownloadManager.downloadToDisc({media: doc, queueId});\n    }\n\n    download.catch(() => {\n      docDiv.classList.remove('downloading');\n    });\n\n    if(downloadDiv) {\n      preloader.attach(downloadDiv, true, download);\n      addByteProgress(download);\n    }\n  };\n\n  const {fileName: downloadFileName} = getDownloadMediaDetails({media: doc, downloadId: '1'});\n  if(await managers.apiFileManager.isDownloading(downloadFileName)) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    const promise = appDownloadManager.downloadToDisc({media: doc}, true);\n\n    preloader = new ProgressivePreloader();\n    preloader.attach(downloadDiv, false, promise);\n    preloader.setDownloadFunction(load);\n    addByteProgress(promise);\n  } else if(!cacheContext.downloaded || uploadFileName) {\n    downloadDiv = docDiv.querySelector('.document-download') || icoDiv;\n    preloader = new ProgressivePreloader({\n      isUpload: !!uploadFileName\n    });\n\n    if(!uploadFileName) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(downloadDiv);\n      preloader.setDownloadFunction(load);\n\n      if(autoDownloadSize !== undefined && autoDownloadSize >= doc.size) {\n        simulateClickEvent(preloader.preloader);\n      }\n    } else {\n      const uploadPromise = appDownloadManager.getUpload(uploadFileName);\n      preloader.attachPromise(uploadPromise);\n      preloader.attach(downloadDiv);\n      addByteProgress(uploadPromise);\n    }\n  }\n\n  attachClickEvent(docDiv, (e) => {\n    if(preloader) {\n      preloader.onClick(e);\n    } else {\n      load(e);\n    }\n  });\n\n  return docDiv;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\n\nexport default function formatUserPhone(phone: string) {\n  return '+' + formatPhoneNumber(phone).formatted;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport {Chat, ChatParticipants} from '../../layer';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getChatMembersString(chatId: ChatId, managers = rootScope.managers) {\n  const chat: Chat = await managers.appChatsManager.getChat(chatId);\n  if(chat._ === 'chatForbidden') {\n    return i18n('YouWereKicked');\n  }\n\n  const chatFull = await managers.appProfileManager.getCachedFullChat(chatId);\n  let count: number;\n  if(chatFull) {\n    if(chatFull._ === 'channelFull') {\n      count = chatFull.participants_count;\n    } else {\n      count = (chatFull.participants as ChatParticipants.chatParticipants).participants?.length;\n    }\n  } else {\n    count = (chat as Chat.chat).participants_count || (chat as any).participants?.participants.length;\n  }\n\n  const isBroadcast = (chat as Chat.channel).pFlags.broadcast;\n  count = count || 1;\n\n  const key: LangPackKey = isBroadcast ? 'Peer.Status.Subscribers' : 'Peer.Status.Member';\n  return i18n(key, [numberThousandSplitter(count)]);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Chat} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport I18n from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\n\nexport default async function getPeerTitle(peerId: PeerId, plainText: true, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText?: false, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment>;\nexport default async function getPeerTitle(peerId: PeerId, plainText: boolean, onlyFirstName?: boolean, _limitSymbols?: number, managers?: AppManagers): Promise<DocumentFragment | string>;\nexport default async function getPeerTitle(peerId: PeerId, plainText = false, onlyFirstName = false, _limitSymbols?: number, managers: AppManagers = rootScope.managers): Promise<DocumentFragment | string> {\n  if(!peerId) {\n    peerId = rootScope.myId;\n  }\n\n  let title = '';\n  if(peerId.isUser()) {\n    const user = await managers.appUsersManager.getUser(peerId.toUserId());\n    if(user.first_name) title += user.first_name;\n    if(user.last_name && (!onlyFirstName || !title)) title += ' ' + user.last_name;\n\n    if(!title) title = user.pFlags.deleted ? I18n.format(onlyFirstName ? 'Deleted' : 'HiddenName', true) : user.username;\n    else title = title.trim();\n  } else {\n    const chat: Chat.chat = await managers.appChatsManager.getChat(peerId.toChatId());\n    title = chat.title;\n\n    if(onlyFirstName) {\n      title = title.split(' ')[0];\n    }\n  }\n\n  if(_limitSymbols !== undefined) {\n    title = limitSymbols(title, _limitSymbols, _limitSymbols);\n  }\n\n  return plainText ? title : wrapEmojiText(title);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatFullSentTimeRaw} from '../../helpers/date';\nimport {User} from '../../layer';\nimport {LangPackKey, i18n} from '../../lib/langPack';\nimport {REPLIES_PEER_ID, SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\n\nexport default function getUserStatusString(user: User.user): HTMLElement {\n  if(!user) {\n    return document.createElement('span');\n  }\n\n  let key: LangPackKey;\n  let args: any[];\n\n  switch(user.id) {\n    case REPLIES_PEER_ID.toUserId():\n      key = 'Peer.RepliesNotifications';\n      break;\n    case SERVICE_PEER_ID.toUserId():\n      key = 'Peer.ServiceNotifications';\n      break;\n    default: {\n      if(user.pFlags.bot) {\n        key = 'Bot';\n        break;\n      }\n\n      if(user.pFlags.support) {\n        key = 'SupportStatus';\n        break;\n      }\n\n      switch(user.status?._) {\n        case 'userStatusRecently': {\n          key = 'Lately';\n          break;\n        }\n\n        case 'userStatusLastWeek': {\n          key = 'WithinAWeek';\n          break;\n        }\n\n        case 'userStatusLastMonth': {\n          key = 'WithinAMonth';\n          break;\n        }\n\n        case 'userStatusOffline': {\n          const date = user.status.was_online;\n          const today = new Date();\n          const now = today.getTime() / 1000 | 0;\n\n          const diff = now - date;\n          if(diff < 60) {\n            key = 'Peer.Status.justNow';\n          } else if(diff < 3600) {\n            key = 'Peer.Status.minAgo';\n            const c = diff / 60 | 0;\n            args = [c];\n          } else if(diff < 86400 && today.getDate() === new Date(date * 1000).getDate()) {\n            key = 'LastSeen.HoursAgo';\n            const c = diff / 3600 | 0;\n            args = [c];\n          } else {\n            key = 'Peer.Status.LastSeenAt';\n            const {dateEl, timeEl} = formatFullSentTimeRaw(date);\n            args = [dateEl, timeEl];\n          }\n\n          break;\n        }\n\n        case 'userStatusOnline': {\n          key = 'Online';\n          break;\n        }\n\n        default: {\n          key = 'ALongTimeAgo';\n          break;\n        }\n      }\n\n      break;\n    }\n  }\n\n  return i18n(key, args);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message, MessageAction} from '../../layer';\nimport wrapUrl from '../../lib/richTextProcessor/wrapUrl';\n\nexport default function wrapJoinVoiceChatAnchor(message: Message.messageService) {\n  const action = message.action as MessageAction.messageActionInviteToGroupCall;\n  const {onclick, url} = wrapUrl(`tg://voicechat?chat_id=${message.peerId.toChatId()}&id=${action.call.id}&access_hash=${action.call.access_hash}`);\n  if(!onclick) {\n    return document.createElement('span');\n  }\n\n  const a = document.createElement('a');\n  a.href = url;\n  a.setAttribute('onclick', onclick + '(this)');\n\n  return a;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {formatTime} from '../../helpers/date';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatCallDuration from '../../helpers/formatCallDuration';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {Message, MessageAction} from '../../layer';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport I18n, {FormatterArgument, FormatterArguments, i18n, join, langPack, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\nimport getPeerTitle from './getPeerTitle';\nimport wrapJoinVoiceChatAnchor from './joinVoiceChatAnchor';\nimport wrapMessageForReply from './messageForReply';\n\nasync function wrapLinkToMessage(message: Message.message | Message.messageService, plain?: boolean) {\n  const a = document.createElement('i');\n  a.dataset.savedFrom = message.peerId + '_' + message.mid;\n  a.dir = 'auto';\n  a.append(await wrapMessageForReply(message, undefined, undefined, plain as any));\n  return a;\n}\n\nexport default async function wrapMessageActionTextNewUnsafe(message: MyMessage, plain?: boolean) {\n  const element: HTMLElement = plain ? undefined : document.createElement('span');\n  const action = 'action' in message && message.action;\n\n  // this.log('message action:', action);\n\n  if((action as MessageAction.messageActionCustomAction).message) {\n    const unsafeMessage = (action as MessageAction.messageActionCustomAction).message;\n    if(plain) {\n      return wrapPlainText(unsafeMessage);\n    } else {\n      setInnerHTML(element, wrapRichText(unsafeMessage, {noLinebreaks: true}));\n      return element;\n    }\n  } else {\n    let _ = action._;\n    // let suffix = '';\n    let langPackKey: LangPackKey;\n    let args: Array<FormatterArgument | Promise<FormatterArgument>>;\n\n    const managers = rootScope.managers;\n\n    const getNameDivHTML = async(peerId: PeerId, plain: boolean) => {\n      return plain ? getPeerTitle(peerId, plain) : (new PeerTitle({peerId})).element;\n    };\n\n    switch(action._) {\n      case 'messageActionPhoneCall': {\n        _ += '.' + (action as any).type;\n\n        args = [formatCallDuration(action.duration, plain)];\n        break;\n      }\n\n      case 'messageActionGroupCall': {\n        _ += '.' + (action as any).type;\n\n        args = [];\n        if(!_.endsWith('You') && !message.pFlags.post) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        if(action.duration !== undefined) {\n          args.push(formatCallDuration(action.duration, plain));\n        } else {\n          args.push(wrapJoinVoiceChatAnchor(message as any));\n        }\n\n        break;\n      }\n\n      case 'messageActionInviteToGroupCall': {\n        const peerIds = [message.fromId, action.users[0].toPeerId()];\n        let a = 'Chat.Service.VoiceChatInvitation';\n        const myId = rootScope.myId;\n        if(peerIds[0] === myId) a += 'ByYou';\n        else if(peerIds[1] === myId) a += 'ForYou';\n        indexOfAndSplice(peerIds, myId);\n\n        langPackKey = a as LangPackKey;\n        args = peerIds.map((peerId) => getNameDivHTML(peerId, plain));\n        args.push(wrapJoinVoiceChatAnchor(message as any));\n        break;\n      }\n\n      case 'messageActionGroupCallScheduled': {\n        const today = new Date();\n        const date = new Date(action.schedule_date * 1000);\n        const daysToStart = (date.getTime() - today.getTime()) / 86400e3;\n        const tomorrowDate = new Date(today);\n        tomorrowDate.setDate(tomorrowDate.getDate() + 1);\n\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        langPackKey = isBroadcast ? 'ChatList.Service.VoiceChatScheduled.Channel' : 'ChatList.Service.VoiceChatScheduled';\n        args = [];\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          langPackKey += 'You';\n        } else if(!isBroadcast) {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        let k: LangPackKey;\n        const _args: FormatterArguments = [];\n        if(daysToStart < 1 && date.getDate() === today.getDate()) {\n          k = 'TodayAtFormattedWithToday';\n        } else if(daysToStart < 2 && date.getDate() === tomorrowDate.getDate()) {\n          k = 'Time.TomorrowAt';\n        } else {\n          k = 'formatDateAtTime';\n          _args.push(new I18n.IntlDateElement({\n            date,\n            options: {\n              day: '2-digit',\n              month: '2-digit',\n              year: '2-digit'\n            }\n          }).element);\n        }\n\n        _args.push(formatTime(date));\n        const t = i18n(k, _args);\n        args.push(t);\n\n        break;\n      }\n\n      case 'messageActionChatCreate': {\n        const myId = rootScope.myId;\n        if(message.fromId === myId) {\n          _ += 'You';\n        } else {\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n\n        break;\n      }\n\n      case 'messageActionPinMessage': {\n        const peerId = message.peerId;\n        const pinnedMessage = await managers.appMessagesManager.getMessageByPeer(peerId, message.reply_to_mid);\n\n        args = [\n          getNameDivHTML(message.fromId, plain)\n        ];\n\n        if(!pinnedMessage/*  || true */) {\n          langPackKey = 'ActionPinnedNoText';\n\n          if(message.reply_to_mid) { // refresh original message\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          }\n        } else {\n          args.push(wrapLinkToMessage(pinnedMessage, plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionChatJoinedByRequest': {\n        const isBroadcast = await managers.appPeersManager.isBroadcast(message.peerId);\n        if(message.pFlags.out) {\n          langPackKey = isBroadcast ? 'RequestToJoinChannelApproved' : 'RequestToJoinGroupApproved';\n        } else {\n          langPackKey = isBroadcast ? 'ChatService.UserJoinedChannelByRequest' : 'ChatService.UserJoinedGroupByRequest';\n          args = [getNameDivHTML(message.fromId, plain)];\n        }\n        break;\n      }\n\n      case 'messageActionContactSignUp':\n      case 'messageActionChatReturn':\n      case 'messageActionChatLeave':\n      case 'messageActionChatJoined':\n      case 'messageActionChatEditPhoto':\n      case 'messageActionChatDeletePhoto':\n      case 'messageActionChatEditVideo':\n      case 'messageActionChatJoinedByLink':\n      case 'messageActionChannelEditVideo':\n      case 'messageActionChannelDeletePhoto': {\n        args = [getNameDivHTML(message.fromId, plain)];\n        break;\n      }\n\n      case 'messageActionChannelEditTitle':\n      case 'messageActionChatEditTitle': {\n        args = [];\n        if(action._ === 'messageActionChatEditTitle') {\n          args.push(getNameDivHTML(message.fromId, plain));\n        }\n\n        args.push(plain ? action.title : htmlToSpan(wrapEmojiText(action.title)));\n        break;\n      }\n\n      case 'messageActionChatDeleteUser':\n      case 'messageActionChatAddUsers':\n      case 'messageActionChatAddUser': {\n        const users = (action as MessageAction.messageActionChatAddUser).users ||\n          [(action as MessageAction.messageActionChatDeleteUser).user_id];\n\n        args = [getNameDivHTML(message.fromId, plain)];\n\n        if(users.length > 1) {\n          const joined = join(\n            await Promise.all(users.map((userId: UserId) => getNameDivHTML(userId.toPeerId(), plain))),\n            false,\n            plain\n          );\n\n          if(plain) {\n            args.push(...joined);\n          } else {\n            const fragment = document.createElement('span');\n            fragment.append(...joined);\n            args.push(fragment);\n          }\n        } else {\n          args.push(getNameDivHTML(users[0].toPeerId(), plain));\n        }\n\n        break;\n      }\n\n      case 'messageActionBotAllowed': {\n        const anchorHTML = wrapRichText(action.domain, {\n          entities: [{\n            _: 'messageEntityUrl',\n            length: action.domain.length,\n            offset: 0\n          }]\n        });\n\n        const node = htmlToSpan(anchorHTML);\n\n        args = [node];\n        break;\n      }\n\n      case 'messageActionPaymentSent': {\n        const isRecurringInit = action.pFlags.recurring_init;\n        const isRecurringUsed = action.pFlags.recurring_used;\n        langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsedNoTitle' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInitNoTitle' : 'Chat.Service.PaymentSent1NoTitle');\n        const price = paymentsWrapCurrencyAmount(action.total_amount, action.currency);\n        args = [price, getNameDivHTML(message.peerId, plain)];\n\n        if(message.reply_to_mid) {\n          const invoiceMessage = await managers.appMessagesManager.getMessageByPeer(\n            message.reply_to?.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : message.peerId,\n            message.reply_to_mid\n          );\n\n          if(!invoiceMessage) {\n            managers.appMessagesManager.fetchMessageReplyTo(message);\n          } else {\n            langPackKey = isRecurringUsed ? 'Chat.Service.PaymentSentRecurringUsed' : (isRecurringInit ? 'Chat.Service.PaymentSentRecurringInit' : 'Chat.Service.PaymentSent1');\n            args.push(wrapLinkToMessage(invoiceMessage, plain).then((el) => {\n              el.classList.add('is-receipt-link');\n              return el;\n            }));\n          }\n        }\n\n        break;\n      }\n\n      default:\n        langPackKey = (langPack[_] || `[${action._}]`) as any;\n        break;\n    }\n\n    if(!langPackKey) {\n      langPackKey = langPack[_];\n      if(langPackKey === undefined) {\n        langPackKey = '[' + _ + ']' as any;\n      }\n    }\n\n    const waited = args && await Promise.all(args);\n\n    if(plain) {\n      return I18n.format(langPackKey, true, waited);\n    } else {\n      return _i18n(element, langPackKey, waited);\n    }\n\n    // str = !langPackKey || langPackKey[0].toUpperCase() === langPackKey[0] ? langPackKey : getNameDivHTML(message.fromId) + langPackKey + (suffix ? ' ' : '');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport wrapMessageActionTextNewUnsafe from './messageActionTextNewUnsafe';\n\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: true): Promise<string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: false): Promise<HTMLElement>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain: boolean): Promise<HTMLElement | string>;\nexport default async function wrapMessageActionTextNew(message: MyMessage, plain?: boolean): Promise<HTMLElement | string> {\n  try {\n    return await wrapMessageActionTextNewUnsafe(message, plain);\n  } catch(err) {\n    console.error('wrapMessageActionTextNewUnsafe error:', err);\n    return plain ? '' : document.createElement('span');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport assumeType from '../../helpers/assumeType';\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\nimport {getRestrictionReason} from '../../helpers/restrictions';\nimport escapeRegExp from '../../helpers/string/escapeRegExp';\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {Message, DocumentAttribute} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport isMessageRestricted from '../../lib/appManagers/utils/messages/isMessageRestricted';\nimport I18n, {LangPackKey, i18n, UNSUPPORTED_LANG_PACK_KEY} from '../../lib/langPack';\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapPlainText from '../../lib/richTextProcessor/wrapPlainText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport wrapMessageActionTextNew from './messageActionTextNew';\n\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string, usingMids: number[], plain: true, highlightWord?: string, withoutMediaType?: boolean): Promise<string>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text?: string, usingMids?: number[], plain?: false, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment>;\nexport default async function wrapMessageForReply(message: MyMessage | MyDraftMessage, text: string = (message as Message.message).message, usingMids?: number[], plain?: boolean, highlightWord?: string, withoutMediaType?: boolean): Promise<DocumentFragment | string> {\n  const parts: (Node | string)[] = [];\n\n  let hasAlbumKey = false;\n  const addPart = (langKey: LangPackKey, part?: string | HTMLElement | DocumentFragment) => {\n    if(langKey) {\n      if(part === undefined && hasAlbumKey) {\n        return;\n      }\n\n      part = plain ? I18n.format(langKey, true) : i18n(langKey);\n    }\n\n    if(plain) {\n      parts.push(part);\n    } else {\n      const el = document.createElement('i');\n      if(typeof(part) === 'string') el.innerHTML = part;\n      else el.append(part);\n      parts.push(el);\n    }\n  };\n\n  const managers = rootScope.managers;\n  const appMessagesManager = managers.appMessagesManager;\n\n  const isRestricted = isMessageRestricted(message as any);\n\n  let entities = (message as Message.message).totalEntities;\n  if((message as Message.message).media && !isRestricted) {\n    assumeType<Message.message>(message);\n    let usingFullAlbum = true;\n    if(message.grouped_id) {\n      if(usingMids) {\n        const mids = await appMessagesManager.getMidsByMessage(message);\n        if(usingMids.length === mids.length) {\n          for(const mid of mids) {\n            if(!usingMids.includes(mid)) {\n              usingFullAlbum = false;\n              break;\n            }\n          }\n        } else {\n          usingFullAlbum = false;\n        }\n      }\n\n      if(usingFullAlbum) {\n        const albumText = await appMessagesManager.getAlbumText(message.grouped_id);\n        text = albumText.message;\n        entities = albumText.totalEntities;\n\n        if(!withoutMediaType) {\n          addPart('AttachAlbum');\n          hasAlbumKey = true;\n        }\n      }\n    } else {\n      usingFullAlbum = false;\n    }\n\n    if((!usingFullAlbum && !withoutMediaType) || !text) {\n      const media = message.media;\n      switch(media._) {\n        case 'messageMediaPhoto':\n          addPart('AttachPhoto');\n          break;\n        case 'messageMediaDice':\n          addPart(undefined, plain ? media.emoticon : wrapEmojiText(media.emoticon));\n          break;\n        case 'messageMediaVenue': {\n          text = media.title;\n          addPart('AttachLocation');\n          break;\n        }\n        case 'messageMediaGeo':\n          addPart('AttachLocation');\n          break;\n        case 'messageMediaGeoLive':\n          addPart('AttachLiveLocation');\n          break;\n        case 'messageMediaPoll':\n          const f = '' + ' ' + (media.poll.question || 'poll');\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        case 'messageMediaContact':\n          addPart('AttachContact');\n          break;\n        case 'messageMediaGame': {\n          const f = '' + ' ' + media.game.title;\n          addPart(undefined, plain ? f : wrapEmojiText(f));\n          break;\n        }\n        case 'messageMediaDocument': {\n          const document = media.document as MyDocument;\n\n          if(document.type === 'video') {\n            addPart('AttachVideo');\n          } else if(document.type === 'voice') {\n            addPart('AttachAudio');\n          } else if(document.type === 'gif') {\n            addPart('AttachGif');\n          } else if(document.type === 'round') {\n            addPart('AttachRound');\n          } else if(document.type === 'sticker') {\n            const i = parts.length;\n            if(document.stickerEmojiRaw) {\n              const f = document.stickerEmojiRaw + ' ';\n              addPart(undefined, plain ? f : wrapEmojiText(f));\n            }\n\n            addPart('AttachSticker');\n\n            // will combine two parts into one\n            const p = parts.splice(i, 2);\n            if(plain) parts.push((p[0] as string) + (p[1] as string));\n            else {\n              const span = window.document.createElement('span');\n              span.append(...p);\n              parts.push(span);\n            }\n\n            text = '';\n          } else if(document.type === 'audio') {\n            const attribute = document.attributes.find((attribute) => attribute._ === 'documentAttributeAudio' && (attribute.title || attribute.performer)) as DocumentAttribute.documentAttributeAudio;\n            const f = '' + ' ' + (attribute ? [attribute.title, attribute.performer].filter(Boolean).join(' - ') : document.file_name);\n            addPart(undefined, plain ? f : wrapEmojiText(f));\n          } else {\n            addPart(undefined, plain ? document.file_name : wrapEmojiText(document.file_name));\n          }\n\n          break;\n        }\n\n        case 'messageMediaInvoice': {\n          addPart(undefined, plain ? media.title : wrapEmojiText(media.title));\n          break;\n        }\n\n        case 'messageMediaUnsupported': {\n          addPart(UNSUPPORTED_LANG_PACK_KEY);\n          break;\n        }\n\n        default:\n          // messageText += media._;\n          // /////appMessagesManager.log.warn('Got unknown media type!', message);\n          break;\n      }\n    }\n\n    const length = parts.length;\n    for(let i = 1; i < length; i += 2) {\n      parts.splice(i, 0, ', ');\n    }\n\n    if(text && length) {\n      parts.push(', ');\n    }\n  }\n\n  if((message as Message.messageService).action) {\n    const actionWrapped = await wrapMessageActionTextNew((message as Message.messageService), plain);\n    if(actionWrapped) {\n      addPart(undefined, actionWrapped);\n    }\n  }\n\n  if(isRestricted) {\n    text = getRestrictionReason((message as Message.message).restriction_reason).text;\n    entities = [];\n  }\n\n  if(text) {\n    text = limitSymbols(text, 100);\n\n    if(!entities) {\n      entities = [];\n    }\n\n    if(plain) {\n      parts.push(wrapPlainText(text, entities));\n    } else {\n      // let entities = parseEntities(text.replace(/\\n/g, ' '));\n\n      if(highlightWord) {\n        highlightWord = highlightWord.trim();\n        let found = false;\n        let match: any;\n        const regExp = new RegExp(escapeRegExp(highlightWord), 'gi');\n        entities = entities.slice(); // fix leaving highlight entity\n        while((match = regExp.exec(text)) !== null) {\n          entities.push({_: 'messageEntityHighlight', length: highlightWord.length, offset: match.index});\n          found = true;\n        }\n\n        if(found) {\n          sortEntities(entities);\n        }\n      }\n\n      const messageWrapped = wrapRichText(text, {\n        noLinebreaks: true,\n        entities,\n        noLinks: true,\n        noTextFormat: true\n      });\n\n      parts.push(htmlToDocumentFragment(messageWrapped));\n    }\n  }\n\n  if(plain) {\n    return parts.join('');\n  } else {\n    const fragment = document.createDocumentFragment();\n    fragment.append(...parts);\n    return fragment;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PeerTitle, {PeerTitleOptions} from '../peerTitle';\n\nexport default async function wrapPeerTitle(options: PeerTitleOptions) {\n  const peerTitle = new PeerTitle();\n  await peerTitle.update(options);\n  return peerTitle.element;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Message, PhotoSize, VideoSize, WebDocument} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\nimport rootScope from '../../lib/rootScope';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport blur from '../../helpers/blur';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport isWebDocument from '../../lib/appManagers/utils/webDocs/isWebDocument';\nimport createVideo from '../../helpers/dom/createVideo';\nimport noop from '../../helpers/noop';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\nimport {Middleware} from '../../helpers/middleware';\n\nexport default async function wrapPhoto({photo, message, container, boxWidth, boxHeight, withTail, isOut, lazyLoadQueue, middleware, size, withoutPreloader, loadPromises, autoDownloadSize, noBlur, noThumb, noFadeIn, blurAfter, managers = rootScope.managers}: {\n  photo: MyPhoto | MyDocument | WebDocument,\n  message?: Message.message | Message.messageService,\n  container: HTMLElement,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  lazyLoadQueue?: LazyLoadQueue,\n  middleware?: Middleware,\n  size?: PhotoSize | VideoSize,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  noBlur?: boolean,\n  noThumb?: boolean,\n  noFadeIn?: boolean,\n  blurAfter?: boolean,\n  managers?: AppManagers,\n}) {\n  const ret = {\n    loadPromises: {\n      thumb: Promise.resolve() as Promise<any>,\n      full: Promise.resolve() as Promise<any>\n    },\n    images: {\n      thumb: null as HTMLImageElement | HTMLCanvasElement,\n      full: null as HTMLVideoElement | HTMLImageElement\n    },\n    preloader: null as ProgressivePreloader,\n    aspecter: null as HTMLElement\n  };\n\n  const isDocument = photo._ === 'document';\n  const isWebDoc = isWebDocument(photo);\n  if(!((photo as MyPhoto).sizes || (photo as MyDocument).thumbs) && !isWebDoc) {\n    if(boxWidth && boxHeight && !size && isDocument) {\n      setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message);\n    }\n\n    return ret;\n  }\n\n  let noAutoDownload = autoDownloadSize === 0;\n\n  if(!size) {\n    if(boxWidth === undefined) boxWidth = mediaSizes.active.regular.width;\n    if(boxHeight === undefined) boxHeight = mediaSizes.active.regular.height;\n  }\n\n  container.classList.add('media-container');\n  let aspecter = container;\n\n  let isFit = true;\n  let loadThumbPromise: Promise<any> = Promise.resolve();\n  let thumbImage: HTMLImageElement | HTMLCanvasElement;\n  // let image: HTMLImageElement;\n  let cacheContext: ThumbCache;\n  const isGif = isDocument && photo.mime_type === 'image/gif' && !size;\n  // if(withTail) {\n  //   image = wrapMediaWithTail(photo, message, container, boxWidth, boxHeight, isOut);\n  // } else {\n\n  if(boxWidth && boxHeight && !size) { // !album\n    const set = setAttachmentSize(photo, container, boxWidth, boxHeight, undefined, message, undefined, isGif ? {\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    } : undefined);\n    size = set.photoSize;\n    isFit = set.isFit;\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size.type);\n\n    if(!isFit && !isWebDoc) {\n      aspecter = document.createElement('div');\n      aspecter.classList.add('media-container-aspecter');\n      aspecter.style.width = set.size.width + 'px';\n      aspecter.style.height = set.size.height + 'px';\n\n      const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur, true);\n      if(gotThumb) {\n        loadThumbPromise = gotThumb.loadPromise;\n        const thumbImage = gotThumb.image; // local scope\n        thumbImage.classList.add('media-photo');\n        container.append(thumbImage);\n      } else {\n        const res = await wrapPhoto({\n          container,\n          message,\n          photo,\n          boxWidth: 0,\n          boxHeight: 0,\n          size,\n          lazyLoadQueue,\n          isOut,\n          loadPromises,\n          middleware,\n          withoutPreloader,\n          withTail,\n          autoDownloadSize,\n          noBlur,\n          noThumb: true,\n          blurAfter: true,\n          managers\n          // noFadeIn: true\n        });\n        const thumbImage = res.images.full;\n        thumbImage.classList.add('media-photo', 'thumbnail');\n        // container.append(thumbImage);\n      }\n\n      container.classList.add('media-container-fitted');\n      container.append(aspecter);\n    }\n  } else {\n    if(!size) {\n      size = choosePhotoSize(photo, boxWidth, boxHeight, true);\n    }\n\n    cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n  }\n\n  if(!noThumb && !isWebDoc) {\n    const gotThumb = getStrippedThumbIfNeeded(photo, cacheContext, !noBlur);\n    if(gotThumb) {\n      loadThumbPromise = Promise.all([loadThumbPromise, gotThumb.loadPromise]);\n      ret.loadPromises.thumb = ret.loadPromises.full = loadThumbPromise;\n      thumbImage = ret.images.thumb = gotThumb.image;\n      thumbImage.classList.add('media-photo');\n      aspecter.append(thumbImage);\n    }\n  }\n  // }\n\n  if(size?._ === 'photoSizeEmpty' && isDocument) {\n    return ret;\n  }\n\n  let media: HTMLVideoElement | HTMLImageElement;\n  if(size?._ === 'videoSize') {\n    media = ret.images.full = createVideo();\n    media.autoplay = true;\n    media.loop = true;\n    media.muted = true;\n    media.classList.add('media-photo');\n  } else {\n    media = ret.images.full = new Image();\n    media.classList.add('media-photo');\n  }\n\n  // console.log('wrapPhoto downloaded:', photo, photo.downloaded, container);\n\n  const needFadeIn = (thumbImage || !cacheContext.downloaded) && rootScope.settings.animationsEnabled && !noFadeIn;\n\n  let preloader: ProgressivePreloader;\n  const uploadingFileName = (message as Message.message)?.uploadingFileName;\n  if(!withoutPreloader) {\n    if(!cacheContext.downloaded || uploadingFileName) {\n      preloader = new ProgressivePreloader({\n        attachMethod: 'prepend',\n        isUpload: !!uploadingFileName\n      });\n    }\n\n    if(uploadingFileName) { // means upload\n      preloader.attachPromise(appDownloadManager.getUpload(uploadingFileName));\n      preloader.attach(container);\n      noAutoDownload = undefined;\n    }\n  }\n\n\n  const getDownloadPromise = () => {\n    // const promise = isGif && !size ?\n    //   managers.appDocsManager.downloadDoc(photo, /* undefined,  */lazyLoadQueue?.queueId) :\n    //   managers.appPhotosManager.preloadPhoto(photo, size, lazyLoadQueue?.queueId, noAutoDownload);\n    const haveToDownload = isGif && !size;\n    const promise = appDownloadManager.downloadMediaURL({\n      media: photo,\n      thumb: size,\n      queueId: lazyLoadQueue?.queueId,\n      onlyCache: haveToDownload ? undefined : noAutoDownload\n    });\n\n    return promise;\n  };\n\n  const renderOnLoad = (url: string) => {\n    return renderMediaWithFadeIn(container, media, url, needFadeIn, aspecter, thumbImage);\n  };\n\n  const onLoad = async(url: string) => {\n    if(middleware && !middleware()) return;\n\n    if(blurAfter) {\n      const result = blur(url, 12);\n      return result.promise.then(() => {\n        // image = result.canvas;\n        return renderOnLoad(result.canvas.toDataURL());\n      });\n    }\n\n    return renderOnLoad(url);\n  };\n\n  let loadPromise: Promise<any>;\n  const canAttachPreloader = (\n    (size as PhotoSize.photoSize).w >= 150 &&\n    (size as PhotoSize.photoSize).h >= 150\n  ) || noAutoDownload;\n  const load = async() => {\n    if(noAutoDownload && !withoutPreloader && preloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    const promise = getDownloadPromise();\n    const cacheContext = await managers.thumbsStorage.getCacheContext(photo, size?.type);\n    if(\n      preloader &&\n      !cacheContext.downloaded &&\n      !withoutPreloader &&\n      canAttachPreloader\n    ) {\n      preloader.attach(container, false, promise);\n    }\n\n    noAutoDownload = undefined;\n\n    const renderPromise = promise.then(onLoad);\n    renderPromise.catch(noop);\n    return {download: promise, render: renderPromise};\n  };\n\n  if(preloader) {\n    preloader.setDownloadFunction(load);\n  }\n\n  if(cacheContext.downloaded) {\n    loadThumbPromise = loadPromise = (await load()).render;\n  } else {\n    if(!lazyLoadQueue) loadPromise = (await load()).render;\n    /* else if(noAutoDownload) {\n      preloader.construct();\n      preloader.setManual();\n      preloader.attach(container);\n    } */ else lazyLoadQueue.push({div: container, load: () => load().then(({download}) => download)});\n  }\n\n  if(loadPromises && loadThumbPromise) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  // const perf = performance.now();\n  await loadThumbPromise;\n  ret.loadPromises.thumb = loadThumbPromise;\n  ret.loadPromises.full = loadPromise || Promise.resolve();\n  ret.preloader = preloader;\n  ret.aspecter = aspecter;\n\n  // const elapsedTime = performance.now() - perf;\n  // if(elapsedTime > 4) {\n  //   console.log('wrapping photo thumb time', elapsedTime, photo, size);\n  // }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport getMessageSenderPeerIdOrName from '../../lib/appManagers/utils/messages/getMessageSenderPeerIdOrName';\nimport {i18n} from '../../lib/langPack';\nimport rootScope from '../../lib/rootScope';\nimport PeerTitle from '../peerTitle';\n\nexport default async function wrapSenderToPeer(message: MyMessage) {\n  const senderTitle: HTMLElement = document.createElement('span');\n  senderTitle.classList.add('sender-title');\n\n  const fromMe = message.fromId === rootScope.myId && message.peerId !== rootScope.myId;\n  senderTitle.append(\n    fromMe ?\n      i18n('FromYou') :\n      new PeerTitle({\n        ...getMessageSenderPeerIdOrName(message),\n        dialog: message.peerId === rootScope.myId\n      }).element\n  );\n\n  if(await rootScope.managers.appPeersManager.isAnyGroup(message.peerId) || fromMe) {\n    const peerTitle = new PeerTitle({peerId: message.peerId}).element;\n    senderTitle.append('  ', peerTitle);\n  }\n\n  return senderTitle;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\n\nexport default function wrapSentTime(message: MyMessage) {\n  const el: HTMLElement = document.createElement('span');\n  el.classList.add('sent-time');\n  el.append(formatDateAccordingToTodayNew(new Date(message.date * 1000)));\n\n  return el;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_WEBP_SUPPORTED from '../../environment/webpSupport';\nimport assumeType from '../../helpers/assumeType';\nimport getPathFromBytes from '../../helpers/bytes/getPathFromBytes';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport computeLockColor from '../../helpers/computeLockColor';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport renderImageFromUrl, {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport getImageFromStrippedThumb from '../../helpers/getImageFromStrippedThumb';\nimport getPreviewURLFromThumb from '../../helpers/getPreviewURLFromThumb';\nimport makeError from '../../helpers/makeError';\nimport {makeMediaSize} from '../../helpers/mediaSize';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {isSavingLottiePreview, saveLottiePreview} from '../../helpers/saveLottiePreview';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport type {ThumbCache} from '../../lib/storages/thumbs';\nimport webpWorkerController from '../../lib/webp/webpWorkerController';\nimport {Awaited, SendMessageEmojiInteractionData} from '../../types';\nimport {getEmojiToneIndex} from '../../vendor/emoji';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport PopupStickers from '../popups/stickers';\nimport {hideToast, toastNew} from '../toast';\nimport wrapStickerAnimation from './stickerAnimation';\n\n// https://github.com/telegramdesktop/tdesktop/blob/master/Telegram/SourceFiles/history/view/media/history_view_sticker.cpp#L40\nexport const STICKER_EFFECT_MULTIPLIER = 1 + 0.245 * 2;\nconst EMOJI_EFFECT_MULTIPLIER = 3;\n\nconst locksUrls: {[docId: string]: string} = {};\n\nexport default async function wrapSticker({doc, div, middleware, loadStickerMiddleware, lazyLoadQueue, exportLoad, group, play, onlyThumb, emoji, width, height, withThumb, loop, loadPromises, needFadeIn, needUpscale, skipRatio, static: asStatic, managers = rootScope.managers, fullThumb, isOut, noPremium, withLock, relativeEffect, loopEffect, isCustomEmoji}: {\n  doc: MyDocument,\n  div: HTMLElement | HTMLElement[],\n  middleware?: Middleware,\n  loadStickerMiddleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  exportLoad?: boolean,\n  group?: AnimationItemGroup,\n  play?: boolean,\n  onlyThumb?: boolean,\n  emoji?: string,\n  width?: number,\n  height?: number,\n  withThumb?: boolean,\n  loop?: boolean,\n  loadPromises?: Promise<any>[],\n  needFadeIn?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  static?: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  isOut?: boolean,\n  noPremium?: boolean,\n  withLock?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean,\n  isCustomEmoji?: boolean\n}) {\n  div = Array.isArray(div) ? div : [div];\n\n  if(isCustomEmoji) {\n    emoji = doc.stickerEmojiRaw;\n  }\n\n  const stickerType = doc.sticker;\n  if(stickerType === 1) {\n    asStatic = true;\n  }\n\n  if(!width && !height) {\n    const sizes = mediaSizes.active;\n    const boxSize = emoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\n    const size = makeMediaSize(doc.w, doc.h).aspectFitted(boxSize);\n    width = size.width;\n    height = size.height;\n  }\n\n  if(stickerType === 2) {\n    // LottieLoader.loadLottie();\n    lottieLoader.loadLottieWorkers();\n  }\n\n  div.forEach((div) => {\n    div.dataset.docId = '' + doc.id;\n    if(emoji) {\n      div.dataset.stickerEmoji = emoji;\n    }\n\n    div.classList.add('media-sticker-wrapper');\n  });\n\n  /* if(stickerType === 3) {\n    const videoRes = wrapVideo({\n      doc,\n      boxWidth: width,\n      boxHeight: height,\n      container: div,\n      group,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      noPlayButton: true,\n      noInfo: true\n    });\n\n    if(videoRes.thumb) {\n      if(videoRes.thumb.images.thumb) {\n        videoRes.thumb.images.thumb.classList.add('media-sticker', 'thumbnail');\n      }\n\n      if(videoRes.thumb.images.full) {\n        videoRes.thumb.images.full.classList.add('media-sticker');\n      }\n    }\n\n    return videoRes.loadPromise;\n  } */\n\n  // console.log('wrap sticker', doc, div, onlyThumb);\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async(type: string = cacheContext?.type) => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, type);\n  };\n\n  const isAnimated = !asStatic && (stickerType === 2 || stickerType === 3);\n\n  const effectThumb = getStickerEffectThumb(doc);\n  if(isOut !== undefined && effectThumb && !isOut) {\n    div.forEach((div) => div.classList.add('reflect-x'));\n  }\n\n  const willHaveLock = effectThumb && withLock;\n  if(willHaveLock) {\n    const lockUrl = locksUrls[doc.id];\n    div.forEach((div) => {\n      div.classList.add('is-premium-sticker', 'tgico-premium_lock');\n      lockUrl && div.style.setProperty('--lock-url', `url(${lockUrl})`);\n    });\n  }\n\n  if(asStatic && stickerType !== 1) {\n    const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n    await getCacheContext(thumb.type);\n  } else {\n    await getCacheContext(fullThumb?.type);\n  }\n\n  const toneIndex = emoji && !isCustomEmoji ? getEmojiToneIndex(emoji) : -1;\n  const downloaded = cacheContext.downloaded && !needFadeIn;\n\n  const isThumbNeededForType = isAnimated;\n  const lottieCachedThumb = stickerType === 2 || stickerType === 3 ? await managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex) : undefined;\n\n  const ret = {render: undefined as typeof loadPromise, load: undefined as typeof load};\n  let loadThumbPromise = deferredPromise<void>();\n  let haveThumbCached = false;\n  if((\n    doc.thumbs?.length ||\n      lottieCachedThumb\n  ) &&\n    !div[0].firstElementChild && (\n    !downloaded ||\n      isThumbNeededForType ||\n      onlyThumb\n  ) && withThumb !== false/*  && doc.thumbs[0]._ !== 'photoSizeEmpty' */\n  ) {\n    let thumb = lottieCachedThumb || doc.thumbs[0];\n\n    // console.log('wrap sticker', thumb, div);\n\n    const afterRender = (div: HTMLElement, thumbImage: HTMLElement) => {\n      if(!div.childElementCount) {\n        thumbImage.classList.add('media-sticker', 'thumbnail');\n\n        sequentialDom.mutateElement(div, () => {\n          div.append(thumbImage);\n          loadThumbPromise.resolve();\n        });\n      }\n    };\n\n    if('url' in thumb) {\n      haveThumbCached = true;\n      div.forEach((div) => {\n        const thumbImage = new Image();\n        renderImageFromUrl(thumbImage, (thumb as any).url, () => afterRender(div, thumbImage));\n      });\n    } else if('bytes' in thumb) {\n      if(thumb._ === 'photoPathSize') {\n        if(!thumb.bytes.length) {\n          thumb = doc.thumbs.find((t) => (t as PhotoSize.photoStrippedSize).bytes?.length) || thumb;\n        }\n\n        const d = getPathFromBytes((thumb as PhotoSize.photoStrippedSize).bytes);\n        const ns = 'http://www.w3.org/2000/svg';\n        const svg = document.createElementNS(ns, 'svg');\n        svg.classList.add('rlottie-vector', 'media-sticker', 'thumbnail');\n        svg.setAttributeNS(null, 'viewBox', `0 0 ${doc.w || 512} ${doc.h || 512}`);\n\n        // const defs = document.createElementNS(ns, 'defs');\n        // const linearGradient = document.createElementNS(ns, 'linearGradient');\n        // linearGradient.setAttributeNS(null, 'id', 'g');\n        // linearGradient.setAttributeNS(null, 'x1', '-300%');\n        // linearGradient.setAttributeNS(null, 'x2', '-200%');\n        // linearGradient.setAttributeNS(null, 'y1', '0');\n        // linearGradient.setAttributeNS(null, 'y2', '0');\n        // const stops = [\n        //   ['-10%', '.1'],\n        //   ['30%', '.07'],\n        //   ['70%', '.07'],\n        //   ['110%', '.1']\n        // ].map(([offset, stopOpacity]) => {\n        //   const stop = document.createElementNS(ns, 'stop');\n        //   stop.setAttributeNS(null, 'offset', offset);\n        //   stop.setAttributeNS(null, 'stop-opacity', stopOpacity);\n        //   return stop;\n        // });\n        // const animates = [\n        //   ['-300%', '1200%'],\n        //   ['-200%', '1300%']\n        // ].map(([from, to], idx) => {\n        //   const animate = document.createElementNS(ns, 'animate');\n        //   animate.setAttributeNS(null, 'attributeName', 'x' + (idx + 1));\n        //   animate.setAttributeNS(null, 'from', from);\n        //   animate.setAttributeNS(null, 'to', to);\n        //   animate.setAttributeNS(null, 'dur', '3s');\n        //   animate.setAttributeNS(null, 'repeatCount', 'indefinite');\n        //   return animate;\n        // });\n        // linearGradient.append(...stops, ...animates);\n        // defs.append(linearGradient);\n        // svg.append(defs);\n\n        const path = document.createElementNS(ns, 'path');\n        path.setAttributeNS(null, 'd', d);\n        if(rootScope.settings.animationsEnabled && !isCustomEmoji) path.setAttributeNS(null, 'fill', 'url(#g)');\n        svg.append(path);\n        div.forEach((div, idx) => div.append(idx > 0 ? svg.cloneNode(true) : svg));\n        haveThumbCached = true;\n        loadThumbPromise.resolve();\n      } else if(toneIndex <= 0) {\n        const r = () => {\n          (div as HTMLElement[]).forEach((div) => {\n            const thumbImage = new Image();\n            const url = getPreviewURLFromThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            renderImageFromUrl(thumbImage, url, () => afterRender(div, thumbImage));\n          });\n        };\n\n        if((IS_WEBP_SUPPORTED || doc.pFlags.stickerThumbConverted || cacheContext.url)/*  && false */) {\n          haveThumbCached = true;\n          r();\n        } else {\n          haveThumbCached = true;\n          webpWorkerController.convert('main-' + doc.id, thumb.bytes).then((bytes) => {\n            managers.appDocsManager.saveWebPConvertedStrippedThumb(doc.id, bytes);\n            (thumb as PhotoSize.photoStrippedSize).bytes = bytes;\n            doc.pFlags.stickerThumbConverted = true;\n\n            if((middleware && !middleware()) || (div as HTMLElement[])[0].childElementCount) {\n              loadThumbPromise.resolve();\n              return;\n            }\n\n            r();\n          }).catch(() => loadThumbPromise.resolve());\n        }\n      }\n    } else if(((stickerType === 2 && toneIndex <= 0) || stickerType === 3) && (withThumb || onlyThumb)) {\n      const load = async() => {\n        if((div as HTMLElement[])[0].childElementCount || (middleware && !middleware())) {\n          loadThumbPromise.resolve();\n          return;\n        }\n\n        const r = (div: HTMLElement, thumbImage: HTMLElement, rendered?: boolean) => {\n          if(div.childElementCount || (middleware && !middleware())) {\n            loadThumbPromise.resolve();\n            return;\n          }\n\n          if(rendered) afterRender(div, thumbImage);\n          else renderImageFromUrl(thumbImage, cacheContext.url, () => afterRender(div, thumbImage));\n        };\n\n        await getCacheContext();\n        (div as HTMLElement[]).forEach((div) => {\n          if(cacheContext.url) {\n            r(div, new Image());\n          } else if('bytes' in thumb) {\n            const res = getImageFromStrippedThumb(doc, thumb as PhotoSize.photoStrippedSize, true);\n            res.loadPromise.then(() => r(div, res.image, true));\n\n            // return managers.appDocsManager.getThumbURL(doc, thumb as PhotoSize.photoStrippedSize).promise.then(r);\n          } else {\n            appDownloadManager.downloadMediaURL({\n              media: doc,\n              thumb: thumb as PhotoSize\n            }).then(async() => {\n              await getCacheContext();\n              return r(div, new Image());\n            });\n          }\n        });\n      };\n\n      if(lazyLoadQueue && onlyThumb) {\n        lazyLoadQueue.push({div: div[0], load});\n        loadThumbPromise.resolve();\n        return ret;\n      } else {\n        load();\n\n        if((thumb as any).url) {\n          haveThumbCached = true;\n        }\n      }\n    }\n  }\n\n  if(loadPromises && haveThumbCached) {\n    loadPromises.push(loadThumbPromise);\n  }\n\n  if(onlyThumb/*  || true */) { // for sticker panel\n    return ret;\n  }\n\n  const middlewareError = makeError('MIDDLEWARE');\n  const load = async() => {\n    if(middleware && !middleware()) {\n      throw middlewareError;\n    }\n\n    if(stickerType === 2 && !asStatic) {\n      return appDownloadManager.downloadMedia({media: doc, queueId: lazyLoadQueue?.queueId, thumb: fullThumb})\n      .then(async(blob) => {\n        if(middleware && !middleware()) {\n          throw middlewareError;\n        }\n\n        const animation = await lottieLoader.loadAnimationWorker({\n          container: (div as HTMLElement[])[0],\n          loop: loop && (!emoji || isCustomEmoji),\n          autoplay: play,\n          animationData: blob,\n          width,\n          height,\n          name: 'doc' + doc.id,\n          needUpscale,\n          skipRatio,\n          toneIndex,\n          sync: isCustomEmoji\n        }, group, loadStickerMiddleware ?? middleware);\n\n        // const deferred = deferredPromise<void>();\n\n        const setLockColor = willHaveLock ? () => {\n          const lockUrl = locksUrls[doc.id] ??= computeLockColor(animation.canvas[0]);\n          (div as HTMLElement[]).forEach((div) => div.style.setProperty('--lock-url', `url(${lockUrl})`));\n        } : undefined;\n\n        const onFirstFrame = (container: HTMLElement, canvas: HTMLCanvasElement) => {\n          const element = container.firstElementChild;\n          if(needFadeIn !== false) {\n            needFadeIn = (needFadeIn || !element || element.tagName === 'svg') && rootScope.settings.animationsEnabled;\n          }\n\n          const cb = () => {\n            if(element && element !== canvas && element.tagName !== 'DIV') {\n              element.remove();\n            }\n          };\n\n          if(!needFadeIn) {\n            if(element) {\n              sequentialDom.mutate(cb);\n            }\n          } else {\n            sequentialDom.mutate(() => {\n              canvas && canvas.classList.add('fade-in');\n              if(element) {\n                element.classList.add('fade-out');\n              }\n\n              (canvas || element).addEventListener('animationend', () => {\n                sequentialDom.mutate(() => {\n                  canvas && canvas.classList.remove('fade-in');\n                  cb();\n                });\n              }, {once: true});\n            });\n          }\n        };\n\n        animation.addEventListener('firstFrame', () => {\n          const canvas = animation.canvas[0];\n          if(withThumb !== false) {\n            saveLottiePreview(doc, canvas, toneIndex);\n          }\n\n          if(willHaveLock) {\n            setLockColor();\n          }\n\n          if(!isCustomEmoji) {\n            (div as HTMLElement[]).forEach((container, idx) => {\n              onFirstFrame(container, animation.canvas[idx]);\n            });\n          }\n        }, {once: true});\n\n        if(emoji) {\n          managers.appStickersManager.preloadAnimatedEmojiStickerAnimation(emoji);\n        }\n\n        return animation;\n\n        // return deferred;\n        // await new Promise((resolve) => setTimeout(resolve, 5e3));\n      });\n    } else if(asStatic || stickerType === 3) {\n      const isSingleVideo = isAnimated && false;\n      const d = isSingleVideo ? (div as HTMLElement[]).slice(0, 1) : div as HTMLElement[];\n      const media: HTMLElement[] = d.map(() => {\n        let media: HTMLElement;\n        if(asStatic) {\n          media = new Image();\n        } else {\n          const video = media = createVideo();\n          video.muted = true;\n          if(play) video.autoplay = true;\n          if(loop) video.loop = true;\n        }\n\n        media.classList.add('media-sticker');\n        return media;\n      });\n\n      const thumbImage = (div as HTMLElement[]).map((div, idx) => (div.firstElementChild as HTMLElement) !== media[idx] && div.firstElementChild) as HTMLElement[];\n      if(needFadeIn !== false) {\n        needFadeIn = (needFadeIn || !downloaded || (asStatic ? thumbImage[0] : (!thumbImage[0] || thumbImage[0].tagName === 'svg'))) && rootScope.settings.animationsEnabled;\n      }\n\n      if(needFadeIn) {\n        media.forEach((media) => media.classList.add('fade-in'));\n      }\n\n      return new Promise<HTMLVideoElement[] | HTMLImageElement[]>(async(resolve, reject) => {\n        const r = async() => {\n          if(middleware && !middleware()) {\n            reject(middlewareError);\n            return;\n          }\n\n          const mediaLength = media.length;\n          const loaded: HTMLElement[] = [];\n          const onLoad = (div: HTMLElement, media: HTMLElement, thumbImage: HTMLElement) => {\n            sequentialDom.mutateElement(div, () => {\n              if(middleware && !middleware()) {\n                reject(middlewareError);\n                return;\n              }\n\n              if(!media) {\n                if(!isSingleVideo || !isAnimated) {\n                  thumbImage?.remove();\n                }\n\n                return;\n              }\n\n              if(media as HTMLVideoElement && !isSavingLottiePreview(doc, toneIndex)) {\n                // const perf = performance.now();\n                assumeType<HTMLVideoElement>(media);\n                const canvas = document.createElement('canvas');\n                canvas.width = width * window.devicePixelRatio;\n                canvas.height = height * window.devicePixelRatio;\n                const ctx = canvas.getContext('2d');\n                ctx.drawImage(media, 0, 0, canvas.width, canvas.height);\n                saveLottiePreview(doc, canvas, toneIndex);\n                // console.log('perf', performance.now() - perf);\n              }\n\n              if(isSingleVideo) {\n                resolve(media as any);\n                return;\n              }\n\n              div.append(media);\n\n              if(needFadeIn) {\n                thumbImage && thumbImage.classList.add('fade-out');\n                media.addEventListener('animationend', () => {\n                  media.classList.remove('fade-in');\n                  thumbImage?.remove();\n                }, {once: true});\n              } else {\n                thumbImage?.remove();\n              }\n\n              if(isAnimated) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n\n              if(loaded.push(media) === mediaLength) {\n                resolve(loaded as any);\n              }\n            });\n          };\n\n          await getCacheContext();\n          let lastPromise: Promise<any>;\n          (div as HTMLElement[]).forEach((div, idx) => {\n            const _media = media[idx];\n            const cb = () => onLoad(div, _media, thumbImage[idx]);\n            if(_media) lastPromise = renderImageFromUrlPromise(_media, cacheContext.url);\n            lastPromise.then(cb);\n          });\n        };\n\n        await getCacheContext();\n        if(cacheContext.url) r();\n        else {\n          let promise: Promise<any>;\n          if(stickerType !== 1 && asStatic) {\n            const thumb = choosePhotoSize(doc, width, height, false) as PhotoSize.photoSize;\n            // promise = managers.appDocsManager.getThumbURL(doc, thumb).promise\n            promise = appDownloadManager.downloadMediaURL({media: doc, thumb, queueId: lazyLoadQueue?.queueId});\n          } else {\n            promise = appDownloadManager.downloadMediaURL({media: doc, queueId: lazyLoadQueue?.queueId});\n          }\n\n          promise.then(r, reject);\n        }\n      });\n    }\n  };\n\n  if(exportLoad && (!downloaded || isAnimated)) {\n    ret.load = load;\n    return ret;\n  }\n\n  const loadPromise: Promise<Awaited<ReturnType<typeof load>> | void> = lazyLoadQueue && (!downloaded || isAnimated) ?\n    (lazyLoadQueue.push({div: div[0], load}), Promise.resolve()) :\n    load();\n\n  if(downloaded && (asStatic/*  || stickerType === 3 */)) {\n    loadThumbPromise = loadPromise as any;\n    if(loadPromises) {\n      loadPromises.push(loadThumbPromise);\n    }\n  }\n\n  if(stickerType === 2 && effectThumb && isOut !== undefined && !noPremium) {\n    attachStickerEffectHandler({\n      container: div[0],\n      doc,\n      managers,\n      middleware,\n      isOut,\n      width,\n      loadPromise,\n      relativeEffect,\n      loopEffect\n    });\n  }\n\n  ret.render = loadPromise as any;\n  return ret;\n}\n\nfunction attachStickerEffectHandler({container, doc, managers, middleware, isOut, width, loadPromise, relativeEffect, loopEffect}: {\n  container: HTMLElement,\n  doc: MyDocument,\n  managers: AppManagers,\n  middleware: Middleware,\n  isOut: boolean,\n  width: number,\n  loadPromise: Promise<any>,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  managers.appStickersManager.preloadSticker(doc.id, true);\n\n  let playing = false;\n  attachClickEvent(container, async(e) => {\n    cancelEvent(e);\n    if(playing) {\n      const a = document.createElement('a');\n      a.onclick = () => {\n        hideToast();\n        new PopupStickers(doc.stickerSetInput).show();\n      };\n\n      toastNew({\n        langPackKey: 'Sticker.Premium.Click.Info',\n        langPackArguments: [a]\n      });\n\n      return;\n    }\n\n    playing = true;\n\n    await loadPromise;\n    const {animationDiv, stickerPromise} = wrapStickerAnimation({\n      doc,\n      middleware,\n      side: isOut ? 'right' : 'left',\n      size: width * STICKER_EFFECT_MULTIPLIER,\n      target: container,\n      play: true,\n      fullThumb: getStickerEffectThumb(doc),\n      relativeEffect,\n      loopEffect\n    });\n\n    if(isOut !== undefined && !isOut/*  && !relativeEffect */) {\n      animationDiv.classList.add('reflect-x');\n    }\n\n    stickerPromise.then((player) => {\n      player.addEventListener('destroy', () => {\n        playing = false;\n      });\n    });\n  });\n}\n\nexport async function onEmojiStickerClick({event, container, managers, peerId, middleware}: {\n  event: Event,\n  container: HTMLElement,\n  managers: AppManagers,\n  peerId: PeerId,\n  middleware: Middleware\n}) {\n  if(!peerId.isUser()) {\n    return;\n  }\n\n  cancelEvent(event);\n\n  const bubble = findUpClassName(container, 'bubble');\n  const emoji = container.dataset.stickerEmoji;\n  const data: SendMessageEmojiInteractionData = (container as any).emojiData ??= {\n    a: [],\n    v: 1\n  };\n\n  const sendInteractionThrottled: () => void = (container as any).sendInteractionThrottled = throttle(() => {\n    const length = data.a.length;\n    if(!length) {\n      return;\n    }\n\n    const firstTime = data.a[0].t;\n\n    data.a.forEach((a) => {\n      a.t = (a.t - firstTime) / 1000;\n    });\n\n    const bubble = findUpClassName(container, 'bubble');\n    managers.appMessagesManager.setTyping(appImManager.chat.peerId, {\n      _: 'sendMessageEmojiInteraction',\n      msg_id: getServerMessageId(+bubble.dataset.mid),\n      emoticon: emoji,\n      interaction: {\n        _: 'dataJSON',\n        data: JSON.stringify(data)\n      }\n    }, true);\n\n    data.a.length = 0;\n  }, 1000, false);\n\n  const animation = !container.classList.contains('custom-emoji') ? lottieLoader.getAnimation(container) : undefined;\n  if(animation?.paused) {\n    const doc = await managers.appStickersManager.getAnimatedEmojiSoundDocument(emoji);\n    if(doc) {\n      const audio = document.createElement('audio');\n      audio.style.display = 'none';\n      container.parentElement.append(audio);\n\n      try {\n        const url = await appDownloadManager.downloadMediaURL({media: doc});\n\n        audio.src = url;\n        audio.play();\n        await onMediaLoad(audio, undefined, true);\n\n        audio.addEventListener('ended', () => {\n          audio.src = '';\n          audio.remove();\n        }, {once: true});\n      } catch(err) {\n\n      }\n    }\n\n    animation.autoplay = true;\n    animation.restart();\n  }\n\n  const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji, true);\n  if(!doc) {\n    return;\n  }\n\n  const isOut = bubble ? bubble.classList.contains('is-out') : undefined;\n  const {animationDiv} = wrapStickerAnimation({\n    doc,\n    middleware,\n    side: isOut ? 'right' : 'left',\n    size: 360,\n    target: container,\n    play: true,\n    withRandomOffset: true\n  });\n\n  if(isOut !== undefined && !isOut) {\n    animationDiv.classList.add('reflect-x');\n  }\n\n  // using a trick here: simulated event from interlocutor's interaction won't fire ours\n  if(event.isTrusted) {\n    data.a.push({\n      i: 1,\n      t: Date.now()\n    });\n\n    sendInteractionThrottled();\n  }\n  // });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n/**\n  * https://core.telegram.org/api/files#vector-thumbnails\n  */\nexport default function getPathFromBytes(bytes: Uint8Array) {\n  const lookup = 'AACAAAAHAAALMAAAQASTAVAAAZaacaaaahaaalmaaaqastava.az0123456789-,';\n\n  let path = 'M';\n  for(let i = 0, length = bytes.length; i < length; ++i) {\n    const num = bytes[i];\n\n    if(num >= (128 + 64)) {\n      path += lookup[num - 128 - 64];\n    } else {\n      if(num >= 128) {\n        path += ',';\n      } else if(num >= 64) {\n        path += '-';\n      }\n      path += '' + (num & 63);\n    }\n  }\n  path += 'z';\n\n  return path;\n}\n","// https://github.com/telegramdesktop/tdesktop/blob/543bfab24a76402992421063f1e6444f347d31fe/Telegram/SourceFiles/boxes/sticker_set_box.cpp#L75\nexport default function computeLockColor(canvas: HTMLCanvasElement) {\n  const context = canvas.getContext('2d');\n  const size = 20 * (canvas.dpr ?? 1);\n  const width = size;\n  const height = size;\n  const skipx = (canvas.width - width) / 2;\n  const margin = 0/*  * (canvas.dpr ?? 1) */;\n  const skipy = canvas.height - height - margin;\n  const imageData = context.getImageData(skipx, skipy, width, height).data;\n  let sr = 0, sg = 0, sb = 0, sa = 0;\n  for(let i = 0; i < imageData.length; i += 4) {\n    sr += imageData[i];\n    sg += imageData[i + 1];\n    sb += imageData[i + 2];\n    sa += imageData[i + 3];\n  }\n\n  const outCanvas = document.createElement('canvas');\n  outCanvas.width = size;\n  outCanvas.height = size;\n  const outContext = outCanvas.getContext('2d');\n  const color = new Uint8ClampedArray([sr * 255 / sa, sg * 255 / sa, sb * 255 / sa, 255]);\n  const rgba = `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${color[3]})`;\n  outContext.fillStyle = rgba;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  outContext.fillStyle = `rgba(112, 117, 121, 0.3)`;\n  outContext.fillRect(0, 0, outCanvas.width, outCanvas.height);\n  // document.querySelector('.popup-title').append(c);\n  return outCanvas.toDataURL('image/jpeg');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport assumeType from '../../helpers/assumeType';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport makeError from '../../helpers/makeError';\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\nimport throttleWithRaf from '../../helpers/schedulers/throttleWithRaf';\nimport windowSize from '../../helpers/windowSize';\nimport {PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerAnimation({\n  size,\n  doc,\n  middleware,\n  target,\n  side,\n  skipRatio,\n  play,\n  managers,\n  fullThumb,\n  withRandomOffset,\n  relativeEffect,\n  loopEffect\n}: {\n  size: number,\n  doc: MyDocument,\n  middleware?: Middleware,\n  target: HTMLElement,\n  side: 'left' | 'center' | 'right',\n  skipRatio?: number,\n  play: boolean,\n  managers?: AppManagers,\n  fullThumb?: PhotoSize | VideoSize,\n  withRandomOffset?: boolean,\n  relativeEffect?: boolean,\n  loopEffect?: boolean\n}) {\n  const animationDiv = document.createElement('div');\n  animationDiv.classList.add('emoji-animation');\n\n  // const size = 280;\n  animationDiv.style.width = size + 'px';\n  animationDiv.style.height = size + 'px';\n\n  let animation: RLottiePlayer;\n  const unmountAnimation = () => {\n    middlewareHelper.clean();\n    animation?.remove();\n    animationDiv.remove();\n    appImManager.chat.bubbles.scrollable.container.removeEventListener('scroll', onScroll);\n  };\n\n  const middlewareHelper = middleware?.create() ?? getMiddleware();\n  middleware = middlewareHelper.get();\n\n  const stickerPromise = wrapSticker({\n    div: animationDiv,\n    doc,\n    middleware,\n    withThumb: false,\n    needFadeIn: false,\n    loop: !!loopEffect,\n    width: size,\n    height: size,\n    play,\n    group: 'none',\n    skipRatio,\n    managers,\n    fullThumb\n  }).then(({render}) => render).then((_animation) => {\n    assumeType<RLottiePlayer>(_animation);\n    if(!middleware()) {\n      _animation.remove();\n      throw makeError('MIDDLEWARE');\n    }\n\n    animation = _animation;\n    animation.addEventListener('enterFrame', (frameNo) => {\n      if((!loopEffect && frameNo === animation.maxFrame) || !isInDOM(target)) {\n        unmountAnimation();\n      }\n    });\n\n    if(IS_VIBRATE_SUPPORTED) {\n      animation.addEventListener('firstFrame', () => {\n        navigator.vibrate(100);\n      }, {once: true});\n    }\n\n    return animation;\n  });\n\n  const generateRandomSigned = (max: number) => {\n    const r = Math.random() * max * 2;\n    return r > max ? -r % max : r;\n  };\n\n  const randomOffsetX = withRandomOffset ? generateRandomSigned(16) : 0;\n  const randomOffsetY = withRandomOffset ? generateRandomSigned(4) : 0;\n  const setPosition = () => {\n    if(!isInDOM(target)) {\n      unmountAnimation();\n      return;\n    }\n\n    const rect = target.getBoundingClientRect();\n\n    const factor = rect.width / 200;\n    const stableOffsetX = side === 'center' ? 0 : 16 * (side === 'right' ? 1 : -1) * factor;\n    // const stableOffsetY = side === 'center' ? 0 : -50 * factor;\n    const stableOffsetY = side === 'center' ? 0 : 0 * factor;\n\n    const rectX = side === 'right' ? rect.right : rect.left;\n    const rectY = rect.top;\n\n    const addOffsetX = (side === 'center' ? (rect.width - size) / 2 : (side === 'right' ? -size : 0)) + stableOffsetX + randomOffsetX;\n    const addOffsetY = (side === 'center' || true ? (rect.height - size) / 2 : 0) + stableOffsetY + randomOffsetY;\n    const x = rectX + addOffsetX;\n    const y = rectY + addOffsetY;\n\n    if(y <= -size || y >= windowSize.height) {\n      unmountAnimation();\n      return;\n    }\n\n    if(relativeEffect) {\n      if(side !== 'center') animationDiv.style[side] = Math.abs(stableOffsetX) * -1 + 'px';\n      else animationDiv.style.left = addOffsetX + 'px';\n      animationDiv.style.top = addOffsetY + 'px';\n    } else {\n      animationDiv.style.top = y + 'px';\n      animationDiv.style.left = x + 'px';\n    }\n  };\n\n  const onScroll = throttleWithRaf(setPosition);\n  appImManager.chat.bubbles.scrollable.container.addEventListener('scroll', onScroll);\n\n  setPosition();\n\n  if(relativeEffect) {\n    animationDiv.classList.add('is-relative');\n    target.parentElement.append(animationDiv);\n  } else {\n    appImManager.emojiAnimationContainer.append(animationDiv);\n  }\n\n  return {animationDiv, stickerPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport wrapSticker from './sticker'\n\nexport default async function wrapStickerEmoji({emoji, div, width, height, managers = rootScope.managers}: {\n  emoji: string,\n  div: HTMLElement,\n  managers?: AppManagers,\n  width: number,\n  height: number\n}) {\n  const doc = await managers.appStickersManager.getAnimatedEmojiSticker(emoji);\n  if(!doc) {\n    div.classList.add('media-sticker-wrapper');\n    throw new Error('no sticker');\n  }\n\n  return wrapSticker({\n    doc,\n    div,\n    emoji,\n    width,\n    height,\n    loop: false,\n    play: true\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport createVideo from '../../helpers/dom/createVideo';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport {StickerSet} from '../../layer';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapSticker from './sticker';\n\nexport default async function wrapStickerSetThumb({set, lazyLoadQueue, container, group, autoplay, width, height, managers = rootScope.managers}: {\n  set: StickerSet.stickerSet,\n  lazyLoadQueue: LazyLoadQueue,\n  container: HTMLElement,\n  group: AnimationItemGroup,\n  autoplay: boolean,\n  width: number,\n  height: number,\n  managers?: AppManagers\n}) {\n  if(set.thumbs?.length) {\n    container.classList.add('media-sticker-wrapper');\n    lazyLoadQueue.push({\n      div: container,\n      load: async() => {\n        const downloadOptions = await managers.appStickersManager.getStickerSetThumbDownloadOptions(set);\n        const promise = appDownloadManager.download(downloadOptions);\n\n        if(set.pFlags.animated && !set.pFlags.videos) {\n          return promise\n          .then((blob) => {\n            lottieLoader.loadAnimationWorker({\n              container,\n              loop: true,\n              autoplay,\n              animationData: blob,\n              width,\n              height,\n              needUpscale: true,\n              name: 'setThumb' + set.id\n            }, group);\n          });\n        } else {\n          let media: HTMLElement;\n          if(set.pFlags.videos) {\n            media = createVideo();\n            (media as HTMLVideoElement).autoplay = true;\n            (media as HTMLVideoElement).muted = true;\n            (media as HTMLVideoElement).loop = true;\n          } else {\n            media = new Image();\n          }\n\n          media.classList.add('media-sticker');\n\n          return promise.then((blob) => {\n            renderImageFromUrl(media, URL.createObjectURL(blob), () => {\n              container.append(media);\n\n              if(set.pFlags.videos) {\n                animationIntersector.addAnimation(media as HTMLVideoElement, group);\n              }\n            });\n          });\n        }\n      }\n    });\n\n    return;\n  }\n\n  const promise = managers.appStickersManager.getStickerSet(set);\n  const stickerSet = await promise;\n  if(stickerSet.documents[0]._ !== 'documentEmpty') { // as thumb will be used first sticker\n    wrapSticker({\n      doc: stickerSet.documents[0],\n      div: container,\n      group: group,\n      lazyLoadQueue,\n      managers,\n      width,\n      height\n    }); // kostil\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport Row from '../row';\nimport wrapSticker from './sticker';\n\nexport default function wrapStickerToRow({doc, row, size, managers}: {\n  doc: MyDocument,\n  row: Row,\n  size?: 'small' | 'large',\n  managers?: AppManagers\n}) {\n  const previousMedia = row.media;\n  const media = row.createMedia('small');\n\n  if(previousMedia) {\n    media.classList.add('hide');\n  }\n\n  const loadPromises: Promise<any>[] = previousMedia ? [] : undefined;\n\n  const _size = size === 'small' ? 32 : 48;\n  const result = wrapSticker({\n    div: media,\n    doc: doc,\n    width: _size,\n    height: _size,\n    loadPromises,\n    managers\n  }).then(({render}) => render);\n\n  loadPromises && Promise.all(loadPromises).then(() => {\n    media.classList.remove('hide');\n    previousMedia.remove();\n  });\n\n  return result;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport {animateSingle} from '../../helpers/animation';\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport getStrippedThumbIfNeeded from '../../helpers/getStrippedThumbIfNeeded';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport noop from '../../helpers/noop';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport {fastRaf} from '../../helpers/schedulers';\nimport throttle from '../../helpers/schedulers/throttle';\nimport sequentialDom from '../../helpers/sequentialDom';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport {Message, PhotoSize, VideoSize} from '../../layer';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport rootScope from '../../lib/rootScope';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport appMediaPlaybackController, {MediaSearchContext} from '../appMediaPlaybackController';\nimport {findMediaTargets} from '../audio';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ProgressivePreloader from '../preloader';\nimport wrapPhoto from './photo';\n\nconst MAX_VIDEO_AUTOPLAY_SIZE = 50 * 1024 * 1024; // 50 MB\n\nlet roundVideoCircumference = 0;\nmediaSizes.addEventListener('changeScreen', (from, to) => {\n  if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n    const elements = Array.from(document.querySelectorAll('.media-round .progress-ring')) as SVGSVGElement[];\n    const width = mediaSizes.active.round.width;\n    const halfSize = width / 2;\n    const radius = halfSize - 7;\n    roundVideoCircumference = 2 * Math.PI * radius;\n    elements.forEach((element) => {\n      element.setAttributeNS(null, 'width', '' + width);\n      element.setAttributeNS(null, 'height', '' + width);\n\n      const circle = element.firstElementChild as SVGCircleElement;\n      circle.setAttributeNS(null, 'cx', '' + halfSize);\n      circle.setAttributeNS(null, 'cy', '' + halfSize);\n      circle.setAttributeNS(null, 'r', '' + radius);\n\n      circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n      circle.style.strokeDashoffset = '' + roundVideoCircumference;\n    });\n  }\n});\n\nexport default async function wrapVideo({doc, container, message, boxWidth, boxHeight, withTail, isOut, middleware, lazyLoadQueue, noInfo, group, onlyPreview, noPreview, withoutPreloader, loadPromises, noPlayButton, photoSize, videoSize, searchContext, autoDownload, managers = rootScope.managers}: {\n  doc: MyDocument,\n  container?: HTMLElement,\n  message?: Message.message,\n  boxWidth?: number,\n  boxHeight?: number,\n  withTail?: boolean,\n  isOut?: boolean,\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  noInfo?: boolean,\n  noPlayButton?: boolean,\n  group?: AnimationItemGroup,\n  onlyPreview?: boolean,\n  noPreview?: boolean,\n  withoutPreloader?: boolean,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  photoSize?: PhotoSize,\n  videoSize?: VideoSize,\n  searchContext?: MediaSearchContext,\n  managers?: AppManagers\n}) {\n  const autoDownloadSize = autoDownload?.video;\n  let noAutoDownload = autoDownloadSize === 0;\n  const isAlbumItem = !(boxWidth && boxHeight);\n  const canAutoplay = /* doc.sticker ||  */(\n    (\n      doc.type !== 'video' || (\n        doc.size <= MAX_VIDEO_AUTOPLAY_SIZE &&\n        !isAlbumItem\n      )\n    ) && (doc.type === 'gif' ? rootScope.settings.autoPlay.gifs : rootScope.settings.autoPlay.videos)\n  );\n  let spanTime: HTMLElement, spanPlay: HTMLElement;\n\n  if(!noInfo) {\n    spanTime = document.createElement('span');\n    spanTime.classList.add('video-time');\n    container.append(spanTime);\n\n    let needPlayButton = false;\n    if(doc.type !== 'gif') {\n      spanTime.innerText = toHHMMSS(doc.duration, false);\n\n      if(!noPlayButton && doc.type !== 'round') {\n        if(canAutoplay && !noAutoDownload) {\n          spanTime.classList.add('tgico', 'can-autoplay');\n        } else {\n          needPlayButton = true;\n        }\n      }\n    } else {\n      spanTime.innerText = 'GIF';\n\n      if(!canAutoplay && !noPlayButton) {\n        needPlayButton = true;\n        noAutoDownload = undefined;\n      }\n    }\n\n    if(needPlayButton) {\n      spanPlay = document.createElement('span');\n      spanPlay.classList.add('video-play', 'tgico-largeplay', 'btn-circle', 'position-center');\n      container.append(spanPlay);\n    }\n  }\n\n  const res: {\n    thumb?: typeof photoRes,\n    loadPromise: Promise<any>\n  } = {} as any;\n\n  if(doc.mime_type === 'image/gif') {\n    const photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader,\n      loadPromises,\n      autoDownloadSize,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n    res.loadPromise = photoRes.loadPromises.full;\n    return res;\n  }\n\n  /* const video = doc.type === 'round' ? appMediaPlaybackController.addMedia(doc, message.mid) as HTMLVideoElement : document.createElement('video');\n  if(video.parentElement) {\n    video.remove();\n  } */\n\n  let preloader: ProgressivePreloader; // it must be here, otherwise will get error before initialization in round onPlay\n\n  const video = createVideo();\n  video.classList.add('media-video');\n  video.muted = true;\n  if(doc.type === 'round') {\n    const divRound = document.createElement('div');\n    divRound.classList.add('media-round', 'z-depth-1');\n    divRound.dataset.mid = '' + message.mid;\n    divRound.dataset.peerId = '' + message.peerId;\n    (divRound as any).message = message;\n\n    const size = mediaSizes.active.round;\n    const halfSize = size.width / 2;\n    const strokeWidth = 3.5;\n    const radius = halfSize - (strokeWidth * 2);\n    divRound.innerHTML = `<svg class=\"progress-ring\" width=\"${size.width}\" height=\"${size.width}\" style=\"transform: rotate(-90deg);\">\n      <circle class=\"progress-ring__circle\" stroke=\"white\" stroke-opacity=\"0.3\" stroke-width=\"${strokeWidth}\" cx=\"${halfSize}\" cy=\"${halfSize}\" r=\"${radius}\" fill=\"transparent\"/>\n    </svg>`;\n\n    const circle = divRound.firstElementChild.firstElementChild as SVGCircleElement;\n    if(!roundVideoCircumference) {\n      roundVideoCircumference = 2 * Math.PI * radius;\n    }\n    circle.style.strokeDasharray = roundVideoCircumference + ' ' + roundVideoCircumference;\n    circle.style.strokeDashoffset = '' + roundVideoCircumference;\n\n    spanTime.classList.add('tgico');\n\n    const isUnread = message.pFlags.media_unread;\n    if(isUnread) {\n      divRound.classList.add('is-unread');\n    }\n\n    const canvas = document.createElement('canvas');\n    canvas.width = canvas.height = doc.w/*  * window.devicePixelRatio */;\n\n    divRound.prepend(canvas, spanTime);\n    divRound.append(video);\n    container.append(divRound);\n\n    const ctx = canvas.getContext('2d');\n    /* ctx.beginPath();\n    ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2);\n    ctx.clip(); */\n\n    const onLoad = () => {\n      const message: Message.message = (divRound as any).message;\n      const globalVideo = appMediaPlaybackController.addMedia(message, !noAutoDownload) as HTMLVideoElement;\n      const clear = () => {\n        (appImManager.chat.setPeerPromise || Promise.resolve()).finally(() => {\n          if(isInDOM(globalVideo)) {\n            return;\n          }\n\n          globalVideo.removeEventListener('play', onPlay);\n          globalVideo.removeEventListener('timeupdate', throttledTimeUpdate);\n          globalVideo.removeEventListener('pause', onPaused);\n          globalVideo.removeEventListener('ended', onEnded);\n        });\n      };\n\n      const onFrame = () => {\n        ctx.drawImage(globalVideo, 0, 0);\n\n        const offset = roundVideoCircumference - globalVideo.currentTime / globalVideo.duration * roundVideoCircumference;\n        circle.style.strokeDashoffset = '' + offset;\n\n        return !globalVideo.paused;\n      };\n\n      const onTimeUpdate = () => {\n        if(!globalVideo.duration) {\n          return;\n        }\n\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        if(globalVideo.paused) {\n          onFrame();\n        }\n\n        spanTime.innerText = toHHMMSS(globalVideo.duration - globalVideo.currentTime, false);\n      };\n\n      const throttledTimeUpdate = throttle(() => {\n        fastRaf(onTimeUpdate);\n      }, 1000, false);\n\n      const onPlay = () => {\n        video.classList.add('hide');\n        divRound.classList.remove('is-paused');\n        animateSingle(onFrame, canvas);\n\n        if(preloader && preloader.preloader && preloader.preloader.classList.contains('manual')) {\n          preloader.onClick();\n        }\n      };\n\n      const onPaused = () => {\n        if(!isInDOM(globalVideo)) {\n          clear();\n          return;\n        }\n\n        divRound.classList.add('is-paused');\n      };\n\n      const onEnded = () => {\n        video.classList.remove('hide');\n        divRound.classList.add('is-paused');\n\n        video.currentTime = 0;\n        spanTime.innerText = toHHMMSS(globalVideo.duration, false);\n\n        if(globalVideo.currentTime) {\n          globalVideo.currentTime = 0;\n        }\n      };\n\n      globalVideo.addEventListener('play', onPlay);\n      globalVideo.addEventListener('timeupdate', throttledTimeUpdate);\n      globalVideo.addEventListener('pause', onPaused);\n      globalVideo.addEventListener('ended', onEnded);\n\n      attachClickEvent(canvas, (e) => {\n        cancelEvent(e);\n\n        // ! \n        if(preloader && !preloader.detached) {\n          preloader.onClick();\n        }\n\n        // ! can't use it here. on Safari iOS video won't start.\n        /* if(globalVideo.readyState < 2) {\n          return;\n        } */\n\n        if(globalVideo.paused) {\n          const hadSearchContext = !!searchContext;\n          if(appMediaPlaybackController.setSearchContext(searchContext || {\n            peerId: NULL_PEER_ID,\n            inputFilter: {_: 'inputMessagesFilterEmpty'},\n            useSearch: false\n          })) {\n            const [prev, next] = !hadSearchContext ? [] : findMediaTargets(divRound, message.mid/* , searchContext.useSearch */);\n            appMediaPlaybackController.setTargets({peerId: message.peerId, mid: message.mid}, prev, next);\n          }\n\n          globalVideo.play();\n        } else {\n          globalVideo.pause();\n        }\n      });\n\n      if(globalVideo.paused) {\n        if(globalVideo.duration && globalVideo.currentTime !== globalVideo.duration && globalVideo.currentTime > 0) {\n          onFrame();\n          onTimeUpdate();\n          video.classList.add('hide');\n        } else {\n          onPaused();\n        }\n      } else {\n        onPlay();\n      }\n    };\n\n    if(message.pFlags.is_outgoing) {\n      (divRound as any).onLoad = onLoad;\n      divRound.dataset.isOutgoing = '1';\n    } else {\n      onLoad();\n    }\n  } else {\n    video.autoplay = true; //  safari\n  }\n\n  let photoRes: Awaited<ReturnType<typeof wrapPhoto>>;\n  if(message) {\n    photoRes = await wrapPhoto({\n      photo: doc,\n      message,\n      container,\n      boxWidth,\n      boxHeight,\n      withTail,\n      isOut,\n      lazyLoadQueue,\n      middleware,\n      withoutPreloader: true,\n      loadPromises,\n      autoDownloadSize: autoDownload?.photo,\n      size: photoSize,\n      managers\n    });\n\n    res.thumb = photoRes;\n\n    if((!canAutoplay && doc.type !== 'gif') || onlyPreview) {\n      res.loadPromise = photoRes.loadPromises.full;\n      return res;\n    }\n\n    if(withTail) {\n      const foreignObject = (photoRes.images.thumb || photoRes.images.full).parentElement;\n      video.width = +foreignObject.getAttributeNS(null, 'width');\n      video.height = +foreignObject.getAttributeNS(null, 'height');\n      foreignObject.append(video);\n    }\n  } else if(!noPreview) { // * gifs masonry\n    const gotThumb = getStrippedThumbIfNeeded(doc, {} as ThumbCache, true);\n    if(gotThumb) {\n      const thumbImage = gotThumb.image;\n      thumbImage.classList.add('media-poster');\n      container.append(thumbImage);\n      res.thumb = {\n        loadPromises: {\n          thumb: gotThumb.loadPromise,\n          full: Promise.resolve()\n        },\n        images: {\n          thumb: thumbImage,\n          full: null\n        },\n        preloader: null,\n        aspecter: null\n      };\n\n      loadPromises?.push(gotThumb.loadPromise);\n      res.loadPromise = gotThumb.loadPromise;\n    }\n  }\n\n  if(onlyPreview) {\n    return res;\n  }\n\n  if(!video.parentElement && container) {\n    (photoRes?.aspecter || container).append(video);\n  }\n\n  let cacheContext: ThumbCache;\n  const getCacheContext = async() => {\n    return cacheContext = await managers.thumbsStorage.getCacheContext(doc, videoSize?.type);\n  };\n\n  await getCacheContext();\n\n  const uploadFileName = message?.uploadingFileName;\n  if(uploadFileName) { // means upload\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend',\n      isUpload: true\n    });\n    preloader.attachPromise(appDownloadManager.getUpload(uploadFileName));\n    preloader.attach(container, false);\n    noAutoDownload = undefined;\n  } else if(!cacheContext.downloaded && !doc.supportsStreaming && !withoutPreloader) {\n    preloader = new ProgressivePreloader({\n      attachMethod: 'prepend'\n    });\n  } else if(doc.supportsStreaming) {\n    preloader = new ProgressivePreloader({\n      cancelable: false,\n      attachMethod: 'prepend'\n    });\n  }\n\n  const renderDeferred = deferredPromise<void>();\n  video.addEventListener('error', (e) => {\n    if(video.error.code !== 4) {\n      console.error('Error ' + video.error.code + '; details: ' + video.error.message);\n    }\n\n    if(preloader && !uploadFileName) {\n      preloader.detach();\n    }\n\n    if(!renderDeferred.isFulfilled) {\n      renderDeferred.resolve();\n    }\n  }, {once: true});\n\n  if(doc.type === 'video') {\n    const onTimeUpdate = () => {\n      if(!video.duration) {\n        return;\n      }\n\n      spanTime.innerText = toHHMMSS(video.duration - video.currentTime, false);\n    };\n\n    const throttledTimeUpdate = throttle(() => {\n      fastRaf(onTimeUpdate);\n    }, 1e3, false);\n\n    video.addEventListener('timeupdate', throttledTimeUpdate);\n\n    if(spanPlay) {\n      video.addEventListener('timeupdate', () => {\n        sequentialDom.mutateElement(spanPlay, () => {\n          spanPlay.remove();\n        });\n      }, {once: true});\n    }\n  }\n\n  video.muted = true;\n  video.loop = true;\n  // video.play();\n  video.autoplay = true;\n\n  let loadPhotoThumbFunc = noAutoDownload && photoRes?.preloader?.loadFunc;\n  const load = async() => {\n    if(preloader && noAutoDownload && !withoutPreloader) {\n      preloader.construct();\n      preloader.setManual();\n    }\n\n    await getCacheContext();\n    let loadPromise: Promise<any> = Promise.resolve();\n    if((preloader && !uploadFileName) || withoutPreloader) {\n      if(!cacheContext.downloaded && !doc.supportsStreaming) {\n        const promise = loadPromise = appDownloadManager.downloadMediaURL({\n          media: doc,\n          queueId: lazyLoadQueue?.queueId,\n          onlyCache: noAutoDownload,\n          thumb: videoSize\n        });\n\n        if(preloader) {\n          preloader.attach(container, false, promise);\n        }\n      } else if(doc.supportsStreaming) {\n        if(noAutoDownload) {\n          loadPromise = Promise.reject();\n        } else if(!cacheContext.downloaded && preloader) { // * check for uploading video\n          preloader.attach(container, false, null);\n          video.addEventListener(IS_SAFARI ? 'timeupdate' : 'canplay', () => {\n            preloader.detach();\n          }, {once: true});\n        }\n      }\n    }\n\n    if(!noAutoDownload && loadPhotoThumbFunc) {\n      loadPhotoThumbFunc();\n      loadPhotoThumbFunc = null;\n    }\n\n    noAutoDownload = undefined;\n\n    loadPromise.then(async() => {\n      if(middleware && !middleware()) {\n        renderDeferred.resolve();\n        return;\n      }\n\n      if(doc.type === 'round') {\n        appMediaPlaybackController.resolveWaitingForLoadMedia(message.peerId, message.mid, message.pFlags.is_scheduled);\n      }\n\n      await getCacheContext();\n\n      onMediaLoad(video).then(() => {\n        if(group) {\n          animationIntersector.addAnimation(video, group);\n        }\n\n        if(preloader && !uploadFileName) {\n          preloader.detach();\n        }\n\n        renderDeferred.resolve();\n      });\n\n      renderImageFromUrl(video, cacheContext.url);\n    }, noop);\n\n    return {download: loadPromise, render: renderDeferred};\n  };\n\n  if(preloader && !uploadFileName) {\n    preloader.setDownloadFunction(load);\n  }\n\n  /* if(doc.size >= 20e6 && !doc.downloaded) {\n    let downloadDiv = document.createElement('div');\n    downloadDiv.classList.add('download');\n\n    let span = document.createElement('span');\n    span.classList.add('btn-circle', 'tgico-download');\n    downloadDiv.append(span);\n\n    downloadDiv.addEventListener('click', () => {\n      downloadDiv.remove();\n      loadVideo();\n    });\n\n    container.prepend(downloadDiv);\n\n    return;\n  } */\n\n  if(doc.type === 'gif' && !canAutoplay) {\n    attachClickEvent(container, (e) => {\n      cancelEvent(e);\n      spanPlay.remove();\n      load();\n    }, {capture: true, once: true});\n  } else {\n    res.loadPromise = !lazyLoadQueue ?\n      (await load()).render :\n      (lazyLoadQueue.push({div: container, load: () => load().then(({render}) => render)}), Promise.resolve());\n  }\n\n  if(res.thumb) {\n    await res.thumb.loadPromises.thumb;\n  }\n\n  return res;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageDescription(webPage: WebPage.webPage) {\n  const shortDescriptionText = limitSymbols(webPage.description || '', 150, 180);\n  // const siteName = webPage.site_name;\n  // let contextHashtag = '';\n  // if(siteName === 'GitHub') {\n  //   const matches = apiWebPage.url.match(/(https?:\\/\\/github\\.com\\/[^\\/]+\\/[^\\/]+)/);\n  //   if(matches) {\n  //     contextHashtag = matches[0] + '/issues/{1}';\n  //   }\n  // }\n  return wrapRichText(shortDescriptionText/* , {\n    contextSite: siteName || 'external',\n    contextHashtag: contextHashtag\n  } */);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport limitSymbols from '../../helpers/string/limitSymbols';\nimport {WebPage} from '../../layer';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\n\nexport default function wrapWebPageTitle(webPage: WebPage.webPage) {\n  let shortTitle = webPage.title || webPage.author || webPage.site_name || '';\n  shortTitle = limitSymbols(shortTitle, 80, 100);\n  return wrapRichText(shortTitle, {noLinks: true, noLinebreaks: true});\n}\n","// Taken from https://core.telegram.org/bots/payments/currencies.json\nexport type Currency = {\n  code: string,\n  title: string,\n  symbol: string,\n  native: string,\n  thousands_sep: string,\n  decimal_sep: string,\n  symbol_left: boolean,\n  space_between: boolean,\n  exp: number,\n  min_amount: string | number,\n  max_amount: string | number\n};\n\nconst Currencies: {[currency: string]: Currency} = {'AED':{'code':'AED', 'title':'United Arab Emirates Dirham', 'symbol':'AED', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'367', 'max_amount':'3672990'}, 'AFN':{'code':'AFN', 'title':'Afghan Afghani', 'symbol':'AFN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'8893', 'max_amount':'88930176'}, 'ALL':{'code':'ALL', 'title':'Albanian Lek', 'symbol':'ALL', 'native':'Lek', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'11408', 'max_amount':'114088432'}, 'AMD':{'code':'AMD', 'title':'Armenian Dram', 'symbol':'AMD', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'41129', 'max_amount':'411293180'}, 'ARS':{'code':'ARS', 'title':'Argentine Peso', 'symbol':'ARS', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'12503', 'max_amount':'125036607'}, 'AUD':{'code':'AUD', 'title':'Australian Dollar', 'symbol':'AU$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'145', 'max_amount':'1451625'}, 'AZN':{'code':'AZN', 'title':'Azerbaijani Manat', 'symbol':'AZN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'171', 'max_amount':'1711164'}, 'BAM':{'code':'BAM', 'title':'Bosnia & Herzegovina Convertible Mark', 'symbol':'BAM', 'native':'KM', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'187', 'max_amount':'1873042'}, 'BDT':{'code':'BDT', 'title':'Bangladeshi Taka', 'symbol':'BDT', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'9415', 'max_amount':'94154281'}, 'BGN':{'code':'BGN', 'title':'Bulgarian Lev', 'symbol':'BGN', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'186', 'max_amount':'1869710'}, 'BND':{'code':'BND', 'title':'Brunei Dollar', 'symbol':'BND', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1399458'}, 'BOB':{'code':'BOB', 'title':'Bolivian Boliviano', 'symbol':'BOB', 'native':'Bs', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'692', 'max_amount':'6926834'}, 'BRL':{'code':'BRL', 'title':'Brazilian Real', 'symbol':'R$', 'native':'R$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'518', 'max_amount':'5182986'}, 'CAD':{'code':'CAD', 'title':'Canadian Dollar', 'symbol':'CA$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'129', 'max_amount':'1290450'}, 'CHF':{'code':'CHF', 'title':'Swiss Franc', 'symbol':'CHF', 'native':'CHF', 'thousands_sep':'\\'', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'954630'}, 'CLP':{'code':'CLP', 'title':'Chilean Peso', 'symbol':'CLP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'926', 'max_amount':'9268013'}, 'CNY':{'code':'CNY', 'title':'Chinese Renminbi Yuan', 'symbol':'CN', 'native':'CN', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'669', 'max_amount':'6692902'}, 'COP':{'code':'COP', 'title':'Colombian Peso', 'symbol':'COP', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'410927', 'max_amount':'4109270000'}, 'CRC':{'code':'CRC', 'title':'Costa Rican Coln', 'symbol':'CRC', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'69166', 'max_amount':'691668622'}, 'CZK':{'code':'CZK', 'title':'Czech Koruna', 'symbol':'CZK', 'native':'K', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'2367', 'max_amount':'23674601'}, 'DKK':{'code':'DKK', 'title':'Danish Krone', 'symbol':'DKK', 'native':'kr', 'thousands_sep':'', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'712', 'max_amount':'7120540'}, 'DOP':{'code':'DOP', 'title':'Dominican Peso', 'symbol':'DOP', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5497', 'max_amount':'54971796'}, 'DZD':{'code':'DZD', 'title':'Algerian Dinar', 'symbol':'DZD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'14655', 'max_amount':'146557782'}, 'EGP':{'code':'EGP', 'title':'Egyptian Pound', 'symbol':'EGP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1879', 'max_amount':'18794601'}, 'EUR':{'code':'EUR', 'title':'Euro', 'symbol':'', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'95', 'max_amount':'957150'}, 'GBP':{'code':'GBP', 'title':'British Pound', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'82', 'max_amount':'822531'}, 'GEL':{'code':'GEL', 'title':'Georgian Lari', 'symbol':'GEL', 'native':'GEL', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'293', 'max_amount':'2939866'}, 'GTQ':{'code':'GTQ', 'title':'Guatemalan Quetzal', 'symbol':'GTQ', 'native':'Q', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'781', 'max_amount':'7811180'}, 'HKD':{'code':'HKD', 'title':'Hong Kong Dollar', 'symbol':'HK$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'784', 'max_amount':'7845675'}, 'HNL':{'code':'HNL', 'title':'Honduran Lempira', 'symbol':'HNL', 'native':'L', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'2476', 'max_amount':'24763692'}, 'HRK':{'code':'HRK', 'title':'Croatian Kuna', 'symbol':'HRK', 'native':'kn', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'721', 'max_amount':'7210988'}, 'HUF':{'code':'HUF', 'title':'Hungarian Forint', 'symbol':'HUF', 'native':'Ft', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'37819', 'max_amount':'378197939'}, 'IDR':{'code':'IDR', 'title':'Indonesian Rupiah', 'symbol':'IDR', 'native':'Rp', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'1490695', 'max_amount':'14906950000'}, 'ILS':{'code':'ILS', 'title':'Israeli New Sheqel', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'348', 'max_amount':'3480155'}, 'INR':{'code':'INR', 'title':'Indian Rupee', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'7894', 'max_amount':'78945050'}, 'ISK':{'code':'ISK', 'title':'Icelandic Krna', 'symbol':'ISK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'133', 'max_amount':'1336303'}, 'JMD':{'code':'JMD', 'title':'Jamaican Dollar', 'symbol':'JMD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'15175', 'max_amount':'151753529'}, 'JPY':{'code':'JPY', 'title':'Japanese Yen', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'136', 'max_amount':'1362010'}, 'KES':{'code':'KES', 'title':'Kenyan Shilling', 'symbol':'KES', 'native':'Ksh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'11787', 'max_amount':'117879251'}, 'KGS':{'code':'KGS', 'title':'Kyrgyzstani Som', 'symbol':'KGS', 'native':'KGS', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'7950', 'max_amount':'79509472'}, 'KRW':{'code':'KRW', 'title':'South Korean Won', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'1297', 'max_amount':'12971249'}, 'KZT':{'code':'KZT', 'title':'Kazakhstani Tenge', 'symbol':'KZT', 'native':'', 'thousands_sep':' ', 'decimal_sep':'-', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'47177', 'max_amount':'471777437'}, 'LBP':{'code':'LBP', 'title':'Lebanese Pound', 'symbol':'LBP', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'152338', 'max_amount':'1523381760'}, 'LKR':{'code':'LKR', 'title':'Sri Lankan Rupee', 'symbol':'LKR', 'native':'.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'36271', 'max_amount':'362713465'}, 'MAD':{'code':'MAD', 'title':'Moroccan Dirham', 'symbol':'MAD', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1018', 'max_amount':'10188182'}, 'MDL':{'code':'MDL', 'title':'Moldovan Leu', 'symbol':'MDL', 'native':'MDL', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1928', 'max_amount':'19284237'}, 'MNT':{'code':'MNT', 'title':'Mongolian Tgrg', 'symbol':'MNT', 'native':'MNT', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'312408', 'max_amount':'3124087599'}, 'MUR':{'code':'MUR', 'title':'Mauritian Rupee', 'symbol':'MUR', 'native':'MUR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'4614', 'max_amount':'46144273'}, 'MVR':{'code':'MVR', 'title':'Maldivian Rufiyaa', 'symbol':'MVR', 'native':'MVR', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1534', 'max_amount':'15349670'}, 'MXN':{'code':'MXN', 'title':'Mexican Peso', 'symbol':'MX$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2015', 'max_amount':'20158770'}, 'MYR':{'code':'MYR', 'title':'Malaysian Ringgit', 'symbol':'MYR', 'native':'RM', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'440', 'max_amount':'4406499'}, 'MZN':{'code':'MZN', 'title':'Mozambican Metical', 'symbol':'MZN', 'native':'MTn', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'6383', 'max_amount':'63830365'}, 'NGN':{'code':'NGN', 'title':'Nigerian Naira', 'symbol':'NGN', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'41513', 'max_amount':'415132815'}, 'NIO':{'code':'NIO', 'title':'Nicaraguan Crdoba', 'symbol':'NIO', 'native':'C$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3612', 'max_amount':'36125609'}, 'NOK':{'code':'NOK', 'title':'Norwegian Krone', 'symbol':'NOK', 'native':'kr', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'990', 'max_amount':'9902585'}, 'NPR':{'code':'NPR', 'title':'Nepalese Rupee', 'symbol':'NPR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'12731', 'max_amount':'127318435'}, 'NZD':{'code':'NZD', 'title':'New Zealand Dollar', 'symbol':'NZ$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'160', 'max_amount':'1603695'}, 'PAB':{'code':'PAB', 'title':'Panamanian Balboa', 'symbol':'PAB', 'native':'B\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'100', 'max_amount':'1007566'}, 'PEN':{'code':'PEN', 'title':'Peruvian Nuevo Sol', 'symbol':'PEN', 'native':'S\\/.', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'381', 'max_amount':'3818809'}, 'PHP':{'code':'PHP', 'title':'Philippine Peso', 'symbol':'PHP', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'5499', 'max_amount':'54994501'}, 'PKR':{'code':'PKR', 'title':'Pakistani Rupee', 'symbol':'PKR', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'20651', 'max_amount':'206515440'}, 'PLN':{'code':'PLN', 'title':'Polish Zoty', 'symbol':'PLN', 'native':'z', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'446', 'max_amount':'4466920'}, 'PYG':{'code':'PYG', 'title':'Paraguayan Guaran', 'symbol':'PYG', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':0, 'min_amount':'6909', 'max_amount':'69095662'}, 'QAR':{'code':'QAR', 'title':'Qatari Riyal', 'symbol':'QAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'364', 'max_amount':'3640988'}, 'RON':{'code':'RON', 'title':'Romanian Leu', 'symbol':'RON', 'native':'RON', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'473', 'max_amount':'4736501'}, 'RSD':{'code':'RSD', 'title':'Serbian Dinar', 'symbol':'RSD', 'native':'.', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'11252', 'max_amount':'112520089'}, 'RUB':{'code':'RUB', 'title':'Russian Ruble', 'symbol':'RUB', 'native':'.', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'5282', 'max_amount':'52825030'}, 'SAR':{'code':'SAR', 'title':'Saudi Riyal', 'symbol':'SAR', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'375', 'max_amount':'3752099'}, 'SEK':{'code':'SEK', 'title':'Swedish Krona', 'symbol':'SEK', 'native':'kr', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1022', 'max_amount':'10224070'}, 'SGD':{'code':'SGD', 'title':'Singapore Dollar', 'symbol':'SGD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'139', 'max_amount':'1390698'}, 'THB':{'code':'THB', 'title':'Thai Baht', 'symbol':'', 'native':'', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'3529', 'max_amount':'35290499'}, 'TJS':{'code':'TJS', 'title':'Tajikistani Somoni', 'symbol':'TJS', 'native':'TJS', 'thousands_sep':' ', 'decimal_sep':';', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'977', 'max_amount':'9773409'}, 'TRY':{'code':'TRY', 'title':'Turkish Lira', 'symbol':'TRY', 'native':'TL', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1667', 'max_amount':'16673549'}, 'TTD':{'code':'TTD', 'title':'Trinidad and Tobago Dollar', 'symbol':'TTD', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'684', 'max_amount':'6847347'}, 'TWD':{'code':'TWD', 'title':'New Taiwan Dollar', 'symbol':'NT$', 'native':'NT$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'2973', 'max_amount':'29735499'}, 'TZS':{'code':'TZS', 'title':'Tanzanian Shilling', 'symbol':'TZS', 'native':'TSh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'233200', 'max_amount':'2332000087'}, 'UAH':{'code':'UAH', 'title':'Ukrainian Hryvnia', 'symbol':'UAH', 'native':'', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':false, 'exp':2, 'min_amount':'2974', 'max_amount':'29741945'}, 'UGX':{'code':'UGX', 'title':'Ugandan Shilling', 'symbol':'UGX', 'native':'USh', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':0, 'min_amount':'3788', 'max_amount':'37883728'}, 'USD':{'code':'USD', 'title':'United States Dollar', 'symbol':'$', 'native':'$', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':false, 'exp':2, 'min_amount':'100', 'max_amount':1000000}, 'UYU':{'code':'UYU', 'title':'Uruguayan Peso', 'symbol':'UYU', 'native':'$', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'3979', 'max_amount':'39794286'}, 'UZS':{'code':'UZS', 'title':'Uzbekistani Som', 'symbol':'UZS', 'native':'UZS', 'thousands_sep':' ', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':2, 'min_amount':'1094209', 'max_amount':'10942099215'}, 'VND':{'code':'VND', 'title':'Vietnamese ng', 'symbol':'', 'native':'', 'thousands_sep':'.', 'decimal_sep':',', 'symbol_left':false, 'space_between':true, 'exp':0, 'min_amount':'23270', 'max_amount':'232700000'}, 'YER':{'code':'YER', 'title':'Yemeni Rial', 'symbol':'YER', 'native':'..', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'25024', 'max_amount':'250249914'}, 'ZAR':{'code':'ZAR', 'title':'South African Rand', 'symbol':'ZAR', 'native':'R', 'thousands_sep':',', 'decimal_sep':'.', 'symbol_left':true, 'space_between':true, 'exp':2, 'min_amount':'1624', 'max_amount':'16246189'}};\n\nexport default Currencies;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../environment/emojiVersionsSupport';\n\nexport const EmojiVersions: {[version in EMOJI_VERSION]: {[emoji: string]: number}} = {'14':{'1f6dd':4867, '1f6de':4916, '1f6df':4923, '1f7f0':62832, '1f979':183, '1f9cc':1557, '1fa7b':61332, '1fa7c':61330, '1faa9':51093, '1faaa':61364, '1faab':61189, '1faac':51085, '1fab7':2651, '1fab8':2631, '1fab9':2672, '1faba':2673, '1fac3':1520, '1fac4':1521, '1fac5':1505, '1fad7':3793, '1fad8':3707, '1fad9':3804, '1fae0':111, '1fae1':136, '1fae2':132, '1fae3':133, '1fae4':174, '1fae5':142, '1fae6':1385, '1fae7':61353, '1faf0':1341, '1faf1':1332, '1faf2':1333, '1faf3':1334, '1faf4':1335, '1faf5':1351, '1faf6':1360, '1faf1-1f3fb-200d-1faf2-1f3fc':0, '1faf1-1f3fb-200d-1faf2-1f3fd':0, '1faf1-1f3fb-200d-1faf2-1f3fe':0, '1faf1-1f3fb-200d-1faf2-1f3ff':0, '1faf1-1f3fc-200d-1faf2-1f3fb':0, '1faf1-1f3fc-200d-1faf2-1f3fd':0, '1faf1-1f3fc-200d-1faf2-1f3fe':0, '1faf1-1f3fc-200d-1faf2-1f3ff':0, '1faf1-1f3fd-200d-1faf2-1f3fb':0, '1faf1-1f3fd-200d-1faf2-1f3fc':0, '1faf1-1f3fd-200d-1faf2-1f3fe':0, '1faf1-1f3fd-200d-1faf2-1f3ff':0, '1faf1-1f3fe-200d-1faf2-1f3fb':0, '1faf1-1f3fe-200d-1faf2-1f3fc':0, '1faf1-1f3fe-200d-1faf2-1f3fd':0, '1faf1-1f3fe-200d-1faf2-1f3ff':0, '1faf1-1f3ff-200d-1faf2-1f3fb':0, '1faf1-1f3ff-200d-1faf2-1f3fc':0, '1faf1-1f3ff-200d-1faf2-1f3fd':0, '1faf1-1f3ff-200d-1faf2-1f3fe':0, '1fac3-1f3fb':0, '1fac3-1f3fc':0, '1fac3-1f3fd':0, '1fac3-1f3fe':0, '1fac3-1f3ff':0, '1fac4-1f3fb':0, '1fac4-1f3fc':0, '1fac4-1f3fd':0, '1fac4-1f3fe':0, '1fac4-1f3ff':0, '1fac5-1f3fb':0, '1fac5-1f3fc':0, '1fac5-1f3fd':0, '1fac5-1f3fe':0, '1fac5-1f3ff':0, '1faf0-1f3fb':0, '1faf0-1f3fc':0, '1faf0-1f3fd':0, '1faf0-1f3fe':0, '1faf0-1f3ff':0, '1faf1-1f3fb':0, '1faf1-1f3fc':0, '1faf1-1f3fd':0, '1faf1-1f3fe':0, '1faf1-1f3ff':0, '1faf2-1f3fb':0, '1faf2-1f3fc':0, '1faf2-1f3fd':0, '1faf2-1f3fe':0, '1faf2-1f3ff':0, '1faf3-1f3fb':0, '1faf3-1f3fc':0, '1faf3-1f3fd':0, '1faf3-1f3fe':0, '1faf3-1f3ff':0, '1faf4-1f3fb':0, '1faf4-1f3fc':0, '1faf4-1f3fd':0, '1faf4-1f3fe':0, '1faf4-1f3ff':0, '1faf5-1f3fb':0, '1faf5-1f3fc':0, '1faf5-1f3fd':0, '1faf5-1f3fe':0, '1faf5-1f3ff':0, '1faf6-1f3fb':0, '1faf6-1f3fc':0, '1faf6-1f3fd':0, '1faf6-1f3fe':0, '1faf6-1f3ff':0}, '':{'2049':62835, '2122':62863, '2139':62888, '2194':62764, '2195':62763, '2196':62762, '2197':62756, '2198':62758, '2199':62760, '2328':61194, '2600':4990, '2601':4998, '2602':41013, '2603':41018, '2604':41020, '2611':62851, '2614':41014, '2615':3781, '2618':2667, '2620':1106, '2622':62753, '2623':62754, '2626':62783, '2638':62780, '2639':177, '2648':62788, '2649':62789, '2650':62796, '2651':62797, '2652':62798, '2653':62799, '2660':51095, '2663':51098, '2665':51096, '2666':51097, '2668':4865, '2692':61297, '2693':4922, '2694':61300, '2696':61311, '2697':61319, '2699':61309, '2702':61284, '2705':62850, '2708':4931, '2709':61245, '2712':61259, '2714':62852, '2716':62828, '2721':62779, '2728':51029, '2733':62858, '2734':62859, '2744':41017, '2747':62860, '2753':62836, '2754':62837, '2755':62838, '2757':62839, '2763':1137, '2764':1141, '2795':62829, '2796':62830, '2797':62831, '2934':62767, '2935':62768, '3030':62840, '3297':62912, '3299':62913, '0023-20e3':62864, '002a-20e3':62865, '0030-20e3':62866, '0031-20e3':62867, '0032-20e3':62868, '0033-20e3':62869, '0034-20e3':62870, '0035-20e3':62871, '0036-20e3':62872, '0037-20e3':62873, '0038-20e3':62874, '0039-20e3':62875, '00a9':62861, '00ae':62862, '1f004':51101, '1f0cf':51100, '1f170':62882, '1f171':62884, '1f17e':62893, '1f17f':62895, '1f18e':62883, '1f191':62885, '1f192':62886, '1f193':62887, '1f194':62889, '1f195':62891, '1f196':62892, '1f197':62894, '1f198':62896, '1f199':62897, '1f19a':62898, '1f1e6-1f1e8':71594, '1f1e6-1f1e9':71595, '1f1e6-1f1ea':71596, '1f1e6-1f1eb':71597, '1f1e6-1f1ec':71598, '1f1e6-1f1ee':71599, '1f1e6-1f1f1':71600, '1f1e6-1f1f2':71601, '1f1e6-1f1f4':71602, '1f1e6-1f1f6':71603, '1f1e6-1f1f7':71604, '1f1e6-1f1f8':71605, '1f1e6-1f1f9':71606, '1f1e6-1f1fa':71607, '1f1e6-1f1fc':71608, '1f1e6-1f1fd':71609, '1f1e6-1f1ff':71610, '1f1e7-1f1e6':71611, '1f1e7-1f1e7':71612, '1f1e7-1f1e9':71613, '1f1e7-1f1ea':71614, '1f1e7-1f1eb':71615, '1f1e7-1f1ec':71616, '1f1e7-1f1ed':71617, '1f1e7-1f1ee':71618, '1f1e7-1f1ef':71619, '1f1e7-1f1f1':71620, '1f1e7-1f1f2':71621, '1f1e7-1f1f3':71622, '1f1e7-1f1f4':71623, '1f1e7-1f1f6':71624, '1f1e7-1f1f7':71625, '1f1e7-1f1f8':71626, '1f1e7-1f1f9':71627, '1f1e7-1f1fb':71628, '1f1e7-1f1fc':71629, '1f1e7-1f1fe':71630, '1f1e7-1f1ff':71631, '1f1e8-1f1e6':71632, '1f1e8-1f1e8':71633, '1f1e8-1f1e9':71634, '1f1e8-1f1eb':71635, '1f1e8-1f1ec':71636, '1f1e8-1f1ed':71637, '1f1e8-1f1ee':71638, '1f1e8-1f1f0':71639, '1f1e8-1f1f1':71640, '1f1e8-1f1f2':71641, '1f1e8-1f1f3':71642, '1f1e8-1f1f4':71643, '1f1e8-1f1f5':71644, '1f1e8-1f1f7':71645, '1f1e8-1f1fa':71646, '1f1e8-1f1fb':71647, '1f1e8-1f1fc':71648, '1f1e8-1f1fd':71649, '1f1e8-1f1fe':71650, '1f1e8-1f1ff':71651, '1f1e9-1f1ea':71652, '1f1e9-1f1ec':71653, '1f1e9-1f1ef':71654, '1f1e9-1f1f0':71655, '1f1e9-1f1f2':71656, '1f1e9-1f1f4':71657, '1f1e9-1f1ff':71658, '1f1ea-1f1e6':71659, '1f1ea-1f1e8':71660, '1f1ea-1f1ea':71661, '1f1ea-1f1ec':71662, '1f1ea-1f1ed':71663, '1f1ea-1f1f7':71664, '1f1ea-1f1f8':71665, '1f1ea-1f1f9':71666, '1f1ea-1f1fa':71667, '1f1eb-1f1ee':71668, '1f1eb-1f1ef':71669, '1f1eb-1f1f0':71670, '1f1eb-1f1f2':71671, '1f1eb-1f1f4':71672, '1f1eb-1f1f7':71673, '1f1ec-1f1e6':71674, '1f1ec-1f1e7':71675, '1f1ec-1f1e9':71676, '1f1ec-1f1ea':71677, '1f1ec-1f1eb':71678, '1f1ec-1f1ec':71679, '1f1ec-1f1ed':71680, '1f1ec-1f1ee':71681, '1f1ec-1f1f1':71682, '1f1ec-1f1f2':71683, '1f1ec-1f1f3':71684, '1f1ec-1f1f5':71685, '1f1ec-1f1f6':71686, '1f1ec-1f1f7':71687, '1f1ec-1f1f8':71688, '1f1ec-1f1f9':71689, '1f1ec-1f1fa':71690, '1f1ec-1f1fc':71691, '1f1ec-1f1fe':71692, '1f1ed-1f1f0':71693, '1f1ed-1f1f2':71694, '1f1ed-1f1f3':71695, '1f1ed-1f1f7':71696, '1f1ed-1f1f9':71697, '1f1ed-1f1fa':71698, '1f1ee-1f1e8':71699, '1f1ee-1f1e9':71700, '1f1ee-1f1ea':71701, '1f1ee-1f1f1':71702, '1f1ee-1f1f2':71703, '1f1ee-1f1f3':71704, '1f1ee-1f1f4':71705, '1f1ee-1f1f6':71706, '1f1ee-1f1f7':71707, '1f1ee-1f1f8':71708, '1f1ee-1f1f9':71709, '1f1ef-1f1ea':71710, '1f1ef-1f1f2':71711, '1f1ef-1f1f4':71712, '1f1ef-1f1f5':71713, '1f1f0-1f1ea':71714, '1f1f0-1f1ec':71715, '1f1f0-1f1ed':71716, '1f1f0-1f1ee':71717, '1f1f0-1f1f2':71718, '1f1f0-1f1f3':71719, '1f1f0-1f1f5':71720, '1f1f0-1f1f7':71721, '1f1f0-1f1fc':71722, '1f1f0-1f1fe':71723, '1f1f0-1f1ff':71724, '1f1f1-1f1e6':71725, '1f1f1-1f1e7':71726, '1f1f1-1f1e8':71727, '1f1f1-1f1ee':71728, '1f1f1-1f1f0':71729, '1f1f1-1f1f7':71730, '1f1f1-1f1f8':71731, '1f1f1-1f1f9':71732, '1f1f1-1f1fa':71733, '1f1f1-1f1fb':71734, '1f1f1-1f1fe':71735, '1f1f2-1f1e6':71736, '1f1f2-1f1e8':71737, '1f1f2-1f1e9':71738, '1f1f2-1f1ea':71739, '1f1f2-1f1eb':71740, '1f1f2-1f1ec':71741, '1f1f2-1f1ed':71742, '1f1f2-1f1f0':71743, '1f1f2-1f1f1':71744, '1f1f2-1f1f2':71745, '1f1f2-1f1f3':71746, '1f1f2-1f1f4':71747, '1f1f2-1f1f5':71748, '1f1f2-1f1f6':71749, '1f1f2-1f1f7':71750, '1f1f2-1f1f8':71751, '1f1f2-1f1f9':71752, '1f1f2-1f1fa':71753, '1f1f2-1f1fb':71754, '1f1f2-1f1fc':71755, '1f1f2-1f1fd':71756, '1f1f2-1f1fe':71757, '1f1f2-1f1ff':71758, '1f1f3-1f1e6':71759, '1f1f3-1f1e8':71760, '1f1f3-1f1ea':71761, '1f1f3-1f1eb':71762, '1f1f3-1f1ec':71763, '1f1f3-1f1ee':71764, '1f1f3-1f1f1':71765, '1f1f3-1f1f4':71766, '1f1f3-1f1f5':71767, '1f1f3-1f1f7':71768, '1f1f3-1f1fa':71769, '1f1f3-1f1ff':71770, '1f1f4-1f1f2':71771, '1f1f5-1f1e6':71772, '1f1f5-1f1ea':71773, '1f1f5-1f1eb':71774, '1f1f5-1f1ec':71775, '1f1f5-1f1ed':71776, '1f1f5-1f1f0':71777, '1f1f5-1f1f1':71778, '1f1f5-1f1f2':71779, '1f1f5-1f1f3':71780, '1f1f5-1f1f7':71781, '1f1f5-1f1f8':71782, '1f1f5-1f1f9':71783, '1f1f5-1f1fc':71784, '1f1f5-1f1fe':71785, '1f1f6-1f1e6':71786, '1f1f7-1f1ea':71787, '1f1f7-1f1f4':71788, '1f1f7-1f1f8':71789, '1f1f7-1f1fa':71790, '1f1f7-1f1fc':71791, '1f1f8-1f1e6':71792, '1f1f8-1f1e7':71793, '1f1f8-1f1e8':71794, '1f1f8-1f1e9':71795, '1f1f8-1f1ea':71796, '1f1f8-1f1ec':71797, '1f1f8-1f1ed':71798, '1f1f8-1f1ee':71799, '1f1f8-1f1ef':71800, '1f1f8-1f1f0':71801, '1f1f8-1f1f1':71802, '1f1f8-1f1f2':71803, '1f1f8-1f1f3':71804, '1f1f8-1f1f4':71805, '1f1f8-1f1f7':71806, '1f1f8-1f1f8':71807, '1f1f8-1f1f9':71808, '1f1f8-1f1fb':71809, '1f1f8-1f1fd':71810, '1f1f8-1f1fe':71811, '1f1f8-1f1ff':71812, '1f1f9-1f1e6':71813, '1f1f9-1f1e8':71814, '1f1f9-1f1e9':71815, '1f1f9-1f1eb':71816, '1f1f9-1f1ec':71817, '1f1f9-1f1ed':71818, '1f1f9-1f1ef':71819, '1f1f9-1f1f0':71820, '1f1f9-1f1f1':71821, '1f1f9-1f1f2':71822, '1f1f9-1f1f3':71823, '1f1f9-1f1f4':71824, '1f1f9-1f1f7':71825, '1f1f9-1f1f9':71826, '1f1f9-1f1fb':71827, '1f1f9-1f1fc':71828, '1f1f9-1f1ff':71829, '1f1fa-1f1e6':71830, '1f1fa-1f1ec':71831, '1f1fa-1f1f2':71832, '1f1fa-1f1f3':71833, '1f1fa-1f1f8':71834, '1f1fa-1f1fe':71835, '1f1fa-1f1ff':71836, '1f1fb-1f1e6':71837, '1f1fb-1f1e8':71838, '1f1fb-1f1ea':71839, '1f1fb-1f1ec':71840, '1f1fb-1f1ee':71841, '1f1fb-1f1f3':71842, '1f1fb-1f1fa':71843, '1f1fc-1f1eb':71844, '1f1fc-1f1f8':71845, '1f1fd-1f1f0':71846, '1f1fe-1f1ea':71847, '1f1fe-1f1f9':71848, '1f1ff-1f1e6':71849, '1f1ff-1f1f2':71850, '1f1ff-1f1fc':71851, '1f201':62899, '1f202':62900, '1f21a':62906, '1f22f':62903, '1f232':62907, '1f233':62911, '1f234':62910, '1f235':62915, '1f236':62902, '1f237':62901, '1f238':62909, '1f239':62905, '1f23a':62914, '1f250':62904, '1f251':62908, '1f300':41010, '1f301':4857, '1f302':41012, '1f303':4858, '1f304':4860, '1f305':4861, '1f306':4862, '1f307':4863, '1f308':41011, '1f309':4864, '1f30a':41023, '1f30b':4815, '1f30c':4997, '1f30d':4806, '1f30e':4807, '1f30f':4808, '1f310':4809, '1f311':4977, '1f312':4978, '1f313':4979, '1f314':4980, '1f315':4981, '1f316':4982, '1f317':4983, '1f318':4984, '1f319':4985, '1f31a':4986, '1f31b':4987, '1f31c':4988, '1f31d':4991, '1f31e':4992, '1f31f':4995, '1f320':4996, '1f321':4989, '1f324':41001, '1f325':41002, '1f326':41003, '1f327':41004, '1f328':41005, '1f329':41006, '1f32a':41007, '1f32b':41008, '1f32c':41009, '1f32d':3725, '1f32e':3727, '1f32f':3728, '1f330':3708, '1f331':2659, '1f332':2661, '1f333':2662, '1f334':2663, '1f335':2664, '1f336':3698, '1f337':2658, '1f338':2649, '1f339':2653, '1f33a':2655, '1f33b':2656, '1f33c':2657, '1f33d':3697, '1f33e':2665, '1f33f':2666, '1f340':2668, '1f341':2669, '1f342':2670, '1f343':2671, '1f344':3705, '1f345':3690, '1f346':3694, '1f347':3674, '1f348':3675, '1f349':3676, '1f34a':3677, '1f34b':3678, '1f34c':3679, '1f34d':3680, '1f34e':3682, '1f34f':3683, '1f350':3684, '1f351':3685, '1f352':3686, '1f353':3687, '1f354':3722, '1f355':3724, '1f356':3718, '1f357':3719, '1f358':3744, '1f359':3745, '1f35a':3746, '1f35b':3747, '1f35c':3748, '1f35d':3749, '1f35e':3709, '1f35f':3723, '1f360':3750, '1f361':3756, '1f362':3751, '1f363':3752, '1f364':3753, '1f365':3754, '1f366':3765, '1f367':3766, '1f368':3767, '1f369':3768, '1f36a':3769, '1f36b':3774, '1f36c':3775, '1f36d':3776, '1f36e':3777, '1f36f':3778, '1f370':3771, '1f371':3743, '1f372':3735, '1f373':3733, '1f374':3801, '1f375':3783, '1f376':3784, '1f377':3786, '1f378':3787, '1f379':3788, '1f37a':3789, '1f37b':3790, '1f37c':3779, '1f37d':3800, '1f37e':3785, '1f37f':3739, '1f380':51040, '1f381':51041, '1f382':3770, '1f383':51024, '1f384':51025, '1f385':1527, '1f386':51026, '1f387':51027, '1f388':51030, '1f389':51031, '1f38a':51032, '1f38b':51033, '1f38c':71588, '1f38d':51034, '1f38e':51035, '1f38f':51036, '1f390':51037, '1f391':51038, '1f392':61134, '1f393':61147, '1f396':51045, '1f397':51042, '1f399':61167, '1f39a':61168, '1f39b':61169, '1f39e':61203, '1f39f':51043, '1f3a0':4866, '1f3a1':4868, '1f3a2':4869, '1f3a3':51072, '1f3a4':61170, '1f3a5':61202, '1f3a6':62819, '1f3a7':61171, '1f3a8':51105, '1f3a9':61146, '1f3aa':4871, '1f3ab':51044, '1f3ac':61205, '1f3ad':51103, '1f3ae':51086, '1f3af':51078, '1f3b0':51088, '1f3b1':51081, '1f3b2':51089, '1f3b3':51060, '1f3b4':51102, '1f3b5':61165, '1f3b6':61166, '1f3b7':61173, '1f3b8':61175, '1f3b9':61176, '1f3ba':61177, '1f3bb':61178, '1f3bc':61164, '1f3bd':51074, '1f3be':51058, '1f3bf':51075, '1f3c0':51054, '1f3c1':71586, '1f3c2':1600, '1f3c3-200d-2640':1584, '1f3c3-200d-2642':1583, '1f3c3':1582, '1f3c4-200d-2640':1606, '1f3c4-200d-2642':1605, '1f3c4':1604, '1f3c5':51047, '1f3c6':51046, '1f3c7':1598, '1f3c8':51056, '1f3c9':51057, '1f3ca-200d-2640':1612, '1f3ca-200d-2642':1611, '1f3ca':1610, '1f3cb-200d-2640':1618, '1f3cb-200d-2642':1617, '1f3cb':1616, '1f3cc-200d-2640':1603, '1f3cc-200d-2642':1602, '1f3cc':1601, '1f3cd':4902, '1f3ce':4901, '1f3cf':51061, '1f3d0':51055, '1f3d1':51062, '1f3d2':51063, '1f3d3':51065, '1f3d4':4813, '1f3d5':4817, '1f3d6':4818, '1f3d7':4824, '1f3d8':4829, '1f3d9':4859, '1f3da':4830, '1f3db':4823, '1f3dc':4819, '1f3dd':4820, '1f3de':4821, '1f3df':4822, '1f3e0':4831, '1f3e1':4832, '1f3e2':4833, '1f3e3':4834, '1f3e4':4835, '1f3e5':4836, '1f3e6':4837, '1f3e7':62729, '1f3e8':4838, '1f3e9':4839, '1f3ea':4840, '1f3eb':4841, '1f3ec':4842, '1f3ed':4843, '1f3ee':61216, '1f3ef':4844, '1f3f0':4845, '1f3f3-200d-1f308':71591, '1f3f3-200d-26a7':71592, '1f3f3':71590, '1f3f4-200d-2620':71593, '1f3f4-e0067-e0062-e0065-e006e-e0067-e007f':71852, '1f3f4-e0067-e0062-e0073-e0063-e0074-e007f':71853, '1f3f4-e0067-e0062-e0077-e006c-e0073-e007f':71854, '1f3f4':71589, '1f3f5':2652, '1f3f7':61234, '1f3f8':51066, '1f3f9':61303, '1f3fa':3805, '1f3fb':9525, '1f3fc':9526, '1f3fd':9527, '1f3fe':9528, '1f3ff':9529, '1f400':2576, '1f401':2575, '1f402':2556, '1f403':2557, '1f404':2558, '1f405':2547, '1f406':2548, '1f407':2579, '1f408-200d-2b1b':2544, '1f408':2543, '1f409':2618, '1f40a':2613, '1f40b':2622, '1f40c':2632, '1f40d':2616, '1f40e':2550, '1f40f':2563, '1f410':2565, '1f411':2564, '1f412':2531, '1f413':2596, '1f414':2595, '1f415-200d-1f9ba':2537, '1f415':2535, '1f416':2560, '1f417':2561, '1f418':2570, '1f419':2629, '1f41a':2630, '1f41b':2634, '1f41c':2635, '1f41d':2636, '1f41e':2638, '1f41f':2625, '1f420':2626, '1f421':2627, '1f422':2614, '1f423':2597, '1f424':2598, '1f425':2599, '1f426':2600, '1f427':2601, '1f428':2586, '1f429':2538, '1f42a':2566, '1f42b':2567, '1f42c':2623, '1f42d':2574, '1f42e':2555, '1f42f':2546, '1f430':2578, '1f431':2542, '1f432':2617, '1f433':2621, '1f434':2549, '1f435':2530, '1f436':2534, '1f437':2559, '1f438':2612, '1f439':2577, '1f43a':2539, '1f43b-200d-2744':2585, '1f43b':2584, '1f43c':2587, '1f43d':2562, '1f43e':2593, '1f43f':2580, '1f440':1381, '1f441-200d-1f5e8':1159, '1f441':1382, '1f442':1373, '1f443':1375, '1f444':1384, '1f445':1383, '1f446':1347, '1f447':1349, '1f448':1345, '1f449':1346, '1f44a':1355, '1f44b':1327, '1f44c':1336, '1f44d':1352, '1f44e':1353, '1f44f':1358, '1f450':1361, '1f451':61144, '1f452':61145, '1f453':61110, '1f454':61115, '1f455':61116, '1f456':61117, '1f457':61122, '1f458':61123, '1f459':61128, '1f45a':61129, '1f45b':61130, '1f45c':61131, '1f45d':61132, '1f45e':61136, '1f45f':61137, '1f460':61140, '1f461':61141, '1f462':61143, '1f463':1687, '1f464':1684, '1f465':1685, '1f466':1388, '1f467':1389, '1f468-200d-1f33e':1457, '1f468-200d-1f373':1460, '1f468-200d-1f37c':1524, '1f468-200d-1f393':1448, '1f468-200d-1f3a4':1478, '1f468-200d-1f3a8':1481, '1f468-200d-1f3eb':1451, '1f468-200d-1f3ed':1466, '1f468-200d-1f466-200d-1f466':1674, '1f468-200d-1f466':1673, '1f468-200d-1f467-200d-1f466':1676, '1f468-200d-1f467-200d-1f467':1677, '1f468-200d-1f467':1675, '1f468-200d-1f468-200d-1f466':1663, '1f468-200d-1f468-200d-1f466-200d-1f466':1666, '1f468-200d-1f468-200d-1f467':1664, '1f468-200d-1f468-200d-1f467-200d-1f466':1665, '1f468-200d-1f468-200d-1f467-200d-1f467':1667, '1f468-200d-1f469-200d-1f466':1658, '1f468-200d-1f469-200d-1f466-200d-1f466':1661, '1f468-200d-1f469-200d-1f467':1659, '1f468-200d-1f469-200d-1f467-200d-1f466':1660, '1f468-200d-1f469-200d-1f467-200d-1f467':1662, '1f468-200d-1f4bb':1475, '1f468-200d-1f4bc':1469, '1f468-200d-1f527':1463, '1f468-200d-1f52c':1472, '1f468-200d-1f680':1487, '1f468-200d-1f692':1490, '1f468-200d-1f9af':1574, '1f468-200d-1f9b0':1396, '1f468-200d-1f9b1':1397, '1f468-200d-1f9b2':1399, '1f468-200d-1f9b3':1398, '1f468-200d-1f9bc':1577, '1f468-200d-1f9bd':1580, '1f468-200d-2695':1445, '1f468-200d-2696':1454, '1f468-200d-2708':1484, '1f468-200d-2764-200d-1f468':1655, '1f468-200d-2764-200d-1f48b-200d-1f468':1651, '1f468':1392, '1f469-200d-1f33e':1458, '1f469-200d-1f373':1461, '1f469-200d-1f37c':1523, '1f469-200d-1f393':1449, '1f469-200d-1f3a4':1479, '1f469-200d-1f3a8':1482, '1f469-200d-1f3eb':1452, '1f469-200d-1f3ed':1467, '1f469-200d-1f466-200d-1f466':1679, '1f469-200d-1f466':1678, '1f469-200d-1f467-200d-1f466':1681, '1f469-200d-1f467-200d-1f467':1682, '1f469-200d-1f467':1680, '1f469-200d-1f469-200d-1f466':1668, '1f469-200d-1f469-200d-1f466-200d-1f466':1671, '1f469-200d-1f469-200d-1f467':1669, '1f469-200d-1f469-200d-1f467-200d-1f466':1670, '1f469-200d-1f469-200d-1f467-200d-1f467':1672, '1f469-200d-1f4bb':1476, '1f469-200d-1f4bc':1470, '1f469-200d-1f527':1464, '1f469-200d-1f52c':1473, '1f469-200d-1f680':1488, '1f469-200d-1f692':1491, '1f469-200d-1f9af':1575, '1f469-200d-1f9b0':1401, '1f469-200d-1f9b1':1403, '1f469-200d-1f9b2':1407, '1f469-200d-1f9b3':1405, '1f469-200d-1f9bc':1578, '1f469-200d-1f9bd':1581, '1f469-200d-2695':1446, '1f469-200d-2696':1455, '1f469-200d-2708':1485, '1f469-200d-2764-200d-1f468':1654, '1f469-200d-2764-200d-1f469':1656, '1f469-200d-2764-200d-1f48b-200d-1f468':1650, '1f469-200d-2764-200d-1f48b-200d-1f469':1652, '1f469':1400, '1f46a':1657, '1f46b':1647, '1f46c':1648, '1f46d':1646, '1f46e-200d-2640':1494, '1f46e-200d-2642':1493, '1f46e':1492, '1f46f-200d-2640':1590, '1f46f-200d-2642':1589, '1f46f':1588, '1f470-200d-2640':1518, '1f470-200d-2642':1517, '1f470':1516, '1f471-200d-2640':1409, '1f471-200d-2642':1410, '1f471':1391, '1f472':1511, '1f473-200d-2640':1510, '1f473-200d-2642':1509, '1f473':1508, '1f474':1412, '1f475':1413, '1f476':1386, '1f477-200d-2640':1504, '1f477-200d-2642':1503, '1f477':1502, '1f478':1507, '1f479':1109, '1f47a':1110, '1f47b':1111, '1f47c':1526, '1f47d':1112, '1f47e':1113, '1f47f':1104, '1f480':1105, '1f481-200d-2640':1428, '1f481-200d-2642':1427, '1f481':1426, '1f482-200d-2640':1500, '1f482-200d-2642':1499, '1f482':1498, '1f483':1585, '1f484':61152, '1f485':1366, '1f486-200d-2640':1560, '1f486-200d-2642':1559, '1f486':1558, '1f487-200d-2640':1563, '1f487-200d-2642':1562, '1f487':1561, '1f488':4870, '1f489':61326, '1f48a':61328, '1f48b':1127, '1f48c':1128, '1f48d':61153, '1f48e':61154, '1f48f':1649, '1f490':2648, '1f491':1653, '1f492':4846, '1f493':1133, '1f494':1138, '1f495':1135, '1f496':1131, '1f497':1132, '1f498':1129, '1f499':1145, '1f49a':1144, '1f49b':1143, '1f49c':1146, '1f49d':1130, '1f49e':1134, '1f49f':1136, '1f4a0':62946, '1f4a1':61214, '1f4a2':1151, '1f4a3':1157, '1f4a4':1163, '1f4a5':1152, '1f4a6':1154, '1f4a7':41022, '1f4a8':1155, '1f4a9':1107, '1f4aa':1368, '1f4ab':1153, '1f4ac':1158, '1f4ad':1162, '1f4ae':2650, '1f4af':1150, '1f4b0':61235, '1f4b1':62841, '1f4b2':62842, '1f4b3':61242, '1f4b4':61237, '1f4b5':61238, '1f4b6':61239, '1f4b7':61240, '1f4b8':61241, '1f4b9':61244, '1f4ba':4936, '1f4bb':61191, '1f4bc':61265, '1f4bd':61197, '1f4be':61198, '1f4bf':61199, '1f4c0':61200, '1f4c1':61266, '1f4c2':61267, '1f4c3':61227, '1f4c4':61229, '1f4c5':61269, '1f4c6':61270, '1f4c7':61273, '1f4c8':61274, '1f4c9':61275, '1f4ca':61276, '1f4cb':61277, '1f4cc':61278, '1f4cd':61279, '1f4ce':61280, '1f4cf':61282, '1f4d0':61283, '1f4d1':61232, '1f4d2':61226, '1f4d3':61225, '1f4d4':61218, '1f4d5':61219, '1f4d6':61220, '1f4d7':61221, '1f4d8':61222, '1f4d9':61223, '1f4da':61224, '1f4db':62847, '1f4dc':61228, '1f4dd':61264, '1f4de':61185, '1f4df':61186, '1f4e0':61187, '1f4e1':61325, '1f4e2':61159, '1f4e3':61160, '1f4e4':61249, '1f4e5':61250, '1f4e6':61251, '1f4e7':61246, '1f4e8':61247, '1f4e9':61248, '1f4ea':61253, '1f4eb':61252, '1f4ec':61254, '1f4ed':61255, '1f4ee':61256, '1f4ef':61161, '1f4f0':61230, '1f4f1':61182, '1f4f2':61183, '1f4f3':62823, '1f4f4':62824, '1f4f5':62751, '1f4f6':62822, '1f4f7':61207, '1f4f8':61208, '1f4f9':61209, '1f4fa':61206, '1f4fb':61172, '1f4fc':61210, '1f4fd':61204, '1f4ff':61151, '1f500':62801, '1f501':62802, '1f502':62803, '1f503':62769, '1f504':62770, '1f505':62820, '1f506':62821, '1f507':61155, '1f508':61156, '1f509':61157, '1f50a':61158, '1f50b':61188, '1f50c':61190, '1f50d':61211, '1f50e':61212, '1f50f':61290, '1f510':61291, '1f511':61292, '1f512':61288, '1f513':61289, '1f514':61162, '1f515':61163, '1f516':61233, '1f517':61313, '1f518':62947, '1f519':62771, '1f51a':62772, '1f51b':62773, '1f51c':62774, '1f51d':62775, '1f51e':62752, '1f51f':62876, '1f520':62877, '1f521':62878, '1f522':62879, '1f523':62880, '1f524':62881, '1f525':41021, '1f526':61215, '1f527':61306, '1f528':61294, '1f529':61308, '1f52a':3803, '1f52b':61301, '1f52c':61323, '1f52d':61324, '1f52e':51082, '1f52f':62787, '1f530':62848, '1f531':62846, '1f532':62949, '1f533':62948, '1f534':62916, '1f535':62920, '1f536':62940, '1f537':62941, '1f538':62942, '1f539':62943, '1f53a':62944, '1f53b':62945, '1f53c':62811, '1f53d':62813, '1f549':62778, '1f54a':2602, '1f54b':4854, '1f54c':4850, '1f54d':4852, '1f54e':62786, '1f550':4955, '1f551':4957, '1f552':4959, '1f553':4961, '1f554':4963, '1f555':4965, '1f556':4967, '1f557':4969, '1f558':4971, '1f559':4973, '1f55a':4975, '1f55b':4953, '1f55c':4956, '1f55d':4958, '1f55e':4960, '1f55f':4962, '1f560':4964, '1f561':4966, '1f562':4968, '1f563':4970, '1f564':4972, '1f565':4974, '1f566':4976, '1f567':4954, '1f56f':61213, '1f570':4952, '1f573':1156, '1f574':1587, '1f575-200d-2640':1497, '1f575-200d-2642':1496, '1f575':1495, '1f576':61111, '1f577':2641, '1f578':2642, '1f579':51087, '1f57a':1586, '1f587':61281, '1f58a':61261, '1f58b':61260, '1f58c':61262, '1f58d':61263, '1f590':1329, '1f595':1348, '1f596':1331, '1f5a4':1148, '1f5a5':61192, '1f5a8':61193, '1f5b1':61195, '1f5b2':61196, '1f5bc':51104, '1f5c2':61268, '1f5c3':61285, '1f5c4':61286, '1f5d1':61287, '1f5d2':61271, '1f5d3':61272, '1f5dc':61310, '1f5dd':61293, '1f5de':61231, '1f5e1':61299, '1f5e3':1683, '1f5e8':1160, '1f5ef':1161, '1f5f3':61257, '1f5fa':4810, '1f5fb':4816, '1f5fc':4847, '1f5fd':4848, '1f5fe':4811, '1f5ff':61362, '1f600':11, '1f601':14, '1f602':18, '1f603':12, '1f604':13, '1f605':16, '1f606':15, '1f607':114, '1f608':1103, '1f609':112, '1f60a':113, '1f60b':124, '1f60c':150, '1f60d':116, '1f60e':170, '1f60f':144, '1f610':139, '1f611':140, '1f612':145, '1f613':195, '1f614':151, '1f615':173, '1f616':192, '1f617':119, '1f618':118, '1f619':122, '1f61a':121, '1f61b':125, '1f61c':126, '1f61d':128, '1f61e':194, '1f61f':175, '1f620':1101, '1f621':1100, '1f622':189, '1f623':193, '1f624':199, '1f625':188, '1f626':184, '1f627':185, '1f628':186, '1f629':196, '1f62a':152, '1f62b':197, '1f62c':147, '1f62d':190, '1f62e-200d-1f4a8':148, '1f62e':178, '1f62f':179, '1f630':187, '1f631':191, '1f632':180, '1f633':181, '1f634':154, '1f635-200d-1f4ab':165, '1f635':164, '1f636-200d-1f32b':143, '1f636':141, '1f637':155, '1f638':1116, '1f639':1117, '1f63a':1115, '1f63b':1118, '1f63c':1119, '1f63d':1120, '1f63e':1123, '1f63f':1122, '1f640':1121, '1f641':176, '1f642':19, '1f643':110, '1f644':146, '1f645-200d-2640':1422, '1f645-200d-2642':1421, '1f645':1420, '1f646-200d-2640':1425, '1f646-200d-2642':1424, '1f646':1423, '1f647-200d-2640':1437, '1f647-200d-2642':1436, '1f647':1435, '1f648':1124, '1f649':1125, '1f64a':1126, '1f64b-200d-2640':1431, '1f64b-200d-2642':1430, '1f64b':1429, '1f64c':1359, '1f64d-200d-2640':1416, '1f64d-200d-2642':1415, '1f64d':1414, '1f64e-200d-2640':1419, '1f64e-200d-2642':1418, '1f64e':1417, '1f64f':1364, '1f680':4942, '1f681':4937, '1f682':4872, '1f683':4873, '1f684':4874, '1f685':4875, '1f686':4876, '1f687':4877, '1f688':4878, '1f689':4879, '1f68a':4880, '1f68b':4883, '1f68c':4884, '1f68d':4885, '1f68e':4886, '1f68f':4911, '1f690':4887, '1f691':4888, '1f692':4889, '1f693':4890, '1f694':4891, '1f695':4892, '1f696':4893, '1f697':4894, '1f698':4895, '1f699':4896, '1f69a':4898, '1f69b':4899, '1f69c':4900, '1f69d':4881, '1f69e':4882, '1f69f':4938, '1f6a0':4939, '1f6a1':4940, '1f6a2':4930, '1f6a3-200d-2640':1609, '1f6a3-200d-2642':1608, '1f6a3':1607, '1f6a4':4926, '1f6a5':4918, '1f6a6':4919, '1f6a7':4921, '1f6a8':4917, '1f6a9':71587, '1f6aa':61333, '1f6ab':62745, '1f6ac':61358, '1f6ad':62747, '1f6ae':62730, '1f6af':62748, '1f6b0':62731, '1f6b1':62749, '1f6b2':4907, '1f6b3':62746, '1f6b4-200d-2640':1621, '1f6b4-200d-2642':1620, '1f6b4':1619, '1f6b5-200d-2640':1624, '1f6b5-200d-2642':1623, '1f6b5':1622, '1f6b6-200d-2640':1566, '1f6b6-200d-2642':1565, '1f6b6':1564, '1f6b7':62750, '1f6b8':62743, '1f6b9':62733, '1f6ba':62734, '1f6bb':62735, '1f6bc':62736, '1f6bd':61340, '1f6be':62737, '1f6bf':61342, '1f6c0':1643, '1f6c1':61343, '1f6c2':62738, '1f6c3':62739, '1f6c4':62740, '1f6c5':62741, '1f6cb':61338, '1f6cc':1644, '1f6cd':61133, '1f6ce':4944, '1f6cf':61337, '1f6d0':62776, '1f6d1':4920, '1f6d2':61357, '1f6d5':4851, '1f6d6':4828, '1f6d7':61334, '1f6e0':61298, '1f6e1':61304, '1f6e2':4914, '1f6e3':4912, '1f6e4':4913, '1f6e5':4929, '1f6e9':4932, '1f6eb':4933, '1f6ec':4934, '1f6f0':4941, '1f6f3':4927, '1f6f4':4908, '1f6f5':4903, '1f6f6':4925, '1f6f7':51076, '1f6f8':4943, '1f6f9':4909, '1f6fa':4906, '1f6fb':4897, '1f6fc':4910, '1f7e0':62917, '1f7e1':62918, '1f7e2':62919, '1f7e3':62921, '1f7e4':62922, '1f7e5':62925, '1f7e6':62929, '1f7e7':62926, '1f7e8':62927, '1f7e9':62928, '1f7ea':62930, '1f7eb':62931, '1f90c':1337, '1f90d':1149, '1f90e':1147, '1f90f':1338, '1f910':137, '1f911':129, '1f912':156, '1f913':171, '1f914':135, '1f915':157, '1f916':1114, '1f917':130, '1f918':1343, '1f919':1344, '1f91a':1328, '1f91b':1356, '1f91c':1357, '1f91d':1363, '1f91e':1340, '1f91f':1342, '1f920':167, '1f921':1108, '1f922':158, '1f923':17, '1f924':153, '1f925':149, '1f926-200d-2640':1440, '1f926-200d-2642':1439, '1f926':1438, '1f927':160, '1f928':138, '1f929':117, '1f92a':127, '1f92b':134, '1f92c':1102, '1f92d':131, '1f92e':159, '1f92f':166, '1f930':1519, '1f931':1522, '1f932':1362, '1f933':1367, '1f934':1506, '1f935-200d-2640':1515, '1f935-200d-2642':1514, '1f935':1513, '1f936':1528, '1f937-200d-2640':1443, '1f937-200d-2642':1442, '1f937':1441, '1f938-200d-2640':1627, '1f938-200d-2642':1626, '1f938':1625, '1f939-200d-2640':1639, '1f939-200d-2642':1638, '1f939':1637, '1f93a':1597, '1f93c-200d-2640':1630, '1f93c-200d-2642':1629, '1f93c':1628, '1f93d-200d-2640':1633, '1f93d-200d-2642':1632, '1f93d':1631, '1f93e-200d-2640':1636, '1f93e-200d-2642':1635, '1f93e':1634, '1f93f':51073, '1f940':2654, '1f941':61180, '1f942':3791, '1f943':3792, '1f944':3802, '1f945':51069, '1f947':51048, '1f948':51049, '1f949':51050, '1f94a':51067, '1f94b':51068, '1f94c':51077, '1f94d':51064, '1f94e':51053, '1f94f':51059, '1f950':3710, '1f951':3693, '1f952':3700, '1f953':3721, '1f954':3695, '1f955':3696, '1f956':3711, '1f957':3738, '1f958':3734, '1f959':3730, '1f95a':3732, '1f95b':3780, '1f95c':3706, '1f95d':3689, '1f95e':3715, '1f95f':3757, '1f960':3758, '1f961':3759, '1f962':3799, '1f963':3737, '1f964':3794, '1f965':3692, '1f966':3702, '1f967':3773, '1f968':3713, '1f969':3720, '1f96a':3726, '1f96b':3742, '1f96c':3701, '1f96d':3681, '1f96e':3755, '1f96f':3714, '1f970':115, '1f971':198, '1f972':123, '1f973':168, '1f974':163, '1f975':161, '1f976':162, '1f977':1501, '1f978':169, '1f97a':182, '1f97b':61124, '1f97c':61113, '1f97d':61112, '1f97e':61138, '1f97f':61139, '1f980':3760, '1f981':2545, '1f982':2643, '1f983':2594, '1f984':2551, '1f985':2603, '1f986':2604, '1f987':2583, '1f988':2628, '1f989':2606, '1f98a':2540, '1f98b':2633, '1f98c':2553, '1f98d':2532, '1f98e':2615, '1f98f':2572, '1f990':3762, '1f991':3763, '1f992':2569, '1f993':2552, '1f994':2582, '1f995':2619, '1f996':2620, '1f997':2639, '1f998':2591, '1f999':2568, '1f99a':2610, '1f99b':2573, '1f99c':2611, '1f99d':2541, '1f99e':3761, '1f99f':2644, '1f9a0':2647, '1f9a1':2592, '1f9a2':2605, '1f9a3':2571, '1f9a4':2607, '1f9a5':2588, '1f9a6':2589, '1f9a7':2533, '1f9a8':2590, '1f9a9':2609, '1f9aa':3764, '1f9ab':2581, '1f9ac':2554, '1f9ad':2624, '1f9ae':2536, '1f9af':61312, '1f9b4':1380, '1f9b5':1371, '1f9b6':1372, '1f9b7':1379, '1f9b8-200d-2640':1532, '1f9b8-200d-2642':1531, '1f9b8':1530, '1f9b9-200d-2640':1535, '1f9b9-200d-2642':1534, '1f9b9':1533, '1f9ba':61114, '1f9bb':1374, '1f9bc':4905, '1f9bd':4904, '1f9be':1369, '1f9bf':1370, '1f9c0':3717, '1f9c1':3772, '1f9c2':3741, '1f9c3':3796, '1f9c4':3703, '1f9c5':3704, '1f9c6':3731, '1f9c7':3716, '1f9c8':3740, '1f9c9':3797, '1f9ca':3798, '1f9cb':3795, '1f9cd-200d-2640':1569, '1f9cd-200d-2642':1568, '1f9cd':1567, '1f9ce-200d-2640':1572, '1f9ce-200d-2642':1571, '1f9ce':1570, '1f9cf-200d-2640':1434, '1f9cf-200d-2642':1433, '1f9cf':1432, '1f9d0':172, '1f9d1-200d-1f33e':1456, '1f9d1-200d-1f373':1459, '1f9d1-200d-1f37c':1525, '1f9d1-200d-1f384':1529, '1f9d1-200d-1f393':1447, '1f9d1-200d-1f3a4':1477, '1f9d1-200d-1f3a8':1480, '1f9d1-200d-1f3eb':1450, '1f9d1-200d-1f3ed':1465, '1f9d1-200d-1f4bb':1474, '1f9d1-200d-1f4bc':1468, '1f9d1-200d-1f527':1462, '1f9d1-200d-1f52c':1471, '1f9d1-200d-1f680':1486, '1f9d1-200d-1f692':1489, '1f9d1-200d-1f91d-200d-1f9d1':1645, '1f9d1-200d-1f9af':1573, '1f9d1-200d-1f9b0':1402, '1f9d1-200d-1f9b1':1404, '1f9d1-200d-1f9b2':1408, '1f9d1-200d-1f9b3':1406, '1f9d1-200d-1f9bc':1576, '1f9d1-200d-1f9bd':1579, '1f9d1-200d-2695':1444, '1f9d1-200d-2696':1453, '1f9d1-200d-2708':1483, '1f9d1':1390, '1f9d2':1387, '1f9d3':1411, '1f9d4-200d-2640':1395, '1f9d4-200d-2642':1394, '1f9d4':1393, '1f9d5':1512, '1f9d6-200d-2640':1593, '1f9d6-200d-2642':1592, '1f9d6':1591, '1f9d7-200d-2640':1596, '1f9d7-200d-2642':1595, '1f9d7':1594, '1f9d8-200d-2640':1642, '1f9d8-200d-2642':1641, '1f9d8':1640, '1f9d9-200d-2640':1538, '1f9d9-200d-2642':1537, '1f9d9':1536, '1f9da-200d-2640':1541, '1f9da-200d-2642':1540, '1f9da':1539, '1f9db-200d-2640':1544, '1f9db-200d-2642':1543, '1f9db':1542, '1f9dc-200d-2640':1547, '1f9dc-200d-2642':1546, '1f9dc':1545, '1f9dd-200d-2640':1550, '1f9dd-200d-2642':1549, '1f9dd':1548, '1f9de-200d-2640':1553, '1f9de-200d-2642':1552, '1f9de':1551, '1f9df-200d-2640':1556, '1f9df-200d-2642':1555, '1f9df':1554, '1f9e0':1376, '1f9e1':1142, '1f9e2':61148, '1f9e3':61118, '1f9e4':61119, '1f9e5':61120, '1f9e6':61121, '1f9e7':51039, '1f9e8':51028, '1f9e9':51090, '1f9ea':61320, '1f9eb':61321, '1f9ec':61322, '1f9ed':4812, '1f9ee':61201, '1f9ef':61356, '1f9f0':61316, '1f9f1':4825, '1f9f2':61317, '1f9f3':4945, '1f9f4':61346, '1f9f5':51106, '1f9f6':51108, '1f9f7':61347, '1f9f8':51091, '1f9f9':61348, '1f9fa':61349, '1f9fb':61350, '1f9fc':61352, '1f9fd':61355, '1f9fe':61243, '1f9ff':51084, '1fa70':61142, '1fa71':61125, '1fa72':61126, '1fa73':61127, '1fa74':61135, '1fa78':61327, '1fa79':61329, '1fa7a':61331, '1fa80':51079, '1fa81':51080, '1fa82':4935, '1fa83':61302, '1fa84':51083, '1fa85':51092, '1fa86':51094, '1fa90':4993, '1fa91':61339, '1fa92':61345, '1fa93':61295, '1fa94':61217, '1fa95':61179, '1fa96':61149, '1fa97':61174, '1fa98':61181, '1fa99':61236, '1fa9a':61305, '1fa9b':61307, '1fa9c':61318, '1fa9d':61315, '1fa9e':61335, '1fa9f':61336, '1faa0':61341, '1faa1':51107, '1faa2':51109, '1faa3':61351, '1faa4':61344, '1faa5':61354, '1faa6':61360, '1faa7':61363, '1faa8':4826, '1fab0':2645, '1fab1':2646, '1fab2':2637, '1fab3':2640, '1fab4':2660, '1fab5':4827, '1fab6':2608, '1fac0':1377, '1fac1':1378, '1fac2':1686, '1fad0':3688, '1fad1':3699, '1fad2':3691, '1fad3':3712, '1fad4':3729, '1fad5':3736, '1fad6':3782, '203c':62834, '21a9':62765, '21aa':62766, '231a':4948, '231b':4946, '23cf':62818, '23e9':62805, '23ea':62809, '23eb':62812, '23ec':62814, '23ed':62806, '23ee':62810, '23ef':62807, '23f0':4949, '23f1':4950, '23f2':4951, '23f3':4947, '23f8':62815, '23f9':62816, '23fa':62817, '24c2':62890, '25aa':62938, '25ab':62939, '25b6':62804, '25c0':62808, '25fb':62935, '25fc':62934, '25fd':62937, '25fe':62936, '260e':61184, '261d':1350, '262a':62784, '262e':62785, '262f':62781, '263a':120, '264a':62790, '264b':62791, '264c':62792, '264d':62793, '264e':62794, '264f':62795, '265f':51099, '267b':62844, '267e':62833, '267f':62732, '269b':62777, '269c':62845, '26a0':62742, '26a1':41016, '26a7':62827, '26aa':62924, '26ab':62923, '26b0':61359, '26b1':61361, '26bd':51051, '26be':51052, '26c4':41019, '26c5':4999, '26c8':41000, '26ce':62800, '26cf':61296, '26d1':61150, '26d3':61314, '26d4':62744, '26e9':4853, '26ea':4849, '26f0':4814, '26f1':41015, '26f2':4855, '26f3':51070, '26f4':4928, '26f5':4924, '26f7':1599, '26f8':51071, '26f9-200d-2640':1615, '26f9-200d-2642':1614, '26f9':1613, '26fa':4856, '26fd':4915, '270a':1354, '270b':1330, '270c':1339, '270d':1365, '270f':61258, '271d':62782, '274c':62853, '274e':62854, '2764-200d-1f525':1139, '2764-200d-1fa79':1140, '27a1':62757, '27b0':62855, '27bf':62856, '2b05':62761, '2b06':62755, '2b07':62759, '2b1b':62932, '2b1c':62933, '2b50':4994, '2b55':62849, '303d':62857, '1f385-1f3fb':0, '1f385-1f3fc':0, '1f385-1f3fd':0, '1f385-1f3fe':0, '1f385-1f3ff':0, '1f3c2-1f3fb':0, '1f3c2-1f3fc':0, '1f3c2-1f3fd':0, '1f3c2-1f3fe':0, '1f3c2-1f3ff':0, '1f3c3-1f3fb-200d-2640':0, '1f3c3-1f3fc-200d-2640':0, '1f3c3-1f3fd-200d-2640':0, '1f3c3-1f3fe-200d-2640':0, '1f3c3-1f3ff-200d-2640':0, '1f3c3-1f3fb-200d-2642':0, '1f3c3-1f3fc-200d-2642':0, '1f3c3-1f3fd-200d-2642':0, '1f3c3-1f3fe-200d-2642':0, '1f3c3-1f3ff-200d-2642':0, '1f3c3-1f3fb':0, '1f3c3-1f3fc':0, '1f3c3-1f3fd':0, '1f3c3-1f3fe':0, '1f3c3-1f3ff':0, '1f3c4-1f3fb-200d-2640':0, '1f3c4-1f3fc-200d-2640':0, '1f3c4-1f3fd-200d-2640':0, '1f3c4-1f3fe-200d-2640':0, '1f3c4-1f3ff-200d-2640':0, '1f3c4-1f3fb-200d-2642':0, '1f3c4-1f3fc-200d-2642':0, '1f3c4-1f3fd-200d-2642':0, '1f3c4-1f3fe-200d-2642':0, '1f3c4-1f3ff-200d-2642':0, '1f3c4-1f3fb':0, '1f3c4-1f3fc':0, '1f3c4-1f3fd':0, '1f3c4-1f3fe':0, '1f3c4-1f3ff':0, '1f3c7-1f3fb':0, '1f3c7-1f3fc':0, '1f3c7-1f3fd':0, '1f3c7-1f3fe':0, '1f3c7-1f3ff':0, '1f3ca-1f3fb-200d-2640':0, '1f3ca-1f3fc-200d-2640':0, '1f3ca-1f3fd-200d-2640':0, '1f3ca-1f3fe-200d-2640':0, '1f3ca-1f3ff-200d-2640':0, '1f3ca-1f3fb-200d-2642':0, '1f3ca-1f3fc-200d-2642':0, '1f3ca-1f3fd-200d-2642':0, '1f3ca-1f3fe-200d-2642':0, '1f3ca-1f3ff-200d-2642':0, '1f3ca-1f3fb':0, '1f3ca-1f3fc':0, '1f3ca-1f3fd':0, '1f3ca-1f3fe':0, '1f3ca-1f3ff':0, '1f3cb-1f3fb-200d-2640':0, '1f3cb-1f3fc-200d-2640':0, '1f3cb-1f3fd-200d-2640':0, '1f3cb-1f3fe-200d-2640':0, '1f3cb-1f3ff-200d-2640':0, '1f3cb-1f3fb-200d-2642':0, '1f3cb-1f3fc-200d-2642':0, '1f3cb-1f3fd-200d-2642':0, '1f3cb-1f3fe-200d-2642':0, '1f3cb-1f3ff-200d-2642':0, '1f3cb-1f3fb':0, '1f3cb-1f3fc':0, '1f3cb-1f3fd':0, '1f3cb-1f3fe':0, '1f3cb-1f3ff':0, '1f3cc-1f3fb-200d-2640':0, '1f3cc-1f3fc-200d-2640':0, '1f3cc-1f3fd-200d-2640':0, '1f3cc-1f3fe-200d-2640':0, '1f3cc-1f3ff-200d-2640':0, '1f3cc-1f3fb-200d-2642':0, '1f3cc-1f3fc-200d-2642':0, '1f3cc-1f3fd-200d-2642':0, '1f3cc-1f3fe-200d-2642':0, '1f3cc-1f3ff-200d-2642':0, '1f3cc-1f3fb':0, '1f3cc-1f3fc':0, '1f3cc-1f3fd':0, '1f3cc-1f3fe':0, '1f3cc-1f3ff':0, '1f442-1f3fb':0, '1f442-1f3fc':0, '1f442-1f3fd':0, '1f442-1f3fe':0, '1f442-1f3ff':0, '1f443-1f3fb':0, '1f443-1f3fc':0, '1f443-1f3fd':0, '1f443-1f3fe':0, '1f443-1f3ff':0, '1f446-1f3fb':0, '1f446-1f3fc':0, '1f446-1f3fd':0, '1f446-1f3fe':0, '1f446-1f3ff':0, '1f447-1f3fb':0, '1f447-1f3fc':0, '1f447-1f3fd':0, '1f447-1f3fe':0, '1f447-1f3ff':0, '1f448-1f3fb':0, '1f448-1f3fc':0, '1f448-1f3fd':0, '1f448-1f3fe':0, '1f448-1f3ff':0, '1f449-1f3fb':0, '1f449-1f3fc':0, '1f449-1f3fd':0, '1f449-1f3fe':0, '1f449-1f3ff':0, '1f44a-1f3fb':0, '1f44a-1f3fc':0, '1f44a-1f3fd':0, '1f44a-1f3fe':0, '1f44a-1f3ff':0, '1f44b-1f3fb':0, '1f44b-1f3fc':0, '1f44b-1f3fd':0, '1f44b-1f3fe':0, '1f44b-1f3ff':0, '1f44c-1f3fb':0, '1f44c-1f3fc':0, '1f44c-1f3fd':0, '1f44c-1f3fe':0, '1f44c-1f3ff':0, '1f44d-1f3fb':0, '1f44d-1f3fc':0, '1f44d-1f3fd':0, '1f44d-1f3fe':0, '1f44d-1f3ff':0, '1f44e-1f3fb':0, '1f44e-1f3fc':0, '1f44e-1f3fd':0, '1f44e-1f3fe':0, '1f44e-1f3ff':0, '1f44f-1f3fb':0, '1f44f-1f3fc':0, '1f44f-1f3fd':0, '1f44f-1f3fe':0, '1f44f-1f3ff':0, '1f450-1f3fb':0, '1f450-1f3fc':0, '1f450-1f3fd':0, '1f450-1f3fe':0, '1f450-1f3ff':0, '1f466-1f3fb':0, '1f466-1f3fc':0, '1f466-1f3fd':0, '1f466-1f3fe':0, '1f466-1f3ff':0, '1f467-1f3fb':0, '1f467-1f3fc':0, '1f467-1f3fd':0, '1f467-1f3fe':0, '1f467-1f3ff':0, '1f468-1f3fb-200d-1f33e':0, '1f468-1f3fc-200d-1f33e':0, '1f468-1f3fd-200d-1f33e':0, '1f468-1f3fe-200d-1f33e':0, '1f468-1f3ff-200d-1f33e':0, '1f468-1f3fb-200d-1f373':0, '1f468-1f3fc-200d-1f373':0, '1f468-1f3fd-200d-1f373':0, '1f468-1f3fe-200d-1f373':0, '1f468-1f3ff-200d-1f373':0, '1f468-1f3fb-200d-1f37c':0, '1f468-1f3fc-200d-1f37c':0, '1f468-1f3fd-200d-1f37c':0, '1f468-1f3fe-200d-1f37c':0, '1f468-1f3ff-200d-1f37c':0, '1f468-1f3fb-200d-1f393':0, '1f468-1f3fc-200d-1f393':0, '1f468-1f3fd-200d-1f393':0, '1f468-1f3fe-200d-1f393':0, '1f468-1f3ff-200d-1f393':0, '1f468-1f3fb-200d-1f3a4':0, '1f468-1f3fc-200d-1f3a4':0, '1f468-1f3fd-200d-1f3a4':0, '1f468-1f3fe-200d-1f3a4':0, '1f468-1f3ff-200d-1f3a4':0, '1f468-1f3fb-200d-1f3a8':0, '1f468-1f3fc-200d-1f3a8':0, '1f468-1f3fd-200d-1f3a8':0, '1f468-1f3fe-200d-1f3a8':0, '1f468-1f3ff-200d-1f3a8':0, '1f468-1f3fb-200d-1f3eb':0, '1f468-1f3fc-200d-1f3eb':0, '1f468-1f3fd-200d-1f3eb':0, '1f468-1f3fe-200d-1f3eb':0, '1f468-1f3ff-200d-1f3eb':0, '1f468-1f3fb-200d-1f3ed':0, '1f468-1f3fc-200d-1f3ed':0, '1f468-1f3fd-200d-1f3ed':0, '1f468-1f3fe-200d-1f3ed':0, '1f468-1f3ff-200d-1f3ed':0, '1f468-1f3fb-200d-1f4bb':0, '1f468-1f3fc-200d-1f4bb':0, '1f468-1f3fd-200d-1f4bb':0, '1f468-1f3fe-200d-1f4bb':0, '1f468-1f3ff-200d-1f4bb':0, '1f468-1f3fb-200d-1f4bc':0, '1f468-1f3fc-200d-1f4bc':0, '1f468-1f3fd-200d-1f4bc':0, '1f468-1f3fe-200d-1f4bc':0, '1f468-1f3ff-200d-1f4bc':0, '1f468-1f3fb-200d-1f527':0, '1f468-1f3fc-200d-1f527':0, '1f468-1f3fd-200d-1f527':0, '1f468-1f3fe-200d-1f527':0, '1f468-1f3ff-200d-1f527':0, '1f468-1f3fb-200d-1f52c':0, '1f468-1f3fc-200d-1f52c':0, '1f468-1f3fd-200d-1f52c':0, '1f468-1f3fe-200d-1f52c':0, '1f468-1f3ff-200d-1f52c':0, '1f468-1f3fb-200d-1f680':0, '1f468-1f3fc-200d-1f680':0, '1f468-1f3fd-200d-1f680':0, '1f468-1f3fe-200d-1f680':0, '1f468-1f3ff-200d-1f680':0, '1f468-1f3fb-200d-1f692':0, '1f468-1f3fc-200d-1f692':0, '1f468-1f3fd-200d-1f692':0, '1f468-1f3fe-200d-1f692':0, '1f468-1f3ff-200d-1f692':0, '1f468-1f3fb-200d-1f9af':0, '1f468-1f3fc-200d-1f9af':0, '1f468-1f3fd-200d-1f9af':0, '1f468-1f3fe-200d-1f9af':0, '1f468-1f3ff-200d-1f9af':0, '1f468-1f3fb-200d-1f9b0':0, '1f468-1f3fc-200d-1f9b0':0, '1f468-1f3fd-200d-1f9b0':0, '1f468-1f3fe-200d-1f9b0':0, '1f468-1f3ff-200d-1f9b0':0, '1f468-1f3fb-200d-1f9b1':0, '1f468-1f3fc-200d-1f9b1':0, '1f468-1f3fd-200d-1f9b1':0, '1f468-1f3fe-200d-1f9b1':0, '1f468-1f3ff-200d-1f9b1':0, '1f468-1f3fb-200d-1f9b2':0, '1f468-1f3fc-200d-1f9b2':0, '1f468-1f3fd-200d-1f9b2':0, '1f468-1f3fe-200d-1f9b2':0, '1f468-1f3ff-200d-1f9b2':0, '1f468-1f3fb-200d-1f9b3':0, '1f468-1f3fc-200d-1f9b3':0, '1f468-1f3fd-200d-1f9b3':0, '1f468-1f3fe-200d-1f9b3':0, '1f468-1f3ff-200d-1f9b3':0, '1f468-1f3fb-200d-1f9bc':0, '1f468-1f3fc-200d-1f9bc':0, '1f468-1f3fd-200d-1f9bc':0, '1f468-1f3fe-200d-1f9bc':0, '1f468-1f3ff-200d-1f9bc':0, '1f468-1f3fb-200d-1f9bd':0, '1f468-1f3fc-200d-1f9bd':0, '1f468-1f3fd-200d-1f9bd':0, '1f468-1f3fe-200d-1f9bd':0, '1f468-1f3ff-200d-1f9bd':0, '1f468-1f3fb-200d-2695':0, '1f468-1f3fc-200d-2695':0, '1f468-1f3fd-200d-2695':0, '1f468-1f3fe-200d-2695':0, '1f468-1f3ff-200d-2695':0, '1f468-1f3fb-200d-2696':0, '1f468-1f3fc-200d-2696':0, '1f468-1f3fd-200d-2696':0, '1f468-1f3fe-200d-2696':0, '1f468-1f3ff-200d-2696':0, '1f468-1f3fb-200d-2708':0, '1f468-1f3fc-200d-2708':0, '1f468-1f3fd-200d-2708':0, '1f468-1f3fe-200d-2708':0, '1f468-1f3ff-200d-2708':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f468-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f468-1f3fb':0, '1f468-1f3fc':0, '1f468-1f3fd':0, '1f468-1f3fe':0, '1f468-1f3ff':0, '1f469-1f3fb-200d-1f33e':0, '1f469-1f3fc-200d-1f33e':0, '1f469-1f3fd-200d-1f33e':0, '1f469-1f3fe-200d-1f33e':0, '1f469-1f3ff-200d-1f33e':0, '1f469-1f3fb-200d-1f373':0, '1f469-1f3fc-200d-1f373':0, '1f469-1f3fd-200d-1f373':0, '1f469-1f3fe-200d-1f373':0, '1f469-1f3ff-200d-1f373':0, '1f469-1f3fb-200d-1f37c':0, '1f469-1f3fc-200d-1f37c':0, '1f469-1f3fd-200d-1f37c':0, '1f469-1f3fe-200d-1f37c':0, '1f469-1f3ff-200d-1f37c':0, '1f469-1f3fb-200d-1f393':0, '1f469-1f3fc-200d-1f393':0, '1f469-1f3fd-200d-1f393':0, '1f469-1f3fe-200d-1f393':0, '1f469-1f3ff-200d-1f393':0, '1f469-1f3fb-200d-1f3a4':0, '1f469-1f3fc-200d-1f3a4':0, '1f469-1f3fd-200d-1f3a4':0, '1f469-1f3fe-200d-1f3a4':0, '1f469-1f3ff-200d-1f3a4':0, '1f469-1f3fb-200d-1f3a8':0, '1f469-1f3fc-200d-1f3a8':0, '1f469-1f3fd-200d-1f3a8':0, '1f469-1f3fe-200d-1f3a8':0, '1f469-1f3ff-200d-1f3a8':0, '1f469-1f3fb-200d-1f3eb':0, '1f469-1f3fc-200d-1f3eb':0, '1f469-1f3fd-200d-1f3eb':0, '1f469-1f3fe-200d-1f3eb':0, '1f469-1f3ff-200d-1f3eb':0, '1f469-1f3fb-200d-1f3ed':0, '1f469-1f3fc-200d-1f3ed':0, '1f469-1f3fd-200d-1f3ed':0, '1f469-1f3fe-200d-1f3ed':0, '1f469-1f3ff-200d-1f3ed':0, '1f469-1f3fb-200d-1f4bb':0, '1f469-1f3fc-200d-1f4bb':0, '1f469-1f3fd-200d-1f4bb':0, '1f469-1f3fe-200d-1f4bb':0, '1f469-1f3ff-200d-1f4bb':0, '1f469-1f3fb-200d-1f4bc':0, '1f469-1f3fc-200d-1f4bc':0, '1f469-1f3fd-200d-1f4bc':0, '1f469-1f3fe-200d-1f4bc':0, '1f469-1f3ff-200d-1f4bc':0, '1f469-1f3fb-200d-1f527':0, '1f469-1f3fc-200d-1f527':0, '1f469-1f3fd-200d-1f527':0, '1f469-1f3fe-200d-1f527':0, '1f469-1f3ff-200d-1f527':0, '1f469-1f3fb-200d-1f52c':0, '1f469-1f3fc-200d-1f52c':0, '1f469-1f3fd-200d-1f52c':0, '1f469-1f3fe-200d-1f52c':0, '1f469-1f3ff-200d-1f52c':0, '1f469-1f3fb-200d-1f680':0, '1f469-1f3fc-200d-1f680':0, '1f469-1f3fd-200d-1f680':0, '1f469-1f3fe-200d-1f680':0, '1f469-1f3ff-200d-1f680':0, '1f469-1f3fb-200d-1f692':0, '1f469-1f3fc-200d-1f692':0, '1f469-1f3fd-200d-1f692':0, '1f469-1f3fe-200d-1f692':0, '1f469-1f3ff-200d-1f692':0, '1f469-1f3fb-200d-1f9af':0, '1f469-1f3fc-200d-1f9af':0, '1f469-1f3fd-200d-1f9af':0, '1f469-1f3fe-200d-1f9af':0, '1f469-1f3ff-200d-1f9af':0, '1f469-1f3fb-200d-1f9b0':0, '1f469-1f3fc-200d-1f9b0':0, '1f469-1f3fd-200d-1f9b0':0, '1f469-1f3fe-200d-1f9b0':0, '1f469-1f3ff-200d-1f9b0':0, '1f469-1f3fb-200d-1f9b1':0, '1f469-1f3fc-200d-1f9b1':0, '1f469-1f3fd-200d-1f9b1':0, '1f469-1f3fe-200d-1f9b1':0, '1f469-1f3ff-200d-1f9b1':0, '1f469-1f3fb-200d-1f9b2':0, '1f469-1f3fc-200d-1f9b2':0, '1f469-1f3fd-200d-1f9b2':0, '1f469-1f3fe-200d-1f9b2':0, '1f469-1f3ff-200d-1f9b2':0, '1f469-1f3fb-200d-1f9b3':0, '1f469-1f3fc-200d-1f9b3':0, '1f469-1f3fd-200d-1f9b3':0, '1f469-1f3fe-200d-1f9b3':0, '1f469-1f3ff-200d-1f9b3':0, '1f469-1f3fb-200d-1f9bc':0, '1f469-1f3fc-200d-1f9bc':0, '1f469-1f3fd-200d-1f9bc':0, '1f469-1f3fe-200d-1f9bc':0, '1f469-1f3ff-200d-1f9bc':0, '1f469-1f3fb-200d-1f9bd':0, '1f469-1f3fc-200d-1f9bd':0, '1f469-1f3fd-200d-1f9bd':0, '1f469-1f3fe-200d-1f9bd':0, '1f469-1f3ff-200d-1f9bd':0, '1f469-1f3fb-200d-2695':0, '1f469-1f3fc-200d-2695':0, '1f469-1f3fd-200d-2695':0, '1f469-1f3fe-200d-2695':0, '1f469-1f3ff-200d-2695':0, '1f469-1f3fb-200d-2696':0, '1f469-1f3fc-200d-2696':0, '1f469-1f3fd-200d-2696':0, '1f469-1f3fe-200d-2696':0, '1f469-1f3ff-200d-2696':0, '1f469-1f3fb-200d-2708':0, '1f469-1f3fc-200d-2708':0, '1f469-1f3fd-200d-2708':0, '1f469-1f3fe-200d-2708':0, '1f469-1f3ff-200d-2708':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f469-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f468-1f3ff':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3fe-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3fe':0, '1f469-1f3ff-200d-2764-200d-1f48b-200d-1f469-1f3ff':0, '1f469-1f3fb':0, '1f469-1f3fc':0, '1f469-1f3fd':0, '1f469-1f3fe':0, '1f469-1f3ff':0, '1f46b-1f3fb':0, '1f46b-1f3fc':0, '1f46b-1f3fd':0, '1f46b-1f3fe':0, '1f46b-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46c-1f3fb':0, '1f46c-1f3fc':0, '1f46c-1f3fd':0, '1f46c-1f3fe':0, '1f46c-1f3ff':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fb-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fc-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3fe':0, '1f468-1f3fd-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3fe-200d-1f91d-200d-1f468-1f3ff':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fb':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fc':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fd':0, '1f468-1f3ff-200d-1f91d-200d-1f468-1f3fe':0, '1f46d-1f3fb':0, '1f46d-1f3fc':0, '1f46d-1f3fd':0, '1f46d-1f3fe':0, '1f46d-1f3ff':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fb-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fc-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3fe':0, '1f469-1f3fd-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3fe-200d-1f91d-200d-1f469-1f3ff':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fb':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fc':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fd':0, '1f469-1f3ff-200d-1f91d-200d-1f469-1f3fe':0, '1f46e-1f3fb-200d-2640':0, '1f46e-1f3fc-200d-2640':0, '1f46e-1f3fd-200d-2640':0, '1f46e-1f3fe-200d-2640':0, '1f46e-1f3ff-200d-2640':0, '1f46e-1f3fb-200d-2642':0, '1f46e-1f3fc-200d-2642':0, '1f46e-1f3fd-200d-2642':0, '1f46e-1f3fe-200d-2642':0, '1f46e-1f3ff-200d-2642':0, '1f46e-1f3fb':0, '1f46e-1f3fc':0, '1f46e-1f3fd':0, '1f46e-1f3fe':0, '1f46e-1f3ff':0, '1f470-1f3fb-200d-2640':0, '1f470-1f3fc-200d-2640':0, '1f470-1f3fd-200d-2640':0, '1f470-1f3fe-200d-2640':0, '1f470-1f3ff-200d-2640':0, '1f470-1f3fb-200d-2642':0, '1f470-1f3fc-200d-2642':0, '1f470-1f3fd-200d-2642':0, '1f470-1f3fe-200d-2642':0, '1f470-1f3ff-200d-2642':0, '1f470-1f3fb':0, '1f470-1f3fc':0, '1f470-1f3fd':0, '1f470-1f3fe':0, '1f470-1f3ff':0, '1f471-1f3fb-200d-2640':0, '1f471-1f3fc-200d-2640':0, '1f471-1f3fd-200d-2640':0, '1f471-1f3fe-200d-2640':0, '1f471-1f3ff-200d-2640':0, '1f471-1f3fb-200d-2642':0, '1f471-1f3fc-200d-2642':0, '1f471-1f3fd-200d-2642':0, '1f471-1f3fe-200d-2642':0, '1f471-1f3ff-200d-2642':0, '1f471-1f3fb':0, '1f471-1f3fc':0, '1f471-1f3fd':0, '1f471-1f3fe':0, '1f471-1f3ff':0, '1f472-1f3fb':0, '1f472-1f3fc':0, '1f472-1f3fd':0, '1f472-1f3fe':0, '1f472-1f3ff':0, '1f473-1f3fb-200d-2640':0, '1f473-1f3fc-200d-2640':0, '1f473-1f3fd-200d-2640':0, '1f473-1f3fe-200d-2640':0, '1f473-1f3ff-200d-2640':0, '1f473-1f3fb-200d-2642':0, '1f473-1f3fc-200d-2642':0, '1f473-1f3fd-200d-2642':0, '1f473-1f3fe-200d-2642':0, '1f473-1f3ff-200d-2642':0, '1f473-1f3fb':0, '1f473-1f3fc':0, '1f473-1f3fd':0, '1f473-1f3fe':0, '1f473-1f3ff':0, '1f474-1f3fb':0, '1f474-1f3fc':0, '1f474-1f3fd':0, '1f474-1f3fe':0, '1f474-1f3ff':0, '1f475-1f3fb':0, '1f475-1f3fc':0, '1f475-1f3fd':0, '1f475-1f3fe':0, '1f475-1f3ff':0, '1f476-1f3fb':0, '1f476-1f3fc':0, '1f476-1f3fd':0, '1f476-1f3fe':0, '1f476-1f3ff':0, '1f477-1f3fb-200d-2640':0, '1f477-1f3fc-200d-2640':0, '1f477-1f3fd-200d-2640':0, '1f477-1f3fe-200d-2640':0, '1f477-1f3ff-200d-2640':0, '1f477-1f3fb-200d-2642':0, '1f477-1f3fc-200d-2642':0, '1f477-1f3fd-200d-2642':0, '1f477-1f3fe-200d-2642':0, '1f477-1f3ff-200d-2642':0, '1f477-1f3fb':0, '1f477-1f3fc':0, '1f477-1f3fd':0, '1f477-1f3fe':0, '1f477-1f3ff':0, '1f478-1f3fb':0, '1f478-1f3fc':0, '1f478-1f3fd':0, '1f478-1f3fe':0, '1f478-1f3ff':0, '1f47c-1f3fb':0, '1f47c-1f3fc':0, '1f47c-1f3fd':0, '1f47c-1f3fe':0, '1f47c-1f3ff':0, '1f481-1f3fb-200d-2640':0, '1f481-1f3fc-200d-2640':0, '1f481-1f3fd-200d-2640':0, '1f481-1f3fe-200d-2640':0, '1f481-1f3ff-200d-2640':0, '1f481-1f3fb-200d-2642':0, '1f481-1f3fc-200d-2642':0, '1f481-1f3fd-200d-2642':0, '1f481-1f3fe-200d-2642':0, '1f481-1f3ff-200d-2642':0, '1f481-1f3fb':0, '1f481-1f3fc':0, '1f481-1f3fd':0, '1f481-1f3fe':0, '1f481-1f3ff':0, '1f482-1f3fb-200d-2640':0, '1f482-1f3fc-200d-2640':0, '1f482-1f3fd-200d-2640':0, '1f482-1f3fe-200d-2640':0, '1f482-1f3ff-200d-2640':0, '1f482-1f3fb-200d-2642':0, '1f482-1f3fc-200d-2642':0, '1f482-1f3fd-200d-2642':0, '1f482-1f3fe-200d-2642':0, '1f482-1f3ff-200d-2642':0, '1f482-1f3fb':0, '1f482-1f3fc':0, '1f482-1f3fd':0, '1f482-1f3fe':0, '1f482-1f3ff':0, '1f483-1f3fb':0, '1f483-1f3fc':0, '1f483-1f3fd':0, '1f483-1f3fe':0, '1f483-1f3ff':0, '1f485-1f3fb':0, '1f485-1f3fc':0, '1f485-1f3fd':0, '1f485-1f3fe':0, '1f485-1f3ff':0, '1f486-1f3fb-200d-2640':0, '1f486-1f3fc-200d-2640':0, '1f486-1f3fd-200d-2640':0, '1f486-1f3fe-200d-2640':0, '1f486-1f3ff-200d-2640':0, '1f486-1f3fb-200d-2642':0, '1f486-1f3fc-200d-2642':0, '1f486-1f3fd-200d-2642':0, '1f486-1f3fe-200d-2642':0, '1f486-1f3ff-200d-2642':0, '1f486-1f3fb':0, '1f486-1f3fc':0, '1f486-1f3fd':0, '1f486-1f3fe':0, '1f486-1f3ff':0, '1f487-1f3fb-200d-2640':0, '1f487-1f3fc-200d-2640':0, '1f487-1f3fd-200d-2640':0, '1f487-1f3fe-200d-2640':0, '1f487-1f3ff-200d-2640':0, '1f487-1f3fb-200d-2642':0, '1f487-1f3fc-200d-2642':0, '1f487-1f3fd-200d-2642':0, '1f487-1f3fe-200d-2642':0, '1f487-1f3ff-200d-2642':0, '1f487-1f3fb':0, '1f487-1f3fc':0, '1f487-1f3fd':0, '1f487-1f3fe':0, '1f487-1f3ff':0, '1f48f-1f3fb':0, '1f48f-1f3fc':0, '1f48f-1f3fd':0, '1f48f-1f3fe':0, '1f48f-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f48b-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f48b-200d-1f9d1-1f3fe':0, '1f491-1f3fb':0, '1f491-1f3fc':0, '1f491-1f3fd':0, '1f491-1f3fe':0, '1f491-1f3ff':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-2764-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-2764-200d-1f9d1-1f3fe':0, '1f4aa-1f3fb':0, '1f4aa-1f3fc':0, '1f4aa-1f3fd':0, '1f4aa-1f3fe':0, '1f4aa-1f3ff':0, '1f574-1f3fb':0, '1f574-1f3fc':0, '1f574-1f3fd':0, '1f574-1f3fe':0, '1f574-1f3ff':0, '1f575-1f3fb-200d-2640':0, '1f575-1f3fc-200d-2640':0, '1f575-1f3fd-200d-2640':0, '1f575-1f3fe-200d-2640':0, '1f575-1f3ff-200d-2640':0, '1f575-1f3fb-200d-2642':0, '1f575-1f3fc-200d-2642':0, '1f575-1f3fd-200d-2642':0, '1f575-1f3fe-200d-2642':0, '1f575-1f3ff-200d-2642':0, '1f575-1f3fb':0, '1f575-1f3fc':0, '1f575-1f3fd':0, '1f575-1f3fe':0, '1f575-1f3ff':0, '1f57a-1f3fb':0, '1f57a-1f3fc':0, '1f57a-1f3fd':0, '1f57a-1f3fe':0, '1f57a-1f3ff':0, '1f590-1f3fb':0, '1f590-1f3fc':0, '1f590-1f3fd':0, '1f590-1f3fe':0, '1f590-1f3ff':0, '1f595-1f3fb':0, '1f595-1f3fc':0, '1f595-1f3fd':0, '1f595-1f3fe':0, '1f595-1f3ff':0, '1f596-1f3fb':0, '1f596-1f3fc':0, '1f596-1f3fd':0, '1f596-1f3fe':0, '1f596-1f3ff':0, '1f645-1f3fb-200d-2640':0, '1f645-1f3fc-200d-2640':0, '1f645-1f3fd-200d-2640':0, '1f645-1f3fe-200d-2640':0, '1f645-1f3ff-200d-2640':0, '1f645-1f3fb-200d-2642':0, '1f645-1f3fc-200d-2642':0, '1f645-1f3fd-200d-2642':0, '1f645-1f3fe-200d-2642':0, '1f645-1f3ff-200d-2642':0, '1f645-1f3fb':0, '1f645-1f3fc':0, '1f645-1f3fd':0, '1f645-1f3fe':0, '1f645-1f3ff':0, '1f646-1f3fb-200d-2640':0, '1f646-1f3fc-200d-2640':0, '1f646-1f3fd-200d-2640':0, '1f646-1f3fe-200d-2640':0, '1f646-1f3ff-200d-2640':0, '1f646-1f3fb-200d-2642':0, '1f646-1f3fc-200d-2642':0, '1f646-1f3fd-200d-2642':0, '1f646-1f3fe-200d-2642':0, '1f646-1f3ff-200d-2642':0, '1f646-1f3fb':0, '1f646-1f3fc':0, '1f646-1f3fd':0, '1f646-1f3fe':0, '1f646-1f3ff':0, '1f647-1f3fb-200d-2640':0, '1f647-1f3fc-200d-2640':0, '1f647-1f3fd-200d-2640':0, '1f647-1f3fe-200d-2640':0, '1f647-1f3ff-200d-2640':0, '1f647-1f3fb-200d-2642':0, '1f647-1f3fc-200d-2642':0, '1f647-1f3fd-200d-2642':0, '1f647-1f3fe-200d-2642':0, '1f647-1f3ff-200d-2642':0, '1f647-1f3fb':0, '1f647-1f3fc':0, '1f647-1f3fd':0, '1f647-1f3fe':0, '1f647-1f3ff':0, '1f64b-1f3fb-200d-2640':0, '1f64b-1f3fc-200d-2640':0, '1f64b-1f3fd-200d-2640':0, '1f64b-1f3fe-200d-2640':0, '1f64b-1f3ff-200d-2640':0, '1f64b-1f3fb-200d-2642':0, '1f64b-1f3fc-200d-2642':0, '1f64b-1f3fd-200d-2642':0, '1f64b-1f3fe-200d-2642':0, '1f64b-1f3ff-200d-2642':0, '1f64b-1f3fb':0, '1f64b-1f3fc':0, '1f64b-1f3fd':0, '1f64b-1f3fe':0, '1f64b-1f3ff':0, '1f64c-1f3fb':0, '1f64c-1f3fc':0, '1f64c-1f3fd':0, '1f64c-1f3fe':0, '1f64c-1f3ff':0, '1f64d-1f3fb-200d-2640':0, '1f64d-1f3fc-200d-2640':0, '1f64d-1f3fd-200d-2640':0, '1f64d-1f3fe-200d-2640':0, '1f64d-1f3ff-200d-2640':0, '1f64d-1f3fb-200d-2642':0, '1f64d-1f3fc-200d-2642':0, '1f64d-1f3fd-200d-2642':0, '1f64d-1f3fe-200d-2642':0, '1f64d-1f3ff-200d-2642':0, '1f64d-1f3fb':0, '1f64d-1f3fc':0, '1f64d-1f3fd':0, '1f64d-1f3fe':0, '1f64d-1f3ff':0, '1f64e-1f3fb-200d-2640':0, '1f64e-1f3fc-200d-2640':0, '1f64e-1f3fd-200d-2640':0, '1f64e-1f3fe-200d-2640':0, '1f64e-1f3ff-200d-2640':0, '1f64e-1f3fb-200d-2642':0, '1f64e-1f3fc-200d-2642':0, '1f64e-1f3fd-200d-2642':0, '1f64e-1f3fe-200d-2642':0, '1f64e-1f3ff-200d-2642':0, '1f64e-1f3fb':0, '1f64e-1f3fc':0, '1f64e-1f3fd':0, '1f64e-1f3fe':0, '1f64e-1f3ff':0, '1f64f-1f3fb':0, '1f64f-1f3fc':0, '1f64f-1f3fd':0, '1f64f-1f3fe':0, '1f64f-1f3ff':0, '1f6a3-1f3fb-200d-2640':0, '1f6a3-1f3fc-200d-2640':0, '1f6a3-1f3fd-200d-2640':0, '1f6a3-1f3fe-200d-2640':0, '1f6a3-1f3ff-200d-2640':0, '1f6a3-1f3fb-200d-2642':0, '1f6a3-1f3fc-200d-2642':0, '1f6a3-1f3fd-200d-2642':0, '1f6a3-1f3fe-200d-2642':0, '1f6a3-1f3ff-200d-2642':0, '1f6a3-1f3fb':0, '1f6a3-1f3fc':0, '1f6a3-1f3fd':0, '1f6a3-1f3fe':0, '1f6a3-1f3ff':0, '1f6b4-1f3fb-200d-2640':0, '1f6b4-1f3fc-200d-2640':0, '1f6b4-1f3fd-200d-2640':0, '1f6b4-1f3fe-200d-2640':0, '1f6b4-1f3ff-200d-2640':0, '1f6b4-1f3fb-200d-2642':0, '1f6b4-1f3fc-200d-2642':0, '1f6b4-1f3fd-200d-2642':0, '1f6b4-1f3fe-200d-2642':0, '1f6b4-1f3ff-200d-2642':0, '1f6b4-1f3fb':0, '1f6b4-1f3fc':0, '1f6b4-1f3fd':0, '1f6b4-1f3fe':0, '1f6b4-1f3ff':0, '1f6b5-1f3fb-200d-2640':0, '1f6b5-1f3fc-200d-2640':0, '1f6b5-1f3fd-200d-2640':0, '1f6b5-1f3fe-200d-2640':0, '1f6b5-1f3ff-200d-2640':0, '1f6b5-1f3fb-200d-2642':0, '1f6b5-1f3fc-200d-2642':0, '1f6b5-1f3fd-200d-2642':0, '1f6b5-1f3fe-200d-2642':0, '1f6b5-1f3ff-200d-2642':0, '1f6b5-1f3fb':0, '1f6b5-1f3fc':0, '1f6b5-1f3fd':0, '1f6b5-1f3fe':0, '1f6b5-1f3ff':0, '1f6b6-1f3fb-200d-2640':0, '1f6b6-1f3fc-200d-2640':0, '1f6b6-1f3fd-200d-2640':0, '1f6b6-1f3fe-200d-2640':0, '1f6b6-1f3ff-200d-2640':0, '1f6b6-1f3fb-200d-2642':0, '1f6b6-1f3fc-200d-2642':0, '1f6b6-1f3fd-200d-2642':0, '1f6b6-1f3fe-200d-2642':0, '1f6b6-1f3ff-200d-2642':0, '1f6b6-1f3fb':0, '1f6b6-1f3fc':0, '1f6b6-1f3fd':0, '1f6b6-1f3fe':0, '1f6b6-1f3ff':0, '1f6c0-1f3fb':0, '1f6c0-1f3fc':0, '1f6c0-1f3fd':0, '1f6c0-1f3fe':0, '1f6c0-1f3ff':0, '1f6cc-1f3fb':0, '1f6cc-1f3fc':0, '1f6cc-1f3fd':0, '1f6cc-1f3fe':0, '1f6cc-1f3ff':0, '1f90c-1f3fb':0, '1f90c-1f3fc':0, '1f90c-1f3fd':0, '1f90c-1f3fe':0, '1f90c-1f3ff':0, '1f90f-1f3fb':0, '1f90f-1f3fc':0, '1f90f-1f3fd':0, '1f90f-1f3fe':0, '1f90f-1f3ff':0, '1f918-1f3fb':0, '1f918-1f3fc':0, '1f918-1f3fd':0, '1f918-1f3fe':0, '1f918-1f3ff':0, '1f919-1f3fb':0, '1f919-1f3fc':0, '1f919-1f3fd':0, '1f919-1f3fe':0, '1f919-1f3ff':0, '1f91a-1f3fb':0, '1f91a-1f3fc':0, '1f91a-1f3fd':0, '1f91a-1f3fe':0, '1f91a-1f3ff':0, '1f91b-1f3fb':0, '1f91b-1f3fc':0, '1f91b-1f3fd':0, '1f91b-1f3fe':0, '1f91b-1f3ff':0, '1f91c-1f3fb':0, '1f91c-1f3fc':0, '1f91c-1f3fd':0, '1f91c-1f3fe':0, '1f91c-1f3ff':0, '1f91d-1f3fb':0, '1f91d-1f3fc':0, '1f91d-1f3fd':0, '1f91d-1f3fe':0, '1f91d-1f3ff':0, '1f91e-1f3fb':0, '1f91e-1f3fc':0, '1f91e-1f3fd':0, '1f91e-1f3fe':0, '1f91e-1f3ff':0, '1f91f-1f3fb':0, '1f91f-1f3fc':0, '1f91f-1f3fd':0, '1f91f-1f3fe':0, '1f91f-1f3ff':0, '1f926-1f3fb-200d-2640':0, '1f926-1f3fc-200d-2640':0, '1f926-1f3fd-200d-2640':0, '1f926-1f3fe-200d-2640':0, '1f926-1f3ff-200d-2640':0, '1f926-1f3fb-200d-2642':0, '1f926-1f3fc-200d-2642':0, '1f926-1f3fd-200d-2642':0, '1f926-1f3fe-200d-2642':0, '1f926-1f3ff-200d-2642':0, '1f926-1f3fb':0, '1f926-1f3fc':0, '1f926-1f3fd':0, '1f926-1f3fe':0, '1f926-1f3ff':0, '1f930-1f3fb':0, '1f930-1f3fc':0, '1f930-1f3fd':0, '1f930-1f3fe':0, '1f930-1f3ff':0, '1f931-1f3fb':0, '1f931-1f3fc':0, '1f931-1f3fd':0, '1f931-1f3fe':0, '1f931-1f3ff':0, '1f932-1f3fb':0, '1f932-1f3fc':0, '1f932-1f3fd':0, '1f932-1f3fe':0, '1f932-1f3ff':0, '1f933-1f3fb':0, '1f933-1f3fc':0, '1f933-1f3fd':0, '1f933-1f3fe':0, '1f933-1f3ff':0, '1f934-1f3fb':0, '1f934-1f3fc':0, '1f934-1f3fd':0, '1f934-1f3fe':0, '1f934-1f3ff':0, '1f935-1f3fb-200d-2640':0, '1f935-1f3fc-200d-2640':0, '1f935-1f3fd-200d-2640':0, '1f935-1f3fe-200d-2640':0, '1f935-1f3ff-200d-2640':0, '1f935-1f3fb-200d-2642':0, '1f935-1f3fc-200d-2642':0, '1f935-1f3fd-200d-2642':0, '1f935-1f3fe-200d-2642':0, '1f935-1f3ff-200d-2642':0, '1f935-1f3fb':0, '1f935-1f3fc':0, '1f935-1f3fd':0, '1f935-1f3fe':0, '1f935-1f3ff':0, '1f936-1f3fb':0, '1f936-1f3fc':0, '1f936-1f3fd':0, '1f936-1f3fe':0, '1f936-1f3ff':0, '1f937-1f3fb-200d-2640':0, '1f937-1f3fc-200d-2640':0, '1f937-1f3fd-200d-2640':0, '1f937-1f3fe-200d-2640':0, '1f937-1f3ff-200d-2640':0, '1f937-1f3fb-200d-2642':0, '1f937-1f3fc-200d-2642':0, '1f937-1f3fd-200d-2642':0, '1f937-1f3fe-200d-2642':0, '1f937-1f3ff-200d-2642':0, '1f937-1f3fb':0, '1f937-1f3fc':0, '1f937-1f3fd':0, '1f937-1f3fe':0, '1f937-1f3ff':0, '1f938-1f3fb-200d-2640':0, '1f938-1f3fc-200d-2640':0, '1f938-1f3fd-200d-2640':0, '1f938-1f3fe-200d-2640':0, '1f938-1f3ff-200d-2640':0, '1f938-1f3fb-200d-2642':0, '1f938-1f3fc-200d-2642':0, '1f938-1f3fd-200d-2642':0, '1f938-1f3fe-200d-2642':0, '1f938-1f3ff-200d-2642':0, '1f938-1f3fb':0, '1f938-1f3fc':0, '1f938-1f3fd':0, '1f938-1f3fe':0, '1f938-1f3ff':0, '1f939-1f3fb-200d-2640':0, '1f939-1f3fc-200d-2640':0, '1f939-1f3fd-200d-2640':0, '1f939-1f3fe-200d-2640':0, '1f939-1f3ff-200d-2640':0, '1f939-1f3fb-200d-2642':0, '1f939-1f3fc-200d-2642':0, '1f939-1f3fd-200d-2642':0, '1f939-1f3fe-200d-2642':0, '1f939-1f3ff-200d-2642':0, '1f939-1f3fb':0, '1f939-1f3fc':0, '1f939-1f3fd':0, '1f939-1f3fe':0, '1f939-1f3ff':0, '1f93d-1f3fb-200d-2640':0, '1f93d-1f3fc-200d-2640':0, '1f93d-1f3fd-200d-2640':0, '1f93d-1f3fe-200d-2640':0, '1f93d-1f3ff-200d-2640':0, '1f93d-1f3fb-200d-2642':0, '1f93d-1f3fc-200d-2642':0, '1f93d-1f3fd-200d-2642':0, '1f93d-1f3fe-200d-2642':0, '1f93d-1f3ff-200d-2642':0, '1f93d-1f3fb':0, '1f93d-1f3fc':0, '1f93d-1f3fd':0, '1f93d-1f3fe':0, '1f93d-1f3ff':0, '1f93e-1f3fb-200d-2640':0, '1f93e-1f3fc-200d-2640':0, '1f93e-1f3fd-200d-2640':0, '1f93e-1f3fe-200d-2640':0, '1f93e-1f3ff-200d-2640':0, '1f93e-1f3fb-200d-2642':0, '1f93e-1f3fc-200d-2642':0, '1f93e-1f3fd-200d-2642':0, '1f93e-1f3fe-200d-2642':0, '1f93e-1f3ff-200d-2642':0, '1f93e-1f3fb':0, '1f93e-1f3fc':0, '1f93e-1f3fd':0, '1f93e-1f3fe':0, '1f93e-1f3ff':0, '1f977-1f3fb':0, '1f977-1f3fc':0, '1f977-1f3fd':0, '1f977-1f3fe':0, '1f977-1f3ff':0, '1f9b5-1f3fb':0, '1f9b5-1f3fc':0, '1f9b5-1f3fd':0, '1f9b5-1f3fe':0, '1f9b5-1f3ff':0, '1f9b6-1f3fb':0, '1f9b6-1f3fc':0, '1f9b6-1f3fd':0, '1f9b6-1f3fe':0, '1f9b6-1f3ff':0, '1f9b8-1f3fb-200d-2640':0, '1f9b8-1f3fc-200d-2640':0, '1f9b8-1f3fd-200d-2640':0, '1f9b8-1f3fe-200d-2640':0, '1f9b8-1f3ff-200d-2640':0, '1f9b8-1f3fb-200d-2642':0, '1f9b8-1f3fc-200d-2642':0, '1f9b8-1f3fd-200d-2642':0, '1f9b8-1f3fe-200d-2642':0, '1f9b8-1f3ff-200d-2642':0, '1f9b8-1f3fb':0, '1f9b8-1f3fc':0, '1f9b8-1f3fd':0, '1f9b8-1f3fe':0, '1f9b8-1f3ff':0, '1f9b9-1f3fb-200d-2640':0, '1f9b9-1f3fc-200d-2640':0, '1f9b9-1f3fd-200d-2640':0, '1f9b9-1f3fe-200d-2640':0, '1f9b9-1f3ff-200d-2640':0, '1f9b9-1f3fb-200d-2642':0, '1f9b9-1f3fc-200d-2642':0, '1f9b9-1f3fd-200d-2642':0, '1f9b9-1f3fe-200d-2642':0, '1f9b9-1f3ff-200d-2642':0, '1f9b9-1f3fb':0, '1f9b9-1f3fc':0, '1f9b9-1f3fd':0, '1f9b9-1f3fe':0, '1f9b9-1f3ff':0, '1f9bb-1f3fb':0, '1f9bb-1f3fc':0, '1f9bb-1f3fd':0, '1f9bb-1f3fe':0, '1f9bb-1f3ff':0, '1f9cd-1f3fb-200d-2640':0, '1f9cd-1f3fc-200d-2640':0, '1f9cd-1f3fd-200d-2640':0, '1f9cd-1f3fe-200d-2640':0, '1f9cd-1f3ff-200d-2640':0, '1f9cd-1f3fb-200d-2642':0, '1f9cd-1f3fc-200d-2642':0, '1f9cd-1f3fd-200d-2642':0, '1f9cd-1f3fe-200d-2642':0, '1f9cd-1f3ff-200d-2642':0, '1f9cd-1f3fb':0, '1f9cd-1f3fc':0, '1f9cd-1f3fd':0, '1f9cd-1f3fe':0, '1f9cd-1f3ff':0, '1f9ce-1f3fb-200d-2640':0, '1f9ce-1f3fc-200d-2640':0, '1f9ce-1f3fd-200d-2640':0, '1f9ce-1f3fe-200d-2640':0, '1f9ce-1f3ff-200d-2640':0, '1f9ce-1f3fb-200d-2642':0, '1f9ce-1f3fc-200d-2642':0, '1f9ce-1f3fd-200d-2642':0, '1f9ce-1f3fe-200d-2642':0, '1f9ce-1f3ff-200d-2642':0, '1f9ce-1f3fb':0, '1f9ce-1f3fc':0, '1f9ce-1f3fd':0, '1f9ce-1f3fe':0, '1f9ce-1f3ff':0, '1f9cf-1f3fb-200d-2640':0, '1f9cf-1f3fc-200d-2640':0, '1f9cf-1f3fd-200d-2640':0, '1f9cf-1f3fe-200d-2640':0, '1f9cf-1f3ff-200d-2640':0, '1f9cf-1f3fb-200d-2642':0, '1f9cf-1f3fc-200d-2642':0, '1f9cf-1f3fd-200d-2642':0, '1f9cf-1f3fe-200d-2642':0, '1f9cf-1f3ff-200d-2642':0, '1f9cf-1f3fb':0, '1f9cf-1f3fc':0, '1f9cf-1f3fd':0, '1f9cf-1f3fe':0, '1f9cf-1f3ff':0, '1f9d1-1f3fb-200d-1f33e':0, '1f9d1-1f3fc-200d-1f33e':0, '1f9d1-1f3fd-200d-1f33e':0, '1f9d1-1f3fe-200d-1f33e':0, '1f9d1-1f3ff-200d-1f33e':0, '1f9d1-1f3fb-200d-1f373':0, '1f9d1-1f3fc-200d-1f373':0, '1f9d1-1f3fd-200d-1f373':0, '1f9d1-1f3fe-200d-1f373':0, '1f9d1-1f3ff-200d-1f373':0, '1f9d1-1f3fb-200d-1f37c':0, '1f9d1-1f3fc-200d-1f37c':0, '1f9d1-1f3fd-200d-1f37c':0, '1f9d1-1f3fe-200d-1f37c':0, '1f9d1-1f3ff-200d-1f37c':0, '1f9d1-1f3fb-200d-1f384':0, '1f9d1-1f3fc-200d-1f384':0, '1f9d1-1f3fd-200d-1f384':0, '1f9d1-1f3fe-200d-1f384':0, '1f9d1-1f3ff-200d-1f384':0, '1f9d1-1f3fb-200d-1f393':0, '1f9d1-1f3fc-200d-1f393':0, '1f9d1-1f3fd-200d-1f393':0, '1f9d1-1f3fe-200d-1f393':0, '1f9d1-1f3ff-200d-1f393':0, '1f9d1-1f3fb-200d-1f3a4':0, '1f9d1-1f3fc-200d-1f3a4':0, '1f9d1-1f3fd-200d-1f3a4':0, '1f9d1-1f3fe-200d-1f3a4':0, '1f9d1-1f3ff-200d-1f3a4':0, '1f9d1-1f3fb-200d-1f3a8':0, '1f9d1-1f3fc-200d-1f3a8':0, '1f9d1-1f3fd-200d-1f3a8':0, '1f9d1-1f3fe-200d-1f3a8':0, '1f9d1-1f3ff-200d-1f3a8':0, '1f9d1-1f3fb-200d-1f3eb':0, '1f9d1-1f3fc-200d-1f3eb':0, '1f9d1-1f3fd-200d-1f3eb':0, '1f9d1-1f3fe-200d-1f3eb':0, '1f9d1-1f3ff-200d-1f3eb':0, '1f9d1-1f3fb-200d-1f3ed':0, '1f9d1-1f3fc-200d-1f3ed':0, '1f9d1-1f3fd-200d-1f3ed':0, '1f9d1-1f3fe-200d-1f3ed':0, '1f9d1-1f3ff-200d-1f3ed':0, '1f9d1-1f3fb-200d-1f4bb':0, '1f9d1-1f3fc-200d-1f4bb':0, '1f9d1-1f3fd-200d-1f4bb':0, '1f9d1-1f3fe-200d-1f4bb':0, '1f9d1-1f3ff-200d-1f4bb':0, '1f9d1-1f3fb-200d-1f4bc':0, '1f9d1-1f3fc-200d-1f4bc':0, '1f9d1-1f3fd-200d-1f4bc':0, '1f9d1-1f3fe-200d-1f4bc':0, '1f9d1-1f3ff-200d-1f4bc':0, '1f9d1-1f3fb-200d-1f527':0, '1f9d1-1f3fc-200d-1f527':0, '1f9d1-1f3fd-200d-1f527':0, '1f9d1-1f3fe-200d-1f527':0, '1f9d1-1f3ff-200d-1f527':0, '1f9d1-1f3fb-200d-1f52c':0, '1f9d1-1f3fc-200d-1f52c':0, '1f9d1-1f3fd-200d-1f52c':0, '1f9d1-1f3fe-200d-1f52c':0, '1f9d1-1f3ff-200d-1f52c':0, '1f9d1-1f3fb-200d-1f680':0, '1f9d1-1f3fc-200d-1f680':0, '1f9d1-1f3fd-200d-1f680':0, '1f9d1-1f3fe-200d-1f680':0, '1f9d1-1f3ff-200d-1f680':0, '1f9d1-1f3fb-200d-1f692':0, '1f9d1-1f3fc-200d-1f692':0, '1f9d1-1f3fd-200d-1f692':0, '1f9d1-1f3fe-200d-1f692':0, '1f9d1-1f3ff-200d-1f692':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fb-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fc-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fd-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3fe-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fb':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fc':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fd':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3fe':0, '1f9d1-1f3ff-200d-1f91d-200d-1f9d1-1f3ff':0, '1f9d1-1f3fb-200d-1f9af':0, '1f9d1-1f3fc-200d-1f9af':0, '1f9d1-1f3fd-200d-1f9af':0, '1f9d1-1f3fe-200d-1f9af':0, '1f9d1-1f3ff-200d-1f9af':0, '1f9d1-1f3fb-200d-1f9b0':0, '1f9d1-1f3fc-200d-1f9b0':0, '1f9d1-1f3fd-200d-1f9b0':0, '1f9d1-1f3fe-200d-1f9b0':0, '1f9d1-1f3ff-200d-1f9b0':0, '1f9d1-1f3fb-200d-1f9b1':0, '1f9d1-1f3fc-200d-1f9b1':0, '1f9d1-1f3fd-200d-1f9b1':0, '1f9d1-1f3fe-200d-1f9b1':0, '1f9d1-1f3ff-200d-1f9b1':0, '1f9d1-1f3fb-200d-1f9b2':0, '1f9d1-1f3fc-200d-1f9b2':0, '1f9d1-1f3fd-200d-1f9b2':0, '1f9d1-1f3fe-200d-1f9b2':0, '1f9d1-1f3ff-200d-1f9b2':0, '1f9d1-1f3fb-200d-1f9b3':0, '1f9d1-1f3fc-200d-1f9b3':0, '1f9d1-1f3fd-200d-1f9b3':0, '1f9d1-1f3fe-200d-1f9b3':0, '1f9d1-1f3ff-200d-1f9b3':0, '1f9d1-1f3fb-200d-1f9bc':0, '1f9d1-1f3fc-200d-1f9bc':0, '1f9d1-1f3fd-200d-1f9bc':0, '1f9d1-1f3fe-200d-1f9bc':0, '1f9d1-1f3ff-200d-1f9bc':0, '1f9d1-1f3fb-200d-1f9bd':0, '1f9d1-1f3fc-200d-1f9bd':0, '1f9d1-1f3fd-200d-1f9bd':0, '1f9d1-1f3fe-200d-1f9bd':0, '1f9d1-1f3ff-200d-1f9bd':0, '1f9d1-1f3fb-200d-2695':0, '1f9d1-1f3fc-200d-2695':0, '1f9d1-1f3fd-200d-2695':0, '1f9d1-1f3fe-200d-2695':0, '1f9d1-1f3ff-200d-2695':0, '1f9d1-1f3fb-200d-2696':0, '1f9d1-1f3fc-200d-2696':0, '1f9d1-1f3fd-200d-2696':0, '1f9d1-1f3fe-200d-2696':0, '1f9d1-1f3ff-200d-2696':0, '1f9d1-1f3fb-200d-2708':0, '1f9d1-1f3fc-200d-2708':0, '1f9d1-1f3fd-200d-2708':0, '1f9d1-1f3fe-200d-2708':0, '1f9d1-1f3ff-200d-2708':0, '1f9d1-1f3fb':0, '1f9d1-1f3fc':0, '1f9d1-1f3fd':0, '1f9d1-1f3fe':0, '1f9d1-1f3ff':0, '1f9d2-1f3fb':0, '1f9d2-1f3fc':0, '1f9d2-1f3fd':0, '1f9d2-1f3fe':0, '1f9d2-1f3ff':0, '1f9d3-1f3fb':0, '1f9d3-1f3fc':0, '1f9d3-1f3fd':0, '1f9d3-1f3fe':0, '1f9d3-1f3ff':0, '1f9d4-1f3fb-200d-2640':0, '1f9d4-1f3fc-200d-2640':0, '1f9d4-1f3fd-200d-2640':0, '1f9d4-1f3fe-200d-2640':0, '1f9d4-1f3ff-200d-2640':0, '1f9d4-1f3fb-200d-2642':0, '1f9d4-1f3fc-200d-2642':0, '1f9d4-1f3fd-200d-2642':0, '1f9d4-1f3fe-200d-2642':0, '1f9d4-1f3ff-200d-2642':0, '1f9d4-1f3fb':0, '1f9d4-1f3fc':0, '1f9d4-1f3fd':0, '1f9d4-1f3fe':0, '1f9d4-1f3ff':0, '1f9d5-1f3fb':0, '1f9d5-1f3fc':0, '1f9d5-1f3fd':0, '1f9d5-1f3fe':0, '1f9d5-1f3ff':0, '1f9d6-1f3fb-200d-2640':0, '1f9d6-1f3fc-200d-2640':0, '1f9d6-1f3fd-200d-2640':0, '1f9d6-1f3fe-200d-2640':0, '1f9d6-1f3ff-200d-2640':0, '1f9d6-1f3fb-200d-2642':0, '1f9d6-1f3fc-200d-2642':0, '1f9d6-1f3fd-200d-2642':0, '1f9d6-1f3fe-200d-2642':0, '1f9d6-1f3ff-200d-2642':0, '1f9d6-1f3fb':0, '1f9d6-1f3fc':0, '1f9d6-1f3fd':0, '1f9d6-1f3fe':0, '1f9d6-1f3ff':0, '1f9d7-1f3fb-200d-2640':0, '1f9d7-1f3fc-200d-2640':0, '1f9d7-1f3fd-200d-2640':0, '1f9d7-1f3fe-200d-2640':0, '1f9d7-1f3ff-200d-2640':0, '1f9d7-1f3fb-200d-2642':0, '1f9d7-1f3fc-200d-2642':0, '1f9d7-1f3fd-200d-2642':0, '1f9d7-1f3fe-200d-2642':0, '1f9d7-1f3ff-200d-2642':0, '1f9d7-1f3fb':0, '1f9d7-1f3fc':0, '1f9d7-1f3fd':0, '1f9d7-1f3fe':0, '1f9d7-1f3ff':0, '1f9d8-1f3fb-200d-2640':0, '1f9d8-1f3fc-200d-2640':0, '1f9d8-1f3fd-200d-2640':0, '1f9d8-1f3fe-200d-2640':0, '1f9d8-1f3ff-200d-2640':0, '1f9d8-1f3fb-200d-2642':0, '1f9d8-1f3fc-200d-2642':0, '1f9d8-1f3fd-200d-2642':0, '1f9d8-1f3fe-200d-2642':0, '1f9d8-1f3ff-200d-2642':0, '1f9d8-1f3fb':0, '1f9d8-1f3fc':0, '1f9d8-1f3fd':0, '1f9d8-1f3fe':0, '1f9d8-1f3ff':0, '1f9d9-1f3fb-200d-2640':0, '1f9d9-1f3fc-200d-2640':0, '1f9d9-1f3fd-200d-2640':0, '1f9d9-1f3fe-200d-2640':0, '1f9d9-1f3ff-200d-2640':0, '1f9d9-1f3fb-200d-2642':0, '1f9d9-1f3fc-200d-2642':0, '1f9d9-1f3fd-200d-2642':0, '1f9d9-1f3fe-200d-2642':0, '1f9d9-1f3ff-200d-2642':0, '1f9d9-1f3fb':0, '1f9d9-1f3fc':0, '1f9d9-1f3fd':0, '1f9d9-1f3fe':0, '1f9d9-1f3ff':0, '1f9da-1f3fb-200d-2640':0, '1f9da-1f3fc-200d-2640':0, '1f9da-1f3fd-200d-2640':0, '1f9da-1f3fe-200d-2640':0, '1f9da-1f3ff-200d-2640':0, '1f9da-1f3fb-200d-2642':0, '1f9da-1f3fc-200d-2642':0, '1f9da-1f3fd-200d-2642':0, '1f9da-1f3fe-200d-2642':0, '1f9da-1f3ff-200d-2642':0, '1f9da-1f3fb':0, '1f9da-1f3fc':0, '1f9da-1f3fd':0, '1f9da-1f3fe':0, '1f9da-1f3ff':0, '1f9db-1f3fb-200d-2640':0, '1f9db-1f3fc-200d-2640':0, '1f9db-1f3fd-200d-2640':0, '1f9db-1f3fe-200d-2640':0, '1f9db-1f3ff-200d-2640':0, '1f9db-1f3fb-200d-2642':0, '1f9db-1f3fc-200d-2642':0, '1f9db-1f3fd-200d-2642':0, '1f9db-1f3fe-200d-2642':0, '1f9db-1f3ff-200d-2642':0, '1f9db-1f3fb':0, '1f9db-1f3fc':0, '1f9db-1f3fd':0, '1f9db-1f3fe':0, '1f9db-1f3ff':0, '1f9dc-1f3fb-200d-2640':0, '1f9dc-1f3fc-200d-2640':0, '1f9dc-1f3fd-200d-2640':0, '1f9dc-1f3fe-200d-2640':0, '1f9dc-1f3ff-200d-2640':0, '1f9dc-1f3fb-200d-2642':0, '1f9dc-1f3fc-200d-2642':0, '1f9dc-1f3fd-200d-2642':0, '1f9dc-1f3fe-200d-2642':0, '1f9dc-1f3ff-200d-2642':0, '1f9dc-1f3fb':0, '1f9dc-1f3fc':0, '1f9dc-1f3fd':0, '1f9dc-1f3fe':0, '1f9dc-1f3ff':0, '1f9dd-1f3fb-200d-2640':0, '1f9dd-1f3fc-200d-2640':0, '1f9dd-1f3fd-200d-2640':0, '1f9dd-1f3fe-200d-2640':0, '1f9dd-1f3ff-200d-2640':0, '1f9dd-1f3fb-200d-2642':0, '1f9dd-1f3fc-200d-2642':0, '1f9dd-1f3fd-200d-2642':0, '1f9dd-1f3fe-200d-2642':0, '1f9dd-1f3ff-200d-2642':0, '1f9dd-1f3fb':0, '1f9dd-1f3fc':0, '1f9dd-1f3fd':0, '1f9dd-1f3fe':0, '1f9dd-1f3ff':0, '261d-1f3fb':0, '261d-1f3fc':0, '261d-1f3fd':0, '261d-1f3fe':0, '261d-1f3ff':0, '26f9-1f3fb-200d-2640':0, '26f9-1f3fc-200d-2640':0, '26f9-1f3fd-200d-2640':0, '26f9-1f3fe-200d-2640':0, '26f9-1f3ff-200d-2640':0, '26f9-1f3fb-200d-2642':0, '26f9-1f3fc-200d-2642':0, '26f9-1f3fd-200d-2642':0, '26f9-1f3fe-200d-2642':0, '26f9-1f3ff-200d-2642':0, '26f9-1f3fb':0, '26f9-1f3fc':0, '26f9-1f3fd':0, '26f9-1f3fe':0, '26f9-1f3ff':0, '270a-1f3fb':0, '270a-1f3fc':0, '270a-1f3fd':0, '270a-1f3fe':0, '270a-1f3ff':0, '270b-1f3fb':0, '270b-1f3fc':0, '270b-1f3fd':0, '270b-1f3fe':0, '270b-1f3ff':0, '270c-1f3fb':0, '270c-1f3fc':0, '270c-1f3fd':0, '270c-1f3fe':0, '270c-1f3ff':0, '270d-1f3fb':0, '270d-1f3fc':0, '270d-1f3fd':0, '270d-1f3fe':0, '270d-1f3ff':0}};\n\nconst Emoji: {[emoji: string]: number} = EmojiVersions[''];\nfor(const version in EmojiVersions) {\n  if(version) {\n    Object.assign(Emoji, EmojiVersions[version as EMOJI_VERSION]);\n  }\n}\n\nexport default Emoji;\n\n/* Emoji[\"00a9-fe0f\"] = 6362;\nEmoji[\"00ae-fe0f\"] = 6363;\nEmoji[\"2122-fe0f\"] = 6364; */\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport const FontFamily = 'Roboto, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen-Sans, Ubuntu, Cantarell, \"Helvetica Neue\", sans-serif';\nexport const FontSize = '16px';\nexport const FontWeight = '400';\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's animation.ts\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\n\r\ninterface AnimationInstance {\r\n  isCancelled: boolean;\r\n  deferred: CancellablePromise<void>\r\n}\r\n\r\ntype AnimationInstanceKey = any;\r\nconst instances: Map<AnimationInstanceKey, AnimationInstance> = new Map();\r\n\r\nexport function createAnimationInstance(key: AnimationInstanceKey) {\r\n  cancelAnimationByKey(key);\r\n\r\n  const instance: AnimationInstance = {\r\n    isCancelled: false,\r\n    deferred: deferredPromise<void>()\r\n  };\r\n\r\n  instances.set(key, instance);\r\n  instance.deferred.then(() => {\r\n    if(getAnimationInstance(key) === instance) {\r\n      instances.delete(key);\r\n    }\r\n  });\r\n\r\n  return instance;\r\n}\r\n\r\nexport function getAnimationInstance(key: AnimationInstanceKey) {\r\n  return instances.get(key);\r\n}\r\n\r\nexport function cancelAnimationByKey(key: AnimationInstanceKey) {\r\n  const instance = getAnimationInstance(key);\r\n  if(instance) {\r\n    instance.isCancelled = true;\r\n    instance.deferred.resolve();\r\n  }\r\n}\r\n\r\nexport function animateSingle(tick: Function, key: AnimationInstanceKey, instance?: AnimationInstance) {\r\n  if(!instance) {\r\n    instance = createAnimationInstance(key);\r\n  }\r\n\r\n  fastRaf(() => {\r\n    if(instance.isCancelled) {\r\n      return;\r\n    }\r\n\r\n    if(tick()) {\r\n      animateSingle(tick, key, instance);\r\n    } else {\r\n      instance.deferred.resolve();\r\n    }\r\n  });\r\n\r\n  return instance.deferred;\r\n}\r\n\r\nexport function animate(tick: Function) {\r\n  fastRaf(() => {\r\n    if(tick()) {\r\n      animate(tick);\r\n    }\r\n  });\r\n}\r\n","type K = boolean;\nexport default async function filterAsync<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => Promise<K> | K) {\n  const promises = arr.map(async(item, idx, arr) => {\n    if(await callback(item, idx, arr)) {\n      return item;\n    }\n  });\n\n  return (await Promise.all(promises)).filter(Boolean);\n}\n","export default function findAndSpliceAll<T>(array: Array<T>, verify: (value: T, index: number, arr: typeof array) => boolean) {\n  const out: typeof array = [];\n  let idx = -1;\n  while((idx = array.findIndex(verify)) !== -1) {\n    out.push(array.splice(idx, 1)[0]);\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nconst ASSETS_PATH = 'assets/audio/';\n\nexport default class AudioAssetPlayer<AssetName extends string> {\n  private audio: HTMLAudioElement;\n  private tempId: number;\n  private assetName: AssetName;\n\n  constructor(private assets: AssetName[]) {\n    this.tempId = 0;\n  }\n\n  public playSound(name: AssetName, loop = false) {\n    ++this.tempId;\n    this.assetName = name;\n\n    try {\n      const audio = this.createAudio();\n      audio.autoplay = true;\n      audio.src = ASSETS_PATH + name;\n      audio.loop = loop;\n      audio.play();\n    } catch(e) {\n      console.error('playSound', name, e);\n    }\n  }\n\n  public playSoundIfDifferent(name: AssetName, loop?: boolean) {\n    if(this.assetName !== name) {\n      this.playSound(name, loop);\n    }\n  }\n\n  public createAudio() {\n    let {audio} = this;\n    if(audio) {\n      return audio;\n    }\n\n    audio = this.audio = new Audio();\n    audio.play();\n    return audio;\n  }\n\n  public stopSound() {\n    if(!this.audio) {\n      return;\n    }\n\n    this.audio.pause();\n  }\n\n  public cancelDelayedPlay() {\n    ++this.tempId;\n  }\n\n  public playSoundWithTimeout(name: AssetName, loop: boolean, timeout: number) {\n    // timeout = 0;\n    const tempId = ++this.tempId;\n    setTimeout(() => {\n      if(this.tempId !== tempId) {\n        return;\n      }\n\n      this.playSound(name, loop);\n    }, timeout);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport readBlobAs from './readBlobAs';\n\nexport default function readBlobAsDataURL(blob: Blob) {\n  return readBlobAs(blob, 'readAsDataURL');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {getHeavyAnimationPromise} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf} from './schedulers';\r\nimport {ArgumentTypes} from '../types';\r\n\r\ntype HeavyQueue<T extends HeavyQueue<any>> = {\r\n  items: ArgumentTypes<T['process']>[],\r\n  process: (...args: any[]) => ReturnType<T['process']>,\r\n  context: any,\r\n  promise?: CancellablePromise<ReturnType<T['process']>[]>\r\n};\r\nconst heavyQueue: HeavyQueue<any>[] = [];\r\nlet processingQueue = false;\r\n\r\nexport default function addHeavyTask<T extends HeavyQueue<T>>(queue: T, method: 'push' | 'unshift' = 'push') {\r\n  if(!queue.items.length) {\r\n    return Promise.resolve([]) as typeof promise;\r\n  }\r\n\r\n  const promise = queue.promise = deferredPromise();\r\n  heavyQueue[method](queue);\r\n  processHeavyQueue();\r\n\r\n  return promise;\r\n}\r\n\r\nfunction processHeavyQueue() {\r\n  if(!processingQueue) {\r\n    const queue = heavyQueue.shift();\r\n    timedChunk(queue).finally(() => {\r\n      processingQueue = false;\r\n      if(heavyQueue.length) {\r\n        processHeavyQueue();\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction timedChunk<T extends HeavyQueue<T>>(queue: HeavyQueue<T>) {\r\n  if(!queue.items.length) {\r\n    queue.promise.resolve([] as any);\r\n    return Promise.resolve([]);\r\n  }\r\n\r\n  const todo = queue.items.slice();\r\n  const results: ReturnType<T['process']>[] = [];\r\n\r\n  return new Promise<typeof results>((resolve, reject) => {\r\n    const f = async() => {\r\n      const start = performance.now();\r\n\r\n      do {\r\n        await getHeavyAnimationPromise();\r\n        const possiblePromise = queue.process.apply(queue.context, todo.shift());\r\n        let realResult: typeof results[0];\r\n        // @ts-ignore\r\n        if(possiblePromise instanceof Promise) {\r\n          try {\r\n            realResult = await possiblePromise;\r\n          } catch(err) {\r\n            reject(err);\r\n            return;\r\n          }\r\n        } else {\r\n          realResult = possiblePromise;\r\n        }\r\n\r\n        results.push(realResult);\r\n      } while(todo.length > 0 && (performance.now() - start) < 6);\r\n\r\n      if(todo.length > 0) {\r\n        fastRaf(f);\r\n        // setTimeout(f, 25);\r\n      } else {\r\n        resolve(results);\r\n      }\r\n    };\r\n\r\n    fastRaf(f);\r\n    // setTimeout(f, 25);\r\n  }).then(queue.promise.resolve, queue.promise.reject);\r\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type fastBlur from '../vendor/fastBlur';\r\nimport addHeavyTask from './heavyQueue';\r\nimport IS_CANVAS_FILTER_SUPPORTED from '../environment/canvasFilterSupport';\r\n\r\nconst RADIUS = 2;\r\nconst ITERATIONS = 2;\r\n\r\nlet requireBlurPromise: Promise<any>;\r\nlet fastBlurFunc: typeof fastBlur;\r\nif(!IS_CANVAS_FILTER_SUPPORTED) {\r\n  requireBlurPromise = import('../vendor/fastBlur').then((m) => {\r\n    fastBlurFunc = m.default;\r\n  });\r\n} else {\r\n  requireBlurPromise = Promise.resolve();\r\n}\r\n\r\nfunction processBlurNext(\r\n  img: HTMLImageElement,\r\n  radius: number,\r\n  iterations: number,\r\n  canvas: HTMLCanvasElement = document.createElement('canvas')\r\n) {\r\n  canvas.width = img.width;\r\n  canvas.height = img.height;\r\n\r\n  const ctx = canvas.getContext('2d', {alpha: false});\r\n  if(IS_CANVAS_FILTER_SUPPORTED) {\r\n    ctx.filter = `blur(${radius}px)`;\r\n    ctx.drawImage(img, -radius * 2, -radius * 2, canvas.width + radius * 4, canvas.height + radius * 4);\r\n  } else {\r\n    ctx.drawImage(img, 0, 0);\r\n    fastBlurFunc(ctx, 0, 0, canvas.width, canvas.height, radius, iterations);\r\n  }\r\n\r\n  return canvas;\r\n}\r\n\r\ntype CacheValue = {canvas: HTMLCanvasElement, promise: Promise<void>};\r\nconst cache: Map<string, CacheValue> = new Map();\r\nconst CACHE_SIZE = 150;\r\n\r\nexport default function blur(dataUri: string, radius: number = RADIUS, iterations: number = ITERATIONS) {\r\n  if(!dataUri) {\r\n    throw 'no dataUri for blur: ' + dataUri;\r\n  }\r\n\r\n  if(cache.size > CACHE_SIZE) {\r\n    cache.clear();\r\n  }\r\n\r\n  const canvas = document.createElement('canvas');\r\n  canvas.className = 'canvas-thumbnail';\r\n\r\n  let cached = cache.get(dataUri);\r\n  if(!cached) {\r\n    const promise: CacheValue['promise'] = new Promise((resolve) => {\r\n      // return resolve(dataUri);\r\n      requireBlurPromise.then(() => {\r\n        const img = new Image();\r\n        img.onload = () => {\r\n          // if(IS_CANVAS_FILTER_SUPPORTED) {\r\n          // resolve(processBlurNext(img, radius, iterations));\r\n          // } else {\r\n          const promise = addHeavyTask({\r\n            items: [[img, radius, iterations, canvas]],\r\n            context: null,\r\n            process: processBlurNext\r\n          }, 'unshift');\r\n\r\n          promise.then(() => {\r\n            resolve();\r\n          });\r\n          // }\r\n        };\r\n        img.src = dataUri;\r\n      });\r\n    });\r\n\r\n    cache.set(dataUri, cached = {\r\n      canvas,\r\n      promise\r\n    });\r\n  } else {\r\n    canvas.width = cached.canvas.width;\r\n    canvas.height = cached.canvas.height;\r\n    cached.promise.then(() => {\r\n      canvas.getContext('2d').drawImage(cached.canvas, 0, 0, canvas.width, canvas.height);\r\n    });\r\n  }\r\n\r\n  return {\r\n    ...cached,\r\n    canvas\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport bytesFromHex from './bytesFromHex';\nimport bytesToDataURL from './bytesToDataURL';\n\nconst JPEG_HEADER = bytesFromHex('ffd8ffe000104a46494600010100000100010000ffdb004300281c1e231e19282321232d2b28303c64413c37373c7b585d4964918099968f808c8aa0b4e6c3a0aadaad8a8cc8ffcbdaeef5ffffff9bc1fffffffaffe6fdfff8ffdb0043012b2d2d3c353c76414176f8a58ca5f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8f8ffc00011080000000003012200021101031101ffc4001f0000010501010101010100000000000000000102030405060708090a0bffc400b5100002010303020403050504040000017d01020300041105122131410613516107227114328191a1082342b1c11552d1f02433627282090a161718191a25262728292a3435363738393a434445464748494a535455565758595a636465666768696a737475767778797a838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae1e2e3e4e5e6e7e8e9eaf1f2f3f4f5f6f7f8f9faffc4001f0100030101010101010101010000000000000102030405060708090a0bffc400b51100020102040403040705040400010277000102031104052131061241510761711322328108144291a1b1c109233352f0156272d10a162434e125f11718191a262728292a35363738393a434445464748494a535455565758595a636465666768696a737475767778797a82838485868788898a92939495969798999aa2a3a4a5a6a7a8a9aab2b3b4b5b6b7b8b9bac2c3c4c5c6c7c8c9cad2d3d4d5d6d7d8d9dae2e3e4e5e6e7e8e9eaf2f3f4f5f6f7f8f9faffda000c03010002110311003f00');\nconst JPEG_TAIL = bytesFromHex('ffd9');\n\nexport default function getPreviewURLFromBytes(bytes: Uint8Array | number[], isSticker = false) {\n  let arr: Uint8Array;\n  if(!isSticker) {\n    arr = new Uint8Array(JPEG_HEADER.concat(Array.from(bytes.slice(3)), JPEG_TAIL));\n    arr[164] = bytes[1];\n    arr[166] = bytes[2];\n  } else {\n    arr = bytes instanceof Uint8Array ? bytes : new Uint8Array(bytes);\n  }\n\n  let mimeType: string;\n  if(isSticker) {\n    mimeType = IS_SAFARI ? 'image/png' : 'image/webp';\n  } else {\n    mimeType = 'image/jpeg';\n  }\n\n  return bytesToDataURL(arr, mimeType);\n}\n","export default function bytesToDataURL(bytes: Uint8Array, mimeType: string = 'image/jpeg') {\n  return `data:${mimeType};base64,${btoa(String.fromCharCode(...bytes))}`;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport {makeMediaSize} from './mediaSize';\r\n\r\nexport default function calcImageInBox(imageW: number, imageH: number, boxW: number, boxH: number, noZoom = true) {\r\n  if(imageW < boxW && imageH < boxH && noZoom) {\r\n    return makeMediaSize(imageW, imageH);\r\n  }\r\n\r\n  let boxedImageW = boxW;\r\n  let boxedImageH = boxH;\r\n\r\n  if((imageW / imageH) > (boxW / boxH)) {\r\n    boxedImageH = (imageH * boxW / imageW) | 0;\r\n  } else {\r\n    boxedImageW = (imageW * boxH / imageH) | 0;\r\n    if(boxedImageW > boxW) {\r\n      boxedImageH = (boxedImageH * boxW / boxedImageW) | 0;\r\n      boxedImageW = boxW;\r\n    }\r\n  }\r\n\r\n  // if (Config.Navigator.retina) {\r\n  //   imageW = Math.floor(imageW / 2)\r\n  //   imageH = Math.floor(imageH / 2)\r\n  // }\r\n\r\n  if(noZoom && boxedImageW >= imageW && boxedImageH >= imageH) {\r\n    boxedImageW = imageW;\r\n    boxedImageH = imageH;\r\n  }\r\n\r\n  return makeMediaSize(boxedImageW, boxedImageH);\r\n}\r\n\r\nMOUNT_CLASS_TO.calcImageInBox = calcImageInBox;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\n// import { MOUNT_CLASS_TO } from \"../../config/debug\";\n\nlet context: CanvasRenderingContext2D;\n/**\n * Get the text width\n * @param {string} text\n * @param {string} font\n */\nexport default function getTextWidth(text: string, font: string) {\n  // const perf = performance.now();\n  if(!context) {\n    const canvas = document.createElement('canvas');\n    context = canvas.getContext('2d', {alpha: false});\n    context.font = font;\n  }\n\n  // context.font = font;\n  const metrics = context.measureText(text);\n  // console.log('getTextWidth perf:', performance.now() - perf);\n  return metrics.width;\n  // return Math.round(metrics.width);\n}\n\n// MOUNT_CLASS_TO && (MOUNT_CLASS_TO.getTextWidth = getTextWidth);\n","import type {MediaSize} from '../mediaSize';\n\nexport default function scaleMediaElement(options: {\n  media: CanvasImageSource,\n  mediaSize?: MediaSize,\n  boxSize?: MediaSize,\n  quality?: number,\n  mimeType?: 'image/jpeg' | 'image/png',\n  size?: MediaSize\n}): Promise<{blob: Blob, size: MediaSize}> {\n  return new Promise((resolve) => {\n    const canvas = document.createElement('canvas');\n    const size = options.size ?? options.mediaSize.aspectFitted(options.boxSize);\n    canvas.width = size.width * window.devicePixelRatio;\n    canvas.height = size.height * window.devicePixelRatio;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(options.media, 0, 0, canvas.width, canvas.height);\n    canvas.toBlob((blob) => {\n      resolve({blob, size});\n    }, options.mimeType ?? 'image/jpeg', options.quality ?? 1);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nimport LatinizeMap from '../config/latinizeMap';\n\nexport const badCharsRe = /[`~!@#$%^&*()\\-_=+\\[\\]\\\\|{}'\";:\\/?.>,<]+/g;\nconst trimRe = /^\\s+|\\s$/g;\n\nconst C2L: {[k: string]: string} = {\n  '': 'q',\n  '': 'w',\n  '': 'e',\n  '': 'r',\n  '': 't',\n  '': 'y',\n  '': 'u',\n  '': 'i',\n  '': 'o',\n  '': 'p',\n  '': '[',\n  '': ']',\n  '': 'a',\n  '': 's',\n  '': 'd',\n  '': 'f',\n  '': 'g',\n  '': 'h',\n  '': 'j',\n  '': 'k',\n  '': 'l',\n  '': ';',\n  '': '\\'',\n  '': 'z',\n  '': 'x',\n  '': 'c',\n  '': 'v',\n  '': 'b',\n  '': 'n',\n  '': 'm',\n  '': ',',\n  '': '.',\n  '.': '/'\n};\n\nexport function clearBadCharsAndTrim(text: string) {\n  return text.replace(badCharsRe, '').replace(trimRe, '');\n}\n\nexport function fixCyrillic(text: string) {\n  return text.toLowerCase().replace(/[\\w-]/g, (ch) => {\n    const latinizeCh = C2L[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport function latinizeString(text: string) {\n  return text.replace(/[^A-Za-z0-9]/g, (ch) => {\n    const latinizeCh = LatinizeMap[ch];\n    return latinizeCh ?? ch;\n  });\n}\n\nexport default function cleanSearchText(text: string, latinize = true) {\n  return processSearchText(text, {\n    clearBadChars: true,\n    latinize,\n    ignoreCase: true\n  });\n}\n\nexport type ProcessSearchTextOptions = Partial<{\n  clearBadChars: boolean,\n  latinize: boolean,\n  ignoreCase: boolean,\n  includeTag: boolean\n}>;\n\nexport function processSearchText(text: string, options: ProcessSearchTextOptions = {}) {\n  const hasTag = options.includeTag && text.charAt(0) === '%';\n  const originalText = text;\n  if(options.clearBadChars) text = clearBadCharsAndTrim(text);\n  if(options.latinize) text = latinizeString(text);\n  if(options.ignoreCase) text = text.toLowerCase();\n  if(hasTag) text = '%' + text;\n  if(options.latinize) text += '\\x01' + fixCyrillic(originalText);\n  return text;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// https://stackoverflow.com/a/30810322\r\nfunction fallbackCopyTextToClipboard(text: string) {\r\n  var textArea = document.createElement('textarea');\r\n  textArea.value = text;\r\n\r\n  // Avoid scrolling to bottom\r\n  textArea.style.top = '0';\r\n  textArea.style.left = '0';\r\n  textArea.style.position = 'fixed';\r\n\r\n  document.body.appendChild(textArea);\r\n  textArea.focus();\r\n  textArea.select();\r\n\r\n  try {\r\n    document.execCommand('copy');\r\n    // const successful = document.execCommand('copy');\r\n    // const msg = successful ? 'successful' : 'unsuccessful';\r\n    // console.log('Fallback: Copying text command was ' + msg);\r\n  } catch(err) {\r\n    // console.error('Fallback: Oops, unable to copy', err);\r\n  }\r\n\r\n  document.body.removeChild(textArea);\r\n}\r\n\r\nexport function copyTextToClipboard(text: string) {\r\n  if(!navigator.clipboard) {\r\n    fallbackCopyTextToClipboard(text);\r\n    return;\r\n  }\r\n\r\n  navigator.clipboard.writeText(text);/* .then(function() {\r\n    console.log('Async: Copying to clipboard was successful!');\r\n  }, function(err) {\r\n    console.error('Async: Could not copy text: ', err);\r\n  }); */\r\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport mediaSizes from './mediaSizes';\nimport OverlayClickHandler from './overlayClickHandler';\n\nclass ContextMenuController extends OverlayClickHandler {\n  constructor() {\n    super('menu', true);\n\n    mediaSizes.addEventListener('resize', () => {\n      if(this.element) {\n        this.close();\n      }\n\n      /* if(openedMenu && (openedMenu.style.top || openedMenu.style.left)) {\n        const rect = openedMenu.getBoundingClientRect();\n        const {innerWidth, innerHeight} = window;\n\n        console.log(innerWidth, innerHeight, rect);\n      } */\n    });\n  }\n\n  public isOpened() {\n    return !!this.element;\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const rect = this.element.getBoundingClientRect();\n    const {clientX, clientY} = e;\n\n    const diffX = clientX >= rect.right ? clientX - rect.right : rect.left - clientX;\n    const diffY = clientY >= rect.bottom ? clientY - rect.bottom : rect.top - clientY;\n\n    if(diffX >= 100 || diffY >= 100) {\n      this.close();\n      // openedMenu.parentElement.click();\n    }\n    // console.log('mousemove', diffX, diffY);\n  };\n\n  public close() {\n    if(this.element) {\n      this.element.classList.remove('active');\n      this.element.parentElement.classList.remove('menu-open');\n    }\n\n    super.close();\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.removeEventListener('mousemove', this.onMouseMove);\n    }\n  }\n\n  public openBtnMenu(element: HTMLElement, onClose?: () => void) {\n    super.open(element);\n\n    this.element.classList.add('active');\n    this.element.parentElement.classList.add('menu-open');\n\n    if(onClose) {\n      this.addEventListener('toggle', onClose, {once: true});\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      window.addEventListener('mousemove', this.onMouseMove);\n    }\n  }\n}\n\nconst contextMenuController = new ContextMenuController();\nexport default contextMenuController;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport I18n, {i18n} from '../lib/langPack';\r\n\r\nexport const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\r\nexport const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];\r\n\r\nexport const ONE_DAY = 86400;\r\n\r\n// https://stackoverflow.com/a/6117889\r\nexport const getWeekNumber = (date: Date) => {\r\n  const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));\r\n  const dayNum = d.getUTCDay() || 7;\r\n  d.setUTCDate(d.getUTCDate() + 4 - dayNum);\r\n  const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));\r\n  return Math.ceil((((d.getTime() - yearStart.getTime()) / ONE_DAY) + 1) / 7);\r\n};\r\n\r\nexport function formatDateAccordingToTodayNew(time: Date) {\r\n  const today = new Date();\r\n  const now = today.getTime() / 1000 | 0;\r\n  const timestamp = time.getTime() / 1000 | 0;\r\n\r\n  const options: Intl.DateTimeFormatOptions = {};\r\n  if((now - timestamp) < ONE_DAY && today.getDate() === time.getDate()) { // if the same day\r\n    options.hour = options.minute = '2-digit';\r\n  } else if(today.getFullYear() !== time.getFullYear()) { // different year\r\n    options.year = options.day = 'numeric';\r\n    options.month = '2-digit';\r\n  } else if((now - timestamp) < (ONE_DAY * 7) && getWeekNumber(today) === getWeekNumber(time)) { // current week\r\n    options.weekday = 'short';\r\n  } else { // same year\r\n    options.month = 'short';\r\n    options.day = 'numeric';\r\n  }\r\n\r\n  return new I18n.IntlDateElement({\r\n    date: time,\r\n    options\r\n  }).element;\r\n}\r\n\r\nexport function formatFullSentTimeRaw(timestamp: number, options: {\r\n  capitalize?: boolean\r\n} = {}) {\r\n  const date = new Date();\r\n  const time = new Date(timestamp * 1000);\r\n  const now = date.getTime() / 1000;\r\n\r\n  const timeEl = formatTime(time);\r\n\r\n  let dateEl: Node | string;\r\n  if((now - timestamp) < ONE_DAY && date.getDate() === time.getDate()) { // if the same day\r\n    dateEl = i18n(options.capitalize ? 'Date.Today' : 'Peer.Status.Today');\r\n  } else if((now - timestamp) < (ONE_DAY * 2) && (date.getDate() - 1) === time.getDate()) { // yesterday\r\n    dateEl = i18n(options.capitalize ? 'Yesterday' : 'Peer.Status.Yesterday');\r\n\r\n    if(options.capitalize) {\r\n      (dateEl as HTMLElement).style.textTransform = 'capitalize';\r\n    }\r\n  } else if(date.getFullYear() !== time.getFullYear()) { // different year\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate() + ', ' + time.getFullYear();\r\n  } else {\r\n    dateEl = new I18n.IntlDateElement({\r\n      date: time,\r\n      options: {\r\n        month: 'short',\r\n        day: 'numeric'\r\n      }\r\n    }).element;\r\n    // dateStr = months[time.getMonth()].slice(0, 3) + ' ' + time.getDate();\r\n  }\r\n\r\n  return {dateEl, timeEl};\r\n}\r\n\r\nexport function formatFullSentTime(timestamp: number) {\r\n  const {dateEl, timeEl} = formatFullSentTimeRaw(timestamp, {\r\n    capitalize: true\r\n  });\r\n\r\n  const fragment = document.createDocumentFragment();\r\n  fragment.append(dateEl, ' ', i18n('ScheduleController.at'), ' ', timeEl);\r\n  return fragment;\r\n}\r\n\r\nexport function formatTime(date: Date) {\r\n  return new I18n.IntlDateElement({\r\n    date,\r\n    options: {\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    }\r\n  }).element;\r\n}\r\n\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.formatDateAccordingToTodayNew = formatDateAccordingToTodayNew);\r\n\r\nexport const getFullDate = (date: Date, options: Partial<{\r\n  noTime: true,\r\n  noSeconds: true,\r\n  monthAsNumber: true,\r\n  leadingZero: true\r\n}> = {}) => {\r\n  const joiner = options.monthAsNumber ? '.' : ' ';\r\n  const time = ('0' + date.getHours()).slice(-2) + ':' + ('0' + date.getMinutes()).slice(-2) + (options.noSeconds ? '' : ':' + ('0' + date.getSeconds()).slice(-2));\r\n\r\n  return (options.leadingZero ? ('0' + date.getDate()).slice(-2) : date.getDate()) +\r\n    joiner + (options.monthAsNumber ? ('0' + (date.getMonth() + 1)).slice(-2) : months[date.getMonth()]) +\r\n    joiner + date.getFullYear() +\r\n    (options.noTime ? '' : ', ' + time);\r\n};\r\n\r\n// https://github.com/DrKLO/Telegram/blob/d52b2c921abd3c1e8d6368858313ad0cb0468c07/TMessagesProj/src/main/java/org/telegram/ui/Adapters/FiltersView.java\r\nconst minYear = 2013;\r\nconst yearPattern = new RegExp('20[0-9]{1,2}');\r\nconst monthYearOrDayPattern = new RegExp('(\\\\w{3,}) ([0-9]{0,4})', 'i');\r\nconst yearOrDayAndMonthPattern = new RegExp('([0-9]{0,4}) (\\\\w{2,})', 'i');\r\nconst shortDate = new RegExp('^([0-9]{1,4})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst longDate = new RegExp('^([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,2})(\\\\.| |/|\\\\-)([0-9]{1,4})$', 'i');\r\nconst numberOfDaysEachMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\r\nexport type DateData = {\r\n  title: string,\r\n  minDate: number,\r\n  maxDate: number,\r\n};\r\nexport function fillTipDates(query: string, dates: DateData[]) {\r\n  const q = query.trim().toLowerCase();\r\n\r\n  if(q.length < 3) {\r\n    return;\r\n  }\r\n\r\n  if('today'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: 'Today',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  if('yesterday'.indexOf(q) === 0) {\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime() - 86400000;\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 86400001;\r\n    dates.push({\r\n      title: 'Yesterday',\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  const dayOfWeek = getDayOfWeek(q);\r\n  if(dayOfWeek >= 0) {\r\n    const date = new Date();\r\n    const now = date.getTime();\r\n    const currentDay = date.getDay();\r\n    const distance = dayOfWeek - currentDay;\r\n    date.setDate(date.getDate() + distance);\r\n    if(date.getTime() > now) {\r\n      date.setTime(date.getTime() - 604800000);\r\n    }\r\n    const year = date.getFullYear()\r\n    const month = date.getMonth();\r\n    const day = date.getDate();\r\n    date.setFullYear(year, month, day);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const minDate = date.getTime();\r\n    date.setFullYear(year, month, day + 1);\r\n    date.setHours(0, 0, 0);\r\n\r\n    const maxDate = date.getTime() - 1;\r\n    dates.push({\r\n      title: formatWeekLong(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n    return;\r\n  }\r\n\r\n  let matches: any[];\r\n  if((matches = shortDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const k = parseInt(g1);\r\n    const k1 = parseInt(g2);\r\n    if(k > 0 && k <= 31) {\r\n      if(k1 >= minYear && k <= 12) {\r\n        const selectedYear = k1;\r\n        const month = k - 1;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      } else if(k1 <= 12) {\r\n        const day = k - 1;\r\n        const month = k1 - 1;\r\n        createForDayMonth(dates, day, month);\r\n      }\r\n    } else if(k >= minYear && k1 <= 12) {\r\n      const selectedYear = k;\r\n      const month = k1 - 1;\r\n      createForMonthYear(dates, month, selectedYear);\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = longDate.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[3];\r\n    const g3 = matches[5];\r\n    if(!matches[2] === matches[4]) {\r\n      return;\r\n    }\r\n\r\n    const day = parseInt(g1);\r\n    const month = parseInt(g2) - 1;\r\n    let year = parseInt(g3);\r\n    if(year >= 10 && year <= 99) {\r\n      year += 2000;\r\n    }\r\n\r\n    const currentYear = new Date().getFullYear();\r\n    if(validDateForMonth(day - 1, month) && year >= minYear && year <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(year, month, day);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(year, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: formatterYearMax(minDate),\r\n        minDate,\r\n        maxDate\r\n      });\r\n      return;\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = yearPattern.exec(q)) !== null) {\r\n    let selectedYear = +q;\r\n    const currentYear = new Date().getFullYear();\r\n    if(selectedYear < minYear) {\r\n      selectedYear = minYear;\r\n      for(let i = currentYear; i >= selectedYear; i--) {\r\n        const date = new Date();\r\n        date.setFullYear(i, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const minDate = date.getTime();\r\n        date.setFullYear(i + 1, 0, 1);\r\n        date.setHours(0, 0, 0);\r\n\r\n        const maxDate = date.getTime() - 1;\r\n        dates.push({\r\n          title: '' + i,\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    } else if(selectedYear <= currentYear) {\r\n      const date = new Date();\r\n      date.setFullYear(selectedYear, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      date.setFullYear(selectedYear + 1, 0, 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const maxDate = date.getTime() - 1;\r\n      dates.push({\r\n        title: '' + selectedYear,\r\n        minDate,\r\n        maxDate\r\n      });\r\n    }\r\n\r\n    return;\r\n  }\r\n\r\n  if((matches = monthYearOrDayPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g1);\r\n    if(month >= 0) {\r\n      const k = +g2;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  if((matches = yearOrDayAndMonthPattern.exec(q)) !== null) {\r\n    const g1 = matches[1];\r\n    const g2 = matches[2];\r\n    const month = getMonth(g2);\r\n    if(month >= 0) {\r\n      const k = +g1;\r\n      if(k > 0 && k <= 31) {\r\n        const day = k - 1;\r\n        createForDayMonth(dates, day, month);\r\n        return;\r\n      } else if(k >= minYear) {\r\n        const selectedYear = k;\r\n        createForMonthYear(dates, month, selectedYear);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction createForMonthYear(dates: DateData[], month: number, selectedYear: number) {\r\n  const currentYear = new Date().getFullYear();\r\n  const today = Date.now();\r\n  if(selectedYear >= minYear && selectedYear <= currentYear) {\r\n    const date = new Date();\r\n    date.setFullYear(selectedYear, month, 1);\r\n    date.setHours(0, 0, 0);\r\n    const minDate = date.getTime();\r\n    if(minDate > today) {\r\n      return;\r\n    }\r\n    date.setMonth(date.getMonth() + 1);\r\n    const maxDate = date.getTime() - 1;\r\n\r\n    dates.push({\r\n      title: formatterMonthYear(minDate),\r\n      minDate,\r\n      maxDate\r\n    });\r\n  }\r\n}\r\n\r\nfunction createForDayMonth(dates: DateData[], day: number, month: number) {\r\n  if(validDateForMonth(day, month)) {\r\n    const currentYear = new Date().getFullYear();\r\n    const today = Date.now();\r\n\r\n    for(let i = currentYear; i >= minYear; i--) {\r\n      if(month === 1 && day === 28 && !isLeapYear(i)) {\r\n        continue;\r\n      }\r\n\r\n      const date = new Date();\r\n      date.setFullYear(i, month, day + 1);\r\n      date.setHours(0, 0, 0);\r\n\r\n      const minDate = date.getTime();\r\n      if(minDate > today) {\r\n        continue;\r\n      }\r\n\r\n      date.setFullYear(i, month, day + 2);\r\n      date.setHours(0, 0, 0);\r\n      const maxDate = date.getTime() - 1;\r\n      if(i === currentYear) {\r\n        dates.push({\r\n          title: formatterDayMonth(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      } else {\r\n        dates.push({\r\n          title: formatterYearMax(minDate),\r\n          minDate,\r\n          maxDate\r\n        });\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction formatterMonthYear(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getFullYear();\r\n}\r\n\r\nfunction formatterDayMonth(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return months[date.getMonth()].slice(0, 3) + ' ' + date.getDate();\r\n}\r\n\r\nfunction formatterYearMax(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return ('0' + date.getDate()).slice(-2) + '.' + ('0' + (date.getMonth() + 1)).slice(-2) + '.' + date.getFullYear();\r\n}\r\n\r\nfunction formatWeekLong(timestamp: number) {\r\n  const date = new Date(timestamp);\r\n  return days[date.getDay()];\r\n}\r\n\r\nfunction validDateForMonth(day: number, month: number) {\r\n  if(month >= 0 && month < 12) {\r\n    if(day >= 0 && day < numberOfDaysEachMonth[month]) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n}\r\n\r\nfunction isLeapYear(year: number) {\r\n  return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);\r\n}\r\n\r\nfunction getMonth(q: string) {\r\n  /* String[] months = new String[]{\r\n          LocaleController.getString(\"January\", R.string.January).toLowerCase(),\r\n          LocaleController.getString(\"February\", R.string.February).toLowerCase(),\r\n          LocaleController.getString(\"March\", R.string.March).toLowerCase(),\r\n          LocaleController.getString(\"April\", R.string.April).toLowerCase(),\r\n          LocaleController.getString(\"May\", R.string.May).toLowerCase(),\r\n          LocaleController.getString(\"June\", R.string.June).toLowerCase(),\r\n          LocaleController.getString(\"July\", R.string.July).toLowerCase(),\r\n          LocaleController.getString(\"August\", R.string.August).toLowerCase(),\r\n          LocaleController.getString(\"September\", R.string.September).toLowerCase(),\r\n          LocaleController.getString(\"October\", R.string.October).toLowerCase(),\r\n          LocaleController.getString(\"November\", R.string.November).toLowerCase(),\r\n          LocaleController.getString(\"December\", R.string.December).toLowerCase()\r\n  }; */\r\n\r\n  /* String[] monthsEng = new String[12];\r\n  Calendar c = Calendar.getInstance();\r\n  for (int i = 1; i <= 12; i++) {\r\n      c.set(0, 0, 0, 0, 0, 0);\r\n      c.set(Calendar.MONTH, i);\r\n      monthsEng[i - 1] = c.getDisplayName(Calendar.MONTH, Calendar.LONG, Locale.ENGLISH).toLowerCase();\r\n  } */\r\n\r\n  q = q.toLowerCase();\r\n  for(let i = 0; i < 12; i++) {\r\n    const month = months[i].toLowerCase();\r\n    if(month.indexOf(q) === 0) {\r\n      return i;\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nfunction getDayOfWeek(q: string) {\r\n  const c = new Date();\r\n  if(q.length <= 3) {\r\n    return -1;\r\n  }\r\n\r\n  for(let i = 0; i < 7; i++) {\r\n    c.setDate(c.getDate() + 1);\r\n\r\n    if(formatWeekLong(c.getTime()).toLowerCase().indexOf(q) === 0) {\r\n      return c.getDay();\r\n    }\r\n  }\r\n  return -1;\r\n}\r\n\r\nMOUNT_CLASS_TO.fillTipDates = fillTipDates;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_APPLE} from '../../environment/userAgent';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport cancelEvent from './cancelEvent';\n\nlet _cancelContextMenuOpening = false, _cancelContextMenuOpeningTimeout = 0;\nexport function cancelContextMenuOpening() {\n  if(_cancelContextMenuOpeningTimeout) {\n    clearTimeout(_cancelContextMenuOpeningTimeout);\n  }\n\n  _cancelContextMenuOpeningTimeout = window.setTimeout(() => {\n    _cancelContextMenuOpeningTimeout = 0;\n    _cancelContextMenuOpening = false;\n  }, .4e3);\n\n  _cancelContextMenuOpening = true;\n}\n\nexport function attachContextMenuListener(element: HTMLElement, callback: (e: Touch | MouseEvent) => void, listenerSetter?: ListenerSetter) {\n  const add = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, element) : element.removeEventListener.bind(element);\n\n  if(IS_APPLE && IS_TOUCH_SUPPORTED) {\n    let timeout: number;\n\n    const options: EventListenerOptions = {capture: true};\n\n    const onCancel = () => {\n      clearTimeout(timeout);\n      // @ts-ignore\n      remove('touchmove', onCancel, options);\n      // @ts-ignore\n      remove('touchend', onCancel, options);\n      // @ts-ignore\n      remove('touchcancel', onCancel, options);\n    };\n\n    add('touchstart', (e: TouchEvent) => {\n      if(e.touches.length > 1) {\n        onCancel();\n        return;\n      }\n\n      add('touchmove', onCancel, options);\n      add('touchend', onCancel, options);\n      add('touchcancel', onCancel, options);\n\n      timeout = window.setTimeout(() => {\n        if(_cancelContextMenuOpening) {\n          onCancel();\n          return;\n        }\n\n        callback(e.touches[0]);\n        onCancel();\n\n        if(contextMenuController.isOpened()) {\n          element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n        }\n      }, .4e3);\n    });\n\n    /* if(!isSafari) {\n      add('contextmenu', (e: any) => {\n        cancelEvent(e);\n      }, {passive: false, capture: true});\n    } */\n  } else {\n    add('contextmenu', IS_TOUCH_SUPPORTED ? (e: any) => {\n      callback(e);\n\n      if(contextMenuController.isOpened()) {\n        element.addEventListener('touchend', cancelEvent, {once: true}); // * fix instant closing\n      }\n    } : callback);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type GrabEvent = {x: number, y: number, isTouch?: boolean, event: TouchEvent | MouseEvent};\r\n\r\nexport default function attachGrabListeners(element: HTMLElement,\r\n  onStart: (position: GrabEvent) => void,\r\n  onMove: (position: GrabEvent) => void,\r\n  onEnd?: (position: GrabEvent) => void) {\r\n  // * Mouse\r\n  const onMouseMove = (event: MouseEvent) => {\r\n    onMove({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseUp = (event: MouseEvent) => {\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    element.addEventListener('mousedown', onMouseDown, {once: true});\r\n    onEnd && onEnd({x: event.pageX, y: event.pageY, event});\r\n  };\r\n\r\n  const onMouseDown = (event: MouseEvent) => {\r\n    if(event.button !== 0) {\r\n      element.addEventListener('mousedown', onMouseDown, {once: true});\r\n      return;\r\n    }\r\n\r\n    onStart({x: event.pageX, y: event.pageY, event});\r\n    onMouseMove(event);\r\n\r\n    document.addEventListener('mousemove', onMouseMove);\r\n    document.addEventListener('mouseup', onMouseUp, {once: true});\r\n  };\r\n\r\n  element.addEventListener('mousedown', onMouseDown, {once: true});\r\n\r\n  // * Touch\r\n  const onTouchMove = (event: TouchEvent) => {\r\n    event.preventDefault();\r\n    onMove({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchEnd = (event: TouchEvent) => {\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n    onEnd && onEnd({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n  };\r\n\r\n  const onTouchStart = (event: TouchEvent) => {\r\n    onStart({x: event.touches[0].clientX, y: event.touches[0].clientY, isTouch: true, event});\r\n    onTouchMove(event);\r\n\r\n    document.addEventListener('touchmove', onTouchMove, {passive: false});\r\n    document.addEventListener('touchend', onTouchEnd, {passive: false, once: true});\r\n  };\r\n\r\n  element.addEventListener('touchstart', onTouchStart, {passive: false, once: true});\r\n\r\n  return () => {\r\n    element.removeEventListener('mousedown', onMouseDown);\r\n    document.removeEventListener('mousemove', onMouseMove);\r\n    document.removeEventListener('mouseup', onMouseUp);\r\n\r\n    element.removeEventListener('touchstart', onTouchStart);\r\n    document.removeEventListener('touchmove', onTouchMove);\r\n    document.removeEventListener('touchend', onTouchEnd);\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function cancelSelection() {\r\n  if(window.getSelection) {\r\n    if(window.getSelection().empty) {  // Chrome\r\n      window.getSelection().empty();\r\n    } else if(window.getSelection().removeAllRanges) {  // Firefox\r\n      window.getSelection().removeAllRanges();\r\n    }\r\n    // @ts-ignore\r\n  } else if(document.selection) {  // IE?\r\n    // @ts-ignore\r\n    document.selection.empty();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport simulateEvent from './dispatchEvent';\r\n\r\nexport const CLICK_EVENT_NAME: 'mousedown' /* | 'touchend' */ | 'click' = (IS_TOUCH_SUPPORTED ? 'mousedown' : 'click') as any;\r\nexport type AttachClickOptions = AddEventListenerOptions & Partial<{listenerSetter: ListenerSetter, touchMouseDown: true}>;\r\nexport function attachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options: AttachClickOptions = {}) {\r\n  const add = options.listenerSetter ? options.listenerSetter.add(elem) : elem.addEventListener.bind(elem);\r\n  // const remove = options.listenerSetter ? options.listenerSetter.removeManual.bind(options.listenerSetter, elem) : elem.removeEventListener.bind(elem);\r\n\r\n  options.touchMouseDown = true;\r\n  /* if(options.touchMouseDown && CLICK_EVENT_NAME === 'touchend') {\r\n    add('mousedown', callback, options);\r\n  } else if(CLICK_EVENT_NAME === 'touchend') {\r\n    const o = {...options, once: true};\r\n\r\n    const onTouchStart = (e: TouchEvent) => {\r\n      const onTouchMove = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        remove('touchend', onTouchEnd, o);\r\n      };\r\n\r\n      const onTouchEnd = (e: TouchEvent) => {\r\n        remove('touchmove', onTouchMove, o);\r\n        callback(e);\r\n        if(options.once) {\r\n          remove('touchstart', onTouchStart);\r\n        }\r\n      };\r\n\r\n      add('touchend', onTouchEnd, o);\r\n      add('touchmove', onTouchMove, o);\r\n    };\r\n\r\n    add('touchstart', onTouchStart);\r\n  } else {\r\n    add(CLICK_EVENT_NAME, callback, options);\r\n  } */\r\n  add(CLICK_EVENT_NAME, callback, options);\r\n}\r\n\r\nexport function detachClickEvent(elem: HTMLElement | Window, callback: (e: /* TouchEvent |  */MouseEvent) => void, options?: AddEventListenerOptions) {\r\n  // if(CLICK_EVENT_NAME === 'touchend') {\r\n  //   elem.removeEventListener('touchstart', callback, options);\r\n  // } else {\r\n  elem.removeEventListener(CLICK_EVENT_NAME, callback as any, options);\r\n  // }\r\n}\r\n\r\nexport function simulateClickEvent(elem: HTMLElement) {\r\n  simulateEvent(elem, CLICK_EVENT_NAME);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport EventListenerBase from '../eventListenerBase';\nimport ListenerSetter from '../listenerSetter';\nimport safeAssign from '../object/safeAssign';\nimport findUpClassName from './findUpClassName';\n\nexport default class ControlsHover extends EventListenerBase<{\n  toggleControls: (show: boolean) => void\n}> {\n  protected hideControlsTimeout: number;\n  protected controlsLocked: boolean;\n\n  protected canHideControls: () => boolean;\n  protected element: HTMLElement;\n  protected listenerSetter: ListenerSetter;\n  protected showOnLeaveToClassName: string;\n  protected ignoreClickClassName: string;\n\n  constructor() {\n    super(false);\n    this.hideControlsTimeout = 0;\n  }\n\n  public setup(options: {\n    element: HTMLElement,\n    listenerSetter: ListenerSetter,\n    canHideControls?: () => boolean,\n    showOnLeaveToClassName?: string,\n    ignoreClickClassName?: string\n  }) {\n    safeAssign(this, options);\n\n    const {listenerSetter, element} = this;\n\n    if(IS_TOUCH_SUPPORTED) {\n      listenerSetter.add(element)('click', (e) => {\n        if(this.ignoreClickClassName && findUpClassName(e.target, this.ignoreClickClassName)) {\n          return;\n        }\n\n        this.toggleControls();\n      });\n\n      /* listenerSetter.add(player)('touchstart', () => {\n        showControls(false);\n      });\n\n      listenerSetter.add(player)('touchend', () => {\n        if(player.classList.contains('is-playing')) {\n          showControls();\n        }\n      }); */\n    } else {\n      listenerSetter.add(element)('mousemove', () => {\n        this.showControls();\n      });\n\n      listenerSetter.add(element)('mouseenter', () => {\n        this.showControls(false);\n      });\n\n      listenerSetter.add(element)('mouseleave', (e) => {\n        if(e.relatedTarget && this.showOnLeaveToClassName && findUpClassName(e.relatedTarget, this.showOnLeaveToClassName)) {\n          this.showControls(false);\n          return;\n        }\n\n        this.hideControls();\n      });\n    }\n  }\n\n  public hideControls = (setHideTimeout = false) => {\n    if(setHideTimeout) {\n      if(!this.hideControlsTimeout) {\n        this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n      }\n\n      return;\n    }\n\n    clearTimeout(this.hideControlsTimeout);\n    this.hideControlsTimeout = 0;\n\n    const isShown = this.element.classList.contains('show-controls');\n    if(this.controlsLocked !== false) {\n      if((this.canHideControls ? !this.canHideControls() : false) || !isShown || this.controlsLocked) {\n        return;\n      }\n    } else if(!isShown) {\n      return;\n    }\n\n    this.dispatchEvent('toggleControls', false);\n    this.element.classList.remove('show-controls');\n  };\n\n  public showControls = (setHideTimeout = true) => {\n    if(this.hideControlsTimeout) {\n      clearTimeout(this.hideControlsTimeout);\n      this.hideControlsTimeout = 0;\n    } else if(!this.element.classList.contains('show-controls') && this.controlsLocked !== false) {\n      this.dispatchEvent('toggleControls', true);\n      this.element.classList.add('show-controls');\n    }\n\n    if(!setHideTimeout || this.controlsLocked) {\n      return;\n    }\n\n    this.hideControlsTimeout = window.setTimeout(this.hideControls, 3e3);\n  };\n\n  public toggleControls = (show?: boolean) => {\n    const isShown = this.element.classList.contains('show-controls');\n\n    if(show === undefined) {\n      if(isShown) this.hideControls();\n      else this.showControls();\n    } else if(show === isShown) return;\n    else if(show === false) this.hideControls();\n    else this.showControls();\n  };\n\n  public lockControls(visible: boolean) {\n    this.controlsLocked = visible;\n\n    this.element.classList.toggle('disable-hover', visible === false);\n    this.toggleControls(visible);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport PopupStickers from '../../components/popups/stickers';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport rootScope from '../../lib/rootScope';\nimport createContextMenu from './createContextMenu';\nimport findUpClassName from './findUpClassName';\nimport emoticonsDropdown, {EmoticonsDropdown} from '../../components/emoticonsDropdown';\n\nexport default function createStickersContextMenu(options: {\n  listenTo: HTMLElement,\n  isStickerPack?: boolean,\n  verifyRecent?: (target: HTMLElement) => boolean,\n  appendTo?: HTMLElement,\n  onOpen?: () => any,\n  onClose?: () => any,\n  onSend?: () => any\n}) {\n  const {listenTo, isStickerPack, verifyRecent, appendTo, onOpen, onClose, onSend} = options;\n  let target: HTMLElement, doc: MyDocument;\n  const verifyFavoriteSticker = async(toAdd: boolean) => {\n    const favedStickers = await rootScope.managers.acknowledged.appStickersManager.getFavedStickersStickers();\n    if(!favedStickers.cached) {\n      return false;\n    }\n\n    const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\n    return toAdd ? !found : found;\n  };\n\n  return createContextMenu({\n    listenTo: listenTo,\n    appendTo,\n    findElement: (e) => target = findUpClassName(e.target, 'media-sticker-wrapper'),\n    onOpen: async() => {\n      doc = await rootScope.managers.appDocsManager.getDoc(target.dataset.docId);\n      return onOpen?.();\n    },\n    onClose,\n    buttons: [{\n      icon: 'stickers',\n      text: 'Context.ViewStickerSet',\n      onClick: () => new PopupStickers(doc.stickerSetInput).show(),\n      verify: () => !isStickerPack\n    }, {\n      icon: 'favourites',\n      text: 'AddToFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, false),\n      verify: () => verifyFavoriteSticker(true)\n    }, {\n      icon: 'favourites',\n      text: 'DeleteFromFavorites',\n      onClick: () => rootScope.managers.appStickersManager.faveSticker(doc.id, true),\n      verify: () => verifyFavoriteSticker(false)\n    }, {\n      icon: 'delete',\n      text: 'DeleteFromRecent',\n      onClick: () => emoticonsDropdown.stickersTab.deleteRecentSticker(doc),\n      verify: () => verifyRecent?.(target) ?? false\n    }, {\n      icon: 'mute',\n      text: 'Chat.Send.WithoutSound',\n      onClick: () => {\n        onSend?.();\n        return EmoticonsDropdown.sendDocId(doc.id, false, true);\n      },\n      verify: () => !!(appImManager.chat.peerId && appImManager.chat.peerId !== rootScope.myId)\n    }, {\n      icon: 'schedule',\n      text: 'Chat.Send.ScheduledMessage',\n      onClick: () => appImManager.chat.input.scheduleSending(() => appImManager.chat.input.sendMessageWithDocument(doc)),\n      verify: () => !!appImManager.chat.peerId\n    }]\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ButtonMenu, {ButtonMenuItemOptions} from '../../components/buttonMenu';\nimport filterAsync from '../array/filterAsync';\nimport contextMenuController from '../contextMenuController';\nimport ListenerSetter from '../listenerSetter';\nimport {getMiddleware} from '../middleware';\nimport positionMenu from '../positionMenu';\nimport {attachContextMenuListener} from './attachContextMenuListener';\n\nexport default function createContextMenu<T extends ButtonMenuItemOptions & {verify?: () => boolean | Promise<boolean>}>({\n  buttons,\n  findElement,\n  listenTo,\n  appendTo,\n  filterButtons,\n  onOpen,\n  onClose\n}: {\n  buttons: T[],\n  findElement: (e: MouseEvent) => HTMLElement,\n  listenTo: HTMLElement,\n  appendTo?: HTMLElement,\n  filterButtons?: (buttons: T[]) => Promise<T[]>,\n  onOpen?: (target: HTMLElement) => any,\n  onClose?: () => any\n}) {\n  appendTo ??= document.body;\n\n  const attachListenerSetter = new ListenerSetter();\n  const listenerSetter = new ListenerSetter();\n  const middleware = getMiddleware();\n  let element: HTMLElement;\n\n  attachContextMenuListener(listenTo, (e) => {\n    const target = findElement(e as any);\n    if(!target) {\n      return;\n    }\n\n    let _element = element;\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\n    if(_element && _element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\n\n    const r = async() => {\n      await onOpen?.(target);\n\n      const initResult = await init();\n      if(!initResult) {\n        return;\n      }\n\n      _element = initResult.element;\n      const {cleanup, destroy} = initResult;\n\n      positionMenu(e, _element);\n      contextMenuController.openBtnMenu(_element, () => {\n        onClose?.();\n        cleanup();\n\n        setTimeout(() => {\n          destroy();\n        }, 300);\n      });\n    };\n\n    r();\n  }, attachListenerSetter);\n\n  const cleanup = () => {\n    listenerSetter.removeAll();\n    middleware.clean();\n  };\n\n  const destroy = () => {\n    cleanup();\n    attachListenerSetter.removeAll();\n  };\n\n  const init = async() => {\n    cleanup();\n\n    buttons.forEach((button) => button.element = undefined);\n    const f = filterButtons || ((buttons: T[]) => filterAsync(buttons, (button) => button?.verify?.() ?? true));\n\n    const filteredButtons = await f(buttons);\n    if(!filteredButtons.length) {\n      return;\n    }\n\n    const _element = element = ButtonMenu(filteredButtons, listenerSetter);\n    _element.classList.add('contextmenu');\n\n    appendTo.append(_element);\n\n    return {\n      element: _element,\n      cleanup,\n      destroy: () => {\n        _element.remove();\n      }\n    };\n  };\n\n  return {element, destroy};\n}\n","export default function createVideo(options: {\n  pip?: boolean\n} = {}) {\n  const video = document.createElement('video');\n  if(!options.pip) video.disablePictureInPicture = true;\n  video.setAttribute('playsinline', 'true');\n  return video;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport rootScope from '../../lib/rootScope';\n\nexport type CustomProperty = string;\n\nexport class CustomProperties {\n  private cache: {[k in CustomProperty]?: string};\n  private computedStyle: CSSStyleDeclaration;\n\n  constructor() {\n    this.cache = {};\n\n    rootScope.addEventListener('theme_change', () => {\n      this.computedStyle = undefined;\n      const cache = this.cache;\n      this.cache = {};\n\n      for(const i in cache) {\n        this.getProperty(i);\n      }\n    });\n  }\n\n  public getProperty(name: CustomProperty) {\n    let value = this.cache[name];\n    if(value) {\n      return value;\n    }\n\n    if(!this.computedStyle) {\n      this.computedStyle = window.getComputedStyle(document.documentElement);\n    }\n\n    value = this.computedStyle.getPropertyValue('--' + name).trim();\n    return this.cache[name] = value;\n  }\n}\n\nconst customProperties = new CustomProperties();\nexport default customProperties;\n","export default function simulateEvent(elem: EventTarget, name: string) {\n  const event = new Event(name, {bubbles: true, cancelable: true});\n  elem.dispatchEvent(event);\n}\n","import encodeEntities from '../string/encodeEntities';\n\nexport default function documentFragmentToHTML(fragment: DocumentFragment) {\n  return Array.from(fragment.childNodes).map((node) => {\n    return node.nodeType === 3 ? encodeEntities(node.textContent) : (node as Element).outerHTML;\n  }).join('');\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAsChild(el: HTMLElement, parent: HTMLElement): HTMLElement {\r\n  if(el.parentElement === parent) return el;\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.parentElement === parent) {\r\n      return el;\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpAttribute(el: any, attribute: string): HTMLElement {\r\n  return el.closest(`[${attribute}]`);\r\n  /* if(el.getAttribute(attribute) !== null) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.getAttribute(attribute) !== null)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function findUpTag(el: any, tag: string): HTMLElement {\r\n  return el.closest(tag);\r\n  /* if(el.tagName === tag) return el; // 03.02.2020\r\n\r\n  while(el.parentElement) {\r\n    el = el.parentElement;\r\n    if(el.tagName === tag)\r\n      return el;\r\n  }\r\n  return null; */\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ListenerSetter from '../listenerSetter';\n\nexport function requestFullScreen(element: HTMLElement) {\n  if(element.requestFullscreen) {\n    element.requestFullscreen();\n    // @ts-ignore\n  } else if(element.mozRequestFullScreen) {\n    // @ts-ignore\n    element.mozRequestFullScreen(); // Firefox\n    // @ts-ignore\n  } else if(element.webkitRequestFullscreen) {\n    // @ts-ignore\n    element.webkitRequestFullscreen(); // Chrome and Safari\n    // @ts-ignore\n  } else if(element.msRequestFullscreen) {\n    // @ts-ignore\n    element.msRequestFullscreen();\n  }\n}\n\nexport function cancelFullScreen() {\n  // @ts-ignore\n  if(document.cancelFullScreen) {\n    // @ts-ignore\n    document.cancelFullScreen();\n    // @ts-ignore\n  } else if(document.mozCancelFullScreen) {\n    // @ts-ignore\n    document.mozCancelFullScreen();\n    // @ts-ignore\n  } else if(document.webkitCancelFullScreen) {\n    // @ts-ignore\n    document.webkitCancelFullScreen();\n    // @ts-ignore\n  } else if(document.msExitFullscreen) {\n    // @ts-ignore\n    document.msExitFullscreen();\n  }\n}\n\nexport function addFullScreenListener(element: HTMLElement, callback: (e: Event) => any, listenerSetter?: ListenerSetter) {\n  const addListener = listenerSetter ? listenerSetter.add(element) : element.addEventListener.bind(element);\n  'webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange'.split(' ').forEach((eventName) => {\n    addListener(eventName, callback, false);\n  });\n}\n\nexport function getFullScreenElement(): HTMLElement {\n  // @ts-ignore\n  return document.fullscreenElement || document.mozFullScreenElement || document.webkitFullscreenElement || document.msFullscreenElement;\n}\n\nexport function isFullScreen() {\n  return !!getFullScreenElement();\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\n\r\nexport type MarkdownType = 'bold' | 'italic' | 'underline' | 'strikethrough' | 'monospace' | 'link' | 'mentionName' | 'spoiler';\r\nexport type MarkdownTag = {\r\n  match: string,\r\n  entityName: Extract<MessageEntity['_'], 'messageEntityBold' | 'messageEntityUnderline' | 'messageEntityItalic' | 'messageEntityCode' | 'messageEntityStrike' | 'messageEntityTextUrl' | 'messageEntityMentionName' | 'messageEntitySpoiler'>;\r\n};\r\n\r\n// https://core.telegram.org/bots/api#html-style\r\nexport const markdownTags: {[type in MarkdownType]: MarkdownTag} = {\r\n  bold: {\r\n    match: '[style*=\"bold\"], [style*=\"font-weight: 700\"], [style*=\"font-weight: 600\"], [style*=\"font-weight:700\"], [style*=\"font-weight:600\"], b, strong',\r\n    entityName: 'messageEntityBold'\r\n  },\r\n  underline: {\r\n    match: '[style*=\"underline\"], u, ins',\r\n    entityName: 'messageEntityUnderline'\r\n  },\r\n  italic: {\r\n    match: '[style*=\"italic\"], i, em',\r\n    entityName: 'messageEntityItalic'\r\n  },\r\n  monospace: {\r\n    match: '[style*=\"monospace\"], [face*=\"monospace\"], pre',\r\n    entityName: 'messageEntityCode'\r\n  },\r\n  strikethrough: {\r\n    match: '[style*=\"line-through\"], strike, del, s',\r\n    entityName: 'messageEntityStrike'\r\n  },\r\n  link: {\r\n    match: 'A:not(.follow)',\r\n    entityName: 'messageEntityTextUrl'\r\n  },\r\n  mentionName: {\r\n    match: 'A.follow',\r\n    entityName: 'messageEntityMentionName'\r\n  },\r\n  spoiler: {\r\n    match: '[style*=\"spoiler\"]',\r\n    entityName: 'messageEntitySpoiler'\r\n  }\r\n};\r\n\r\nconst tabulationMatch = '[style*=\"table-cell\"], th, td';\r\n\r\n/* export function getDepth(child: Node, container?: Node) {\r\n  let depth = 0;\r\n\r\n  do {\r\n    if(child === container) {\r\n      return depth;\r\n    }\r\n\r\n    ++depth;\r\n  } while((child = child.parentNode) !== null);\r\n\r\n  return depth;\r\n} */\r\n\r\nconst BLOCK_TAG_NAMES = new Set([\r\n  'DIV',\r\n  'P',\r\n  'BR',\r\n  'LI',\r\n  'SECTION',\r\n  'H6',\r\n  'H5',\r\n  'H4',\r\n  'H3',\r\n  'H2',\r\n  'H1',\r\n  'TR'\r\n]);\r\n\r\nexport default function getRichElementValue(node: HTMLElement, lines: string[], line: string[], selNode?: Node, selOffset?: number, entities?: MessageEntity[], offset = {offset: 0}) {\r\n  if(node.nodeType === 3) { // TEXT\r\n    const nodeValue = node.nodeValue;\r\n\r\n    /* const tabulation = node.parentElement?.closest(tabulationMatch + ', [contenteditable]');\r\n    if(tabulation?.getAttribute('contenteditable') === null) {\r\n      nodeValue += ' ';\r\n      // line.push('\\t');\r\n      // ++offset.offset;\r\n    } */\r\n\r\n    if(selNode === node) {\r\n      line.push(nodeValue.substr(0, selOffset) + '\\x01' + nodeValue.substr(selOffset));\r\n    } else {\r\n      line.push(nodeValue);\r\n    }\r\n\r\n    if(entities && nodeValue.length) {\r\n      if(node.parentNode) {\r\n        const parentElement = node.parentElement;\r\n\r\n        // let closestTag: MarkdownTag, closestElementByTag: Element, closestDepth = Infinity;\r\n        for(const type in markdownTags) {\r\n          const tag = markdownTags[type as MarkdownType];\r\n          const closest = parentElement.closest(tag.match + ', [contenteditable]');\r\n          if(closest?.getAttribute('contenteditable') !== null) {\r\n            /* const depth = getDepth(closest, parentElement.closest('[contenteditable]'));\r\n            if(closestDepth > depth) {\r\n              closestDepth = depth;\r\n              closestTag = tag;\r\n              closestElementByTag = closest;\r\n            } */\r\n            continue;\r\n          }\r\n\r\n          if(tag.entityName === 'messageEntityTextUrl') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              url: (closest as HTMLAnchorElement).href,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          } else if(tag.entityName === 'messageEntityMentionName') {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length,\r\n              user_id: (closest as HTMLElement).dataset.follow.toUserId()\r\n            });\r\n          } else {\r\n            entities.push({\r\n              _: tag.entityName,\r\n              offset: offset.offset,\r\n              length: nodeValue.length\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    offset.offset += nodeValue.length;\r\n    return;\r\n  }\r\n\r\n  if(node.nodeType !== 1) { // NON-ELEMENT\r\n    return;\r\n  }\r\n\r\n  const isSelected = selNode === node;\r\n  const isBlock = BLOCK_TAG_NAMES.has(node.tagName);\r\n  if(isBlock && line.length) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, line.length);\r\n    ++offset.offset;\r\n  } else if(node instanceof HTMLImageElement) {\r\n    const alt = node.alt;\r\n    if(alt) {\r\n      line.push(alt);\r\n      offset.offset += alt.length;\r\n    }\r\n  }\r\n\r\n  if(isSelected && !selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  const isTableCell = node.matches(tabulationMatch);\r\n  const wasEntitiesLength = entities?.length;\r\n\r\n  let curChild = node.firstChild as HTMLElement;\r\n  while(curChild) {\r\n    getRichElementValue(curChild, lines, line, selNode, selOffset, entities, offset);\r\n    curChild = curChild.nextSibling as any;\r\n  }\r\n\r\n  if(isSelected && selOffset) {\r\n    line.push('\\x01');\r\n  }\r\n\r\n  if(isTableCell && node.nextSibling) {\r\n    line.push(' ');\r\n    ++offset.offset;\r\n\r\n    // * combine entities such as url after adding space\r\n    if(wasEntitiesLength !== undefined) {\r\n      for(let i = wasEntitiesLength, length = entities.length; i < length; ++i) {\r\n        ++entities[i].length;\r\n      }\r\n    }\r\n  }\r\n\r\n  const wasLength = line.length;\r\n  if(isBlock && wasLength) {\r\n    lines.push(line.join(''));\r\n    line.splice(0, wasLength);\r\n    ++offset.offset;\r\n  }\r\n\r\n  if(wasLength && node.tagName === 'P' && node.nextSibling) {\r\n    lines.push('');\r\n    ++offset.offset;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport sortEntities from '../../lib/richTextProcessor/sortEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValue(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, undefined, undefined, entities);\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities?.length) {\r\n    // ! cannot do that here because have the same check before the sending in RichTextProcessor.parseMarkdown\r\n    /* const entity = entities[entities.length - 1];\r\n    const length = value.length;\r\n    const trimmedLength = value.trimRight().length;\r\n    if(length !== trimmedLength) {\r\n      entity.length -= length - trimmedLength;\r\n    } */\r\n\r\n    combineSameEntities(entities);\r\n    sortEntities(entities);\r\n  }\r\n\r\n  // console.log('getRichValue:', value, entities);\r\n\r\n  return {value, entities};\r\n}\r\n\r\nMOUNT_CLASS_TO.getRichValue = getRichValue;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getVisibleRect from './getVisibleRect';\n\nexport type ViewportSlicePart = {element: HTMLElement, rect: DOMRect, visibleRect: ReturnType<typeof getVisibleRect>}[];\n\nexport default function getViewportSlice({overflowElement, overflowRect, selector, extraSize, elements}: {\n  overflowElement: HTMLElement,\n  overflowRect?: DOMRectMinified,\n  extraSize?: number,\n  selector?: string,\n  elements?: HTMLElement[]\n}) {\n  // const perf = performance.now();\n  overflowRect ??= overflowElement.getBoundingClientRect();\n  elements ??= Array.from(overflowElement.querySelectorAll<HTMLElement>(selector));\n\n  if(extraSize) {\n    overflowRect = {\n      top: overflowRect.top - extraSize,\n      right: overflowRect.right + extraSize,\n      bottom: overflowRect.bottom + extraSize,\n      left: overflowRect.left - extraSize\n    };\n  }\n\n  const invisibleTop: ViewportSlicePart = [],\n    visible: typeof invisibleTop = [],\n    invisibleBottom: typeof invisibleTop = [];\n  let foundVisible = false;\n  for(const element of elements) {\n    const rect = element.getBoundingClientRect();\n    const visibleRect = getVisibleRect(element, overflowElement, false, rect, overflowRect);\n\n    const isVisible = !!visibleRect;\n    let array: typeof invisibleTop;\n    if(isVisible) {\n      foundVisible = true;\n      array = visible;\n    } else if(foundVisible) {\n      array = invisibleBottom;\n    } else {\n      array = invisibleTop;\n    }\n\n    array.push({\n      element,\n      rect,\n      visibleRect\n    });\n  }\n\n  // if(extraSize && visible.length) {\n  //   const maxTop = visible[0].rect.top;\n  //   const minTop = maxTop - extraSize;\n  //   const minBottom = visible[visible.length - 1].rect.bottom;\n  //   const maxBottom = minBottom + extraSize;\n\n  //   for(let length = invisibleTop.length, i = length - 1; i >= 0; --i) {\n  //     const element = invisibleTop[i];\n  //     if(element.rect.top >= minTop) {\n  //       invisibleTop.splice(i, 1);\n  //       visible.unshift(element);\n  //     }\n  //   }\n\n  //   for(let i = 0, length = invisibleBottom.length; i < length; ++i) {\n  //     const element = invisibleBottom[i];\n  //     if(element.rect.bottom <= maxBottom) {\n  //       invisibleBottom.splice(i--, 1);\n  //       --length;\n  //       visible.push(element);\n  //     }\n  //   }\n  // }\n\n  // console.log('getViewportSlice time:', performance.now() - perf);\n\n  return {invisibleTop, visible, invisibleBottom};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport windowSize from '../windowSize';\r\n\r\nexport default function getVisibleRect(\r\n  element: HTMLElement,\r\n  overflowElement: HTMLElement,\r\n  lookForSticky?: boolean,\r\n  rect: DOMRectMinified = element.getBoundingClientRect(),\r\n  overflowRect: DOMRectMinified = overflowElement.getBoundingClientRect()\r\n) {\r\n  let {top: overflowTop, right: overflowRight, bottom: overflowBottom, left: overflowLeft} = overflowRect;\r\n\r\n  // * respect sticky headers\r\n  if(lookForSticky) {\r\n    const sticky = overflowElement.querySelector('.sticky');\r\n    if(sticky) {\r\n      const stickyRect = sticky.getBoundingClientRect();\r\n      overflowTop = stickyRect.bottom;\r\n    }\r\n  }\r\n\r\n  if(rect.top >= overflowBottom ||\r\n    rect.bottom <= overflowTop ||\r\n    rect.right <= overflowLeft ||\r\n    rect.left >= overflowRight) {\r\n    return null;\r\n  }\r\n\r\n  const overflow = {\r\n    top: false,\r\n    right: false,\r\n    bottom: false,\r\n    left: false,\r\n    vertical: 0 as 0 | 1 | 2,\r\n    horizontal: 0 as 0 | 1 | 2\r\n  };\r\n\r\n  const windowWidth = windowSize.width;\r\n  const windowHeight = windowSize.height;\r\n\r\n  return {\r\n    rect: {\r\n      top: rect.top < overflowTop && overflowTop !== 0 ? (overflow.top = true, ++overflow.vertical, overflowTop) : rect.top,\r\n      right: rect.right > overflowRight && overflowRight !== windowWidth ? (overflow.right = true, ++overflow.horizontal, overflowRight) : rect.right,\r\n      bottom: rect.bottom > overflowBottom && overflowBottom !== windowHeight ? (overflow.bottom = true, ++overflow.vertical, overflowBottom) : rect.bottom,\r\n      left: rect.left < overflowLeft && overflowLeft !== 0 ? (overflow.left = true, ++overflow.horizontal, overflowLeft) : rect.left\r\n    },\r\n    overflow\r\n  };\r\n}\r\n\r\n(window as any).getVisibleRect = getVisibleRect;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SwipeHandler, {SwipeHandlerOptions} from '../../components/swipeHandler';\nimport cancelEvent from './cancelEvent';\nimport findUpClassName from './findUpClassName';\nimport isSwipingBackSafari from './isSwipingBackSafari';\n\nexport type SwipeHandlerHorizontalOptions = SwipeHandlerOptions & {\n  // xThreshold?: number\n};\n\nexport default function handleHorizontalSwipe(options: SwipeHandlerHorizontalOptions) {\n  let cancelY = false;\n  return new SwipeHandler({\n    ...options,\n    verifyTouchTarget: (e) => {\n      return !findUpClassName(e.target, 'progress-line') &&\n        !isSwipingBackSafari(e) &&\n        (options.verifyTouchTarget ? options.verifyTouchTarget(e) : true);\n    },\n    onSwipe: (xDiff, yDiff, e) => {\n      if(!cancelY && Math.abs(yDiff) > 20) {\n        return true;\n      }\n\n      if(Math.abs(xDiff) > Math.abs(yDiff)) {\n        cancelEvent(e);\n        cancelY = true;\n      } else if(!cancelY && Math.abs(yDiff) > Math.abs(xDiff)/*  || Math.abs(yDiff) > 20 */) {\n        return true;\n      }\n\n      /* if(!cancelY && options.xThreshold !== undefined && xDiff >= options.xThreshold) {\n        cancelY = true;\n      } */\n\n      return options.onSwipe(xDiff, yDiff, e);\n    },\n    onReset: () => {\n      cancelY = false;\n      options.onReset && options.onReset();\n    },\n    cancelEvent: false // cannot use cancelEvent on Safari iOS because scroll will be canceled too\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {cancelContextMenuOpening} from './attachContextMenuListener';\nimport handleHorizontalSwipe, {SwipeHandlerHorizontalOptions} from './handleHorizontalSwipe';\n\nexport default function handleTabSwipe(options: SwipeHandlerHorizontalOptions) {\n  return handleHorizontalSwipe({\n    ...options,\n    onSwipe: (xDiff, yDiff, e) => {\n      if(Math.abs(xDiff) > 50) {\n        options.onSwipe(xDiff, yDiff, e);\n        cancelContextMenuOpening();\n\n        return true;\n      }\n    }\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToDocumentFragment(html: string | DocumentFragment) {\r\n  if(html instanceof DocumentFragment) return html;\r\n  const template = document.createElement('template');\r\n  html = html.trim(); // Never return a text node of whitespace as the result\r\n  template.innerHTML = html;\r\n  return template.content;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function htmlToSpan(html: string | DocumentFragment) {\r\n  const span = document.createElement('span');\r\n  if(typeof(html) === 'string') span.innerHTML = html;\r\n  else span.append(html);\r\n  return span;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\n/* export function isInDOM(element: Element, parentNode?: HTMLElement): boolean {\r\n  if(!element) {\r\n    return false;\r\n  }\r\n\r\n  parentNode = parentNode || document.body;\r\n  if(element === parentNode) {\r\n    return true;\r\n  }\r\n  return isInDOM(element.parentNode as HTMLElement, parentNode);\r\n} */\r\nexport default function isInDOM(element: Element): boolean {\r\n  return element?.isConnected;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getRichValue from './getRichValue';\r\n\r\nexport default function isInputEmpty(element: HTMLElement) {\r\n  if(element.hasAttribute('contenteditable') || element.tagName !== 'INPUT') {\r\n    /* const value = element.innerText;\r\n\r\n    return !value.trim() && !serializeNodes(Array.from(element.childNodes)).trim(); */\r\n    return !getRichValue(element, false).value.trim();\r\n  } else {\r\n    return !(element as HTMLInputElement).value.trim();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\nimport {IS_MOBILE, IS_APPLE} from '../../environment/userAgent';\r\n\r\nexport default function isSendShortcutPressed(e: KeyboardEvent) {\r\n  if(e.key === 'Enter' && !IS_MOBILE && !e.isComposing) {\r\n    /* if(e.ctrlKey || e.metaKey) {\r\n      this.messageInput.innerHTML += '<br>';\r\n      placeCaretAtEnd(this.message)\r\n      return;\r\n    } */\r\n\r\n    if(rootScope.settings.sendShortcut === 'enter') {\r\n      if(e.shiftKey || e.ctrlKey || e.metaKey) {\r\n        return;\r\n      }\r\n\r\n      return true;\r\n    } else {\r\n      const secondaryKey = IS_APPLE ? e.metaKey : e.ctrlKey;\r\n      if(e.shiftKey || (IS_APPLE ? e.ctrlKey : e.metaKey)) {\r\n        return;\r\n      }\r\n\r\n      if(secondaryKey) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\n\nexport default function isSwipingBackSafari(e: TouchEvent | MouseEvent) {\n  return IS_MOBILE_SAFARI && e instanceof TouchEvent && e.touches[0].clientX < 30;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function placeCaretAtEnd(el: HTMLElement, ignoreTouchCheck = false) {\r\n  if(IS_TOUCH_SUPPORTED && (!ignoreTouchCheck || document.activeElement !== el)) {\r\n    return;\r\n  }\r\n\r\n  el.focus();\r\n  if(el instanceof HTMLInputElement) {\r\n    const length = el.value.length;\r\n    el.selectionStart = length;\r\n    el.selectionEnd = length;\r\n  } else if(typeof window.getSelection !== 'undefined' && typeof document.createRange !== 'undefined') {\r\n    var range = document.createRange();\r\n    range.selectNodeContents(el);\r\n    range.collapse(false);\r\n    var sel = window.getSelection();\r\n    sel.removeAllRanges();\r\n    sel.addRange(range);\r\n    // @ts-ignore\r\n  } else if(typeof document.body.createTextRange !== 'undefined') {\r\n    // @ts-ignore\r\n    var textRange = document.body.createTextRange();\r\n    textRange.moveToElementText(el);\r\n    textRange.collapse(false);\r\n    textRange.select();\r\n  }\r\n}\r\n\r\n(window as any).placeCaretAtEnd = placeCaretAtEnd;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport whichChild from './whichChild';\r\n\r\nexport default function positionElementByIndex(element: HTMLElement, container: HTMLElement, pos: number, prevPos?: number) {\r\n  if(prevPos === undefined) {\r\n    prevPos = element.parentElement === container ? whichChild(element) : -1;\r\n  }\r\n\r\n  if(prevPos === pos) {\r\n    return false;\r\n  } else if(prevPos !== -1 && prevPos < pos) { // was higher\r\n    pos += 1;\r\n  }\r\n\r\n  if(!pos) {\r\n    container.prepend(element);\r\n  } else if(container.childElementCount > pos) {\r\n    container.insertBefore(element, container.children[pos]);\r\n  } else {\r\n    container.append(element);\r\n  }\r\n\r\n  return true;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport onMediaLoad from '../onMediaLoad';\n\n// import { getHeavyAnimationPromise } from \"../../hooks/useHeavyAnimationCheck\";\n\nexport const loadedURLs: {[url: string]: boolean} = {};\nconst set = (elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement, url: string) => {\n  if(elem instanceof HTMLImageElement || elem instanceof HTMLVideoElement) elem.src = url;\n  else if(elem instanceof SVGImageElement) elem.setAttributeNS(null, 'href', url);\n  else elem.style.backgroundImage = 'url(' + url + ')';\n};\n\n//    ,      ,    blob',      'load'  .\nexport default function renderImageFromUrl(\n  elem: HTMLElement | HTMLImageElement | SVGImageElement | HTMLVideoElement,\n  url: string,\n  callback?: () => void,\n  useCache = true\n) {\n  if(!url) {\n    console.error('renderImageFromUrl: no url?', elem, url);\n    callback?.();\n    return;\n  }\n\n  const isVideo = elem instanceof HTMLVideoElement;\n  if(((loadedURLs[url]/*  && false */) && useCache) || isVideo) {\n    if(elem) {\n      set(elem, url);\n    }\n\n    if(callback) {\n      if(isVideo) {\n        onMediaLoad(elem).then(callback);\n      } else {\n        callback?.();\n      }\n      // callback && getHeavyAnimationPromise().then(() => callback());\n    }\n  } else {\n    const isImage = elem instanceof HTMLImageElement;\n    const loader = isImage ? elem as HTMLImageElement : new Image();\n    // const loader = new Image();\n    loader.src = url;\n    // let perf = performance.now();\n\n    const onLoad = () => {\n      if(!isImage && elem) {\n        set(elem, url);\n      }\n\n      loadedURLs[url] = true;\n      // console.log('onload:', url, performance.now() - perf);\n      // TODO:      ,       \n      // callback && getHeavyAnimationPromise().then(() => callback());\n      callback?.();\n\n      loader.removeEventListener('error', onError);\n    };\n\n    const onError = (err: ErrorEvent) => {\n      console.error('Render image from url failed:', err, url, loader);\n      loader.removeEventListener('load', onLoad);\n      callback?.();\n    };\n\n    loader.addEventListener('load', onLoad, {once: true});\n    loader.addEventListener('error', onError, {once: true});\n  }\n}\n\nexport function renderImageFromUrlPromise(elem: Parameters<typeof renderImageFromUrl>[0], url: string, useCache?: boolean) {\n  return new Promise<void>((resolve) => {\n    renderImageFromUrl(elem, url, resolve, useCache);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport sequentialDom from '../sequentialDom';\nimport {renderImageFromUrlPromise} from './renderImageFromUrl';\n\nexport default function renderMediaWithFadeIn(\n  container: HTMLElement,\n  media: Parameters<typeof renderImageFromUrlPromise>[0],\n  url: string,\n  needFadeIn: boolean,\n  aspecter = container,\n  thumbImage?: HTMLElement\n) {\n  if(needFadeIn) {\n    media.classList.add('fade-in');\n  }\n\n  const promise = renderImageFromUrlPromise(media, url).then(() => {\n    return sequentialDom.mutateElement(container, () => {\n      aspecter.append(media);\n\n      if(needFadeIn) {\n        media.addEventListener('animationend', () => {\n          sequentialDom.mutate(() => {\n            media.classList.remove('fade-in');\n            thumbImage?.remove();\n          });\n        }, {once: true});\n      } else {\n        thumbImage?.remove();\n      }\n    });\n  });\n\n  // recordPromise(promise, 'renderImageWithFadeIn');\n\n  return promise;\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function replaceContent(elem: HTMLElement, node: string | Node) {\r\n  if(typeof(node) === 'string') {\r\n    elem.innerHTML = node;\r\n    return;\r\n  }\r\n\r\n  // * children.length doesn't count text nodes\r\n  const firstChild = elem.firstChild;\r\n  if(firstChild) {\r\n    if(elem.lastChild === firstChild) {\r\n      firstChild.replaceWith(node);\r\n    } else {\r\n      elem.textContent = '';\r\n      elem.append(node);\r\n    }\r\n  } else {\r\n    elem.append(node);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function setInnerHTML(elem: Element, html: string | DocumentFragment | Element) {\r\n  elem.setAttribute('dir', 'auto');\r\n  if(typeof(html) === 'string') {\r\n    if(!html) elem.textContent = '';\r\n    else elem.innerHTML = html;\r\n  } else {\r\n    elem.textContent = '';\r\n    elem.append(html);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function toggleDisability(elements: HTMLElement[], disable: boolean): () => void {\r\n  if(disable) {\r\n    elements.forEach((el) => el.setAttribute('disabled', 'true'));\r\n  } else {\r\n    elements.forEach((el) => el.removeAttribute('disabled'));\r\n  }\r\n\r\n  return () => toggleDisability(elements, !disable);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function whichChild(elem: Node) {\r\n  if(!elem.parentNode) {\r\n    return -1;\r\n  }\r\n\r\n  let i = 0;\r\n  // @ts-ignore\r\n  while((elem = elem.previousElementSibling) !== null) ++i;\r\n  return i;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from './dom/clickEvent';\r\nimport findUpAsChild from './dom/findUpAsChild';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport ListenerSetter from './listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nconst KEEP_OPEN = false;\r\nconst TOGGLE_TIMEOUT = 200;\r\nconst ANIMATION_DURATION = 200;\r\n\r\nexport default class DropdownHover extends EventListenerBase<{\r\n  open: () => Promise<any> | void,\r\n  opened: () => any,\r\n  close: () => any,\r\n  closed: () => any\r\n}> {\r\n  protected element: HTMLElement;\r\n  protected displayTimeout: number;\r\n  protected forceClose = false;\r\n  protected inited = false;\r\n  protected ignoreMouseOut = false;\r\n\r\n  constructor(options: {\r\n    element: DropdownHover['element']\r\n  }) {\r\n    super(false);\r\n    safeAssign(this, options);\r\n  }\r\n\r\n  public attachButtonListener(button: HTMLElement, listenerSetter: ListenerSetter) {\r\n    let firstTime = true;\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(button, () => {\r\n        if(firstTime) {\r\n          firstTime = false;\r\n          this.toggle(true);\r\n        } else {\r\n          this.toggle();\r\n        }\r\n      }, {listenerSetter});\r\n    } else {\r\n      listenerSetter.add(button)('mouseover', (e) => {\r\n        // console.log('onmouseover button');\r\n        if(firstTime) {\r\n          listenerSetter.add(button)('mouseout', (e) => {\r\n            clearTimeout(this.displayTimeout);\r\n            this.onMouseOut(e);\r\n          });\r\n          firstTime = false;\r\n        }\r\n\r\n        clearTimeout(this.displayTimeout);\r\n        this.displayTimeout = window.setTimeout(() => {\r\n          this.toggle(true);\r\n        }, TOGGLE_TIMEOUT);\r\n      });\r\n    }\r\n  }\r\n\r\n  protected onMouseOut = (e: MouseEvent) => {\r\n    if(KEEP_OPEN || !this.isActive()) return;\r\n    clearTimeout(this.displayTimeout);\r\n\r\n    if(this.ignoreMouseOut) {\r\n      return;\r\n    }\r\n\r\n    const toElement = (e as any).toElement as HTMLElement;\r\n    if(toElement && findUpAsChild(toElement, this.element)) {\r\n      return;\r\n    }\r\n\r\n    this.displayTimeout = window.setTimeout(() => {\r\n      this.toggle(false);\r\n    }, TOGGLE_TIMEOUT);\r\n  };\r\n\r\n  protected init() {\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      this.element.onmouseout = this.onMouseOut;\r\n      this.element.onmouseover = (e) => {\r\n        if(this.forceClose) {\r\n          return;\r\n        }\r\n\r\n        // console.log('onmouseover element');\r\n        clearTimeout(this.displayTimeout);\r\n      };\r\n    }\r\n  }\r\n\r\n  public toggle = async(enable?: boolean) => {\r\n    // if(!this.element) return;\r\n    const willBeActive = (!!this.element.style.display && enable === undefined) || enable;\r\n    if(this.init) {\r\n      if(willBeActive) {\r\n        this.init();\r\n        this.init = null;\r\n      } else {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(willBeActive === this.isActive()) {\r\n      return;\r\n    }\r\n\r\n    if((this.element.style.display && enable === undefined) || enable) {\r\n      const res = this.dispatchResultableEvent('open');\r\n      await Promise.all(res);\r\n\r\n      this.element.style.display = '';\r\n      void this.element.offsetLeft; // reflow\r\n      this.element.classList.add('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.forceClose = false;\r\n        this.dispatchEvent('opened');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      // ! can't use together with resizeObserver\r\n      /* if(isTouchSupported) {\r\n        const height = this.element.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n        console.log('[ESG]: toggle: enable height', height);\r\n        appImManager.chat.bubbles.scrollable.scrollTop += height;\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    } else {\r\n      this.dispatchEvent('close');\r\n\r\n      this.element.classList.remove('active');\r\n\r\n      clearTimeout(this.displayTimeout);\r\n      this.displayTimeout = window.setTimeout(() => {\r\n        this.element.style.display = 'none';\r\n        this.forceClose = false;\r\n        this.dispatchEvent('closed');\r\n      }, IS_TOUCH_SUPPORTED ? 0 : ANIMATION_DURATION);\r\n\r\n      /* if(isTouchSupported) {\r\n        const scrollHeight = this.container.scrollHeight;\r\n        if(scrollHeight) {\r\n          const height = this.container.scrollHeight + appImManager.chat.input.inputContainer.scrollHeight - 10;\r\n          appImManager.chat.bubbles.scrollable.scrollTop -= height;\r\n        }\r\n      } */\r\n\r\n      /* if(touchSupport) {\r\n        this.restoreScroll();\r\n      } */\r\n    }\r\n\r\n    // animationIntersector.checkAnimations(false, EMOTICONSSTICKERGROUP);\r\n  };\r\n\r\n  public isActive() {\r\n    return this.element.classList.contains('active');\r\n  }\r\n\r\n  public setIgnoreMouseOut(ignore: boolean) {\r\n    this.ignoreMouseOut = ignore;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's fastSmoothScroll slightly patched\r\n\r\nimport {dispatchHeavyAnimationEvent} from '../hooks/useHeavyAnimationCheck';\r\nimport {fastRaf, fastRafPromise} from './schedulers';\r\nimport {animateSingle, cancelAnimationByKey} from './animation';\r\nimport rootScope from '../lib/rootScope';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nconst MIN_JS_DURATION = 250;\r\nconst MAX_JS_DURATION = 600;\r\nconst LONG_TRANSITION_MAX_DISTANCE = 1500;\r\nconst SHORT_TRANSITION_MAX_DISTANCE = 500;\r\n\r\nexport enum FocusDirection {\r\n  Up,\r\n  Down,\r\n  Static,\r\n};\r\n\r\nexport type ScrollGetNormalSizeCallback = (options: {rect: DOMRect}) => number;\r\nexport type ScrollStartCallbackDimensions = {\r\n  scrollSize: number,\r\n  scrollPosition: number,\r\n  distanceToEnd: number,\r\n  path: number,\r\n  duration: number,\r\n  containerRect: DOMRect,\r\n  elementRect: DOMRect,\r\n  getProgress: () => number\r\n};\r\n\r\nexport type ScrollOptions = {\r\n  container: HTMLElement,\r\n  element: HTMLElement,\r\n  position: ScrollLogicalPosition,\r\n  margin?: number,\r\n  maxDistance?: number,\r\n  forceDirection?: FocusDirection,\r\n  forceDuration?: number,\r\n  axis?: 'x' | 'y',\r\n  getNormalSize?: ScrollGetNormalSizeCallback,\r\n  fallbackToElementStartWhenCentering?: HTMLElement,\r\n  startCallback?: (dimensions: ScrollStartCallbackDimensions) => void\r\n};\r\n\r\nexport default function fastSmoothScroll(options: ScrollOptions) {\r\n  if(options.margin === undefined) {\r\n    options.margin = 0;\r\n  }\r\n\r\n  if(options.maxDistance === undefined) {\r\n    options.maxDistance = LONG_TRANSITION_MAX_DISTANCE;\r\n  }\r\n\r\n  if(options.axis === undefined) {\r\n    options.axis = 'y';\r\n  }\r\n  // return;\r\n\r\n  if(!rootScope.settings.animationsEnabled) {\r\n    options.forceDirection = FocusDirection.Static;\r\n  }\r\n\r\n  if(options.forceDirection === FocusDirection.Static) {\r\n    options.forceDuration = 0;\r\n    return scrollWithJs(options);\r\n    /* return Promise.resolve();\r\n\r\n    element.scrollIntoView({ block: position });\r\n\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve(); */\r\n  }\r\n\r\n  const promise = fastRafPromise().then(() => scrollWithJs(options));\r\n\r\n  return options.axis === 'y' ? dispatchHeavyAnimationEvent(promise) : promise;\r\n}\r\n\r\nfunction scrollWithJs(options: ScrollOptions): Promise<void> {\r\n  const {element, container, getNormalSize, axis, margin, position, forceDirection, maxDistance, forceDuration} = options;\r\n  if(!isInDOM(element)) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  const rectStartKey = axis === 'y' ? 'top' : 'left';\r\n  const rectEndKey = axis === 'y' ? 'bottom' : 'right';\r\n  const sizeKey = axis === 'y' ? 'height' : 'width';\r\n  const scrollSizeKey = axis === 'y' ? 'scrollHeight' : 'scrollWidth';\r\n  const scrollPositionKey = axis === 'y' ? 'scrollTop' : 'scrollLeft';\r\n\r\n  // const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\r\n  const elementRect = element.getBoundingClientRect();\r\n  const containerRect = container.getBoundingClientRect ? container.getBoundingClientRect() : document.body.getBoundingClientRect();\r\n\r\n  // const transformable = container.firstElementChild as HTMLElement;\r\n\r\n  const elementPosition = elementRect[rectStartKey] - containerRect[rectStartKey];\r\n  const elementSize = element[scrollSizeKey]; // margin is exclusive in DOMRect\r\n\r\n  const containerSize = getNormalSize ? getNormalSize({rect: containerRect}) : containerRect[sizeKey];\r\n\r\n  let scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  /* const elementPosition = element.offsetTop;\r\n  const elementSize = element.offsetHeight;\r\n\r\n  const scrollPosition = container[scrollPositionKey];\r\n  const scrollSize = container[scrollSizeKey];\r\n  const containerSize = container.offsetHeight; */\r\n\r\n  let path!: number;\r\n\r\n  switch(position) {\r\n    case 'start':\r\n      path = elementPosition - margin;\r\n      break;\r\n    case 'end':\r\n      path = elementRect[rectEndKey] /* + (elementSize - elementRect[sizeKey]) */ - containerRect[rectEndKey] + margin;\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      if(elementSize < containerSize) {\r\n        path = (elementPosition + elementSize / 2) - (containerSize / 2);\r\n      } else {\r\n        if(options.fallbackToElementStartWhenCentering && options.fallbackToElementStartWhenCentering !== element) {\r\n          options.element = options.fallbackToElementStartWhenCentering;\r\n          options.position = 'start';\r\n          return scrollWithJs(options);\r\n        }\r\n\r\n        path = elementPosition - margin;\r\n      }\r\n\r\n      break;\r\n  }\r\n  /* switch (position) {\r\n    case 'start':\r\n      path = (elementPosition - margin) - scrollPosition;\r\n      break;\r\n    case 'end':\r\n      path = (elementPosition + elementSize + margin) - (scrollPosition + containerSize);\r\n      break;\r\n    // 'nearest' is not supported yet\r\n    case 'nearest':\r\n    case 'center':\r\n      path = elementSize < containerSize\r\n        ? (elementPosition + elementSize / 2) - (scrollPosition + containerSize / 2)\r\n        : (elementPosition - margin) - scrollPosition;\r\n      break;\r\n  } */\r\n\r\n  if(Math.abs(path - (margin || 0)) < 1) {\r\n    cancelAnimationByKey(container);\r\n    return Promise.resolve();\r\n  }\r\n\r\n  if(axis === 'y') {\r\n    if(forceDirection === undefined) {\r\n      if(path > maxDistance) {\r\n        scrollPosition = container.scrollTop += path - maxDistance;\r\n        path = maxDistance;\r\n      } else if(path < -maxDistance) {\r\n        scrollPosition = container.scrollTop += path + maxDistance;\r\n        path = -maxDistance;\r\n      }\r\n    }/*  else if(forceDirection === FocusDirection.Up) { // * not tested yet\r\n      container.scrollTop = offsetTop + container.scrollTop + maxDistance;\r\n    } else if(forceDirection === FocusDirection.Down) { // * not tested yet\r\n      container.scrollTop = Math.max(0, offsetTop + container.scrollTop - maxDistance);\r\n    } */\r\n  }\r\n\r\n  // console.log('scrollWithJs: will scroll path:', path, element);\r\n\r\n  /* let existsTransform = 0;\r\n  const currentTransform = transformable.style.transform;\r\n  if(currentTransform) {\r\n    existsTransform = parseInt(currentTransform.match(/\\((.+?), (.+?), .+\\)/)[2]);\r\n    //path += existsTransform;\r\n  } */\r\n\r\n  if(path < 0) {\r\n    const remainingPath = -scrollPosition;\r\n    path = Math.max(path, remainingPath);\r\n  } else if(path > 0) {\r\n    const remainingPath = scrollSize - (scrollPosition + containerSize);\r\n    path = Math.min(path, remainingPath);\r\n  }\r\n\r\n  const target = container[scrollPositionKey] + path;\r\n  const absPath = Math.abs(path);\r\n  const duration = forceDuration ?? (\r\n    MIN_JS_DURATION + (absPath / LONG_TRANSITION_MAX_DISTANCE) * (MAX_JS_DURATION - MIN_JS_DURATION)\r\n  );\r\n  const startAt = Date.now();\r\n\r\n  /* transformable.classList.add('no-transition');\r\n\r\n  const tickTransform = () => {\r\n    const t = duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n    const currentPath = path * transition(t);\r\n\r\n    transformable.style.transform = `translate3d(0, ${-currentPath}px, 0)`;\r\n    container.dataset.translate = '' + -currentPath;\r\n\r\n    const willContinue = t < 1;\r\n    if(!willContinue) {\r\n      fastRaf(() => {\r\n        delete container.dataset.transform;\r\n        container.dataset.transform = '';\r\n        transformable.style.transform = '';\r\n        void transformable.offsetLeft; // reflow\r\n        transformable.classList.remove('no-transition');\r\n        void transformable.offsetLeft; // reflow\r\n        container[scrollPositionKey] = Math.round(target);\r\n      });\r\n    }\r\n\r\n    return willContinue;\r\n  };\r\n\r\n  return animateSingle(tickTransform, container); */\r\n\r\n  /* return new Promise((resolve) => {\r\n    fastRaf(() => {\r\n      transformable.style.transform = '';\r\n      transformable.style.transition = '';\r\n\r\n      setTimeout(resolve, duration);\r\n    });\r\n  });\r\n\r\n  const transformableHeight = transformable.scrollHeight;\r\n  //transformable.style.minHeight = `${transformableHeight}px`;\r\n  */\r\n\r\n  const transition = absPath < SHORT_TRANSITION_MAX_DISTANCE ? shortTransition : longTransition;\r\n  const getProgress = () => duration ? Math.min((Date.now() - startAt) / duration, 1) : 1;\r\n  const tick = () => {\r\n    const t = getProgress();\r\n    const value = transition(t);\r\n    const currentPath = path * (1 - value);\r\n    container[scrollPositionKey] = Math.round(target - currentPath);\r\n\r\n    return t < 1;\r\n  };\r\n\r\n  if(!duration || !path) {\r\n    cancelAnimationByKey(container);\r\n    tick();\r\n    return Promise.resolve();\r\n  }\r\n\r\n  /* return new Promise((resolve) => {\r\n    setTimeout(resolve, duration);\r\n  }).then(() => {\r\n    transformable.classList.add('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.style.transform = '';\r\n    transformable.style.transition = '';\r\n    void transformable.offsetLeft; // reflow\r\n    transformable.classList.remove('no-transition');\r\n    void transformable.offsetLeft; // reflow\r\n    fastRaf(() => {\r\n\r\n      container[scrollPositionKey] = Math.round(target);\r\n      //transformable.style.minHeight = ``;\r\n    });\r\n\r\n  }); */\r\n\r\n  if(options.startCallback) {\r\n    const distanceToEnd = scrollSize - Math.round(target + container[axis === 'y' ? 'offsetHeight' : 'offsetWidth']);\r\n    options.startCallback({\r\n      scrollSize,\r\n      scrollPosition,\r\n      distanceToEnd,\r\n      path,\r\n      duration,\r\n      containerRect,\r\n      elementRect,\r\n      getProgress\r\n    });\r\n  }\r\n\r\n  return animateSingle(tick, container);\r\n}\r\n\r\nfunction longTransition(t: number) {\r\n  return 1 - ((1 - t) ** 5);\r\n}\r\n\r\nfunction shortTransition(t: number) {\r\n  return 1 - ((1 - t) ** 3.5);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {InputFileLocation, InputStickerSet, InputWebFileLocation} from '../layer';\r\nimport type {DownloadOptions} from '../lib/mtproto/apiFileManager';\r\n\r\nconst FILENAME_JOINER = '_';\r\n\r\nexport function getFileNameByLocation(location: InputFileLocation | InputWebFileLocation, options?: Partial<{\r\n  fileName: string,\r\n  downloadId: string\r\n}>) {\r\n  const fileName = '';// (options?.fileName || '').split('.');\r\n  const ext = fileName[fileName.length - 1] || '';\r\n\r\n  let str: string;\r\n  switch(location._) {\r\n    case 'inputPhotoFileLocation': {\r\n      str = ['photo', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputDocumentFileLocation': {\r\n      str = ['document', fileName[0], location.id, location.thumb_size].filter(Boolean).join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputPeerPhotoFileLocation':\r\n      str = ['peerPhoto', location.photo_id, location.pFlags.big ? 'big' : 'small'].join(FILENAME_JOINER);\r\n      break;\r\n\r\n    case 'inputStickerSetThumb': {\r\n      const id = (location.stickerset as InputStickerSet.inputStickerSetID).id ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetShortName).short_name ||\r\n        (location.stickerset as InputStickerSet.inputStickerSetDice).emoticon ||\r\n        location.stickerset._;\r\n      str = ['stickerSetThumb', id, location.thumb_version].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    case 'inputFileLocation': {\r\n      str = location.volume_id + '_' + location.local_id;\r\n      break;\r\n    }\r\n\r\n    case 'inputWebFileLocation': {\r\n      str = ['webFile', location.url].join(FILENAME_JOINER);\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      console.error('Unrecognized location:', location);\r\n      str = '';\r\n      break;\r\n    }\r\n  }\r\n\r\n  return str + (options?.downloadId ? '_download' : '') + (ext ? '.' + ext : ext);\r\n}\r\n\r\nexport type FileURLType = 'photo' | 'thumb' | 'document' | 'stream' | 'download';\r\nexport function getFileURL(type: FileURLType, options: DownloadOptions) {\r\n  // console.log('getFileURL', location);\r\n  // const perf = performance.now();\r\n  const encoded = encodeURIComponent(JSON.stringify(options));\r\n  // console.log('getFileURL encode:', performance.now() - perf, encoded);\r\n\r\n  return /* '/' +  */type + '/' + encoded;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Message, MessageAction} from '../layer';\nimport type {MyMessage} from '../lib/appManagers/appMessagesManager';\nimport forEachReverse from './array/forEachReverse';\n\nexport default function filterChatPhotosMessages(value: {\n  count: number;\n  next_rate: number;\n  offset_id_offset: number;\n  history: MyMessage[];\n}) {\n  forEachReverse(value.history, (message, idx, arr) => {\n    if(!((message as Message.messageService).action as MessageAction.messageActionChatEditPhoto).photo) {\n      arr.splice(idx, 1);\n      if(value.count !== undefined) {\n        --value.count;\n      }\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {i18n, LangPackKey} from '../lib/langPack';\n\nexport default function formatBytes(bytes: number, decimals: number | 'auto' = 'auto') {\n  if(bytes === 0) return i18n('FileSize.B', [0]);\n\n  const strictDecimals = decimals === 'auto';\n\n  const k = 1024;\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  const _decimals = decimals === 'auto' ? Math.max(0, i - 1) : decimals;\n\n  const dm = Math.max(0, _decimals);\n  const sizes: LangPackKey[] = ['FileSize.B', 'FileSize.KB', 'FileSize.MB', 'FileSize.GB'];\n\n  const fixed = (bytes / Math.pow(k, i)).toFixed(dm);\n  return i18n(sizes[i], [strictDecimals ? fixed : parseFloat(fixed)]);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport I18n, {i18n, join, LangPackKey} from '../lib/langPack';\r\nimport formatDuration, {DurationType} from './formatDuration';\r\n\r\nconst CALL_DURATION_LANG_KEYS: {[type in DurationType]: LangPackKey} = {\r\n  s: 'Seconds',\r\n  m: 'Minutes',\r\n  h: 'Hours',\r\n  d: 'Days',\r\n  w: 'Weeks'\r\n};\r\nexport default function formatCallDuration(duration: number, plain?: boolean) {\r\n  const a = formatDuration(duration, 2);\r\n  if(plain) {\r\n    const strings = a.map((d) => I18n.format(CALL_DURATION_LANG_KEYS[d.type], true, [d.duration]));\r\n    return join(strings, false, plain);\r\n  }\r\n\r\n  const elements = a.map((d) => i18n(CALL_DURATION_LANG_KEYS[d.type], [d.duration]));\r\n\r\n  const fragment = document.createElement('span');\r\n  fragment.append(...join(elements, false));\r\n\r\n  return fragment;\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport type DurationType = 's' | 'm' | 'h' | 'd' | 'w';\r\nexport default function formatDuration(duration: number, showLast = 2) {\r\n  if(!duration) {\r\n    duration = 1;\r\n  }\r\n\r\n  const d: {duration: number, type: DurationType}[] = [];\r\n  const p = [\r\n    {m: 1, t: 's'},\r\n    {m: 60, t: 'm'},\r\n    {m: 60, t: 'h'},\r\n    {m: 24, t: 'd'},\r\n    {m: 7, t: 'w'}\r\n  ] as Array<{m?: number, t: DurationType}>\r\n  const s = 1;\r\n  let t = s;\r\n  p.forEach((o, idx) => {\r\n    t *= o.m;\r\n\r\n    if(duration < t) {\r\n      return;\r\n    }\r\n\r\n    const modulus = p[idx === (p.length - 1) ? idx : idx + 1].m;\r\n    d.push({\r\n      duration: (duration / t % modulus | 0),\r\n      type: o.t\r\n    });\r\n  });\r\n\r\n  const out = d.slice(-showLast).reverse();\r\n  for(let i = out.length - 1; i >= 0; --i) {\r\n    if(out[i].duration === 0) {\r\n      out.splice(i, 1);\r\n    }\r\n  }\r\n\r\n  return out;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {HelpCountry, HelpCountryCode} from '../layer';\nimport I18n from '../lib/langPack';\n\nlet sortedCountries: HelpCountry[];\ntype PrefixCountry = {country: HelpCountry, code: HelpCountryCode};\nconst prefixes: Map<string, PrefixCountry> = new Map();\nlet maxPrefixLength = 0;\nconst setPrefix = (country: HelpCountry, code: HelpCountryCode, prefix: string = '') => {\n  prefix = code.country_code + prefix;\n  /* if(prefixes.has(prefix)) {\n    console.error('asdasdasd', prefixes.get(prefix), country, code);\n  } */\n  maxPrefixLength = Math.max(maxPrefixLength, prefix.length);\n  prefixes.set(prefix, {country, code});\n};\n\nexport function formatPhoneNumber(originalStr: string): {\n  formatted: string,\n  country: HelpCountry,\n  code: HelpCountryCode,\n  leftPattern: string\n} {\n  originalStr = originalStr || '';\n\n  if(!prefixes.size) {\n    I18n.countriesList.forEach((country) => {\n      country.country_codes.forEach((code) => {\n        if(code.prefixes) {\n          code.prefixes.forEach((prefix) => {\n            setPrefix(country, code, prefix);\n          });\n        } else {\n          setPrefix(country, code);\n        }\n      });\n    });\n  }\n\n  // return {formatted: originalStr, country: undefined as any, leftPattern: ''};\n  let str = originalStr.replace(/\\D/g, '');\n  const phoneCode = str.slice(0, maxPrefixLength);\n\n  // //console.log('str', str, phoneCode);\n  // if(!sortedCountries) {\n  //   sortedCountries = I18n.countriesList.slice().sort((a, b) => b.country_codes[0].country_code.length - a.country_codes[0].country_code.length);\n  // }\n\n  // let country = sortedCountries.find((c) => {\n  //   return c.country_codes.find((c) => phoneCode.indexOf(c.replace(/\\D/g, '')) === 0);\n  // });\n\n  let prefixCountry: PrefixCountry;\n  for(let i = phoneCode.length - 1; i >= 0; --i) { // lookup for country by prefix\n    prefixCountry = prefixes.get(phoneCode.slice(0, i + 1));\n    if(prefixCountry) {\n      break;\n    }\n  }\n\n  if(!prefixCountry) {\n    return {\n      formatted: str,\n      country: undefined,\n      code: undefined,\n      leftPattern: ''\n    };\n  }\n\n  // country = /* PhoneCodesMain[country.phoneCode] ||  */country;\n  const country = prefixCountry.country;\n\n  const patterns = prefixCountry.code.patterns || [];\n  const searchForPattern = str.slice(prefixCountry.code.country_code.length); // splice country code\n  let pattern = '', mostMatchedPatternMatches = 0, mostMatchedPattern = '';\n  for(let i = patterns.length - 1; i >= 0; --i) {\n    pattern = patterns[i];\n\n    const _pattern = pattern.replace(/ /g, '');\n    let patternMatches = 0;\n    for(let k = 0, length = Math.min(searchForPattern.length, _pattern.length); k < length; ++k) {\n      if(searchForPattern[k] === _pattern[k] || _pattern[k] === 'X') {\n        ++patternMatches;\n      } else {\n        patternMatches = 0;\n        break;\n      }\n    }\n\n    if(patternMatches > mostMatchedPatternMatches) {\n      mostMatchedPatternMatches = patternMatches;\n      mostMatchedPattern = pattern;\n    }\n  }\n\n  pattern = mostMatchedPattern || pattern;\n  pattern = pattern.replace(/\\d/g, 'X');\n\n  pattern = prefixCountry.code.country_code + ' ' + pattern;\n  // let pattern = country.pattern || country.phoneCode;\n  pattern.split('').forEach((symbol, idx) => {\n    if(symbol === ' ' && str[idx] !== ' ' && str.length > idx) {\n      str = str.slice(0, idx) + ' ' + str.slice(idx);\n    }\n  });\n\n  /* if(country.pattern) {\n    str = str.slice(0, country.pattern.length);\n  } */\n\n  let leftPattern = pattern && pattern.length > str.length ? pattern.slice(str.length) : '';\n  if(leftPattern) {\n    /* const length = str.length;\n    leftPattern = leftPattern.split('').map((_, idx) => (length + idx).toString().slice(-1)).join(''); */\n    leftPattern = leftPattern.replace(/X/g, '');\n    // leftPattern = leftPattern.replace(/X/g, '0');\n  }\n\n  return {formatted: str, country, code: prefixCountry.code, leftPattern};\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// generate a path's arc data parameter\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\n\r\n// http://www.w3.org/TR/SVG/paths.html#PathDataEllipticalArcCommands\r\nfunction arcParameter(rx: number, ry: number, xAxisRotation: number, largeArcFlag: number, sweepFlag: number, x: number, y: number) {\r\n  return [rx, ',', ry, ' ',\r\n    xAxisRotation, ' ',\r\n    largeArcFlag, ',',\r\n    sweepFlag, ' ',\r\n    x, ',', y].join('');\r\n}\r\n\r\nexport default function generatePathData(x: number, y: number, width: number, height: number, tl: number, tr: number, br: number, bl: number) {\r\n  const data: string[] = [];\r\n\r\n  // start point in top-middle of the rectangle\r\n  data.push('M' + (x + width / 2) + ',' + y);\r\n\r\n  // next we go to the right\r\n  data.push('H' + (x + width - tr));\r\n\r\n  if(tr > 0) {\r\n    // now we draw the arc in the top-right corner\r\n    data.push('A' + arcParameter(tr, tr, 0, 0, 1, (x + width), (y + tr)));\r\n  }\r\n\r\n  // next we go down\r\n  data.push('V' + (y + height - br));\r\n\r\n  if(br > 0) {\r\n    // now we draw the arc in the lower-right corner\r\n    data.push('A' + arcParameter(br, br, 0, 0, 1, (x + width - br), (y + height)));\r\n  }\r\n\r\n  // now we go to the left\r\n  data.push('H' + (x + bl));\r\n\r\n  if(bl > 0) {\r\n    // now we draw the arc in the lower-left corner\r\n    data.push('A' + arcParameter(bl, bl, 0, 0, 1, (x + 0), (y + height - bl)));\r\n  }\r\n\r\n  // next we go up\r\n  data.push('V' + (y + tl));\r\n\r\n  if(tl > 0) {\r\n    // now we draw the arc in the top-left corner\r\n    data.push('A' + arcParameter(tl, tl, 0, 0, 1, (x + tl), (y + 0)));\r\n  }\r\n\r\n  // and we close the path\r\n  data.push('Z');\r\n\r\n  return data.join(' ');\r\n}\r\n\r\nMOUNT_CLASS_TO.generatePathData = generatePathData;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize} from '../layer';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {renderImageFromUrlPromise} from './dom/renderImageFromUrl';\nimport getPreviewURLFromThumb from './getPreviewURLFromThumb';\nimport blur from './blur';\n\nexport default function getImageFromStrippedThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, useBlur: boolean) {\n  const url = getPreviewURLFromThumb(photo, thumb, false);\n\n  let element: HTMLImageElement | HTMLCanvasElement, loadPromise: Promise<void>;\n  if(!useBlur) {\n    element = new Image();\n    loadPromise = renderImageFromUrlPromise(element, url);\n  } else {\n    const result = blur(url);\n    element = result.canvas;\n    loadPromise = result.promise;\n  }\n\n  element.classList.add('thumbnail');\n\n  return {image: element, loadPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {PhotoSize} from '../layer';\n// import appDownloadManager from \"../lib/appManagers/appDownloadManager\";\nimport getPreviewURLFromBytes from './bytes/getPreviewURLFromBytes';\n\nexport default function getPreviewURLFromThumb(photo: MyPhoto | MyDocument, thumb: PhotoSize.photoCachedSize | PhotoSize.photoStrippedSize, isSticker = false) {\n  // const cacheContext = appDownloadManager.getCacheContext(photo, thumb.type);\n  // return cacheContext.url || (cacheContext.url = getPreviewURLFromBytes(thumb.bytes, isSticker));\n  return getPreviewURLFromBytes(thumb.bytes, isSticker);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport type {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport {THUMB_TYPE_FULL} from '../lib/mtproto/mtproto_config';\nimport type {ThumbCache} from '../lib/storages/thumbs';\nimport getImageFromStrippedThumb from './getImageFromStrippedThumb';\n\nexport default function getStrippedThumbIfNeeded(photo: MyPhoto | MyDocument, cacheContext: ThumbCache, useBlur: boolean, ignoreCache = false) {\n  const isVideo = (['video', 'gif'] as MyDocument['type'][]).includes((photo as MyDocument).type);\n  if(!cacheContext.downloaded || isVideo || ignoreCache) {\n    if(\n      photo._ === 'document' &&\n      cacheContext.downloaded &&\n      !ignoreCache &&\n      (!isVideo || cacheContext.type !== THUMB_TYPE_FULL)\n    ) {\n      return null;\n    }\n\n    const sizes = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs;\n    const thumb = sizes?.length ? sizes.find((size) => size._ === 'photoStrippedSize') : null;\n    if(thumb && ('bytes' in thumb)) {\n      return getImageFromStrippedThumb(photo, thumb as any, useBlur);\n    }\n  }\n\n  return null;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from './array/forEachReverse';\nimport safeAssign from './object/safeAssign';\n\nexport type ListLoaderOptions<T extends {}, P extends {}> = {\n  loadMore: ListLoader<T, P>['loadMore'],\n  loadCount?: ListLoader<T, P>['loadCount'],\n  loadWhenLeft?: ListLoader<T, P>['loadWhenLeft'],\n  processItem?: ListLoader<T, P>['processItem'],\n  onJump?: ListLoader<T, P>['onJump'],\n  onLoadedMore?: ListLoader<T, P>['onLoadedMore']\n};\n\nexport type ListLoaderResult<T extends {}> = {count: number, items: any[]};\nexport default class ListLoader<T extends {}, P extends {}> {\n  public current: T;\n  public previous: T[] = [];\n  public next: T[] = [];\n  public count: number;\n  public reverse = false; // reverse means next = higher msgid\n\n  protected loadMore: (anchor: T, older: boolean, loadCount: number) => Promise<ListLoaderResult<T>>;\n  protected processItem: (item: P) => T | Promise<T>;\n  protected loadCount = 50;\n  protected loadWhenLeft = 20;\n\n  public onJump: (item: T, older: boolean) => void;\n  public onLoadedMore: () => void;\n\n  protected loadedAllUp = false;\n  protected loadedAllDown = false;\n  protected loadPromiseUp: Promise<void>;\n  protected loadPromiseDown: Promise<void>;\n\n  constructor(options: ListLoaderOptions<T, P>) {\n    safeAssign(this, options);\n  }\n\n  public setTargets(previous: T[], next: T[], reverse: boolean) {\n    this.previous = previous;\n    this.next = next;\n    this.reverse = reverse;\n  }\n\n  public get index() {\n    return this.count !== undefined ? this.previous.length : -1;\n  }\n\n  /* public filter(callback: (item: T, idx: number, arr: T[]) => boolean) {\n    const filter = (item: T, idx: number, arr: T[]) => {\n      if(!callback(item, idx, arr)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n  } */\n\n  public reset(loadedAll = false) {\n    this.current = undefined;\n    this.previous = [];\n    this.next = [];\n    this.setLoaded(true, loadedAll);\n    this.setLoaded(false, loadedAll);\n  }\n\n  public go(length: number, dispatchJump = true) {\n    let items: T[], item: T;\n    if(length > 0) {\n      items = this.next.splice(0, length);\n      item = items.pop();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.unshift(this.current);\n      this.previous.push(...items);\n    } else {\n      items = this.previous.splice(Math.max(0, this.previous.length + length), -length);\n      item = items.shift();\n      if(!item) {\n        return;\n      }\n\n      if(this.current !== undefined) items.push(this.current);\n      this.next.unshift(...items);\n    }\n\n    if(this.next.length < this.loadWhenLeft) {\n      this.load(!this.reverse);\n    }\n\n    if(this.previous.length < this.loadWhenLeft) {\n      this.load(this.reverse);\n    }\n\n    this.current = item;\n    dispatchJump && this.onJump && this.onJump(item, length > 0);\n    return this.current;\n  }\n\n  protected unsetCurrent(toPrevious: boolean) {\n    if(toPrevious) this.previous.push(this.current);\n    else this.next.unshift(this.current);\n\n    this.current = undefined;\n  }\n\n  public goUnsafe(length: number, dispatchJump?: boolean) {\n    const leftLength = length > 0 ? Math.max(0, length - this.next.length) : Math.min(0, length + this.previous.length);\n    const item = this.go(length, leftLength ? false : dispatchJump);\n\n    /* if(length > 0 ? this.loadedAllUp : this.loadedAllDown) {\n      this.unsetCurrent(length > 0);\n    } */\n\n    return {\n      item: !leftLength ? item : undefined,\n      leftLength\n    };\n  }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const isChanged = (down ? this.loadedAllDown : this.loadedAllUp) !== value;\n    if(!isChanged) {\n      return false;\n    }\n\n    if(down) this.loadedAllDown = value;\n    else this.loadedAllUp = value;\n\n    if(!value) {\n      if(down) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    }\n\n    return true;\n  }\n\n  //      reverse  loadMediaPromise\n  public load(older: boolean) {\n    if(older ? this.loadedAllDown : this.loadedAllUp) return Promise.resolve();\n\n    let promise = older ? this.loadPromiseDown : this.loadPromiseUp;\n    if(promise) return promise;\n\n    let anchor: T;\n    if(older) {\n      anchor = this.reverse ? this.previous[0] : this.next[this.next.length - 1];\n    } else {\n      anchor = this.reverse ? this.next[this.next.length - 1] : this.previous[0];\n    }\n\n    anchor ??= this.current;\n    promise = this.loadMore(anchor, older, this.loadCount).then(async(result) => {\n      if((older ? this.loadPromiseDown : this.loadPromiseUp) !== promise) {\n        return;\n      }\n\n      if(result.items.length < this.loadCount) {\n        this.setLoaded(older, true);\n      }\n\n      if(this.count === undefined) {\n        this.count = result.count || result.items.length;\n      }\n\n      const processedArr: (Promise<any> | any)[] = [];\n      const method = older ? result.items.forEach.bind(result.items) : forEachReverse.bind(null, result.items);\n      method((item: any) => {\n        const processed = this.processItem ? this.processItem(item) : item;\n\n        if(!processed) return;\n        processedArr.push(processed);\n      });\n\n      const results = await Promise.all(processedArr);\n      if(older) {\n        if(this.reverse) this.previous.unshift(...results);\n        else this.next.push(...results);\n      } else {\n        if(this.reverse) this.next.push(...results);\n        else this.previous.unshift(...results);\n      }\n\n      this.onLoadedMore && this.onLoadedMore();\n    }, () => {}).then(() => {\n      if(older) this.loadPromiseDown = null;\n      else this.loadPromiseUp = null;\n    });\n\n    if(older) this.loadPromiseDown = promise;\n    else this.loadPromiseUp = promise;\n\n    return promise;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type EventListenerBase from './eventListenerBase';\r\n\r\nexport type Listener = {\r\n  element: ListenerElement,\r\n  event: ListenerEvent,\r\n  callback: ListenerCallback,\r\n  options?: ListenerOptions,\r\n\r\n  onceFired?: true, // will be set only when options.once is set\r\n  onceCallback?: () => void,\r\n};\r\n\r\nexport type ListenerElement = Window | Document | HTMLElement | Element | EventListenerBase<any>;\r\nexport type ListenerEvent = string;\r\nexport type ListenerCallback = Function;\r\nexport type ListenerOptions = AddEventListenerOptions;\r\n\r\n/* const originalAddEventListener = HTMLElement.prototype.addEventListener;\r\nHTMLElement.prototype.addEventListener = function(this, name: string, callback: EventListenerOrEventListenerObject, options: AddEventListenerOptions) {\r\n  console.log('nu zdarova', name);\r\n  originalAddEventListener.call(this, name, callback, options);\r\n\r\n  if(options?.ls) {\r\n    return options.ls.addFromElement(this, name, callback as any, options);\r\n  }\r\n}; */\r\n\r\nexport default class ListenerSetter {\r\n  private listeners: Set<Listener> = new Set();\r\n\r\n  public add<T extends ListenerElement>(element: T): T['addEventListener'] {\r\n    return ((event: string, callback: Function, options: ListenerOptions) => {\r\n      const listener: Listener = {element, event, callback, options};\r\n      this.addManual(listener);\r\n      return listener;\r\n    }) as any;\r\n  }\r\n\r\n  /* public addFromElement<T extends ListenerElement>(element: T, event: ListenerEvent, callback: ListenerCallback, options: ListenerOptions) {\r\n    const listener: Listener = {element, event, callback, options};\r\n    this.addManual(listener);\r\n    return listener;\r\n  } */\r\n\r\n  public addManual(listener: Listener) {\r\n    // @ts-ignore\r\n    listener.element.addEventListener(listener.event, listener.callback, listener.options);\r\n\r\n    if(listener.options?.once) { // remove listener when its called\r\n      listener.onceCallback = () => {\r\n        this.remove(listener);\r\n        listener.onceFired = true;\r\n      };\r\n\r\n      // @ts-ignore\r\n      listener.element.addEventListener(listener.event, listener.onceCallback, listener.options);\r\n    }\r\n\r\n    this.listeners.add(listener);\r\n  }\r\n\r\n  public remove(listener: Listener) {\r\n    if(!listener.onceFired) {\r\n      // @ts-ignore\r\n      listener.element.removeEventListener(listener.event, listener.callback, listener.options);\r\n\r\n      if(listener.onceCallback) {\r\n        // @ts-ignore\r\n        listener.element.removeEventListener(listener.event, listener.onceCallback, listener.options);\r\n      }\r\n    }\r\n\r\n    this.listeners.delete(listener);\r\n  }\r\n\r\n  public removeManual<T extends ListenerElement>(\r\n    element: T,\r\n    event: ListenerEvent,\r\n    callback: ListenerCallback,\r\n    options?: ListenerOptions\r\n  ) {\r\n    let listener: Listener;\r\n    for(const _listener of this.listeners) {\r\n      if(_listener.element === element &&\r\n        _listener.event === event &&\r\n        _listener.callback === callback &&\r\n        _listener.options === options) {\r\n        listener = _listener;\r\n        break;\r\n      }\r\n    }\r\n\r\n    if(listener) {\r\n      this.remove(listener);\r\n    }\r\n  }\r\n\r\n  public removeAll() {\r\n    this.listeners.forEach((listener) => {\r\n      this.remove(listener);\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport calcImageInBox from './calcImageInBox';\n\nexport class MediaSize {\n  constructor(public width = 0, public height = width) {\n\n  }\n\n  public aspect(boxSize: MediaSize, fitted: boolean) {\n    return calcImageInBox(this.width, this.height, boxSize.width, boxSize.height, fitted);\n  }\n\n  public aspectFitted(boxSize: MediaSize) {\n    return this.aspect(boxSize, true);\n  }\n\n  public aspectCovered(boxSize: MediaSize) {\n    return this.aspect(boxSize, false);\n  }\n}\n\nexport function makeMediaSize(width?: number, height?: number): MediaSize {\n  return new MediaSize(width, height);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport EventListenerBase from './eventListenerBase';\r\nimport {makeMediaSize, MediaSize} from './mediaSize';\r\n\r\ntype MediaTypeSizes = {\r\n  regular: MediaSize,\r\n  webpage: MediaSize,\r\n  album: MediaSize,\r\n  esgSticker: MediaSize,\r\n  animatedSticker: MediaSize,\r\n  staticSticker: MediaSize,\r\n  emojiSticker: MediaSize,\r\n  poll: MediaSize,\r\n  round: MediaSize,\r\n  documentName: MediaSize,\r\n  invoice: MediaSize,\r\n  customEmoji: MediaSize,\r\n  esgCustomEmoji: MediaSize\r\n};\r\n\r\nexport type MediaSizeType = keyof MediaTypeSizes;\r\n\r\nexport enum ScreenSize {\r\n  mobile,\r\n  medium,\r\n  large\r\n}\r\n\r\nconst MOBILE_SIZE = 600;\r\nconst MEDIUM_SIZE = 1275;\r\nconst LARGE_SIZE = 1680;\r\n\r\nclass MediaSizes extends EventListenerBase<{\r\n  changeScreen: (from: ScreenSize, to: ScreenSize) => void,\r\n  resize: () => void\r\n}> {\r\n  private screenSizes: {key: ScreenSize, value: number}[] = [\r\n    {key: ScreenSize.mobile, value: MOBILE_SIZE},\r\n    {key: ScreenSize.medium, value: MEDIUM_SIZE},\r\n    {key: ScreenSize.large, value: LARGE_SIZE}\r\n  ];\r\n\r\n  private sizes: {[k in 'desktop' | 'handhelds']: MediaTypeSizes} = {\r\n    handhelds: {\r\n      regular: makeMediaSize(270, 270),\r\n      webpage: makeMediaSize(270, 200),\r\n      album: makeMediaSize(270, 0),\r\n      esgSticker: makeMediaSize(68, 68),\r\n      animatedSticker: makeMediaSize(180, 180),\r\n      staticSticker: makeMediaSize(180, 180),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(240, 0),\r\n      round: makeMediaSize(200, 200),\r\n      documentName: makeMediaSize(200, 0),\r\n      invoice: makeMediaSize(240, 240),\r\n      customEmoji: makeMediaSize(18, 18),\r\n      esgCustomEmoji: makeMediaSize(32, 32)\r\n    },\r\n    desktop: {\r\n      regular: makeMediaSize(420, 340),\r\n      webpage: makeMediaSize(420, 340),\r\n      album: makeMediaSize(420, 0),\r\n      esgSticker: makeMediaSize(80, 80),\r\n      animatedSticker: makeMediaSize(200, 200),\r\n      staticSticker: makeMediaSize(200, 200),\r\n      emojiSticker: makeMediaSize(112, 112),\r\n      poll: makeMediaSize(330, 0),\r\n      round: makeMediaSize(280, 280),\r\n      documentName: makeMediaSize(240, 0),\r\n      invoice: makeMediaSize(320, 260),\r\n      customEmoji: makeMediaSize(18, 18),\r\n      esgCustomEmoji: makeMediaSize(32, 32)\r\n    }\r\n  };\r\n\r\n  public isMobile = false;\r\n  public active: MediaTypeSizes;\r\n  public activeScreen: ScreenSize;\r\n  private rAF: number;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    window.addEventListener('resize', () => {\r\n      if(this.rAF) window.cancelAnimationFrame(this.rAF);\r\n      this.rAF = window.requestAnimationFrame(() => {\r\n        this.handleResize();\r\n        this.rAF = 0;\r\n      });\r\n    });\r\n    this.handleResize();\r\n  }\r\n\r\n  private handleResize = () => {\r\n    const innerWidth = window.innerWidth;\r\n    // this.isMobile = innerWidth <= 720;\r\n\r\n    let activeScreen = this.screenSizes[0].key;\r\n    for(let i = this.screenSizes.length - 1; i >= 0; --i) {\r\n      if(this.screenSizes[i].value < innerWidth) {\r\n        activeScreen = (this.screenSizes[i + 1] || this.screenSizes[i]).key;\r\n        break;\r\n      }\r\n    }\r\n\r\n    const wasScreen = this.activeScreen;\r\n    this.activeScreen = activeScreen;\r\n    this.isMobile = this.activeScreen === ScreenSize.mobile;\r\n    this.active = this.isMobile ? this.sizes.handhelds : this.sizes.desktop;\r\n\r\n    // console.time('esg');\r\n    // const computedStyle = window.getComputedStyle(document.documentElement);\r\n    // this.active.esgSticker.width = parseFloat(computedStyle.getPropertyValue('--esg-sticker-size'));\r\n    // console.timeEnd('esg');\r\n\r\n    if(wasScreen !== activeScreen) {\r\n      // console.log('changeScreen', this.activeScreen, activeScreen);\r\n\r\n      if(wasScreen !== undefined) {\r\n        this.dispatchEvent('changeScreen', wasScreen, activeScreen);\r\n      }\r\n    }\r\n\r\n    if(wasScreen !== undefined) {\r\n      this.dispatchEvent('resize');\r\n    }\r\n\r\n    /* if(this.isMobile) {\r\n      for(let i in this.active) {\r\n        // @ts-ignore\r\n        let size = this.active[i];\r\n        size.width = innerWidth\r\n      }\r\n    } */\r\n  };\r\n}\r\n\r\nconst mediaSizes = new MediaSizes();\r\nMOUNT_CLASS_TO.mediaSizes = mediaSizes;\r\nexport default mediaSizes;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function middlewarePromise(middleware: () => boolean, throwWhat: any = '') {\n  return <T>(promise: T): T => {\n    if(!(promise instanceof Promise)) {\n      if(promise instanceof Error) {\n        throw promise;\n      } else {\n        return promise;\n      }\n    }\n\n    return (promise as any as Promise<any>).then((result) => {\n      if(!middleware()) {\n        throw throwWhat;\n      }\n\n      return result;\n    }) as any;\n  };\n}\n","export default function clamp(v: number, min: number, max: number): number {\n  return v < min ? min : ((v > max) ? max : v);\n}\n","export default function formatNumber(bytes: number, decimals = 2) {\n  if(bytes === 0) return '0';\n\n  const k = 1000;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = ['', 'K', 'M', 'B', 'T'];\n\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + sizes[i];\n}\n","export default function numberThousandSplitter(x: number, joiner = ' ') {\n  const parts = x.toString().split('.');\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, joiner);\n  return parts.join('.');\n}\n","import {IS_APPLE_MOBILE} from '../environment/userAgent';\n\nexport default function onMediaLoad(media: HTMLMediaElement, readyState = media.HAVE_METADATA, useCanplayOnIos?: boolean) {\n  return new Promise<void>((resolve) => {\n    if(media.readyState >= readyState) {\n      resolve();\n      return;\n    }\n\n    media.addEventListener(IS_APPLE_MOBILE && !useCanplayOnIos ? 'loadeddata' : 'canplay', () => resolve(), {once: true});\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appNavigationController, {NavigationItem} from '../components/appNavigationController';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport {IS_MOBILE_SAFARI} from '../environment/userAgent';\nimport cancelEvent from './dom/cancelEvent';\nimport {CLICK_EVENT_NAME} from './dom/clickEvent';\nimport findUpAsChild from './dom/findUpAsChild';\nimport EventListenerBase from './eventListenerBase';\n\nexport default class OverlayClickHandler extends EventListenerBase<{\n  toggle: (open: boolean) => void\n}> {\n  protected element: HTMLElement;\n  protected overlay: HTMLElement;\n  protected listenerOptions: AddEventListenerOptions;\n\n  constructor(\n    protected navigationType: NavigationItem['type'],\n    protected withOverlay?: boolean\n  ) {\n    super(false);\n    this.listenerOptions = withOverlay ? {} : {capture: true};\n  }\n\n  protected onClick = (e: MouseEvent | TouchEvent) => {\n    if(this.element && findUpAsChild(e.target as HTMLElement, this.element)) {\n      return;\n    }\n\n    if(this.listenerOptions?.capture) {\n      cancelEvent(e);\n    }\n\n    this.close();\n  };\n\n  public close() {\n    if(this.element) {\n      this.overlay?.remove();\n      this.element = undefined;\n      this.dispatchEvent('toggle', false);\n    }\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.removeEventListener('keydown', onKeyDown, {capture: true});\n      window.removeEventListener('contextmenu', this.onClick, this.listenerOptions);\n    }\n\n    document.removeEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.removeByType(this.navigationType);\n    }\n  }\n\n  public open(element: HTMLElement) {\n    this.close();\n\n    if(!IS_MOBILE_SAFARI) {\n      appNavigationController.pushItem({\n        type: this.navigationType,\n        onPop: (canAnimate) => {\n          this.close();\n        }\n      });\n    }\n\n    this.element = element;\n\n    if(!this.overlay && this.withOverlay) {\n      this.overlay = document.createElement('div');\n      this.overlay.classList.add('btn-menu-overlay');\n\n      // ! because this event must be canceled, and can't cancel on menu click (below)\n      this.overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n        cancelEvent(e);\n        this.onClick(e);\n      });\n    }\n\n    this.overlay && this.element.parentElement.insertBefore(this.overlay, this.element);\n\n    // document.body.classList.add('disable-hover');\n\n    if(!IS_TOUCH_SUPPORTED) {\n      // window.addEventListener('keydown', onKeyDown, {capture: true});\n      window.addEventListener('contextmenu', this.onClick, {...this.listenerOptions, once: true});\n    }\n\n    /* // ! because this event must be canceled, and can't cancel on menu click (below)\n    overlay.addEventListener(CLICK_EVENT_NAME, (e) => {\n      cancelEvent(e);\n      onClick(e);\n    }); */\n\n    // ! safari iOS doesn't handle window click event on overlay, idk why\n    document.addEventListener(CLICK_EVENT_NAME, this.onClick, this.listenerOptions);\n\n    this.dispatchEvent('toggle', true);\n  }\n}\n","import Currencies from '../config/currencies';\n\n// https://stackoverflow.com/a/34141813\nfunction number_format(number: any, decimals: any, dec_point: any, thousands_sep: any): string {\n  // Strip all characters but numerical ones.\n  number = (number + '').replace(/[^0-9+\\-Ee.]/g, '');\n  var n = !isFinite(+number) ? 0 : +number,\n    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),\n    sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,\n    dec = (typeof dec_point === 'undefined') ? '.' : dec_point,\n    s: any = '',\n    toFixedFix = function(n: number, prec: number) {\n      var k = Math.pow(10, prec);\n      return '' + Math.round(n * k) / k;\n    };\n  // Fix for IE parseFloat(0.55).toFixed(0) = 0;\n  s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');\n  if(s[0].length > 3) {\n    s[0] = s[0].replace(/\\B(?=(?:\\d{3})+(?!\\d))/g, sep);\n  }\n  if((s[1] || '').length < prec) {\n    s[1] = s[1] || '';\n    s[1] += new Array(prec - s[1].length + 1).join('0');\n  }\n  return s.join(dec);\n}\n\nexport default function paymentsWrapCurrencyAmount(amount: number | string, currency: string, skipSymbol?: boolean) {\n  amount = +amount;\n\n  const isNegative = amount < 0;\n\n  const currencyData = Currencies[currency];\n  if(!currencyData) {\n    throw new Error('CURRENCY_WRAP_INVALID');\n  }\n\n  const amountExp = amount / Math.pow(10, currencyData.exp);\n\n  let decimals = currencyData.exp;\n  if(currency == 'IRR' && Math.floor(amountExp) == amountExp) {\n    decimals = 0; //      = 0     UI\n  }\n\n  let formatted = number_format(amountExp, decimals, currencyData.decimal_sep, currencyData.thousands_sep);\n  if(skipSymbol) {\n    return formatted;\n  }\n\n  let symbol = currencyData.symbol;\n  if(isNegative && !currencyData.space_between && currencyData.symbol_left) {\n    symbol = '-' + symbol;\n    formatted = formatted.replace('-', '');\n  }\n\n  let out: string;\n  const splitter = currencyData.space_between ? ' ' : '';\n  if(currencyData.symbol_left) {\n    out = symbol + splitter + formatted;\n  } else {\n    out = formatted + splitter + symbol;\n  }\n  return out;\n}\n\n(window as any).p = paymentsWrapCurrencyAmount;\n\n// function paymentsGetCurrencyExp($currency: string) {\n//   if($currency == 'CLF') {\n//     return 4;\n//   }\n//   if(['BHD','IQD','JOD','KWD','LYD','OMR','TND'].includes($currency)) {\n//     return 3;\n//   }\n//   if(['BIF','BYR','CLP','CVE','DJF','GNF','ISK','JPY','KMF','KRW','MGA', 'PYG','RWF','UGX','UYI','VND','VUV','XAF','XOF','XPF'].includes($currency)) {\n//     return 0;\n//   }\n//   if($currency == 'MRO') {\n//     return 1;\n//   }\n//   return 2;\n// }\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport mediaSizes from './mediaSizes';\n\nexport type MenuPositionPadding = {\n  top?: number,\n  right?: number,\n  bottom?: number,\n  left?: number\n};\n\nconst PADDING_TOP = 8;\nconst PADDING_BOTTOM = PADDING_TOP;\nconst PADDING_LEFT = 8;\nconst PADDING_RIGHT = PADDING_LEFT;\nexport default function positionMenu({pageX, pageY}: MouseEvent | Touch, elem: HTMLElement, side?: 'left' | 'right' | 'center', additionalPadding?: MenuPositionPadding) {\n  // let {clientX, clientY} = e;\n\n  // * side mean the OPEN side\n\n  const getScrollWidthFromElement = (Array.from(elem.children) as HTMLElement[]).find((element) => element.classList.contains('btn-menu-item') && !element.classList.contains('hide')) || elem;\n\n  const {scrollWidth: menuWidth} = getScrollWidthFromElement;\n  const {scrollHeight: menuHeight} = elem;\n  // let {innerWidth: windowWidth, innerHeight: windowHeight} = window;\n  const rect = document.body.getBoundingClientRect();\n  const windowWidth = rect.width;\n  const windowHeight = rect.height;\n\n  let paddingTop = PADDING_TOP, paddingRight = PADDING_RIGHT, paddingBottom = PADDING_BOTTOM, paddingLeft = PADDING_LEFT;\n  if(additionalPadding) {\n    if(additionalPadding.top) paddingTop += additionalPadding.top;\n    if(additionalPadding.right) paddingRight += additionalPadding.right;\n    if(additionalPadding.bottom) paddingBottom += additionalPadding.bottom;\n    if(additionalPadding.left) paddingLeft += additionalPadding.left;\n  }\n\n  side = mediaSizes.isMobile ? 'right' : 'left';\n  let verticalSide: 'top' /* | 'bottom' */ | 'center' = 'top';\n\n  const maxTop = windowHeight - menuHeight - paddingBottom;\n  const maxLeft = windowWidth - menuWidth - paddingRight;\n  const minTop = paddingTop;\n  const minLeft = paddingLeft;\n\n  const getSides = () => {\n    return {\n      x: {\n        left: pageX,\n        right: Math.min(maxLeft, pageX - menuWidth)\n      },\n      intermediateX: side === 'right' ? minLeft : maxLeft,\n      // intermediateX: clientX < windowWidth / 2 ? PADDING_LEFT : windowWidth - menuWidth - PADDING_LEFT,\n      y: {\n        top: pageY,\n        bottom: pageY - menuHeight\n      },\n      // intermediateY: verticalSide === 'top' ? paddingTop : windowHeight - menuHeight - paddingTop,\n      // intermediateY: pageY < (windowHeight / 2) ? paddingTop : windowHeight - menuHeight - paddingBottom,\n      intermediateY: maxTop\n    };\n  };\n\n  const sides = getSides();\n\n  const possibleSides = {\n    x: {\n      left: (sides.x.left + menuWidth + paddingRight) <= windowWidth,\n      right: sides.x.right >= paddingLeft\n    },\n    y: {\n      top: (sides.y.top + menuHeight + paddingBottom) <= windowHeight,\n      bottom: (sides.y.bottom - paddingBottom) >= paddingBottom\n    }\n  };\n\n  /* if(side === undefined) {\n    if((clientX + menuWidth + PADDING_LEFT) > windowWidth) {\n      side = 'right';\n    }\n  } */\n\n  {\n    /* const x = sides.x;\n\n    const s = Object.keys(x) as (keyof typeof possibleSides.x)[];\n    if(side) {\n      s.findAndSplice((s) => s === side);\n      s.unshift(side);\n    }\n\n    const possibleSide = s.find((s) => possibleSides.x[s]); */\n    // let left: number;\n    /* if(possibleSide) {\n      left = x[possibleSide];\n      side = possibleSide;\n    } else {\n      left = sides.intermediateX;\n      side = undefined;\n    } */\n    const left = possibleSides.x[side] ? sides.x[side] : (side = 'center', sides.intermediateX);\n\n    elem.style.left = left + 'px';\n  }\n\n  /* if((clientY + menuHeight + PADDING_TOP) > windowHeight) {\n    elem.style.top = clamp(clientY - menuHeight, PADDING_TOP, windowHeight - menuHeight - PADDING_TOP) + 'px';\n    // elem.style.top = (innerHeight - scrollHeight - PADDING_TOP) + 'px';\n    verticalSide = 'bottom';\n  } else {\n    elem.style.top = Math.max(PADDING_TOP, clientY) + 'px';\n    verticalSide = 'top';\n  } */\n\n  {\n    const top = possibleSides.y[verticalSide] ? sides.y[verticalSide] : (verticalSide = 'center', sides.intermediateY);\n\n    elem.style.top = top + 'px';\n  }\n\n  elem.className = elem.className.replace(/(top|center|bottom)-(left|center|right)/g, '');\n  elem.classList.add(\n    // (verticalSide === 'center' ? verticalSide : (verticalSide === 'bottom' ? 'top' : 'bottom')) +\n    (verticalSide === 'center' ? verticalSide : 'bottom') +\n    '-' +\n    (side === 'center' ? side : (side === 'left' ? 'right' : 'left')));\n\n  return {\n    width: menuWidth,\n    height: menuHeight\n  };\n}\n","import {RestrictionReason} from '../layer';\n\nconst platforms = new Set([\n  'all',\n  'web',\n  'webk'\n]);\n\nconst ignore = new Set();\n\nexport function getRestrictionReason(reasons: RestrictionReason[]) {\n  // return reasons[0];\n  return reasons.find((reason) => platforms.has(reason.platform) && !ignore.has(reason.reason));\n}\n\nexport function isRestricted(reasons: RestrictionReason[]) {\n  return !!getRestrictionReason(reasons);\n}\n\nexport function ignoreRestrictionReasons(reasons: string[]) {\n  ignore.clear();\n  reasons.forEach((reason) => {\n    ignore.add(reason);\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../lib/appManagers/appDocsManager';\nimport rootScope from '../lib/rootScope';\n\nconst savingLottiePreview: {[docId: DocId]: {width: number, height: number}} = {};\n\nexport function isSavingLottiePreview(doc: MyDocument, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  return !!savingLottiePreview[key];\n}\n\nexport async function saveLottiePreview(doc: MyDocument, canvas: HTMLCanvasElement, toneIndex: number) {\n  const key = doc.id + '-' + toneIndex;\n  const {width, height} = canvas;\n  let saving = savingLottiePreview[key];\n  if(saving && saving.width >= width && saving.height >= height) {\n    return;\n  }\n\n  saving = savingLottiePreview[key] = {\n    width,\n    height\n  };\n\n  const thumb = await rootScope.managers.appDocsManager.getLottieCachedThumb(doc.id, toneIndex);\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  if(thumb && thumb.w >= width && thumb.h >= height) {\n    return;\n  }\n\n  const promise = new Promise<Blob>((resolve) => {\n    canvas.toBlob((blob) => resolve(blob));\n  });\n\n  const blob = await promise;\n  if(savingLottiePreview[key] !== saving) {\n    return;\n  }\n\n  // console.log('got lottie preview', doc, blob, URL.createObjectURL(blob));\n\n  rootScope.managers.appDocsManager.saveLottiePreview(doc.id, blob, width, height, toneIndex);\n\n  delete savingLottiePreview[key];\n\n  /* const reader = new FileReader();\n  reader.onloadend = (e) => {\n    const uint8 = new Uint8Array(e.target.result as ArrayBuffer);\n    const thumb: PhotoSize.photoStrippedSize = {\n      _: 'photoStrippedSize',\n      bytes: uint8,\n      type: 'i'\n    };\n\n    doc.stickerSavedThumbWidth = canvas.width;\n    doc.stickerSavedThumbHeight = canvas.width;\n\n    defineNotNumerableProperties(thumb, ['url']);\n    thumb.url = URL.createObjectURL(blob);\n    doc.thumbs.findAndSplice((t) => t._ === thumb._);\n    doc.thumbs.unshift(thumb);\n\n    if(!webpWorkerController.isWebpSupported()) {\n      doc.pFlags.stickerThumbConverted = true;\n    }\n\n    delete this.savingLottiePreview[doc.id];\n  };\n  reader.readAsArrayBuffer(blob); */\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\nimport {fastRaf} from '../schedulers';\nimport throttleWith from './throttleWith';\n\nexport default function throttleWithRaf<F extends AnyToVoidFunction>(fn: F) {\n  return throttleWith(fastRaf, fn);\n}\n","// * Jolly Cobra's schedulers\n\nimport {AnyToVoidFunction} from '../../types';\n\nexport default function throttleWith<F extends AnyToVoidFunction>(schedulerFn: AnyToVoidFunction, fn: F) {\n  let waiting = false;\n  let args: Parameters<F>;\n\n  return (..._args: Parameters<F>) => {\n    args = _args;\n\n    if(!waiting) {\n      waiting = true;\n\n      schedulerFn(() => {\n        waiting = false;\n        // @ts-ignore\n        fn(...args);\n      });\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Scrollable from '../components/scrollable';\r\nimport safeAssign from './object/safeAssign';\r\n\r\nexport default class ScrollableLoader {\r\n  public loading = false;\r\n  private scrollable: Scrollable;\r\n  private getPromise: () => Promise<boolean>;\r\n  private promise: Promise<any>;\r\n  private loaded = false;\r\n\r\n  constructor(options: {\r\n    scrollable: ScrollableLoader['scrollable'],\r\n    getPromise: ScrollableLoader['getPromise']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    options.scrollable.onScrolledBottom = () => {\r\n      this.load();\r\n    };\r\n  }\r\n\r\n  public load() {\r\n    if(this.loaded) {\r\n      return Promise.resolve();\r\n    }\r\n\r\n    if(this.loading) {\r\n      return this.promise;\r\n    }\r\n\r\n    this.loading = true;\r\n    this.promise = this.getPromise().then((done) => {\r\n      this.loading = false;\r\n      this.promise = undefined;\r\n\r\n      if(done) {\r\n        this.loaded = true;\r\n        this.scrollable.onScrolledBottom = null;\r\n      } else {\r\n        this.scrollable.checkForTriggers();\r\n      }\r\n    }, () => {\r\n      this.promise = undefined;\r\n      this.loading = false;\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MediaSearchContext} from '../components/appMediaPlaybackController';\nimport type {SearchSuperContext} from '../components/appSearchSuper.';\nimport type {Message} from '../layer';\nimport type {MessagesStorageKey, MyMessage} from '../lib/appManagers/appMessagesManager';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport incrementMessageId from '../lib/appManagers/utils/messageId/incrementMessageId';\nimport rootScope from '../lib/rootScope';\nimport forEachReverse from './array/forEachReverse';\nimport filterChatPhotosMessages from './filterChatPhotosMessages';\nimport ListLoader, {ListLoaderOptions} from './listLoader';\n\nexport default class SearchListLoader<Item extends {mid: number, peerId: PeerId}> extends ListLoader<Item, Message.message> {\n  public searchContext: MediaSearchContext;\n  public onEmptied: () => void;\n\n  private otherSideLoader: SearchListLoader<Item>;\n  private managers: AppManagers;\n\n  constructor(options: Omit<ListLoaderOptions<Item, Message.message>, 'loadMore'> & {\n    onEmptied?: () => void,\n    isInner?: boolean,\n    managers?: AppManagers\n  } = {}) {\n    super({\n      ...options,\n      loadMore: (anchor, older, loadCount) => {\n        const backLimit = older ? 0 : loadCount;\n        let maxId = anchor?.mid;\n\n        if(maxId === undefined) maxId = this.searchContext.maxId;\n        if(!older) maxId = incrementMessageId(maxId, 1);\n\n        return this.managers.appMessagesManager.getSearch({\n          ...this.searchContext,\n          peerId: this.searchContext.peerId || anchor?.peerId,\n          maxId,\n          limit: backLimit ? 0 : loadCount,\n          backLimit\n        }).then((value) => {\n          /* if(DEBUG) {\n            this.log('loaded more media by maxId:', maxId, value, older, this.reverse);\n          } */\n\n          if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n            filterChatPhotosMessages(value);\n          }\n\n          if(value.next_rate) {\n            this.searchContext.nextRate = value.next_rate;\n          }\n\n          return {count: value.count, items: value.history};\n        });\n      },\n      processItem: async(message) => {\n        const filtered = await this.filterMids([message.mid]);\n        if(!filtered.length) {\n          return;\n        }\n\n        return options.processItem(message);\n      }\n    });\n\n    this.managers ??= rootScope.managers;\n    rootScope.addEventListener('history_delete', this.onHistoryDelete);\n    rootScope.addEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.addEventListener('message_sent', this.onMessageSent);\n\n    if(!options.isInner) {\n      this.otherSideLoader = new SearchListLoader({\n        ...options,\n        isInner: true\n      });\n\n      // this.otherSideLoader.onLoadedMore = () => {\n\n      // };\n    }\n  }\n\n  protected async filterMids(mids: number[]) {\n    const storageKey: MessagesStorageKey = `${this.searchContext.peerId}_${this.searchContext.isScheduled ? 'scheduled' : 'history'}`;\n    const filtered = (await this.managers.appMessagesManager.filterMessagesByInputFilterFromStorage(this.searchContext.inputFilter._, mids, storageKey, mids.length)) as Message.message[];\n    return filtered;\n  }\n\n  protected onHistoryDelete = ({peerId, msgs}: {peerId: PeerId, msgs: Set<number>}) => {\n    const shouldBeDeleted = (item: Item) => item.peerId === peerId && msgs.has(item.mid);\n    const filter = (item: Item, idx: number, arr: Item[]) => {\n      if(shouldBeDeleted(item)) {\n        arr.splice(idx, 1);\n      }\n    };\n\n    forEachReverse(this.previous, filter);\n    forEachReverse(this.next, filter);\n\n    if(this.current && shouldBeDeleted(this.current)) {\n      this.current = undefined;\n      /* if(this.go(1)) {\n        this.previous.splice(this.previous.length - 1, 1);\n      } else if(this.go(-1)) {\n        this.next.splice(0, 1);\n      } else  */if(this.onEmptied) {\n        this.onEmptied();\n      }\n    }\n  };\n\n  protected onHistoryMultiappend = async(message: Message.message | Message.messageService) => {\n    if(this.searchContext.folderId !== undefined) {\n      return;\n    }\n\n    // because it's reversed\n    if(!this.loadedAllUp || this.loadPromiseUp) {\n      return;\n    }\n\n    if(message.peerId !== this.searchContext.peerId) {\n      return;\n    }\n\n    const filtered = await this.filterMids([message.mid]);\n    const targets = (await Promise.all(filtered.map((message) => this.processItem(message)))).filter(Boolean);\n    if(targets.length) {\n      /* const {previous, current, next} = this;\n      const targets = previous.concat(current, next);\n      const currentIdx = targets.length;\n      const mid = targets[0].mid;\n      let i = 0, length = targets.length;\n      for(; i < length; ++i) {\n        const target = targets[i];\n        if(!target || mid < target.mid) {\n          break;\n        }\n      }\n\n      if(i < currentIdx) previous.push(...targets);\n      else next. */\n\n      if(!this.current) {\n        this.previous.push(...targets);\n      } else {\n        this.next.push(...targets);\n      }\n    }\n  };\n\n  protected onMessageSent = ({message}: {message: MyMessage}) => {\n    this.onHistoryMultiappend(message);\n  };\n\n  public setSearchContext(context: SearchSuperContext) {\n    this.searchContext = context;\n\n    if(this.searchContext.folderId !== undefined) {\n      this.loadedAllUp = true;\n\n      if(this.searchContext.nextRate === undefined) {\n        this.loadedAllDown = true;\n      }\n    }\n\n    if(this.searchContext.inputFilter._ === 'inputMessagesFilterChatPhotos') {\n      this.loadedAllUp = true;\n    }\n\n    if(this.searchContext.useSearch === false) {\n      this.loadedAllDown = this.loadedAllUp = true;\n    }\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.setSearchContext(context);\n    }\n  }\n\n  public reset() {\n    super.reset();\n    this.searchContext = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.reset();\n    }\n  }\n\n  public getPrevious(withOtherSide?: boolean) {\n    let previous = this.previous;\n\n    if(this.otherSideLoader && withOtherSide) {\n      previous = previous.concat(this.otherSideLoader.previous);\n    }\n\n    return previous;\n  }\n\n  public getNext(withOtherSide?: boolean) {\n    let next = this.next;\n\n    if(this.otherSideLoader && withOtherSide) {\n      next = next.concat(this.otherSideLoader.next);\n    }\n\n    return next;\n  }\n\n  public getCurrent() {\n    return this.current || this.otherSideLoader?.current;\n  }\n\n  private goToOtherEnd(length: number) {\n    if(length > 0) return this.go(-this.previous.length);\n    else return this.go(this.next.length);\n  }\n\n  public goRound(length: number, dispatchJump?: boolean) {\n    let ret: ReturnType<SearchListLoader<Item>['goUnsafe']>;\n\n    if(this.otherSideLoader?.current) {\n      ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n      if(ret.item) {\n        return ret.item;\n      }\n\n      length = ret.leftLength;\n      if(!(length > 0 ? this.otherSideLoader.next : this.otherSideLoader.previous).length) {\n        const loaded = length > 0 ? this.otherSideLoader.loadedAllUp : this.otherSideLoader.loadedAllDown;\n        if(!loaded) { // do not reset anything until it's loaded\n          return;\n        }\n\n        // if other side is loaded too will start from its begin\n        if((length > 0 && (this.otherSideLoader.searchContext.maxId === 1 || this.otherSideLoader.loadedAllDown)) ||\n          (length < 0 && (this.otherSideLoader.searchContext.maxId === 0 || this.otherSideLoader.loadedAllUp))) {\n          return this.otherSideLoader.goToOtherEnd(length);\n        }\n\n        this.otherSideLoader.unsetCurrent(length > 0);\n      }\n    }\n\n    ret = this.goUnsafe(length, dispatchJump);\n    if(!ret.item) {\n      if(this.loadedAllUp && this.loadedAllDown) { // just use the same loader if the list is too short\n        return this.goToOtherEnd(length);\n      } else if(this.otherSideLoader) {\n        length = ret.leftLength;\n        ret = this.otherSideLoader.goUnsafe(length, dispatchJump);\n\n        if(ret.item) {\n          this.unsetCurrent(length > 0);\n        }\n      }\n    }\n\n    return ret?.item;\n  }\n\n  // public setTargets(previous: Item[], next: Item[], reverse: boolean) {\n  //   super.setTargets(previous, next, reverse);\n  // }\n\n  protected setLoaded(down: boolean, value: boolean) {\n    const changed = super.setLoaded(down, value);\n\n    if(changed &&\n      this.otherSideLoader &&\n      value &&\n      this.searchContext?.useSearch !== false/*  &&\n      (this.reverse ? this.loadedAllUp : this.loadedAllDown) */) {\n      const reverse = this.loadedAllUp;\n      this.otherSideLoader.setSearchContext({\n        ...this.searchContext,\n        maxId: reverse ? 1 : 0\n      });\n\n      // these 'reverse' are different, not a mistake here.\n      this.otherSideLoader.reverse = this.reverse;\n      this.otherSideLoader.setLoaded(reverse, true);\n      this.otherSideLoader.load(!reverse);\n    }\n\n    return changed;\n  }\n\n  public cleanup() {\n    this.reset();\n    rootScope.removeEventListener('history_delete', this.onHistoryDelete);\n    rootScope.removeEventListener('history_multiappend', this.onHistoryMultiappend);\n    rootScope.removeEventListener('message_sent', this.onMessageSent);\n    this.onEmptied = undefined;\n\n    if(this.otherSideLoader) {\n      this.otherSideLoader.cleanup();\n      this.otherSideLoader = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport generateMessageId from './generateMessageId';\nimport getServerMessageId from './getServerMessageId';\n\nexport default function incrementMessageId(messageId: number, increment: number) {\n  return generateMessageId(getServerMessageId(messageId) + increment);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {fastRaf} from './schedulers';\r\nimport deferredPromise, {CancellablePromise} from './cancellablePromise';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport isInDOM from './dom/isInDOM';\r\n\r\nclass SequentialDom {\r\n  private promises: Partial<{\r\n    read: CancellablePromise<void>,\r\n    write: CancellablePromise<void>\r\n  }> = {};\r\n  private raf = fastRaf.bind(null);\r\n  private scheduled = false;\r\n\r\n  private do(kind: keyof SequentialDom['promises'], callback?: VoidFunction) {\r\n    let promise = this.promises[kind];\r\n    if(!promise) {\r\n      this.scheduleFlush();\r\n      promise = this.promises[kind] = deferredPromise<void>();\r\n    }\r\n\r\n    if(callback !== undefined) {\r\n      promise.then(() => callback());\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  public measure(callback?: VoidFunction) {\r\n    return this.do('read', callback);\r\n  }\r\n\r\n  public mutate(callback?: VoidFunction) {\r\n    return this.do('write', callback);\r\n  }\r\n\r\n  /**\r\n   * Will fire instantly if element is not connected\r\n   * @param element\r\n   * @param callback\r\n   */\r\n  public mutateElement(element: HTMLElement, callback?: VoidFunction) {\r\n    const isConnected = isInDOM(element);\r\n    const promise = isConnected ? this.mutate() : Promise.resolve();\r\n\r\n    if(callback !== undefined) {\r\n      if(!isConnected) {\r\n        callback();\r\n      } else {\r\n        promise.then(() => callback());\r\n      }\r\n    }\r\n\r\n    return promise;\r\n  }\r\n\r\n  private scheduleFlush() {\r\n    if(!this.scheduled) {\r\n      this.scheduled = true;\r\n\r\n      this.raf(() => {\r\n        this.promises.read && this.promises.read.resolve();\r\n        this.promises.write && this.promises.write.resolve();\r\n\r\n        this.scheduled = false;\r\n        this.promises = {};\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nconst sequentialDom = new SequentialDom();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.sequentialDom = sequentialDom);\r\nexport default sequentialDom;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {PhotoSize, WebDocument} from '../layer';\nimport {REPLIES_HIDDEN_CHANNEL_ID} from '../lib/mtproto/mtproto_config';\nimport {MyDocument} from '../lib/appManagers/appDocsManager';\nimport {MyPhoto} from '../lib/appManagers/appPhotosManager';\nimport choosePhotoSize from '../lib/appManagers/utils/photos/choosePhotoSize';\nimport {MediaSize, makeMediaSize} from './mediaSize';\nimport isWebDocument from '../lib/appManagers/utils/webDocs/isWebDocument';\n\nexport default function setAttachmentSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  element: HTMLElement | SVGForeignObjectElement,\n  boxWidth: number,\n  boxHeight: number,\n  noZoom = true,\n  message?: any,\n  pushDocumentSize?: boolean,\n  photoSize?: ReturnType<typeof choosePhotoSize>\n) {\n  const _isWebDocument = isWebDocument(photo);\n  // if(_isWebDocument && pushDocumentSize === undefined) {\n  //   pushDocumentSize = true;\n  // }\n\n  if(!photoSize) {\n    photoSize = choosePhotoSize(photo, boxWidth, boxHeight, undefined, pushDocumentSize);\n  }\n  // console.log('setAttachmentSize', photo, photo.sizes[0].bytes, div);\n\n  let size: MediaSize;\n  const isDocument = photo._ === 'document';\n  if(isDocument || _isWebDocument) {\n    size = makeMediaSize(photo.w || (photoSize as PhotoSize.photoSize).w || 512, photo.h || (photoSize as PhotoSize.photoSize).h || 512);\n  } else {\n    size = makeMediaSize((photoSize as PhotoSize.photoSize).w || 100, (photoSize as PhotoSize.photoSize).h || 100);\n  }\n\n  let boxSize = makeMediaSize(boxWidth, boxHeight);\n\n  boxSize = size = size.aspect(boxSize, noZoom);\n\n  let isFit = true;\n\n  if(!isDocument || ['video', 'gif'].includes(photo.type) || _isWebDocument) {\n    if(boxSize.width < 200 && boxSize.height < 200) { // make at least one side this big\n      boxSize = size = size.aspectCovered(makeMediaSize(200, 200));\n    }\n\n    if(message &&\n      (message.message ||\n        message.reply_to_mid ||\n        message.media.webpage ||\n        (message.replies && message.replies.pFlags.comments && message.replies.channel_id.toChatId() !== REPLIES_HIDDEN_CHANNEL_ID)\n      )\n    ) { // make sure that bubble block is human-readable\n      if(boxSize.width < 320) {\n        boxSize = makeMediaSize(320, boxSize.height);\n        isFit = false;\n      }\n    }\n\n    if(isFit && boxSize.width < 120 && message) { // if image is too narrow\n      boxSize = makeMediaSize(120, boxSize.height);\n      isFit = false;\n    }\n  }\n\n  // if(element instanceof SVGForeignObjectElement) {\n  //   element.setAttributeNS(null, 'width', '' + w);\n  //   element.setAttributeNS(null, 'height', '' + h);\n\n  //   //console.log('set dimensions to svg element:', element, w, h);\n  // } else {\n  element.style.width = boxSize.width + 'px';\n  element.style.height = boxSize.height + 'px';\n  // }\n\n  return {photoSize, size, isFit};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport insertInDescendSortedArray from './array/insertInDescendSortedArray';\nimport {getMiddleware} from './middleware';\nimport safeAssign from './object/safeAssign';\n\nexport type SortedElementId = PeerId;\nexport type SortedElementBase = {\n  id: SortedElementId,\n  index: number\n};\n\nexport default class SortedList<SortedElement extends SortedElementBase> {\n  protected elements: Map<SortedElementId, SortedElement>;\n  protected sorted: Array<SortedElement>;\n\n  protected getIndex: (element: SortedElement) => PromiseLike<number> | number;\n  protected onDelete: (element: SortedElement) => void;\n  protected onUpdate: (element: SortedElement) => void;\n  protected onSort: (element: SortedElement, idx: number) => void;\n  protected onElementCreate: (base: SortedElementBase, batch: boolean) => SortedElement;\n\n  protected updateElementWith = (callback: () => void) => callback();\n  protected updateListWith = (callback: (canUpdate: boolean | undefined) => void) => callback(true);\n\n  protected middleware = getMiddleware();\n\n  constructor(options: {\n    getIndex: SortedList<SortedElement>['getIndex'],\n    onDelete?: SortedList<SortedElement>['onDelete'],\n    onUpdate?: SortedList<SortedElement>['onUpdate'],\n    onSort?: SortedList<SortedElement>['onSort'],\n    onElementCreate: SortedList<SortedElement>['onElementCreate'],\n\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateListWith?: SortedList<SortedElement>['updateListWith']\n  }) {\n    safeAssign(this, options);\n\n    this.elements = new Map();\n    this.sorted = [];\n  }\n\n  public clear() {\n    this.middleware.clean();\n    this.elements.clear();\n    this.sorted.length = 0;\n  }\n\n  protected _updateList() {\n    this.elements.forEach((element) => {\n      this.update(element.id, true);\n    });\n\n    if(this.onSort) {\n      this.sorted.forEach((element, idx) => {\n        this.onSort(element, idx);\n      });\n    }\n  }\n\n  public updateList(callback: (updated: boolean) => void) {\n    const middleware = this.middleware.get();\n    this.updateListWith((canUpdate) => {\n      if(!middleware() || (canUpdate !== undefined && !canUpdate)) {\n        return callback(false);\n      }\n\n      this._updateList();\n\n      callback(true);\n    });\n  }\n\n  public has(id: SortedElementId) {\n    return this.elements.has(id);\n  }\n\n  public get(id: SortedElementId) {\n    return this.elements.get(id);\n  }\n\n  public getAll() {\n    return this.elements;\n  }\n\n  public add(\n    id: SortedElementId,\n    batch = false,\n    updateElementWith?: SortedList<SortedElement>['updateElementWith'],\n    updateBatch = batch\n  ) {\n    let element = this.get(id);\n    if(element) {\n      return element;\n    }\n\n    const base: SortedElementBase = {\n      id,\n      index: 0\n    };\n\n    element = this.onElementCreate(base, batch);\n    this.elements.set(id, element);\n    this.update(id, updateBatch, element, updateElementWith);\n\n    return element;\n  }\n\n  public delete(id: SortedElementId, noScheduler?: boolean) {\n    const element = this.elements.get(id);\n    if(!element) {\n      return false;\n    }\n\n    this.elements.delete(id);\n\n    const idx = this.sorted.indexOf(element);\n    if(idx !== -1) {\n      this.sorted.splice(idx, 1);\n    }\n\n    if(this.onDelete) {\n      if(noScheduler) {\n        this.onDelete(element);\n      } else {\n        const middleware = this.middleware.get();\n        this.updateElementWith(() => {\n          if(!middleware()) {\n            return;\n          }\n\n          this.onDelete(element);\n        });\n      }\n    }\n\n    return true;\n  }\n\n  public async update(\n    id: SortedElementId,\n    batch = false,\n    element = this.get(id),\n    updateElementWith?: SortedList<SortedElement>['updateElementWith']\n  ) {\n    if(!element) {\n      return;\n    }\n\n    element.index = await this.getIndex(element);\n    this.onUpdate && this.onUpdate(element);\n\n    const idx = insertInDescendSortedArray(this.sorted, element, 'index');\n    if(!batch && this.onSort) {\n      const middleware = this.middleware.get();\n      (updateElementWith || this.updateElementWith)(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        // *             .    \n        this.onSort(element, idx);\n        /* if(this.get(id) === element) {\n          this.onSort(element, this.sorted.indexOf(element));\n        } */\n      });\n    }\n  }\n}\n","export default function encodeEntities(value: string) {\n  return value.replace(/&/g, '&amp;').replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, (value) => {\n    const hi = value.charCodeAt(0);\n    const low = value.charCodeAt(1);\n    return '&#' + (((hi - 0xD800) * 0x400) + (low - 0xDC00) + 0x10000) + ';';\n  }).replace(/([^\\#-~| |!])/g, (value) => { // non-alphanumeric\n    return '&#' + value.charCodeAt(0) + ';';\n  }).replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n","// credits to https://github.com/sindresorhus/escape-string-regexp/blob/master/index.js\nexport default function escapeRegExp(str: string) {\n  return str\n  .replace(/[|\\\\{}()[\\]^$+*?.]/g, '\\\\$&')\n  .replace(/-/g, '\\\\x2d');\n}\n","export default function limitSymbols(str: string, length: number, limitFrom = length + 10) {\n  str = str.trim();\n  if(str.length > limitFrom) {\n    str = str.slice(0, length)/* .replace(/\\s*$/, '') */ + '...';\n  }\n\n  return str;\n}\n","export default function toHHMMSS(str: string | number, leadZero = false) {\n  const sec_num = parseInt(str + '', 10);\n  const hours = Math.floor(sec_num / 3600);\n  let minutes: any = Math.floor((sec_num - (hours * 3600)) / 60);\n  let seconds: any = sec_num - (hours * 3600) - (minutes * 60);\n\n  if(hours) leadZero = true;\n  if(minutes < 10) minutes = leadZero ? '0' + minutes : minutes;\n  if(seconds < 10) seconds = '0' + seconds;\n  return (hours ? /* ('0' + hours).slice(-2) */hours + ':' : '') + minutes + ':' + seconds;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {IS_WORKER} from './context';\n\nexport class WindowSize {\n  public width: number;\n  public height: number;\n\n  constructor() {\n    if(IS_WORKER) {\n      return;\n    }\n\n    // @ts-ignore\n    const w: any = 'visualViewport' in window ? window.visualViewport : window;\n    const set = () => {\n      this.width = w.width || w.innerWidth;\n      this.height = w.height || w.innerHeight;\n    };\n    w.addEventListener('resize', set);\n    set();\n  }\n}\n\nconst windowSize = new WindowSize();\nexport default windowSize;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\n// * Jolly Cobra's useHeavyAnimationCheck.ts, patched\r\n\r\nimport {AnyToVoidFunction} from '../types';\r\nimport ListenerSetter from '../helpers/listenerSetter';\r\nimport deferredPromise, {CancellablePromise} from '../helpers/cancellablePromise';\r\nimport DEBUG from '../config/debug';\r\nimport pause from '../helpers/schedulers/pause';\r\nimport EventListenerBase from '../helpers/eventListenerBase';\r\n\r\nconst eventListener = new EventListenerBase<{\r\n  start: () => void,\r\n  end: () => void\r\n}>();\r\nconst ANIMATION_START_EVENT = 'start';\r\nconst ANIMATION_END_EVENT = 'end';\r\n\r\nlet isAnimating = false;\r\nlet heavyAnimationPromise: CancellablePromise<void> = deferredPromise<void>();\r\nlet promisesInQueue = 0;\r\n\r\nheavyAnimationPromise.resolve();\r\n\r\nconst log = console.log.bind(console.log, '[HEAVY-ANIMATION]:');\r\n\r\nexport function dispatchHeavyAnimationEvent(promise: Promise<any>, timeout?: number) {\r\n  if(!isAnimating) {\r\n    heavyAnimationPromise = deferredPromise<void>();\r\n    eventListener.dispatchEvent(ANIMATION_START_EVENT);\r\n    isAnimating = true;\r\n    DEBUG && log('start');\r\n  }\r\n\r\n  ++promisesInQueue;\r\n  DEBUG && log('attach promise, length:', promisesInQueue, timeout);\r\n\r\n  const promises = [\r\n    timeout !== undefined ? pause(timeout) : undefined,\r\n    promise.finally(() => {})\r\n  ].filter(Boolean);\r\n\r\n  const perf = performance.now();\r\n  const _heavyAnimationPromise = heavyAnimationPromise;\r\n  Promise.race(promises).then(() => {\r\n    if(heavyAnimationPromise !== _heavyAnimationPromise || heavyAnimationPromise.isFulfilled) { // interrupted\r\n      return;\r\n    }\r\n\r\n    --promisesInQueue;\r\n    DEBUG && log('promise end, length:', promisesInQueue, performance.now() - perf);\r\n    if(promisesInQueue <= 0) {\r\n      onHeavyAnimationEnd();\r\n    }\r\n  });\r\n\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nfunction onHeavyAnimationEnd() {\r\n  if(heavyAnimationPromise.isFulfilled) {\r\n    return;\r\n  }\r\n\r\n  isAnimating = false;\r\n  promisesInQueue = 0;\r\n  eventListener.dispatchEvent(ANIMATION_END_EVENT);\r\n  heavyAnimationPromise.resolve();\r\n\r\n  DEBUG && log('end');\r\n}\r\n\r\nexport function interruptHeavyAnimation() {\r\n  onHeavyAnimationEnd();\r\n}\r\n\r\nexport function getHeavyAnimationPromise() {\r\n  return heavyAnimationPromise;\r\n}\r\n\r\nexport default function(\r\n  handleAnimationStart: AnyToVoidFunction,\r\n  handleAnimationEnd: AnyToVoidFunction,\r\n  listenerSetter?: ListenerSetter\r\n) {\r\n  // useEffect(() => {\r\n  if(isAnimating) {\r\n    handleAnimationStart();\r\n  }\r\n\r\n  const add = listenerSetter ? listenerSetter.add(eventListener) : eventListener.addEventListener.bind(eventListener);\r\n  const remove = listenerSetter ? listenerSetter.removeManual.bind(listenerSetter, eventListener) : eventListener.removeEventListener.bind(eventListener);\r\n  add(ANIMATION_START_EVENT, handleAnimationStart);\r\n  add(ANIMATION_END_EVENT, handleAnimationEnd);\r\n\r\n  return () => {\r\n    remove(ANIMATION_END_EVENT, handleAnimationEnd);\r\n    remove(ANIMATION_START_EVENT, handleAnimationStart);\r\n  };\r\n  // }, [handleAnimationEnd, handleAnimationStart]);\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDialogsManager, {DIALOG_LIST_ELEMENT_TAG} from '../lib/appManagers/appDialogsManager';\nimport type {Dialog} from '../lib/appManagers/appMessagesManager';\nimport rootScope from '../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from './buttonMenu';\nimport PopupDeleteDialog from './popups/deleteDialog';\nimport {i18n} from '../lib/langPack';\nimport findUpTag from '../helpers/dom/findUpTag';\nimport PopupPeer from './popups/peer';\nimport AppChatFoldersTab from './sidebarLeft/tabs/chatFolders';\nimport appSidebarLeft from './sidebarLeft';\nimport {toastNew} from './toast';\nimport PopupMute from './popups/mute';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport positionMenu from '../helpers/positionMenu';\nimport contextMenuController from '../helpers/contextMenuController';\n\nexport default class DialogsContextMenu {\n  private element: HTMLElement;\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>})[];\n\n  private selectedId: PeerId;\n  private filterId: number;\n  private dialog: Dialog;\n\n  constructor(private managers: AppManagers) {\n\n  }\n\n  private init() {\n    this.buttons = [{\n      icon: 'unread',\n      text: 'MarkAsUnread',\n      onClick: this.onUnreadClick,\n      verify: async() => !(await this.managers.appMessagesManager.isDialogUnread(this.dialog))\n    }, {\n      icon: 'readchats',\n      text: 'MarkAsRead',\n      onClick: this.onUnreadClick,\n      verify: () => this.managers.appMessagesManager.isDialogUnread(this.dialog)\n    }, {\n      icon: 'pin',\n      text: 'ChatList.Context.Pin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return !isPinned;\n      }\n    }, {\n      icon: 'unpin',\n      text: 'ChatList.Context.Unpin',\n      onClick: this.onPinClick,\n      verify: async() => {\n        const isPinned = this.filterId > 1 ?\n          (await this.managers.appMessagesManager.getFilter(this.filterId)).pinnedPeerIds.includes(this.dialog.peerId) :\n          !!this.dialog.pFlags?.pinned;\n        return isPinned;\n      }\n    }, {\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: this.onUnmuteClick,\n      verify: async() => {\n        return this.selectedId !== rootScope.myId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.dialog.peerId));\n      }\n    }, {\n      icon: 'archive',\n      text: 'Archive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 0 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'unarchive',\n      text: 'Unarchive',\n      onClick: this.onArchiveClick,\n      verify: () => this.filterId === 1 && this.selectedId !== rootScope.myId\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: this.onDeleteClick,\n      verify: () => true\n    }];\n\n    this.element = ButtonMenu(this.buttons);\n    this.element.id = 'dialogs-contextmenu';\n    this.element.classList.add('contextmenu');\n    document.getElementById('page-chats').append(this.element);\n  }\n\n  private onArchiveClick = async() => {\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n    if(dialog) {\n      this.managers.appMessagesManager.editPeerFolders([dialog.peerId], +!dialog.folder_id);\n    }\n  };\n\n  private onPinClick = () => {\n    this.managers.appMessagesManager.toggleDialogPin(this.selectedId, this.filterId).catch(async(err: ApiError) => {\n      if(err.type === 'PINNED_DIALOGS_TOO_MUCH') {\n        if(this.filterId >= 1) {\n          toastNew({langPackKey: 'PinFolderLimitReached'});\n        } else {\n          const config = await this.managers.apiManager.getConfig();\n          new PopupPeer('pinned-dialogs-too-much', {\n            buttons: [{\n              langKey: 'OK',\n              isCancel: true\n            }, {\n              langKey: 'FiltersSetupPinAlert',\n              callback: () => {\n                appSidebarLeft.createTab(AppChatFoldersTab).open();\n              }\n            }],\n            descriptionLangKey: 'PinToTopLimitReached2',\n            descriptionLangArgs: [i18n('Chats', [config.pinned_dialogs_count_max])]\n          }).show();\n        }\n      }\n    });\n  };\n\n  private onUnmuteClick = () => {\n    this.managers.appMessagesManager.togglePeerMute(this.selectedId, false);\n  };\n\n  private onMuteClick = () => {\n    new PopupMute(this.selectedId);\n  };\n\n  private onUnreadClick = async() => {\n    const selectedId = this.selectedId;\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(selectedId);\n    if(!dialog) return;\n\n    if(dialog.unread_count) {\n      this.managers.appMessagesManager.readHistory(selectedId, dialog.top_message);\n      this.managers.appMessagesManager.markDialogUnread(selectedId, true);\n    } else {\n      this.managers.appMessagesManager.markDialogUnread(selectedId);\n    }\n  };\n\n  private onDeleteClick = () => {\n    new PopupDeleteDialog(this.selectedId/* , 'delete' */);\n  };\n\n  onContextMenu = (e: MouseEvent | Touch) => {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    let li: HTMLElement = null;\n\n    try {\n      li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n    } catch(e) {}\n\n    if(!li) return;\n\n    if(e instanceof MouseEvent) e.preventDefault();\n    if(this.element.classList.contains('active')) {\n      return false;\n    }\n    if(e instanceof MouseEvent) e.cancelBubble = true;\n\n    const r = async() => {\n      this.filterId = appDialogsManager.filterId;\n      this.selectedId = li.dataset.peerId.toPeerId();\n      this.dialog = await this.managers.appMessagesManager.getDialogOnly(this.selectedId);\n\n      await Promise.all(this.buttons.map(async(button) => {\n        const good = await button.verify();\n\n        button.element.classList.toggle('hide', !good);\n      }));\n\n      // delete button\n      this.buttons[this.buttons.length - 1].element.lastChild.replaceWith(i18n(await this.managers.appPeersManager.getDeleteButtonText(this.selectedId)));\n\n      li.classList.add('menu-open');\n      positionMenu(e, this.element);\n      contextMenuController.openBtnMenu(this.element, () => {\n        li.classList.remove('menu-open');\n        this.selectedId = this.dialog = this.filterId = undefined;\n      });\n    };\n\n    r();\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport App from '../config/app';\r\nimport DEBUG from '../config/debug';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport {LangPackKey, i18n} from '../lib/langPack';\r\nimport {logger} from '../lib/logger';\r\nimport rootScope from '../lib/rootScope';\r\nimport Button from './button';\r\nimport ProgressivePreloader from './preloader';\r\nimport SetTransition from './singleTransition';\r\nimport sessionStorage from '../lib/sessionStorage';\r\nimport {ConnectionStatus} from '../lib/mtproto/connectionStatus';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport singleInstance from '../lib/mtproto/singleInstance';\r\n\r\nexport default class ConnectionStatusComponent {\r\n  public static CHANGE_STATE_DELAY = 1000;\r\n\r\n  private statusContainer: HTMLElement;\r\n  private statusEl: HTMLElement;\r\n  private statusPreloader: ProgressivePreloader;\r\n\r\n  private currentLangPackKey: LangPackKey;\r\n\r\n  private hadConnect = false;\r\n  private retryAt: number;\r\n  private connecting = false;\r\n  private timedOut = false;\r\n  private updating = false;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  private setFirstConnectionTimeout: number;\r\n  private setStateTimeout: number;\r\n\r\n  constructor(private managers: AppManagers, chatsContainer: HTMLElement) {\r\n    this.log = logger('CS', undefined, undefined);\r\n\r\n    this.statusContainer = document.createElement('div');\r\n    this.statusContainer.classList.add('connection-status'/* , 'hide' */);\r\n\r\n    this.statusEl = Button('btn-primary bg-warning connection-status-button', {noRipple: true});\r\n    this.statusPreloader = new ProgressivePreloader({cancelable: false});\r\n    this.statusPreloader.constructContainer({color: 'transparent', bold: true});\r\n    this.statusContainer.append(this.statusEl);\r\n\r\n    chatsContainer.prepend(this.statusContainer);\r\n\r\n    rootScope.addEventListener('connection_status_change', (status) => {\r\n      // console.log(status);\r\n\r\n      this.setConnectionStatus();\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronizing', (channelId) => {\r\n      if(!channelId) {\r\n        this.updating = true;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('state_synchronized', (channelId) => {\r\n      DEBUG && this.log('state_synchronized', channelId);\r\n      if(!channelId) {\r\n        this.updating = false;\r\n        DEBUG && this.log('updating', this.updating);\r\n        this.setState();\r\n      }\r\n    });\r\n\r\n    this.setFirstConnectionTimeout = window.setTimeout(this.setConnectionStatus, ConnectionStatusComponent.CHANGE_STATE_DELAY + 1e3);\r\n\r\n    /* let bool = true;\r\n    document.addEventListener('dblclick', () => {\r\n      const dcId = 2;\r\n      rootScope.dispatchEvent('connection_status_change', {\r\n        dcId: dcId,\r\n        isFileDownload: false,\r\n        isFileNetworker: false,\r\n        isFileUpload: false,\r\n        name: \"NET-\" + dcId,\r\n        status: bool ? (bool = false, ConnectionStatus.Closed) : (bool = true, ConnectionStatus.Connected),\r\n        _: \"networkerStatus\"\r\n      });\r\n    }); */\r\n  }\r\n\r\n  private setConnectionStatus = () => {\r\n    Promise.all([\r\n      sessionStorage.get('dc'),\r\n      rootScope.managers.rootScope.getConnectionStatus()\r\n    ]).then(([baseDcId, connectionStatus]) => {\r\n      if(!baseDcId) {\r\n        baseDcId = App.baseDcId;\r\n      }\r\n\r\n      if(this.setFirstConnectionTimeout) {\r\n        clearTimeout(this.setFirstConnectionTimeout);\r\n        this.setFirstConnectionTimeout = 0;\r\n      }\r\n\r\n      const status = connectionStatus['NET-' + baseDcId];\r\n      const online = status && status.status === ConnectionStatus.Connected;\r\n\r\n      if(this.connecting && online) {\r\n        this.managers.apiUpdatesManager.forceGetDifference();\r\n      }\r\n\r\n      if(online && !this.hadConnect) {\r\n        this.hadConnect = true;\r\n      }\r\n\r\n      this.timedOut = status && status.status === ConnectionStatus.TimedOut;\r\n      this.connecting = !online;\r\n      this.retryAt = status && status.retryAt;\r\n      DEBUG && this.log('connecting', this.connecting);\r\n      this.setState();\r\n    });\r\n  };\r\n\r\n  private setStatusText = (langPackKey: LangPackKey, args?: any[]) => {\r\n    if(this.currentLangPackKey === langPackKey) return;\r\n    this.currentLangPackKey = langPackKey;\r\n    replaceContent(this.statusEl, i18n(langPackKey, args));\r\n    this.statusPreloader.attach(this.statusEl);\r\n  };\r\n\r\n  private getA(langPackKey: LangPackKey, callback: () => void) {\r\n    const a = document.createElement('a');\r\n    a.classList.add('force-reconnect');\r\n    a.append(i18n(langPackKey));\r\n    attachClickEvent(a, (e) => {\r\n      cancelEvent(e);\r\n      callback();\r\n    });\r\n\r\n    return a;\r\n  }\r\n\r\n  private setState = () => {\r\n    if(singleInstance.deactivatedReason) {\r\n      return;\r\n    }\r\n\r\n    const timeout = ConnectionStatusComponent.CHANGE_STATE_DELAY;\r\n    if(this.connecting) {\r\n      if(this.timedOut) {\r\n        const a = this.getA('ConnectionStatus.ForceReconnect', () => this.managers.networkerFactory.forceReconnect());\r\n        this.setStatusText('ConnectionStatus.TimedOut', [a]);\r\n      } else if(this.hadConnect) {\r\n        if(this.retryAt !== undefined) {\r\n          const timerSpan = document.createElement('span');\r\n          const retryAt = this.retryAt;\r\n          const setTime = () => {\r\n            const now = Date.now();\r\n            timerSpan.innerText = '' + Math.round((retryAt - now) / 1000);\r\n            if(now > retryAt) {\r\n              clearInterval(interval);\r\n            }\r\n          };\r\n          const interval = setInterval(setTime, 1e3);\r\n          setTime();\r\n\r\n          const a = this.getA('ConnectionStatus.Reconnect', () => this.managers.networkerFactory.forceReconnectTimeout());\r\n          this.setStatusText('ConnectionStatus.ReconnectIn', [timerSpan, a]);\r\n        } else {\r\n          this.setStatusText('ConnectionStatus.Reconnecting');\r\n        }\r\n      } else {\r\n        this.setStatusText('ConnectionStatus.Waiting');\r\n      }\r\n    } else if(this.updating) {\r\n      this.setStatusText('Updating');\r\n    }\r\n\r\n    DEBUG && this.log('setState', this.connecting || this.updating);\r\n    window.requestAnimationFrame(() => {\r\n      if(this.setStateTimeout) clearTimeout(this.setStateTimeout);\r\n\r\n      const cb = () => {\r\n        SetTransition(this.statusContainer, 'is-shown', this.connecting || this.updating, 200);\r\n        this.setStateTimeout = 0;\r\n        DEBUG && this.log('setState: isShown:', this.connecting || this.updating);\r\n      };\r\n\r\n      this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      // cb();\r\n      /* if(timeout) this.setStateTimeout = window.setTimeout(cb, timeout);\r\n      else cb(); */\r\n    });\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Message} from '../layer';\n/* import findUpClassName from \"../helpers/dom/findUpClassName\";\nimport rootScope from \"../lib/rootScope\";\nimport Transition from \"./transition\"; */\n\nexport enum SENDING_STATUS {\n  Error = -1,\n  Pending,\n  Sent,\n  Read\n}\n\nexport function getSendingStatus(message: Message.message | Message.messageService) {\n  return message.pFlags.is_outgoing ?\n    SENDING_STATUS.Pending : (\n      message.pFlags.unread ?\n      SENDING_STATUS.Sent :\n      SENDING_STATUS.Read\n    );\n}\n\nexport function setSendingStatus(\n  container: HTMLElement,\n  message?: Message.message | Message.messageService,\n  disableAnimationIfRippleFound?: boolean\n) {\n  let className: 'check' | 'checks' | 'sending' | 'sendingerror';\n  if(message?.pFlags.out) {\n    if(message.error) {\n      className = 'sendingerror';\n    } else if(message.pFlags.is_outgoing) {\n      className = 'sending';\n    } else if(message.pFlags.unread) {\n      className = 'check';\n    } else {\n      className = 'checks';\n    }\n  }\n\n  if(!className) {\n    container.textContent = '';\n    return;\n  }\n\n  const iconClassName = 'tgico-' + className;\n  const lastElement = container.lastElementChild as HTMLElement;\n  if(lastElement && lastElement.classList.contains(iconClassName)) {\n    return;\n  }\n\n  const element = document.createElement('i');\n  element.classList.add('sending-status-icon', /* 'transition-item', */ iconClassName);\n  container.append(element);\n\n  if(lastElement) {\n    lastElement.remove();\n  }\n\n  /* if(!lastElement) {\n    element.classList.add('active');\n    return;\n  }\n\n  const select = Transition(container, undefined, 350, () => {\n    lastElement.remove();\n  }, false, true, false);\n\n  let animate = rootScope.settings.animationsEnabled && className !== 'sending' && !lastElement.classList.contains('tgico-sending');\n  if(disableAnimationIfRippleFound && animate) {\n    const parent = findUpClassName(container, 'rp');\n    if(parent.querySelector('.c-ripple__circle') || parent.matches(':hover')) {\n      animate = false;\n    }\n  }\n\n  select(element, animate, lastElement); */\n\n  /* SetTransition(lastElement, 'is-visible', false, 350, () => {\n    // lastElement.remove();\n  }, 2);\n  SetTransition(element, 'is-visible', true, 350, undefined, 2); */\n}\n","// https://spicyyoghurt.com/tools/easing-functions\nexport default function easeInOutSine(t: number, b: number, c: number, d: number) {\n  return t >= d ? b + c : easeInOutSineApply(t / d, c) + b;\n}\n\nexport function easeInOutSineApply(v: number, c: number) {\n  return -c / 2 * (Math.cos(Math.PI * v) - 1);\n}\n","export default function roundRect(\n  ctx: CanvasRenderingContext2D,\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n  radius: {[k in 'tl' | 'tr' | 'br' | 'bl']?: number} | number,\n  fill?: boolean,\n  stroke?: boolean\n) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    width *= dpr;\n    height *= dpr;\n  }\n\n  if(typeof(radius) === 'number') {\n    if(dpr) radius *= dpr;\n    radius = {tl: radius, tr: radius, br: radius, bl: radius};\n  } else {\n    const defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};\n    for(const side in defaultRadius) {\n      // @ts-ignore\n      radius[side] = radius[side] ? (dpr ? radius[side] * dpr : radius[side]) : defaultRadius[side];\n    }\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius.tl, y);\n  ctx.lineTo(x + width - radius.tr, y);\n  ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);\n  ctx.lineTo(x + width, y + height - radius.br);\n  ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);\n  ctx.lineTo(x + radius.bl, y + height);\n  ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);\n  ctx.lineTo(x, y + radius.tl);\n  ctx.quadraticCurveTo(x, y, x + radius.tl, y);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../helpers/animation';\nimport customProperties from '../helpers/dom/customProperties';\nimport easeInOutSine from '../helpers/easing/easeInOutSine';\nimport mediaSizes from '../helpers/mediaSizes';\nimport roundRect from '../helpers/canvas/roundRect';\n\nconst DPR = window.devicePixelRatio;\nconst SIZE = 20 * DPR;\nconst MARGIN = 2.5 * DPR;\nconst WIDTH = 2 * DPR;\nconst RADIUS = 1 * DPR;\nconst LENGTH = 3;\n\nconst MIN_HEIGHT = 4;\nconst MAX_HEIGHT = 12;\nconst DURATION = 1000;\n\nexport default function groupCallActiveIcon(isActive = false) {\n  const canvas = document.createElement('canvas');\n  canvas.width = canvas.height = SIZE;\n  const context = canvas.getContext('2d');\n\n  const TOTAL_WIDTH = LENGTH * WIDTH + (LENGTH - 1) * MARGIN;\n  const START_X = (SIZE - TOTAL_WIDTH) / 2;\n\n  const startTime = Date.now();\n  let wasMounted = false;\n  // let hadRound = false;\n  const renderFrame = () => {\n    if(!canvas.isConnected) {\n      if(wasMounted) {\n        return false;\n      }\n    } else if(!wasMounted) {\n      wasMounted = canvas.isConnected;\n    }\n\n    const time = Date.now();\n    // if(((time - startTime) / DURATION) >= 1) {\n    //   hadRound = true;\n    // }\n\n    const progress = easeInOutSine((time - startTime) % DURATION, 0, 1, DURATION);\n\n    context.clearRect(0, 0, SIZE, SIZE);\n    context.fillStyle = isActive && !mediaSizes.isMobile ? customProperties.getProperty('primary-color') : '#fff';\n\n    for(let i = 0; i < LENGTH; ++i) {\n      const x = START_X + (i * WIDTH) + (i * MARGIN);\n\n      let itemProgress: number;\n      if(progress >= .5) {\n        itemProgress = i % 2 ? 2 - progress * 2 : (progress - .5) * 2;\n      } else {\n        itemProgress = i % 2 ? progress * 2 : 1 - progress * 2;\n      }\n\n      let height = MIN_HEIGHT + (itemProgress * (MAX_HEIGHT - MIN_HEIGHT));\n      /* if(!hadRound && i === 1) {\n        console.log('call status animation', itemProgress, height, progress, progress >= .5);\n      } */\n\n      height *= DPR;\n      const y = (SIZE - height) / 2;\n\n      roundRect(context, x, y, WIDTH, height, RADIUS, true);\n    }\n\n    return true;\n  };\n\n  return {\n    canvas,\n    startAnimation: () => {\n      animate(renderFrame);\n      renderFrame();\n    },\n    setActive: (active: boolean) => {\n      isActive = active;\n      renderFrame();\n    }\n  };\n}\n","import customProperties from '../dom/customProperties';\nimport clamp from '../number/clamp';\n\nexport default class Shimmer {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private font = '30pt Helvetica';\n  private currTime = Date.now();\n  private diffTime = 0;\n  private spread = 0;\n  private paused = false;\n  private pausedTime = 0;\n  private pauseInterval = 850;\n  private lightSource = 0;\n  private inc = 0.032;\n  private lightSpread = 0.55;\n  private animations = ['slide', 'slide', 'slide', 'slide'];\n  private currentAnimationIndex = 0;\n  private text: string;\n  private fillStyle: CanvasRenderingContext2D['fillStyle'];\n\n  private keepTime() {\n    this.diffTime = Date.now() - this.currTime;\n    this.currTime = Date.now();\n  }\n\n  private cycleAnimation() {\n    ++this.currentAnimationIndex;\n    if(this.currentAnimationIndex >= this.animations.length) {\n      this.currentAnimationIndex = 0;\n    }\n  }\n\n  private animate() {\n    const currentAnimation = this.animations[this.currentAnimationIndex];\n    if(currentAnimation === 'glow') {\n      return this.animateGlow(); // return glow style\n    } else if(currentAnimation === 'slide') {\n      return this.animateSlide(); // return slide gradient\n    } else {\n      console.log('unknown animation type: ' + String(currentAnimation));\n    }\n  }\n\n  private animateGlow() {\n    var glowEnd = 255,\n      rgbStart = 68,\n      r = rgbStart,\n      g = r,\n      b = r,\n      increment = 10,\n      interval = 800;\n\n    return () => {\n      var smartInc = increment * (this.diffTime / (1000 / 60));\n      if(this.paused) {\n        if((Date.now() - this.pausedTime) > interval) {\n          r = rgbStart;\n          this.cycleAnimation()\n          this.paused = false;\n        }\n      } else {\n        r = parseInt('' + (r + smartInc));\n        if(r >= glowEnd) {\n          this.paused = true;\n          this.pausedTime = Date.now()\n        }\n      }\n      return 'rgb('+ r + ',' + r + ',' + r + ')';\n    };\n  }\n\n  private animateSlide(): CanvasGradient {\n    var gradient = this.ctx.createLinearGradient(0, 0, this.canvas.width, 0),\n      smartInc = this.inc * (this.diffTime / (1000 / 60)),\n      lightLeft,\n      lightRight,\n      lightCenter;\n    if(this.paused) {\n      if((Date.now() - this.pausedTime) > this.pauseInterval) {\n        this.lightSource = -0.6;\n        this.cycleAnimation()\n        this.paused = false;\n        return this.animateSlide();\n      }\n    } else {\n      this.lightSource += smartInc;\n      if(this.lightSource > (1 + this.lightSpread)) {\n        this.paused = true;\n        this.pausedTime = Date.now();\n      }\n    }\n    // lighting positions:\n    lightCenter = clamp(this.lightSource, 0, 1);\n    lightLeft = clamp(this.lightSource - this.lightSpread, 0, 1);\n    lightRight = clamp(this.lightSource + this.lightSpread, 0, 1);\n\n    const backgroundColor = customProperties.getProperty('background-color-true');\n    const shimmerColor = customProperties.getProperty('surface-color');\n    gradient.addColorStop(lightLeft, backgroundColor);\n    gradient.addColorStop(lightCenter, shimmerColor);\n    gradient.addColorStop(lightRight, backgroundColor);\n\n    return gradient;\n  }\n\n  public settings(dict: Partial<{\n    canvas: Shimmer['canvas'],\n    fillStyle: Shimmer['fillStyle'],\n    font: Shimmer['font'],\n    lightSpread: Shimmer['lightSpread'],\n    inc: Shimmer['inc'],\n    animations: Shimmer['animations'],\n    text: Shimmer['text']\n  }> = {}) {\n    this.canvas = dict.canvas ?? document.createElement('canvas');\n    this.ctx = this.canvas.getContext('2d');\n    this.font = dict.font ?? this.font;\n    this.lightSpread = dict.lightSpread ?? this.lightSpread;\n    this.inc = dict.inc ?? this.inc;\n    this.animations = dict.animations ?? this.animations;\n    this.text = dict.text ?? this.text;\n    this.fillStyle = dict.fillStyle;\n\n    this.canvas.classList.add('shimmer-canvas');\n  }\n\n  public on() {\n    const {width, height} = this.canvas;\n    // record the time we ran:\n    this.keepTime();\n    // clear and fill the canvas:\n    this.ctx.clearRect(0, 0, width, height);\n\n    if(this.font) {\n      this.ctx.font = this.font;\n    }\n\n    this.ctx.fillStyle = this.animate() as any;\n    this.ctx.fillRect(0, 0, width, height);\n\n    if(this.fillStyle) {\n      this.ctx.fillStyle = this.fillStyle;\n      this.ctx.fillRect(0, 0, width, height);\n    }\n\n    if(this.text) {\n      this.ctx.fillText(this.text, 50, 50);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport rootScope from '../lib/rootScope';\nimport {animate} from './animation';\nimport {drawCircleFromStart} from './canvas/drawCircle';\nimport roundRect from './canvas/roundRect';\nimport Shimmer from './canvas/shimmer';\nimport customProperties from './dom/customProperties';\nimport easeInOutSine from './easing/easeInOutSine';\nimport mediaSizes from './mediaSizes';\n\nexport default class DialogsPlaceholder {\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private shimmer: Shimmer;\n  private tempId: number;\n  private detachTime: number;\n\n  private length: number;\n  private dialogHeight: number;\n  private availableLength: number;\n\n  private avatarSize: number;\n  private marginVertical: number;\n  private lineHeight: number;\n  private lineBorderRadius: number;\n  private lineMarginVertical: number;\n  private statusWidth: number;\n  private generatedValues: {\n    firstLineWidth: number,\n    secondLineWidth: number,\n    statusWidth: number\n  }[];\n\n  private getRectFrom: Element;\n  private onRemove: () => void;\n  private blockScrollable: Scrollable;\n\n  constructor() {\n    this.shimmer = new Shimmer();\n    this.tempId = 0;\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('dialogs-placeholder-canvas');\n    this.ctx = this.canvas.getContext('2d');\n\n    this.generatedValues = [];\n    this.avatarSize = 54;\n    this.marginVertical = 9;\n    this.lineHeight = 10;\n    this.lineBorderRadius = 6;\n    this.lineMarginVertical = 8;\n    this.statusWidth = 24;\n  }\n\n  public attach({container, rect, getRectFrom, onRemove, blockScrollable}: {\n    container: HTMLElement,\n    rect?: {width: number, height: number},\n    getRectFrom?: HTMLElement,\n    onRemove?: DialogsPlaceholder['onRemove'],\n    blockScrollable?: DialogsPlaceholder['blockScrollable']\n  }) {\n    const {canvas} = this;\n\n    this.onRemove = onRemove;\n    this.getRectFrom = getRectFrom || container;\n    if(this.blockScrollable = blockScrollable) {\n      blockScrollable.container.style.overflowY = 'hidden';\n    }\n\n    this.updateCanvasSize(rect);\n    this.startAnimation();\n    container.append(canvas);\n  }\n\n  public detach(availableLength: number) {\n    if(this.detachTime) {\n      return;\n    }\n\n    this.availableLength = availableLength;\n    this.detachTime = Date.now();\n\n    if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n    }\n  }\n\n  public remove() {\n    this.stopAnimation();\n\n    if(this.canvas.parentElement) {\n      this.canvas.remove();\n\n      if(this.onRemove) {\n        this.onRemove();\n        this.onRemove = undefined;\n      }\n\n      if(this.blockScrollable) {\n        this.blockScrollable.container.style.overflowY = '';\n        this.blockScrollable = undefined;\n      }\n    }\n  }\n\n  private updateCanvasSize(rect: {width: number, height: number} = this.getRectFrom.getBoundingClientRect()) {\n    const {canvas} = this;\n    const dpr = canvas.dpr = window.devicePixelRatio;\n    canvas.width = rect.width * dpr;\n    canvas.height = rect.height * dpr;\n    canvas.style.width = rect.width + 'px';\n    canvas.style.height = rect.height + 'px';\n  }\n\n  private renderDetachAnimationFrame() {\n    const {\n      canvas,\n      ctx,\n      detachTime,\n      length,\n      availableLength\n    } = this;\n\n    if(!detachTime) {\n      return;\n    } else if(!rootScope.settings.animationsEnabled) {\n      this.remove();\n      return;\n    }\n\n    const {width} = canvas;\n\n    ctx.globalCompositeOperation = 'destination-out';\n\n    // ctx.fillStyle = 'rgba(0, 0, 0, 0)';\n    // ctx.fillRect(0, 0, width, height);\n\n    // const DURATION = 500;\n    // const DELAY = DURATION;\n    const DURATION = 150;\n    const DELAY = 15;\n    const elapsedTime = Date.now() - detachTime;\n    let completed = true;\n    for(let i = 0; i < length; ++i) {\n      const delay = availableLength < length && i >= availableLength ? DELAY * (availableLength - 1) : DELAY * i;\n      const elapsedRowTime = elapsedTime - delay;\n      if(elapsedRowTime <= 0) {\n        completed = false;\n        continue;\n      }\n\n      const progress = easeInOutSine(elapsedRowTime, 0, 1, DURATION);\n\n      ctx.beginPath();\n      ctx.rect(0, this.dialogHeight * i, width, this.dialogHeight);\n      ctx.fillStyle = `rgba(0, 0, 0, ${progress})`;\n      ctx.fill();\n\n      if(progress < 1) {\n        completed = false;\n      }\n    }\n\n    // const totalRadius = Math.sqrt(width ** 2 + height ** 2);\n    // const gradient = ctx.createRadialGradient(\n    //   0, 0, 0,\n    //   0, 0, totalRadius);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // const gradient = ctx.createLinearGradient(0, 0, 0, height);\n    // gradient.addColorStop(0, 'rgba(0, 0, 0, 1)');\n    // gradient.addColorStop(progress, 'rgba(0, 0, 0, 0)');\n    // gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n\n    // ctx.fillStyle = gradient;\n    // ctx.fillRect(0, 0, width, height);\n\n    ctx.globalCompositeOperation = 'source-over';\n\n    if(completed) {\n      this.remove();\n    }\n  }\n\n  private renderFrame() {\n    this.shimmer.on();\n    this.renderDetachAnimationFrame();\n  }\n\n  private startAnimation() {\n    const {canvas, shimmer} = this;\n    const tempId = ++this.tempId;\n    const pattern = this.createPattern();\n\n    shimmer.settings({\n      canvas,\n      fillStyle: pattern\n    });\n\n    const middleware = () => {\n      return this.tempId === tempId;\n    };\n\n    this.renderFrame();\n    animate(() => {\n      if(!middleware()) {\n        return false;\n      }\n\n      // ! should've removed the loop if animations are disabled\n      if(rootScope.settings.animationsEnabled) {\n        this.renderFrame();\n      }\n\n      // ! tempId can be changed during renderFrame\n      return middleware();\n    });\n\n    rootScope.addEventListener('theme_change', this.onThemeChange);\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private stopAnimation() {\n    ++this.tempId;\n    rootScope.removeEventListener('theme_change', this.onThemeChange);\n    mediaSizes.removeEventListener('resize', this.onResize);\n  }\n\n  private onThemeChange = () => {\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private onResize = () => {\n    const {canvas} = this;\n    const {width, height, dpr} = canvas;\n    this.updateCanvasSize();\n    if(canvas.width === width && canvas.height === height && canvas.dpr === dpr) {\n      return;\n    }\n\n    this.stopAnimation();\n    this.startAnimation();\n  };\n\n  private createPattern() {\n    const {canvas, ctx} = this;\n\n    const patternCanvas = document.createElement('canvas');\n    const patternContext = patternCanvas.getContext('2d');\n    const dpr = canvas.dpr;\n    patternCanvas.dpr = dpr;\n    patternCanvas.width = canvas.width;\n    patternCanvas.height = canvas.height;\n\n    patternContext.fillStyle = customProperties.getProperty('surface-color');\n    patternContext.fillRect(0, 0, patternCanvas.width, patternCanvas.height);\n\n    patternContext.fillStyle = '#000';\n    patternContext.globalCompositeOperation = 'destination-out';\n\n    const dialogHeight = this.dialogHeight = (this.avatarSize + this.marginVertical * 2) * dpr;\n    const length = this.length = Math.ceil(canvas.height / dialogHeight);\n    for(let i = 0; i < length; ++i) {\n      this.drawChat(patternContext, i, i * dialogHeight);\n    }\n\n    return ctx.createPattern(patternCanvas, 'no-repeat');\n  }\n\n  private drawChat(ctx: CanvasRenderingContext2D, i: number, y: number) {\n    let generatedValues = this.generatedValues[i];\n    if(!generatedValues) {\n      generatedValues = this.generatedValues[i] = {\n        firstLineWidth: 40 + Math.random() * 100, // 120\n        secondLineWidth: 120 + Math.random() * 130, // 240\n        statusWidth: 24 + Math.random() * 16\n      };\n    }\n\n    const {\n      firstLineWidth,\n      secondLineWidth,\n      statusWidth\n    } = generatedValues;\n\n    const {canvas} = ctx;\n    const {dpr} = canvas;\n    y /= dpr;\n\n    const {\n      avatarSize,\n      marginVertical,\n      lineHeight,\n      lineBorderRadius,\n      lineMarginVertical\n    } = this;\n\n    let marginLeft = 17;\n    drawCircleFromStart(ctx, marginLeft, y + marginVertical, avatarSize / 2, true);\n\n    marginLeft += avatarSize + 10;\n    roundRect(ctx, marginLeft, y + marginVertical + lineMarginVertical, firstLineWidth, lineHeight, lineBorderRadius, true);\n    roundRect(ctx, marginLeft, y + marginVertical + avatarSize - lineHeight - lineMarginVertical, secondLineWidth, lineHeight, lineBorderRadius, true);\n\n    roundRect(ctx, canvas.width / dpr - 24 - statusWidth, y + marginVertical + lineMarginVertical, statusWidth, lineHeight, lineBorderRadius, true);\n  }\n}\n","export default function drawCircle(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  const dpr = ctx.canvas.dpr;\n  if(dpr) {\n    x *= dpr;\n    y *= dpr;\n    radius *= dpr;\n  }\n\n  ctx.beginPath();\n  ctx.arc(x, y, radius, 0, 2 * Math.PI, false);\n  ctx.closePath();\n\n  if(fill) {\n    ctx.fill();\n  }\n\n  if(stroke) {\n    ctx.stroke();\n  }\n}\n\nexport function drawCircleFromStart(ctx: CanvasRenderingContext2D, x: number, y: number, radius: number, fill?: boolean, stroke?: boolean) {\n  return drawCircle(ctx, x + radius, y + radius, radius, fill, stroke);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDialogFilter as DialogFilter, MyDialogFilter} from '../storages/filters';\nimport type LazyLoadQueue from '../../components/lazyLoadQueue';\nimport type {Dialog, MyMessage} from './appMessagesManager';\nimport type {MyPhoto} from './appPhotosManager';\nimport type {MyDocument} from './appDocsManager';\nimport type {State} from '../../config/state';\nimport AvatarElement from '../../components/avatar';\nimport DialogsContextMenu from '../../components/dialogsContextMenu';\nimport {horizontalMenu} from '../../components/horizontalMenu';\nimport ripple from '../../components/ripple';\nimport Scrollable, {ScrollableX, SliceSides} from '../../components/scrollable';\nimport {formatDateAccordingToTodayNew} from '../../helpers/date';\nimport {IS_MOBILE_SAFARI, IS_SAFARI} from '../../environment/userAgent';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport Button from '../../components/button';\nimport SetTransition from '../../components/singleTransition';\nimport {MyDraftMessage} from './appDraftsManager';\nimport DEBUG, {MOUNT_CLASS_TO} from '../../config/debug';\nimport PeerTitle from '../../components/peerTitle';\nimport I18n, {FormatterArguments, i18n, LangPackKey, _i18n} from '../langPack';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport wrapPhoto from '../../components/wrappers/photo';\nimport AppEditFolderTab from '../../components/sidebarLeft/tabs/editFolder';\nimport appSidebarLeft, {SettingSection} from '../../components/sidebarLeft';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport ConnectionStatusComponent from '../../components/connectionStatus';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport {fastRafConventional, fastRafPromise} from '../../helpers/schedulers';\nimport SortedUserList from '../../components/sortedUserList';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport handleTabSwipe from '../../helpers/dom/handleTabSwipe';\nimport windowSize from '../../helpers/windowSize';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport {setSendingStatus} from '../../components/sendingStatus';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {FOLDER_ID_ALL, FOLDER_ID_ARCHIVE, NULL_PEER_ID, REAL_FOLDERS, REAL_FOLDER_ID} from '../mtproto/mtproto_config';\nimport groupCallActiveIcon from '../../components/groupCallActiveIcon';\nimport {Chat, Message, NotifyPeer} from '../../layer';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport appNavigationController, {NavigationItem} from '../../components/appNavigationController';\nimport assumeType from '../../helpers/assumeType';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {AppManagers} from './managers';\nimport appSidebarRight from '../../components/sidebarRight';\nimport PopupElement from '../../components/popups';\nimport choosePhotoSize from './utils/photos/choosePhotoSize';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport isMessageRestricted from './utils/messages/isMessageRestricted';\nimport getMediaFromMessage from './utils/messages/getMediaFromMessage';\nimport getMessageSenderPeerIdOrName from './utils/messages/getMessageSenderPeerIdOrName';\nimport wrapStickerEmoji from '../../components/wrappers/stickerEmoji';\nimport getDialogIndexKey from './utils/dialogs/getDialogIndexKey';\nimport getProxiedManagers from './getProxiedManagers';\nimport getDialogIndex from './utils/dialogs/getDialogIndex';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport wrapPeerTitle from '../../components/wrappers/peerTitle';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport appDownloadManager from './appDownloadManager';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport noop from '../../helpers/noop';\nimport DialogsPlaceholder from '../../helpers/dialogsPlaceholder';\nimport pause from '../../helpers/schedulers/pause';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport whichChild from '../../helpers/dom/whichChild';\n\nexport const DIALOG_LIST_ELEMENT_TAG = 'A';\n\nexport type DialogDom = {\n  avatarEl: AvatarElement,\n  captionDiv: HTMLDivElement,\n  titleSpan: HTMLSpanElement,\n  titleSpanContainer: HTMLSpanElement,\n  statusSpan: HTMLSpanElement,\n  lastTimeSpan: HTMLSpanElement,\n  unreadBadge: HTMLElement,\n  callIcon?: ReturnType<typeof groupCallActiveIcon>,\n  mentionsBadge?: HTMLElement,\n  lastMessageSpan: HTMLSpanElement,\n  containerEl: HTMLElement,\n  listEl: HTMLElement,\n  subtitleEl: HTMLElement,\n\n  setLastMessagePromise?: CancellablePromise<void>,\n  setUnreadMessagePromise?: CancellablePromise<void>\n};\n\ninterface SortedDialog extends SortedElementBase {\n  dom: DialogDom,\n  loadPromises?: Promise<any>[]\n}\n\nfunction setPromiseMiddleware<T extends {[smth in K as K]?: CancellablePromise<void>}, K extends keyof T>(obj: T, key: K) {\n  const oldPromise: CancellablePromise<void> = obj[key] as any;\n  if(oldPromise) {\n    oldPromise.reject();\n  }\n\n  // @ts-ignore\n  const deferred = obj[key] = deferredPromise<void>();\n  deferred.catch(() => {}).finally(() => {\n    if((obj[key] as any) === deferred) {\n      delete obj[key];\n    }\n  });\n\n  const middleware = middlewarePromise(() => (obj[key] as any) === deferred);\n  return {deferred, middleware};\n}\n\nclass SortedDialogList extends SortedList<SortedDialog> {\n  constructor(\n    public managers: AppManagers,\n    public list: HTMLUListElement,\n    public indexKey: ReturnType<typeof getDialogIndexKey>,\n    public onListLengthChange?: () => void\n  ) {\n    super({\n      getIndex: (element) => managers.dialogsStorage.getDialogIndex(element.id, this.indexKey),\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onListLengthChange && this.onListLengthChange();\n      },\n      onSort: (element, idx) => {\n        const willChangeLength = element.dom.listEl.parentElement !== this.list;\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n\n        if(willChangeLength) {\n          this.onListLengthChange && this.onListLengthChange();\n        }\n      },\n      onElementCreate: (base, batch) => {\n        const loadPromises: Promise<any>[] = batch ? [] : undefined;\n\n        const {dom} = appDialogsManager.addListDialog({peerId: base.id, loadPromises, isBatch: batch});\n        (base as SortedDialog).dom = dom;\n\n        if(loadPromises?.length) {\n          (base as SortedDialog).loadPromises = loadPromises;\n          Promise.all(loadPromises).finally(() => {\n            delete (base as SortedDialog).loadPromises;\n          });\n        }\n\n        return base as SortedDialog;\n      },\n      updateElementWith: fastRafConventional\n    });\n  }\n\n  public clear() {\n    this.list.textContent = '';\n    super.clear();\n  }\n}\n\n// const testScroll = false;\n// let testTopSlice = 1;\n\nexport class AppDialogsManager {\n  private chatsContainer = document.getElementById('chatlist-container') as HTMLDivElement;\n\n  private loadDialogsPromise: Promise<{cached: boolean, renderPromise: AppDialogsManager['loadDialogsRenderPromise']}>;\n  private loadDialogsRenderPromise: Promise<void>;\n\n  private scroll: Scrollable = null;\n\n  private log = logger('DIALOGS', LogTypes.Log | LogTypes.Error | LogTypes.Warn | LogTypes.Debug);\n\n  private contextMenu: DialogsContextMenu;\n\n  private sortedList: SortedDialogList;\n  public placeholders: {[filterId: number]: DialogsPlaceholder} = {};\n  public sortedLists: {[filterId: number]: SortedDialogList} = {};\n  public scrollables: {[filterId: number]: Scrollable} = {};\n  public filterId: number;\n  private folders: {[k in 'menu' | 'container' | 'menuScrollContainer']: HTMLElement} = {\n    menu: document.getElementById('folders-tabs'),\n    menuScrollContainer: null,\n    container: document.getElementById('folders-container')\n  };\n  private filtersRendered: {\n    [filterId: string]: {\n      menu: HTMLElement,\n      container: HTMLElement,\n      unread: HTMLElement,\n      title: HTMLElement\n    }\n  } = {};\n  private showFiltersPromise: Promise<void>;\n\n  private sliceTimeout: number;\n\n  private lastActiveElements: Set<HTMLElement> = new Set();\n\n  private offsets: {top: number, bottom: number} = {top: 0, bottom: 0};\n\n  private loadContacts: () => void;\n  private processContact: (peerId: PeerId) => void;\n\n  private indexKey: ReturnType<typeof getDialogIndexKey>;\n\n  private initedListeners = false;\n\n  private onListLengthChange: () => Promise<void>;\n  private loadedDialogsAtLeastOnce = false;\n  private allChatsIntlElement: I18n.IntlElement;\n\n  private emptyDialogsPlaceholderSubtitle: I18n.IntlElement;\n  private updateContactsLengthPromise: Promise<number>;\n\n  private filtersNavigationItem: NavigationItem;\n\n  private managers: AppManagers;\n  private selectTab: ReturnType<typeof horizontalMenu>;\n\n  private doNotRenderChatList: boolean;\n\n  public start() {\n    const managers = this.managers = getProxiedManagers();\n\n    this.contextMenu = new DialogsContextMenu(managers);\n\n    this.folders.menuScrollContainer = this.folders.menu.parentElement;\n\n    this.onListLengthChange = debounce(this._onListLengthChange, 100, false, true);\n\n    const bottomPart = document.createElement('div');\n    bottomPart.classList.add('connection-status-bottom');\n    bottomPart.append(this.folders.container);\n\n    /* if(isTouchSupported && isSafari) {\n      let allowUp: boolean, allowDown: boolean, slideBeginY: number;\n      const container = this.scroll.container;\n      container.addEventListener('touchstart', (event) => {\n        allowUp = container.scrollTop > 0;\n        allowDown = (container.scrollTop < container.scrollHeight - container.clientHeight);\n        // @ts-ignore\n        slideBeginY = event.pageY;\n      });\n\n      container.addEventListener('touchmove', (event: any) => {\n        var up = (event.pageY > slideBeginY);\n        var down = (event.pageY < slideBeginY);\n        slideBeginY = event.pageY;\n        if((up && allowUp) || (down && allowDown)) {\n          event.stopPropagation();\n        } else if(up || down) {\n          event.preventDefault();\n        }\n      });\n    } */\n\n    if(IS_TOUCH_SUPPORTED) {\n      handleTabSwipe({\n        element: this.folders.container,\n        onSwipe: (xDiff) => {\n          const prevId = selectTab.prevId();\n          selectTab(xDiff > 0 ? prevId + 1 : prevId - 1);\n        }\n      });\n    }\n\n    this.allChatsIntlElement = new I18n.IntlElement({\n      key: 'FilterAllChatsShort'\n    });\n\n    /* if(testScroll) {\n      let i = 0;\n      let add = () => {\n        let li = document.createElement('li');\n        li.dataset.id = '' + i;\n        li.id = '' + i;\n        li.innerHTML = `<div class=\"rp\"><avatar-element style=\"background-color: rgb(166, 149, 231); font-size: 0px;\"><img src=\"assets/img/pepe.jpg\"></avatar-element><div class=\"user-caption\"><p><span class=\"user-title\">${i}</span><span><span class=\"message-status\"></span><span class=\"message-time\">18:33</span></span></p><p><span class=\"user-last-message\"><b>-_-_-_-: </b>qweasd</span><span></span></p></div></div>`;\n        i++;\n        this.scroll.append(li);\n      };\n      for(let i = 0; i < 500; ++i) {\n        add();\n      }\n      (window as any).addElement = add;\n    } */\n\n    rootScope.addEventListener('premium_toggle', async(isPremium) => {\n      if(isPremium) {\n        return;\n      }\n\n      const isFolderAvailable = await this.managers.filtersStorage.isFilterIdAvailable(this.filterId);\n      if(!isFolderAvailable) {\n        selectTab(whichChild(this.filtersRendered[FOLDER_ID_ALL].menu), false);\n      }\n    });\n\n    rootScope.addEventListener('state_cleared', () => {\n      const clearCurrent = REAL_FOLDERS.has(this.filterId);\n      // setTimeout(() =>\n      apiManagerProxy.getState().then(async(state) => {\n        this.loadedDialogsAtLeastOnce = false;\n\n        /* const clearPromises: Promise<any>[] = [];\n        for(const name in this.managers.appStateManager.storagesResults) {\n          const results = this.managers.appStateManager.storagesResults[name as keyof AppStateManager['storages']];\n          const storage = this.managers.appStateManager.storages[name as keyof AppStateManager['storages']];\n          results.length = 0;\n          clearPromises.push(storage.clear());\n        } */\n\n        if(clearCurrent) {\n          this.sortedList.clear();\n          this.onTabChange();\n        }\n\n        this.onStateLoaded(state);\n      })// , 5000);\n    });\n\n    this.setFilterId(FOLDER_ID_ALL, FOLDER_ID_ALL);\n    this.addFilter({\n      id: FOLDER_ID_ALL,\n      title: '',\n      localId: FOLDER_ID_ALL\n    });\n\n    const foldersScrollable = new ScrollableX(this.folders.menuScrollContainer);\n    bottomPart.prepend(this.folders.menuScrollContainer);\n    const selectTab = this.selectTab = horizontalMenu(this.folders.menu, this.folders.container, async(id, tabContent) => {\n      /* if(id !== 0) {\n        id += 1;\n      } */\n\n      const _id = id;\n      id = +tabContent.dataset.filterId || FOLDER_ID_ALL;\n\n      const isFilterAvailable = REAL_FOLDERS.has(id) || await this.managers.filtersStorage.isFilterIdAvailable(id);\n      if(!isFilterAvailable) {\n        return false;\n      }\n\n      const wasFilterId = this.filterId;\n      if(!IS_MOBILE_SAFARI) {\n        if(_id) {\n          if(!this.filtersNavigationItem) {\n            this.filtersNavigationItem = {\n              type: 'filters',\n              onPop: () => {\n                selectTab(0);\n                this.filtersNavigationItem = undefined;\n              }\n            };\n\n            appNavigationController.spliceItems(1, 0, this.filtersNavigationItem);\n          }\n        } else if(this.filtersNavigationItem) {\n          appNavigationController.removeItem(this.filtersNavigationItem);\n          this.filtersNavigationItem = undefined;\n        }\n      }\n\n      if(wasFilterId === id) return;\n\n      this.sortedLists[id].clear();\n      const promise = this.setFilterIdAndChangeTab(id).then(({cached, renderPromise}) => {\n        if(cached) {\n          return renderPromise;\n        }\n      });\n\n      if(wasFilterId !== -1) {\n        return promise;\n      }\n    }, () => {\n      for(const folderId in this.sortedLists) {\n        if(+folderId !== this.filterId) {\n          this.sortedLists[folderId].clear();\n          const placeholder = this.placeholders[folderId];\n          if(placeholder) {\n            placeholder.remove();\n          }\n        }\n      }\n    }, undefined, foldersScrollable);\n\n    apiManagerProxy.getState().then((state) => {\n      // * it should've had a better place :(\n      appMediaPlaybackController.setPlaybackParams(state.playbackParams);\n      appMediaPlaybackController.addEventListener('playbackParams', (params) => {\n        this.managers.appStateManager.pushToState('playbackParams', params);\n      });\n\n      return this.onStateLoaded(state);\n    })/* .then(() => {\n      const isLoadedMain = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(0);\n      const isLoadedArchive = this.managers.appMessagesManager.dialogsStorage.isDialogsLoaded(1);\n      const wasLoaded = isLoadedMain || isLoadedArchive;\n      const a: Promise<any> = isLoadedMain ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 0);\n      const b: Promise<any> = isLoadedArchive ? Promise.resolve() : this.managers.appMessagesManager.getConversationsAll('', 1);\n      a.finally(() => {\n        b.then(() => {\n          if(wasLoaded) {\n            (apiUpdatesManager.updatesState.syncLoading || Promise.resolve()).then(() => {\n              this.managers.appMessagesManager.refreshConversations();\n            });\n          }\n        });\n      });\n    }) */;\n\n    mediaSizes.addEventListener('resize', () => {\n      this.changeFiltersAllChatsKey();\n    });\n\n    new ConnectionStatusComponent(this.managers, this.chatsContainer);\n    this.chatsContainer.append(bottomPart);\n\n    setTimeout(() => {\n      lottieLoader.loadLottieWorkers();\n    }, 200);\n\n    PopupElement.MANAGERS = rootScope.managers = managers;\n    appDownloadManager.construct(managers);\n    appSidebarLeft.construct(managers);\n    appSidebarRight.construct(managers);\n    groupCallsController.construct(managers);\n    callsController.construct(managers);\n    appImManager.construct(managers);\n\n    // start\n\n    this.sortedList = this.sortedLists[this.filterId];\n    this.scroll = this.scrollables[this.filterId];\n\n    // selectTab(0, false);\n  }\n\n  public get chatList() {\n    return this.sortedList.list;\n  }\n\n  public setFilterId(filterId: number, localId: MyDialogFilter['localId']) {\n    this.filterId = filterId;\n    this.indexKey = getDialogIndexKey(REAL_FOLDERS.has(filterId) ? filterId as REAL_FOLDER_ID : localId);\n  }\n\n  public async setFilterIdAndChangeTab(filterId: number) {\n    this.filterId = filterId;\n    this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId);\n    return this.onTabChange();\n  }\n\n  private setOnlineStatus(element: HTMLElement, online: boolean) {\n    const className = 'is-online';\n    const hasClassName = element.classList.contains(className);\n    !hasClassName && online && element.classList.add(className);\n    SetTransition(element, 'is-visible', online, 250, online ? undefined : () => {\n      element.classList.remove(className);\n    }, online && !hasClassName ? 2 : 0);\n  }\n\n  private initListeners() {\n    rootScope.addEventListener('user_update', async(userId) => {\n      // console.log('updating user:', user, dialog);\n\n      const peerId = userId.toPeerId();\n      const dom = this.getDialogDom(peerId);\n      if(dom && peerId !== rootScope.myId && !(await this.managers.appUsersManager.isBot(userId))) {\n        const user = await this.managers.appUsersManager.getUser(userId);\n        const online = user.status?._ === 'userStatusOnline';\n        this.setOnlineStatus(dom.avatarEl, online);\n      }\n    });\n\n    rootScope.addEventListener('chat_update', async(chatId) => {\n      const peerId = chatId.toPeerId(true);\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(dialog) {\n        this.processDialogForCallStatus(dialog);\n      }\n    });\n\n    rootScope.addEventListener('folder_unread', (folder) => {\n      this.setFilterUnreadCount(folder.id);\n    });\n\n    rootScope.addEventListener('contacts_update', (userId) => {\n      this.processContact && this.processContact(userId.toPeerId());\n    });\n\n    rootScope.addEventListener('dialog_flush', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setLastMessageN({\n        dialog,\n        setUnread: true\n      });\n      this.validateDialogForFilter(dialog);\n      this.setFiltersUnreadCount();\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', (dialogs) => {\n      for(const [peerId, dialog] of dialogs) {\n        this.updateDialog(dialog);\n\n        if(this.processContact) {\n          this.processContact(peerId.toPeerId());\n        }\n\n        this.validateDialogForFilter(dialog);\n      }\n    });\n\n    rootScope.addEventListener('dialog_drop', ({peerId}) => {\n      this.deleteDialog(peerId);\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    rootScope.addEventListener('dialog_unread', ({dialog}) => {\n      if(!dialog) {\n        return;\n      }\n\n      this.setUnreadMessagesN({dialog});\n      this.validateDialogForFilter(dialog);\n    });\n\n    rootScope.addEventListener('dialog_notify_settings', (dialog) => {\n      this.validateDialogForFilter(dialog);\n      this.setUnreadMessagesN({dialog}); //    ,    is-muted\n    });\n\n    rootScope.addEventListener('dialog_draft', ({dialog, drop, peerId}) => {\n      if(drop) {\n        this.sortedList.delete(peerId);\n      } else {\n        this.updateDialog(dialog);\n      }\n\n      if(this.processContact) {\n        this.processContact(peerId);\n      }\n    });\n\n    appImManager.addEventListener('peer_changed', (peerId) => {\n      // const perf = performance.now();\n      for(const element of this.lastActiveElements) {\n        if(element.dataset.peerId.toPeerId() !== peerId) {\n          this.setDialogActive(element, false);\n        }\n      }\n\n      const elements = Array.from(document.querySelectorAll(`[data-autonomous=\"0\"] .chatlist-chat[data-peer-id=\"${peerId}\"]`)) as HTMLElement[];\n      elements.forEach((element) => {\n        this.setDialogActive(element, true);\n      });\n      // this.log('peer_changed total time:', performance.now() - perf);\n    });\n\n    rootScope.addEventListener('filter_update', async(filter) => {\n      if(REAL_FOLDERS.has(filter.id)) {\n        return;\n      }\n\n      if(!this.filtersRendered[filter.id]) {\n        this.addFilter(filter);\n        return;\n      } else if(filter.id === this.filterId) { //     ,    dialogs_multiupdate\n        const dialogs = await this.managers.dialogsStorage.getCachedDialogs(true);\n        await this.validateListForFilter();\n        for(let i = 0, length = dialogs.length; i < length; ++i) {\n          const dialog = dialogs[i];\n          this.updateDialog(dialog);\n        }\n      }\n\n      const elements = this.filtersRendered[filter.id];\n      setInnerHTML(elements.title, wrapEmojiText(filter.title));\n    });\n\n    rootScope.addEventListener('filter_delete', (filter) => {\n      const elements = this.filtersRendered[filter.id];\n      if(!elements) return;\n\n      // set tab\n      // (this.folders.menu.firstElementChild.children[Math.max(0, filter.id - 2)] as HTMLElement).click();\n      elements.container.remove();\n      elements.menu.remove();\n\n      delete this.sortedLists[filter.id];\n      delete this.scrollables[filter.id];\n      delete this.filtersRendered[filter.id];\n\n      this.onFiltersLengthChange();\n\n      if(this.filterId === filter.id) {\n        this.selectTab(0, false);\n      }\n    });\n\n    rootScope.addEventListener('filter_order', async(order) => {\n      order = order.slice();\n      indexOfAndSplice(order, FOLDER_ID_ARCHIVE);\n\n      const containerToAppend = this.folders.menu as HTMLElement;\n      const r = await Promise.all(order.map(async(filterId) => {\n        return {\n          indexKey: await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(filterId),\n          filter: await this.managers.filtersStorage.getFilter(filterId)\n        };\n      }));\n\n      order.forEach((filterId, idx) => {\n        const {indexKey, filter} = r[idx];\n        const renderedFilter = this.filtersRendered[filterId];\n\n        const sortedList = this.sortedLists[filterId];\n        sortedList.indexKey = indexKey;\n\n        positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n        positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      });\n\n      this.indexKey = await this.managers.dialogsStorage.getDialogIndexKeyByFilterId(this.filterId);\n\n      /* if(this.filterId) {\n        const tabIndex = order.indexOf(this.filterId) + 1;\n        selectTab.prevId = tabIndex;\n      } */\n    });\n\n    rootScope.addEventListener('peer_typings', async({peerId, typings}) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(peerId);\n      if(!dialog) return;\n\n      if(typings.length) {\n        this.setTyping(dialog);\n      } else {\n        this.unsetTyping(dialog);\n      }\n    });\n  }\n\n  private setDialogActive(listEl: HTMLElement, active: boolean) {\n    // @ts-ignore\n    const dom = listEl.dialogDom as DialogDom;\n    listEl.classList.toggle('active', active);\n    if(active) {\n      this.lastActiveElements.add(listEl);\n    } else {\n      this.lastActiveElements.delete(listEl);\n    }\n\n    if(dom?.callIcon) {\n      dom.callIcon.setActive(active);\n    }\n  }\n\n  private async onStateLoaded(state: State) {\n    const filtersArr = state.filtersArr;\n    const haveFilters = filtersArr.length > REAL_FOLDERS.size;\n    // const filter = filtersArr.find((filter) => filter.id !== FOLDER_ID_ARCHIVE);\n\n    const addFilters = (filters: MyDialogFilter[]) => {\n      for(const filter of filters) {\n        this.addFilter(filter);\n      }\n    };\n\n    let addFiltersPromise: Promise<any>;\n    if(haveFilters) {\n      addFilters(filtersArr);\n    } else {\n      addFiltersPromise = this.managers.filtersStorage.getDialogFilters().then(addFilters);\n    }\n\n    this.doNotRenderChatList = true;\n    const loadDialogsPromise = this.onChatsScroll();\n    await loadDialogsPromise;\n\n    // show the placeholder before the filters, and then will reset to the default tab again\n    if(!haveFilters) {\n      this.selectTab(0, false);\n    }\n\n    addFiltersPromise && await addFiltersPromise;\n    // this.folders.menu.children[0].classList.add('active');\n\n    this.doNotRenderChatList = undefined;\n\n    this.filterId = -1;\n    this.selectTab(0, false);\n\n    if(!this.initedListeners) {\n      this.initListeners();\n      this.initedListeners = true;\n    }\n\n    haveFilters && this.showFiltersPromise && await this.showFiltersPromise;\n\n    this.managers.appNotificationsManager.getNotifyPeerTypeSettings();\n\n    await (await loadDialogsPromise).renderPromise.catch(noop);\n    this.managers.appMessagesManager.fillConversations();\n  }\n\n  /* private getOffset(side: 'top' | 'bottom'): {index: number, pos: number} {\n    if(!this.scroll.loadedAll[side]) {\n      const element = (side === 'top' ? this.chatList.firstElementChild : this.chatList.lastElementChild) as HTMLElement;\n      if(element) {\n        const peerId = element.dataset.peerId;\n        const dialog = this.managers.appMessagesManager.getDialogByPeerId(peerId);\n        return {index: dialog[0].index, pos: dialog[1]};\n      }\n    }\n\n    return {index: 0, pos: -1};\n  } */\n  private getOffsetIndex(side: 'top' | 'bottom') {\n    return {index: this.scroll.loadedAll[side] ? 0 : this.offsets[side]};\n  }\n\n  private isDialogMustBeInViewport(dialog: Dialog) {\n    if(dialog.migratedTo !== undefined || !this.testDialogForFilter(dialog)) return false;\n    // return true;\n    const topOffset = this.getOffsetIndex('top');\n    const bottomOffset = this.getOffsetIndex('bottom');\n\n    if(!topOffset.index && !bottomOffset.index) {\n      return true;\n    }\n\n    const index = getDialogIndex(dialog, this.indexKey);\n    return (!topOffset.index || index <= topOffset.index) && (!bottomOffset.index || index >= bottomOffset.index);\n  }\n\n  private deleteDialog(peerId: PeerId) {\n    this.sortedList.delete(peerId);\n  }\n\n  private updateDialog(dialog: Dialog) {\n    if(this.isDialogMustBeInViewport(dialog)) {\n      if(!this.sortedList.has(dialog.peerId)) {\n        this.sortedList.add(dialog.peerId);\n        return;\n      }\n    } else {\n      this.deleteDialog(dialog.peerId);\n      return;\n    }\n\n    const dom = this.getDialogDom(dialog.peerId);\n    if(dom) {\n      this.setLastMessageN({\n        dialog,\n        dom,\n        setUnread: true\n      });\n      this.sortedList.update(dialog.peerId);\n    }\n  }\n\n  public onTabChange = () => {\n    this.scroll = this.scrollables[this.filterId];\n    this.scroll.loadedAll.top = true;\n    this.scroll.loadedAll.bottom = false;\n    this.offsets.top = this.offsets.bottom = 0;\n    this.loadDialogsRenderPromise = undefined;\n    this.loadDialogsPromise = undefined;\n    this.sortedList = this.sortedLists[this.filterId];\n    return this.onChatsScroll();\n  };\n\n  private async setFilterUnreadCount(filterId: number) {\n    if(filterId === FOLDER_ID_ALL) {\n      return;\n    }\n\n    const unreadSpan = this.filtersRendered[filterId]?.unread;\n    if(!unreadSpan) {\n      return;\n    }\n\n    const {unreadUnmutedCount, unreadCount} = await this.managers.dialogsStorage.getFolderUnreadCount(filterId);\n    unreadSpan.classList.toggle('badge-gray', !unreadUnmutedCount);\n    unreadSpan.innerText = unreadCount ? '' + unreadCount : '';\n  }\n\n  private setFiltersUnreadCount() {\n    for(const filterId in this.filtersRendered) {\n      this.setFilterUnreadCount(+filterId);\n    }\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private async validateListForFilter() {\n    this.sortedList.getAll().forEach(async(element) => {\n      const dialog = await this.managers.appMessagesManager.getDialogOnly(element.id);\n      if(!this.testDialogForFilter(dialog)) {\n        this.deleteDialog(element.id);\n      }\n    });\n  }\n\n  /**\n   *     ,    (!)\n   */\n  private validateDialogForFilter(dialog: Dialog) {\n    if(!this.getDialogDom(dialog.peerId)) {\n      return;\n    }\n\n    if(!this.testDialogForFilter(dialog)) {\n      this.deleteDialog(dialog.peerId);\n    }\n  }\n\n  public testDialogForFilter(dialog: Dialog) {\n    if(\n      !dialog ||\n      (!REAL_FOLDERS.has(this.filterId) ? getDialogIndex(dialog, this.indexKey) === undefined : this.filterId !== dialog.folder_id)\n      // (filter && !(await this.managers.filtersStorage.testDialogForFilter(dialog, filter)))\n    ) {\n      return false;\n    }\n\n    return true;\n  }\n\n  public generateScrollable(list: HTMLUListElement, filter: Parameters<AppDialogsManager['addFilter']>[0]) {\n    const filterId = filter.id;\n    const scrollable = new Scrollable(null, 'CL', 500);\n    scrollable.container.addEventListener('scroll', this.onChatsRegularScroll);\n    scrollable.container.dataset.filterId = '' + filterId;\n    scrollable.onScrolledTop = this.onChatsScrollTop;\n    scrollable.onScrolledBottom = this.onChatsScroll;\n    scrollable.setVirtualContainer(list);\n\n    const sortedDialogList = new SortedDialogList(\n      this.managers,\n      list,\n      getDialogIndexKey(filter.localId),\n      this.onListLengthChange\n    );\n\n    this.scrollables[filterId] = scrollable;\n    this.sortedLists[filterId] = sortedDialogList;\n\n    // list.classList.add('hide');\n    // scrollable.container.style.backgroundColor = '#' + (Math.random() * (16 ** 6 - 1) | 0).toString(16);\n\n    return scrollable;\n  }\n\n  private addFilter(filter: Pick<DialogFilter, 'title' | 'id' | 'localId'>) {\n    if(filter.id === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const containerToAppend = this.folders.menu as HTMLElement;\n    const renderedFilter = this.filtersRendered[filter.id];\n    if(renderedFilter) {\n      positionElementByIndex(renderedFilter.menu, containerToAppend, filter.localId);\n      positionElementByIndex(renderedFilter.container, this.folders.container, filter.localId);\n      return;\n    }\n\n    const menuTab = document.createElement('div');\n    menuTab.classList.add('menu-horizontal-div-item');\n    const span = document.createElement('span');\n    const titleSpan = document.createElement('span');\n    titleSpan.classList.add('text-super');\n    if(filter.id === FOLDER_ID_ALL) titleSpan.append(this.allChatsIntlElement.element);\n    else setInnerHTML(titleSpan, wrapEmojiText(filter.title));\n    const unreadSpan = document.createElement('div');\n    unreadSpan.classList.add('badge', 'badge-20', 'badge-primary');\n    const i = document.createElement('i');\n    span.append(titleSpan, unreadSpan, i);\n    ripple(menuTab);\n    menuTab.append(span);\n\n    menuTab.dataset.filterId = '' + filter.id;\n\n    positionElementByIndex(menuTab, containerToAppend, filter.localId);\n    // containerToAppend.append(li);\n\n    const ul = this.createChatList();\n    const scrollable = this.generateScrollable(ul, filter);\n\n    scrollable.container.classList.add('tabs-tab', 'chatlist-parts');\n\n    /* const parts = document.createElement('div');\n    parts.classList.add('chatlist-parts'); */\n\n    const top = document.createElement('div');\n    top.classList.add('chatlist-top');\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('chatlist-bottom');\n\n    top.append(ul);\n    scrollable.container.append(top, bottom);\n    /* parts.append(top, bottom);\n    scrollable.container.append(parts); */\n\n    const div = scrollable.container;\n    // this.folders.container.append(div);\n    positionElementByIndex(scrollable.container, this.folders.container, filter.localId);\n\n    this.setListClickListener(ul, null, true);\n\n    this.filtersRendered[filter.id] = {\n      menu: menuTab,\n      container: div,\n      unread: unreadSpan,\n      title: titleSpan\n    };\n\n    this.onFiltersLengthChange();\n  }\n\n  private changeFiltersAllChatsKey() {\n    const scrollable = this.folders.menuScrollContainer.firstElementChild;\n    const key: LangPackKey = scrollable.scrollWidth > scrollable.clientWidth ? 'FilterAllChatsShort' : 'FilterAllChats';\n    this.allChatsIntlElement.compareAndUpdate({key});\n  }\n\n  private onFiltersLengthChange() {\n    if(!this.showFiltersPromise) {\n      this.showFiltersPromise = new Promise<void>((resolve) => {\n        window.setTimeout(() => {\n          const length = Object.keys(this.filtersRendered).length;\n          const show = length > 1;\n          const wasShowing = !this.folders.menuScrollContainer.classList.contains('hide');\n\n          if(show !== wasShowing) {\n            this.folders.menuScrollContainer.classList.toggle('hide', !show);\n            if(show && !wasShowing) {\n              this.setFiltersUnreadCount();\n            }\n\n            this.chatsContainer.classList.toggle('has-filters', show);\n          }\n\n          this.changeFiltersAllChatsKey();\n\n          this.showFiltersPromise = undefined;\n          resolve();\n        }, 0);\n      });\n    }\n\n    return this.showFiltersPromise;\n  }\n\n  private loadDialogs(side: SliceSides) {\n    /* if(testScroll) {\n      return;\n    } */\n\n    this.log.warn('load', side);\n\n    if(this.loadDialogsPromise || this.loadDialogsRenderPromise/*  || 1 === 1 */) return this.loadDialogsPromise;\n    else if(this.scroll.loadedAll[side]) {\n      return Promise.resolve({\n        cached: true,\n        renderPromise: Promise.resolve()\n      });\n    }\n\n    const cachedInfoPromise = deferredPromise<boolean>();\n    const renderPromise = new Promise<void>(async(resolve, reject) => {\n      const {chatList, filterId, indexKey} = this;\n\n      // return;\n\n      // let loadCount = 30/*this.chatsLoadCount */;\n      let loadCount = windowSize.height / 72 * 1.25 | 0;\n      let offsetIndex = 0;\n\n      const doNotRenderChatList = this.doNotRenderChatList; // cache before awaits\n      const {index: currentOffsetIndex} = this.getOffsetIndex(side);\n      if(currentOffsetIndex) {\n        if(side === 'top') {\n          const storage = await this.managers.dialogsStorage.getFolderDialogs(filterId, true);\n          const index = storage.findIndex((dialog) => getDialogIndex(dialog, indexKey) <= currentOffsetIndex);\n          const needIndex = Math.max(0, index - loadCount);\n          loadCount = index - needIndex;\n          offsetIndex = getDialogIndex(storage[needIndex], indexKey) + 1;\n        } else {\n          offsetIndex = currentOffsetIndex;\n        }\n      }\n\n      // let offset = storage[storage.length - 1]?.index || 0;\n\n      let placeholder = this.placeholders[filterId];\n      try {\n        const getConversationsResult = this.managers.acknowledged.appMessagesManager.getConversations('', offsetIndex, loadCount, filterId, true);\n        if(\n          !chatList.childElementCount &&\n          !placeholder &&\n          (\n            !this.loadedDialogsAtLeastOnce ||\n            !(await getConversationsResult).cached\n          )\n        ) {\n          placeholder = this.placeholders[filterId] = new DialogsPlaceholder();\n          const getRectFrom = filterId === FOLDER_ID_ARCHIVE ? this.chatsContainer : this.folders.container;\n          placeholder.attach({\n            container: chatList.parentElement,\n            getRectFrom,\n            onRemove: () => {\n              delete this.placeholders[filterId];\n            },\n            blockScrollable: this.scroll\n          });\n\n          cachedInfoPromise.resolve(false);\n        }\n\n        const a = await getConversationsResult;\n        const result = await a.result;\n        if(this.loadDialogsRenderPromise !== renderPromise || doNotRenderChatList) {\n          reject();\n          cachedInfoPromise.reject();\n          return;\n        }\n\n        cachedInfoPromise.resolve(a.cached);\n\n        // console.timeEnd('getDialogs time');\n\n        // * loaded all\n        // if(!result.dialogs.length || chatList.childElementCount === result.count) {\n        // !result.dialogs.length  ,      getConversations   .\n        // if(chatList.childElementCount === result.count) {\n        if(side === 'bottom') {\n          if(result.isEnd) {\n            this.scroll.loadedAll[side] = true;\n          }\n        } else if(result.isTopEnd) {\n          this.scroll.loadedAll[side] = true;\n        }\n\n        this.loadedDialogsAtLeastOnce = true;\n\n        if(result.dialogs.length) {\n          const dialogs = side === 'top' ? result.dialogs.slice().reverse() : result.dialogs;\n\n          const loadPromises: Promise<any>[] = [];\n\n          const callbacks: (() => void)[] = [];\n          const cccc = (callback: () => void) => {\n            callbacks.push(callback);\n          };\n\n          dialogs.forEach((dialog) => {\n            // :(\n            // const isBuggedDialog = !this.managers.appMessagesManager.getDialogOnly(dialog.peerId);\n            // if(isBuggedDialog) {\n            //   return;\n            // }\n\n            const element = this.sortedList.add(dialog.peerId, true, /* undefined, false,  */cccc, false);\n            if(element.loadPromises) {\n              loadPromises.push(...element.loadPromises);\n            }\n          });\n\n          loadPromises.push(fastRafPromise()); // it is needed here\n          await Promise.all(loadPromises).finally();\n          if(this.loadDialogsRenderPromise !== renderPromise) {\n            reject();\n            cachedInfoPromise.reject();\n            return;\n          }\n\n          callbacks.forEach((callback) => callback());\n        } else {\n          this.onListLengthChange();\n        }\n\n        const offsetDialog = result.dialogs[side === 'top' ? 0 : result.dialogs.length - 1];\n        if(offsetDialog) {\n          this.offsets[side] = getDialogIndex(offsetDialog, indexKey);\n        }\n\n        this.log.debug('getDialogs ' + loadCount + ' dialogs by offset:', offsetIndex, result, chatList.childElementCount);\n\n        setTimeout(() => {\n          this.scroll.onScroll();\n        }, 0);\n      } catch(err) {\n        this.log.error(err);\n      }\n\n      if(placeholder) {\n        // await pause(500);\n        placeholder.detach(chatList.childElementCount);\n      }\n\n      resolve();\n    }).finally(() => {\n      if(this.loadDialogsRenderPromise === renderPromise) {\n        this.loadDialogsRenderPromise = undefined;\n        this.loadDialogsPromise = undefined;\n      }\n    });\n\n    this.loadDialogsRenderPromise = renderPromise;\n    return this.loadDialogsPromise = cachedInfoPromise.then((cached) => ({\n      cached,\n      renderPromise\n    }));\n  }\n\n  private generateEmptyPlaceholder(options: {\n    title: LangPackKey,\n    subtitle?: LangPackKey,\n    subtitleArgs?: FormatterArguments,\n    classNameType: string\n  }) {\n    const BASE_CLASS = 'empty-placeholder';\n    const container = document.createElement('div');\n    container.classList.add(BASE_CLASS, BASE_CLASS + '-' + options.classNameType);\n\n    const header = document.createElement('div');\n    header.classList.add(BASE_CLASS + '-header');\n    _i18n(header, options.title);\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(BASE_CLASS + '-subtitle');\n    if(options.subtitle) {\n      _i18n(subtitle, options.subtitle, options.subtitleArgs);\n    }\n\n    container.append(header, subtitle);\n\n    return {container, header, subtitle};\n  }\n\n  private checkIfPlaceholderNeeded() {\n    if(this.filterId === FOLDER_ID_ARCHIVE) {\n      return;\n    }\n\n    const chatList = this.chatList;\n    const part = chatList.parentElement as HTMLElement;\n    let placeholderContainer = (Array.from(part.children) as HTMLElement[]).find((el) => el.matches('.empty-placeholder'));\n    const needPlaceholder = this.scroll.loadedAll.bottom && !chatList.childElementCount/*  || true */;\n    // chatList.style.display = 'none';\n\n    if(needPlaceholder && placeholderContainer) {\n      return;\n    } else if(!needPlaceholder) {\n      if(placeholderContainer) {\n        part.classList.remove('with-placeholder');\n        placeholderContainer.remove();\n      }\n\n      return;\n    }\n\n    let placeholder: ReturnType<AppDialogsManager['generateEmptyPlaceholder']>, type: 'dialogs' | 'folder';\n    if(!this.filterId) {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'ChatList.Main.EmptyPlaceholder.Title',\n        classNameType: type = 'dialogs'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const img = document.createElement('img');\n      img.classList.add('empty-placeholder-dialogs-icon');\n\n      this.emptyDialogsPlaceholderSubtitle = new I18n.IntlElement({\n        element: placeholder.subtitle\n      });\n\n      Promise.all([\n        this.updateContactsLength(false),\n        renderImageFromUrlPromise(img, 'assets/img/EmptyChats.svg'),\n        fastRafPromise()\n      ]).then(([usersLength]) => {\n        placeholderContainer.classList.add('visible');\n        part.classList.toggle('has-contacts', !!usersLength);\n      });\n\n      placeholderContainer.prepend(img);\n    } else {\n      placeholder = this.generateEmptyPlaceholder({\n        title: 'FilterNoChatsToDisplay',\n        subtitle: 'FilterNoChatsToDisplayInfo',\n        classNameType: type = 'folder'\n      });\n\n      placeholderContainer = placeholder.container;\n\n      const div = document.createElement('div');\n      const emoji = '';\n      const size = 128;\n      wrapStickerEmoji({\n        div,\n        emoji: emoji,\n        width: size,\n        height: size\n      });\n\n      placeholderContainer.prepend(div);\n\n      const button = Button('btn-primary btn-color-primary btn-control tgico', {\n        text: 'FilterHeaderEdit',\n        icon: 'settings'\n      });\n\n      attachClickEvent(button, async() => {\n        appSidebarLeft.createTab(AppEditFolderTab).open(await this.managers.filtersStorage.getFilter(this.filterId));\n      });\n\n      placeholderContainer.append(button);\n    }\n\n    part.append(placeholderContainer);\n    part.classList.add('with-placeholder');\n    part.dataset.placeholderType = type;\n  }\n\n  private updateContactsLength(updatePartClassName: boolean) {\n    if(this.updateContactsLengthPromise) return this.updateContactsLengthPromise;\n    return this.updateContactsLengthPromise = this.managers.appUsersManager.getContacts().then((users) => {\n      const subtitle = this.emptyDialogsPlaceholderSubtitle;\n      if(subtitle) {\n        let key: LangPackKey, args: FormatterArguments;\n\n        if(users.length/*  && false */) {\n          key = 'ChatList.Main.EmptyPlaceholder.Subtitle';\n          args = [i18n('Contacts.Count', [users.length])];\n        } else {\n          key = 'ChatList.Main.EmptyPlaceholder.SubtitleNoContacts';\n          args = [];\n        }\n\n        subtitle.compareAndUpdate({\n          key,\n          args\n        });\n      }\n\n      if(updatePartClassName) {\n        const chatList = this.chatList;\n        const part = chatList.parentElement as HTMLElement;\n        part.classList.toggle('has-contacts', !!users.length);\n      }\n\n      this.updateContactsLengthPromise = undefined;\n\n      return users.length;\n    });\n  }\n\n  private removeContactsPlaceholder() {\n    const chatList = this.chatList;\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    parts.classList.remove('with-contacts');\n    bottom.innerHTML = '';\n    this.loadContacts = undefined;\n    this.processContact = undefined;\n  }\n\n  private _onListLengthChange = () => {\n    if(!this.loadedDialogsAtLeastOnce) {\n      return;\n    }\n\n    this.checkIfPlaceholderNeeded();\n\n    if(this.filterId !== FOLDER_ID_ALL) return;\n\n    const chatList = this.chatList;\n    const count = chatList.childElementCount;\n\n    const parts = chatList.parentElement.parentElement;\n    const bottom = chatList.parentElement.nextElementSibling as HTMLElement;\n    const hasContacts = !!bottom.childElementCount;\n    if(count >= 10) {\n      if(hasContacts) {\n        this.removeContactsPlaceholder();\n      }\n\n      return;\n    } else if(hasContacts) return;\n\n    parts.classList.add('with-contacts');\n\n    const section = new SettingSection({\n      name: 'Contacts',\n      noDelimiter: true,\n      fakeGradientDelimiter: true\n    });\n\n    section.container.classList.add('hide');\n\n    this.managers.appUsersManager.getContactsPeerIds(undefined, undefined, 'online').then((contacts) => {\n      let ready = false;\n      const onListLengthChange = () => {\n        if(ready) {\n          section.container.classList.toggle('hide', !sortedUserList.list.childElementCount);\n        }\n\n        this.updateContactsLength(true);\n      };\n\n      const sortedUserList = new SortedUserList({\n        avatarSize: 42,\n        createChatListOptions: {\n          dialogSize: 48,\n          new: true\n        },\n        autonomous: false,\n        onListLengthChange,\n        managers: this.managers\n      });\n\n      this.loadContacts = () => {\n        const pageCount = windowSize.height / 60 | 0;\n        const promise = filterAsync(contacts.splice(0, pageCount), this.verifyPeerIdForContacts);\n\n        promise.then((arr) => {\n          arr.forEach((peerId) => {\n            sortedUserList.add(peerId);\n          });\n        });\n\n        if(!contacts.length) {\n          this.loadContacts = undefined;\n        }\n      };\n\n      this.loadContacts();\n\n      this.processContact = async(peerId) => {\n        if(peerId.isAnyChat()) {\n          return;\n        }\n\n        const good = await this.verifyPeerIdForContacts(peerId);\n        const added = sortedUserList.has(peerId);\n        if(!added && good) sortedUserList.add(peerId);\n        else if(added && !good) sortedUserList.delete(peerId);\n      };\n\n      const list = sortedUserList.list;\n      list.classList.add('chatlist-new');\n      this.setListClickListener(list);\n      section.content.append(list);\n\n      ready = true;\n      onListLengthChange();\n    });\n\n    bottom.append(section.container);\n  };\n\n  private verifyPeerIdForContacts = async(peerId: PeerId) => {\n    return await this.managers.appPeersManager.isContact(peerId) && !(await this.managers.appMessagesManager.getDialogOnly(peerId));\n  };\n\n  public onChatsRegularScroll = () => {\n    // return;\n\n    if(this.sliceTimeout) clearTimeout(this.sliceTimeout);\n    this.sliceTimeout = window.setTimeout(() => {\n      this.sliceTimeout = undefined;\n\n      if(!this.chatList.childElementCount || this.processContact) {\n        return;\n      }\n\n      /* const observer = new IntersectionObserver((entries) => {\n        const\n      });\n\n      Array.from(this.chatList.children).forEach((el) => {\n        observer.observe(el);\n      }); */\n\n      fastRafConventional(() => {\n        const perf = performance.now();\n\n        const scrollTopWas = this.scroll.scrollTop;\n\n        const firstElementChild = this.chatList.firstElementChild;\n        const rectContainer = this.scroll.container.getBoundingClientRect();\n        const rectTarget = firstElementChild.getBoundingClientRect();\n        const children = Array.from(this.scroll.splitUp.children) as HTMLElement[];\n\n        // const padding = 8;\n        // const offsetTop = this.folders.container.offsetTop;\n        let offsetTop = this.scroll.splitUp.offsetTop;\n        if(offsetTop && scrollTopWas < offsetTop) offsetTop -= scrollTopWas;\n        // const offsetTop = scrollTopWas < padding ? padding - scrollTopWas : 0;\n        const firstY = rectContainer.y + offsetTop;\n        const lastY = rectContainer.y/*  - 8 */; // 8px - .chatlist padding-bottom\n\n        const firstElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.ceil(firstY + 1)), firstElementChild.tagName) as HTMLElement;\n        const lastElement = findUpTag(document.elementFromPoint(Math.ceil(rectTarget.x), Math.floor(lastY + rectContainer.height - 1)), firstElementChild.tagName) as HTMLElement;\n\n        // alert('got element:' + rect.y);\n\n        if(!firstElement || !lastElement) {\n          return;\n        }\n\n        // alert('got element:' + !!firstElement);\n\n        const firstElementRect = firstElement.getBoundingClientRect();\n        const elementOverflow = firstElementRect.y - firstY;\n\n        const sliced: HTMLElement[] = [];\n        const firstIndex = children.indexOf(firstElement);\n        const lastIndex = children.indexOf(lastElement);\n\n        const saveLength = 10;\n\n        const sliceFromStart = IS_SAFARI ? [] : children.slice(0, Math.max(0, firstIndex - saveLength));\n        const sliceFromEnd = children.slice(lastIndex + saveLength);\n\n        /* if(sliceFromStart.length !== sliceFromEnd.length) {\n        console.log('not equal', sliceFromStart.length, sliceFromEnd.length);\n      }\n\n      if(sliceFromStart.length > sliceFromEnd.length) {\n        const diff = sliceFromStart.length - sliceFromEnd.length;\n        sliceFromStart.splice(0, diff);\n      } else if(sliceFromEnd.length > sliceFromStart.length) {\n        const diff = sliceFromEnd.length - sliceFromStart.length;\n        sliceFromEnd.splice(sliceFromEnd.length - diff, diff);\n      } */\n\n        if(sliceFromStart.length) {\n          this.scroll.loadedAll.top = false;\n        }\n\n        if(sliceFromEnd.length) {\n          this.scroll.loadedAll.bottom = false;\n        }\n\n        sliced.push(...sliceFromStart);\n        sliced.push(...sliceFromEnd);\n\n        sliced.forEach((el) => {\n          const peerId = el.dataset.peerId.toPeerId();\n          this.deleteDialog(peerId);\n        });\n\n        this.setOffsets();\n\n        // this.log('[slicer] elements', firstElement, lastElement, rect, sliced, sliceFromStart.length, sliceFromEnd.length);\n\n        // this.log('[slicer] reset scrollTop', this.scroll.scrollTop, firstElement.offsetTop, firstElementRect.y, rect.y, elementOverflow);\n\n        // alert('left length:' + children.length);\n\n        this.scroll.scrollTop = firstElement.offsetTop - elementOverflow;\n\n        this.log('slice time', performance.now() - perf);\n        /* const firstElementRect = firstElement.getBoundingClientRect();\n      const scrollTop =  */\n\n      // this.scroll.scrollIntoView(firstElement, false);\n      });\n    }, 200);\n  };\n\n  private async setOffsets() {\n    const chatList = this.chatList;\n    const firstDialog = await this.getDialogFromElement(chatList.firstElementChild as HTMLElement);\n    const lastDialog = await this.getDialogFromElement(chatList.lastElementChild as HTMLElement);\n\n    const indexKey = this.indexKey;\n    this.offsets.top = getDialogIndex(firstDialog, indexKey);\n    this.offsets.bottom = getDialogIndex(lastDialog, indexKey);\n  }\n\n  private getDialogFromElement(element: HTMLElement) {\n    return this.managers.appMessagesManager.getDialogOnly(element.dataset.peerId.toPeerId());\n  }\n\n  public onChatsScrollTop = () => {\n    return this.onChatsScroll('top');\n  };\n\n  public onChatsScroll = (side: SliceSides = 'bottom') => {\n    if(this.scroll.loadedAll[side]) {\n      if(this.loadContacts) {\n        this.loadContacts();\n      }\n    }\n\n    this.log('onChatsScroll', side);\n    return this.loadDialogs(side);\n  };\n\n  public setListClickListener(list: HTMLUListElement, onFound?: () => void, withContext = false, autonomous = false, openInner = false) {\n    let lastActiveListElement: HTMLElement;\n\n    const setPeerFunc = (openInner ? appImManager.setInnerPeer : appImManager.setPeer).bind(appImManager);\n\n    list.dataset.autonomous = '' + +autonomous;\n    list.addEventListener('mousedown', (e) => {\n      if(e.button !== 0) return;\n\n      this.log('dialogs click list');\n      const target = e.target as HTMLElement;\n      const elem = findUpTag(target, DIALOG_LIST_ELEMENT_TAG);\n\n      if(!elem) {\n        return;\n      }\n\n      const peerId = elem.dataset.peerId.toPeerId();\n\n      if(e.ctrlKey || e.metaKey) {\n        window.open((elem as HTMLAnchorElement).href || ('#' + peerId), '_blank');\n        cancelEvent(e);\n        return;\n      }\n\n      if(autonomous) {\n        const sameElement = lastActiveListElement === elem;\n        if(lastActiveListElement && !sameElement) {\n          lastActiveListElement.classList.remove('active');\n        }\n\n        if(elem) {\n          elem.classList.add('active');\n          lastActiveListElement = elem;\n          this.lastActiveElements.add(elem);\n        }\n      }\n\n      if(elem) {\n        if(onFound) onFound();\n\n        const lastMsgId = +elem.dataset.mid || undefined;\n\n        setPeerFunc({\n          peerId, lastMsgId\n        });\n      } else {\n        setPeerFunc();\n      }\n    }, {capture: true});\n\n    // cancel link click\n    // ! do not change it to attachClickEvent\n    list.addEventListener('click', (e) => {\n      if(e.button === 0) {\n        cancelEvent(e);\n      }\n    }, {capture: true});\n\n    if(DEBUG) {\n      list.addEventListener('dblclick', (e) => {\n        const li = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\n        if(li) {\n          const peerId = li.dataset.peerId.toPeerId();\n          this.log('debug dialog:', this.managers.appMessagesManager.getDialogByPeerId(peerId));\n        }\n      });\n    }\n\n    if(withContext) {\n      attachContextMenuListener(list, this.contextMenu.onContextMenu);\n    }\n  }\n\n  public createChatList(options: {\n    // avatarSize?: number,\n    // handheldsSize?: number,\n    // size?: number,\n    new?: boolean,\n    dialogSize?: number,\n    ignoreClick?: boolean\n  } = {}) {\n    const list = document.createElement('ul');\n    list.classList.add('chatlist'/* ,\n      'chatlist-avatar-' + (options.avatarSize || 54) *//* , 'chatlist-' + (options.size || 72) */);\n\n    if(options.new) {\n      list.classList.add('chatlist-new');\n    }\n\n    if(options.dialogSize) {\n      list.classList.add('chatlist-' + options.dialogSize);\n    }\n\n    // if(options.ignoreClick) {\n    //   list.classList.add('disable-hover');\n    // }\n\n    /* if(options.handheldsSize) {\n      list.classList.add('chatlist-handhelds-' + options.handheldsSize);\n    } */\n\n    return list;\n  }\n\n  public setLastMessageN(options: {\n    dialog: Dialog,\n    lastMessage?: Message.message | Message.messageService,\n    dom?: DialogDom,\n    highlightWord?: string,\n    isBatch?: boolean,\n    setUnread?: boolean\n  }) {\n    const promise = this.setLastMessage(options.dialog, options.lastMessage, options.dom, options.highlightWord, options.isBatch, options.setUnread);\n    return promise.catch(noop);\n  }\n\n  private async setLastMessage(\n    dialog: Dialog,\n    lastMessage: Message.message | Message.messageService,\n    dom: DialogDom,\n    highlightWord?: string,\n    isBatch = false,\n    setUnread = false\n  ) {\n    if(!dom) {\n      dom = this.getDialogDom(dialog.peerId);\n\n      if(!dom) {\n        return;\n      }\n    }\n\n    const {deferred: promise, middleware} = setPromiseMiddleware(dom, 'setLastMessagePromise');\n\n    let draftMessage: MyDraftMessage;\n    if(!lastMessage) {\n      if(dialog.draft?._ === 'draftMessage') {\n        draftMessage = dialog.draft;\n      }\n\n      lastMessage = dialog.topMessage;\n      if(!lastMessage || lastMessage.mid !== dialog.top_message) {\n        const promise = this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message);\n        lastMessage = await middleware(promise);\n      }\n    }\n\n    if(setUnread) {\n      this.setUnreadMessagesN({dialog, dom, isBatch, setLastMessagePromise: promise});\n    }\n\n    if(!lastMessage/*  || (lastMessage._ === 'messageService' && !lastMessage.rReply) */) {\n      dom.lastMessageSpan.textContent = '';\n      dom.lastTimeSpan.textContent = '';\n      delete dom.listEl.dataset.mid;\n\n      promise.resolve();\n      return;\n    }\n\n    const peerId = dialog.peerId;\n    const isRestricted = lastMessage && isMessageRestricted(lastMessage as Message.message);\n\n    /* if(!dom.lastMessageSpan.classList.contains('user-typing')) */ {\n      let mediaContainer: HTMLElement;\n      const willPrepend: (Promise<any> | HTMLElement)[] = [];\n      if(lastMessage && !draftMessage && !isRestricted) {\n        const media: MyDocument | MyPhoto = getMediaFromMessage(lastMessage);\n        const videoTypes: Set<MyDocument['type']> = new Set(['video', 'gif', 'round']);\n        if(media && (media._ === 'photo' || videoTypes.has(media.type))) {\n          const size = choosePhotoSize(media, 20, 20);\n\n          if(size._ !== 'photoSizeEmpty') {\n            mediaContainer = document.createElement('div');\n            mediaContainer.classList.add('dialog-subtitle-media');\n\n            if((media as MyDocument).type === 'round') {\n              mediaContainer.classList.add('is-round');\n            }\n\n            willPrepend.push(wrapPhoto({\n              photo: media,\n              message: lastMessage,\n              container: mediaContainer,\n              withoutPreloader: true,\n              size\n            }).then(() => mediaContainer));\n\n            if(videoTypes.has((media as MyDocument).type)) {\n              const playIcon = document.createElement('span');\n              playIcon.classList.add('tgico-play');\n\n              mediaContainer.append(playIcon);\n            }\n          }\n        }\n      }\n\n      /* if(lastMessage.from_id === auth.id) { // You:  */\n      if(draftMessage) {\n        const bold = document.createElement('b');\n        bold.classList.add('danger');\n        bold.append(i18n('Draft'), ': ');\n        willPrepend.unshift(bold);\n      } else if(peerId.isAnyChat() && peerId !== lastMessage.fromId && !(lastMessage as Message.messageService).action) {\n        const senderBold = document.createElement('b');\n\n        if(lastMessage.fromId === rootScope.myId) {\n          senderBold.append(i18n('FromYou'));\n          willPrepend.unshift(senderBold);\n        } else {\n          // str = sender.first_name || sender.last_name || sender.username;\n          const p = middleware(wrapPeerTitle({\n            peerId: lastMessage.fromId,\n            onlyFirstName: true\n          })).then((element) => {\n            senderBold.prepend(element);\n            return senderBold;\n          }, noop);\n\n          willPrepend.unshift(p);\n        }\n\n        senderBold.append(': ');\n        // console.log(sender, senderBold.innerText);\n      }\n\n      const withoutMediaType = !!mediaContainer && !!(lastMessage as Message.message)?.message;\n\n      let fragment: DocumentFragment;\n      if(highlightWord && (lastMessage as Message.message).message) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, highlightWord, withoutMediaType));\n      } else if(draftMessage) {\n        fragment = await middleware(wrapMessageForReply(draftMessage));\n      } else if(lastMessage) {\n        fragment = await middleware(wrapMessageForReply(lastMessage, undefined, undefined, false, undefined, withoutMediaType));\n      } else { // rare case\n        fragment = document.createDocumentFragment();\n      }\n\n      if(willPrepend.length) {\n        const elements = await middleware(Promise.all(willPrepend));\n        fragment.prepend(...elements);\n      }\n\n      replaceContent(dom.lastMessageSpan, fragment);\n    }\n\n    if(lastMessage || draftMessage/*  && lastMessage._ !== 'draftMessage' */) {\n      const date = draftMessage ? Math.max(draftMessage.date, lastMessage.date || 0) : lastMessage.date;\n      replaceContent(dom.lastTimeSpan, formatDateAccordingToTodayNew(new Date(date * 1000)));\n    } else dom.lastTimeSpan.textContent = '';\n\n    if(setUnread !== null && !setUnread) { // means search\n      dom.listEl.dataset.mid = '' + lastMessage.mid;\n    }\n\n    promise.resolve();\n  }\n\n  private setUnreadMessagesN(options: {\n    dialog: Dialog,\n    dom?: DialogDom,\n    isBatch?: boolean,\n    setLastMessagePromise?: Promise<void>\n  }) {\n    return this.setUnreadMessages(options.dialog, options.dom, options.isBatch, options.setLastMessagePromise).catch(() => {});\n  }\n\n  private async setUnreadMessages(\n    dialog: Dialog,\n    dom = this.getDialogDom(dialog.peerId),\n    isBatch = false,\n    setLastMessagePromise?: Promise<void>\n  ) {\n    if(!dom) {\n      // this.log.error('setUnreadMessages no dom!', dialog);\n      return;\n    }\n\n    const {deferred, middleware} = setPromiseMiddleware(dom, 'setUnreadMessagePromise');\n\n    const isMuted = await middleware(this.managers.appNotificationsManager.isPeerLocalMuted(dialog.peerId, true));\n    const wasMuted = dom.listEl.classList.contains('is-muted');\n\n    let setStatusMessage: MyMessage;\n    if(dialog.draft?._ !== 'draftMessage') {\n      const lastMessage: MyMessage = await middleware(this.managers.appMessagesManager.getMessageByPeer(dialog.peerId, dialog.top_message));\n      if(lastMessage && lastMessage.pFlags.out && lastMessage.peerId !== rootScope.myId) {\n        setStatusMessage = lastMessage;\n      }\n    }\n\n    const filter = await middleware(this.managers.filtersStorage.getFilter(this.filterId));\n    let isPinned: boolean;\n    if(filter) {\n      isPinned = filter.pinnedPeerIds.indexOf(dialog.peerId) !== -1;\n    } else {\n      isPinned = !!dialog.pFlags.pinned;\n    }\n\n    const isDialogUnread = await middleware(this.managers.appMessagesManager.isDialogUnread(dialog));\n    const hasUnreadBadge = isPinned || isDialogUnread;\n    // dom.messageEl.classList.toggle('has-badge', hasBadge);\n\n    // * have to await all promises before modifying something\n\n    if(setLastMessagePromise) {\n      try {\n        await middleware(setLastMessagePromise);\n      } catch(err) {\n        // return;\n      }\n    }\n\n    const transitionDuration = isBatch ? 0 : 200;\n\n    if(isMuted !== wasMuted) {\n      SetTransition(dom.listEl, 'is-muted', isMuted, transitionDuration);\n    }\n\n    setSendingStatus(dom.statusSpan, setStatusMessage, true);\n\n    const isUnreadBadgeMounted = isInDOM(dom.unreadBadge);\n    if(hasUnreadBadge && !isUnreadBadgeMounted) {\n      dom.subtitleEl.append(dom.unreadBadge);\n    }\n\n    const hasMentionsBadge = dialog.unread_mentions_count && (dialog.unread_mentions_count > 1 || dialog.unread_count > 1);\n    const isMentionBadgeMounted = dom.mentionsBadge && isInDOM(dom.mentionsBadge);\n    if(hasMentionsBadge) {\n      if(!dom.mentionsBadge) {\n        dom.mentionsBadge = document.createElement('div');\n        dom.mentionsBadge.className = 'dialog-subtitle-badge badge badge-24 mention mention-badge';\n        dom.mentionsBadge.innerText = '@';\n        dom.subtitleEl.insertBefore(dom.mentionsBadge, dom.lastMessageSpan.nextSibling);\n      }\n    }\n\n    SetTransition(dom.unreadBadge, 'is-visible', hasUnreadBadge, transitionDuration, hasUnreadBadge ? undefined : () => {\n      dom.unreadBadge.remove();\n    }, !isUnreadBadgeMounted ? 2 : 0);\n\n    if(dom.mentionsBadge) {\n      SetTransition(dom.mentionsBadge, 'is-visible', hasMentionsBadge, transitionDuration, hasMentionsBadge ? undefined : () => {\n        dom.mentionsBadge.remove();\n        delete dom.mentionsBadge;\n      }, !isMentionBadgeMounted ? 2 : 0);\n    }\n\n    if(!hasUnreadBadge) {\n      deferred.resolve();\n      return;\n    }\n\n    if(isPinned) {\n      dom.unreadBadge.classList.add('tgico-chatspinned', 'tgico');\n    } else {\n      dom.unreadBadge.classList.remove('tgico-chatspinned', 'tgico');\n    }\n\n    let isUnread = true, isMention = false;\n    if(dialog.unread_mentions_count && dialog.unread_count === 1) {\n      dom.unreadBadge.innerText = '@';\n      isMention = true;\n      // dom.unreadBadge.classList.add('tgico-mention', 'tgico');\n    } else if(isDialogUnread) {\n      // dom.unreadMessagesSpan.innerText = '' + (dialog.unread_count ? formatNumber(dialog.unread_count, 1) : ' ');\n      dom.unreadBadge.innerText = '' + (dialog.unread_count || ' ');\n    } else {\n      dom.unreadBadge.innerText = '';\n      isUnread = false;\n    }\n\n    dom.unreadBadge.classList.toggle('unread', isUnread);\n    dom.unreadBadge.classList.toggle('mention', isMention);\n    deferred.resolve();\n  }\n\n  private getDialogDom(peerId: PeerId) {\n    // return this.doms[peerId];\n    const element = this.sortedList.get(peerId);\n    return element?.dom;\n  }\n\n  private async getDialog(dialog: Dialog | PeerId) {\n    if(typeof(dialog) !== 'object') {\n      const originalDialog = await this.managers.appMessagesManager.getDialogOnly(dialog);\n      if(!originalDialog) {\n        const peerId = dialog || NULL_PEER_ID;\n        return {\n          peerId,\n          peer: await this.managers.appPeersManager.getOutputPeer(peerId),\n          pFlags: {}\n        } as any as Dialog;\n      }\n\n      return originalDialog;\n    }\n\n    return dialog as Dialog;\n  }\n\n  private setCallStatus(dom: DialogDom, visible: boolean) {\n    let {callIcon, listEl} = dom;\n    if(!callIcon && visible) {\n      const {canvas, startAnimation} = dom.callIcon = callIcon = groupCallActiveIcon(listEl.classList.contains('active'));\n      canvas.classList.add('dialog-group-call-icon');\n      listEl.append(canvas);\n      startAnimation();\n    }\n\n    if(!callIcon) {\n      return;\n    }\n\n    SetTransition(dom.callIcon.canvas, 'is-visible', visible, 200, visible ? undefined : () => {\n      dom.callIcon.canvas.remove();\n      dom.callIcon = undefined;\n    }, visible ? 2 : 0);\n  }\n\n  public addListDialog(options: Parameters<AppDialogsManager['addDialogNew']>[0] & {isBatch?: boolean}) {\n    options.autonomous = false;\n\n    const ret = this.addDialogNew(options);\n\n    if(ret) {\n      const promise = this.getDialog(options.peerId).then((dialog) => {\n        const {peerId} = dialog;\n        const promises: Promise<any>[] = [];\n        if(!peerId.isUser()) {\n          promises.push(this.processDialogForCallStatus(dialog, ret.dom));\n        }\n\n        if(peerId !== rootScope.myId && peerId.isUser()) {\n          promises.push(this.managers.appUsersManager.getUser(peerId).then((user) => {\n            if(user.status?._ === 'userStatusOnline') {\n              this.setOnlineStatus(ret.dom.avatarEl, true);\n            }\n          }));\n        }\n\n        promises.push(this.setLastMessageN({\n          dialog,\n          dom: ret.dom,\n          isBatch: options.isBatch,\n          setUnread: true\n        }));\n\n        return Promise.all(promises);\n      });\n\n      if(options.loadPromises) {\n        options.loadPromises.push(promise);\n      }\n    }\n\n    return ret;\n  }\n\n  private async processDialogForCallStatus(dialog: Dialog, dom?: DialogDom) {\n    if(!IS_GROUP_CALL_SUPPORTED) {\n      return;\n    }\n\n    if(!dom) dom = this.getDialogDom(dialog.peerId);\n    if(!dom) return;\n\n    const chat: Chat.chat | Chat.channel = await this.managers.appChatsManager.getChat(dialog.peerId.toChatId());\n    this.setCallStatus(dom, !!(chat.pFlags.call_active && chat.pFlags.call_not_empty));\n  }\n\n  /**\n   * use for rendering search result\n   */\n  public addDialogAndSetLastMessage(options: Omit<Parameters<AppDialogsManager['addDialogNew']>[0], 'dialog'> & {\n    message: MyMessage,\n    peerId: PeerId,\n    query?: string\n  }) {\n    const {peerId, message, query} = options;\n    const ret = this.addDialogNew({\n      ...options,\n      ...getMessageSenderPeerIdOrName(message),\n      peerId\n    });\n\n    this.setLastMessage({_: 'dialog', peerId} as any, message, ret.dom, query);\n\n    if(message.peerId !== peerId) {\n      ret.dom.listEl.dataset.peerId = '' + message.peerId;\n    }\n\n    return ret;\n  }\n\n  public addDialogNew(options: {\n    peerId: Parameters<AppDialogsManager['addDialog']>[0],\n    container?: Parameters<AppDialogsManager['addDialog']>[1],\n    rippleEnabled?: boolean,\n    onlyFirstName?: boolean,\n    meAsSaved?: boolean,\n    append?: boolean,\n    avatarSize?: number,\n    autonomous?: boolean,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  }) {\n    return this.addDialog(options.peerId, options.container, options.rippleEnabled, options.onlyFirstName, options.meAsSaved, options.append, options.avatarSize, options.autonomous, options.lazyLoadQueue, options.loadPromises, options.fromName, options.noIcons);\n  }\n\n  public addDialog(\n    peerId: PeerId,\n    container?: HTMLElement | Scrollable | DocumentFragment | false,\n    rippleEnabled = true,\n    onlyFirstName = false,\n    meAsSaved = true,\n    append = true,\n    avatarSize = 54,\n    autonomous = !!container,\n    lazyLoadQueue?: LazyLoadQueue,\n    loadPromises?: Promise<any>[],\n    fromName?: string,\n    noIcons?: boolean\n  ) {\n    // const dialog = await this.getDialog(_dialog);\n    const avatarEl = new AvatarElement();\n    avatarEl.classList.add('dialog-avatar', 'avatar-' + avatarSize);\n    avatarEl.updateWithOptions({\n      loadPromises,\n      lazyLoadQueue,\n      isDialog: !!meAsSaved,\n      peerId,\n      peerTitle: fromName\n    });\n\n    const captionDiv = document.createElement('div');\n    captionDiv.classList.add('user-caption');\n\n    const titleSpanContainer = document.createElement('span');\n    titleSpanContainer.classList.add('user-title');\n\n    const peerTitle = new PeerTitle();\n    const peerTitlePromise = peerTitle.update({\n      peerId,\n      fromName,\n      dialog: meAsSaved,\n      onlyFirstName,\n      plainText: false,\n      withIcons: !noIcons\n    });\n\n    if(loadPromises) {\n      loadPromises.push(peerTitlePromise);\n    }\n\n    titleSpanContainer.append(peerTitle.element);\n    // p.classList.add('')\n\n    //        (  -   )\n    // if(!container) {\n\n    // for muted icon\n    titleSpanContainer.classList.add('tgico'); // *       !container,  \n\n    // const titleIconsPromise = generateTitleIcons(peerId).then((elements) => {\n    //   titleSpanContainer.append(...elements);\n    // });\n\n    // if(loadPromises) {\n    //   loadPromises.push(titleIconsPromise);\n    // }\n    // }\n\n    const span = document.createElement('span');\n    span.classList.add('user-last-message');\n    span.setAttribute('dir', 'auto');\n\n    // captionDiv.append(titleSpan);\n    // captionDiv.append(span);\n\n    const li = document.createElement(DIALOG_LIST_ELEMENT_TAG);\n    li.classList.add('chatlist-chat');\n    if(!autonomous) (li as HTMLAnchorElement).href = '#' + peerId;\n    if(rippleEnabled) {\n      ripple(li);\n    }\n\n    li.append(avatarEl, captionDiv);\n    li.dataset.peerId = '' + peerId;\n\n    const statusSpan = document.createElement('span');\n    statusSpan.classList.add('message-status', 'sending-status'/* , 'transition', 'reveal' */);\n\n    const lastTimeSpan = document.createElement('span');\n    lastTimeSpan.classList.add('message-time');\n\n    const unreadBadge = document.createElement('div');\n    unreadBadge.className = 'dialog-subtitle-badge badge badge-24';\n\n    const titleP = document.createElement('p');\n    titleP.classList.add('dialog-title');\n\n    const rightSpan = document.createElement('span');\n    rightSpan.classList.add('dialog-title-details');\n    rightSpan.append(statusSpan, lastTimeSpan);\n    titleP.append(titleSpanContainer, rightSpan);\n\n    const subtitleEl = document.createElement('p');\n    subtitleEl.classList.add('dialog-subtitle');\n    subtitleEl.append(span);\n\n    captionDiv.append(titleP, subtitleEl);\n\n    const dom: DialogDom = {\n      avatarEl,\n      captionDiv,\n      titleSpan: peerTitle.element,\n      titleSpanContainer,\n      statusSpan,\n      lastTimeSpan,\n      unreadBadge,\n      lastMessageSpan: span,\n      containerEl: li,\n      listEl: li,\n      subtitleEl\n    };\n\n    /* let good = false;\n    for(const folderId in this.chatLists) {\n      if(this.chatLists[folderId] === container) {\n        good = true;\n      }\n    } */\n    if(container) {\n      const method = append ? 'append' : 'prepend';\n      container[method](li);\n    }\n\n    if(!autonomous) {\n      // @ts-ignore\n      li.dialogDom = dom;\n\n      if(appImManager.chat?.peerId === peerId) {\n        this.setDialogActive(li, true);\n      }\n    }\n\n    return {dom};\n  }\n\n  public async setTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    const oldTypingElement = dom.lastMessageSpan.querySelector('.peer-typing-container') as HTMLElement;\n    const newTypingElement = await appImManager.getPeerTyping(dialog.peerId, oldTypingElement);\n    if(!oldTypingElement && newTypingElement) {\n      replaceContent(dom.lastMessageSpan, newTypingElement);\n      dom.lastMessageSpan.classList.add('user-typing');\n    }\n  }\n\n  public unsetTyping(dialog: Dialog) {\n    const dom = this.getDialogDom(dialog.peerId);\n    if(!dom) {\n      return;\n    }\n\n    dom.lastMessageSpan.classList.remove('user-typing');\n    this.setLastMessageN({\n      dialog,\n      lastMessage: null,\n      dom,\n      setUnread: null\n    });\n  }\n}\n\nconst appDialogsManager = new AppDialogsManager();\nMOUNT_CLASS_TO.appDialogsManager = appDialogsManager;\nexport default appDialogsManager;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {DownloadMediaOptions, DownloadOptions} from '../mtproto/apiFileManager';\r\nimport type {AppMessagesManager} from './appMessagesManager';\r\nimport type {MyDocument} from './appDocsManager';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport {InputFile, Photo, PhotoSize} from '../../layer';\r\nimport getFileNameForUpload from '../../helpers/getFileNameForUpload';\r\nimport {AppManagers} from './managers';\r\nimport rootScope from '../rootScope';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport noop from '../../helpers/noop';\r\nimport getDownloadMediaDetails from './utils/download/getDownloadMediaDetails';\r\nimport getDownloadFileNameFromOptions from './utils/download/getDownloadFileNameFromOptions';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport makeError from '../../helpers/makeError';\r\nimport createDownloadAnchor from '../../helpers/dom/createDownloadAnchor';\r\nimport {getFileNameByLocation} from '../../helpers/fileName';\r\nimport getDocumentDownloadOptions from './utils/docs/getDocumentDownloadOptions';\r\nimport getPhotoDownloadOptions from './utils/photos/getPhotoDownloadOptions';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\n\r\nexport type ResponseMethodBlob = 'blob';\r\nexport type ResponseMethodJson = 'json';\r\nexport type ResponseMethod = ResponseMethodBlob | ResponseMethodJson;\r\n\r\n/* export type DownloadBlob = {promise: Promise<Blob>, controller: AbortController};\r\nexport type DownloadJson = {promise: Promise<any>, controller: AbortController}; */\r\nexport type DownloadBlob = CancellablePromise<Blob>;\r\nexport type DownloadUrl = CancellablePromise<string>;\r\nexport type DownloadJson = CancellablePromise<any>;\r\n// export type Download = DownloadBlob/*  | DownloadJson */;\r\nexport type Download = DownloadBlob | DownloadUrl/*  | DownloadJson */;\r\n\r\nexport type Progress = {done: number, fileName: string, total: number, offset: number};\r\nexport type ProgressCallback = (details: Progress) => void;\r\n\r\ntype DownloadType = 'url' | 'blob' | 'void' | 'disc';\r\n\r\nexport class AppDownloadManager {\r\n  private downloads: {[fileName: string]: {main: Download} & {[type in DownloadType]?: Download}} = {};\r\n  // private downloadsToDisc: {[fileName: string]: Download} = {};\r\n  private progress: {[fileName: string]: Progress} = {};\r\n  // private progressCallbacks: {[fileName: string]: Array<ProgressCallback>} = {};\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    rootScope.addEventListener('download_progress', (details) => {\r\n      // const callbacks = this.progressCallbacks[details.fileName];\r\n      // if(callbacks) {\r\n      //   callbacks.forEach((callback) => callback(details));\r\n      // }\r\n\r\n      const download = this.downloads[details.fileName];\r\n      if(download?.main?.notifyAll) {\r\n        this.progress[details.fileName] = details;\r\n        download.main.notifyAll(details);\r\n      }\r\n    });\r\n  }\r\n\r\n  private getNewDeferred<T>(fileName: string, type?: DownloadType) {\r\n    const deferred = deferredPromise<T>();\r\n\r\n    let download = this.downloads[fileName];\r\n    if(!download) {\r\n      download = this.downloads[fileName] = {\r\n        main: deferred as any\r\n      };\r\n\r\n      deferred.cancel = () => {\r\n        const error = makeError('DOWNLOAD_CANCELED');\r\n\r\n        this.managers.apiFileManager.cancelDownload(fileName);\r\n\r\n        deferred.reject(error);\r\n        deferred.cancel = noop;\r\n      };\r\n\r\n      deferred.catch(() => {\r\n        this.clearDownload(fileName, type);\r\n      }).finally(() => {\r\n        delete this.progress[fileName];\r\n        // delete this.progressCallbacks[fileName];\r\n      });\r\n    } else {\r\n      const main = download.main;\r\n      (['cancel', 'addNotifyListener', 'notify', 'notifyAll'] as (keyof CancellablePromise<void>)[]).forEach((key) => {\r\n        if(!main[key]) {\r\n          return;\r\n        }\r\n\r\n        // @ts-ignore\r\n        deferred[key] = main[key].bind(main);\r\n      });\r\n    }\r\n\r\n    const haveToClear = type === 'disc';\r\n    if(haveToClear) {\r\n      deferred.catch(noop).finally(() => {\r\n        this.clearDownload(fileName, type);\r\n      });\r\n    }\r\n\r\n    return download[type] = deferred as any;\r\n  }\r\n\r\n  public getNewDeferredForUpload<T extends Promise<any>>(fileName: string, promise: T) {\r\n    const deferred = this.getNewDeferred<InputFile>(fileName);\r\n    promise.then(deferred.resolve, deferred.reject);\r\n\r\n    deferred.finally(() => {\r\n      this.clearDownload(fileName);\r\n    });\r\n\r\n    return deferred as CancellablePromise<Awaited<T>>;\r\n  }\r\n\r\n  private clearDownload(fileName: string, type?: DownloadType) {\r\n    const downloads = this.downloads[fileName];\r\n    if(!downloads) {\r\n      return;\r\n    }\r\n\r\n    delete downloads[type];\r\n\r\n    const length = Object.keys(downloads).length;\r\n    if(!length || (downloads.main && length === 1)) {\r\n      delete this.downloads[fileName];\r\n    }\r\n  }\r\n\r\n  public getUpload(fileName: string): ReturnType<AppMessagesManager['sendFile']>['promise'] {\r\n    let deferred: CancellablePromise<any> = this.getDownload(fileName);\r\n    if(deferred) {\r\n      return deferred;\r\n    }\r\n\r\n    deferred = this.getNewDeferred(fileName);\r\n    this.managers.appMessagesManager.getUploadPromise(fileName).then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  /* public fakeDownload(fileName: string, value: Blob | string) {\r\n    const deferred = this.getNewDeferred<Blob>(fileName);\r\n    if(typeof(value) === 'string') {\r\n      fetch(value)\r\n      .then((response) => response.blob())\r\n      .then((blob) => deferred.resolve(blob));\r\n    } else {\r\n      deferred.resolve(value);\r\n    }\r\n\r\n    return deferred;\r\n  } */\r\n\r\n  private d(fileName: string, getPromise: () => Promise<any>, type?: DownloadType) {\r\n    let deferred = this.getDownload(fileName, type);\r\n    if(deferred) return deferred;\r\n\r\n    deferred = this.getNewDeferred<Blob>(fileName, type);\r\n    getPromise().then(deferred.resolve, deferred.reject);\r\n    return deferred;\r\n  }\r\n\r\n  public download(options: DownloadOptions): DownloadBlob {\r\n    const fileName = getDownloadFileNameFromOptions(options);\r\n    return this.d(fileName, () => this.managers.apiFileManager.download(options), 'blob') as any;\r\n  }\r\n\r\n  public downloadMedia(options: DownloadMediaOptions, type: DownloadType = 'blob', promiseBefore?: Promise<any>): DownloadBlob {\r\n    const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n\r\n    return this.d(fileName, () => {\r\n      let cb: any;\r\n      if(type === 'url') {\r\n        cb = this.managers.apiFileManager.downloadMediaURL;\r\n      } else if(type === 'void'/*  || type === 'disc' */) {\r\n        cb = this.managers.apiFileManager.downloadMediaVoid;\r\n      } else /* if(type === 'blob') */ {\r\n        cb = this.managers.apiFileManager.downloadMedia;\r\n      }\r\n\r\n      if(promiseBefore) {\r\n        return promiseBefore.then(() => cb(options));\r\n      }\r\n\r\n      return cb(options);\r\n    }, type) as any;\r\n  }\r\n\r\n  public downloadMediaURL(options: DownloadMediaOptions): DownloadUrl {\r\n    return this.downloadMedia(options, 'url') as any;\r\n  }\r\n\r\n  public downloadMediaVoid(options: DownloadMediaOptions): DownloadBlob {\r\n    return this.downloadMedia(options, 'void');\r\n  }\r\n\r\n  public upload(file: File | Blob, fileName?: string, promise?: Promise<any>) {\r\n    if(!fileName) {\r\n      fileName = getFileNameForUpload(file);\r\n    }\r\n\r\n    if(!promise) {\r\n      promise = this.managers.apiFileManager.upload({file, fileName});\r\n    }\r\n\r\n    const deferred = this.getNewDeferredForUpload(fileName, promise);\r\n    return deferred as any as CancellablePromise<InputFile>;\r\n  }\r\n\r\n  public getDownload(fileName: string, type?: DownloadType) {\r\n    const d = this.downloads[fileName];\r\n    return d && d[type];\r\n  }\r\n\r\n  // public addProgressCallback(fileName: string, callback: ProgressCallback) {\r\n  //   const progress = this.progress[fileName];\r\n  //   (this.progressCallbacks[fileName] ?? (this.progressCallbacks[fileName] = [])).push(callback);\r\n\r\n  //   if(progress) {\r\n  //     callback(progress);\r\n  //   }\r\n  // }\r\n\r\n  public downloadToDisc(options: DownloadMediaOptions, justAttach?: boolean) {\r\n    const media = options.media;\r\n    const isDocument = media._ === 'document';\r\n    if(!isDocument && !options.thumb) {\r\n      options.thumb = (media as Photo.photo).sizes.slice().pop() as PhotoSize.photoSize;\r\n    }\r\n\r\n    // const {fileName: cacheFileName} = getDownloadMediaDetails(options);\r\n    // if(justAttach) {\r\n    //   const promise = this.downloadsToDisc[cacheFileName];\r\n    //   if(promise) {\r\n    //     return promise;\r\n    //   }\r\n    // }\r\n\r\n    // const {downloadOptions, fileName} = getDownloadMediaDetails(options);\r\n    // if(downloadOptions.size && downloadOptions.size > MAX_FILE_SAVE_SIZE) {\r\n    const id = '' + (Math.random() * 0x7FFFFFFF | 0);\r\n    // const id = 'test';\r\n    const url = `download/${id}`;\r\n    options.downloadId = id;\r\n\r\n    const pingPromise = apiManagerProxy.pingServiceWorkerWithIframe();\r\n\r\n    const promise = this.downloadMedia(options, 'disc', pingPromise);\r\n    // this.downloadsToDisc[cacheFileName] = promise;\r\n\r\n    if(justAttach) {\r\n      return promise;\r\n    }\r\n\r\n    const iframe = document.createElement('iframe');\r\n    iframe.hidden = true;\r\n\r\n    pingPromise.then(() => {\r\n      iframe.src = url;\r\n      document.body.append(iframe);\r\n    });\r\n\r\n    // createDownloadAnchor(url, 'asd.txt');\r\n\r\n    // const events = [\r\n    //   'emptied',\r\n    //   'abort',\r\n    //   'suspend',\r\n    //   'reset',\r\n    //   'error',\r\n    //   'ended',\r\n    //   'load'\r\n    // ].forEach((event) => {\r\n    //   iframe.addEventListener(event, () => alert(event));\r\n    //   iframe.contentWindow.addEventListener(event, () => alert(event));\r\n    // });\r\n\r\n    let element: HTMLElement, hadProgress = false;\r\n    const onProgress = () => {\r\n      if(hadProgress) {\r\n        return;\r\n      }\r\n\r\n      hadProgress = true;\r\n      element = iframe;\r\n\r\n      indexOfAndSplice(promise.listeners, onProgress);\r\n    };\r\n\r\n    promise.addNotifyListener(onProgress);\r\n    promise.then((blob) => {\r\n      if(!blob) {\r\n        return;\r\n      }\r\n\r\n      const url = URL.createObjectURL(blob);\r\n      const downloadOptions = isDocument ?\r\n        getDocumentDownloadOptions(media) :\r\n        getPhotoDownloadOptions(media as any, options.thumb as PhotoSize.photoSize);\r\n      const fileName = (options.media as MyDocument).file_name || getFileNameByLocation(downloadOptions.location);\r\n      createDownloadAnchor(url, downloadOptions.fileName || fileName, () => {\r\n        URL.revokeObjectURL(url);\r\n      });\r\n    }).catch(noop).finally(() => {\r\n      if(!hadProgress) {\r\n        onProgress();\r\n      }\r\n\r\n      setTimeout(() => {\r\n        element?.remove();\r\n      }, 1000);\r\n\r\n      // if(this.downloadsToDisc[cacheFileName] === promise) {\r\n      //   delete this.downloadsToDisc[cacheFileName];\r\n      // }\r\n    });\r\n\r\n    return promise;\r\n  }\r\n}\r\n\r\nconst appDownloadManager = new AppDownloadManager();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appDownloadManager = appDownloadManager);\r\nexport default appDownloadManager;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function createDownloadAnchor(url: string, fileName: string, onRemove?: () => void) {\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = fileName;\n  a.target = '_blank';\n\n  a.style.position = 'absolute';\n  a.style.top = '1px';\n  a.style.left = '1px';\n\n  document.body.append(a);\n\n  try {\n    const clickEvent = document.createEvent('MouseEvents');\n    clickEvent.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    a.dispatchEvent(clickEvent);\n  } catch(e) {\n    console.error('Download click error', e);\n    try {\n      a.click();\n    } catch(e) {\n      window.open(url as string, '_blank');\n    }\n  }\n\n  setTimeout(() => {\n    a.remove();\n    onRemove && onRemove();\n  }, 100);\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport rootScope from '../../lib/rootScope';\r\n// import { generatePathData } from \"../../helpers/dom\";\r\nimport {MyMessage} from '../../lib/appManagers/appMessagesManager';\r\nimport type Chat from './chat';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\r\nimport AvatarElement from '../avatar';\r\nimport {Message} from '../../layer';\r\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {SERVICE_AS_REGULAR, STICKY_OFFSET} from './bubbles';\r\nimport forEachReverse from '../../helpers/array/forEachReverse';\r\nimport partition from '../../helpers/array/partition';\r\n\r\ntype GroupItem = {\r\n  bubble: HTMLElement,\r\n  fromId: PeerId,\r\n  mid: number,\r\n  groupMid?: number,\r\n  timestamp: number,\r\n  dateTimestamp: number,\r\n  mounted: boolean,\r\n  single: boolean,\r\n  group?: BubbleGroup,\r\n  message: Message.message | Message.messageService // use it only to set avatar\r\n};\r\n\r\nclass BubbleGroup {\r\n  container: HTMLElement;\r\n  chat: Chat;\r\n  groups: BubbleGroups;\r\n  items: GroupItem[]; // descend sorted\r\n  avatarContainer: HTMLElement;\r\n  avatarLoadPromise: ReturnType<AvatarElement['updateWithOptions']>;\r\n  avatar: AvatarElement;\r\n  mounted: boolean;\r\n  dateTimestamp: number;\r\n  offset: number;\r\n\r\n  constructor(chat: Chat, groups: BubbleGroups, dateTimestamp: number) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('bubbles-group');\r\n    this.chat = chat;\r\n    this.groups = groups;\r\n    this.items = [];\r\n    this.dateTimestamp = dateTimestamp;\r\n    this.offset = 0;\r\n  }\r\n\r\n  createAvatar(message: Message.message | Message.messageService) {\r\n    if(this.avatarLoadPromise) {\r\n      return this.avatarLoadPromise;\r\n    } else if(message._ === 'messageService') {\r\n      return;\r\n    }\r\n\r\n    this.avatarContainer = document.createElement('div');\r\n    this.avatarContainer.classList.add('bubbles-group-avatar-container');\r\n    ++this.offset;\r\n\r\n    const fwdFrom = message.fwd_from;\r\n    const fwdFromId = message.fwdFromId;\r\n    const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\r\n    const currentPeerId = this.chat.peerId;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    this.avatar.classList.add('bubbles-group-avatar', 'user-avatar', 'avatar-40'/* , 'can-zoom-fade' */);\r\n    const peerId = ((fwdFrom && (currentPeerId === rootScope.myId || currentPeerId === REPLIES_PEER_ID)) || isForwardFromChannel ? fwdFromId : message.fromId) || NULL_PEER_ID;\r\n    const avatarLoadPromise = this.avatar.updateWithOptions({\r\n      lazyLoadQueue: this.chat.bubbles.lazyLoadQueue,\r\n      peerId,\r\n      peerTitle: !fwdFromId && fwdFrom && fwdFrom.from_name ? /* ' FF ' */fwdFrom.from_name : undefined\r\n    });\r\n\r\n    // this.avatarLoadPromise = Promise.all([\r\n    //   avatarLoadPromise,\r\n    //   peerId && peerId.isUser() ? this.chat.managers.appUsersManager.getUser(peerId.toUserId()) : undefined\r\n    // ]).then(([result, user]) => {\r\n    //   if(user?.pFlags?.premium) {\r\n    //     avatar.classList.add('is-premium', 'tgico-star');\r\n    //   }\r\n\r\n    //   return result;\r\n    // });\r\n    this.avatarLoadPromise = avatarLoadPromise;\r\n\r\n    this.avatarContainer.append(this.avatar);\r\n    this.container.append(this.avatarContainer);\r\n\r\n    return this.avatarLoadPromise;\r\n  }\r\n\r\n  get firstTimestamp() {\r\n    return this.firstItem.timestamp;\r\n  }\r\n\r\n  get firstMid() {\r\n    return this.firstItem.mid;\r\n  }\r\n\r\n  get firstItem() {\r\n    return this.items[this.items.length - 1];\r\n  }\r\n\r\n  get lastTimestamp() {\r\n    return this.lastItem.timestamp;\r\n  }\r\n\r\n  get lastMid() {\r\n    return this.lastItem.mid;\r\n  }\r\n\r\n  get lastItem() {\r\n    return this.items[0];\r\n  }\r\n\r\n  updateClassNames() {\r\n    const items = this.items;\r\n    const length = items.length;\r\n    if(!length) {\r\n      return;\r\n    }\r\n\r\n    // const elements = Array.from(this.container.children);\r\n    // if(this.offset) elements.splice(0, this.offset);\r\n\r\n    // const length = elements.length;\r\n    // if(!length) {\r\n    //   return;\r\n    // }\r\n\r\n    const first = items[length - 1].bubble;\r\n\r\n    if(items.length === 1) {\r\n      first.classList.add('is-group-first', 'is-group-last');\r\n      // this.setClipIfNeeded(first);\r\n      return;\r\n    } else {\r\n      first.classList.remove('is-group-last');\r\n      first.classList.add('is-group-first');\r\n      // this.setClipIfNeeded(first, true);\r\n    }\r\n\r\n    for(let i = 1, _length = length - 1; i < _length; ++i) {\r\n      const bubble = items[i].bubble;\r\n      bubble.classList.remove('is-group-last', 'is-group-first');\r\n      // this.setClipIfNeeded(bubble, true);\r\n    }\r\n\r\n    const last = items[0].bubble;\r\n    last.classList.remove('is-group-first');\r\n    last.classList.add('is-group-last');\r\n    // this.setClipIfNeeded(last);\r\n  }\r\n\r\n  insertItem(item: GroupItem) {\r\n    const {items} = this;\r\n    insertInDescendSortedArray(items, item, this.groups.sortGroupItemsKey);\r\n\r\n    item.group = this;\r\n    if(items.length === 1) {\r\n      this.groups.insertGroup(this);\r\n    }\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    indexOfAndSplice(this.items, item);\r\n\r\n    if(!this.items.length) {\r\n      indexOfAndSplice(this.groups.groups, this);\r\n    }\r\n\r\n    item.group = undefined;\r\n  }\r\n\r\n  mount(updateClassNames?: boolean) {\r\n    if(!this.groups.groups.includes(this) || !this.items.length) { // group can be already removed\r\n      debugger;\r\n\r\n      if(this.mounted) {\r\n        this.onItemUnmount();\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    const {offset, items} = this;\r\n    const {length} = items;\r\n    forEachReverse(items, (item, idx) => {\r\n      this.mountItem(item, length - 1 - idx, offset);\r\n    });\r\n\r\n    if(updateClassNames) {\r\n      this.updateClassNames();\r\n    }\r\n\r\n    this.onItemMount();\r\n  }\r\n\r\n  mountItem(item: GroupItem, idx = this.items.indexOf(item), offset = this.offset) {\r\n    if(item.mounted) {\r\n      return;\r\n    }\r\n\r\n    positionElementByIndex(item.bubble, this.container, offset + idx);\r\n    item.mounted = true;\r\n  }\r\n\r\n  unmountItem(item: GroupItem) {\r\n    if(!item.mounted) {\r\n      return;\r\n    }\r\n\r\n    item.bubble.remove();\r\n    item.mounted = false;\r\n    this.onItemUnmount();\r\n  }\r\n\r\n  onItemMount() {\r\n    if(this.mounted) {\r\n      return;\r\n    }\r\n\r\n    const dateContainer = this.chat.bubbles.getDateContainerByTimestamp(this.dateTimestamp / 1000);\r\n    // const idx = this.groups.indexOf(group);\r\n    const dateGroups = this.groups.groups.filter((_group) => _group.dateTimestamp === this.dateTimestamp);\r\n    const dateGroupsLength = dateGroups.length;\r\n    const idx = dateGroups.indexOf(this);\r\n    const unmountedLength = dateGroups.slice(idx + 1).reduce((acc, v) => acc + (v.mounted ? 0 : 1), 0);\r\n    positionElementByIndex(this.container, dateContainer.container, STICKY_OFFSET + dateGroupsLength - 1 - idx - unmountedLength);\r\n    this.mounted = true;\r\n  }\r\n\r\n  onItemUnmount() {\r\n    if(!this.mounted) {\r\n      return;\r\n    }\r\n\r\n    if(!this.items.length) {\r\n      this.container.remove();\r\n      this.chat.bubbles.deleteEmptyDateGroups();\r\n      this.mounted = false;\r\n    } else {\r\n      this.updateClassNames();\r\n    }\r\n  }\r\n}\r\n\r\n// class BubbleGroupItem implements GroupItem {\r\n//   bubble: HTMLElement;\r\n//   fromId: PeerId;\r\n//   mid: number;\r\n//   timestamp: number;\r\n//   dateTimestamp: number;\r\n//   mounted: boolean;\r\n//   single: boolean;\r\n//   group: BubbleGroup;\r\n\r\n//   constructor(details: GroupItem) {\r\n//     Object.assign(this, details);\r\n//   }\r\n// }\r\n\r\nexport default class BubbleGroups {\r\n  public itemsArr: Array<GroupItem> = []; // descend sorted\r\n  private itemsMap: Map<HTMLElement, GroupItem> = new Map();\r\n  public groups: Array<BubbleGroup> = []; // descend sorted\r\n  private newGroupDiff = 121; // * 121 in scheduled messages\r\n  private sortItemsKey: Extract<keyof GroupItem, 'timestamp' | 'mid'>;\r\n  private sortGroupsKey: Extract<keyof BubbleGroup, 'lastMid' | 'lastTimestamp'>;\r\n  public sortGroupItemsKey: Extract<keyof GroupItem, 'groupMid' | 'timestamp'>;\r\n\r\n  constructor(private chat: Chat) {\r\n    this.sortItemsKey = chat.type === 'scheduled' ? 'timestamp' : 'mid';\r\n    this.sortGroupsKey = chat.type === 'scheduled' ? 'lastTimestamp' : 'lastMid';\r\n    this.sortGroupItemsKey = /* chat.type === 'scheduled' ? 'timestamp' :  */'groupMid';\r\n  }\r\n\r\n  removeItem(item: GroupItem) {\r\n    item.group.removeItem(item);\r\n    this.removeItemFromCache(item);\r\n  }\r\n\r\n  removeAndUnmountBubble(bubble: HTMLElement) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    const items = this.itemsArr;\r\n    const index = items.indexOf(item);\r\n    const siblings = this.getSiblingsAtIndex(index, items);\r\n\r\n    const group = item.group;\r\n    this.removeItem(item);\r\n    group.unmountItem(item);\r\n\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    modifiedGroups.add(group);\r\n\r\n    const [previousSibling, nextSibling] = siblings;\r\n    if(\r\n      previousSibling &&\r\n      nextSibling &&\r\n      this.canItemsBeGrouped(previousSibling, nextSibling) &&\r\n      previousSibling.group !== nextSibling.group\r\n    ) {\r\n      const group = nextSibling.group;\r\n      this.f(nextSibling.group.items);\r\n      group.onItemUnmount();\r\n      modifiedGroups.add(previousSibling.group);\r\n      this.groupUngrouped();\r\n    }\r\n\r\n    this.mountUnmountGroups(Array.from(modifiedGroups));\r\n  }\r\n\r\n  mountUnmountGroups(groups: BubbleGroup[]) {\r\n    // groups.sort((a, b) => (b.lastItem?.mid ?? 0) - (a.lastItem?.mid ?? 0));\r\n\r\n    const [toMount, toUnmount] = partition(groups, (group) => !!group.items.length);\r\n    toUnmount.forEach((group) => {\r\n      group.onItemUnmount();\r\n    })\r\n\r\n    toMount.forEach((group) => {\r\n      group.mount(true);\r\n    });\r\n\r\n    // toMount.forEach((group) => {\r\n    //   group.updateClassNames();\r\n    // });\r\n  }\r\n\r\n  f(items: GroupItem[], index: number = 0, length = items.length) {\r\n    for(; index < length; ++index) {\r\n      const item = items[index];\r\n      item.mounted = false;\r\n      item.group.removeItem(item);\r\n      --length;\r\n      --index;\r\n    }\r\n  }\r\n\r\n  getItemByBubble(bubble: HTMLElement) {\r\n    return this.itemsMap.get(bubble);\r\n  }\r\n\r\n  getLastGroup() {\r\n    return this.groups[0];\r\n  }\r\n\r\n  changeBubbleMid(bubble: HTMLElement, mid: number) {\r\n    const item = this.getItemByBubble(bubble);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    item.mid = mid;\r\n\r\n    // indexOfAndSplice(item.group.items, item);\r\n    // // const canChangeGroupMid = !item.group.items.length || item.group.items.every((item) => item.groupMid === item.mid);\r\n    // // if(canChangeGroupMid) item.groupMid = mid;\r\n    // item.group.insertItem(item);\r\n\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.insertItemToArray(item, this.itemsArr);\r\n  }\r\n\r\n  changeItemBubble(item: GroupItem, bubble: HTMLElement) {\r\n    this.itemsMap.delete(item.bubble);\r\n    item.bubble = bubble;\r\n    this.itemsMap.set(bubble, item);\r\n  }\r\n\r\n  changeBubbleByBubble(from: HTMLElement, to: HTMLElement) {\r\n    const item = this.getItemByBubble(from);\r\n    if(!item) {\r\n      return;\r\n    }\r\n\r\n    this.changeItemBubble(item, to);\r\n  }\r\n\r\n  canItemsBeGrouped(item1: GroupItem, item2: GroupItem) {\r\n    return item2.fromId === item1.fromId &&\r\n      Math.abs(item2.timestamp - item1.timestamp) <= this.newGroupDiff &&\r\n      item1.dateTimestamp === item2.dateTimestamp &&\r\n      !item1.single &&\r\n      !item2.single;\r\n  }\r\n\r\n  getSiblingsAtIndex(itemIndex: number, items: GroupItem[]) {\r\n    return [items[itemIndex - 1], items[itemIndex + 1]] as const;\r\n  }\r\n\r\n  // findGroupSiblingInSiblings(item: GroupItem, siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n  //   return siblings.find((sibling) => sibling && this.canItemsBeGrouped(item, sibling));\r\n  // }\r\n\r\n  findGroupSiblingByItem(item: GroupItem, items: GroupItem[]) {\r\n    items = items.slice();\r\n    const idx = this.insertItemToArray(item, items);\r\n    // return this.findGroupSiblingInSiblings(item, this.getSiblingsAtIndex(idx, items));\r\n    return this.findGroupSiblingInItems(item, items, idx);\r\n  }\r\n\r\n  findGroupSiblingInItems(item: GroupItem, items: GroupItem[], index = items.indexOf(item), length = items.length) {\r\n    const previousItem = items[index - 1];\r\n    let siblingGroupedItem: GroupItem;\r\n    if(previousItem?.group && this.canItemsBeGrouped(item, previousItem)) {\r\n      siblingGroupedItem = previousItem;\r\n    } else {\r\n      for(let k = index + 1; k < length; ++k) {\r\n        const nextItem = items[k];\r\n        if(this.canItemsBeGrouped(item, nextItem)) {\r\n          if(nextItem.group) {\r\n            siblingGroupedItem = nextItem;\r\n          }\r\n        } else {\r\n          break;\r\n        }\r\n      }\r\n    }\r\n\r\n    return siblingGroupedItem;\r\n  }\r\n\r\n  addItemToGroup(item: GroupItem, group: BubbleGroup) {\r\n    group.insertItem(item);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  insertItemToArray(item: GroupItem, array: GroupItem[]) {\r\n    return insertInDescendSortedArray(array, item, this.sortItemsKey);\r\n  }\r\n\r\n  insertGroup(group: BubbleGroup) {\r\n    return insertInDescendSortedArray(this.groups, group, this.sortGroupsKey);\r\n  }\r\n\r\n  addItemToCache(item: GroupItem) {\r\n    this.insertItemToArray(item, this.itemsArr);\r\n    this.itemsMap.set(item.bubble, item);\r\n  }\r\n\r\n  removeItemFromCache(item: GroupItem) {\r\n    indexOfAndSplice(this.itemsArr, item);\r\n    this.itemsMap.delete(item.bubble);\r\n  }\r\n\r\n  getMessageFromId(message: MyMessage) {\r\n    let fromId = message.viaBotId || message.fromId;\r\n\r\n    // fix for saved messages forward to self\r\n    if(fromId === rootScope.myId && message.peerId === rootScope.myId && (message as Message.message).fwdFromId === fromId) {\r\n      fromId = fromId.toPeerId(true);\r\n    }\r\n\r\n    return fromId;\r\n  }\r\n\r\n  createItem(bubble: HTMLElement, message: MyMessage) {\r\n    const single = !(message._ === 'message' || (message.action && SERVICE_AS_REGULAR.has(message.action._)));\r\n    const {mid, date: timestamp} = message;\r\n    const {dateTimestamp} = this.chat.bubbles.getDateForDateContainer(timestamp);\r\n    const item: GroupItem = {\r\n      mid,\r\n      groupMid: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : mid,\r\n      fromId: this.getMessageFromId(message),\r\n      bubble,\r\n      // timestamp: this.chat.type === 'scheduled' ? +`${(timestamp * 1000 - dateTimestamp) / 1000}.${mid}` : timestamp,\r\n      timestamp,\r\n      dateTimestamp,\r\n      mounted: false,\r\n      single,\r\n      message\r\n    };\r\n\r\n    return item;\r\n  }\r\n\r\n  splitSiblingsOnGrouping(siblings: ReturnType<BubbleGroups['getSiblingsAtIndex']>) {\r\n    const [previousSibling, nextSibling] = siblings;\r\n    const previousGroup = previousSibling?.group;\r\n    const nextGroup = nextSibling?.group;\r\n\r\n    if(!previousGroup) {\r\n      return;\r\n    }\r\n\r\n    // will refresh group\r\n    // if(previousGroup === nextGroup) {\r\n    const items = previousGroup.items;\r\n    const index = items.indexOf(previousSibling) + 1;\r\n    const length = items.length;\r\n    if(index === length) {\r\n      return;\r\n    }\r\n\r\n    const modifiedGroups: BubbleGroup[] = [previousGroup];\r\n    // if(previousGroup !== nextGroup && nextGroup) {\r\n    //   modifiedGroups.push(nextGroup);\r\n    // }\r\n\r\n    this.f(items, index, length);\r\n    return modifiedGroups;\r\n    // }\r\n  }\r\n\r\n  prepareForGrouping(bubble: HTMLElement, message: MyMessage) {\r\n    const foundItem = this.getItemByBubble(bubble);\r\n    if(foundItem) { // should happen only on edit\r\n      // debugger;\r\n      return;\r\n    }\r\n\r\n    const item = this.createItem(bubble, message);\r\n    this.addItemToCache(item);\r\n  }\r\n\r\n  groupUngrouped() {\r\n    const items = this.itemsArr;\r\n    const length = items.length;\r\n    const modifiedGroups: Set<BubbleGroup> = new Set();\r\n    // for(let i = length - 1; i >= 0; --i) {\r\n    for(let i = 0; i < length; ++i) {\r\n      const item = items[i];\r\n      if(item.group) {\r\n        continue;\r\n      }\r\n\r\n      let hadGroup = true;\r\n      const siblings = this.getSiblingsAtIndex(i, items);\r\n      const siblingGroupedItem = this.findGroupSiblingInItems(item, items, i, length);\r\n\r\n      // const foundItem = this.findGroupSiblingInSiblings(item, siblings);\r\n      const foundItem = siblingGroupedItem;\r\n      const group = foundItem?.group ?? (hadGroup = false, new BubbleGroup(this.chat, this, item.dateTimestamp));\r\n\r\n      modifiedGroups.add(group);\r\n      group.insertItem(item);\r\n\r\n      if(!hadGroup) {\r\n        const splittedGroups = this.splitSiblingsOnGrouping(siblings);\r\n        if(splittedGroups) {\r\n          splittedGroups.forEach((group) => modifiedGroups.add(group));\r\n        }\r\n      }\r\n    }\r\n\r\n    return modifiedGroups;\r\n  }\r\n\r\n  // addBubble(bubble: HTMLElement, message: MyMessage, unmountIfFound?: boolean) {\r\n  //   const oldItem = this.getItemByBubble(bubble);\r\n  //   if(unmountIfFound) { // updating position\r\n  //     this.removeAndUnmountBubble(bubble);\r\n  //   } else if(oldItem) { // editing\r\n  //     const group = oldItem.group;\r\n  //     this.changeItemBubble(oldItem, bubble);\r\n  //     oldItem.mounted = false;\r\n\r\n  //     return {item: oldItem, group};\r\n  //   }\r\n\r\n  //   const item = this.createItem(bubble, message);\r\n\r\n  //   const foundItem = this.findSameGroupItem(item, this.itemsArr);\r\n\r\n  //   const group = foundItem?.group ?? new BubbleGroup(this.chat, this, item.dateTimestamp);\r\n  //   this.addItemToGroup(item, group);\r\n\r\n  //   return {item, group};\r\n  // }\r\n\r\n  /* setClipIfNeeded(bubble: HTMLDivElement, remove = false) {\r\n    //console.log('setClipIfNeeded', bubble, remove);\r\n    const className = bubble.className;\r\n    if(className.includes('is-message-empty') && (className.includes('photo') || className.includes('video'))) {\r\n      let container = bubble.querySelector('.bubble__media-container') as SVGSVGElement;\r\n      //console.log('setClipIfNeeded', bubble, remove, container);\r\n      if(!container) return;\r\n\r\n      try {\r\n        Array.from(container.children).forEach((object) => {\r\n          if(object instanceof SVGDefsElement) return;\r\n\r\n          if(remove) {\r\n            object.removeAttributeNS(null, 'clip-path');\r\n          } else {\r\n            let clipId = container.dataset.clipId;\r\n            let path = container.firstElementChild.firstElementChild.lastElementChild as SVGPathElement;\r\n            let width = +object.getAttributeNS(null, 'width');\r\n            let height = +object.getAttributeNS(null, 'height');\r\n            let isOut = className.includes('is-out');\r\n            let isReply = className.includes('is-reply');\r\n            let d = '';\r\n\r\n            //console.log('setClipIfNeeded', object, width, height, isOut);\r\n\r\n            let tr: number, tl: number;\r\n            if(className.includes('forwarded') || isReply) {\r\n              tr = tl = 0;\r\n            } else if(isOut) {\r\n              tr = className.includes('is-group-first') ? 12 : 6;\r\n              tl = 12;\r\n            } else {\r\n              tr = 12;\r\n              tl = className.includes('is-group-first') ? 12 : 6;\r\n            }\r\n\r\n            if(isOut) {\r\n              d = generatePathData(0, 0, width - 9, height, tl, tr, 0, 12);\r\n            } else {\r\n              d = generatePathData(9, 0, width - 9, height, tl, tr, 12, 0);\r\n            }\r\n\r\n            path.setAttributeNS(null, 'd', d);\r\n            object.setAttributeNS(null, 'clip-path', 'url(#' + clipId + ')');\r\n          }\r\n        });\r\n      } catch(err) {}\r\n    }\r\n  } */\r\n\r\n  // updateGroupByMessageId(mid: number) {\r\n  //   const item = this.itemsArr.find((g) => g.mid === mid);\r\n  //   if(item) {\r\n  //     item.group.updateGroup();\r\n  //   }\r\n  // }\r\n\r\n  cleanup() {\r\n    this.itemsArr = [];\r\n    this.groups = [];\r\n    this.itemsMap.clear();\r\n  }\r\n\r\n  // findIncorrentPositions() {\r\n  //   var bubbles = Array.from(this.chat.bubbles.chatInner.querySelectorAll('.bubbles-group .bubble')).reverse();\r\n  //   var items = this.itemsArr;\r\n  //   for(var i = 0, length = items.length; i < length; ++i) {\r\n  //     const item = items[i];\r\n  //     const foundBubble = bubbles[i];\r\n  //     if(item.bubble !== foundBubble) {\r\n  //       console.log('incorrect position', i, item, foundBubble);\r\n  //       // debugger;\r\n  //       // break;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function partition<T>(arr: T[], callback: (item: T, idx: number, arr: T[]) => boolean) {\n  const good: T[] = [], bad: T[] = [];\n  for(let i = 0, length = arr.length; i < length; ++i) {\n    const item = arr[i];\n    (callback(item, i, arr) ? good : bad).push(item);\n  }\n\n  return [good, bad];\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {PopupOptions} from '.';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\nimport InputField from '../inputField';\r\n\r\nexport default class PopupDatePicker extends PopupElement {\r\n  protected controlsDiv: HTMLElement;\r\n  protected monthTitle: HTMLElement;\r\n  protected prevBtn: HTMLElement;\r\n  protected nextBtn: HTMLElement;\r\n\r\n  protected monthsContainer: HTMLElement;\r\n  protected month: HTMLElement;\r\n\r\n  protected minMonth: Date;\r\n  protected maxMonth: Date;\r\n  protected minDate: Date;\r\n  protected maxDate: Date;\r\n  protected selectedDate: Date;\r\n  protected selectedMonth: Date;\r\n  protected selectedEl: HTMLElement;\r\n\r\n  protected timeDiv: HTMLDivElement;\r\n  protected hoursInputField: InputField;\r\n  protected minutesInputField: InputField;\r\n\r\n  constructor(initDate: Date, public onPick: (timestamp: number) => void, protected options: Partial<{\r\n    noButtons: true,\r\n    noTitle: true,\r\n    minDate: Date,\r\n    maxDate: Date\r\n    withTime: true,\r\n    showOverflowMonths: true\r\n  }> & PopupOptions = {}) {\r\n    super('popup-date-picker', {\r\n      body: true,\r\n      overlayClosable: true,\r\n      buttons: options.noButtons ? [] : [{\r\n        langKey: 'JumpToDate',\r\n        callback: () => {\r\n          if(this.onPick) {\r\n            this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n          }\r\n        }\r\n      }, {\r\n        langKey: 'Cancel',\r\n        isCancel: true\r\n      }],\r\n      title: true,\r\n      ...options\r\n    });\r\n\r\n    this.minDate = options.minDate || new Date('2013-08-01T00:00:00');\r\n\r\n    if(initDate < this.minDate) {\r\n      initDate.setFullYear(this.minDate.getFullYear(), this.minDate.getMonth(), this.minDate.getDate());\r\n    }\r\n\r\n    // Controls\r\n    this.controlsDiv = document.createElement('div');\r\n    this.controlsDiv.classList.add('date-picker-controls');\r\n\r\n    this.prevBtn = document.createElement('button');\r\n    this.prevBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-prev');\r\n    attachClickEvent(this.prevBtn, this.onPrevClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.nextBtn = document.createElement('button');\r\n    this.nextBtn.classList.add('btn-icon', 'tgico-down', 'date-picker-next');\r\n    attachClickEvent(this.nextBtn, this.onNextClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.monthTitle = document.createElement('div');\r\n    this.monthTitle.classList.add('date-picker-month-title');\r\n\r\n    this.controlsDiv.append(this.prevBtn, this.monthTitle, this.nextBtn);\r\n\r\n    // Month\r\n    this.monthsContainer = document.createElement('div');\r\n    this.monthsContainer.classList.add('date-picker-months');\r\n    attachClickEvent(this.monthsContainer, this.onDateClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.body.append(this.controlsDiv, this.monthsContainer);\r\n\r\n    // Time inputs\r\n    if(options.withTime) {\r\n      this.timeDiv = document.createElement('div');\r\n      this.timeDiv.classList.add('date-picker-time');\r\n\r\n      const delimiter = document.createElement('div');\r\n      delimiter.classList.add('date-picker-time-delimiter');\r\n      delimiter.append(':');\r\n\r\n      const handleTimeInput = (max: number, inputField: InputField, onInput: (length: number) => void, onOverflow?: (number: number) => void) => {\r\n        const maxString = '' + max;\r\n        this.listenerSetter.add(inputField.input)('input', (e) => {\r\n          let value = inputField.value.replace(/\\D/g, '');\r\n          if(value.length > 2) {\r\n            value = value.slice(0, 2);\r\n          } else {\r\n            if((value.length === 1 && +value[0] > +maxString[0]) || (value.length === 2 && +value > max)) {\r\n              if(value.length === 2 && onOverflow) {\r\n                onOverflow(+value[1]);\r\n              }\r\n\r\n              value = '0' + value[0];\r\n            }\r\n          }\r\n\r\n          inputField.setValueSilently(value);\r\n          onInput(value.length);\r\n        });\r\n      };\r\n\r\n      this.hoursInputField = new InputField({plainText: true});\r\n      this.minutesInputField = new InputField({plainText: true});\r\n\r\n      handleTimeInput(23, this.hoursInputField, (length) => {\r\n        if(length === 2) {\r\n          this.minutesInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      }, (number) => {\r\n        this.minutesInputField.value = (number + this.minutesInputField.value).slice(0, 2);\r\n      });\r\n      handleTimeInput(59, this.minutesInputField, (length) => {\r\n        if(!length) {\r\n          this.hoursInputField.input.focus();\r\n        }\r\n\r\n        this.setTimeTitle();\r\n      });\r\n\r\n      this.selectedDate = initDate;\r\n\r\n      initDate.setMinutes(initDate.getMinutes() + 10);\r\n\r\n      this.hoursInputField.setValueSilently(('0' + initDate.getHours()).slice(-2));\r\n      this.minutesInputField.setValueSilently(('0' + initDate.getMinutes()).slice(-2));\r\n\r\n      initDate.setHours(0, 0, 0, 0);\r\n\r\n      this.timeDiv.append(this.hoursInputField.container, delimiter, this.minutesInputField.container);\r\n\r\n      attachClickEvent(this.btnConfirm, () => {\r\n        if(this.onPick) {\r\n          this.selectedDate.setHours(+this.hoursInputField.value || 0, +this.minutesInputField.value || 0, 0, 0);\r\n          this.onPick(this.selectedDate.getTime() / 1000 | 0);\r\n        }\r\n\r\n        this.hide();\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.body.append(this.timeDiv);\r\n\r\n      this.prevBtn.classList.add('primary');\r\n      this.nextBtn.classList.add('primary');\r\n    }\r\n\r\n    const popupCenterer = document.createElement('div');\r\n    popupCenterer.classList.add('popup-centerer');\r\n    popupCenterer.append(this.container);\r\n    this.element.append(popupCenterer);\r\n\r\n    // const passed = (initDate.getTime() - (initDate.getTimezoneOffset() * 60000)) % 86400000;\r\n    // this.selectedDate = this.maxDate = new Date(initDate.getTime() - passed);\r\n    initDate.setHours(0, 0, 0, 0);\r\n    this.selectedDate = initDate;\r\n\r\n    this.maxDate = options.maxDate || new Date();\r\n    this.maxDate.setHours(0, 0, 0, 0);\r\n\r\n    this.selectedMonth = new Date(this.selectedDate);\r\n    this.selectedMonth.setDate(1);\r\n\r\n    this.maxMonth = new Date(this.maxDate);\r\n    this.maxMonth.setDate(1);\r\n\r\n    this.minMonth = new Date(this.minDate);\r\n    this.minMonth.setHours(0, 0, 0, 0);\r\n    this.minMonth.setDate(1);\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(options.noTitle) {\r\n      this.setTitle = () => {};\r\n    }\r\n\r\n    this.setTimeTitle();\r\n    this.setTitle();\r\n    this.setMonth();\r\n  }\r\n\r\n  onPrevClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() - 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.minMonth.getTime()) {\r\n      this.prevBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.nextBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onNextClick = (e: MouseEvent) => {\r\n    this.selectedMonth.setMonth(this.selectedMonth.getMonth() + 1);\r\n    this.setMonth();\r\n\r\n    if(this.selectedMonth.getTime() === this.maxMonth.getTime()) {\r\n      this.nextBtn.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    this.prevBtn.removeAttribute('disabled');\r\n  };\r\n\r\n  onDateClick = (e: MouseEvent) => {\r\n    // cancelEvent(e);\r\n    const target = e.target as HTMLElement;\r\n\r\n    if(!target.dataset.timestamp) return;\r\n\r\n    if(this.selectedEl) {\r\n      if(this.selectedEl === target) return;\r\n      this.selectedEl.classList.remove('active');\r\n    }\r\n\r\n    this.selectedEl = target;\r\n\r\n    target.classList.add('active');\r\n    const timestamp = +target.dataset.timestamp;\r\n\r\n    this.selectedDate = new Date(timestamp);\r\n\r\n    this.setTitle();\r\n    this.setTimeTitle();\r\n  };\r\n\r\n  public setTimeTitle() {\r\n    if(this.btnConfirm && this.selectedDate) {\r\n      let key: LangPackKey;\r\n      const args: FormatterArguments = [];\r\n      const date = new Date();\r\n      date.setHours(0, 0, 0, 0);\r\n\r\n      const timeOptions: Intl.DateTimeFormatOptions = {\r\n        minute: '2-digit',\r\n        hour: '2-digit'\r\n      };\r\n\r\n      const sendDate = new Date(this.selectedDate.getTime());\r\n      sendDate.setHours(+this.hoursInputField.value, +this.minutesInputField.value);\r\n\r\n      if(this.selectedDate.getTime() === date.getTime()) {\r\n        key = 'Schedule.SendToday';\r\n      }/*  else if(this.selectedDate.getTime() === (date.getTime() + 86400e3)) {\r\n        dayStr = 'Tomorrow';\r\n      } */ else {\r\n        key = 'Schedule.SendDate';\r\n\r\n        const dateOptions: Intl.DateTimeFormatOptions = {\r\n          month: 'short',\r\n          day: 'numeric'\r\n        };\r\n\r\n        if(sendDate.getFullYear() !== date.getFullYear()) {\r\n          dateOptions.year = 'numeric';\r\n        }\r\n\r\n        args.push(new I18n.IntlDateElement({\r\n          date: sendDate,\r\n          options: dateOptions\r\n        }).element);\r\n      }\r\n\r\n      args.push(new I18n.IntlDateElement({\r\n        date: sendDate,\r\n        options: timeOptions\r\n      }).element);\r\n\r\n      this.btnConfirm.firstChild.replaceWith(i18n(key, args));\r\n    }\r\n  }\r\n\r\n  public setTitle() {\r\n    // const splitted = this.selectedDate.toString().split(' ', 3);\r\n    // this.title.innerText = splitted[0] + ', ' + splitted[1] + ' ' + splitted[2];\r\n    this.title.textContent = '';\r\n    this.title.append(new I18n.IntlDateElement({\r\n      date: this.selectedDate,\r\n      options: {\r\n        day: 'numeric',\r\n        month: 'long',\r\n        weekday: 'short'\r\n      }\r\n    }).element);\r\n  }\r\n\r\n  private renderElement(disabled: boolean, innerText: string | HTMLElement = '') {\r\n    const el = document.createElement('button');\r\n    el.classList.add('btn-icon', 'date-picker-month-date');\r\n\r\n    if(disabled) {\r\n      el.setAttribute('disabled', 'true');\r\n    }\r\n\r\n    if(innerText) {\r\n      el.append(innerText);\r\n    }\r\n\r\n    return el;\r\n  }\r\n\r\n  public setMonth() {\r\n    const firstDate = new Date(this.selectedMonth);\r\n\r\n    const options: Intl.DateTimeFormatOptions = {\r\n      year: 'numeric',\r\n      month: this.timeDiv && mediaSizes.isMobile ? 'short' : 'long'\r\n    };\r\n\r\n    this.monthTitle.textContent = '';\r\n    this.monthTitle.append(new I18n.IntlDateElement({date: firstDate, options}).element);\r\n    // this.monthTitle.innerText = (this.timeDiv && mediaSizes.isMobile ? monthName.slice(0, 3) : monthName) + ' ' + this.selectedMonth.getFullYear();\r\n\r\n    if(this.month) {\r\n      this.month.remove();\r\n    }\r\n\r\n    this.month = document.createElement('div');\r\n    this.month.classList.add('date-picker-month');\r\n\r\n    const weekStartDate = new Date();\r\n    const day = weekStartDate.getDay();\r\n    if(day !== 1) {\r\n      weekStartDate.setHours(-24 * (day - 1));\r\n    }\r\n\r\n    for(let i = 0; i < 7; ++i) {\r\n      const el = this.renderElement(true, new I18n.IntlDateElement({date: weekStartDate, options: {weekday: 'narrow'}}).element);\r\n      el.classList.remove('date-picker-month-date');\r\n      el.classList.add('date-picker-month-day');\r\n      this.month.append(el);\r\n      weekStartDate.setDate(weekStartDate.getDate() + 1);\r\n    }\r\n\r\n    // 0 - sunday\r\n    let dayIndex = firstDate.getDay() - 1;\r\n    if(dayIndex === -1) dayIndex = 7 - 1;\r\n\r\n    const clonedDate = new Date(firstDate.getTime());\r\n    clonedDate.setDate(clonedDate.getDate() - dayIndex - 1);\r\n\r\n    // Padding first week\r\n    for(let i = 0; i < dayIndex; ++i) {\r\n      if(this.options.showOverflowMonths) {\r\n        clonedDate.setDate(clonedDate.getDate() + 1);\r\n        this.month.append(this.renderElement(true, '' + clonedDate.getDate()));\r\n      } else {\r\n        this.month.append(this.renderElement(true));\r\n      }\r\n    }\r\n\r\n    do {\r\n      const date = firstDate.getDate();\r\n      const el = this.renderElement(firstDate > this.maxDate || firstDate < this.minDate, '' + date);\r\n      el.dataset.timestamp = '' + firstDate.getTime();\r\n\r\n      if(firstDate.getTime() === this.selectedDate.getTime()) {\r\n        this.selectedEl = el;\r\n        el.classList.add('active');\r\n      }\r\n\r\n      this.month.append(el);\r\n\r\n      firstDate.setDate(date + 1);\r\n    } while(firstDate.getDate() !== 1);\r\n\r\n    const remainder = this.month.childElementCount % 7;\r\n    if(this.options.showOverflowMonths && remainder) {\r\n      for(let i = remainder; i < 7; ++i) {\r\n        this.month.append(this.renderElement(true, '' + firstDate.getDate()));\r\n        firstDate.setDate(firstDate.getDate() + 1);\r\n      }\r\n    }\r\n\r\n    const lines = Math.ceil(this.month.childElementCount / 7);\r\n    this.container.dataset.lines = '' + lines;\r\n\r\n    this.monthsContainer.append(this.month);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default class DivAndCaption<T> {\r\n  public container: HTMLElement;\r\n  public border: HTMLElement;\r\n  public content: HTMLElement;\r\n  public title: HTMLElement;\r\n  public subtitle: HTMLElement;\r\n\r\n  constructor(protected className: string, public fill?: T) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = className;\r\n\r\n    this.border = document.createElement('div');\r\n    this.border.classList.add(className + '-border');\r\n\r\n    this.content = document.createElement('div');\r\n    this.content.classList.add(className + '-content');\r\n\r\n    this.title = document.createElement('div');\r\n    this.title.classList.add(className + '-title');\r\n    this.title.setAttribute('dir', 'auto');\r\n\r\n    this.subtitle = document.createElement('div');\r\n    this.subtitle.classList.add(className + '-subtitle');\r\n    this.subtitle.setAttribute('dir', 'auto');\r\n\r\n    this.content.append(this.title, this.subtitle);\r\n    this.container.append(this.border, this.content);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport {Middleware} from '../../helpers/middleware';\r\nimport limitSymbols from '../../helpers/string/limitSymbols';\r\nimport {Document, MessageMedia, Photo, WebPage} from '../../layer';\r\nimport appImManager, {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\nimport wrapPhoto from '../wrappers/photo';\r\nimport wrapSticker from '../wrappers/sticker';\r\nimport wrapVideo from '../wrappers/video';\r\n\r\nconst MEDIA_SIZE = 32;\r\n\r\nexport async function wrapReplyDivAndCaption(options: {\r\n  title: string | HTMLElement | DocumentFragment,\r\n  titleEl: HTMLElement,\r\n  subtitle: string | HTMLElement | DocumentFragment,\r\n  subtitleEl: HTMLElement,\r\n  message: any,\r\n  mediaEl: HTMLElement,\r\n  loadPromises?: Promise<any>[]\r\n}) {\r\n  let {title, titleEl, subtitle, subtitleEl, mediaEl, message, loadPromises} = options;\r\n  if(title !== undefined) {\r\n    if(typeof(title) === 'string') {\r\n      title = limitSymbols(title, 140);\r\n      title = wrapEmojiText(title);\r\n    }\r\n\r\n    replaceContent(titleEl, title);\r\n  }\r\n\r\n  if(!loadPromises) {\r\n    loadPromises = [];\r\n  }\r\n\r\n  let messageMedia: MessageMedia | WebPage.webPage = message?.media;\r\n  let setMedia = false, isRound = false;\r\n  const mediaChildren = mediaEl ? Array.from(mediaEl.children).slice() : [];\r\n  let middleware: Middleware;\r\n  if(messageMedia && mediaEl) {\r\n    subtitleEl.textContent = '';\r\n    subtitleEl.append(await wrapMessageForReply(message, undefined, undefined, undefined, undefined, true));\r\n\r\n    messageMedia = (messageMedia as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage || messageMedia;\r\n    const photo = (messageMedia as MessageMedia.messageMediaPhoto).photo as Photo.photo;\r\n    const document = (messageMedia as MessageMedia.messageMediaDocument).document as Document.document;\r\n    if(photo || (document && document.thumbs?.length)/* ['video', 'sticker', 'gif', 'round', 'photo', 'audio'].indexOf(document.type) !== -1) */) {\r\n      middleware = appImManager.chat.bubbles.getMiddleware();\r\n      const lazyLoadQueue = appImManager.chat.bubbles.lazyLoadQueue;\r\n\r\n      if(document?.type === 'sticker') {\r\n        await wrapSticker({\r\n          doc: document,\r\n          div: mediaEl,\r\n          lazyLoadQueue,\r\n          group: CHAT_ANIMATION_GROUP,\r\n          // onlyThumb: document.sticker === 2,\r\n          width: MEDIA_SIZE,\r\n          height: MEDIA_SIZE,\r\n          middleware,\r\n          loadPromises\r\n        });\r\n        setMedia = true;\r\n      } else if(document?.type === 'gif' && document.video_thumbs) {\r\n        setMedia = true;\r\n        await wrapVideo({\r\n          doc: document,\r\n          container: mediaEl,\r\n          boxWidth: MEDIA_SIZE,\r\n          boxHeight: MEDIA_SIZE,\r\n          lazyLoadQueue,\r\n          noPlayButton: true,\r\n          noInfo: true,\r\n          middleware,\r\n          loadPromises,\r\n          withoutPreloader: true,\r\n          videoSize: document.video_thumbs[0],\r\n          group: CHAT_ANIMATION_GROUP\r\n        });\r\n      } else {\r\n        const m = photo || document;\r\n        isRound = document?.type === 'round';\r\n\r\n        try {\r\n          await wrapPhoto({\r\n            photo: m,\r\n            container: mediaEl,\r\n            boxWidth: MEDIA_SIZE,\r\n            boxHeight: MEDIA_SIZE,\r\n            size: choosePhotoSize(m, MEDIA_SIZE, MEDIA_SIZE),\r\n            middleware,\r\n            lazyLoadQueue,\r\n            noBlur: true,\r\n            withoutPreloader: true,\r\n            loadPromises\r\n          });\r\n          setMedia = true;\r\n        } catch(err) {\r\n\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    if(message) {\r\n      subtitleEl.textContent = '';\r\n      subtitleEl.append(await wrapMessageForReply(message));\r\n    } else {\r\n      if(typeof(subtitle) === 'string') {\r\n        subtitle = limitSymbols(subtitle, 140);\r\n        subtitle = wrapEmojiText(subtitle);\r\n      }\r\n\r\n      replaceContent(subtitleEl, subtitle || '');\r\n    }\r\n  }\r\n\r\n  Promise.all(loadPromises).then(() => {\r\n    if(middleware && !middleware()) return;\r\n    mediaChildren.forEach((child) => child.remove());\r\n\r\n    if(mediaEl) {\r\n      mediaEl.classList.toggle('is-round', isRound);\r\n    }\r\n  });\r\n\r\n  return setMedia;\r\n}\r\n\r\nexport default class ReplyContainer extends DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => Promise<void>> {\r\n  private mediaEl: HTMLElement;\r\n\r\n  constructor(protected className: string) {\r\n    super(className, async(title, subtitle = '', message?) => {\r\n      if(!this.mediaEl) {\r\n        this.mediaEl = document.createElement('div');\r\n        this.mediaEl.classList.add(this.className + '-media');\r\n      }\r\n\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title,\r\n        titleEl: this.title,\r\n        subtitle,\r\n        subtitleEl: this.subtitle,\r\n        mediaEl: this.mediaEl,\r\n        message\r\n      });\r\n\r\n      this.container.classList.toggle('is-media', isMediaSet);\r\n      if(isMediaSet) {\r\n        this.content.prepend(this.mediaEl);\r\n      } else {\r\n        this.mediaEl.remove();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {hexToRgb} from '../../helpers/color';\nimport {Message} from '../../layer';\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\nimport ReplyContainer from '../chat/replyContainer';\n\nexport default function wrapReply(\n  title: Parameters<ReplyContainer['fill']>[0],\n  subtitle: Parameters<ReplyContainer['fill']>[1],\n  message?: Message.message | Message.messageService,\n  setColorPeerId?: PeerId\n) {\n  const replyContainer = new ReplyContainer('reply');\n  const fillPromise = replyContainer.fill(title, subtitle, message);\n\n  if(setColorPeerId) {\n    const hex = getPeerColorById(setColorPeerId, false);\n    const [r, g, b] = hexToRgb(hex);\n    replyContainer.container.style.setProperty('--override-color', `${r}, ${g}, ${b}`);\n    replyContainer.container.classList.add('is-overriding-color');\n    // replyContainer.border.style.backgroundColor = hex;\n    // replyContainer.title.style.color = hex;\n  }\n\n  return {container: replyContainer.container, fillPromise};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport AvatarElement from './avatar';\nimport type LazyLoadQueue from './lazyLoadQueue';\n\nconst CLASS_NAME = 'stacked-avatars';\nconst AVATAR_CLASS_NAME = CLASS_NAME + '-avatar';\nconst AVATAR_CONTAINER_CLASS_NAME = AVATAR_CLASS_NAME + '-container';\n\nexport default class StackedAvatars {\n  public container: HTMLElement;\n  private lazyLoadQueue: LazyLoadQueue;\n  private avatarSize: number;\n\n  constructor(options: {\n    lazyLoadQueue?: StackedAvatars['lazyLoadQueue'],\n    avatarSize: StackedAvatars['avatarSize']\n  }) {\n    this.lazyLoadQueue = options.lazyLoadQueue;\n    this.avatarSize = options.avatarSize;\n\n    this.container = document.createElement('div');\n    this.container.classList.add(CLASS_NAME);\n\n    this.container.style.setProperty('--avatar-size', options.avatarSize + 'px');\n  }\n  /**\n   * MACOS, ANDROID -  \n   * WINDOWS DESKTOP - \n   *       ,       , !\n   */\n  public render(peerIds: PeerId[], loadPromises?: Promise<any>[]) {\n    const children = this.container.children;\n    peerIds = peerIds.slice().reverse();\n    if(peerIds.length > 3) {\n      peerIds = peerIds.slice(-3);\n    }\n\n    peerIds.forEach((peerId, idx) => {\n      let avatarContainer = children[idx] as HTMLElement;\n      if(!avatarContainer) {\n        avatarContainer = document.createElement('div');\n        avatarContainer.classList.add(AVATAR_CONTAINER_CLASS_NAME);\n      }\n\n      let avatarElem = avatarContainer.firstElementChild as AvatarElement;\n      if(!avatarElem) {\n        avatarElem = new AvatarElement();\n        avatarElem.classList.add('avatar-' + this.avatarSize, AVATAR_CLASS_NAME);\n        avatarElem.updateOptions({\n          isDialog: false,\n          loadPromises\n        });\n      }\n\n      avatarElem.updateWithOptions({\n        lazyLoadQueue: this.lazyLoadQueue,\n        peerId: peerId\n      });\n\n      if(!avatarElem.parentNode) {\n        avatarContainer.append(avatarElem);\n      }\n\n      if(!avatarContainer.parentNode) {\n        this.container.append(avatarContainer);\n      }\n    });\n\n    // if were 3 and became 2\n    (Array.from(children) as HTMLElement[]).slice(peerIds.length).forEach((el) => el.remove());\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {Message} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ripple from '../ripple';\r\nimport I18n from '../../lib/langPack';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport formatNumber from '../../helpers/number/formatNumber';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport type LazyLoadQueue from '../lazyLoadQueue';\r\n\r\nconst TAG_NAME = 'replies-element';\r\n\r\nrootScope.addEventListener('replies_updated', (message) => {\r\n  (Array.from(document.querySelectorAll(TAG_NAME + `[data-post-key=\"${message.peerId}_${message.mid}\"]`)) as RepliesElement[]).forEach((element) => {\r\n    element.message = message;\r\n    element.render();\r\n  });\r\n});\r\n\r\nexport default class RepliesElement extends HTMLElement {\r\n  public message: Message.message;\r\n  public type: 'footer' | 'beside';\r\n  public loadPromises: Promise<any>[];\r\n  public lazyLoadQueue: LazyLoadQueue;\r\n  public stackedAvatars: StackedAvatars;\r\n  public text: I18n.IntlElement;\r\n  public managers: AppManagers;\r\n\r\n  private updated = false;\r\n\r\n  constructor() {\r\n    super();\r\n    this.managers = rootScope.managers;\r\n  }\r\n\r\n  public init() {\r\n    this.render();\r\n    this.dataset.postKey = this.message.peerId + '_' + this.message.mid;\r\n    this.classList.add('replies', 'replies-' + this.type);\r\n  }\r\n\r\n  public render() {\r\n    const replies = this.message.replies;\r\n\r\n    /* if(this.firstChild) {\r\n      this.innerHTML = '';\r\n    } */\r\n\r\n    if(this.type === 'footer') {\r\n      let leftPart: HTMLElement;\r\n      if(this.firstElementChild) {\r\n        leftPart = this.firstElementChild as HTMLElement;\r\n      }\r\n\r\n      if(replies?.recent_repliers) {\r\n        if(leftPart && !leftPart.classList.contains('replies-footer-avatars')) {\r\n          this.innerHTML = '';\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!this.stackedAvatars) {\r\n          this.stackedAvatars = new StackedAvatars({\r\n            lazyLoadQueue: this.lazyLoadQueue,\r\n            avatarSize: 30\r\n          });\r\n\r\n          this.stackedAvatars.container.classList.add('replies-footer-avatars');\r\n        }\r\n\r\n        leftPart = this.stackedAvatars.container;\r\n\r\n        this.stackedAvatars.render(replies.recent_repliers.map((peer) => getPeerId(peer)), this.loadPromises);\r\n      } else {\r\n        if(leftPart && !leftPart.classList.contains('tgico-comments')) {\r\n          leftPart.remove();\r\n          leftPart = null;\r\n        }\r\n\r\n        if(!leftPart) {\r\n          leftPart = document.createElement('span');\r\n          leftPart.classList.add('tgico-comments');\r\n        }\r\n      }\r\n\r\n      if(!leftPart.parentElement) {\r\n        this.prepend(leftPart);\r\n      }\r\n\r\n      if(!this.text) {\r\n        this.text = new I18n.IntlElement();\r\n      }\r\n\r\n      const text = this.text;\r\n      if(replies) {\r\n        if(replies.replies) {\r\n          text.compareAndUpdate({key: 'Comments', args: [replies.replies]});\r\n        } else {\r\n          text.compareAndUpdate({key: 'LeaveAComment'});\r\n        }\r\n      } else {\r\n        text.compareAndUpdate({key: 'ViewInChat'});\r\n      }\r\n\r\n      if(replies) {\r\n        // const historyStorage = appMessagesManager.getHistoryStorage(replies.channel_id.toPeerId(true));\r\n        let isUnread = false;\r\n        if(replies.replies) {\r\n          if(replies.read_max_id !== undefined && replies.max_id !== undefined) {\r\n            isUnread = replies.read_max_id < replies.max_id;\r\n          }/*  else {\r\n            isUnread = !historyStorage.readMaxId || historyStorage.readMaxId < (replies.max_id || 0);\r\n          } */\r\n        }\r\n        this.classList.toggle('is-unread', isUnread);\r\n      }\r\n\r\n      let textSpan = this.children[1] as HTMLElement;\r\n      if(!textSpan) {\r\n        textSpan = document.createElement('span');\r\n        textSpan.classList.add('replies-footer-text');\r\n\r\n        const iconSpan = document.createElement('span');\r\n        iconSpan.classList.add('tgico-next');\r\n\r\n        const rippleContainer = document.createElement('div');\r\n        ripple(rippleContainer);\r\n\r\n        this.append(textSpan, iconSpan, rippleContainer);\r\n      }\r\n\r\n      replaceContent(textSpan, text.element);\r\n    } else {\r\n      this.classList.add('bubble-beside-button');\r\n      this.innerHTML = `<span class=\"tgico-commentssticker\"></span><span class=\"replies-beside-text\">${replies?.replies ? formatNumber(replies.replies, 0) : ''}</span>`;\r\n    }\r\n\r\n    if(replies && !this.updated && !this.message.pFlags.is_outgoing) {\r\n      this.managers.appMessagesManager.subscribeRepliesThread(this.message.peerId, this.message.mid);\r\n      this.managers.appMessagesManager.updateMessage(this.message.peerId, this.message.mid, 'replies_updated');\r\n      this.updated = true;\r\n    }\r\n\r\n    if(this.loadPromises) {\r\n      this.loadPromises = undefined;\r\n    }\r\n  }\r\n}\r\n\r\ncustomElements.define(TAG_NAME, RepliesElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {formatTime, getFullDate} from '../../helpers/date';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {Message} from '../../layer';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {i18n, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport rootScope from '../../lib/rootScope';\nimport type LazyLoadQueue from '../lazyLoadQueue';\nimport PeerTitle from '../peerTitle';\nimport wrapReply from '../wrappers/reply';\nimport Chat, {ChatType} from './chat';\nimport RepliesElement from './replies';\n\nconst NBSP = '&nbsp;';\n\nconst makeEdited = () => {\n  const edited = document.createElement('i');\n  edited.classList.add('edited');\n  _i18n(edited, 'EditedMessage');\n  return edited;\n};\n\nconst makeSponsored = () => i18n('SponsoredMessage');\n\nexport namespace MessageRender {\n  /* export const setText = () => {\n\n  }; */\n\n  export const setTime = (options: {\n    chatType: ChatType,\n    message: Message.message | Message.messageService,\n    reactionsMessage?: Message.message\n  }) => {\n    const {chatType, message} = options;\n    const date = new Date(message.date * 1000);\n    const args: (HTMLElement | string)[] = [];\n\n    let editedSpan: HTMLElement,\n      sponsoredSpan: HTMLElement;\n      // reactionsElement: ReactionsElement,\n      // reactionsMessage: Message.message;\n\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\n    const isMessage = !('action' in message) && !isSponsored;\n    // let hasReactions: boolean;\n\n    const time: HTMLElement = isSponsored ? undefined : formatTime(date);\n    if(isMessage) {\n      if(message.views) {\n        const postAuthor = message.post_author || message.fwd_from?.post_author;\n\n        const postViewsSpan = document.createElement('span');\n        postViewsSpan.classList.add('post-views');\n        postViewsSpan.innerHTML = formatNumber(message.views, 1);\n\n        const channelViews = document.createElement('i');\n        channelViews.classList.add('tgico-channelviews', 'time-icon');\n\n        args.push(postViewsSpan, channelViews);\n        if(postAuthor) {\n          const span = document.createElement('span');\n          setInnerHTML(span, wrapEmojiText(postAuthor));\n          span.insertAdjacentHTML('beforeend', ',' + NBSP)\n          args.push(span);\n        }\n      }\n\n      if(message.edit_date && chatType !== 'scheduled' && !message.pFlags.edit_hide) {\n        args.unshift(editedSpan = makeEdited());\n      }\n\n      if(chatType !== 'pinned' && message.pFlags.pinned) {\n        const i = document.createElement('i');\n        i.classList.add('tgico-pinnedchat', 'time-icon');\n        args.unshift(i);\n      }\n\n      // if(USER_REACTIONS_INLINE && message.peer_id._ === 'peerUser'/*  && message.reactions?.results?.length */) {\n      //   hasReactions = true;\n\n      //   reactionsMessage = options.reactionsMessage;\n      //   reactionsElement = new ReactionsElement();\n      //   reactionsElement.init(reactionsMessage, 'inline', true);\n      //   reactionsElement.render();\n      //   args.unshift(reactionsElement);\n      // }\n    } else if(isSponsored) {\n      args.push(sponsoredSpan = makeSponsored());\n    }\n\n    if(time) {\n      args.push(time);\n    }\n\n    let title = isSponsored ? undefined : getFullDate(date);\n    if(isMessage) {\n      title += (message.edit_date && !message.pFlags.edit_hide ? `\\nEdited: ${getFullDate(new Date(message.edit_date * 1000))}` : '') +\n        (message.fwd_from ? `\\nOriginal: ${getFullDate(new Date(message.fwd_from.date * 1000))}` : '');\n    }\n\n    const timeSpan = document.createElement('span');\n    timeSpan.classList.add('time', 'tgico');\n    // if(title) timeSpan.title = title;\n    timeSpan.append(...args);\n\n    const inner = document.createElement('div');\n    inner.classList.add('inner', 'tgico');\n    if(title) inner.title = title;\n\n    let clonedArgs = args;\n    if(editedSpan) {\n      clonedArgs[clonedArgs.indexOf(editedSpan)] = makeEdited();\n    }\n    if(sponsoredSpan) {\n      clonedArgs[clonedArgs.indexOf(sponsoredSpan)] = makeSponsored();\n    }\n    // if(reactionsElement) {\n    //   const _reactionsElement = clonedArgs[clonedArgs.indexOf(reactionsElement)] = new ReactionsElement();\n    //   _reactionsElement.init(reactionsMessage, 'inline');\n    //   _reactionsElement.render();\n    // }\n    clonedArgs = clonedArgs.map((a) => a instanceof HTMLElement && !a.classList.contains('i18n') && !a.classList.contains('reactions') ? a.cloneNode(true) as HTMLElement : a);\n    if(time) {\n      clonedArgs[clonedArgs.length - 1] = formatTime(date); // clone time\n    }\n    inner.append(...clonedArgs);\n\n    timeSpan.append(inner);\n\n    return timeSpan;\n  };\n\n  export const renderReplies = ({bubble, bubbleContainer, message, messageDiv, loadPromises, lazyLoadQueue}: {\n    bubble: HTMLElement,\n    bubbleContainer: HTMLElement,\n    message: Message.message,\n    messageDiv: HTMLElement,\n    loadPromises?: Promise<any>[],\n    lazyLoadQueue?: LazyLoadQueue\n  }) => {\n    const isFooter = !bubble.classList.contains('sticker') && !bubble.classList.contains('emoji-big') && !bubble.classList.contains('round');\n    const repliesFooter = new RepliesElement();\n    repliesFooter.message = message;\n    repliesFooter.type = isFooter ? 'footer' : 'beside';\n    repliesFooter.loadPromises = loadPromises;\n    repliesFooter.lazyLoadQueue = lazyLoadQueue;\n    repliesFooter.init();\n    bubbleContainer.prepend(repliesFooter);\n    return isFooter;\n  };\n\n  export const setReply = async({chat, bubble, bubbleContainer, message}: {\n    chat: Chat,\n    bubble: HTMLElement,\n    bubbleContainer?: HTMLElement,\n    message: Message.message\n  }) => {\n    const isReplacing = !bubbleContainer;\n    if(isReplacing) {\n      bubbleContainer = bubble.querySelector('.bubble-content');\n    }\n\n    const currentReplyDiv = isReplacing ? bubbleContainer.querySelector('.reply') : null;\n    if(!message.reply_to_mid) {\n      if(currentReplyDiv) {\n        currentReplyDiv.remove();\n      }\n\n      bubble.classList.remove('is-reply');\n      return;\n    }\n\n\n    const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : chat.peerId;\n\n    const originalMessage = await rootScope.managers.appMessagesManager.getMessageByPeer(replyToPeerId, message.reply_to_mid);\n    let originalPeerTitle: string | HTMLElement;\n\n    // ///////this.log('message to render reply', originalMessage, originalPeerTitle, bubble, message);\n\n    let titlePeerId: PeerId;\n    // need to download separately\n    if(!originalMessage) {\n      // ////////this.log('message to render reply empty, need download', message, message.reply_to_mid);\n      rootScope.managers.appMessagesManager.fetchMessageReplyTo(message);\n      chat.bubbles.needUpdate.push({replyToPeerId, replyMid: message.reply_to_mid, mid: message.mid});\n\n      originalPeerTitle = i18n('Loading');\n    } else {\n      const originalMessageFwdFromId = (originalMessage as Message.message).fwdFromId;\n      titlePeerId = message.fwdFromId && message.fwdFromId === originalMessageFwdFromId ? message.fwdFromId : originalMessage.fromId || originalMessageFwdFromId;\n      originalPeerTitle = new PeerTitle({\n        peerId: titlePeerId,\n        dialog: false,\n        onlyFirstName: false,\n        plainText: false\n      }).element;\n    }\n\n    const {container, fillPromise} = wrapReply(originalPeerTitle, undefined, originalMessage, chat.isAnyGroup ? titlePeerId : undefined);\n    await fillPromise;\n    if(currentReplyDiv) {\n      currentReplyDiv.replaceWith(container);\n    } else {\n      bubbleContainer.append(container);\n    }\n    // bubbleContainer.insertBefore(, nameContainer);\n    bubble.classList.add('is-reply');\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\n\r\nexport function getElementByPoint(container: HTMLElement, verticalSide: 'top' | 'bottom', horizontalSide: 'center' | 'left'): HTMLElement {\r\n  // return null;\r\n  const rect = container.getBoundingClientRect();\r\n  const x = horizontalSide === 'center' ? Math.ceil(rect.left + ((rect.right - rect.left) / 2) + 1) : Math.ceil(rect.left + 1);\r\n  const y = verticalSide === 'bottom' ? Math.floor(rect.top + rect.height - 1) : Math.ceil(rect.top + 1);\r\n  return document.elementFromPoint(x, y) as any;\r\n};\r\n\r\nMOUNT_CLASS_TO.getElementByPoint = getElementByPoint;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function reflowScrollableElement(element: HTMLElement) {\r\n  element.style.display = 'none';\r\n  void element.offsetLeft; // reflow\r\n  element.style.display = '';\r\n}\r\n","export const SEND_WHEN_ONLINE_TIMESTAMP = 0x7FFFFFFE;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport enum INTERNAL_LINK_TYPE {\n  MESSAGE,\n  PRIVATE_POST,\n  STICKER_SET,\n  JOIN_CHAT,\n  VOICE_CHAT,\n  USER_PHONE_NUMBER,\n  INVOICE,\n  EMOJI_SET\n};\n\nexport type InternalLink = InternalLink.InternalLinkMessage | InternalLink.InternalLinkPrivatePost | InternalLink.InternalLinkStickerSet | InternalLink.InternalLinkJoinChat | InternalLink.InternalLinkVoiceChat | InternalLink.InternalLinkUserPhoneNumber | InternalLink.InternalLinkInvoice | InternalLink.InternalLinkEmojiSet;\n\nexport namespace InternalLink {\n  export interface InternalLinkMessage {\n    _: INTERNAL_LINK_TYPE.MESSAGE,\n    domain: string,\n    post?: string,\n    comment?: string,\n    start?: string\n  }\n\n  export interface InternalLinkPrivatePost {\n    _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n    channel: string,\n    post: string,\n    thread?: string,\n    comment?: string\n  }\n\n  export interface InternalLinkStickerSet {\n    _: INTERNAL_LINK_TYPE.STICKER_SET,\n    set: string\n  }\n\n  export interface InternalLinkJoinChat {\n    _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n    invite: string\n  }\n\n  /**\n   * LOCAL LINK\n   */\n  export interface InternalLinkVoiceChat {\n    _: INTERNAL_LINK_TYPE.VOICE_CHAT,\n    id: string,\n    access_hash: string,\n    chat_id: string\n  }\n\n  export interface InternalLinkUserPhoneNumber {\n    _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n    phone: string\n  }\n\n  export interface InternalLinkInvoice {\n    _: INTERNAL_LINK_TYPE.INVOICE,\n    slug: string\n  }\n\n  export interface InternalLinkEmojiSet {\n    _: INTERNAL_LINK_TYPE.EMOJI_SET,\n    set: string\n  }\n}\n\nexport type InternalLinkTypeMap = {\n  [INTERNAL_LINK_TYPE.MESSAGE]: InternalLink.InternalLinkMessage,\n  [INTERNAL_LINK_TYPE.PRIVATE_POST]: InternalLink.InternalLinkPrivatePost,\n  [INTERNAL_LINK_TYPE.STICKER_SET]: InternalLink.InternalLinkStickerSet,\n  [INTERNAL_LINK_TYPE.JOIN_CHAT]: InternalLink.InternalLinkJoinChat,\n  [INTERNAL_LINK_TYPE.VOICE_CHAT]: InternalLink.InternalLinkVoiceChat,\n  [INTERNAL_LINK_TYPE.USER_PHONE_NUMBER]: InternalLink.InternalLinkUserPhoneNumber,\n  [INTERNAL_LINK_TYPE.INVOICE]: InternalLink.InternalLinkInvoice,\n  [INTERNAL_LINK_TYPE.EMOJI_SET]: InternalLink.InternalLinkEmojiSet\n};\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport PopupElement, {addCancelButton} from '.';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\r\nimport {ChatInvite} from '../../layer';\r\nimport appImManager from '../../lib/appManagers/appImManager';\r\nimport {i18n, _i18n} from '../../lib/langPack';\r\nimport {NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport putPhoto from '../putPhoto';\r\nimport {toastNew} from '../toast';\r\nimport wrapPhoto from '../wrappers/photo';\r\n\r\n// const FAKE_CHAT_ID = Number.MAX_SAFE_INTEGER - 0x1000;\r\n\r\nexport default class PopupJoinChatInvite extends PopupElement {\r\n  constructor(\r\n    private hash: string,\r\n    private chatInvite: ChatInvite.chatInvite\r\n  ) {\r\n    super('popup-join-chat-invite', {\r\n      closable: true,\r\n      overlayClosable: true,\r\n      body: true,\r\n      buttons: addCancelButton([{\r\n        langKey: chatInvite.pFlags.request_needed ? 'RequestJoin.Button' : (chatInvite.pFlags.broadcast ? 'JoinByPeekChannelTitle' : 'JoinByPeekGroupTitle'),\r\n        callback: () => {\r\n          this.managers.appChatsManager.importChatInvite(hash)\r\n          .then((chatId) => {\r\n            const peerId = chatId.toPeerId(true);\r\n            appImManager.setInnerPeer({peerId});\r\n          }, (error) => {\r\n            if(error.type === 'INVITE_REQUEST_SENT') {\r\n              toastNew({langPackKey: 'RequestToJoinSent'});\r\n            }\r\n          });\r\n        }\r\n      }])\r\n    });\r\n\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.header.remove();\r\n    /* const fakeChat: Chat.channel | Chat.chat = {\r\n      _: chatInvite.pFlags.channel ? 'channel' : 'chat',\r\n      id: FAKE_CHAT_ID,\r\n      title: chatInvite.title,\r\n      photo: chatInvite.photo as any,\r\n      date: Date.now() / 1000 | 0,\r\n      version: 0,\r\n      participants_count: chatInvite.participants_count,\r\n      pFlags: chatInvite.pFlags as any\r\n    };\r\n\r\n    appChatsManager.saveApiChat(fakeChat); */\r\n\r\n    const {chatInvite, managers, hash} = this;\r\n\r\n    const avatarElem = new AvatarElement();\r\n    avatarElem.classList.add('avatar-100');\r\n    avatarElem.isDialog = false;\r\n    if(chatInvite.photo._ === 'photo') {\r\n      chatInvite.photo = await managers.appPhotosManager.savePhoto(chatInvite.photo);\r\n      wrapPhoto({\r\n        container: avatarElem,\r\n        message: null,\r\n        photo: chatInvite.photo,\r\n        boxHeight: 100,\r\n        boxWidth: 100,\r\n        withoutPreloader: true\r\n      });\r\n      avatarElem.style.width = avatarElem.style.height = '';\r\n    } else {\r\n      putPhoto(avatarElem, NULL_PEER_ID, false, chatInvite.title);\r\n    }\r\n\r\n    const title = document.createElement('div');\r\n    title.classList.add('chat-title');\r\n    setInnerHTML(title, wrapEmojiText(chatInvite.title));\r\n    // avatarElem.setAttribute('peer', '' + -fakeChat.id);\r\n\r\n    const isBroadcast = chatInvite.pFlags.broadcast;\r\n    const peopleCount = i18n(isBroadcast ? 'Subscribers' : 'Members', [numberThousandSplitter(chatInvite.participants_count)]);\r\n    peopleCount.classList.add('chat-participants-count');\r\n\r\n    this.body.append(avatarElem, title, peopleCount);\r\n\r\n    if(chatInvite.pFlags.request_needed) {\r\n      const caption = document.createElement('div');\r\n      _i18n(caption, isBroadcast ? 'RequestToJoinChannelDescription' : 'RequestToJoinGroupDescription');\r\n      caption.classList.add('chat-participants-count', 'request-caption');\r\n\r\n      this.body.append(caption);\r\n    }\r\n\r\n    this.show();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport callbackify from '../../helpers/callbackify';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport {Document, MessagePeerReaction, ReactionCount} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport rootScope from '../../lib/rootScope';\nimport SetTransition from '../singleTransition';\nimport StackedAvatars from '../stackedAvatars';\nimport {Awaited} from '../../types';\nimport wrapSticker from '../wrappers/sticker';\nimport wrapCustomEmoji from '../wrappers/customEmoji';\nimport wrapStickerAnimation from '../wrappers/stickerAnimation';\nimport {makeMediaSize} from '../../helpers/mediaSize';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport {fastRaf} from '../../helpers/schedulers';\nimport noop from '../../helpers/noop';\nimport {Middleware} from '../../helpers/middleware';\n\nconst CLASS_NAME = 'reaction';\nconst TAG_NAME = CLASS_NAME + '-element';\nconst REACTION_INLINE_SIZE = 14;\nconst REACTION_BLOCK_SIZE = 22;\n\nexport const REACTION_DISPLAY_INLINE_COUNTER_AT = 2;\nexport const REACTION_DISPLAY_BLOCK_COUNTER_AT = 4;\n\nexport type ReactionLayoutType = 'block' | 'inline';\n\nexport default class ReactionElement extends HTMLElement {\n  private type: ReactionLayoutType;\n  private counter: HTMLElement;\n  private stickerContainer: HTMLElement;\n  private stackedAvatars: StackedAvatars;\n  private canRenderAvatars: boolean;\n  private _reactionCount: ReactionCount;\n  private wrapStickerPromise: Awaited<ReturnType<typeof wrapSticker>>['render'];\n  private managers: AppManagers;\n  private middleware: Middleware;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.managers = rootScope.managers;\n  }\n\n  public get reactionCount() {\n    return this._reactionCount;\n  }\n\n  public set reactionCount(reactionCount: ReactionCount) {\n    this._reactionCount = reactionCount;\n  }\n\n  public get count() {\n    return this.reactionCount.count;\n  }\n\n  public init(type: ReactionLayoutType, middleware: Middleware) {\n    this.type = type;\n    this.classList.add(CLASS_NAME + '-' + type);\n    this.middleware = middleware;\n  }\n\n  public setCanRenderAvatars(canRenderAvatars: boolean) {\n    this.canRenderAvatars = canRenderAvatars;\n  }\n\n  public render(doNotRenderSticker?: boolean) {\n    const hadStickerContainer = !!this.stickerContainer;\n    if(!hadStickerContainer) {\n      this.stickerContainer = document.createElement('div');\n      this.stickerContainer.classList.add(CLASS_NAME + '-sticker');\n      this.append(this.stickerContainer);\n    }\n\n    const reactionCount = this.reactionCount;\n    if(!doNotRenderSticker && !hadStickerContainer) {\n      const reaction = reactionCount.reaction;\n      if(reaction._ === 'reactionEmoji') {\n        const availableReaction = this.managers.appReactionsManager.getReaction(reaction.emoticon);\n        callbackify(availableReaction, (availableReaction) => {\n          if(!availableReaction.center_icon) {\n            this.stickerContainer.classList.add('is-static');\n          }\n\n          if(availableReaction.pFlags.inactive) {\n            this.classList.add('is-inactive');\n          }\n\n          this.renderDoc(availableReaction.center_icon ?? availableReaction.static_icon);\n        });\n      } else if(reaction._ === 'reactionCustomEmoji') {\n        this.stickerContainer.classList.add('is-custom');\n        const wrapped = wrapCustomEmoji({\n          docIds: [reaction.document_id],\n          size: makeMediaSize(REACTION_BLOCK_SIZE, REACTION_BLOCK_SIZE)\n        });\n\n        this.stickerContainer.append(wrapped);\n      }\n    }\n  }\n\n  private renderDoc(doc: Document.document) {\n    const size = this.type === 'inline' ? REACTION_INLINE_SIZE : REACTION_BLOCK_SIZE;\n    const wrapPromise = this.wrapStickerPromise = wrapSticker({\n      div: this.stickerContainer,\n      doc,\n      width: size,\n      height: size,\n      static: true,\n      managers: this.managers,\n      middleware: this.middleware\n    }).then(({render}) => render).finally(() => {\n      if(this.wrapStickerPromise === wrapPromise) {\n        this.wrapStickerPromise = undefined;\n      }\n    });\n  }\n\n  public renderCounter() {\n    const reactionCount = this.reactionCount;\n    const displayOn = this.type === 'inline' ? REACTION_DISPLAY_INLINE_COUNTER_AT : REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    if(reactionCount.count >= displayOn || (this.type === 'block' && !this.canRenderAvatars)) {\n      if(!this.counter) {\n        this.counter = document.createElement(this.type === 'inline' ? 'i' : 'span');\n        this.counter.classList.add(CLASS_NAME + '-counter');\n      }\n\n      const formatted = formatNumber(reactionCount.count);\n      if(this.counter.textContent !== formatted) {\n        this.counter.textContent = formatted;\n      }\n\n      if(!this.counter.parentElement) {\n        this.append(this.counter);\n      }\n    } else if(this.counter?.parentElement) {\n      this.counter.remove();\n      this.counter = undefined;\n    }\n  }\n\n  public renderAvatars(recentReactions: MessagePeerReaction[]) {\n    if(this.type === 'inline') {\n      return;\n    }\n\n    if(this.reactionCount.count >= REACTION_DISPLAY_BLOCK_COUNTER_AT || !this.canRenderAvatars) {\n      if(this.stackedAvatars) {\n        this.stackedAvatars.container.remove();\n        this.stackedAvatars = undefined;\n      }\n\n      return;\n    }\n\n    if(!this.stackedAvatars) {\n      this.stackedAvatars = new StackedAvatars({\n        avatarSize: 24\n      });\n\n      this.append(this.stackedAvatars.container);\n    }\n\n    this.stackedAvatars.render(recentReactions.map((reaction) => getPeerId(reaction.peer_id)));\n  }\n\n  public setIsChosen(isChosen = this.reactionCount.chosen_order !== undefined) {\n    if(this.type === 'inline') return;\n    const wasChosen = this.classList.contains('is-chosen') && !this.classList.contains('backwards');\n    if(wasChosen !== isChosen) {\n      SetTransition(this, 'is-chosen', isChosen, this.isConnected ? 300 : 0);\n    }\n  }\n\n  public fireAroundAnimation() {\n    const reaction = this.reactionCount.reaction;\n    if(reaction._ !== 'reactionEmoji') return;\n    callbackify(this.managers.appReactionsManager.getReaction(reaction.emoticon), (availableReaction) => {\n      const size = this.type === 'inline' ? REACTION_INLINE_SIZE + 14 : REACTION_BLOCK_SIZE + 18;\n      const div = document.createElement('div');\n      div.classList.add(CLASS_NAME + '-sticker-activate');\n\n      Promise.all([\n        wrapSticker({\n          div: div,\n          doc: availableReaction.center_icon,\n          width: size,\n          height: size,\n          withThumb: false,\n          needUpscale: true,\n          play: false,\n          skipRatio: 1,\n          group: 'none',\n          needFadeIn: false,\n          managers: this.managers,\n          middleware: this.middleware\n        }).then(({render}) => render as Promise<RLottiePlayer>),\n\n        wrapStickerAnimation({\n          doc: availableReaction.around_animation,\n          size: 80,\n          target: this.stickerContainer,\n          side: 'center',\n          skipRatio: 1,\n          play: false,\n          managers: this.managers,\n          middleware: this.middleware\n        }).stickerPromise.catch(noop)\n      ]).then(([iconPlayer, aroundPlayer]) => {\n        const remove = () => {\n          // if(!isInDOM(div)) return;\n          iconPlayer.remove();\n          div.remove();\n          this.stickerContainer.classList.remove('has-animation');\n        };\n\n        if(!aroundPlayer) {\n          remove();\n          return;\n        }\n\n        const removeOnFrame = () => {\n          // if(!isInDOM(div)) return;\n          fastRaf(remove);\n        };\n\n        iconPlayer.addEventListener('enterFrame', (frameNo) => {\n          if(frameNo === iconPlayer.maxFrame) {\n            if(this.wrapStickerPromise) { // wait for fade in animation\n              this.wrapStickerPromise.then(() => {\n                setTimeout(removeOnFrame, 1e3);\n              });\n            } else {\n              removeOnFrame();\n            }\n          }\n        });\n\n        iconPlayer.addEventListener('firstFrame', () => {\n          this.stickerContainer.append(div);\n          this.stickerContainer.classList.add('has-animation');\n          iconPlayer.play();\n          aroundPlayer.play();\n        }, {once: true});\n      });\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport {Middleware, MiddlewareHelper} from '../../helpers/middleware';\nimport {Message, ReactionCount} from '../../layer';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport reactionsEqual from '../../lib/appManagers/utils/reactions/reactionsEqual';\nimport rootScope from '../../lib/rootScope';\nimport ReactionElement, {ReactionLayoutType, REACTION_DISPLAY_BLOCK_COUNTER_AT} from './reaction';\n\nconst CLASS_NAME = 'reactions';\nconst TAG_NAME = CLASS_NAME + '-element';\n\nconst REACTIONS_ELEMENTS: Map<string, Set<ReactionsElement>> = new Map();\nexport {REACTIONS_ELEMENTS};\n\nexport default class ReactionsElement extends HTMLElement {\n  private message: Message.message;\n  private key: string;\n  private isPlaceholder: boolean;\n  private type: ReactionLayoutType;\n  private sorted: ReactionElement[];\n  private onConnectCallback: () => void;\n  private managers: AppManagers;\n  private middleware: Middleware;\n  private middlewareHelpers: Map<ReactionElement, MiddlewareHelper>;\n\n  constructor() {\n    super();\n    this.classList.add(CLASS_NAME);\n    this.sorted = [];\n    this.middlewareHelpers = new Map();\n    this.managers = rootScope.managers;\n  }\n\n  connectedCallback() {\n    let set = REACTIONS_ELEMENTS.get(this.key);\n    if(!set) {\n      REACTIONS_ELEMENTS.set(this.key, set = new Set());\n    }\n\n    set.add(this);\n\n    if(this.onConnectCallback && this.isConnected) {\n      this.onConnectCallback();\n      this.onConnectCallback = undefined;\n    }\n  }\n\n  disconnectedCallback() {\n    const set = REACTIONS_ELEMENTS.get(this.key);\n    set.delete(this);\n    if(!set.size) {\n      REACTIONS_ELEMENTS.delete(this.key);\n    }\n  }\n\n  public getReactionCount(reactionElement: ReactionElement) {\n    return this.sorted[this.sorted.indexOf(reactionElement)].reactionCount;\n  }\n\n  public getMessage() {\n    return this.message;\n  }\n\n  public init(\n    message: Message.message,\n    type: ReactionLayoutType,\n    middleware: Middleware,\n    isPlaceholder = this.isPlaceholder\n  ) {\n    if(this.key !== undefined) {\n      this.disconnectedCallback();\n    }\n\n    if(this.middleware !== middleware) {\n      middleware.onDestroy(() => {\n        this.middlewareHelpers.clear();\n      });\n    }\n\n    this.message = message;\n    this.key = this.message.peerId + '_' + this.message.mid;\n    this.middleware = middleware;\n    this.isPlaceholder = isPlaceholder;\n\n    if(this.type !== type) {\n      this.type = type;\n      this.classList.add(CLASS_NAME + '-' + type);\n    }\n\n    this.connectedCallback();\n  }\n\n  public changeMessage(message: Message.message) {\n    return this.init(message, this.type, this.middleware);\n  }\n\n  public update(message: Message.message, changedResults?: ReactionCount[]) {\n    this.message = message;\n    this.render(changedResults);\n  }\n\n  public render(changedResults?: ReactionCount[]) {\n    const reactions = this.message.reactions;\n    const hasReactions = !!(reactions && reactions.results.length);\n    this.classList.toggle('has-no-reactions', !hasReactions);\n    if(!hasReactions && !this.sorted.length) return;\n\n    const availableReactionsResult = this.managers.appReactionsManager.getAvailableReactions();\n    // callbackify(availableReactionsResult, () => {\n    const counts = hasReactions ? (\n      reactions.results\n        // availableReactionsResult instanceof Promise ?\n        //   reactions.results :\n        //   reactions.results.filter((reactionCount) => {\n        //     return this.managers.appReactionsManager.isReactionActive(reactionCount.reaction);\n        //   })\n      ) : [];\n\n    if(this.message.peerId.isUser()) {\n      counts.sort((a, b) => (b.count - a.count) || ((b.chosen_order ?? 0) - (a.chosen_order ?? 0)));\n    } else {\n      counts.sort((a, b) => (b.count - a.count) || ((a.chosen_order ?? 0) - (b.chosen_order ?? 0)));\n    }\n\n    forEachReverse(this.sorted, (reactionElement, idx, arr) => {\n      const reaction = reactionElement.reactionCount.reaction;\n      const found = counts.some((reactionCount) => reactionsEqual(reactionCount.reaction, reaction));\n      if(!found) {\n        const middlewareHelper = this.middlewareHelpers.get(reactionElement);\n        middlewareHelper.destroy();\n        this.middlewareHelpers.delete(reactionElement);\n        arr.splice(idx, 1);\n        reactionElement.remove();\n      }\n    });\n\n    const totalReactions = counts.reduce((acc, c) => acc + c.count, 0);\n    const canRenderAvatars = reactions && (!!reactions.pFlags.can_see_list || this.message.peerId.isUser()) && totalReactions < REACTION_DISPLAY_BLOCK_COUNTER_AT;\n    this.sorted = counts.map((reactionCount, idx) => {\n      let reactionElement = this.sorted.find((reactionElement) => reactionsEqual(reactionElement.reactionCount.reaction, reactionCount.reaction));\n      if(!reactionElement) {\n        const middlewareHelper = this.middleware.create();\n        reactionElement = new ReactionElement();\n        reactionElement.init(this.type, middlewareHelper.get());\n        this.middlewareHelpers.set(reactionElement, middlewareHelper);\n      }\n\n      positionElementByIndex(reactionElement, this, idx);\n\n      const recentReactions = reactions.recent_reactions ? reactions.recent_reactions.filter((reaction) => reactionsEqual(reaction.reaction, reactionCount.reaction)) : [];\n      reactionElement.reactionCount = {...reactionCount};\n      reactionElement.setCanRenderAvatars(canRenderAvatars);\n      reactionElement.render(this.isPlaceholder);\n      reactionElement.renderCounter();\n      reactionElement.renderAvatars(recentReactions);\n      reactionElement.setIsChosen();\n\n      return reactionElement;\n    });\n\n    // this.sorted.forEach((reactionElement, idx) => {\n    //   /* if(this.type === 'block' && this.childElementCount !== this.sorted.length) { // because of appended time\n    //     idx += 1;\n    //   } */\n\n    //   positionElementByIndex(reactionElement, this, idx);\n    // });\n\n    if(!this.isPlaceholder && changedResults?.length) {\n      if(this.isConnected) {\n        this.handleChangedResults(changedResults);\n      } else {\n        this.onConnectCallback = () => {\n          this.handleChangedResults(changedResults);\n        };\n      }\n    }\n    // });\n\n    // !       ,     \n    if(!this.sorted.length && this.type === 'block') {\n      const parentElement = this.parentElement;\n      this.remove();\n\n      if(parentElement.classList.contains('document-message') && !parentElement.childNodes.length) {\n        parentElement.remove();\n        return;\n      }\n\n      const timeSpan = this.querySelector('.time');\n      if(timeSpan) {\n        parentElement.append(timeSpan);\n      }\n    }\n  }\n\n  private handleChangedResults(changedResults: ReactionCount[]) {\n    // ! temp\n    if(this.message.peerId !== appImManager.chat.peerId) return;\n\n    changedResults.forEach((reactionCount) => {\n      const reactionElement = this.sorted.find((reactionElement) => reactionsEqual(reactionElement.reactionCount.reaction, reactionCount.reaction));\n      reactionElement?.fireAroundAnimation();\n    });\n  }\n}\n\ncustomElements.define(TAG_NAME, ReactionsElement);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport Scrollable from '../components/scrollable';\nimport {MOUNT_CLASS_TO} from '../config/debug';\nimport {IS_SAFARI} from '../environment/userAgent';\nimport getVisibleRect from './dom/getVisibleRect';\nimport reflowScrollableElement from './dom/reflowScrollableElement';\n\nexport default class ScrollSaver {\n  private scrollHeight: number;\n  private scrollHeightMinusTop: number;\n  private scrollTop: number;\n  private clientHeight: number;\n  private elements: {element: HTMLElement, rect: DOMRect}[];\n\n  /**\n   *\n   * @param scrollable to reset scroll position and direction\n   * @param reverse true means top\n   */\n  constructor(\n    private scrollable: Scrollable,\n    private query: string,\n    private reverse: boolean\n  ) {\n\n  }\n\n  private get container() {\n    return this.scrollable.container;\n  }\n\n  public getSaved() {\n    return {\n      scrollHeight: this.scrollHeight,\n      scrollTop: this.scrollTop,\n      clientHeight: this.clientHeight\n    };\n  }\n\n  public findElements() {\n    if(!this.query) return [];\n\n    const {container} = this;\n    const containerRect = container.getBoundingClientRect();\n    const bubbles = Array.from(container.querySelectorAll(this.query)) as HTMLElement[];\n    const elements: ScrollSaver['elements'] = [];\n    for(const bubble of bubbles) {\n      const elementRect = bubble.getBoundingClientRect();\n      const visibleRect = getVisibleRect(bubble, container, undefined, elementRect, containerRect);\n      if(visibleRect) {\n        elements.push({element: bubble, rect: elementRect});\n        // break; // find first\n      } else if(elements.length) { // find last\n        break;\n      }\n    }\n\n    if(!elements.length) {\n      const bubble = bubbles[0];\n      if(bubble) {\n        elements.push({element: bubble, rect: bubble.getBoundingClientRect()});\n      }\n    }\n\n    return elements;\n  }\n\n  public replaceSaved(from: HTMLElement, to: HTMLElement) {\n    if(!this.elements) {\n      return;\n    }\n\n    const idx = this.elements.findIndex(({element}) => from === element);\n    if(idx !== -1) {\n      this.elements[idx].element = to;\n    }\n  }\n\n  public findAndSetElements() {\n    this.elements = this.findElements();\n  }\n\n  public save() {\n    this.findAndSetElements();\n    // console.warn('scroll save', this.elements);\n    this._save();\n  }\n\n  public _save() {\n    const {scrollTop, scrollHeight, clientHeight} = this.container;\n\n    // previousScrollHeight = scrollHeight;\n    // previousScrollHeight = scrollHeight + padding;\n    this.scrollHeight = scrollHeight;\n    this.scrollTop = scrollTop;\n    this.clientHeight = clientHeight;\n    this.scrollHeightMinusTop = this.reverse ? scrollHeight - scrollTop : scrollTop;\n\n    // this.chatInner.style.paddingTop = padding + 'px';\n    /* if(reverse) {\n      previousScrollHeightMinusTop = this.scrollable.scrollHeight - scrollTop;\n    } else {\n      previousScrollHeightMinusTop = scrollTop;\n    } */\n  }\n\n  private onRestore(useReflow?: boolean) {\n    if(IS_SAFARI && useReflow/*  && !isAppleMobile */) { // * fix blinking and jumping\n      reflowScrollableElement(this.container);\n    }\n  }\n\n  private setScrollTop(newScrollTop: number, useReflow?: boolean) {\n    // touchSupport for safari iOS\n    // isTouchSupported && isApple && (container.container.style.overflow = 'hidden');\n    this.scrollable.setScrollTopSilently(this.scrollTop = newScrollTop);\n    // container.scrollTop = scrollHeight;\n    // isTouchSupported && isApple && (container.container.style.overflow = '');\n\n    this.onRestore(useReflow);\n  }\n\n  public restore(useReflow?: boolean) {\n    const {scrollTop, scrollHeight} = this.scrollable;\n    this.scrollHeight = scrollHeight;\n\n    if(!this.elements.length) { // maybe all messages have been deleted\n      this._restore(useReflow);\n      return;\n    }\n\n    let anchor: ScrollSaver['elements'][0];\n    // for(let i = this.elements.length - 1; i >= 0; --i) {\n    //   const _anchor = this.elements[i];\n    //   if(_anchor.element.parentElement) {\n    //     anchor = _anchor;\n    //     break;\n    //   }\n    // }\n    anchor = this.elements[this.elements.length - 1];\n\n    if(!anchor?.element?.parentElement) { // try to find new anchor\n      this.findAndSetElements();\n      anchor = this.elements[this.elements.length - 1];\n\n      if(!anchor) { // fallback to old method if smth is really strange\n        this._restore(useReflow);\n        return;\n      }\n    }\n\n    const {element, rect} = anchor;\n    const newRect = element.getBoundingClientRect();\n    const diff = newRect.bottom - rect.bottom;\n    this.setScrollTop(scrollTop + diff, useReflow);\n    // if(diff) debugger;\n    // console.warn('scroll restore', rect, diff, newRect);\n  }\n\n  public _restore(useReflow?: boolean) {\n    const {scrollHeightMinusTop: previousScrollHeightMinusTop, scrollable} = this;\n    // if(previousScrollHeightMinusTop === undefined) {\n    //   throw new Error('scroll was not saved');\n    // }\n\n    // const scrollHeight = container.scrollHeight;\n    const scrollHeight = this.scrollHeight;\n    // if(scrollHeight === this.scrollHeight) {\n    //   return;\n    // }\n\n    // this.scrollHeight = scrollHeight;\n\n    /* const scrollHeight = container.scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (10000 - addedHeight) + 'px'; */\n    /* const scrollHeight = scrollHeight;\n    const addedHeight = scrollHeight - previousScrollHeight;\n\n    this.chatInner.style.paddingTop = (padding - addedHeight) + 'px';\n\n    //const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = reverse ? scrollHeight - addedHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    this.log('performHistoryResult: will set scrollTop',\n    previousScrollHeightMinusTop, scrollHeight,\n    newScrollTop, container.container.clientHeight); */\n    // const newScrollTop = reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n    const newScrollTop = this.reverse ? scrollHeight - previousScrollHeightMinusTop : previousScrollHeightMinusTop;\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: will set up scrollTop:', newScrollTop, this.isHeavyAnimationInProgress);\n    } */\n\n    this.setScrollTop(newScrollTop, useReflow);\n\n    /* if(DEBUG) {\n      this.log('performHistoryResult: have set up scrollTop:', newScrollTop, container.scrollTop, container.scrollHeight, this.isHeavyAnimationInProgress);\n    } */\n  }\n}\n\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.ScrollSaver = ScrollSaver);\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport type IntersectionTarget = Element;\nexport type IntersectionCallback = (entry: IntersectionObserverEntry) => void;\n\nexport default class SuperIntersectionObserver {\n  private observing: Map<IntersectionTarget, Set<IntersectionCallback>>;\n  private observingQueue: SuperIntersectionObserver['observing'];\n  private observer: IntersectionObserver;\n  private freezedObservingNew: boolean;\n\n  constructor(init?: IntersectionObserverInit) {\n    this.observing = new Map();\n    this.observingQueue = new Map();\n    this.freezedObservingNew = false;\n\n    this.observer = new IntersectionObserver((entries) => {\n      const observing = this.observing;\n      for(let i = 0, length = entries.length; i < length; ++i) {\n        const entry = entries[i];\n        const callbacks = observing.get(entry.target);\n        if(!callbacks) {\n          debugger;\n        }\n\n        for(const callback of callbacks) {\n          try {\n            callback(entry);\n          } catch(err) {\n            console.error('intersection process callback error:', err);\n          }\n        }\n      }\n    }, init);\n  }\n\n  public disconnect() {\n    this.observing.clear();\n    this.observingQueue.clear();\n    this.observer.disconnect();\n  }\n\n  public toggleObservingNew(value: boolean) {\n    if(this.freezedObservingNew === value) {\n      return;\n    }\n\n    this.freezedObservingNew = value;\n\n    const queue = this.observingQueue;\n    if(!value && queue.size) {\n      for(const [target, callbacks] of queue) {\n        for(const callback of callbacks) {\n          this.observe(target, callback);\n        }\n      }\n\n      queue.clear();\n    }\n  }\n\n  public has(target: IntersectionTarget, callback: IntersectionCallback, observing = this.observing) {\n    const callbacks = observing.get(target);\n    return !!(callbacks && callbacks.has(callback));\n  }\n\n  public observe(target: IntersectionTarget, callback: IntersectionCallback) {\n    if(this.freezedObservingNew && this.has(target, callback)) {\n      return;\n    }\n\n    const observing = this.freezedObservingNew ? this.observingQueue : this.observing;\n    let callbacks = observing.get(target);\n    if(callbacks && callbacks.has(callback)) {\n      return;\n    }\n\n    if(!callbacks) {\n      callbacks = new Set();\n      observing.set(target, callbacks);\n\n      if(observing === this.observing) {\n        this.observer.observe(target);\n      }\n    }\n\n    callbacks.add(callback);\n  }\n\n  public unobserve(target: IntersectionTarget, callback: IntersectionCallback) {\n    const observing = this.freezedObservingNew && !this.has(target, callback) ? this.observingQueue : this.observing;\n    const callbacks = observing.get(target);\n    if(!callbacks) {\n      return;\n    }\n\n    callbacks.delete(callback);\n    if(!callbacks.size) {\n      observing.delete(target);\n      this.observer.unobserve(target);\n    }\n  }\n}\n","import type {MyDocument} from '../../appDocsManager';\nimport type {MyMessage} from '../../appMessagesManager';\nimport {Message, MessageMedia} from '../../../../layer';\n\nexport default function isMentionUnread(message: MyMessage) {\n  if(!message) {\n    return false;\n  }\n\n  const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as MyDocument;\n  return !!(\n    message.pFlags.media_unread &&\n    message.pFlags.mentioned &&\n    (\n      !doc ||\n      !(['voice', 'round'] as MyDocument['type'][]).includes(doc.type)\n    )\n  );\n}\n","export default function accumulate(arr: number[], initialValue: number) {\n  return arr.reduce((acc, value) => acc + value, initialValue);\n}\n","function cacheCallback<A, T>(callback: (str: A) => T) {\n  const stringResults: any = {}, numberResults: any = {};\n  return (value: A): T => {\n    const key = '_' + value;\n    return (typeof(value) === 'string' ? stringResults : numberResults)[key] ??= callback(value);\n  };\n}\n\nexport default cacheCallback;\n","export default function replaceNonNumber(str: string) {\n  return str.replace(/\\D/g, '');\n}\n","import cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nconst CARD_BRAND_REGEXP: {[brand: string]: RegExp} = {\n  visa: /^4/,\n  mastercard: /^(51|52|53|54|55|222|23|24|25|26|27)/,\n  amex: /^(34|37)/,\n  discover: /^(60|64|65)/,\n  diners: /^(30|38|39)/,\n  diners14: /^(36)/,\n  jcb: /^(35)/,\n  unionpay: /^(62[0-6,8-9]|627[0-6,8-9]|6277[0-7,9]|62778[1-9]|81)/,\n  elo: /^(5067|509|636368|627780)/,\n  mir: /^(220[0-4])/\n};\n\n// * taken from Stripe\nexport const CARD_BRANDS: {[b: string]: {\n  minLength: number,\n  maxLength: number,\n  cvcMaxLength: number,\n  cvcMinLength: number | null\n}} = {\n  visa: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mastercard: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  amex: {\n    minLength: 15,\n    maxLength: 15,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  },\n  unionpay: {\n    minLength: 13,\n    maxLength: 19,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  diners14: {\n    minLength: 14,\n    maxLength: 14,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  discover: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  jcb: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  elo: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  mir: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 3,\n    cvcMinLength: null\n  },\n  unknown: {\n    minLength: 16,\n    maxLength: 16,\n    cvcMaxLength: 4,\n    cvcMinLength: 3\n  }\n};\n\nexport const detectCardBrand = cacheCallback((card: string = '') => {\n  const keys = Object.keys(CARD_BRAND_REGEXP);\n  const sanitizedCard = replaceNonNumber(card);\n  let brand: string;\n  let last = 0;\n  keys.forEach((key) => {\n    const regExp = CARD_BRAND_REGEXP[key];\n    const match = sanitizedCard.match(regExp);\n    if(match) {\n      const result = match[0];\n      if(result && result.length > last) {\n        brand = key;\n        last = result.length;\n      }\n    }\n  });\n\n  return brand || 'unknown';\n});\n\nexport function cardBrandToUnifiedBrand(brand: string) {\n  return brand === 'diners14' ? 'diners' : brand;\n}\n\nexport function detectUnifiedCardBrand(card = '') {\n  const brand = detectCardBrand(card);\n  return cardBrandToUnifiedBrand(brand);\n}\n","export default function createArray<T1>(length: number, fill?: T1, map?: any): T1[] {\n  const arr = new Array<T1>(length);\n  arr.fill(fill);\n  return map ? arr.map(map) : arr;\n}\n","const delta = ''.charCodeAt(0) - '0'.charCodeAt(0);\nconst buggedRegExp = /[-]/g;\n\n// function hasBuggedNumbers(str: string) {\n//   return !!str.match(a);\n// }\n\nfunction getDistanceFromBuggedToNormal(char: string) {\n  return String.fromCharCode(char.charCodeAt(0) - delta);\n}\n\nexport function fixBuggedNumbers(str: string) {\n  return str.replace(buggedRegExp, getDistanceFromBuggedToNormal);\n}\n","import {fixBuggedNumbers} from '../string/buggedNumbers';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternCharacter = {\n  type: 'optional',\n  result: string,\n  consumed: number\n} | {\n  type: 'required',\n  result: string,\n  consumed: number,\n  partial?: boolean\n} | {\n  type: 'formatting',\n  result: string,\n  consumed: number\n};\n\nexport type PatternFunction = (str: string) => ((str: string) => PatternCharacter)[];\n\nfunction makeOptionalCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'optional', result, consumed};\n}\n\nfunction makeRequiredCharacter(result: string, consumed: number, partial?: boolean): PatternCharacter {\n  return {type: 'required', result, consumed, partial};\n}\n\nfunction makeFormattingCharacter(result: string, consumed: number): PatternCharacter {\n  return {type: 'formatting', result, consumed};\n}\n\nfunction wrapCharacterRegExpFactory(regExp: RegExp, optional?: boolean) {\n  return (str: string) => {\n    const _regExp = new RegExp('^'.concat(regExp.source.replace(/^\\^/, '')));\n    const match = str.match(_regExp);\n    const makeCharacter = optional ? makeOptionalCharacter : makeRequiredCharacter;\n    if(match) {\n      const result = match[0];\n      return makeCharacter(result, match.index + result.length);\n    }\n\n    return makeCharacter('', str.length);\n  };\n}\n\nfunction makeCapitalPatternCharacter(str: string) {\n  const char = wrapCharacterRegExpFactory(/\\w/)(str);\n  return char.result ? makeRequiredCharacter(char.result.toUpperCase(), char.consumed) : char;\n}\n\nconst makeMonthDigitPatternCharacter = wrapCharacterRegExpFactory(/1[0-2]|0?[1-9]|0/);\n\nfunction digit(str: string) {\n  return wrapCharacterRegExpFactory(/[0-9]/)(fixBuggedNumbers(str));\n}\n\nconst patternCharacters = {\n  digit,\n  capitalCharacter: makeCapitalPatternCharacter,\n  month: (str: string) => {\n    const char = makeMonthDigitPatternCharacter(fixBuggedNumbers(str));\n    const cleanedResult = replaceNonNumber(char.result);\n    const isPartial = ['0', '1'].includes(char.result) && str.length === 1;\n    if(isPartial || (char.result === '0' && str.length >= 2)) {\n      return makeRequiredCharacter(char.result, str.length, true);\n    }\n\n    return makeRequiredCharacter(cleanedResult.length === 1 ? '0' + cleanedResult : cleanedResult, char.consumed);\n  },\n  formattingCharacter: (str: string) => {\n    return (str1: string) => {\n      const consumed = str === str1[0] ? 1 : 0;\n      return makeFormattingCharacter(str, consumed);\n    }\n  },\n  optionalPattern: (regExp: RegExp) => {\n    return (str: string) => {\n      const char = wrapCharacterRegExpFactory(regExp, true)(str);\n      return char.result ? char : makeOptionalCharacter('', 0);\n    };\n  }\n};\n\nexport default patternCharacters;\n","import {IS_ANDROID} from '../../environment/userAgent';\nimport createArray from '../array/createArray';\nimport cacheCallback from '../cacheCallback';\nimport replaceNonNumber from '../string/replaceNonNumber';\nimport {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport patternCharacters from './patternCharacters';\n\nconst digit = patternCharacters.digit;\nconst capitalCharacter = patternCharacters.capitalCharacter;\nconst spaceCharacter = patternCharacters.formattingCharacter(' ');\nconst yearOptionalPattern = patternCharacters.optionalPattern(/\\d\\d/);\nconst sixteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit];\nconst fifteenPattern = [digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit, digit, digit, spaceCharacter, digit, digit, digit, digit];\n\nconst requiredPostcodes = new Set(['DZ', 'AR', 'AM', 'AU', 'AT', 'AZ', 'PT', 'BD', 'BY', 'BE', 'BA', 'BR', 'BN', 'BG', 'CA', 'IC', 'CN', 'CO', 'HR', 'CY', 'CZ', 'DK', 'EC', 'GB', 'EE', 'FO', 'FI', 'FR', 'GE', 'DE', 'GR', 'GL', 'GU', 'GG', 'NL', 'HU', 'IN', 'ID', 'IL', 'IT', 'JP', 'JE', 'KZ', 'KR', 'FM', 'KG', 'LV', 'LI', 'LT', 'LU', 'MK', 'MG', 'PT', 'MY', 'MH', 'MQ', 'YT', 'MX', 'MN', 'ME', 'NL', 'NZ', 'GB', 'NO', 'PK', 'PH', 'PL', 'FM', 'PT', 'PR', 'RE', 'RU', 'SA', 'SF', 'RS', 'SG', 'SK', 'SI', 'ZA', 'ES', 'LK', 'SX', 'VI', 'VI', 'SE', 'CH', 'TW', 'TJ', 'TH', 'TU', 'TN', 'TR', 'TM', 'VI', 'UA', 'GB', 'US', 'UY', 'UZ', 'VA', 'VN', 'GB', 'FM']);\n\nconst generateFourPattern = cacheCallback((length: number) => {\n  const out: Array<typeof digit | typeof spaceCharacter> = [];\n\n  for(let i = 0, k = 0; i < length;) {\n    if(k === 4) {\n      out.push(spaceCharacter);\n      k = 0;\n    } else {\n      out.push(digit);\n      ++i;\n      ++k;\n    }\n  }\n\n  return out;\n});\n\nfunction generateCardNumberPattern(card: string) {\n  const brand = detectCardBrand(card);\n  if(brand === 'amex') return sixteenPattern;\n  if(brand === 'diners14') return fifteenPattern;\n  const {minLength, maxLength} = CARD_BRANDS[brand];\n  const s = replaceNonNumber(card).length;\n  const d = Math.min(Math.max(minLength, s), maxLength);\n  return generateFourPattern(d);\n}\n\nconst cardFormattingPatterns = {\n  cardNumber: generateCardNumberPattern,\n  cardExpiry: () => [patternCharacters.month, patternCharacters.formattingCharacter('/'), digit, digit, yearOptionalPattern],\n  cardCvc: (card?: string) => cardFormattingPatterns.cardCvcFromBrand(detectCardBrand(card)),\n  cardCvcFromBrand: cacheCallback((brand: string) => {\n    const info = CARD_BRANDS[brand];\n    const {cvcMinLength, cvcMaxLength} = info;\n    const pattern = createArray(cvcMinLength || cvcMaxLength, digit);\n    if(cvcMinLength && cvcMinLength < cvcMaxLength) {\n      const i = cvcMaxLength - cvcMinLength;\n      const h = patternCharacters.optionalPattern(/\\d/);\n      if(i) {\n        pattern.push(...createArray(i, h));\n      }\n    }\n\n    return pattern;\n  }),\n  postalCodeFromCountry: cacheCallback((iso2: string) => {\n    switch(iso2) {\n      case 'US':\n        return createArray(5, digit);\n      case 'CA':\n        return IS_ANDROID ? null : [capitalCharacter, capitalCharacter, capitalCharacter, spaceCharacter, capitalCharacter, capitalCharacter, capitalCharacter];\n      default:\n        const optionalDigits = createArray(10, patternCharacters.optionalPattern(/\\d/));\n        if(requiredPostcodes.has(iso2)) {\n          optionalDigits[0] = digit;\n        }\n        return optionalDigits;\n    }\n  })\n};\n\nexport default cardFormattingPatterns;\n","import accumulate from '../array/accumulate';\nimport {PatternFunction} from './patternCharacters';\n\nfunction accumulateLengths(strs: string[]) {\n  return accumulate(strs.map((str) => str.length), 0);\n}\n\nfunction formatValueByPattern(\n  getPattern: PatternFunction,\n  value: string,\n  options: Partial<{\n    selectionStart: number,\n    selectionEnd: number\n  }> = {},\n  pushRest?: boolean\n) {\n  const pattern = getPattern(value);\n\n  if(!pattern) {\n    return {\n      value: value,\n      selection: null as typeof options,\n      autocorrectComplete: !!value\n    };\n  }\n\n  const length = pattern.length;\n  const c: string[] = [];\n  const s: string[] = [];\n\n  let l = 0;\n  let i = 0;\n  let f = options.selectionStart === 0 ? 0 : null;\n  let d = options.selectionEnd === 0 ? 0 : null;\n  const p = () => {\n    if(f === null && (i + 1) >= options.selectionStart) f = accumulateLengths(c) + (pushRest ? s.length : 0);\n    if(d === null && (i + 1) >= options.selectionEnd) d = accumulateLengths(c) + (pushRest ? s.length : 0);\n  };\n  const m = (e: number) => {\n    if(e > 0) {\n      p();\n      i += e;\n    }\n  };\n\n  for(; l < length;) {\n    const getCharacter = pattern[l];\n    const character = getCharacter(value.slice(i));\n    const {type, result, consumed} = character;\n    if(type === 'required') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        ++l;\n\n        if(character.partial) {\n          m(value.length - i);\n          break;\n        }\n\n        m(consumed);\n      } else {\n        if(!consumed) {\n          break;\n        }\n\n        m(1);\n      }\n    } else if(type === 'optional') {\n      if(result) {\n        c.push(...s, result);\n        s.length = 0;\n        m(consumed);\n      }\n\n      ++l;\n    } else if(type === 'formatting') {\n      if(!pushRest && i >= value.length) {\n        break;\n      }\n\n      s.push(result);\n      ++l;\n      m(consumed);\n    }\n  }\n\n  if(pushRest) {\n    c.push(...s);\n  }\n\n  return {\n    value: c.join(''),\n    selection: {\n      selectionStart: f === null || value.length && options.selectionStart === value.length ? accumulateLengths(c) : f,\n      selectionEnd: d === null || value.length && options.selectionEnd === value.length ? accumulateLengths(c) : d\n    },\n    autocorrectComplete: l === length\n  };\n}\n\nexport default formatValueByPattern;\n","import {CARD_BRANDS, detectCardBrand} from './cardBrands';\nimport formatInputValueByPattern from './formatInputValueByPattern';\nimport NBSP from '../string/nbsp';\nimport replaceNonNumber from '../string/replaceNonNumber';\n\nexport type PatternValidationOptions = Partial<{\n  ignoreIncomplete: boolean\n}>;\n\nconst nbspRegExp = new RegExp(NBSP, 'g');\n\nfunction makeValidationError(code?: string) {\n  return code ? {\n    type: 'invalid',\n    code\n  } : null;\n}\n\n// Luhn algorithm\nfunction validateCompleteCardNumber(card: string) {\n  const t = '0'.charCodeAt(0);\n  const n = card.length % 2;\n  let a = 0;\n  for(let i = card.length - 1; i >= 0; --i) {\n    const c = n === (i % 2);\n    let o = card.charCodeAt(i) - t;\n    if(c) o *= 2;\n    if(o > 9) o -= 9;\n    a += o;\n  }\n  return !(a % 10);\n}\n\nfunction validateExpiry(year: number, month: number, options?: PatternValidationOptions) {\n  const date = new Date(Date.now());\n  const _year = year < 100 ? date.getFullYear() % 100 : date.getFullYear();\n  const nextMonth = date.getMonth() + 1;\n\n  if(isNaN(year) || isNaN(month)) {\n    return options?.ignoreIncomplete ? null : 'incomplete';\n  }\n\n  if((year - _year) < 0) {\n    return 'invalid_expiry_year_past';\n  }\n\n  if((year - _year) > 50) {\n    return 'invalid_expiry_year';\n  }\n\n  return !(year - _year) && month < nextMonth ? 'invalid_expiry_month_past' : null;\n}\n\nfunction getCardInfoByNumber(card: string) {\n  const sanitized = replaceNonNumber(card);\n  const brand = detectCardBrand(card);\n  return {\n    sanitized,\n    brand,\n    minLength: CARD_BRANDS[brand].minLength\n  };\n}\n\nfunction makeCardNumberError(str: string, length: number, ignoreIncomplete: boolean) {\n  if(str.length >= length) {\n    return validateCompleteCardNumber(str) || detectCardBrand(str) === 'mir' ? null : makeValidationError('invalid');\n  }\n\n  return ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n\nexport function validateCardNumber(str: string, options: PatternValidationOptions = {}) {\n  const {sanitized, minLength} = getCardInfoByNumber(str);\n  return makeCardNumberError(sanitized, minLength, options.ignoreIncomplete);\n}\n\nexport function validateCardExpiry(str: string, options: PatternValidationOptions = {}) {\n  const sanitized = str.replace(nbspRegExp, '').split(/ ?\\/ ?/);\n  const [monthStr, yearStr = ''] = sanitized;\n  const [month, year] = [monthStr, yearStr].map((str) => +str);\n  const s = yearStr.length === 2 ? year % 100 : year;\n  return yearStr.length < 2 || yearStr.length === 3 ? (options.ignoreIncomplete ? null : makeValidationError('incomplete')) : makeValidationError(validateExpiry(s, month, options));\n}\n\nexport function validateAnyIncomplete(formatted: ReturnType<typeof formatInputValueByPattern>, str: string, options: PatternValidationOptions = {}) {\n  return formatted.meta.autocorrectComplete || options.ignoreIncomplete ? null : makeValidationError('incomplete');\n}\n","const NBSP = '';\nexport default NBSP;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport {TelegramWebviewEventCallback} from '../../types';\n\nconst weakMap: WeakMap<Window, TelegramWebviewEventCallback> = new WeakMap();\nwindow.addEventListener('message', (e) => {\n  const callback = weakMap.get(e.source as Window);\n  if(!callback) {\n    return;\n  }\n\n  callback(JSON.parse(e.data));\n});\n\nexport function createVerificationIframe(url: string, callback: TelegramWebviewEventCallback) {\n  const iframe = document.createElement('iframe');\n  // iframe.title = 'Complete Payment';\n  iframe.allow = 'payment';\n  // iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-top-navigation allow-modals');\n  iframe.setAttribute('sandbox', 'allow-forms allow-scripts allow-same-origin allow-modals');\n  iframe.classList.add('payment-verification');\n  iframe.src = url;\n\n  iframe.addEventListener('load', () => {\n    weakMap.set(iframe.contentWindow, callback);\n  }, {once: true});\n\n  return iframe;\n}\n\nexport default class PopupPaymentVerification extends PopupElement<{\n  finish: () => void\n}> {\n  constructor(private url: string) {\n    super('popup-payment popup-payment-verification', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      title: 'Checkout.WebConfirmation.Title'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const iframe = createVerificationIframe(this.url, (event) => {\n      if(event.eventType !== 'web_app_open_tg_link') {\n        return;\n      }\n\n      this.dispatchEvent('finish');\n      this.hide();\n      appImManager.openUrl('https://t.me' + event.eventData.path_full);\n    });\n\n    this.body.append(iframe);\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport cardFormattingPatterns from '../../helpers/cards/cardFormattingPatterns';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport formatInputValueByPattern from '../../helpers/cards/formatInputValueByPattern';\nimport {validateAnyIncomplete, validateCardExpiry, validateCardNumber} from '../../helpers/cards/validateCard';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport noop from '../../helpers/noop';\nimport {PaymentsPaymentForm} from '../../layer';\nimport {LangPackKey, _i18n} from '../../lib/langPack';\nimport {TelegramWebviewEvent} from '../../types';\nimport CheckboxField from '../checkboxField';\nimport confirmationPopup from '../confirmationPopup';\nimport CountryInputField from '../countryInputField';\nimport InputField, {InputFieldOptions, InputState} from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {getPaymentBrandIconPath, PaymentButton, PaymentsCredentialsToken} from './payment';\nimport {createVerificationIframe} from './paymentVerification';\n\nexport type PaymentCardDetails = {\n  cardNumber: string;\n  cardholderName: string;\n  expiryFull: string;\n  expiryMonth: string;\n  expiryYear: string;\n  cvc: string;\n  country: string;\n  zip: string;\n  save?: boolean;\n};\n\nexport type PaymentCardDetailsShort = {\n  title: string,\n  save?: boolean;\n  icon?: string;\n};\n\nexport type PaymentCardDetailsResult = PaymentCardDetails | PaymentCardDetailsShort;\n\nexport class InputFieldCorrected extends InputField {\n  private lastKeyDown: string;\n  private lastTransformed: ReturnType<typeof formatInputValueByPattern>;\n\n  constructor(public options: InputFieldOptions & {\n    formatMethod: typeof cardFormattingPatterns['cardNumber'],\n    validateMethod?: typeof validateCardNumber,\n    errorKeys?: {[code: string]: LangPackKey},\n    optional?: boolean,\n    onChange?: (transformed: InputFieldCorrected['lastTransformed']) => void,\n    onKeyDown?: (e: KeyboardEvent) => void\n  }) {\n    super(options);\n\n    // const handleIncomplete = (t?: any) => {\n    //   if(\n    //     (!lastTransformed.value && t) ||\n    //     lastTransformed.meta.autocorrectComplete ||\n    //     lastTransformed.meta.error ||\n    //     optional\n    //   ) {\n    //     return;\n    //   }\n\n\n    // };\n\n    this.input.addEventListener('keydown', this.onKeyDown);\n    this.input.addEventListener('input', this.onInput);\n    this.input.addEventListener('blur', this.onBlur);\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    this.lastKeyDown = e.key;\n    this.options.onKeyDown?.(e);\n  };\n\n  private onInput = () => {\n    const value = this.value;\n    const deleting = this.lastKeyDown === 'Backspace' && (((this.lastTransformed && this.lastTransformed.value.length) || 0) - value.length) === 1;\n    const result = this.lastTransformed = formatInputValueByPattern({\n      value: value,\n      getPattern: this.options.formatMethod,\n      deleting,\n      input: this.input\n    });\n\n    const transformedValue = result.value;\n    if(transformedValue !== value) {\n      this.setValueSilently(transformedValue);\n\n      if(result.selection) {\n        (this.input as HTMLInputElement).selectionStart = result.selection.selectionStart;\n        (this.input as HTMLInputElement).selectionEnd = result.selection.selectionEnd;\n      }\n    }\n\n    this.validateNew(transformedValue, {ignoreIncomplete: true/* !result.meta.autocorrectComplete */});\n\n    this.options.onChange?.(result);\n  };\n\n  private onBlur = () => {\n    const value = this.lastTransformed?.value;\n    if(value) {\n      this.validateNew(value);\n    }\n  };\n\n  public update() {\n    this.onInput();\n  }\n\n  public validate = () => {\n    return this.validateNew();\n  };\n\n  public validateNew(\n    value = this.lastTransformed?.value ?? '',\n    t: any = {},\n    justReturn?: boolean\n  ) {\n    let result: ReturnType<InputFieldCorrected['options']['validateMethod']>;\n    if(this.options.validateMethod) {\n      result = this.options.validateMethod?.(value, t);\n    } else {\n      result = validateAnyIncomplete(this.lastTransformed, value, t);\n    }\n\n    if(result?.code) {\n      const langPackKey: LangPackKey = this.options.errorKeys?.[result.code];\n      !justReturn && this.setState(InputState.Error, langPackKey);\n      return false;\n    }\n\n    !justReturn && this.setState(InputState.Neutral);\n    return true;\n  }\n}\n\nexport function handleInputFieldsOnChange(inputFields: (CountryInputField | InputField | InputFieldCorrected)[], _onChange: (valid: boolean) => void) {\n  const onChange = () => {\n    const valid = inputFields.every((inputField) => {\n      return 'validateNew' in inputField ? inputField.validateNew(undefined, undefined, true) : inputField.isValid();\n    });\n\n    _onChange(valid);\n  };\n\n  inputFields.forEach((inputField) => {\n    if(inputField instanceof InputFieldCorrected) {\n      const original = inputField.options.onChange;\n      inputField.options.onChange = (...args: any[]) => {\n        // @ts-ignore\n        original?.(...args);\n        onChange();\n      };\n\n      if('update' in inputField) {\n        inputField.update();\n      }\n    } else {\n      inputField.input.addEventListener('input', onChange);\n    }\n  });\n\n  return {validate: onChange};\n}\n\nexport function createCountryZipFields(country?: boolean, zip?: boolean) {\n  let countryInputField: CountryInputField, postcodeInputField: InputFieldCorrected;\n  if(country || zip) {\n    if(country) countryInputField = new CountryInputField({\n      noPhoneCodes: true,\n      onCountryChange: () => {\n        postcodeInputField?.update();\n      },\n      required: true,\n      autocomplete: 'country'\n    });\n    if(zip) postcodeInputField = new InputFieldCorrected({\n      label: 'PaymentShippingZipPlaceholder',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'postal-code',\n      formatMethod: (/* ...args */) => {\n        const {country} = countryInputField.getSelected();\n        const iso2 = country?.iso2;\n        return cardFormattingPatterns.postalCodeFromCountry(iso2 && iso2.toUpperCase());\n      }\n    });\n  }\n\n  return {countryInputField, postcodeInputField};\n}\n\nexport type PaymentsNativeProvider = 'stripe' | 'smartglocal';\nexport type PaymentsNativeParams = {\n  need_country?: boolean,\n  need_zip?: boolean,\n  need_cardholder_name?: boolean,\n  publishable_key?: string, // stripe\n  public_token?: string, // smartglocal\n  gpay_params: string,\n};\nconst SUPPORTED_NATIVE_PROVIDERS: Set<PaymentsNativeProvider> = new Set(['stripe', 'smartglocal']);\n\nexport default class PopupPaymentCard extends PopupElement<{\n  finish: (obj: {token: any, card: PaymentCardDetailsResult}) => void\n}> {\n  constructor(private paymentForm: PaymentsPaymentForm, private savedCard?: PaymentCardDetails) {\n    super('popup-payment popup-payment-card', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider),\n      title: 'PaymentCardInfo'\n    });\n\n    if(SUPPORTED_NATIVE_PROVIDERS.has(paymentForm.native_provider as PaymentsNativeProvider)) {\n      this.d();\n    } else {\n      const iframe = createVerificationIframe(paymentForm.url, (event) => {\n        if(event.eventType !== 'payment_form_submit') {\n          return;\n        }\n\n        const data = event.eventData;\n\n        const cardOut = {title: data.title, save: false} as any as PaymentCardDetails;\n        this.dispatchEvent('finish', {\n          token: data.credentials,\n          card: cardOut\n        });\n\n        this.hide();\n\n        if(paymentForm.pFlags.can_save_credentials) {\n          confirmationPopup({\n            titleLangKey: 'PaymentCardSavePaymentInformation',\n            descriptionLangKey: 'PaymentCardSavePaymentInformationInfoLine1',\n            button: {\n              langKey: 'Save'\n            }\n          }).then(() => {\n            cardOut.save = true;\n          }, noop);\n        }\n      });\n\n      // putPreloader(this.body, true);\n      this.body.append(iframe);\n      this.show();\n    }\n  }\n\n  private d() {\n    const savedCard = this.savedCard;\n    const cardSection = new SettingSection({name: 'PaymentInfo.Card.Title', noDelimiter: true, noShadow: true});\n\n    const nativeParams: PaymentsNativeParams = JSON.parse(this.paymentForm.native_params.data);\n\n    let lastBrand: string, brandIconTempId = 0, lastBrandImg: HTMLImageElement;\n    const setBrandIcon = (brand: string) => {\n      if(lastBrand === brand) {\n        return;\n      }\n\n      const tempId = ++brandIconTempId;\n      lastBrand = brand;\n\n      const path = getPaymentBrandIconPath(brand);\n      if(!path) {\n        if(lastBrandImg) {\n          lastBrandImg.remove();\n          lastBrandImg = undefined;\n        }\n\n        return;\n      }\n\n      const img = new Image();\n      img.classList.add('input-field-icon');\n      renderImageFromUrlPromise(img, path, false).then(() => {\n        if(brandIconTempId !== tempId) {\n          return;\n        }\n\n        if(lastBrandImg) {\n          lastBrandImg.replaceWith(img);\n        } else {\n          cardInputField.container.append(img);\n        }\n\n        lastBrandImg = img;\n      });\n    };\n    const cardInputField = new InputFieldCorrected({\n      label: 'PaymentCardNumber',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-number',\n      formatMethod: cardFormattingPatterns.cardNumber,\n      validateMethod: validateCardNumber,\n      errorKeys: {\n        invalid: 'PaymentCard.Error.Invalid',\n        incomplete: 'PaymentCard.Error.Incomplete'\n      },\n      onChange: (transformed) => {\n        setBrandIcon(detectUnifiedCardBrand(transformed.value));\n        cvcInputField.update(); // format cvc\n      }\n    });\n\n    let nameInputField: InputField;\n    if(nativeParams.need_cardholder_name) nameInputField = new InputField({\n      label: 'Checkout.NewCard.CardholderNamePlaceholder',\n      maxLength: 255,\n      required: true,\n      autocomplete: 'cc-name'\n    });\n\n    const expireInputField = new InputFieldCorrected({\n      label: 'SecureId.Identity.Placeholder.ExpiryDate',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-exp',\n      formatMethod: cardFormattingPatterns.cardExpiry,\n      validateMethod: validateCardExpiry\n    });\n\n    const cvcInputField = new InputFieldCorrected({\n      labelText: 'CVC',\n      plainText: true,\n      inputMode: 'numeric',\n      autocomplete: 'cc-csc',\n      formatMethod: () => cardFormattingPatterns.cardCvc(cardInputField.value)\n      // validateMethod: (...args) => _5AH3.a.cardCvc(cardInputField.value)(...args)\n    });\n\n    const switchFocusOrder: (InputFieldCorrected | InputField)[] = [\n      cardInputField,\n      expireInputField,\n      cvcInputField,\n      nameInputField\n    ].filter(Boolean);\n    switchFocusOrder.forEach((inputField) => {\n      const onKeyDown = (e: KeyboardEvent) => {\n        if(!inputField.value && e.key === 'Backspace') {\n          const previousInputField = switchFocusOrder[switchFocusOrder.indexOf(inputField) - 1];\n          if(previousInputField) {\n            // previousInputField.value = previousInputField.value.slice(0, -1);\n            placeCaretAtEnd(previousInputField.input, true);\n          }\n        }\n      };\n\n      if(inputField instanceof InputFieldCorrected) {\n        inputField.options.onKeyDown = onKeyDown;\n\n        const original = inputField.options.onChange;\n        inputField.options.onChange = (transformed) => {\n          original?.(transformed);\n\n          if(document.activeElement === inputField.input && transformed.meta.autocorrectComplete) {\n            for(let i = switchFocusOrder.indexOf(inputField), length = switchFocusOrder.length; i < length; ++i) {\n              const nextInputField = switchFocusOrder[i];\n              if(\n                nextInputField instanceof InputFieldCorrected ?\n                !nextInputField.validateNew(undefined, undefined, true) :\n                !nextInputField.value\n              ) {\n                placeCaretAtEnd(nextInputField.input, true);\n                break;\n              }\n            }\n          }\n        };\n      } else {\n        inputField.input.addEventListener('keydown', onKeyDown);\n      }\n    });\n\n    const inputFieldsRow = document.createElement('div');\n    inputFieldsRow.classList.add('input-fields-row');\n    inputFieldsRow.append(expireInputField.container, cvcInputField.container);\n\n    cardSection.content.append(...[\n      cardInputField.container,\n      inputFieldsRow,\n      nameInputField?.container\n    ].filter(Boolean));\n\n    let billingSection: SettingSection;\n    // let saveCheckboxField: CheckboxField;\n    const {countryInputField, postcodeInputField} = createCountryZipFields(nativeParams.need_country, nativeParams.need_zip);\n    if(nativeParams.need_country || nativeParams.need_zip) {\n      billingSection = new SettingSection({name: 'PaymentInfo.Billing.Title', noDelimiter: true, noShadow: true});\n\n      // const inputFieldsRow2 = inputFieldsRow.cloneNode() as HTMLElement;\n      // inputFieldsRow2.append(countryInputField.container, postcodeInputField.container);\n      // billingSection.content.append(inputFieldsRow2);\n      billingSection.content.append(...[countryInputField, postcodeInputField].filter(Boolean).map((i) => i.container));\n    }\n\n    const canSave = !!this.paymentForm.pFlags.can_save_credentials;\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentCardSavePaymentInformation',\n      checked: !!canSave\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: canSave ? 'PaymentCardSavePaymentInformationInfoLine1' : 'Checkout.2FA.Text',\n      noCheckboxSubtitle: true\n    });\n\n    if(!canSave) {\n      saveRow.container.classList.add('is-disabled');\n    }\n\n    (billingSection || cardSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[cardSection, billingSection].filter(Boolean).map((s) => s.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const data: PaymentCardDetails = {\n          cardNumber: cardInputField.value,\n          expiryFull: expireInputField.value,\n          expiryMonth: expireInputField.value.split('/')[0],\n          expiryYear: expireInputField.value.split('/')[1],\n          cvc: cvcInputField.value,\n\n          cardholderName: nameInputField?.value,\n          country: countryInputField?.value,\n          zip: postcodeInputField?.value,\n\n          save: saveCheckboxField?.checked\n        };\n\n        const nativeProvider: PaymentsNativeProvider = this.paymentForm.native_provider as any;\n        let out: PaymentsCredentialsToken;\n        if(nativeProvider === 'stripe') {\n          const url = new URL('https://api.stripe.com/v1/tokens');\n          url.search = new URLSearchParams({\n            'card[number]': data.cardNumber,\n            'card[exp_month]': data.expiryMonth,\n            'card[exp_year]': data.expiryYear,\n            'card[cvc]': data.cvc,\n            'card[address_zip]': data.zip,\n            'card[address_country]': data.country,\n            'card[name]': data.cardholderName\n          }).toString();\n\n          const response = await fetch(url.toString(), {\n            method: 'POST',\n            credentials: 'same-origin',\n            headers: {\n              'Content-Type': 'application/x-www-form-urlencoded',\n              'Authorization': `Bearer ${nativeParams.publishable_key}`\n            }\n          });\n\n          out = await response.json();\n        } else if(nativeProvider === 'smartglocal') {\n          const params = {\n            card: {\n              number: data.cardNumber.replace(/[^\\d]+/g, ''),\n              expiration_month: data.expiryMonth,\n              expiration_year: data.expiryYear,\n              security_code: data.cvc.replace(/[^\\d]+/g, '')\n            }\n          };\n\n          const url = /* DEBUG_PAYMENT_SMART_GLOCAL */false ?\n            'https://tgb-playground.smart-glocal.com/cds/v1/tokenize/card' :\n            'https://tgb.smart-glocal.com/cds/v1/tokenize/card';\n\n          const response = await fetch(url, {\n            method: 'POST',\n            headers: {\n              'Accept': 'application/json',\n              'Content-Type': 'application/json',\n              'X-PUBLIC-TOKEN': nativeParams.public_token\n            },\n            body: JSON.stringify(params)\n          });\n\n          const json: { // smartglocal\n            data: {\n              info: {\n                card_network: string,\n                card_type: string,\n                masked_card_number: string\n              },\n              token: string\n            },\n            status: 'ok'\n          } = await response.json();\n\n          out = {type: 'card', token: json.data.token}\n        }\n\n        this.dispatchEvent('finish', {token: out, card: data});\n        this.hide();\n      }\n    });\n\n    const inputFields = ([\n      cardInputField,\n      nameInputField,\n      expireInputField,\n      cvcInputField,\n      countryInputField,\n      postcodeInputField\n    ] as const).filter(Boolean);\n    handleInputFieldsOnChange(inputFields, (valid) => {\n      payButton.disabled = !valid;\n      // payButton.classList.toggle('btn-disabled', !valid);\n    });\n\n    if(savedCard) {\n      cardInputField.value = savedCard.cardNumber;\n      expireInputField.value = savedCard.expiryFull;\n      cvcInputField.value = savedCard.cvc;\n      nameInputField && (nameInputField.value = savedCard.cardholderName);\n      countryInputField && (countryInputField.value = savedCard.country);\n      postcodeInputField && (postcodeInputField.value = savedCard.zip);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n\n    if(!cardInputField.validateNew(undefined, undefined, true)) {\n      placeCaretAtEnd(cardInputField.input);\n    }\n  }\n}\n","import formatValueByPattern from './formatValueByPattern';\n\nexport default function formatInputValueByPattern(options: {\n  value: string,\n  getPattern: Parameters<typeof formatValueByPattern>[0],\n  deleting?: boolean,\n  input?: HTMLElement\n}) {\n  const {value: originalValue, getPattern, deleting, input} = options;\n  const pushRest = !deleting && !!originalValue.length;\n  const result = formatValueByPattern(getPattern, originalValue, {\n    selectionStart: input ? (input as HTMLInputElement).selectionStart : 0,\n    selectionEnd: input ? (input as HTMLInputElement).selectionEnd : 0\n  }, pushRest)\n  const {value, selection} = result;\n\n  return {\n    value,\n    meta: {\n      autocorrectComplete: result.autocorrectComplete,\n      empty: !value\n    },\n    selection\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {AccountPassword, AccountTmpPassword} from '../../layer';\nimport {InputState} from '../inputField';\nimport PasswordInputField from '../passwordInputField';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentCardConfirmation extends PopupElement<{\n  finish: (tmpPassword: AccountTmpPassword) => void\n}> {\n  constructor(card: string, passwordState: AccountPassword) {\n    super('popup-payment popup-payment-card-confirmation', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'Checkout.PasswordEntry.Title'\n    });\n\n    const section = new SettingSection({noDelimiter: true, noShadow: true, caption: 'Checkout.PasswordEntry.Text', captionArgs: [card]});\n    const passwordInputField = new PasswordInputField({labelText: passwordState.hint});\n    section.content.append(passwordInputField.container);\n    this.scrollable.append(section.container);\n\n    const onInput = () => {\n      payButton.disabled = !passwordInputField.value;\n      passwordInputField.setState(InputState.Neutral);\n    };\n\n    passwordInputField.input.addEventListener('input', onInput);\n\n    const payButton = PaymentButton({\n      key: 'Checkout.PasswordEntry.Pay',\n      onClick: async() => {\n        try {\n          const inputCheckPassword = await this.managers.passwordManager.getInputCheckPassword(passwordInputField.value, passwordState);\n          const tmpPassword = await this.managers.apiManager.invokeApi('account.getTmpPassword', {\n            password: inputCheckPassword,\n            period: 60\n          });\n\n          this.dispatchEvent('finish', tmpPassword);\n          this.hide();\n        } catch(err) {\n          if((err as ApiError).type === 'PASSWORD_HASH_INVALID') {\n            (err as ApiError).handled = true;\n            passwordInputField.setError('PASSWORD_HASH_INVALID');\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    onInput();\n\n    this.show();\n\n    placeCaretAtEnd(passwordInputField.input);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {InputInvoice, PaymentRequestedInfo, PaymentsPaymentForm, PaymentsValidatedRequestedInfo} from '../../layer';\nimport matchEmail from '../../lib/richTextProcessor/matchEmail';\nimport CheckboxField from '../checkboxField';\nimport CountryInputField from '../countryInputField';\nimport InputField from '../inputField';\nimport Row from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport TelInputField from '../telInputField';\nimport {PaymentButton} from './payment';\nimport {createCountryZipFields, handleInputFieldsOnChange, InputFieldCorrected} from './paymentCard';\n\nexport type PaymentShippingAddress = PaymentRequestedInfo;\n\ntype ShippingFocusField = 'name' | 'email' | 'phone';\n\nexport default class PopupPaymentShipping extends PopupElement<{\n  finish: (o: {shippingAddress: PaymentShippingAddress, requestedInfo: PaymentsValidatedRequestedInfo}) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private inputInvoice: InputInvoice,\n    private focus?: ShippingFocusField\n  ) {\n    super('popup-payment popup-payment-shipping', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingInfo'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const paymentForm = this.paymentForm;\n    const invoice = paymentForm.invoice;\n    const savedInfo = this.paymentForm.saved_info;\n\n    let addressSection: SettingSection,\n      address1InputField: InputField,\n      address2InputField: InputField,\n      cityInputField: InputField,\n      stateInputField: InputField,\n      countryInputField: CountryInputField,\n      postcodeInputField: InputFieldCorrected;\n    if(invoice.pFlags.shipping_address_requested) {\n      addressSection = new SettingSection({name: 'PaymentShippingAddress', noDelimiter: true, noShadow: true});\n      address1InputField = new InputField({label: 'PaymentShippingAddress1Placeholder', maxLength: 64, required: true});\n      address2InputField = new InputField({label: 'PaymentShippingAddress2Placeholder', maxLength: 64});\n      cityInputField = new InputField({label: 'PaymentShippingCityPlaceholder', maxLength: 64, required: true});\n      stateInputField = new InputField({label: 'PaymentShippingStatePlaceholder', maxLength: 64});\n      const res = createCountryZipFields(true, true);\n      countryInputField = res.countryInputField;\n      postcodeInputField = res.postcodeInputField;\n\n      addressSection.content.append(...[\n        address1InputField,\n        address2InputField,\n        cityInputField,\n        stateInputField,\n        countryInputField,\n        postcodeInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    let receiverSection: SettingSection;\n    let nameInputField: InputField, emailInputField: InputField, telInputField: TelInputField;\n    if([invoice.pFlags.name_requested, invoice.pFlags.email_requested, invoice.pFlags.phone_requested].includes(true)) {\n      receiverSection = new SettingSection({name: 'PaymentShippingReceiver', noDelimiter: true, noShadow: true});\n\n      const validateEmail = () => {\n        const value = emailInputField.value;\n        const match = matchEmail(value);\n        if(!match || match[0].length !== value.length) {\n          return false;\n        }\n\n        return true;\n      };\n\n      const validatePhone = () => {\n        return !!telInputField.value.match(/\\d/);\n      };\n\n      if(invoice.pFlags.name_requested) nameInputField = new InputField({label: 'PaymentShippingName', maxLength: 256, required: true});\n      if(invoice.pFlags.email_requested) emailInputField = new InputField({label: 'PaymentShippingEmailPlaceholder', maxLength: 64, required: true, validate: validateEmail});\n      if(invoice.pFlags.phone_requested) telInputField = new TelInputField({required: true, validate: validatePhone});\n\n      receiverSection.content.append(...[\n        nameInputField,\n        emailInputField,\n        telInputField\n      ].filter(Boolean).map((inputField) => inputField.container));\n    }\n\n    const saveCheckboxField = new CheckboxField({\n      text: 'PaymentShippingSave',\n      checked: true\n    });\n    const saveRow = new Row({\n      checkboxField: saveCheckboxField,\n      subtitleLangKey: 'PaymentShippingSaveInfo',\n      noCheckboxSubtitle: true\n    });\n\n    (receiverSection || addressSection).content.append(saveRow.container);\n\n    this.scrollable.append(...[addressSection, receiverSection].filter(Boolean).map((section) => section.container));\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: async() => {\n        const selectedCountry = countryInputField && countryInputField.getSelected().country;\n        const data: PaymentShippingAddress = {\n          _: 'paymentRequestedInfo',\n          shipping_address: selectedCountry && {\n            _: 'postAddress',\n            street_line1: address1InputField.value,\n            street_line2: address2InputField.value,\n            city: cityInputField.value,\n            state: stateInputField.value,\n            // country: countryInputField.value,\n            country_iso2: selectedCountry?.iso2,\n            post_code: postcodeInputField.value\n          },\n          name: nameInputField?.value,\n          email: emailInputField?.value,\n          phone: telInputField?.value\n        };\n\n        try {\n          const requestedInfo = await this.managers.appPaymentsManager.validateRequestedInfo(this.inputInvoice, data, saveCheckboxField?.checked);\n\n          this.dispatchEvent('finish', {\n            shippingAddress: data,\n            requestedInfo\n          });\n\n          this.hide();\n        } catch(err: any) {\n          const errorMap: {[err: string]: InputField} = {\n            ADDRESS_STREET_LINE1_INVALID: address1InputField,\n            ADDRESS_STREET_LINE2_INVALID: address2InputField,\n            ADDRESS_COUNTRY_INVALID: countryInputField,\n            ADDRESS_CITY_INVALID: cityInputField,\n            ADDRESS_STATE_INVALID: stateInputField,\n            ADDRESS_POSTCODE_INVALID: postcodeInputField,\n\n            REQ_INFO_NAME_INVALID: nameInputField,\n            REQ_INFO_EMAIL_INVALID: emailInputField,\n            REQ_INFO_PHONE_INVALID: telInputField\n          };\n\n          const inputField = errorMap[(err as ApiError).type];\n          if(inputField) {\n            inputField.setError();\n            (err as any).handled = true;\n          }\n\n          throw err;\n        }\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    if(savedInfo) {\n      const shippingAddress = savedInfo.shipping_address;\n      if(shippingAddress) {\n        address1InputField.value = shippingAddress.street_line1;\n        address2InputField.value = shippingAddress.street_line2;\n        cityInputField.value = shippingAddress.city;\n        stateInputField.value = shippingAddress.state;\n        countryInputField.selectCountryByIso2(shippingAddress.country_iso2);\n        postcodeInputField.value = shippingAddress.post_code;\n      }\n\n      savedInfo.name && nameInputField && (nameInputField.value = savedInfo.name);\n      savedInfo.email && emailInputField && (emailInputField.value = savedInfo.email);\n      savedInfo.phone && telInputField && (telInputField.value = savedInfo.phone);\n    }\n\n    const {validate} = handleInputFieldsOnChange([\n      address1InputField,\n      address2InputField,\n      cityInputField,\n      stateInputField,\n      countryInputField,\n      postcodeInputField,\n      nameInputField,\n      emailInputField,\n      telInputField\n    ].filter(Boolean), (valid) => {\n      payButton.disabled = !valid;\n    });\n\n    validate();\n\n    this.show();\n\n    let focusField: InputField;\n    if(this.focus) {\n      const focusMap: {[field in ShippingFocusField]?: InputField} = {\n        name: nameInputField,\n        email: emailInputField,\n        phone: telInputField\n      };\n\n      focusField = focusMap[this.focus];\n    } else {\n      focusField = address1InputField;\n    }\n\n    if(focusField) {\n      placeCaretAtEnd(focusField.input);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport accumulate from '../../helpers/array/accumulate';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport {PaymentsPaymentForm, PaymentsValidatedRequestedInfo, ShippingOption} from '../../layer';\nimport Button from '../button';\nimport RadioField from '../radioField';\nimport Row, {RadioFormFromRows} from '../row';\nimport {SettingSection} from '../sidebarLeft';\nimport {PaymentButton} from './payment';\n\nexport default class PopupPaymentShippingMethods extends PopupElement<{\n  finish: (shippingOption: ShippingOption) => void\n}> {\n  constructor(\n    private paymentForm: PaymentsPaymentForm,\n    private requestedInfo: PaymentsValidatedRequestedInfo,\n    private shippingOption: ShippingOption\n  ) {\n    super('popup-payment popup-payment-shipping-methods', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: 'PaymentShippingMethod'\n    });\n\n    this.d();\n  }\n\n  private d() {\n    const section = new SettingSection({name: 'PaymentCheckoutShippingMethod', noDelimiter: true, noShadow: true});\n\n    const rows = this.requestedInfo.shipping_options.map((shippingOption) => {\n      return new Row({\n        radioField: new RadioField({\n          text: shippingOption.title,\n          name: 'shipping-method',\n          value: shippingOption.id\n        }),\n        subtitle: paymentsWrapCurrencyAmount(\n          accumulate(shippingOption.prices.map(({amount}) => +amount), 0),\n          this.paymentForm.invoice.currency\n        )\n      });\n    });\n\n    let lastShippingId: string;\n    const form = RadioFormFromRows(rows, (value) => {\n      lastShippingId = value;\n    });\n\n    if(this.shippingOption) {\n      rows.find((row) => row.radioField.input.value === this.shippingOption.id).radioField.checked = true;\n    } else {\n      rows[0].radioField.checked = true;\n    }\n\n    section.content.append(form);\n\n    this.scrollable.append(section.container);\n\n    const payButton = PaymentButton({\n      key: 'PaymentInfo.Done',\n      onClick: () => {\n        this.dispatchEvent('finish', this.requestedInfo.shipping_options.find((option) => option.id === lastShippingId));\n        this.hide();\n      }\n    });\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport Currencies from '../../config/currencies';\nimport {FontFamily, FontSize} from '../../config/font';\nimport accumulate from '../../helpers/array/accumulate';\nimport getTextWidth from '../../helpers/canvas/getTextWidth';\nimport {detectUnifiedCardBrand} from '../../helpers/cards/cardBrands';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport toggleDisability from '../../helpers/dom/toggleDisability';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport ScrollSaver from '../../helpers/scrollSaver';\nimport tsNow from '../../helpers/tsNow';\nimport {AccountTmpPassword, InputInvoice, InputPaymentCredentials, LabeledPrice, Message, MessageMedia, PaymentRequestedInfo, PaymentSavedCredentials, PaymentsPaymentForm, PaymentsPaymentReceipt, PaymentsValidatedRequestedInfo, PostAddress, ShippingOption} from '../../layer';\nimport I18n, {i18n, LangPackKey, _i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport CheckboxField from '../checkboxField';\nimport PeerTitle from '../peerTitle';\nimport {putPreloader} from '../putPreloader';\nimport Row from '../row';\nimport {toastNew} from '../toast';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport wrapPhoto from '../wrappers/photo';\nimport PopupPaymentCard, {PaymentCardDetails, PaymentCardDetailsResult} from './paymentCard';\nimport PopupPaymentCardConfirmation from './paymentCardConfirmation';\nimport PopupPaymentShipping, {PaymentShippingAddress} from './paymentShipping';\nimport PopupPaymentShippingMethods from './paymentShippingMethods';\nimport PopupPaymentVerification from './paymentVerification';\n\nconst iconPath = 'assets/img/';\nconst icons = [\n  'amex',\n  'card',\n  'diners',\n  'discover',\n  'jcb',\n  'mastercard',\n  'visa',\n  'unionpay',\n  'mir',\n  'logo'\n];\n\nexport function getPaymentBrandIconPath(brand: string) {\n  if(!icons.includes(brand)) {\n    return;\n  }\n\n  return `${iconPath}${brand}.svg`;\n}\n\nexport function PaymentButton(options: {\n  onClick: () => Promise<any> | void,\n  key?: LangPackKey,\n  textEl?: I18n.IntlElement\n}) {\n  const textEl = options.textEl ?? new I18n.IntlElement({key: options.key ?? 'PaymentInfo.Done'});\n  const key = textEl.key;\n  const payButton = Button('btn-primary btn-color-primary payment-item-pay');\n  payButton.append(textEl.element);\n  attachClickEvent(payButton, async() => {\n    const result = options.onClick();\n    if(!(result instanceof Promise)) {\n      return;\n    }\n\n    const d = putPreloader(payButton);\n    const toggle = toggleDisability([payButton], true);\n    textEl.compareAndUpdate({key: 'PleaseWait'});\n    try {\n      await result;\n    } catch(err) {\n      if(!(err as any).handled) {\n        console.error('payment button error', err);\n      }\n\n      toggle();\n      textEl.compareAndUpdate({key});\n      d.remove();\n    }\n  });\n  return payButton;\n}\n\nexport type PaymentsCredentialsToken = {type: 'card', token?: string, id?: string};\n\nexport default class PopupPayment extends PopupElement {\n  private tipButtonsMap: Map<number, HTMLElement>;\n\n  constructor(\n    private message: Message.message,\n    private inputInvoice: InputInvoice,\n    private paymentForm?: PaymentsPaymentForm | PaymentsPaymentReceipt\n  ) {\n    super('popup-payment', {\n      closable: true,\n      overlayClosable: true,\n      body: true,\n      scrollable: true,\n      title: true\n    });\n\n    this.tipButtonsMap = new Map();\n    this.d();\n  }\n\n  private async d() {\n    this.element.classList.add('is-loading');\n    this.show();\n\n    let confirmed = false;\n    const onConfirmed = () => {\n      if(confirmed) {\n        return;\n      }\n\n      confirmed = true;\n      if(popupPaymentVerification) {\n        popupPaymentVerification.hide();\n      }\n\n      this.hide();\n    };\n\n    let {paymentForm, message} = this;\n\n    if(message) {\n      this.listenerSetter.add(rootScope)('payment_sent', ({peerId, mid}) => {\n        if(message.peerId === peerId && message.mid === mid) {\n          onConfirmed();\n        }\n      });\n    }\n\n    const mediaInvoice = message?.media as MessageMedia.messageMediaInvoice;\n    const isReceipt = mediaInvoice ? !!mediaInvoice.receipt_msg_id : paymentForm._ === 'payments.paymentReceipt';\n    const isTest = mediaInvoice ? mediaInvoice.pFlags.test : paymentForm.invoice.pFlags.test;\n\n    const photo = mediaInvoice ? mediaInvoice.photo : paymentForm.photo;\n    const title = mediaInvoice ? mediaInvoice.title : paymentForm.title;\n    const description = mediaInvoice ? mediaInvoice.description : paymentForm.description;\n\n    _i18n(this.title, isReceipt ? 'PaymentReceipt' : 'PaymentCheckout');\n    if(isTest) {\n      this.title.append(' (Test)');\n    }\n\n    const className = 'payment-item';\n\n    const itemEl = document.createElement('div');\n    itemEl.classList.add(className);\n\n    const detailsClassName = className + '-details';\n    const details = document.createElement('div');\n    details.classList.add(detailsClassName);\n\n    let photoEl: HTMLElement;\n    if(photo) {\n      photoEl = document.createElement('div');\n      photoEl.classList.add(detailsClassName + '-photo', 'media-container-contain');\n      wrapPhoto({\n        photo: photo,\n        container: photoEl,\n        boxWidth: 100,\n        boxHeight: 100,\n        size: {_: 'photoSizeEmpty', type: ''}\n      });\n      details.append(photoEl);\n    }\n\n    const linesClassName = detailsClassName + '-lines';\n    const linesEl = document.createElement('div');\n    linesEl.classList.add(linesClassName);\n\n    const titleEl = document.createElement('div');\n    titleEl.classList.add(linesClassName + '-title');\n\n    const descriptionEl = document.createElement('div');\n    descriptionEl.classList.add(linesClassName + '-description');\n\n    const botName = document.createElement('div');\n    botName.classList.add(linesClassName + '-bot-name');\n\n    linesEl.append(titleEl, descriptionEl, botName);\n\n    setInnerHTML(titleEl, wrapEmojiText(title));\n    setInnerHTML(descriptionEl, wrapEmojiText(description));\n\n    const peerTitle = new PeerTitle();\n    botName.append(peerTitle.element);\n\n    details.append(linesEl);\n    itemEl.append(details);\n    this.scrollable.append(itemEl);\n\n    const preloaderContainer = document.createElement('div');\n    preloaderContainer.classList.add(className + '-preloader-container');\n    const preloader = putPreloader(preloaderContainer, true);\n    this.scrollable.container.append(preloaderContainer);\n\n    const inputInvoice = this.inputInvoice;\n    if(!paymentForm) {\n      if(isReceipt) paymentForm = await this.managers.appPaymentsManager.getPaymentReceipt(message.peerId, mediaInvoice.receipt_msg_id);\n      else paymentForm = await this.managers.appPaymentsManager.getPaymentForm(inputInvoice);\n      this.paymentForm = paymentForm;\n    }\n\n    let savedInfo = (paymentForm as PaymentsPaymentForm).saved_info || (paymentForm as PaymentsPaymentReceipt).info;\n    const savedCredentials = (paymentForm as PaymentsPaymentForm).saved_credentials?.[0];\n    let [lastRequestedInfo, passwordState, providerPeerTitle] = await Promise.all([\n      !isReceipt && savedInfo && this.managers.appPaymentsManager.validateRequestedInfo(inputInvoice, savedInfo),\n      savedCredentials && this.managers.passwordManager.getState(),\n      wrapPeerTitle({peerId: paymentForm.provider_id.toPeerId()})\n    ]);\n\n    console.log(paymentForm, lastRequestedInfo);\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const wrapAmount = (amount: string | number, skipSymbol?: boolean) => {\n      return paymentsWrapCurrencyAmount(amount, currency, skipSymbol);\n    };\n\n    const {invoice} = paymentForm;\n    const currency = invoice.currency;\n\n    const isRecurring = invoice.pFlags.recurring && !isReceipt;\n\n    await peerTitle.update({peerId: paymentForm.bot_id.toPeerId()});\n    const peerTitle2 = isRecurring ? await wrapPeerTitle({peerId: paymentForm.bot_id.toPeerId()}) : undefined;\n    preloaderContainer.remove();\n    this.element.classList.remove('is-loading');\n\n    const makeLabel = () => {\n      const labelEl = document.createElement('div');\n      labelEl.classList.add(pricesClassName + '-price');\n\n      const left = document.createElement('span');\n      const right = document.createElement('span');\n      labelEl.append(left, right);\n      return {label: labelEl, left, right};\n    };\n\n    const pricesClassName = className + '-prices';\n    const prices = document.createElement('div');\n    prices.classList.add(pricesClassName);\n    const makePricesElements = (prices: LabeledPrice[]) => {\n      return prices.map((price) => {\n        const {amount, label} = price;\n\n        const _label = makeLabel();\n        _label.left.textContent = label;\n\n        const wrappedAmount = wrapAmount(amount);\n        _label.right.textContent = wrappedAmount;\n\n        return _label.label;\n      });\n    };\n\n    const pricesElements = makePricesElements(invoice.prices);\n\n    let getTipsAmount = (): number => 0;\n    let shippingAmount = 0;\n\n    const getTotalTotal = () => totalAmount + getTipsAmount() + shippingAmount;\n    const setTotal = () => {\n      const wrapped = wrapAmount(getTotalTotal());\n      totalLabel.right.textContent = wrapped;\n      payI18n.compareAndUpdate({\n        key: 'PaymentCheckoutPay',\n        args: [wrapped]\n      });\n    };\n\n    const payI18n = new I18n.IntlElement();\n\n    const totalLabel = makeLabel();\n    totalLabel.label.classList.add('is-total');\n    _i18n(totalLabel.left, 'PaymentTransactionTotal');\n    const totalAmount = accumulate(invoice.prices.map(({amount}) => +amount), 0);\n\n    const canTip = (invoice.max_tip_amount !== undefined && !isReceipt) || !!(paymentForm as PaymentsPaymentReceipt).tip_amount;\n    if(canTip) {\n      const tipsClassName = className + '-tips';\n\n      const currencyData = Currencies[currency];\n\n      getTipsAmount = () => +getInputValue().replace(/\\D/g, '');\n\n      const getInputValue = () => {\n        // return input.textContent;\n        return input.value;\n      };\n\n      const setInputWidth = () => {\n        const width = getTextWidth(getInputValue(), `500 ${FontSize} ${FontFamily}`);\n        input.style.width = width + 'px';\n      };\n\n      const setInputValue = (amount: string | number) => {\n        amount = Math.min(+amount, +invoice.max_tip_amount);\n        const wrapped = wrapAmount(amount, true);\n\n        input.value = wrapped;\n        // input.textContent = wrapped;\n        if(document.activeElement === input) {\n          placeCaretAtEnd(input);\n        }\n\n        unsetActiveTip && unsetActiveTip();\n        const tipEl = this.tipButtonsMap.get(amount);\n        if(tipEl) {\n          tipEl.classList.add('active');\n        }\n\n        setInputWidth();\n        setTotal();\n      };\n\n      const tipsLabel = makeLabel();\n      _i18n(tipsLabel.left, isReceipt ? 'PaymentTip' : 'PaymentTipOptional');\n      const input = document.createElement('input');\n      input.type = 'tel';\n      // const input: HTMLElement = document.createElement('div');\n      // input.contentEditable = 'true';\n      input.classList.add('input-clear', tipsClassName + '-input');\n      tipsLabel.right.append(input);\n\n      if(!isReceipt) {\n        tipsLabel.label.style.cursor = 'text';\n      } else {\n        tipsLabel.label.classList.add('disable-hover');\n      }\n\n      tipsLabel.label.addEventListener('mousedown', (e) => {\n        if(!findUpAsChild(e.target as HTMLElement, input)) {\n          placeCaretAtEnd(input);\n        }\n      });\n\n      const haveToIgnoreEvents = input instanceof HTMLInputElement ? 1 : 2;\n      const onSelectionChange = () => {\n        if(ignoreNextSelectionChange) {\n          --ignoreNextSelectionChange;\n          return;\n        }\n\n        // setTimeout(() => {\n        ignoreNextSelectionChange = haveToIgnoreEvents;\n        placeCaretAtEnd(input);\n        // }, 0);\n      };\n\n      const onFocus = () => {\n        // cancelEvent(e);\n        setTimeout(() => {\n          ignoreNextSelectionChange = haveToIgnoreEvents;\n          placeCaretAtEnd(input);\n          document.addEventListener('selectionchange', onSelectionChange);\n        }, 0);\n      };\n\n      const onFocusOut = () => {\n        input.addEventListener('focus', onFocus, {once: true});\n        document.removeEventListener('selectionchange', onSelectionChange);\n      };\n\n      let ignoreNextSelectionChange: number;\n      input.addEventListener('focusout', onFocusOut);\n      onFocusOut();\n\n      input.addEventListener('input', () => {\n        setInputValue(getTipsAmount());\n      });\n\n      const s = [currencyData.symbol, currencyData.space_between ? ' ' : ''];\n      if(!currencyData.symbol_left) s.reverse();\n      tipsLabel.right[currencyData.symbol_left ? 'prepend' : 'append'](s.join(''));\n\n      pricesElements.push(tipsLabel.label);\n\n      //\n      let unsetActiveTip: () => void;\n      if(!isReceipt) {\n        const tipsEl = document.createElement('div');\n        tipsEl.classList.add(tipsClassName);\n\n        const tipClassName = tipsClassName + '-tip';\n        const tipButtons = invoice.suggested_tip_amounts.map((tipAmount) => {\n          const button = Button(tipClassName, {noRipple: true});\n          button.textContent = wrapAmount(tipAmount);\n\n          this.tipButtonsMap.set(+tipAmount, button);\n          return button;\n        });\n\n        unsetActiveTip = () => {\n          const prevTipEl = tipsEl.querySelector('.active');\n          if(prevTipEl) {\n            prevTipEl.classList.remove('active');\n          }\n        };\n\n        attachClickEvent(tipsEl, (e) => {\n          const tipEl = findUpClassName(e.target, tipClassName);\n          if(!tipEl) {\n            return;\n          }\n\n          let tipAmount = 0;\n          if(tipEl.classList.contains('active')) {\n            tipEl.classList.remove('active');\n          } else {\n            unsetActiveTip();\n            tipEl.classList.add('active');\n\n            for(const [amount, el] of this.tipButtonsMap) {\n              if(el === tipEl) {\n                tipAmount = amount;\n                break;\n              }\n            }\n          }\n\n          setInputValue(tipAmount);\n        });\n\n        setInputValue(0);\n\n        tipsEl.append(...tipButtons);\n        pricesElements.push(tipsEl);\n      } else {\n        setInputValue((paymentForm as PaymentsPaymentReceipt).tip_amount);\n      }\n    } else {\n      setTotal();\n    }\n\n    pricesElements.push(totalLabel.label);\n\n    prices.append(...pricesElements);\n    itemEl.append(prices);\n\n    // /\n\n    const setRowIcon = async(row: Row, icon?: string) => {\n      const img = document.createElement('img');\n      img.classList.add('media-photo');\n      await renderImageFromUrlPromise(img, getPaymentBrandIconPath(icon));\n      let container = row.media;\n      if(!container) {\n        container = row.createMedia('small');\n        container.classList.add('media-container-cover');\n        container.append(img);\n      } else {\n        replaceContent(container, img);\n      }\n    };\n\n    const createRow = (options: ConstructorParameters<typeof Row>[0]) => {\n      if(options.titleLangKey) {\n        options.subtitleLangKey = options.titleLangKey;\n      }\n\n      options.noWrap = true;\n      const row = new Row(options);\n      row.container.classList.add(className + '-row');\n\n      if(options.titleLangKey) {\n        row.subtitle.classList.add('hide');\n      }\n\n      return row;\n    };\n\n    const setRowTitle = (row: Row, textContent: string) => {\n      row.title.textContent = textContent;\n      if(!textContent) {\n        const e = I18n.weakMap.get(row.subtitle.firstElementChild as HTMLElement) as I18n.IntlElement;\n        row.title.append(i18n(e.key));\n      }\n\n      row.subtitle.classList.toggle('hide', !textContent);\n    };\n\n    const setCardSubtitle = (card: PaymentCardDetailsResult) => {\n      let brand: string;\n      let str: string;\n      let icon: string;\n      if('title' in card) {\n        brand = card.title.split(' ').shift();\n        str = card.title;\n        icon = card.icon;\n      } else {\n        brand = detectUnifiedCardBrand(card.cardNumber);\n        str = brand + ' *' + card.cardNumber.split(' ').pop();\n      }\n\n      methodRow.title.classList.remove('tgico', 'tgico-card_outline');\n      setRowIcon(methodRow, icon || brand.toLowerCase());\n      setRowTitle(methodRow, str);\n    };\n\n    const onMethodClick = () => {\n      new PopupPaymentCard(paymentForm as PaymentsPaymentForm, previousCardDetails as PaymentCardDetails).addEventListener('finish', ({token, card}) => {\n        previousToken = token, previousCardDetails = card;\n\n        setCardSubtitle(card);\n      });\n    };\n\n    let previousCardDetails: PaymentCardDetailsResult, previousToken: PaymentsCredentialsToken;\n    const methodRow = createRow({\n      titleLangKey: 'PaymentCheckoutMethod',\n      clickable: isReceipt ? undefined : onMethodClick,\n      icon: 'card_outline'\n    });\n\n    methodRow.container.classList.add(className + '-method-row');\n\n    if(savedCredentials) {\n      setCardSubtitle(savedCredentials);\n    } else if((paymentForm as PaymentsPaymentReceipt).credentials_title) {\n      setCardSubtitle({title: (paymentForm as PaymentsPaymentReceipt).credentials_title});\n    }\n\n    const providerRow = createRow({\n      title: providerPeerTitle,\n      subtitleLangKey: 'PaymentCheckoutProvider'\n    });\n\n    const providerAvatar = new AvatarElement();\n    providerAvatar.classList.add('avatar-32');\n    providerRow.createMedia('small').append(providerAvatar);\n    /* await */ providerAvatar.updateWithOptions({peerId: paymentForm.provider_id.toPeerId()});\n\n    let shippingAddressRow: Row, shippingNameRow: Row, shippingEmailRow: Row, shippingPhoneRow: Row, shippingMethodRow: Row;\n    let lastShippingOption: ShippingOption, onShippingAddressClick: (focus?: ConstructorParameters<typeof PopupPaymentShipping>[2]) => void, onShippingMethodClick: () => void;\n    const setShippingTitle = invoice.pFlags.shipping_address_requested ? (shippingAddress?: PaymentShippingAddress) => {\n      if(!shippingAddress) {\n        shippingMethodRow.subtitle.classList.add('hide');\n        replaceContent(shippingMethodRow.title, i18n('PaymentShippingAddress'));\n        return;\n      }\n\n      const postAddress = shippingAddress.shipping_address;\n      setRowTitle(shippingAddressRow, [postAddress.city, postAddress.street_line1, postAddress.street_line2].filter(Boolean).join(', '));\n\n      shippingMethodRow.container.classList.toggle('hide', !lastRequestedInfo && !isReceipt);\n    } : undefined;\n\n    const setShippingInfo = (info: PaymentRequestedInfo) => {\n      setShippingTitle && setShippingTitle(info);\n      shippingNameRow && setRowTitle(shippingNameRow, info.name);\n      shippingEmailRow && setRowTitle(shippingEmailRow, info.email);\n      shippingPhoneRow && setRowTitle(shippingPhoneRow, info.phone && ('+' + formatPhoneNumber(info.phone).formatted));\n    };\n\n    if(!isReceipt) {\n      onShippingAddressClick = (focus) => {\n        new PopupPaymentShipping(paymentForm as PaymentsPaymentForm, inputInvoice, focus).addEventListener('finish', ({shippingAddress, requestedInfo}) => {\n          lastRequestedInfo = requestedInfo;\n          savedInfo = (paymentForm as PaymentsPaymentForm).saved_info = shippingAddress;\n          setShippingInfo(shippingAddress);\n        });\n      };\n    }\n\n    if(invoice.pFlags.shipping_address_requested) {\n      const setShippingOption = (shippingOption?: ShippingOption) => {\n        const scrollSaver = new ScrollSaver(this.scrollable, undefined, true);\n        scrollSaver.save();\n        if(lastShippingPricesElements) {\n          lastShippingPricesElements.forEach((node) => node.remove());\n        }\n\n        if(!shippingOption) {\n          shippingAmount = 0;\n\n          setTotal();\n          scrollSaver.restore();\n          this.onContentUpdate();\n          return;\n        }\n\n        lastShippingOption = shippingOption;\n        setRowTitle(shippingMethodRow, shippingOption.title);\n\n        shippingAmount = accumulate(shippingOption.prices.map(({amount}) => +amount), 0);\n        lastShippingPricesElements = makePricesElements(shippingOption.prices);\n        let l = totalLabel.label;\n        if(canTip) {\n          l = l.previousElementSibling as any;\n          if(!isReceipt) {\n            l = l.previousElementSibling as any;\n          }\n        }\n\n        lastShippingPricesElements.forEach((element) => l.parentElement.insertBefore(element, l));\n\n        setTotal();\n        scrollSaver.restore();\n        this.onContentUpdate();\n      };\n\n      shippingAddressRow = createRow({\n        icon: 'location',\n        titleLangKey: 'PaymentShippingAddress',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, undefined)\n      });\n\n      let lastShippingPricesElements: HTMLElement[];\n      shippingMethodRow = createRow({\n        icon: 'shipping',\n        titleLangKey: 'PaymentCheckoutShippingMethod',\n        clickable: !isReceipt && (onShippingMethodClick = () => {\n          new PopupPaymentShippingMethods(paymentForm as PaymentsPaymentForm, lastRequestedInfo, lastShippingOption).addEventListener('finish', (shippingOption) => {\n            setShippingOption(shippingOption);\n          });\n        })\n      });\n\n      shippingMethodRow.container.classList.add('hide');\n\n      const shippingOption = (paymentForm as PaymentsPaymentReceipt).shipping;\n      if(shippingOption) {\n        setShippingOption(shippingOption);\n      }\n    }\n\n    if(invoice.pFlags.name_requested) {\n      shippingNameRow = createRow({\n        icon: 'newprivate',\n        titleLangKey: 'PaymentCheckoutName',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'name')\n      });\n    }\n\n    if(invoice.pFlags.email_requested) {\n      shippingEmailRow = createRow({\n        icon: 'mention',\n        titleLangKey: 'PaymentShippingEmailPlaceholder',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'email')\n      });\n    }\n\n    if(invoice.pFlags.phone_requested) {\n      shippingPhoneRow = createRow({\n        icon: 'phone',\n        titleLangKey: 'PaymentCheckoutPhoneNumber',\n        clickable: !isReceipt && onShippingAddressClick.bind(null, 'phone')\n      });\n    }\n\n    if(savedInfo) {\n      setShippingInfo(savedInfo);\n    }\n\n    const rows = [\n      methodRow,\n      providerRow,\n      shippingAddressRow,\n      shippingMethodRow,\n      shippingNameRow,\n      shippingEmailRow,\n      shippingPhoneRow\n    ].filter(Boolean);\n\n    const acceptTermsCheckboxField = isRecurring && new CheckboxField({\n      text: 'Payments.Recurrent.Accept',\n      textArgs: [wrapRichText(invoice.recurring_terms_url), peerTitle2]\n    });\n\n    const acceptTermsRow = isRecurring && createRow({\n      checkboxField: acceptTermsCheckboxField,\n      noCheckboxSubtitle: true\n    });\n\n    const recurringElements = isRecurring ? [document.createElement('hr'), acceptTermsRow.container] : [];\n\n    this.scrollable.append(...[\n      document.createElement('hr'),\n      ...rows.map((row) => row.container),\n      ...recurringElements\n    ].filter(Boolean));\n\n    // /\n    let popupPaymentVerification: PopupPaymentVerification, lastTmpPasword: AccountTmpPassword;\n    const onClick = () => {\n      const missingInfo = invoice.pFlags.name_requested && !savedInfo?.name ? 'name' : (invoice.pFlags.email_requested && !savedInfo?.email ? 'email' : (invoice.pFlags.phone_requested && !savedInfo?.phone ? 'phone' : undefined));\n      if(invoice.pFlags.shipping_address_requested) {\n        if(!lastRequestedInfo) {\n          onShippingAddressClick();\n          return;\n        } else if(!lastShippingOption) {\n          onShippingMethodClick();\n          return;\n        }\n      } else if(missingInfo) {\n        onShippingAddressClick(missingInfo);\n        return;\n      }\n\n      if(!previousCardDetails && !lastTmpPasword) {\n        if(!savedCredentials) {\n          onMethodClick();\n          return;\n        }\n\n        Promise.resolve(passwordState ?? this.managers.passwordManager.getState()).then((_passwordState) => {\n          new PopupPaymentCardConfirmation(savedCredentials.title, _passwordState).addEventListener('finish', (tmpPassword) => {\n            passwordState = undefined;\n            lastTmpPasword = tmpPassword;\n            simulateClickEvent(payButton);\n\n            // * reserve 5 seconds\n            const diff = tmpPassword.valid_until - tsNow(true) - 5;\n            setTimeout(() => {\n              if(lastTmpPasword === tmpPassword) {\n                lastTmpPasword = undefined;\n              }\n            }, diff * 1000);\n          });\n        });\n\n        return;\n      }\n\n      return Promise.resolve().then(async() => {\n        const credentials: InputPaymentCredentials = lastTmpPasword ? {\n          _: 'inputPaymentCredentialsSaved',\n          id: savedCredentials.id,\n          tmp_password: lastTmpPasword.tmp_password\n        } : {\n          _: 'inputPaymentCredentials',\n          data: {\n            _: 'dataJSON',\n            data: JSON.stringify(previousToken.token ? previousToken : {type: previousToken.type, id: previousToken.id})\n          },\n          pFlags: {\n            save: previousCardDetails.save || undefined\n          }\n        };\n\n        try {\n          const paymentResult = await this.managers.appPaymentsManager.sendPaymentForm(\n            inputInvoice,\n            (paymentForm as PaymentsPaymentForm).form_id,\n            lastRequestedInfo?.id,\n            lastShippingOption?.id,\n            credentials,\n            getTipsAmount()\n          );\n\n          if(paymentResult._ === 'payments.paymentResult') {\n            onConfirmed();\n          } else {\n            popupPaymentVerification = new PopupPaymentVerification(paymentResult.url);\n            popupPaymentVerification.addEventListener('finish', () => {\n              popupPaymentVerification = undefined;\n\n              onConfirmed();\n            });\n            await new Promise<void>((resolve, reject) => {\n              popupPaymentVerification.addEventListener('close', () => {\n                popupPaymentVerification = undefined;\n                if(confirmed) {\n                  resolve();\n                } else {\n                  const err = new Error('payment not finished');\n                  (err as ApiError).handled = true;\n                  reject(err);\n                }\n              });\n            });\n          }\n        } catch(err) {\n          if((err as ApiError).type === 'BOT_PRECHECKOUT_TIMEOUT') {\n            toastNew({langPackKey: 'Error.AnError'});\n            (err as ApiError).handled = true;\n          } else if((err as ApiError).type === 'TMP_PASSWORD_INVALID') {\n            passwordState = lastTmpPasword = undefined;\n            simulateClickEvent(payButton);\n            (err as ApiError).handled = true;\n          }\n\n          throw err;\n        }\n      });\n    };\n\n    const onChange = () => {\n      payButton.disabled = !!(acceptTermsCheckboxField && !acceptTermsCheckboxField.checked);\n    };\n\n    let payButton: HTMLButtonElement;\n    if(isReceipt) {\n      payButton = PaymentButton({\n        onClick: () => this.hide(),\n        key: 'Done'\n      });\n    } else {\n      payButton = PaymentButton({\n        onClick: onClick,\n        textEl: payI18n\n      });\n    }\n\n    onChange();\n    if(acceptTermsCheckboxField) {\n      acceptTermsCheckboxField.input.addEventListener('change', onChange);\n    }\n\n    this.body.append(this.btnConfirmOnEnter = payButton);\n\n    this.onContentUpdate();\n  }\n}\n","/*\r\nThis file is part of Telegram Desktop,\r\nthe official desktop application for the Telegram messaging service.\r\nFor license and copyright information please follow this link:\r\nhttps://github.com/telegramdesktop/tdesktop/blob/master/LEGAL\r\n*/\r\n\r\nimport accumulate from '../helpers/array/accumulate';\r\nimport clamp from '../helpers/number/clamp';\r\n\r\ntype Size = {w: number, h: number};\r\nexport type GroupMediaLayout = {\r\n  geometry: {\r\n    x: number,\r\n    y: number,\r\n    width: number,\r\n    height: number\r\n  },\r\n  sides: number\r\n};\r\ntype Attempt = {\r\n  lineCounts: number[],\r\n  heights: number[]\r\n};\r\nexport const RectPart = {\r\n  None: 0,\r\n  Top: 1,\r\n  Right: 2,\r\n  Bottom: 4,\r\n  Left: 8\r\n};\r\n\r\n// https://github.com/telegramdesktop/tdesktop/blob/4669c07dc5335cbf4795bbbe5b0ab7c007b9aee2/Telegram/SourceFiles/ui/grouped_layout.cpp\r\nexport class Layouter {\r\n  private count: number;\r\n  private ratios: number[];\r\n  private proportions: string;\r\n  private averageRatio: number;\r\n  private maxSizeRatio: number;\r\n\r\n  constructor(private sizes: Size[], private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth) {\r\n    this.count = sizes.length;\r\n    this.ratios = Layouter.countRatios(sizes);\r\n    this.proportions = Layouter.countProportions(this.ratios);\r\n    this.averageRatio = accumulate(this.ratios, 1) / this.count; // warn\r\n    this.maxSizeRatio = maxWidth / this.maxHeight;\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    if(!this.count) return [];\r\n    // else if(this.count === 1) return this.layoutOne();\r\n\r\n    if(this.count >= 5 || this.ratios.find((r) => r > 2)) {\r\n      return new ComplexLayouter(this.ratios, this.averageRatio, this.maxWidth, this.minWidth, this.spacing).layout();\r\n    }\r\n\r\n    if(this.count === 2) return this.layoutTwo();\r\n    else if(this.count === 3) return this.layoutThree();\r\n    return this.layoutFour();\r\n  }\r\n\r\n  private layoutTwo(): ReturnType<Layouter['layout']> {\r\n    if((this.proportions === 'ww') &&\r\n      (this.averageRatio > 1.4 * this.maxSizeRatio) &&\r\n      (this.ratios[1] - this.ratios[0] < 0.2)) {\r\n      return this.layoutTwoTopBottom();\r\n    } else if(this.proportions === 'ww' || this.proportions === 'qq') {\r\n      return this.layoutTwoLeftRightEqual();\r\n    }\r\n    return this.layoutTwoLeftRight();\r\n  }\r\n\r\n  private layoutThree(): ReturnType<Layouter['layout']> {\r\n    // console.log('layoutThree:', this);\r\n    if(this.proportions[0] === 'n') {\r\n      return this.layoutThreeLeftAndOther();\r\n    }\r\n    return this.layoutThreeTopAndOther();\r\n  }\r\n\r\n  private layoutFour(): ReturnType<Layouter['layout']> {\r\n    if(this.proportions[0] === 'w') {\r\n      return this.layoutFourTopAndOther();\r\n    }\r\n    return this.layoutFourLeftAndOther();\r\n  }\r\n\r\n  private layoutTwoTopBottom(): ReturnType<Layouter['layout']> {\r\n    const width = this.maxWidth;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(\r\n        width / this.ratios[1],\r\n        (this.maxHeight - this.spacing) / 2)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: height + this.spacing, width, height},\r\n        sides: RectPart.Left | RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRightEqual(): ReturnType<Layouter['layout']> {\r\n    const width = (this.maxWidth - this.spacing) / 2;\r\n    const height = Math.round(Math.min(\r\n      width / this.ratios[0],\r\n      Math.min(width / this.ratios[1], this.maxHeight * 1)));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: width + this.spacing, y: 0, width, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutTwoLeftRight(): ReturnType<Layouter['layout']> {\r\n    const minimalWidth = Math.round(this.minWidth * 1.5);\r\n    const secondWidth = Math.min(\r\n      Math.round(Math.max(\r\n        0.4 * (this.maxWidth - this.spacing),\r\n        (this.maxWidth - this.spacing) / this.ratios[0] /\r\n          (1 / this.ratios[0] + 1 / this.ratios[1]))),\r\n      this.maxWidth - this.spacing - minimalWidth);\r\n    const firstWidth = this.maxWidth -\r\n      secondWidth -\r\n      this.spacing;\r\n    const height = Math.min(\r\n      this.maxHeight,\r\n      Math.round(Math.min(\r\n        firstWidth / this.ratios[0],\r\n        secondWidth / this.ratios[1])));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: firstWidth + this.spacing, y: 0, width: secondWidth, height},\r\n        sides: RectPart.Top | RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstHeight = this.maxHeight;\r\n    const thirdHeight = Math.round(Math.min(\r\n      (this.maxHeight - this.spacing) / 2.,\r\n      (this.ratios[1] * (this.maxWidth - this.spacing) /\r\n        (this.ratios[2] + this.ratios[1]))));\r\n    const secondHeight = firstHeight -\r\n      thirdHeight -\r\n      this.spacing;\r\n    const rightWidth = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - this.spacing) / 2.,\r\n        Math.min(\r\n          thirdHeight * this.ratios[2],\r\n          secondHeight * this.ratios[1]))));\r\n    const leftWidth = Math.min(\r\n      Math.round(firstHeight * this.ratios[0]),\r\n      this.maxWidth - this.spacing - rightWidth);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: leftWidth, height: firstHeight},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: 0, width: rightWidth, height: secondHeight},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: leftWidth + this.spacing, y: secondHeight + this.spacing, width: rightWidth, height: thirdHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutThreeTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const firstWidth = this.maxWidth;\r\n    const firstHeight = Math.round(Math.min(\r\n      firstWidth / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const secondWidth = (this.maxWidth - this.spacing) / 2;\r\n    const secondHeight = Math.min(\r\n      this.maxHeight - firstHeight - this.spacing,\r\n      Math.round(Math.min(\r\n        secondWidth / this.ratios[1],\r\n        secondWidth / this.ratios[2])));\r\n    const thirdWidth = firstWidth - secondWidth - this.spacing;\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: firstWidth, height: firstHeight},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: firstHeight + this.spacing, width: secondWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: secondWidth + this.spacing, y: firstHeight + this.spacing, width: thirdWidth, height: secondHeight},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourTopAndOther(): ReturnType<Layouter['layout']> {\r\n    const w = this.maxWidth;\r\n    const h0 = Math.round(Math.min(\r\n      w / this.ratios[0],\r\n      (this.maxHeight - this.spacing) * 0.66));\r\n    const h = Math.round(\r\n      (this.maxWidth - 2 * this.spacing) /\r\n        (this.ratios[1] + this.ratios[2] + this.ratios[3]));\r\n    const w0 = Math.max(\r\n      this.minWidth,\r\n      Math.round(Math.min(\r\n        (this.maxWidth - 2 * this.spacing) * 0.4,\r\n        h * this.ratios[1])));\r\n    const w2 = Math.round(Math.max(\r\n      Math.max(\r\n        this.minWidth * 1.,\r\n        (this.maxWidth - 2 * this.spacing) * 0.33),\r\n      h * this.ratios[3]));\r\n    const w1 = w - w0 - w2 - 2 * this.spacing;\r\n    const h1 = Math.min(\r\n      this.maxHeight - h0 - this.spacing,\r\n      h);\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w, height: h0},\r\n        sides: RectPart.Left | RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: 0, y: h0 + this.spacing, width: w0, height: h1},\r\n        sides: RectPart.Bottom | RectPart.Left\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing + w1 + this.spacing, y: h0 + this.spacing, width: w2, height: h1},\r\n        sides: RectPart.Right | RectPart.Bottom\r\n      }\r\n    ];\r\n  }\r\n\r\n  private layoutFourLeftAndOther(): ReturnType<Layouter['layout']> {\r\n    const h = this.maxHeight;\r\n    const w0 = Math.round(Math.min(\r\n      h * this.ratios[0],\r\n      (this.maxWidth - this.spacing) * 0.6));\r\n\r\n    const w = Math.round(\r\n      (this.maxHeight - 2 * this.spacing) /\r\n        (1. / this.ratios[1] + 1. / this.ratios[2] + 1. / this.ratios[3])\r\n    );\r\n    const h0 = Math.round(w / this.ratios[1]);\r\n    const h1 = Math.round(w / this.ratios[2]);\r\n    const h2 = h - h0 - h1 - 2 * this.spacing;\r\n    const w1 = Math.max(\r\n      this.minWidth,\r\n      Math.min(this.maxWidth - w0 - this.spacing, w));\r\n\r\n    return [\r\n      {\r\n        geometry: {x: 0, y: 0, width: w0, height: h},\r\n        sides: RectPart.Top | RectPart.Left | RectPart.Bottom\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: 0, width: w1, height: h0},\r\n        sides: RectPart.Top | RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + this.spacing, width: w1, height: h1},\r\n        sides: RectPart.Right\r\n      },\r\n      {\r\n        geometry: {x: w0 + this.spacing, y: h0 + h1 + 2 * this.spacing, width: w1, height: h2},\r\n        sides: RectPart.Bottom | RectPart.Right\r\n      }\r\n    ];\r\n  }\r\n\r\n  private static countRatios(sizes: Size[]) {\r\n    return sizes.map((size) => size.w / size.h);\r\n  }\r\n\r\n  private static countProportions(ratios: number[]) {\r\n    return ratios.map((ratio) => (ratio > 1.2) ? 'w' : (ratio < 0.8) ? 'n' : 'q').join('');\r\n  }\r\n}\r\n\r\nclass ComplexLayouter {\r\n  private ratios: number[];\r\n  private count: number;\r\n\r\n  constructor(ratios: number[], private averageRatio: number, private maxWidth: number, private minWidth: number, private spacing: number, private maxHeight = maxWidth * 4 / 3) {\r\n    this.ratios = ComplexLayouter.cropRatios(ratios, averageRatio);\r\n    this.count = ratios.length;\r\n  }\r\n\r\n  private static cropRatios(ratios: number[], averageRatio: number) {\r\n    const kMaxRatio = 2.75;\r\n    const kMinRatio = 0.6667;\r\n    return ratios.map((ratio) => {\r\n      return averageRatio > 1.1 ?\r\n        clamp(ratio, 1., kMaxRatio) :\r\n        clamp(ratio, kMinRatio, 1.);\r\n    });\r\n  }\r\n\r\n  public layout(): GroupMediaLayout[] {\r\n    const result = new Array<GroupMediaLayout>(this.count);\r\n\r\n    const attempts: Attempt[] = [];\r\n    const multiHeight = (offset: number, count: number) => {\r\n      const ratios = this.ratios.slice(offset, offset + count); // warn\r\n      const sum = accumulate(ratios, 0);\r\n      return (this.maxWidth - (count - 1) * this.spacing) / sum;\r\n    };\r\n    const pushAttempt = (lineCounts: number[]) => {\r\n      const heights: number[] = [];\r\n      let offset = 0;\r\n      for(const count of lineCounts) {\r\n        heights.push(multiHeight(offset, count));\r\n        offset += count;\r\n      }\r\n      attempts.push({lineCounts, heights}); // warn\r\n    };\r\n\r\n    for(let first = 1; first !== this.count; ++first) {\r\n      const second = this.count - first;\r\n      if(first > 3 || second > 3) {\r\n        continue;\r\n      }\r\n      pushAttempt([first, second]);\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        const third = this.count - first - second;\r\n        if((first > 3) ||\r\n          (second > ((this.averageRatio < 0.85) ? 4 : 3)) ||\r\n          (third > 3)) {\r\n          continue;\r\n        }\r\n        pushAttempt([first, second, third]);\r\n      }\r\n    }\r\n    for(let first = 1; first !== this.count - 1; ++first) {\r\n      for(let second = 1; second !== this.count - first; ++second) {\r\n        for(let third = 1; third !== this.count - first - second; ++third) {\r\n          const fourth = this.count - first - second - third;\r\n          if(first > 3 || second > 3 || third > 3 || fourth > 3) {\r\n            continue;\r\n          }\r\n          pushAttempt([first, second, third, fourth]);\r\n        }\r\n      }\r\n    }\r\n\r\n    let optimalAttempt: Attempt = null;\r\n    let optimalDiff = 0;\r\n    for(const attempt of attempts) {\r\n      const {heights, lineCounts: counts} = attempt;\r\n      const lineCount = counts.length;\r\n      const totalHeight = accumulate(heights, 0) +\r\n        this.spacing * (lineCount - 1);\r\n      const minLineHeight = Math.min(...heights);\r\n      const maxLineHeight = Math.max(...heights);\r\n      const bad1 = (minLineHeight < this.minWidth) ? 1.5 : 1;\r\n      const bad2 = (() => {\r\n        for(let line = 1; line !== lineCount; ++line) {\r\n          if(counts[line - 1] > counts[line]) {\r\n            return 1.5;\r\n          }\r\n        }\r\n        return 1.;\r\n      })();\r\n      const diff = Math.abs(totalHeight - this.maxHeight) * bad1 * bad2;\r\n      if(!optimalAttempt || diff < optimalDiff) {\r\n        optimalAttempt = attempt;\r\n        optimalDiff = diff;\r\n      }\r\n    }\r\n\r\n    const optimalCounts = optimalAttempt.lineCounts;\r\n    const optimalHeights = optimalAttempt.heights;\r\n    const rowCount = optimalCounts.length;\r\n\r\n    let index = 0;\r\n    let y = 0;\r\n    for(let row = 0; row !== rowCount; ++row) {\r\n      const colCount = optimalCounts[row];\r\n      const lineHeight = optimalHeights[row];\r\n      const height = Math.round(lineHeight);\r\n\r\n      let x = 0;\r\n      for(let col = 0; col !== colCount; ++col) {\r\n        const sides = RectPart.None |\r\n          (row === 0 ? RectPart.Top : RectPart.None) |\r\n          (row === rowCount - 1 ? RectPart.Bottom : RectPart.None) |\r\n          (col === 0 ? RectPart.Left : RectPart.None) |\r\n          (col === colCount - 1 ? RectPart.Right : RectPart.None);\r\n\r\n        const ratio = this.ratios[index];\r\n        const width = (col === colCount - 1) ?\r\n          (this.maxWidth - x) :\r\n          Math.round(ratio * lineHeight);\r\n        result[index] = {\r\n          geometry: {x, y, width, height},\r\n          sides\r\n        };\r\n\r\n        x += width + this.spacing;\r\n        ++index;\r\n      }\r\n      y += height + this.spacing;\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Layouter, RectPart} from './groupedLayout';\n\nexport default function prepareAlbum(options: {\n  container: HTMLElement,\n  items: {w: number, h: number}[],\n  maxWidth: number,\n  minWidth: number,\n  spacing: number,\n  maxHeight?: number,\n  forMedia?: true\n}) {\n  const layouter = new Layouter(options.items, options.maxWidth, options.minWidth, options.spacing, options.maxHeight);\n  const layout = layouter.layout();\n\n  const widthItem = layout.find((item) => item.sides & RectPart.Right);\n  const width = widthItem.geometry.width + widthItem.geometry.x;\n\n  const heightItem = layout.find((item) => item.sides & RectPart.Bottom);\n  const height = heightItem.geometry.height + heightItem.geometry.y;\n\n  const container = options.container;\n  container.style.width = width + 'px';\n  container.style.height = height + 'px';\n  const children = container.children;\n\n  layout.forEach(({geometry, sides}, idx) => {\n    let div: HTMLElement;\n    div = children[idx] as HTMLElement;\n    if(!div) {\n      div = document.createElement('div');\n      container.append(div);\n    }\n\n    div.classList.add('album-item', 'grouped-item');\n\n    div.style.width = (geometry.width / width * 100) + '%';\n    div.style.height = (geometry.height / height * 100) + '%';\n    div.style.top = (geometry.y / height * 100) + '%';\n    div.style.left = (geometry.x / width * 100) + '%';\n\n    if(sides & RectPart.Left && sides & RectPart.Top) {\n      div.style.borderTopLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Left && sides & RectPart.Bottom) {\n      div.style.borderBottomLeftRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Top) {\n      div.style.borderTopRightRadius = 'inherit';\n    }\n\n    if(sides & RectPart.Right && sides & RectPart.Bottom) {\n      div.style.borderBottomRightRadius = 'inherit';\n    }\n\n    if(options.forMedia) {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      div.append(mediaDiv);\n    }\n\n    // @ts-ignore\n    // div.style.backgroundColor = '#' + Math.floor(Math.random() * (2 ** 24 - 1)).toString(16).padStart(6, '0');\n  });\n\n  /* if(options.forMedia) {\n    layout.forEach((_, i) => {\n      const mediaDiv = document.createElement('div');\n      mediaDiv.classList.add('album-item-media');\n\n      options.container.children[i].append(mediaDiv);\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {Middleware} from '../../helpers/middleware';\nimport {Message, PhotoSize} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\nimport choosePhotoSize from '../../lib/appManagers/utils/photos/choosePhotoSize';\nimport rootScope from '../../lib/rootScope';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport prepareAlbum from '../prepareAlbum';\nimport wrapPhoto from './photo';\nimport wrapVideo from './video';\n\nexport default function wrapAlbum({messages, attachmentDiv, middleware, uploading, lazyLoadQueue, isOut, chat, loadPromises, autoDownload, managers = rootScope.managers}: {\n  messages: Message.message[],\n  attachmentDiv: HTMLElement,\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  uploading?: boolean,\n  isOut: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownload?: ChatAutoDownloadSettings,\n  managers?: AppManagers\n}) {\n  const items: {size: PhotoSize.photoSize, media: any, message: any}[] = [];\n\n  // !lowest msgID will be the FIRST in album\n  for(const message of messages) {\n    const media = getMediaFromMessage(message);\n\n    const size: any = media._ === 'photo' ? choosePhotoSize(media, 480, 480) : {w: media.w, h: media.h};\n    items.push({size, media, message});\n  }\n\n  /* // * pending\n  if(storage[0] < 0) {\n    items.reverse();\n  } */\n\n  prepareAlbum({\n    container: attachmentDiv,\n    items: items.map((i) => ({w: i.size.w, h: i.size.h})),\n    maxWidth: mediaSizes.active.album.width,\n    minWidth: 100,\n    spacing: 2,\n    forMedia: true\n  });\n\n  items.forEach((item, idx) => {\n    const {size, media, message} = item;\n\n    const div = attachmentDiv.children[idx] as HTMLElement;\n    div.dataset.mid = '' + message.mid;\n    div.dataset.peerId = '' + message.peerId;\n    const mediaDiv = div.firstElementChild as HTMLElement;\n    const isPhoto = media._ === 'photo';\n    let thumbPromise: Promise<any>;\n    if(isPhoto) {\n      thumbPromise = wrapPhoto({\n        photo: media,\n        message,\n        container: mediaDiv,\n        boxWidth: 0,\n        boxHeight: 0,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        size,\n        loadPromises,\n        autoDownloadSize: autoDownload.photo,\n        managers\n      });\n    } else {\n      thumbPromise = wrapVideo({\n        doc: message.media.document,\n        container: mediaDiv,\n        message,\n        boxWidth: 0,\n        boxHeight: 0,\n        withTail: false,\n        isOut,\n        lazyLoadQueue,\n        middleware,\n        loadPromises,\n        autoDownload,\n        managers\n      });\n    }\n\n    if(thumbPromise && loadPromises) {\n      loadPromises.push(thumbPromise);\n    }\n  });\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {SliderSuperTab} from '../../slider';\r\nimport appSidebarRight from '..';\r\nimport {roundPercents} from '../../poll';\r\nimport appDialogsManager from '../../../lib/appManagers/appDialogsManager';\r\nimport ripple from '../../ripple';\r\nimport {i18n} from '../../../lib/langPack';\r\nimport setInnerHTML from '../../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../../lib/richTextProcessor/wrapEmojiText';\r\n\r\nexport default class AppPollResultsTab extends SliderSuperTab {\r\n  private resultsDiv: HTMLElement;\r\n\r\n  protected init() {\r\n    this.container.id = 'poll-results-container';\r\n    this.container.classList.add('chatlist-container');\r\n\r\n    this.resultsDiv = document.createElement('div');\r\n    this.resultsDiv.classList.add('poll-results');\r\n    this.scrollable.append(this.resultsDiv);\r\n  }\r\n\r\n  public async open(message: any) {\r\n    const ret = super.open();\r\n    const poll = await this.managers.appPollsManager.getPoll(message.media.poll.id);\r\n\r\n    this.setTitle(poll.poll.pFlags.quiz ? 'PollResults.Title.Quiz' : 'PollResults.Title.Poll');\r\n\r\n    const title = document.createElement('h3');\r\n    setInnerHTML(title, wrapEmojiText(poll.poll.question));\r\n\r\n    const percents = poll.results.results.map((v) => v.voters / poll.results.total_voters * 100);\r\n    roundPercents(percents);\r\n\r\n    const fragment = document.createDocumentFragment();\r\n    poll.results.results.forEach((result, idx) => {\r\n      if(!result.voters) return;\r\n\r\n      const hr = document.createElement('hr');\r\n\r\n      const answer = poll.poll.answers[idx];\r\n\r\n      // Head\r\n      const answerEl = document.createElement('div');\r\n      answerEl.classList.add('poll-results-answer');\r\n\r\n      const answerTitle = document.createElement('div');\r\n      setInnerHTML(answerTitle, wrapEmojiText(answer.text));\r\n\r\n      const answerPercents = document.createElement('div');\r\n      answerPercents.innerText = Math.round(percents[idx]) + '%';\r\n\r\n      answerEl.append(answerTitle, answerPercents);\r\n\r\n      // Humans\r\n      const list = appDialogsManager.createChatList();\r\n      list.classList.add('poll-results-voters');\r\n\r\n      appDialogsManager.setListClickListener(list, () => {\r\n        appSidebarRight.onCloseBtnClick();\r\n      }, undefined, true);\r\n\r\n      list.style.minHeight = Math.min(result.voters, 4) * 50 + 'px';\r\n\r\n      fragment.append(hr, answerEl, list);\r\n\r\n      let offset: string, limit = 4, loading = false, left = result.voters - 4;\r\n      const load = () => {\r\n        if(loading) return;\r\n        loading = true;\r\n\r\n        this.managers.appPollsManager.getVotes(message, answer.option, offset, limit).then((votesList) => {\r\n          votesList.votes.forEach((vote) => {\r\n            const {dom} = appDialogsManager.addDialogNew({\r\n              peerId: vote.user_id.toPeerId(false),\r\n              container: list,\r\n              rippleEnabled: false,\r\n              meAsSaved: false,\r\n              avatarSize: 32\r\n            });\r\n            dom.lastMessageSpan.parentElement.remove();\r\n          });\r\n\r\n          if(offset) {\r\n            left -= votesList.votes.length;\r\n            (showMore.lastElementChild as HTMLElement).replaceWith(i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n          }\r\n\r\n          offset = votesList.next_offset;\r\n          limit = 20;\r\n\r\n          if(!left || !votesList.votes.length) {\r\n            showMore.remove();\r\n          }\r\n        }).finally(() => {\r\n          loading = false;\r\n        });\r\n      };\r\n\r\n      load();\r\n\r\n      if(left <= 0) return;\r\n\r\n      const showMore = document.createElement('div');\r\n      showMore.classList.add('poll-results-more', 'show-more', 'rp-overflow');\r\n      showMore.addEventListener('click', load);\r\n      ripple(showMore);\r\n      const down = document.createElement('div');\r\n      down.classList.add('tgico-down');\r\n      showMore.append(down, i18n('PollResults.LoadMore', [Math.min(20, left)]));\r\n\r\n      fragment.append(showMore);\r\n    });\r\n\r\n    this.resultsDiv.append(title, fragment);\r\n\r\n    appSidebarRight.toggleSidebar(true).then(() => {\r\n      /* appPollsManager.getVotes(mid).then((votes) => {\r\n        console.log('gOt VotEs', votes);\r\n      }); */\r\n    });\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport mediaSizes from '../helpers/mediaSizes';\r\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\r\nimport appImManager from '../lib/appManagers/appImManager';\r\nimport rootScope from '../lib/rootScope';\r\nimport ripple from './ripple';\r\nimport appSidebarRight from './sidebarRight';\r\nimport AppPollResultsTab from './sidebarRight/tabs/pollResults';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../lib/langPack';\r\nimport {fastRaf} from '../helpers/schedulers';\r\nimport SetTransition from './singleTransition';\r\nimport findUpClassName from '../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, detachClickEvent, simulateClickEvent} from '../helpers/dom/clickEvent';\r\nimport replaceContent from '../helpers/dom/replaceContent';\r\nimport windowSize from '../helpers/windowSize';\r\nimport {Message, MessageMedia, Poll, PollResults} from '../layer';\r\nimport toHHMMSS from '../helpers/string/toHHMMSS';\r\nimport StackedAvatars from './stackedAvatars';\r\nimport setInnerHTML from '../helpers/dom/setInnerHTML';\r\nimport {AppManagers} from '../lib/appManagers/managers';\r\nimport wrapEmojiText from '../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../lib/richTextProcessor/wrapRichText';\r\n\r\nlet lineTotalLength = 0;\r\nconst tailLength = 9;\r\nconst times = 10;\r\nconst fullTime = 340;\r\nconst oneTime = fullTime / times;\r\n\r\nexport const roundPercents = (percents: number[]) => {\r\n  // console.log('roundPercents before percents:', percents);\r\n\r\n  const sum = percents.reduce((acc, p) => acc + Math.round(p), 0);\r\n  if(sum > 100) {\r\n    const diff = sum - 100;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, minRemainder = 1;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder >= 0.5 && remainder < minRemainder) {\r\n          minRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] -= minRemainder;\r\n    }\r\n  } else if(sum < 100) {\r\n    const diff = 100 - sum;\r\n    const length = percents.length;\r\n    for(let i = 0; i < diff; ++i) {\r\n      let minIndex = -1, maxRemainder = 0;\r\n      for(let k = 0; k < length; ++k) {\r\n        const remainder = percents[k] % 1;\r\n        if(remainder < 0.5 && remainder > maxRemainder) {\r\n          maxRemainder = remainder;\r\n          minIndex = k;\r\n        }\r\n      }\r\n\r\n      if(minIndex === -1) {\r\n        // throw new Error('lol chto');\r\n        return;\r\n      }\r\n\r\n      percents[minIndex] += 1 - maxRemainder;\r\n    }\r\n  }\r\n\r\n  // console.log('roundPercents after percents:', percents);\r\n};\r\n\r\n/* const connectedPolls: {id: string, element: PollElement}[] = [];\r\nrootScope.on('poll_update', (e) => {\r\n  const {poll, results} = e as {poll: Poll, results: PollResults};\r\n\r\n  //console.log('poll_update', poll, results);\r\n  for(const connected of connectedPolls) {\r\n    if(connected.id === poll.id) {\r\n      const pollElement = connected.element;\r\n      pollElement.isClosed = !!poll.pFlags.closed;\r\n      pollElement.performResults(results, poll.chosenIndexes);\r\n    }\r\n  }\r\n}); */\r\n\r\nrootScope.addEventListener('poll_update', ({poll, results}) => {\r\n  const pollElements = Array.from(document.querySelectorAll(`poll-element[poll-id=\"${poll.id}\"]`)) as PollElement[];\r\n  pollElements.forEach((pollElement) => {\r\n    // console.log('poll_update', poll, results);\r\n    pollElement.isClosed = !!poll.pFlags.closed;\r\n    pollElement.performResults(results, poll.chosenIndexes);\r\n  });\r\n});\r\n\r\nmediaSizes.addEventListener('resize', () => {\r\n  PollElement.setMaxLength();\r\n  PollElement.resizePolls();\r\n});\r\n\r\nmediaSizes.addEventListener('changeScreen', () => {\r\n  PollElement.setMaxLength();\r\n});\r\n\r\nconst hideQuizHint = (element: HTMLElement, onHide: () => void, timeout: number) => {\r\n  element.classList.remove('active');\r\n\r\n  clearTimeout(timeout);\r\n  setTimeout(() => {\r\n    onHide();\r\n    element.remove();\r\n\r\n    if(prevQuizHint === element && prevQuizHintOnHide === onHide && prevQuizHintTimeout === timeout) {\r\n      prevQuizHint = prevQuizHintOnHide = null;\r\n      prevQuizHintTimeout = 0;\r\n    }\r\n  }, 200);\r\n};\r\n\r\nlet prevQuizHint: HTMLElement, prevQuizHintOnHide: () => void, prevQuizHintTimeout: number;\r\nlet isListenerSet = false;\r\nconst setQuizHint = (solution: string, solution_entities: any[], onHide: () => void) => {\r\n  if(prevQuizHint) {\r\n    hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n  }\r\n\r\n  const element = document.createElement('div');\r\n  element.classList.add('quiz-hint');\r\n\r\n  const container = document.createElement('div');\r\n  container.classList.add('container', 'tgico');\r\n\r\n  const textEl = document.createElement('div');\r\n  textEl.classList.add('text');\r\n\r\n  container.append(textEl);\r\n  element.append(container);\r\n\r\n  setInnerHTML(textEl, wrapRichText(solution, {entities: solution_entities}));\r\n  appImManager.chat.bubbles.container.append(element);\r\n\r\n  void element.offsetLeft; // reflow\r\n  element.classList.add('active');\r\n\r\n  prevQuizHint = element;\r\n  prevQuizHintOnHide = onHide;\r\n  prevQuizHintTimeout = window.setTimeout(() => {\r\n    hideQuizHint(element, onHide, prevQuizHintTimeout);\r\n  }, IS_TOUCH_SUPPORTED ? 5000 : 7000);\r\n\r\n  if(!isListenerSet) {\r\n    isListenerSet = true;\r\n    appImManager.addEventListener('peer_changed', () => {\r\n      if(prevQuizHint) {\r\n        hideQuizHint(prevQuizHint, prevQuizHintOnHide, prevQuizHintTimeout);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport default class PollElement extends HTMLElement {\r\n  public static MAX_OFFSET = -46.5;\r\n  public static MAX_LENGTH = 0;\r\n  public svgLines: SVGSVGElement[];\r\n  private numberDivs: HTMLDivElement[];\r\n  private answerDivs: HTMLDivElement[];\r\n  private descDiv: HTMLElement;\r\n  private typeDiv: HTMLElement;\r\n  private avatarsDiv: HTMLElement;\r\n  private viewResults: HTMLElement;\r\n  private votersCountDiv: HTMLDivElement;\r\n\r\n  // private maxLength: number;\r\n  // private maxLengths: number[];\r\n  private maxPercents: number[];\r\n\r\n  public isClosed = false;\r\n  private isQuiz = false;\r\n  private isRetracted = false;\r\n  private isPublic = false;\r\n  private isMultiple = false;\r\n  private chosenIndexes: number[] = [];\r\n  private percents: number[];\r\n\r\n  public message: Message.message;\r\n  public managers: AppManagers;\r\n\r\n  private quizInterval: number;\r\n  private quizTimer: SVGSVGElement;\r\n\r\n  private sendVoteBtn: HTMLElement;\r\n  private chosingIndexes: number[] = [];\r\n\r\n  private sendVotePromise: Promise<void>;\r\n  private sentVote = false;\r\n\r\n  public static setMaxLength() {\r\n    const width = windowSize.width <= 360 ? windowSize.width - 120 : mediaSizes.active.poll.width;\r\n    this.MAX_LENGTH = width + tailLength + this.MAX_OFFSET + -13.7; // 13 - position left\r\n  }\r\n\r\n  public static resizePolls() {\r\n    if(!this.MAX_LENGTH) return;\r\n    const pollElements = Array.from(document.querySelectorAll('poll-element.is-voted')) as PollElement[];\r\n    pollElements.forEach((pollElement) => {\r\n      pollElement.svgLines.forEach((svg, idx) => {\r\n        // void svg.getBoundingClientRect(); // reflow\r\n        pollElement.setLineProgress(idx, 1);\r\n      });\r\n    });\r\n  }\r\n\r\n  public async render() {\r\n    //         \r\n    // (   ,    /)\r\n\r\n    if(!lineTotalLength) {\r\n      lineTotalLength = (document.getElementById('poll-line') as any as SVGPathElement).getTotalLength();\r\n      // console.log('line total length:', lineTotalLength);\r\n      PollElement.setMaxLength();\r\n    }\r\n\r\n    // const {poll, results} = this.managers.appPollsManager.getPoll(pollId);\r\n    const {poll, results} = this.message.media as MessageMedia.messageMediaPoll;\r\n\r\n    /* const timestamp = Date.now() / 1000 | 0;\r\n    if(timestamp < this.message.date) { */\r\n    if(this.message.pFlags.is_scheduled) {\r\n      this.classList.add('disable-hover');\r\n    }\r\n\r\n    // console.log('pollElement poll:', poll, results);\r\n\r\n    let descKey: LangPackKey;\r\n    if(poll.pFlags) {\r\n      this.isPublic = !!poll.pFlags.public_voters;\r\n      this.isQuiz = !!poll.pFlags.quiz;\r\n      this.isClosed = !!poll.pFlags.closed;\r\n      this.isMultiple = !!poll.pFlags.multiple_choice;\r\n\r\n      if(this.isClosed) {\r\n        descKey = 'Chat.Poll.Type.Closed';\r\n        this.classList.add('is-closed');\r\n      } else if(this.isQuiz) {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Quiz' : 'Chat.Poll.Type.AnonymousQuiz';\r\n      } else {\r\n        descKey = this.isPublic ? 'Chat.Poll.Type.Public' : 'Chat.Poll.Type.Anonymous';\r\n      }\r\n    }\r\n\r\n    this.classList.toggle('is-multiple', this.isMultiple);\r\n\r\n    const multipleSelect = this.isMultiple ? '<span class=\"poll-answer-selected tgico-check\"></span>' : '';\r\n    const votes = poll.answers.map((answer, idx) => {\r\n      return `\r\n        <div class=\"poll-answer\" data-index=\"${idx}\">\r\n          <div class=\"circle-hover\">\r\n            <div class=\"animation-ring\"></div>\r\n            <svg class=\"progress-ring\">\r\n              <circle class=\"progress-ring__circle\" cx=\"13\" cy=\"13\" r=\"9\"></circle>\r\n            </svg>\r\n            ${multipleSelect}\r\n          </div>\r\n          <div class=\"poll-answer-percents\"></div>\r\n          <div class=\"poll-answer-text\"></div>\r\n          <svg version=\"1.1\" class=\"poll-line\" style=\"display: none;\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 485.9 35\" xml:space=\"preserve\">\r\n            <use href=\"#poll-line\"></use>\r\n          </svg>\r\n          <span class=\"poll-answer-selected tgico\"></span>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    this.innerHTML = `\r\n      <div class=\"poll-title\"></div>\r\n      <div class=\"poll-desc\">\r\n        <div class=\"poll-type\"></div>\r\n        <div class=\"poll-avatars\"></div>\r\n      </div>\r\n      ${votes}`;\r\n\r\n    setInnerHTML(this.firstElementChild, wrapEmojiText(poll.question));\r\n\r\n    Array.from(this.querySelectorAll('.poll-answer-text')).forEach((el, idx) => {\r\n      setInnerHTML(el, wrapEmojiText(poll.answers[idx].text));\r\n    });\r\n\r\n    this.descDiv = this.firstElementChild.nextElementSibling as HTMLElement;\r\n    this.typeDiv = this.descDiv.firstElementChild as HTMLElement;\r\n    this.avatarsDiv = this.descDiv.lastElementChild as HTMLElement;\r\n\r\n    if(descKey) {\r\n      this.typeDiv.append(i18n(descKey));\r\n    }\r\n\r\n    if(this.isQuiz) {\r\n      this.classList.add('is-quiz');\r\n\r\n      if(poll.close_period && poll.close_date) {\r\n        const timeLeftDiv = document.createElement('div');\r\n        timeLeftDiv.classList.add('poll-time');\r\n        this.descDiv.append(timeLeftDiv);\r\n\r\n        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n        // svg.setAttributeNS(null, 'viewBox', '0 0 15 15');\r\n        svg.classList.add('poll-quiz-timer');\r\n\r\n        this.quizTimer = svg;\r\n\r\n        const strokeWidth = 2;\r\n        const radius = 7;\r\n        const circumference = 2 * Math.PI * radius;\r\n\r\n        const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\r\n        circle.classList.add('poll-quiz-timer-circle');\r\n        circle.setAttributeNS(null, 'cx', '16');\r\n        circle.setAttributeNS(null, 'cy', '16');\r\n        circle.setAttributeNS(null, 'r', '' + radius);\r\n        circle.setAttributeNS(null, 'stroke-width', '' + strokeWidth);\r\n\r\n        svg.append(circle);\r\n        this.descDiv.append(svg);\r\n\r\n        const period = poll.close_period * 1000;\r\n        const closeTime = (poll.close_date - await rootScope.managers.timeManager.getServerTimeOffset()) * 1000;\r\n\r\n        // console.log('closeTime:', poll.close_date, serverTimeManager.serverTimeOffset, Date.now() / 1000 | 0);\r\n\r\n        // let time = Date.now();\r\n        // let percents = (closeTime - time) / period;\r\n\r\n        // timeLeftDiv.innerHTML = String((closeTime - time) / 1000 + 1 | 0).toHHMMSS();\r\n\r\n        // // @ts-ignore\r\n        // circle.style.strokeDashoffset = circumference + percents * circumference;\r\n        // circle.style.strokeDasharray = ${circumference} ${circumference};\r\n\r\n        this.quizInterval = window.setInterval(() => {\r\n          const time = Date.now();\r\n          const percents = (closeTime - time) / period;\r\n          const timeLeft = (closeTime - time) / 1000 + 1 | 0;\r\n          timeLeftDiv.innerHTML = toHHMMSS(timeLeft);\r\n\r\n          if(timeLeft <= 5) {\r\n            timeLeftDiv.style.color = '#ee545c';\r\n            circle.style.stroke = '#ee545c';\r\n          }\r\n          // timeLeftDiv.style.visibility = 'visible';\r\n\r\n          // @ts-ignore\r\n          circle.style.strokeDashoffset = circumference + percents * circumference;\r\n          circle.style.strokeDasharray = `${circumference} ${circumference}`;\r\n\r\n          if(time >= closeTime) {\r\n            clearInterval(this.quizInterval);\r\n            timeLeftDiv.innerHTML = '';\r\n            // @ts-ignore\r\n            circle.style.strokeDashoffset = circumference;\r\n            this.quizInterval = 0;\r\n\r\n            setTimeout(() => {\r\n              //      \r\n              this.managers.appPollsManager.getResults(this.message);\r\n            }, 3e3);\r\n          }\r\n        }, 1e3);\r\n      }\r\n    }\r\n\r\n    this.answerDivs = Array.from(this.querySelectorAll('.poll-answer')) as HTMLDivElement[];\r\n    this.svgLines = Array.from(this.querySelectorAll('.poll-line')) as SVGSVGElement[];\r\n    this.numberDivs = Array.from(this.querySelectorAll('.poll-answer-percents')) as HTMLDivElement[];\r\n\r\n    const footerDiv = document.createElement('div');\r\n    footerDiv.classList.add('poll-footer');\r\n\r\n    this.viewResults = document.createElement('div');\r\n    this.viewResults.className = 'poll-footer-button poll-view-results hide';\r\n    this.viewResults.append(i18n('Chat.Poll.ViewResults'));\r\n\r\n    this.votersCountDiv = document.createElement('div');\r\n    this.votersCountDiv.className = 'poll-votes-count';\r\n\r\n    footerDiv.append(this.viewResults, this.votersCountDiv);\r\n    this.append(footerDiv);\r\n\r\n    this.viewResults.addEventListener('click', (e) => {\r\n      cancelEvent(e);\r\n\r\n      if(!appSidebarRight.isTabExists(AppPollResultsTab)) {\r\n        appSidebarRight.createTab(AppPollResultsTab).open(this.message);\r\n      }\r\n    });\r\n    ripple(this.viewResults);\r\n\r\n    if(this.isMultiple) {\r\n      this.sendVoteBtn = document.createElement('div');\r\n      this.sendVoteBtn.classList.add('poll-footer-button', 'poll-send-vote');\r\n      this.sendVoteBtn.append(i18n('Chat.Poll.SubmitVote'));\r\n      ripple(this.sendVoteBtn);\r\n\r\n      if(!poll.chosenIndexes.length) {\r\n        this.votersCountDiv.classList.add('hide');\r\n      }\r\n\r\n      attachClickEvent(this.sendVoteBtn, (e) => {\r\n        cancelEvent(e);\r\n        /* const indexes = this.answerDivs.filter((el) => el.classList.contains('is-chosing')).map((el) => +el.dataset.index);\r\n        if(indexes.length) {\r\n\r\n        } */\r\n        if(this.chosingIndexes.length) {\r\n          this.sendVotes(this.chosingIndexes).then(() => {\r\n            this.chosingIndexes.length = 0;\r\n            this.answerDivs.forEach((el) => {\r\n              el.classList.remove('is-chosing');\r\n            });\r\n          });\r\n        }\r\n      });\r\n\r\n      footerDiv.append(this.sendVoteBtn);\r\n    }\r\n\r\n    // const width = this.getBoundingClientRect().width;\r\n    // const width = mediaSizes.active.poll.width;\r\n    // this.maxLength = width + tailLength + this.maxOffset + -13.7; // 13 - position left\r\n\r\n    const canVote = !(poll.chosenIndexes.length || this.isClosed);\r\n    if(!canVote || this.isPublic) {\r\n      this.performResults(results, poll.chosenIndexes, false);\r\n    }\r\n\r\n    if(canVote) {\r\n      this.setVotersCount(results);\r\n      attachClickEvent(this, this.clickHandler);\r\n    }\r\n  }\r\n\r\n  initQuizHint(results: PollResults) {\r\n    if(results.solution && results.solution_entities) {\r\n      const toggleHint = document.createElement('div');\r\n      toggleHint.classList.add('tgico-tip', 'poll-hint');\r\n      this.descDiv.append(toggleHint);\r\n\r\n      // let active = false;\r\n      attachClickEvent(toggleHint, (e) => {\r\n        cancelEvent(e);\r\n\r\n        // active = true;\r\n        toggleHint.classList.add('active');\r\n        setQuizHint(results.solution, results.solution_entities, () => {\r\n          // active = false;\r\n          toggleHint.classList.remove('active');\r\n        });\r\n      });\r\n\r\n      if(this.sentVote) {\r\n        const correctResult = results.results.find((r) => r.pFlags.correct);\r\n        if(correctResult && !correctResult.pFlags.chosen) {\r\n          simulateClickEvent(toggleHint);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  clickHandler(e: Event) {\r\n    const target = findUpClassName(e.target, 'poll-answer') as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n    const answerIndex = +target.dataset.index;\r\n    if(this.isMultiple) {\r\n      target.classList.toggle('is-chosing');\r\n\r\n      const foundIndex = this.chosingIndexes.indexOf(answerIndex);\r\n      if(foundIndex !== -1) {\r\n        this.chosingIndexes.splice(foundIndex, 1);\r\n      } else {\r\n        this.chosingIndexes.push(answerIndex);\r\n      }\r\n    } else {\r\n      this.sendVotes([answerIndex]);\r\n    }\r\n\r\n    /* target.classList.add('is-voting');\r\n    setTimeout(() => { // simulate\r\n      this.setResults([100, 0], answerIndex);\r\n      target.classList.remove('is-voting');\r\n    }, 1000); */\r\n  }\r\n\r\n  sendVotes(indexes: number[]) {\r\n    if(this.sendVotePromise) return this.sendVotePromise;\r\n\r\n    const targets = this.answerDivs.filter((_, idx) => indexes.includes(idx));\r\n    targets.forEach((target) => {\r\n      target.classList.add('is-voting');\r\n    });\r\n\r\n    this.classList.add('disable-hover');\r\n    this.sentVote = true;\r\n    return this.sendVotePromise = this.managers.appPollsManager.sendVote(this.message, indexes).then(() => {\r\n      targets.forEach((target) => {\r\n        target.classList.remove('is-voting');\r\n      });\r\n\r\n      this.classList.remove('disable-hover');\r\n    }).catch(() => {\r\n      this.sentVote = false;\r\n    }).finally(() => {\r\n      this.sendVotePromise = null;\r\n    });\r\n  }\r\n\r\n  performResults(results: PollResults, chosenIndexes: number[], animate = true) {\r\n    if(!rootScope.settings.animationsEnabled) {\r\n      animate = false;\r\n    }\r\n\r\n    if(this.isQuiz && (results.results?.length || this.isClosed)) {\r\n      this.answerDivs.forEach((el, idx) => {\r\n        el.classList.toggle('is-correct', !!results.results[idx].pFlags.correct);\r\n      });\r\n\r\n      if(this.initQuizHint) {\r\n        this.initQuizHint(results);\r\n        this.initQuizHint = null;\r\n      }\r\n\r\n      if(this.quizInterval) {\r\n        clearInterval(this.quizInterval);\r\n        this.quizInterval = 0;\r\n      }\r\n\r\n      if(this.quizTimer?.parentElement) {\r\n        this.quizTimer.remove();\r\n      }\r\n\r\n      const timeEl = this.descDiv.querySelector('.poll-time');\r\n      if(timeEl) {\r\n        timeEl.remove();\r\n      }\r\n    }\r\n\r\n    if(this.isClosed) {\r\n      this.classList.add('is-closed');\r\n      replaceContent(this.typeDiv, i18n('Chat.Poll.Type.Closed'));\r\n    }\r\n\r\n    // set chosen\r\n    if(this.chosenIndexes.length !== chosenIndexes.length || this.isClosed) { // if we voted\r\n      this.isRetracted = this.chosenIndexes.length && !chosenIndexes.length;\r\n      this.chosenIndexes = chosenIndexes.slice();\r\n\r\n      if(this.isRetracted) {\r\n        attachClickEvent(this, this.clickHandler);\r\n      } else {\r\n        detachClickEvent(this, this.clickHandler);\r\n      }\r\n    }\r\n\r\n    // is need update\r\n    if(this.chosenIndexes.length || this.isRetracted || this.isClosed) {\r\n      const percents = results.results.map((v) => results.total_voters ? v.voters / results.total_voters * 100 : 0);\r\n\r\n      this.classList.toggle('no-transition', !animate);\r\n      if(animate) {\r\n        SetTransition(this, '', !this.isRetracted, 340);\r\n      }\r\n\r\n      fastRaf(() => {\r\n        this.setResults(this.isRetracted ? this.percents : percents, this.chosenIndexes, animate);\r\n        this.percents = percents;\r\n        this.isRetracted = false;\r\n      });\r\n    }\r\n\r\n    this.setVotersCount(results);\r\n\r\n    if(this.isPublic) {\r\n      if(!this.isMultiple) {\r\n        this.viewResults.classList.toggle('hide', !results.total_voters || !this.chosenIndexes.length);\r\n        this.votersCountDiv.classList.toggle('hide', !!this.chosenIndexes.length);\r\n      }\r\n\r\n      const peerIds = (results.recent_voters || []).map((userId) => userId.toPeerId());\r\n      const stackedAvatars = new StackedAvatars({avatarSize: 16});\r\n      stackedAvatars.render(peerIds);\r\n      replaceContent(this.avatarsDiv, stackedAvatars.container);\r\n    }\r\n\r\n    if(this.isMultiple) {\r\n      const isVoted = !!this.chosenIndexes.length;\r\n\r\n      const hideSendVoteBtn = this.isClosed || isVoted;\r\n      const hideViewResultsBtn = !this.isPublic || !results.total_voters || (!isVoted && !this.isClosed);\r\n      this.sendVoteBtn.classList.toggle('hide', hideSendVoteBtn);\r\n      this.viewResults.classList.toggle('hide', hideViewResultsBtn);\r\n      this.votersCountDiv.classList.toggle('hide', !hideSendVoteBtn || !hideViewResultsBtn);\r\n    }\r\n  }\r\n\r\n  setResults(percents: number[], chosenIndexes: number[], animate: boolean) {\r\n    this.svgLines.forEach((svg) => svg.style.display = '');\r\n\r\n    this.answerDivs.forEach((el, idx) => {\r\n      el.classList.toggle('is-chosen', chosenIndexes.includes(idx));\r\n    });\r\n\r\n    const maxValue = Math.max(...percents);\r\n    // this.maxLengths = percents.map((p) => p / maxValue * this.maxLength);\r\n    this.maxPercents = percents.map((p) => p / maxValue);\r\n\r\n    // line\r\n    if(this.isRetracted) {\r\n      this.svgLines.forEach((svg, idx) => {\r\n        this.setLineProgress(idx, -1);\r\n      });\r\n    } else {\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg, idx) => {\r\n          // void svg.getBoundingClientRect(); // reflow\r\n          this.setLineProgress(idx, 1);\r\n        });\r\n      };\r\n\r\n      animate ? fastRaf(cb) : cb();\r\n    }\r\n\r\n    percents = percents.slice();\r\n    roundPercents(percents);\r\n    let getPercentValue: (percents: number, index: number) => number;\r\n    const iterate = (i: number) => {\r\n      percents.forEach((percents, idx) => {\r\n        const value = getPercentValue(percents, i);\r\n        this.numberDivs[idx].innerText = value + '%';\r\n      });\r\n    };\r\n    // numbers\r\n    if(this.isRetracted) {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * index);\r\n\r\n      if(animate) {\r\n        for(let i = (times - 1), k = 0; i >= 0; --i, ++k) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * k);\r\n        }\r\n      } else {\r\n        iterate(0);\r\n      }\r\n    } else {\r\n      getPercentValue = (percents, index) => Math.round(percents / times * (index + 1));\r\n\r\n      if(animate) {\r\n        for(let i = 0; i < times; ++i) {\r\n          setTimeout(() => {\r\n            iterate(i);\r\n          }, oneTime * i);\r\n        }\r\n      } else {\r\n        iterate(times - 1);\r\n      }\r\n    }\r\n\r\n    if(this.isRetracted) {\r\n      if(animate) {\r\n        this.classList.add('is-retracting');\r\n      }\r\n\r\n      this.classList.remove('is-voted');\r\n      const cb = () => {\r\n        this.svgLines.forEach((svg) => svg.style.display = 'none');\r\n      };\r\n\r\n      if(animate) {\r\n        setTimeout(() => {\r\n          this.classList.remove('is-retracting');\r\n          cb();\r\n        }, fullTime);\r\n      } else {\r\n        cb();\r\n      }\r\n    } else {\r\n      this.classList.add('is-voted');\r\n    }\r\n  }\r\n\r\n  setVotersCount(results: PollResults) {\r\n    const votersCount = results.total_voters || 0;\r\n    let key: LangPackKey;\r\n    const args: FormatterArguments = [votersCount];\r\n    if(this.isClosed) {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesResultEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesResultEmpty';\r\n    } else {\r\n      if(this.isQuiz) key = votersCount ? 'Chat.Quiz.TotalVotes' : 'Chat.Quiz.TotalVotesEmpty';\r\n      else key = votersCount ? 'Chat.Poll.TotalVotes1' : 'Chat.Poll.TotalVotesEmpty';\r\n    }\r\n\r\n    replaceContent(this.votersCountDiv, i18n(key, args));\r\n  }\r\n\r\n  setLineProgress(index: number, multiplier: number) {\r\n    const svg = this.svgLines[index];\r\n\r\n    if(multiplier === -1) {\r\n      svg.style.strokeDasharray = '';\r\n      svg.style.strokeDashoffset = '';\r\n    } else {\r\n      // svg.style.strokeDasharray = (multiplier * this.maxLengths[index]) + ', 485.9';\r\n      svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * PollElement.MAX_LENGTH) + ', 485.9';\r\n      // svg.style.strokeDasharray = (multiplier * this.maxPercents[index] * 100) + '%, 485.9';\r\n      svg.style.strokeDashoffset = '' + multiplier * PollElement.MAX_OFFSET;\r\n    }\r\n  }\r\n\r\n  //         \r\n}\r\n\r\ncustomElements.define('poll-element', PollElement);\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppImManager, ChatSavedPosition} from '../../lib/appManagers/appImManager';\nimport type {HistoryResult, MyMessage} from '../../lib/appManagers/appMessagesManager';\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport type Chat from './chat';\nimport appImManager, {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {logger} from '../../lib/logger';\nimport rootScope from '../../lib/rootScope';\nimport BubbleGroups from './bubbleGroups';\nimport PopupDatePicker from '../popups/datePicker';\nimport PopupForward from '../popups/forward';\nimport PopupStickers from '../popups/stickers';\nimport ProgressivePreloader from '../preloader';\nimport Scrollable, {SliceSides} from '../scrollable';\nimport StickyIntersector from '../stickyIntersector';\nimport animationIntersector from '../animationIntersector';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport {IS_ANDROID, IS_APPLE, IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\nimport I18n, {FormatterArguments, i18n, langPack, LangPackKey, UNSUPPORTED_LANG_PACK_KEY, _i18n} from '../../lib/langPack';\nimport AvatarElement from '../avatar';\nimport ripple from '../ripple';\nimport {MessageRender} from './messageRender';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PollElement from '../poll';\nimport AudioElement from '../audio';\nimport {ChatInvite, Document, Message, MessageEntity,  MessageMedia,  MessageReplyHeader, Photo, PhotoSize, ReactionCount, ReplyMarkup, SponsoredMessage, Update, User, WebPage} from '../../layer';\nimport {BOT_START_PARAM, NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport {FocusDirection, ScrollStartCallbackDimensions} from '../../helpers/fastSmoothScroll';\nimport useHeavyAnimationCheck, {getHeavyAnimationPromise, dispatchHeavyAnimationEvent, interruptHeavyAnimation} from '../../hooks/useHeavyAnimationCheck';\nimport {fastRaf, fastRafPromise} from '../../helpers/schedulers';\nimport deferredPromise from '../../helpers/cancellablePromise';\nimport RepliesElement from './replies';\nimport DEBUG from '../../config/debug';\nimport {SliceEnd} from '../../helpers/slicedArray';\nimport PeerTitle from '../peerTitle';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport {toast, toastNew} from '../toast';\nimport {getElementByPoint} from '../../helpers/dom/getElementByPoint';\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport htmlToDocumentFragment from '../../helpers/dom/htmlToDocumentFragment';\nimport reflowScrollableElement from '../../helpers/dom/reflowScrollableElement';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport whichChild from '../../helpers/dom/whichChild';\nimport {cancelAnimationByKey} from '../../helpers/animation';\nimport assumeType from '../../helpers/assumeType';\nimport debounce, {DebounceReturnType} from '../../helpers/schedulers/debounce';\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\nimport windowSize from '../../helpers/windowSize';\nimport {formatPhoneNumber} from '../../helpers/formatPhoneNumber';\nimport AppMediaViewer from '../appMediaViewer';\nimport SetTransition from '../singleTransition';\nimport handleHorizontalSwipe from '../../helpers/dom/handleHorizontalSwipe';\nimport findUpAttribute from '../../helpers/dom/findUpAttribute';\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\nimport formatCallDuration from '../../helpers/formatCallDuration';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport Button from '../button';\nimport {CallType} from '../../lib/calls/types';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport PopupJoinChatInvite from '../popups/joinChatInvite';\nimport {InternalLink, INTERNAL_LINK_TYPE} from '../../lib/appManagers/internalLink';\nimport ReactionsElement, {REACTIONS_ELEMENTS} from './reactions';\nimport type ReactionElement from './reaction';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport pause from '../../helpers/schedulers/pause';\nimport ScrollSaver from '../../helpers/scrollSaver';\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport formatNumber from '../../helpers/number/formatNumber';\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\nimport SuperIntersectionObserver from '../../helpers/dom/superIntersectionObserver';\nimport generateFakeIcon from '../generateFakeIcon';\nimport copyFromElement from '../../helpers/dom/copyFromElement';\nimport PopupElement from '../popups';\nimport setAttachmentSize from '../../helpers/setAttachmentSize';\nimport wrapWebPageDescription from '../wrappers/webPageDescription';\nimport wrapWebPageTitle from '../wrappers/webPageTitle';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport wrapMessageActionTextNew from '../wrappers/messageActionTextNew';\nimport isMentionUnread from '../../lib/appManagers/utils/messages/isMentionUnread';\nimport getMediaFromMessage from '../../lib/appManagers/utils/messages/getMediaFromMessage';\nimport getPeerColorById from '../../lib/appManagers/utils/peers/getPeerColorById';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\nimport generateMessageId from '../../lib/appManagers/utils/messageId/generateMessageId';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport {Awaited, SendMessageEmojiInteractionData} from '../../types';\nimport idleController from '../../helpers/idleController';\nimport overlayCounter from '../../helpers/overlayCounter';\nimport {cancelContextMenuOpening} from '../../helpers/dom/attachContextMenuListener';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport noop from '../../helpers/noop';\nimport getAlbumText from '../../lib/appManagers/utils/messages/getAlbumText';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport PopupPayment from '../popups/payment';\nimport isInDOM from '../../helpers/dom/isInDOM';\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\nimport attachStickerViewerListeners from '../stickerViewer';\nimport {makeMediaSize, MediaSize} from '../../helpers/mediaSize';\nimport wrapSticker, {onEmojiStickerClick} from '../wrappers/sticker';\nimport wrapAlbum from '../wrappers/album';\nimport wrapDocument from '../wrappers/document';\nimport wrapGroupedDocuments from '../wrappers/groupedDocuments';\nimport wrapPhoto from '../wrappers/photo';\nimport wrapPoll from '../wrappers/poll';\nimport wrapVideo from '../wrappers/video';\n\nexport const USER_REACTIONS_INLINE = false;\nconst USE_MEDIA_TAILS = false;\nconst IGNORE_ACTIONS: Set<Message.messageService['action']['_']> = new Set([\n  'messageActionHistoryClear',\n  'messageActionChatCreate'/* ,\n  'messageActionChannelMigrateFrom' */\n]);\n\nexport const SERVICE_AS_REGULAR: Set<Message.messageService['action']['_']> = new Set();\n\nif(IS_CALL_SUPPORTED) {\n  SERVICE_AS_REGULAR.add('messageActionPhoneCall');\n}\n\nconst TEST_SCROLL_TIMES: number = undefined;\nlet TEST_SCROLL = TEST_SCROLL_TIMES;\n\nlet queueId = 0;\n\ntype GenerateLocalMessageType<IsService> = IsService extends true ? Message.messageService : Message.message;\n\nconst SPONSORED_MESSAGE_ID_OFFSET = 1;\nexport const STICKY_OFFSET = 3;\nconst SCROLLED_DOWN_THRESHOLD = 300;\nconst PEER_CHANGED_ERROR = new Error('peer changed');\n\nconst DO_NOT_SLICE_VIEWPORT = false;\nconst DO_NOT_SLICE_VIEWPORT_ON_RENDER = false;\nconst DO_NOT_UPDATE_MESSAGE_VIEWS = false;\nconst DO_NOT_UPDATE_MESSAGE_REACTIONS = false;\nconst DO_NOT_UPDATE_MESSAGE_REPLY = false;\n\nconst BIG_EMOJI_SIZES: {[size: number]: number} = {\n  1: 96,\n  2: 90,\n  3: 84,\n  4: 72,\n  5: 60,\n  6: 48,\n  7: 36\n};\nconst BIG_EMOJI_SIZES_LENGTH = Object.keys(BIG_EMOJI_SIZES).length;\n\ntype Bubble = {\n  bubble: HTMLElement,\n  mids: Set<number>,\n  groupedId?: string\n};\n\ntype MyHistoryResult = HistoryResult | {history: number[]};\n\nfunction getMainMidForGrouped(mids: number[]) {\n  return Math.max(...mids);\n}\n\nexport default class ChatBubbles {\n  public container: HTMLDivElement;\n  public chatInner: HTMLDivElement;\n  public scrollable: Scrollable;\n\n  private getHistoryTopPromise: Promise<boolean>;\n  private getHistoryBottomPromise: Promise<boolean>;\n\n  // public messagesCount: number = -1;\n\n  private unreadOut = new Set<number>();\n  public needUpdate: {replyToPeerId: PeerId, replyMid: number, mid: number}[] = []; // if need wrapSingleMessage\n\n  public bubbles: {[mid: string]: HTMLElement} = {};\n  public skippedMids: Set<number> = new Set();\n  public bubblesNewByGroupedId: {[groupId: string]: Bubble} = {};\n  public bubblesNew: {[mid: string]: Bubble} = {};\n  private dateMessages: {[timestamp: number]: {\n    div: HTMLElement,\n    firstTimestamp: number,\n    container: HTMLElement,\n    timeout?: number\n  }} = {};\n\n  private scrolledDown = true;\n  private isScrollingTimeout = 0;\n\n  private stickyIntersector: StickyIntersector;\n\n  private unreaded: Map<HTMLElement, number> = new Map();\n  private unreadedSeen: Set<number> = new Set();\n  private readPromise: Promise<void>;\n\n  private bubbleGroups: BubbleGroups;\n\n  private preloader: ProgressivePreloader = null;\n\n  public messagesQueuePromise: Promise<void> = null;\n  private messagesQueue: ReturnType<ChatBubbles['safeRenderMessage']>[] = [];\n  // private messagesQueueOnRender: () => void = null;\n  private messagesQueueOnRenderAdditional: () => void = null;\n\n  private firstUnreadBubble: HTMLElement = null;\n  private attachedUnreadBubble: boolean;\n\n  public lazyLoadQueue: LazyLoadQueue;\n\n  private middlewareHelper = getMiddleware();\n\n  private log: ReturnType<typeof logger>;\n\n  public listenerSetter: ListenerSetter;\n\n  private replyFollowHistory: number[] = [];\n\n  private isHeavyAnimationInProgress = false;\n  private scrollingToBubble: HTMLElement;\n\n  private isFirstLoad = true;\n  private needReflowScroll: boolean;\n\n  private fetchNewPromise: Promise<void>;\n\n  private passEntities: Partial<{\n    [_ in MessageEntity['_']]: boolean\n  }> = {};\n\n  private onAnimateLadder: () => Promise<any> | void;\n  // private ladderDeferred: CancellablePromise<void>;\n  private resolveLadderAnimation: () => Promise<any>;\n  private emptyPlaceholderBubble: HTMLElement;\n\n  private viewsMids: Set<number> = new Set();\n  private sendViewCountersDebounced: () => Promise<void>;\n\n  private isTopPaddingSet = false;\n\n  private getSponsoredMessagePromise: Promise<void>;\n\n  private previousStickyDate: HTMLElement;\n  private sponsoredMessage: SponsoredMessage.sponsoredMessage;\n\n  private hoverBubble: HTMLElement;\n  private hoverReaction: HTMLElement;\n  private sliceViewportDebounced: DebounceReturnType<ChatBubbles['sliceViewport']>;\n  private resizeObserver: ResizeObserver;\n  private willScrollOnLoad: boolean;\n  private observer: SuperIntersectionObserver;\n\n  private renderingMessages: Set<number> = new Set();\n  private setPeerCached: boolean;\n  private attachPlaceholderOnRender: () => void;\n\n  private bubblesToEject: Set<HTMLElement> = new Set();\n  private bubblesToReplace: Map<HTMLElement, HTMLElement> = new Map(); // TO -> FROM\n  private updatePlaceholderPosition: () => void;\n  private setPeerOptions: {lastMsgId: number; topMessage: number;};\n\n  private setPeerTempId: number = 0;\n\n  private renderNewPromises: Set<Promise<any>> = new Set();\n  private updateGradient: boolean;\n\n  // private reactions: Map<number, ReactionsElement>;\n\n  constructor(\n    private chat: Chat,\n    private managers: AppManagers\n  ) {\n    this.log = this.chat.log;\n    // this.chat.log.error('Bubbles construction');\n\n    this.listenerSetter = new ListenerSetter();\n\n    this.constructBubbles();\n\n    // * constructor end\n\n    this.bubbleGroups = new BubbleGroups(this.chat);\n    this.preloader = new ProgressivePreloader({\n      cancelable: false\n    });\n    this.lazyLoadQueue = new LazyLoadQueue();\n    this.lazyLoadQueue.queueId = ++queueId;\n\n    // this.reactions = new Map();\n\n    // * events\n\n    // will call when sent for update pos\n    this.listenerSetter.add(rootScope)('history_update', async({storageKey, sequential, message}) => {\n      if(this.chat.messagesStorageKey !== storageKey || this.chat.type === 'scheduled') {\n        return;\n      }\n\n      const {mid} = message;\n      const log = false ? this.log.bindPrefix('history_update-' + mid) : undefined;\n      log && log('start');\n\n      const bubble = this.bubbles[mid];\n      if(!bubble) return;\n\n      if(this.renderNewPromises.size) {\n        log && log.error('will await new messages render');\n        await Promise.all(Array.from(this.renderNewPromises));\n      }\n\n      if(this.messagesQueuePromise) {\n        log && log.error('messages render in process');\n        await this.messagesQueuePromise;\n      }\n\n      if(this.bubbles[mid] !== bubble) return;\n\n      // await getHeavyAnimationPromise();\n\n      const item = this.bubbleGroups.getItemByBubble(bubble);\n      if(!item) { // probably a group item\n        log && log.error('no item by bubble', bubble);\n        return;\n      } else if(item.mid === mid) {\n        log && log.warn('wow what', item, mid);\n        return;\n      }\n\n      if(sequential) {\n        const group = item.group;\n        const newItem = this.bubbleGroups.createItem(bubble, message);\n        // newItem.mid = item.mid;\n        const _items = this.bubbleGroups.itemsArr.slice();\n        indexOfAndSplice(_items, item);\n        const foundItem = this.bubbleGroups.findGroupSiblingByItem(newItem, _items);\n        if(\n          group === foundItem?.group ||\n          (group === this.bubbleGroups.getLastGroup() && group.items.length === 1 && newItem.dateTimestamp === item.dateTimestamp) ||\n          (this.peerId === rootScope.myId && sequential && newItem.dateTimestamp === item.dateTimestamp)\n        ) {\n          log && log('item has correct position', item);\n          this.bubbleGroups.changeBubbleMid(bubble, mid);\n          return;\n        }\n      }\n\n      // return;\n\n      // await fastRafPromise();\n      // if(this.bubbles[mid] !== bubble) return;\n\n      // const groupIndex = this.bubbleGroups.groups.indexOf(group);\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\n      // if(!group.items.length) { // group has collapsed, next message can have higher mid so have to reposition them too\n      //   log && log('group has collapsed', item);\n\n      //   const siblingGroups = this.bubbleGroups.groups.slice(0, groupIndex + 1);\n      //   for(let length = siblingGroups.length, i = length - 2; i >= 0; --i) {\n      //     const siblingGroup = siblingGroups[i];\n      //     const siblingItems = siblingGroup.items;\n      //     const nextGroup = siblingGroups[i + 1];\n      //     const nextItems = nextGroup.items;\n\n      //     let _break = false, moved = false;\n      //     for(let j = siblingItems.length - 1; j >= 0; --j) {\n      //       const siblingItem = siblingItems[j];\n      //       const foundItem = this.bubbleGroups.findGroupSiblingByItem(siblingItem, nextItems);\n      //       if(!foundItem) {\n      //         _break = true;\n      //         break;\n      //       }\n\n      //       log('will move item', siblingItem, nextGroup);\n      //       this.bubbleGroups.removeAndUnmountBubble(siblingItem.bubble);\n      //       this.bubbleGroups.addItemToGroup(siblingItem, nextGroup);\n      //       moved = true;\n      //     }\n\n      //     if(moved) {\n      //       nextGroup.mount();\n      //     }\n\n      //     if(_break) {\n      //       break;\n      //     }\n      //   }\n      // }\n\n      const {groups} = this.groupBubbles([{bubble, message}]);\n      this.bubbleGroups.mountUnmountGroups(groups);\n\n      if(this.scrollingToBubble) {\n        this.scrollToEnd();\n      }\n\n      log && log('end');\n\n      // this.bubbleGroups.findIncorrentPositions();\n    });\n\n    this.listenerSetter.add(rootScope)('dialog_flush', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.deleteMessagesByIds(Object.keys(this.bubbles).map((m) => +m));\n      }\n    });\n\n    // Calls when message successfully sent and we have an id\n    this.listenerSetter.add(rootScope)('message_sent', async(e) => {\n      const {storageKey, tempId, tempMessage, mid, message} = e;\n\n      // ! can't use peerId to validate here, because id can be the same in 'scheduled' and 'chat' types\n      if(this.chat.messagesStorageKey !== storageKey) {\n        return;\n      }\n\n      const bubbles = this.bubbles;\n      const _bubble = bubbles[tempId];\n      if(_bubble) {\n        const bubble = bubbles[tempId];\n        bubbles[mid] = bubble;\n        bubble.dataset.mid = '' + mid;\n        delete bubbles[tempId];\n\n        fastRaf(() => {\n          const mid = +bubble.dataset.mid;\n          if(bubbles[mid] === bubble && bubble.classList.contains('is-outgoing')) {\n            bubble.classList.remove('is-sending', 'is-outgoing');\n            bubble.classList.add((this.peerId === rootScope.myId && this.chat.type !== 'scheduled') || !this.unreadOut.has(mid) ? 'is-read' : 'is-sent');\n          }\n        });\n      }\n\n      if(this.unreadOut.has(tempId)) {\n        this.unreadOut.delete(tempId);\n        this.unreadOut.add(mid);\n      }\n\n      // * check timing of scheduled message\n      if(this.chat.type === 'scheduled') {\n        const timestamp = Date.now() / 1000 | 0;\n        const maxTimestamp = tempMessage.date - 10;\n        if(timestamp >= maxTimestamp) {\n          this.deleteMessagesByIds([mid]);\n        }\n      }\n\n      if(!_bubble) {\n        return;\n      }\n\n      let messages: (Message.message | Message.messageService)[], tempIds: number[];\n      const groupedId = (message as Message.message).grouped_id;\n      if(groupedId) {\n        messages = await this.managers.appMessagesManager.getMessagesByAlbum(groupedId);\n        const mids = messages.map(({mid}) => mid);\n        if(!mids.length || getMainMidForGrouped(mids) !== mid || bubbles[mid] !== _bubble) {\n          return;\n        }\n\n        if(bubbles[mid] !== _bubble) {\n          return;\n        }\n\n        tempIds = (Array.from(_bubble.querySelectorAll('.grouped-item')) as HTMLElement[]).map((el) => +el.dataset.mid);\n      } else {\n        messages = [message];\n        tempIds = [tempId];\n      }\n\n      const reactionsElements = Array.from(_bubble.querySelectorAll('reactions-element')) as ReactionsElement[];\n      if(reactionsElements.length) {\n        reactionsElements.forEach((reactionsElement) => {\n          reactionsElement.changeMessage(message as Message.message);\n        });\n      }\n\n      (messages as Message.message[]).forEach((message, idx) => {\n        if(!message) {\n          return;\n        }\n\n        const tempId = tempIds[idx];\n        const mid = message.mid;\n        const bubble: HTMLElement = _bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || _bubble;\n\n        if(message._ !== 'message') {\n          return;\n        }\n\n        if(message.replies) {\n          const repliesElement = _bubble.querySelector('replies-element') as RepliesElement;\n          if(repliesElement) {\n            repliesElement.message = message;\n            repliesElement.init();\n          }\n        }\n\n        const media = message.media ?? {} as MessageMedia.messageMediaEmpty;\n        const doc = (media as MessageMedia.messageMediaDocument).document as Document.document;\n        const poll = (media as MessageMedia.messageMediaPoll).poll;\n        const webPage = (media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage;\n        if(doc) {\n          const div = bubble.querySelector(`.document-container[data-mid=\"${tempId}\"] .document`);\n          if(div) {\n            const container = findUpClassName(div, 'document-container');\n\n            if(!tempMessage.media?.document?.thumbs?.length && doc.thumbs?.length) {\n              getHeavyAnimationPromise().then(async() => {\n                const timeSpan = div.querySelector('.time');\n                const newDiv = await wrapDocument({message});\n                div.replaceWith(newDiv);\n\n                if(timeSpan) {\n                  newDiv.querySelector('.document').append(timeSpan);\n                }\n              });\n            }\n\n            if(container) {\n              container.dataset.mid = '' + mid;\n            }\n          }\n\n          const element = bubble.querySelector(`audio-element[data-mid=\"${tempId}\"], .document[data-doc-id=\"${tempId}\"], .media-round[data-mid=\"${tempId}\"]`) as HTMLElement;\n          if(element) {\n            if(element instanceof AudioElement || element.classList.contains('media-round')) {\n              element.dataset.mid = '' + message.mid;\n              delete element.dataset.isOutgoing;\n              (element as any).message = message;\n              (element as any).onLoad(true);\n            } else {\n              element.dataset.docId = '' + doc.id;\n              (element as any).doc = doc;\n            }\n          }\n        } else if(poll) {\n          const pollElement = bubble.querySelector('poll-element') as PollElement;\n          if(pollElement) {\n            pollElement.message = message;\n            pollElement.setAttribute('poll-id', '' + poll.id);\n            pollElement.setAttribute('message-id', '' + mid);\n          }\n        } else if(webPage && !bubble.querySelector('.web')) {\n          getHeavyAnimationPromise().then(() => {\n            this.safeRenderMessage(message, true, bubble);\n            this.scrollToBubbleIfLast(bubble);\n          });\n        }\n\n        // set new mids to album items for mediaViewer\n        if(groupedId) {\n          const item = (bubble.querySelector(`.grouped-item[data-mid=\"${tempId}\"]`) as HTMLElement) || bubble; // * it can be .document-container\n          if(item) {\n            item.dataset.mid = '' + mid;\n          }\n        }\n      });\n    });\n\n    this.listenerSetter.add(rootScope)('message_edit', async({storageKey, message}) => {\n      if(storageKey !== this.chat.messagesStorageKey) return;\n\n      const bubble = this.bubbles[message.mid];\n      if(!bubble) return;\n\n      await getHeavyAnimationPromise();\n      if(this.bubbles[message.mid] !== bubble) return;\n\n      this.safeRenderMessage(message, true, bubble);\n    });\n\n    this.listenerSetter.add(rootScope)('message_error', async({storageKey, tempId}) => {\n      if(storageKey !== this.chat.messagesStorageKey) return;\n\n      const bubble = this.bubbles[tempId];\n      if(!bubble) return;\n\n      await getHeavyAnimationPromise();\n      if(this.bubbles[tempId] !== bubble) return;\n\n      bubble.classList.remove('is-outgoing');\n      bubble.classList.add('is-error');\n    });\n\n    this.listenerSetter.add(rootScope)('album_edit', ({peerId, messages, deletedMids}) => {\n      if(peerId !== this.peerId) return;\n\n      const mids = messages.map(({mid}) => mid);\n      const oldMids = mids.concat(Array.from(deletedMids));\n      const wasMainMid = getMainMidForGrouped(oldMids);\n      const bubble = this.bubbles[wasMainMid];\n      if(!bubble) {\n        return;\n      }\n\n      const mainMid = getMainMidForGrouped(mids);\n      const message = messages.find((message) => message.mid === mainMid);\n      this.safeRenderMessage(message, true, bubble);\n    });\n\n    // this.listenerSetter.add(rootScope)('peer_title_edit', async(peerId) => {\n    //   if(peerId.isUser()) {\n    //     const middleware = this.getMiddleware();\n    //     const user = await this.managers.appUsersManager.getUser(peerId.toUserId());\n    //     if(!middleware()) return;\n\n    //     const isPremium = user?.pFlags?.premium;\n    //     const groups = this.bubbleGroups.groups.filter((group) => group.avatar?.peerId === peerId);\n    //     groups.forEach((group) => {\n    //       group.avatar.classList.toggle('is-premium', isPremium);\n    //       group.avatar.classList.toggle('tgico-star', isPremium);\n    //     });\n    //   }\n    // });\n\n    if(this.chat.type !== 'scheduled' && !DO_NOT_UPDATE_MESSAGE_REACTIONS/*  && false */) {\n      this.listenerSetter.add(rootScope)('messages_reactions', async(arr) => {\n        let scrollSaver: ScrollSaver;\n\n        const a = arr.map(async({message, changedResults}) => {\n          if(this.peerId !== message.peerId) {\n            return;\n          }\n\n          const result = await this.getMountedBubble(message.mid, message);\n          if(!result) {\n            return;\n          }\n\n          return {bubble: result.bubble, message, changedResults};\n        });\n\n        let top: number;\n        (await Promise.all(a)).filter(Boolean).forEach(({bubble, message, changedResults}) => {\n          if(!scrollSaver) {\n            scrollSaver = this.createScrollSaver(false);\n            scrollSaver.save();\n          }\n\n          const key = message.peerId + '_' + message.mid;\n          const set = REACTIONS_ELEMENTS.get(key);\n          if(set) {\n            for(const element of set) {\n              element.update(message, changedResults);\n            }\n          } else if(!message.reactions || !message.reactions.results.length) {\n            return;\n          } else {\n            this.appendReactionsElementToBubble(bubble, message, message, changedResults);\n          }\n        });\n\n        if(scrollSaver) {\n          scrollSaver.restore();\n        }\n      });\n    }\n\n    !DO_NOT_UPDATE_MESSAGE_REPLY && this.listenerSetter.add(rootScope)('messages_downloaded', async({peerId, mids}) => {\n      const middleware = this.getMiddleware();\n      await getHeavyAnimationPromise();\n      if(!middleware()) return;\n\n      (mids as number[]).forEach((mid) => {\n        const needUpdate = this.needUpdate;\n        const filtered: typeof needUpdate[0][] = [];\n        forEachReverse(this.needUpdate, (obj, idx) => {\n          if(obj.replyMid === mid && obj.replyToPeerId === peerId) {\n            this.needUpdate.splice(idx, 1)[0];\n            filtered.push(obj);\n          }\n        });\n\n        filtered.forEach(async({mid, replyMid, replyToPeerId}) => {\n          const bubble = this.bubbles[mid];\n          if(!bubble) return;\n\n          const message = (await this.chat.getMessage(mid)) as Message.message;\n\n          MessageRender.setReply({\n            chat: this.chat,\n            bubble,\n            message\n          });\n        });\n      });\n    });\n\n    attachStickerViewerListeners({listenTo: this.scrollable.container, listenerSetter: this.listenerSetter, selector: '.attachment.media-sticker-wrapper'});\n    attachClickEvent(this.scrollable.container, this.onBubblesClick, {listenerSetter: this.listenerSetter});\n    // this.listenerSetter.add(this.bubblesContainer)('click', this.onBubblesClick/* , {capture: true, passive: false} */);\n\n    this.listenerSetter.add(this.scrollable.container)('mousedown', (e) => {\n      if(e.button !== 0) return;\n\n      const code: HTMLElement = findUpTag(e.target, 'CODE');\n      if(code) {\n        cancelEvent(e);\n        copyFromElement(code);\n        toastNew({langPackKey: 'TextCopied'});\n        return;\n      }\n    });\n\n    /* if(false)  */this.stickyIntersector = new StickyIntersector(this.scrollable.container, (stuck, target) => {\n      for(const timestamp in this.dateMessages) {\n        const dateMessage = this.dateMessages[timestamp];\n        if(dateMessage.container === target) {\n          const dateBubble = dateMessage.div;\n\n          // dateMessage.container.classList.add('has-sticky-dates');\n\n          // SetTransition(dateBubble, 'kek', stuck, this.previousStickyDate ? 300 : 0);\n          // if(this.previousStickyDate) {\n          // dateBubble.classList.add('kek');\n          // }\n\n          dateBubble.classList.toggle('is-sticky', stuck);\n          if(stuck) {\n            this.previousStickyDate = dateBubble;\n          }\n\n          break;\n        }\n      }\n\n      if(this.previousStickyDate) {\n        // fastRaf(() => {\n        // this.bubblesContainer.classList.add('has-sticky-dates');\n        // });\n      }\n    });\n\n    if(!IS_SAFARI) {\n      this.sliceViewportDebounced = debounce(this.sliceViewport.bind(this), 3000, false, true);\n    }\n\n    let middleware: ReturnType<ChatBubbles['getMiddleware']>;\n    useHeavyAnimationCheck(() => {\n      this.isHeavyAnimationInProgress = true;\n      this.lazyLoadQueue.lock();\n      middleware = this.getMiddleware();\n\n      // if(this.sliceViewportDebounced) {\n      //   this.sliceViewportDebounced.clearTimeout();\n      // }\n    }, () => {\n      this.isHeavyAnimationInProgress = false;\n\n      if(middleware && middleware()) {\n        this.lazyLoadQueue.unlock();\n        this.lazyLoadQueue.refresh();\n\n        // if(this.sliceViewportDebounced) {\n        //   this.sliceViewportDebounced();\n        // }\n      }\n\n      middleware = null;\n    }, this.listenerSetter);\n  }\n\n  private constructBubbles() {\n    const container = this.container = document.createElement('div');\n    container.classList.add('bubbles', 'scrolled-down');\n\n    const chatInner = this.chatInner = document.createElement('div');\n    chatInner.classList.add('bubbles-inner');\n\n    this.setScroll();\n\n    container.append(this.scrollable.container);\n  }\n\n  public attachContainerListeners() {\n    const container = this.container;\n\n    this.chat.contextMenu.attachTo(container);\n    this.chat.selection.attachListeners(container, new ListenerSetter());\n\n    if(DEBUG) {\n      this.listenerSetter.add(container)('dblclick', async(e) => {\n        const bubble = findUpClassName(e.target, 'grouped-item') || findUpClassName(e.target, 'bubble');\n        if(bubble) {\n          const mid = +bubble.dataset.mid\n          this.log('debug message:', await this.chat.getMessage(mid));\n          this.highlightBubble(bubble);\n        }\n      });\n    }\n\n    if(this.chat.type !== 'pinned' && this.chat.type !== 'scheduled') {\n      if(!IS_MOBILE) {\n        this.listenerSetter.add(container)('dblclick', async(e) => {\n          if(this.chat.selection.isSelecting ||\n            !(await this.chat.canSend())) {\n            return;\n          }\n\n          const target = e.target as HTMLElement;\n          const bubble = target.classList.contains('bubble') ?\n            target :\n            (target.classList.contains('document-selection') ? target.parentElement : null);\n          if(bubble && !bubble.classList.contains('bubble-first')) {\n            const mid = +bubble.dataset.mid;\n            const message = await this.chat.getMessage(mid);\n            if(message.pFlags.is_outgoing) {\n              return;\n            }\n\n            this.chat.input.initMessageReply(mid);\n          }\n        });\n      } else if(IS_TOUCH_SUPPORTED) {\n        const className = 'is-gesturing-reply';\n        const MAX = 64;\n        const replyAfter = MAX * .75;\n        let shouldReply = false;\n        let target: HTMLElement;\n        let icon: HTMLElement;\n        handleHorizontalSwipe({\n          element: container,\n          verifyTouchTarget: async(e) => {\n            if(this.chat.selection.isSelecting || !(await this.chat.canSend())) {\n              return false;\n            }\n\n            // cancelEvent(e);\n            target = findUpClassName(e.target, 'bubble');\n            if(target) {\n              SetTransition(target, className, true, 250);\n              void target.offsetLeft; // reflow\n\n              if(!icon) {\n                icon = document.createElement('span');\n                icon.classList.add('tgico-reply_filled', 'bubble-gesture-reply-icon');\n              } else {\n                icon.classList.remove('is-visible');\n                icon.style.opacity = '';\n              }\n\n              target/* .querySelector('.bubble-content') */.append(icon);\n            }\n\n            return !!target;\n          },\n          onSwipe: (xDiff, yDiff) => {\n            shouldReply = xDiff >= replyAfter;\n\n            if(shouldReply && !icon.classList.contains('is-visible')) {\n              icon.classList.add('is-visible');\n            }\n            icon.style.opacity = '' + Math.min(1, xDiff / replyAfter);\n\n            const x = -Math.max(0, Math.min(MAX, xDiff));\n            target.style.transform = `translateX(${x}px)`;\n            cancelContextMenuOpening();\n          },\n          onReset: () => {\n            const _target = target;\n            SetTransition(_target, className, false, 250, () => {\n              if(icon.parentElement === _target) {\n                icon.classList.remove('is-visible');\n                icon.remove();\n              }\n            });\n\n            fastRaf(() => {\n              _target.style.transform = ``;\n\n              if(shouldReply) {\n                const {mid} = _target.dataset;\n                this.chat.input.initMessageReply(+mid);\n                shouldReply = false;\n              }\n            });\n          },\n          listenerOptions: {capture: true}\n        });\n      }\n    }\n  }\n\n  public constructPeerHelpers() {\n    // will call when message is sent (only 1)\n    this.listenerSetter.add(rootScope)('history_append', async({storageKey, message}) => {\n      if(storageKey !== this.chat.messagesStorageKey) return;\n\n      if(rootScope.settings.animationsEnabled) {\n        this.updateGradient = true;\n      }\n\n      if(!this.scrollable.loadedAll.bottom) {\n        this.chat.setMessageId();\n      } else {\n        this.renderNewMessage(message, true);\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('history_multiappend', (message) => {\n      if(this.peerId !== message.peerId) return;\n      this.renderNewMessage(message);\n    });\n\n    this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\n      if(peerId === this.peerId) {\n        this.deleteMessagesByIds(Array.from(msgs));\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('dialog_unread', ({peerId}) => {\n      if(peerId === this.peerId) {\n        this.chat.input.setUnreadCount();\n\n        getHeavyAnimationPromise().then(() => {\n          this.updateUnreadByDialog();\n        });\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\n      if(dialogs.has(this.peerId)) {\n        this.chat.input.setUnreadCount();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\n      if(this.peerId === dialog.peerId) {\n        this.chat.input.setUnreadCount();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        const hadRights = this.chatInner.classList.contains('has-rights');\n        const hasRights = await this.chat.canSend();\n\n        if(hadRights !== hasRights) {\n          const callbacks = await Promise.all([\n            this.finishPeerChange(),\n            this.chat.input.finishPeerChange()\n          ]);\n\n          callbacks.forEach((callback) => callback());\n        }\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('settings_updated', async({key}) => {\n      if(key === 'settings.emoji.big') {\n        const middleware = this.getMiddleware();\n        const mids = getObjectKeysAndSort(this.bubbles, 'desc');\n        const m = mids.map(async(mid) => {\n          const bubble = this.bubbles[mid];\n          if(bubble.classList.contains('can-have-big-emoji')) {\n            return {bubble, message: await this.chat.getMessage(mid)};\n          }\n        });\n\n        const awaited = await Promise.all(m);\n        if(!middleware()) {\n          return;\n        }\n\n        awaited.filter(Boolean).forEach(({bubble, message}) => {\n          if(this.bubbles[message.mid] !== bubble) {\n            return;\n          }\n\n          this.safeRenderMessage(message, true, bubble);\n        });\n      }\n    });\n\n    !DO_NOT_UPDATE_MESSAGE_VIEWS && this.listenerSetter.add(rootScope)('messages_views', (arr) => {\n      fastRaf(() => {\n        let scrollSaver: ScrollSaver;\n        for(const {peerId, views, mid} of arr) {\n          if(this.peerId !== peerId) continue;\n\n          const bubble = this.bubbles[mid];\n          if(!bubble) continue;\n\n          const postViewsElements = Array.from(bubble.querySelectorAll('.post-views')) as HTMLElement[];\n          if(!postViewsElements.length) continue;\n\n          const str = formatNumber(views, 1);\n          let different = false;\n          postViewsElements.forEach((postViews) => {\n            if(different || postViews.textContent !== str) {\n              if(!scrollSaver) {\n                scrollSaver = this.createScrollSaver(true);\n                scrollSaver.save();\n              }\n\n              different = true;\n              postViews.textContent = str;\n            }\n          });\n        }\n\n        if(scrollSaver) {\n          scrollSaver.restore();\n        }\n      });\n    });\n\n    this.observer = new SuperIntersectionObserver({root: this.scrollable.container});\n\n    this.listenerSetter.add(this.chat.appImManager)('chat_changing', ({to}) => {\n      const freeze = to !== this.chat;\n\n      const cb = () => {\n        this.observer.toggleObservingNew(freeze);\n      };\n\n      if(!freeze) {\n        setTimeout(() => {\n          cb();\n        }, 400);\n      } else {\n        cb();\n      }\n    });\n\n    this.sendViewCountersDebounced = debounce(() => {\n      const mids = [...this.viewsMids];\n      this.viewsMids.clear();\n\n      this.managers.appMessagesManager.incrementMessageViews(this.peerId, mids);\n    }, 1000, false, true);\n  }\n\n  private get peerId() {\n    return this.chat.peerId;\n  }\n\n  private createScrollSaver(reverse = true) {\n    const scrollSaver = new ScrollSaver(this.scrollable, '.bubble:not(.is-date)', reverse);\n    return scrollSaver;\n  }\n\n  private unreadedObserverCallback = (entry: IntersectionObserverEntry) => {\n    if(entry.isIntersecting) {\n      const target = entry.target as HTMLElement;\n      const mid = this.unreaded.get(target as HTMLElement);\n      this.onUnreadedInViewport(target, mid);\n    }\n  };\n\n  private viewsObserverCallback = (entry: IntersectionObserverEntry) => {\n    if(entry.isIntersecting) {\n      const mid = +(entry.target as HTMLElement).dataset.mid;\n      this.observer.unobserve(entry.target, this.viewsObserverCallback);\n\n      if(mid) {\n        this.viewsMids.add(mid);\n        this.sendViewCountersDebounced();\n      } else {\n        const {sponsoredMessage} = this;\n        if(sponsoredMessage && sponsoredMessage.random_id) {\n          delete sponsoredMessage.random_id;\n          this.managers.appChatsManager.viewSponsoredMessage(this.peerId.toChatId(), sponsoredMessage.random_id);\n        }\n      }\n    }\n  };\n\n  private stickerEffectObserverCallback = (entry: IntersectionObserverEntry) => {\n    if(entry.isIntersecting) {\n      this.observer.unobserve(entry.target, this.stickerEffectObserverCallback);\n\n      const attachmentDiv: HTMLElement = entry.target.querySelector('.attachment');\n      getHeavyAnimationPromise().then(() => {\n        if(isInDOM(attachmentDiv)) {\n          simulateClickEvent(attachmentDiv);\n        }\n      });\n    }\n  };\n\n  private createResizeObserver() {\n    if(!('ResizeObserver' in window) || this.resizeObserver) {\n      return;\n    }\n\n    const container = this.scrollable.container;\n    let wasHeight = 0/* container.offsetHeight */;\n    let resizing = false;\n    let skip = false;\n    let scrolled = 0;\n    let part = 0;\n    let rAF = 0;\n    // let skipNext = true;\n\n    const onResizeEnd = () => {\n      const height = container.offsetHeight;\n      const isScrolledDown = this.scrollable.isScrolledDown;\n      if(height !== wasHeight && (!skip || !isScrolledDown)) { // * fix opening keyboard while ESG is active, offsetHeight will change right between 'start' and this first frame\n        part += wasHeight - height;\n      }\n\n      /* if(DEBUG) {\n        this.log('resize end', scrolled, part, this.scrollable.scrollTop, height, wasHeight, this.scrollable.isScrolledDown);\n      } */\n\n      if(part) {\n        this.scrollable.setScrollTopSilently(this.scrollable.scrollTop + Math.round(part));\n      }\n\n      wasHeight = height;\n      scrolled = 0;\n      rAF = 0;\n      part = 0;\n      resizing = false;\n      skip = false;\n    };\n\n    const setEndRAF = (single: boolean) => {\n      if(rAF) window.cancelAnimationFrame(rAF);\n      rAF = window.requestAnimationFrame(single ? onResizeEnd : () => {\n        rAF = window.requestAnimationFrame(onResizeEnd);\n        // this.log('resize after RAF', part);\n      });\n    };\n\n    const processEntries: ResizeObserverCallback = (entries) => {\n      /* if(skipNext) {\n        skipNext = false;\n        return;\n      } */\n\n      if(skip) {\n        setEndRAF(false);\n        return;\n      }\n\n      const entry = entries[0];\n      const height = entry.contentRect.height;/* Math.ceil(entry.contentRect.height); */\n\n      if(!wasHeight) {\n        wasHeight = height;\n        return;\n      }\n\n      const realDiff = wasHeight - height;\n      let diff = realDiff + part;\n      const _part = diff % 1;\n      diff -= _part;\n\n      if(!resizing) {\n        resizing = true;\n\n        /* if(DEBUG) {\n          this.log('resize start', realDiff, this.scrollable.scrollTop, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown);\n        } */\n\n        if(realDiff < 0 && this.scrollable.isScrolledDown) {\n          // if(isSafari) { // * fix opening keyboard while ESG is active\n          part = -realDiff;\n          // }\n\n          skip = true;\n          setEndRAF(false);\n          return;\n        }\n      }\n\n      scrolled += diff;\n\n      /* if(DEBUG) {\n        this.log('resize', wasHeight - height, diff, this.scrollable.container.offsetHeight, this.scrollable.isScrolledDown, height, wasHeight);\n      } */\n\n      if(diff) {\n        const needScrollTop = this.scrollable.scrollTop + diff;\n        this.scrollable.setScrollTopSilently(needScrollTop);\n      }\n\n      setEndRAF(false);\n\n      part = _part;\n      wasHeight = height;\n    };\n\n    const resizeObserver = this.resizeObserver = new ResizeObserver(processEntries);\n    resizeObserver.observe(container);\n  }\n\n  private destroyResizeObserver() {\n    const resizeObserver = this.resizeObserver;\n    if(!resizeObserver) {\n      return;\n    }\n\n    resizeObserver.disconnect();\n    this.resizeObserver = undefined;\n  }\n\n  private onBubblesMouseMove = async(e: MouseEvent) => {\n    const content = findUpClassName(e.target, 'bubble-content');\n    if(content && !this.chat.selection.isSelecting) {\n      const bubble = findUpClassName(content, 'bubble');\n      if(!this.chat.selection.canSelectBubble(bubble)) {\n        this.unhoverPrevious();\n        return;\n      }\n\n      let {hoverBubble, hoverReaction} = this;\n      if(bubble === hoverBubble) {\n        return;\n      }\n\n      this.unhoverPrevious();\n\n      hoverBubble = this.hoverBubble = bubble;\n      hoverReaction = this.hoverReaction;\n      // hoverReaction = contentWrapper.querySelector('.bubble-hover-reaction');\n      if(!hoverReaction) {\n        hoverReaction = this.hoverReaction = document.createElement('div');\n        hoverReaction.classList.add('bubble-hover-reaction');\n\n        const stickerWrapper = document.createElement('div');\n        stickerWrapper.classList.add('bubble-hover-reaction-sticker');\n        hoverReaction.append(stickerWrapper);\n\n        content.append(hoverReaction);\n\n        let message = (await this.chat.getMessage(+bubble.dataset.mid)) as Message.message;\n        message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\n\n        const middleware = this.getMiddleware(() => this.hoverReaction === hoverReaction);\n        Promise.all([\n          this.managers.appReactionsManager.getAvailableReactionsByMessage(message),\n          pause(400)\n        ]).then(([availableReactions]) => {\n          const availableReaction = availableReactions[0];\n          if(!availableReaction) {\n            hoverReaction.remove();\n            return;\n          }\n\n          wrapSticker({\n            div: stickerWrapper,\n            doc: availableReaction.select_animation,\n            width: 18,\n            height: 18,\n            needUpscale: true,\n            middleware,\n            group: CHAT_ANIMATION_GROUP,\n            withThumb: false,\n            needFadeIn: false\n          }).then(({render}) => render).then((player) => {\n            assumeType<RLottiePlayer>(player);\n\n            player.addEventListener('firstFrame', () => {\n              if(!middleware()) {\n                // debugger;\n                return;\n              }\n\n              hoverReaction.dataset.loaded = '1';\n              this.setHoverVisible(hoverReaction, true);\n            }, {once: true});\n\n            attachClickEvent(hoverReaction, (e) => {\n              cancelEvent(e); // cancel triggering selection\n\n              this.managers.appReactionsManager.sendReaction(message, availableReaction);\n              this.unhoverPrevious();\n            }, {listenerSetter: this.listenerSetter});\n          }, noop);\n        });\n      } else if(hoverReaction.dataset.loaded) {\n        this.setHoverVisible(hoverReaction, true);\n      }\n    } else {\n      this.unhoverPrevious();\n    }\n  };\n\n  public setReactionsHoverListeners() {\n    this.listenerSetter.add(contextMenuController)('toggle', this.unhoverPrevious);\n    this.listenerSetter.add(overlayCounter)('change', this.unhoverPrevious);\n    this.listenerSetter.add(this.chat.selection)('toggle', this.unhoverPrevious);\n    this.listenerSetter.add(this.container)('mousemove', this.onBubblesMouseMove);\n  }\n\n  private setHoverVisible(hoverReaction: HTMLElement, visible: boolean) {\n    SetTransition(hoverReaction, 'is-visible', visible, 200, visible ? undefined : () => {\n      hoverReaction.remove();\n    }, 2);\n  }\n\n  private unhoverPrevious = () => {\n    const {hoverBubble, hoverReaction} = this;\n    if(hoverBubble) {\n      this.setHoverVisible(hoverReaction, false);\n      this.hoverBubble = undefined;\n      this.hoverReaction = undefined;\n    }\n  };\n\n  public setStickyDateManually() {\n    return;\n\n    const timestamps = Object.keys(this.dateMessages).map((k) => +k).sort((a, b) => b - a);\n    let lastVisible: HTMLElement;\n\n    // if(this.chatInner.classList.contains('is-scrolling')) {\n    const {scrollTop} = this.scrollable.container;\n    const isOverflown = scrollTop > 0;\n    if(isOverflown) {\n      for(const timestamp of timestamps) {\n        const dateMessage = this.dateMessages[timestamp];\n        const visibleRect = getVisibleRect(dateMessage.container, this.scrollable.container);\n        if(visibleRect && visibleRect.overflow.top) {\n          lastVisible = dateMessage.div;\n        } else if(lastVisible) {\n          break;\n        }\n      }\n    }\n    // }\n\n    if(lastVisible === this.previousStickyDate) {\n      return;\n    }\n\n    if(lastVisible) {\n      const needReflow = /* !!this.chat.setPeerPromise ||  */!this.previousStickyDate;\n      if(needReflow) {\n        lastVisible.classList.add('no-transition');\n      }\n\n      lastVisible.classList.add('is-sticky');\n\n      if(needReflow) {\n        void lastVisible.offsetLeft; // reflow\n        lastVisible.classList.remove('no-transition');\n      }\n    }\n\n    if(this.previousStickyDate && this.previousStickyDate !== lastVisible) {\n      this.previousStickyDate.classList.remove('is-sticky');\n    }\n\n    this.previousStickyDate = lastVisible;\n  }\n\n  public getRenderedLength() {\n    return Object.keys(this.bubbles).length - this.skippedMids.size;\n  }\n\n  private onUnreadedInViewport(target: HTMLElement, mid: number) {\n    this.unreadedSeen.add(mid);\n    this.observer.unobserve(target, this.unreadedObserverCallback);\n    this.unreaded.delete(target);\n    this.readUnreaded();\n  }\n\n  private readUnreaded() {\n    if(this.readPromise) return;\n\n    const middleware = this.getMiddleware();\n    this.readPromise = idleController.getFocusPromise().then(async() => {\n      if(!middleware()) return;\n      let maxId = Math.max(...Array.from(this.unreadedSeen));\n\n      // ? if message with maxId is not rendered ?\n      if(this.scrollable.loadedAll.bottom) {\n        const bubblesMaxId = Math.max(...Object.keys(this.bubbles).map((i) => +i));\n        if(maxId >= bubblesMaxId) {\n          maxId = Math.max((await this.chat.getHistoryMaxId()) || 0, maxId);\n        }\n      }\n\n      this.unreaded.forEach((mid, target) => {\n        if(mid <= maxId) {\n          this.onUnreadedInViewport(target, mid);\n        }\n      });\n\n      const readContents: number[] = [];\n      for(const mid of this.unreadedSeen) {\n        const message: MyMessage = await this.chat.getMessage(mid);\n        if(isMentionUnread(message)) {\n          readContents.push(mid);\n        }\n      }\n\n      this.managers.appMessagesManager.readMessages(this.peerId, readContents);\n\n      this.unreadedSeen.clear();\n\n      if(DEBUG) {\n        this.log('will readHistory by maxId:', maxId);\n      }\n\n      // return;\n\n      return this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId).catch((err: any) => {\n        this.log.error('readHistory err:', err);\n        this.managers.appMessagesManager.readHistory(this.peerId, maxId, this.chat.threadId);\n      }).finally(() => {\n        if(!middleware()) return;\n        this.readPromise = undefined;\n\n        if(this.unreadedSeen.size) {\n          this.readUnreaded();\n        }\n      });\n    });\n  }\n\n  public constructPinnedHelpers() {\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', (e) => {\n      const {peerId, mids, pinned} = e;\n      if(peerId !== this.peerId) return;\n\n      if(mids) {\n        if(!pinned) {\n          this.deleteMessagesByIds(mids);\n        }\n      }\n    });\n  }\n\n  public constructScheduledHelpers() {\n    const onUpdate = async() => {\n      this.chat.topbar.setTitle((await this.managers.appMessagesManager.getScheduledMessagesStorage(this.peerId)).size);\n    };\n\n    this.listenerSetter.add(rootScope)('scheduled_new', (message) => {\n      if(message.peerId !== this.peerId) return;\n\n      this.renderNewMessage(message);\n      onUpdate();\n    });\n\n    this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\n      if(peerId !== this.peerId) return;\n\n      this.deleteMessagesByIds(mids);\n      onUpdate();\n    });\n  }\n\n  public onBubblesClick = async(e: Event) => {\n    let target = e.target as HTMLElement;\n    let bubble: HTMLElement = null;\n    try {\n      bubble = findUpClassName(target, 'bubble');\n    } catch(err) {}\n\n    if(!bubble && !this.chat.selection.isSelecting) {\n      const avatar = findUpClassName(target, 'user-avatar');\n      if(!avatar) {\n        return;\n      }\n\n      const peerId = avatar.dataset.peerId.toPeerId();\n      if(peerId !== NULL_PEER_ID) {\n        this.chat.appImManager.setInnerPeer({peerId});\n      } else {\n        toast(I18n.format('HidAccount', true));\n      }\n      return;\n    }\n\n    if(bubble.classList.contains('is-date') && findUpClassName(target, 'bubble-content')) {\n      if(bubble.classList.contains('is-sticky') && !this.chatInner.classList.contains('is-scrolling')) {\n        return;\n      }\n\n      for(const timestamp in this.dateMessages) {\n        const d = this.dateMessages[timestamp];\n        if(d.div === bubble) {\n          PopupElement.createPopup(PopupDatePicker, new Date(+timestamp), this.onDatePick).show();\n          break;\n        }\n      }\n\n      return;\n    }\n\n    if(!IS_TOUCH_SUPPORTED && findUpClassName(target, 'time')) {\n      this.chat.selection.toggleByElement(bubble);\n      return;\n    }\n\n    // ! Trusted - due to audio autoclick\n    if(this.chat.selection.isSelecting && e.isTrusted) {\n      if(bubble.classList.contains('service') && bubble.dataset.mid === undefined) {\n        return;\n      }\n\n      cancelEvent(e);\n      // console.log('bubble click', e);\n\n      if(IS_TOUCH_SUPPORTED && this.chat.selection.selectedText) {\n        this.chat.selection.selectedText = undefined;\n        return;\n      }\n\n      // this.chatSelection.toggleByBubble(bubble);\n      this.chat.selection.toggleByElement(findUpClassName(target, 'grouped-item') || bubble);\n      return;\n    }\n\n    const contactDiv: HTMLElement = findUpClassName(target, 'contact');\n    if(contactDiv) {\n      this.chat.appImManager.setInnerPeer({\n        peerId: contactDiv.dataset.peerId.toPeerId()\n      });\n      return;\n    }\n\n    const callDiv: HTMLElement = findUpClassName(target, 'bubble-call');\n    if(callDiv) {\n      this.chat.appImManager.callUser(this.peerId.toUserId(), callDiv.dataset.type as any);\n      return;\n    }\n\n    const buyButton: HTMLElement = findUpClassName(target, 'is-buy');\n    if(buyButton) {\n      cancelEvent(e);\n\n      const message = await this.chat.getMessage(+bubble.dataset.mid);\n      if(!message) {\n        return;\n      }\n\n      new PopupPayment(\n        message as Message.message,\n        await this.managers.appPaymentsManager.getInputInvoiceByPeerId(message.peerId, message.mid)\n      );\n      return;\n    }\n\n    const reactionElement = findUpTag(target, 'REACTION-ELEMENT') as ReactionElement;\n    if(reactionElement) {\n      cancelEvent(e);\n      if(reactionElement.classList.contains('is-inactive')) {\n        return;\n      }\n\n      const reactionsElement = reactionElement.parentElement as ReactionsElement;\n      const reactionCount = reactionsElement.getReactionCount(reactionElement);\n\n      const message = reactionsElement.getMessage();\n      this.managers.appReactionsManager.sendReaction(message, reactionCount.reaction);\n\n      return;\n    }\n\n    const stickerEmojiEl = findUpAttribute(target, 'data-sticker-emoji');\n    if(stickerEmojiEl && stickerEmojiEl.parentElement.querySelectorAll('[data-sticker-emoji]').length === 1 && bubble.classList.contains('emoji-big')) {\n      onEmojiStickerClick({\n        event: e,\n        container: stickerEmojiEl,\n        managers: this.managers,\n        middleware: this.getMiddleware(),\n        peerId: this.peerId\n      });\n\n      return;\n    }\n\n    const commentsDiv: HTMLElement = findUpClassName(target, 'replies');\n    if(commentsDiv) {\n      const bubbleMid = +bubble.dataset.mid;\n      if(this.peerId === REPLIES_PEER_ID) {\n        const message = await this.chat.getMessage(bubbleMid) as Message.message;\n        const peerId = getPeerId(message.reply_to.reply_to_peer_id);\n        const threadId = message.reply_to.reply_to_top_id;\n        const lastMsgId = message.fwd_from.saved_from_msg_id;\n        this.chat.appImManager.openThread(peerId, lastMsgId, threadId);\n      } else {\n        const message1 = await this.chat.getMessage(bubbleMid);\n        const message = await this.managers.appMessagesManager.getMessageWithReplies(message1 as Message.message);\n        const replies = message.replies;\n        if(replies) {\n          this.managers.appMessagesManager.getDiscussionMessage(this.peerId, message.mid).then((message) => {\n            this.chat.appImManager.setInnerPeer({\n              peerId: replies.channel_id.toPeerId(true),\n              type: 'discussion',\n              threadId: (message as MyMessage).mid\n            });\n          });\n        }\n      }\n\n      return;\n    }\n\n    const via = findUpClassName(target, 'is-via');\n    if(via) {\n      const el = via.querySelector('.peer-title') as HTMLElement;\n      if(target === el || findUpAsChild(target, el)) {\n        const message = el.innerText + ' ';\n        this.managers.appDraftsManager.setDraft(this.peerId, this.chat.threadId, message);\n        cancelEvent(e);\n\n        return;\n      }\n    }\n\n    const nameDiv = findUpClassName(target, 'peer-title') || findUpTag(target, 'AVATAR-ELEMENT') || findUpAttribute(target, 'data-saved-from');\n    if(nameDiv && nameDiv !== bubble) {\n      target = nameDiv || target;\n      const peerIdStr = target.dataset.peerId || target.getAttribute('peer') || (target as AvatarElement).peerId;\n      const savedFrom = target.dataset.savedFrom;\n      if(typeof(peerIdStr) === 'string' || savedFrom) {\n        if(savedFrom) {\n          const [peerId, mid] = savedFrom.split('_');\n          if(target.classList.contains('is-receipt-link')) {\n            const message = await this.managers.appMessagesManager.getMessageByPeer(peerId.toPeerId(), +mid);\n            if(message) {\n              const inputInvoice = await this.managers.appPaymentsManager.getInputInvoiceByPeerId(this.peerId, +bubble.dataset.mid);\n              new PopupPayment(message as Message.message, inputInvoice);\n            }\n          } else {\n            this.chat.appImManager.setInnerPeer({\n              peerId: peerId.toPeerId(),\n              lastMsgId: +mid\n            });\n          }\n        } else {\n          const peerId = peerIdStr.toPeerId();\n          if(peerId !== NULL_PEER_ID) {\n            this.chat.appImManager.setInnerPeer({peerId});\n          } else {\n            toast(I18n.format('HidAccount', true));\n          }\n        }\n      }\n\n      return;\n    }\n\n    // this.log('chatInner click:', target);\n    // const isVideoComponentElement = target.tagName === 'SPAN' && findUpClassName(target, 'media-container');\n    /* if(isVideoComponentElement) {\n      const video = target.parentElement.querySelector('video') as HTMLElement;\n      if(video) {\n        video.click(); // hot-fix for time and play button\n        return;\n      }\n    } */\n\n    if(bubble.classList.contains('sticker') && target.parentElement.classList.contains('attachment')) {\n      const messageId = +bubble.dataset.mid;\n      const message = await this.chat.getMessage(messageId);\n\n      const doc = ((message as Message.message).media as MessageMedia.messageMediaDocument)?.document as Document.document;\n\n      if(doc?.stickerSetInput) {\n        new PopupStickers(doc.stickerSetInput).show();\n      }\n\n      return;\n    }\n\n    const documentDiv = findUpClassName(target, 'document-with-thumb');\n    if((target.tagName === 'IMG' && !target.classList.contains('emoji') && !target.classList.contains('document-thumb')) ||\n      target.classList.contains('album-item') ||\n      // || isVideoComponentElement\n      (target.tagName === 'VIDEO' && !bubble.classList.contains('round')) ||\n      (documentDiv && !documentDiv.querySelector('.preloader-container')) ||\n      target.classList.contains('canvas-thumbnail')) {\n      const groupedItem = findUpClassName(target, 'album-item') || findUpClassName(target, 'document-container');\n      const preloader = (groupedItem || bubble).querySelector<HTMLElement>('.preloader-container');\n      if(preloader) {\n        simulateClickEvent(preloader);\n        cancelEvent(e);\n        return;\n      }\n\n      cancelEvent(e);\n      const messageId = +(groupedItem || bubble).dataset.mid;\n      const message = await this.chat.getMessage(messageId);\n      if(!message) {\n        this.log.warn('no message by messageId:', messageId);\n        return;\n      }\n\n      const SINGLE_MEDIA_CLASSNAME = 'webpage';\n      const isSingleMedia = bubble.classList.contains(SINGLE_MEDIA_CLASSNAME);\n\n      const f = documentDiv ? (media: any) => {\n        return AppMediaViewer.isMediaCompatibleForDocumentViewer(media);\n      } : (media: any) => {\n        return media._ === 'photo' || ['video', 'gif'].includes(media.type);\n      };\n\n      const targets: {element: HTMLElement, mid: number, peerId: PeerId}[] = [];\n      const ids = isSingleMedia ? [messageId] : (await Promise.all(Object.keys(this.bubbles).map((k) => +k).map(async(mid) => {\n        /* if(isSingleMedia && !this.bubbles[id].classList.contains(SINGLE_MEDIA_CLASSNAME)) {\n          return false;\n        }  */\n        // if(!this.scrollable.visibleElements.find((e) => e.element === this.bubbles[id])) return false;\n\n        const message = await this.chat.getMessage(mid);\n        const media = getMediaFromMessage(message);\n\n        return media && f(media) && mid;\n      }))).filter(Boolean).sort((a, b) => a - b);\n\n      ids.forEach((id) => {\n        let selector: string;\n        if(documentDiv) {\n          selector = '.document-container';\n        } else {\n          const withTail = this.bubbles[id].classList.contains('with-media-tail');\n          selector = '.album-item video, .album-item img, .preview video, .preview img, ';\n          if(withTail) {\n            selector += '.bubble__media-container';\n          } else {\n            selector += '.attachment video, .attachment img';\n          }\n        }\n\n        const elements = Array.from(this.bubbles[id].querySelectorAll(selector)) as HTMLElement[];\n        const parents: Set<HTMLElement> = new Set();\n        if(documentDiv) {\n          elements.forEach((element) => {\n            targets.push({\n              element: element.querySelector('.document-ico'),\n              mid: +element.dataset.mid,\n              peerId: this.peerId\n            });\n          });\n        } else {\n          const hasAspecter = !!this.bubbles[id].querySelector('.media-container-aspecter');\n          elements.forEach((element) => {\n            if(hasAspecter && !findUpClassName(element, 'media-container-aspecter')) return;\n            const albumItem = findUpClassName(element, 'album-item');\n            const parent = albumItem || element.parentElement;\n            if(parents.has(parent)) return;\n            parents.add(parent);\n            targets.push({\n              element,\n              mid: albumItem ? +albumItem.dataset.mid : id,\n              peerId: this.peerId\n            });\n          });\n        }\n      });\n\n      targets.sort((a, b) => a.mid - b.mid);\n\n      const idx = targets.findIndex((t) => t.mid === messageId);\n\n      if(DEBUG) {\n        this.log('open mediaViewer single with ids:', ids, idx, targets);\n      }\n\n      if(!targets[idx]) {\n        this.log('no target for media viewer!', target);\n        return;\n      }\n\n      new AppMediaViewer()\n      .setSearchContext({\n        threadId: this.chat.threadId,\n        peerId: this.peerId,\n        inputFilter: {_: documentDiv ? 'inputMessagesFilterDocument' : 'inputMessagesFilterPhotoVideo'},\n        useSearch: this.chat.type !== 'scheduled' && !isSingleMedia,\n        isScheduled: this.chat.type === 'scheduled'\n      })\n      .openMedia(message, targets[idx].element, 0, true, targets.slice(0, idx), targets.slice(idx + 1));\n\n      // appMediaViewer.openMedia(message, target as HTMLImageElement);\n      return;\n    }\n\n    if(['IMG', 'DIV', 'SPAN'/* , 'A' */].indexOf(target.tagName) === -1) target = findUpTag(target, 'DIV');\n\n    if(['DIV', 'SPAN'].indexOf(target.tagName) !== -1/*  || target.tagName === 'A' */) {\n      if(target.classList.contains('goto-original')) {\n        const savedFrom = bubble.dataset.savedFrom;\n        const [peerId, mid] = savedFrom.split('_');\n        // //this.log('savedFrom', peerId, msgID);\n        this.chat.appImManager.setInnerPeer({\n          peerId: peerId.toPeerId(),\n          lastMsgId: +mid\n        });\n        return;\n      } else if(target.classList.contains('forward')) {\n        const mid = +bubble.dataset.mid;\n        const message = await this.managers.appMessagesManager.getMessageByPeer(this.peerId, mid);\n        new PopupForward({\n          [this.peerId]: await this.managers.appMessagesManager.getMidsByMessage(message)\n        });\n        // appSidebarRight.forwardTab.open([mid]);\n        return;\n      }\n\n      let isReplyClick = false;\n\n      try {\n        isReplyClick = !!findUpClassName(e.target, 'reply');\n      } catch(err) {}\n\n      if(isReplyClick && bubble.classList.contains('is-reply')/*  || bubble.classList.contains('forwarded') */) {\n        const bubbleMid = +bubble.dataset.mid;\n        this.replyFollowHistory.push(bubbleMid);\n\n        const message = (await this.chat.getMessage(bubbleMid)) as Message.message;\n\n        const replyToPeerId = message.reply_to.reply_to_peer_id ? getPeerId(message.reply_to.reply_to_peer_id) : this.peerId;\n        const replyToMid = message.reply_to.reply_to_msg_id;\n\n        this.chat.appImManager.setInnerPeer({\n          peerId: replyToPeerId,\n          lastMsgId: replyToMid,\n          type: this.chat.type,\n          threadId: this.chat.threadId\n        });\n\n        /* if(this.chat.type === 'discussion') {\n          this.chat.appImManager.setMessageId(, originalMessageId);\n        } else {\n          this.chat.appImManager.setInnerPeer(this.peerId, originalMessageId);\n        } */\n        // this.chat.setMessageId(, originalMessageId);\n      }\n    }\n\n    // console.log('chatInner click', e);\n  };\n\n  public async onGoDownClick() {\n    if(!this.replyFollowHistory.length) {\n      // this.onScroll(true, undefined, true);\n      this.chat.setMessageId(/* , dialog.top_message */);\n      // const dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\n\n      // if(dialog) {\n      //   this.chat.setPeer(this.peerId/* , dialog.top_message */);\n      // } else {\n      //   this.log('will scroll down 3');\n      //   this.scroll.scrollTop = this.scroll.scrollHeight;\n      // }\n\n      return;\n    }\n\n    const middleware = this.getMiddleware();\n    const slice = this.replyFollowHistory.slice();\n    const messages = await Promise.all(slice.map((mid) => this.chat.getMessage(mid)));\n    if(!middleware()) return;\n\n    slice.forEach((mid, idx) => {\n      const message = messages[idx];\n\n      const bubble = this.bubbles[mid];\n      let bad = true;\n      if(bubble) {\n        const rect = bubble.getBoundingClientRect();\n        bad = (windowSize.height / 2) > rect.top;\n      } else if(message) {\n        bad = false;\n      }\n\n      if(bad) {\n        this.replyFollowHistory.splice(this.replyFollowHistory.indexOf(mid), 1);\n      }\n    });\n\n    this.replyFollowHistory.sort((a, b) => b - a);\n\n    const mid = this.replyFollowHistory.pop();\n    this.chat.setMessageId(mid);\n  }\n\n  public getBubbleByPoint(verticalSide: 'top' | 'bottom') {\n    let element = getElementByPoint(this.scrollable.container, verticalSide, 'center');\n    /* if(element) {\n      if(element.classList.contains('bubbles-date-group')) {\n        const children = Array.from(element.children) as HTMLElement[];\n        if(verticalSide === 'top') {\n          element = children[this.stickyIntersector ? 2 : 1];\n        } else {\n          element = children[children.length - 1];\n        }\n      } else {\n        element = findUpClassName(element, 'bubble');\n        if(element && element.classList.contains('is-date')) {\n          element = element.nextElementSibling as HTMLElement;\n        }\n      }\n    } */\n    if(element) element = findUpClassName(element, 'bubble');\n\n    return element;\n  }\n\n  public async getGroupedBubble(groupId: string) {\n    const mids = await this.managers.appMessagesManager.getMidsByAlbum(groupId);\n    for(const mid of mids) {\n      if(this.bubbles[mid] && !this.skippedMids.has(mid)) {\n        // const maxId = Math.max(...mids); // * because in scheduled album can be rendered by lowest mid during sending\n        return {\n          bubble: this.bubbles[mid],\n          mid: mid\n          // message: await this.chat.getMessage(maxId) as Message.message\n        };\n      }\n    }\n  }\n\n  public getBubbleGroupedItems(bubble: HTMLElement) {\n    return Array.from(bubble.querySelectorAll('.grouped-item')) as HTMLElement[];\n  }\n\n  public async getMountedBubble(mid: number, message?: Message.message | Message.messageService) {\n    if(message === undefined) {\n      message = await this.chat.getMessage(mid);\n    }\n\n    if(!message) {\n      return;\n    }\n\n    const groupedId = (message as Message.message).grouped_id;\n    if(groupedId) {\n      const a = await this.getGroupedBubble(groupedId);\n      if(a) {\n        a.bubble = a.bubble.querySelector(`.document-container[data-mid=\"${mid}\"]`) || a.bubble;\n        return a;\n      }\n    }\n\n    const bubble = this.bubbles[mid];\n    if(!bubble) return;\n\n    return {bubble, mid};\n  }\n\n  private findNextMountedBubbleByMsgId(mid: number, prev?: boolean) {\n    const mids = getObjectKeysAndSort(this.bubbles, prev ? 'desc' : 'asc');\n\n    let filterCallback: (_mid: number) => boolean;\n    if(prev) filterCallback = (_mid) => _mid < mid;\n    else filterCallback = (_mid) => mid < _mid;\n\n    const foundMid = mids.find((_mid) => {\n      if(!filterCallback(_mid)) return false;\n      return !!this.bubbles[_mid]?.parentElement;\n    });\n\n    return this.bubbles[foundMid];\n  }\n\n  public loadMoreHistory(top: boolean, justLoad = false) {\n    // this.log('loadMoreHistory', top);\n    if(\n      !this.peerId ||\n      /* TEST_SCROLL || */\n      this.chat.setPeerPromise ||\n      this.isHeavyAnimationInProgress ||\n      (top && (this.getHistoryTopPromise || this.scrollable.loadedAll.top)) ||\n      (!top && (this.getHistoryBottomPromise || this.scrollable.loadedAll.bottom))\n    ) {\n      return;\n    }\n\n    // warning,         (     )\n    // some messages can have negative id (such as sponsored message)\n    const history = Object.keys(this.bubbles)\n    .map((id) => +id)\n    .filter((id) => id > 0 && !this.skippedMids.has(id))\n    .sort((a, b) => a - b);\n\n    if(!history.length) {\n      history.push(0);\n    }\n\n    if(top) {\n      if(DEBUG) {\n        this.log('Will load more (up) history by id:', history[0], 'maxId:', history[history.length - 1], justLoad/* , history */);\n      }\n\n      this.getHistory1(history[0], true, undefined, undefined, justLoad);\n    } else {\n      // let dialog = this.appMessagesManager.getDialogByPeerId(this.peerId)[0];\n      // const historyMaxId = await this.chat.getHistoryMaxId();\n\n      // // if scroll down after search\n      // if(history.indexOf(historyMaxId) !== -1) {\n      //   this.setLoaded('bottom', true);\n      //   return;\n      // }\n\n      if(DEBUG) {\n        this.log('Will load more (down) history by id:', history[history.length - 1], justLoad/* , history */);\n      }\n\n      this.getHistory1(history[history.length - 1], false, true, undefined, justLoad);\n    }\n  }\n\n  public onScroll = (ignoreHeavyAnimation?: boolean, scrollDimensions?: ScrollStartCallbackDimensions, forceDown?: boolean) => {\n    // return;\n\n    if(this.isHeavyAnimationInProgress) {\n      if(this.sliceViewportDebounced) {\n        this.sliceViewportDebounced.clearTimeout();\n      }\n\n      // *   ,         ,          \n      if(this.scrolledDown && !ignoreHeavyAnimation) {\n        return;\n      }\n    } else {\n      if(this.chat.topbar.pinnedMessage) {\n        this.chat.topbar.pinnedMessage.setCorrectIndexThrottled(this.scrollable.lastScrollDirection);\n      }\n\n      if(this.sliceViewportDebounced) {\n        this.sliceViewportDebounced();\n      }\n\n      this.setStickyDateManually();\n    }\n\n    // lottieLoader.checkAnimations(false, 'chat');\n\n    if(scrollDimensions && scrollDimensions.distanceToEnd < SCROLLED_DOWN_THRESHOLD && this.scrolledDown) {\n      return;\n    }\n\n    const distanceToEnd = forceDown ? 0 : scrollDimensions?.distanceToEnd ?? this.scrollable.getDistanceToEnd();\n    if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 && distanceToEnd > 0) || scrollDimensions || forceDown) {\n    // if(/* !IS_TOUCH_SUPPORTED &&  */(this.scrollable.lastScrollDirection !== 0 || scrollDimensions) && distanceToEnd > 0) {\n      if(this.isScrollingTimeout) {\n        clearTimeout(this.isScrollingTimeout);\n      } else if(!this.chatInner.classList.contains('is-scrolling')) {\n        this.chatInner.classList.add('is-scrolling');\n      }\n\n      this.isScrollingTimeout = window.setTimeout(() => {\n        this.chatInner.classList.remove('is-scrolling');\n        this.isScrollingTimeout = 0;\n      }, 1350 + (scrollDimensions?.duration ?? 0));\n    }\n\n    if(distanceToEnd < SCROLLED_DOWN_THRESHOLD && (forceDown || this.scrollable.loadedAll.bottom || this.chat.setPeerPromise || !this.peerId)) {\n      this.container.classList.add('scrolled-down');\n      this.scrolledDown = true;\n    } else if(this.container.classList.contains('scrolled-down')) {\n      this.container.classList.remove('scrolled-down');\n      this.scrolledDown = false;\n    }\n  };\n\n  public setScroll() {\n    if(this.scrollable) {\n      this.destroyScrollable();\n    }\n\n    this.scrollable = new Scrollable(null, 'IM', /* 10300 */300);\n    this.setLoaded('top', false, false);\n    this.setLoaded('bottom', false, false);\n\n    this.scrollable.container.append(this.chatInner);\n\n    /* const getScrollOffset = () => {\n      //return Math.round(Math.max(300, appPhotosManager.windowH / 1.5));\n      return 300;\n    };\n\n    window.addEventListener('resize', () => {\n      this.scrollable.onScrollOffset = getScrollOffset();\n    });\n\n    this.scrollable = new Scrollable(this.bubblesContainer, 'y', 'IM', this.chatInner, getScrollOffset()); */\n\n    this.scrollable.onAdditionalScroll = this.onScroll;\n    this.scrollable.onScrolledTop = () => this.loadMoreHistory(true);\n    this.scrollable.onScrolledBottom = () => this.loadMoreHistory(false);\n    // this.scrollable.attachSentinels(undefined, 300);\n\n    if(IS_TOUCH_SUPPORTED && false) {\n      this.scrollable.container.addEventListener('touchmove', () => {\n        if(this.isScrollingTimeout) {\n          clearTimeout(this.isScrollingTimeout);\n        } else if(!this.chatInner.classList.contains('is-scrolling')) {\n          this.chatInner.classList.add('is-scrolling');\n        }\n      }, {passive: true});\n\n      this.scrollable.container.addEventListener('touchend', () => {\n        if(!this.chatInner.classList.contains('is-scrolling')) {\n          return;\n        }\n\n        if(this.isScrollingTimeout) {\n          clearTimeout(this.isScrollingTimeout);\n        }\n\n        this.isScrollingTimeout = window.setTimeout(() => {\n          this.chatInner.classList.remove('is-scrolling');\n          this.isScrollingTimeout = 0;\n        }, 1350);\n      }, {passive: true});\n    }\n  }\n\n  public async updateUnreadByDialog() {\n    const historyStorage = await this.chat.getHistoryStorage();\n    const maxId = this.peerId === rootScope.myId ? historyStorage.readMaxId : historyStorage.readOutboxMaxId;\n\n    // /////this.log('updateUnreadByDialog', maxId, dialog, this.unreadOut);\n\n    for(const msgId of this.unreadOut) {\n      if(msgId > 0 && msgId <= maxId) {\n        const bubble = this.bubbles[msgId];\n        if(bubble) {\n          this.unreadOut.delete(msgId);\n\n          if(bubble.classList.contains('is-outgoing') || bubble.classList.contains('is-error')) {\n            continue;\n          }\n\n          bubble.classList.remove('is-sent', 'is-sending', 'is-outgoing'); // is-sending can be when there are bulk of updates (e.g. sending command to Stickers bot)\n          bubble.classList.add('is-read');\n        }\n      }\n    }\n  }\n\n  public deleteMessagesByIds(mids: number[], permanent = true, ignoreOnScroll?: boolean) {\n    let deleted = false;\n    mids.forEach((mid) => {\n      const bubble = this.bubbles[mid];\n      if(!bubble) return;\n\n      bubble.middlewareHelper.destroy();\n\n      deleted = true;\n      /* const mounted = this.getMountedBubble(mid);\n      if(!mounted) return; */\n\n      delete this.bubbles[mid];\n      this.skippedMids.delete(mid);\n\n      if(this.firstUnreadBubble === bubble) {\n        this.firstUnreadBubble = null;\n      }\n\n      this.bubbleGroups.removeAndUnmountBubble(bubble);\n      if(this.observer) {\n        this.observer.unobserve(bubble, this.unreadedObserverCallback);\n        this.unreaded.delete(bubble);\n\n        this.observer.unobserve(bubble, this.viewsObserverCallback);\n        this.viewsMids.delete(mid);\n\n        this.observer.unobserve(bubble, this.stickerEffectObserverCallback);\n      }\n\n      if(this.emptyPlaceholderBubble === bubble) {\n        this.emptyPlaceholderBubble = undefined;\n      }\n\n      // this.reactions.delete(mid);\n    });\n\n    if(!deleted) {\n      return;\n    }\n\n    this.scrollable.ignoreNextScrollEvent();\n    if(permanent && this.chat.selection.isSelecting) {\n      this.chat.selection.deleteSelectedMids(this.peerId, mids);\n    }\n\n    animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP);\n    this.deleteEmptyDateGroups();\n\n    if(!ignoreOnScroll) {\n      this.scrollable.onScroll();\n      // this.onScroll();\n    }\n  }\n\n  private setTopPadding(middleware = this.getMiddleware()) {\n    let isPaddingNeeded = false;\n    let setPaddingTo: HTMLElement;\n    if(!this.isTopPaddingSet && this.chat.type !== 'scheduled') {\n      const {clientHeight, scrollHeight} = this.scrollable.container;\n      isPaddingNeeded = clientHeight === scrollHeight;\n      /* const firstEl = this.chatInner.firstElementChild as HTMLElement;\n      if(this.chatInner.firstElementChild) {\n        const visibleRect = getVisibleRect(firstEl, this.scrollable.container);\n        isPaddingNeeded = !visibleRect.overflow.top && (visibleRect.rect.top - firstEl.offsetTop) !== this.scrollable.container.getBoundingClientRect().top;\n      } else {\n        isPaddingNeeded = true;\n      } */\n\n      if(isPaddingNeeded) {\n        /* const add = clientHeight - scrollHeight;\n        this.chatInner.style.paddingTop = add + 'px';\n        this.scrollable.scrollTop += add; */\n        setPaddingTo = this.chatInner;\n        setPaddingTo.style.paddingTop = clientHeight + 'px';\n        this.scrollable.setScrollTopSilently(scrollHeight);\n        this.isTopPaddingSet = true;\n      }\n    }\n\n    return {\n      isPaddingNeeded,\n      unsetPadding: isPaddingNeeded ? () => {\n        if(middleware() && isPaddingNeeded) {\n          setPaddingTo.style.paddingTop = '';\n          this.isTopPaddingSet = false;\n        }\n      } : undefined\n    };\n  }\n\n  private renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\n    const promise = this._renderNewMessage(message, scrolledDown);\n    this.renderNewPromises.add(promise);\n    promise.catch(noop).finally(() => {\n      this.renderNewPromises.delete(promise);\n    });\n    return promise;\n  }\n\n  private async _renderNewMessage(message: MyMessage, scrolledDown?: boolean) {\n    if(!this.scrollable.loadedAll.bottom) { // seems search active or sliced\n      // this.log('renderNewMessagesByIds: seems search is active, skipping render:', mids);\n      const setPeerPromise = this.chat.setPeerPromise;\n      if(setPeerPromise) {\n        const middleware = this.getMiddleware();\n        setPeerPromise.then(async() => {\n          if(!middleware()) return;\n          const newMessage = await this.chat.getMessage(message.mid);\n          if(!middleware()) return;\n          this.renderNewMessage(newMessage);\n        });\n      }\n\n      return;\n    }\n\n    if(this.chat.threadId) {\n      const replyTo = message?.reply_to as MessageReplyHeader;\n      if(!(replyTo && (replyTo.reply_to_top_id || replyTo.reply_to_msg_id) === this.chat.threadId)) {\n        return;\n      }\n    }\n\n    if(this.bubbles[message.mid]) {\n      return;\n    }\n    // ! should scroll even without new messages\n    /* if(!mids.length) {\n      return;\n    } */\n\n    if(!scrolledDown) {\n      scrolledDown = this.scrolledDown && (\n        !this.scrollingToBubble ||\n        this.scrollingToBubble === this.getLastBubble() ||\n        this.scrollingToBubble === this.chatInner\n      );\n    }\n\n    const middleware = this.getMiddleware();\n    const {isPaddingNeeded, unsetPadding} = this.setTopPadding(middleware);\n\n    const promise = this.performHistoryResult({history: [message]}, false);\n    if(scrolledDown) {\n      promise.then(() => {\n        if(!middleware()) return;\n        // this.log('renderNewMessagesByIDs: messagesQueuePromise after', this.scrollable.isScrolledDown);\n        // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true, 5000);\n        // const bubble = this.bubbles[Math.max(...mids)];\n\n        let bubble: HTMLElement;\n        if(this.chat.type === 'scheduled') {\n          bubble = this.bubbles[message.mid];\n        }\n\n        const promise = bubble ? this.scrollToBubbleEnd(bubble) : this.scrollToEnd();\n        if(isPaddingNeeded) {\n          // it will be called only once even if was set multiple times (that won't happen)\n          promise.then(unsetPadding);\n        }\n\n        // this.scrollable.scrollIntoViewNew(this.chatInner, 'end');\n\n        /* setTimeout(() => {\n          this.log('messagesQueuePromise afterafter:', this.chatInner.childElementCount, this.scrollable.scrollHeight);\n        }, 10); */\n      });\n    }\n\n    return promise;\n  }\n\n  public getLastBubble() {\n    const group = this.bubbleGroups.getLastGroup();\n    return group?.lastItem?.bubble;\n  }\n\n  public scrollToBubble(\n    element: HTMLElement,\n    position: ScrollLogicalPosition,\n    forceDirection?: FocusDirection,\n    forceDuration?: number\n  ) {\n    const bubble = findUpClassName(element, 'bubble');\n\n    if(!element.parentElement) {\n      this.log.error('element is not connected', bubble);\n    }\n\n    let fallbackToElementStartWhenCentering: HTMLElement;\n    // * if it's a start, then scroll to start of the group\n    if(bubble && position !== 'end') {\n      const item = this.bubbleGroups.getItemByBubble(bubble);\n      if(item && item.group.firstItem === item && whichChild(item.group.container) === (this.stickyIntersector ? STICKY_OFFSET : 1)) {\n        const dateGroup = item.group.container.parentElement;\n        // if(whichChild(dateGroup) === 0) {\n        fallbackToElementStartWhenCentering = dateGroup;\n        // position = 'start';\n        // element = dateGroup;\n        // }\n      }\n    }\n\n    // const isLastBubble = this.getLastBubble() === bubble;\n    /* if(isLastBubble) {\n      element = this.getLastDateGroup();\n    } */\n\n    const margin = 4; // * 4 = .25rem\n    /* if(isLastBubble && this.chat.type === 'chat' && this.bubblesContainer.classList.contains('is-chat-input-hidden')) {\n      margin = 20;\n    } */\n\n    const isChangingHeight = (this.chat.input.messageInput && this.chat.input.messageInput.classList.contains('is-changing-height')) || this.chat.container.classList.contains('is-toggling-helper');\n    const promise = this.scrollable.scrollIntoViewNew({\n      element,\n      position,\n      margin,\n      forceDirection,\n      forceDuration,\n      axis: 'y',\n      getNormalSize: isChangingHeight ? ({rect}) => {\n        // return rect.height;\n\n        let height = windowSize.height;\n        // height -= this.chat.topbar.container.getBoundingClientRect().height;\n        height -= this.container.offsetTop;\n        height -= mediaSizes.isMobile || windowSize.height < 570 ? 58 : 78;\n        return height;\n\n        /* const rowsWrapperHeight = this.chat.input.rowsWrapper.getBoundingClientRect().height;\n        const diff = rowsWrapperHeight - 54;\n        return rect.height + diff; */\n      } : undefined,\n      fallbackToElementStartWhenCentering,\n      startCallback: (dimensions) => {\n        // this.onScroll(true, this.scrolledDown && dimensions.distanceToEnd <= SCROLLED_DOWN_THRESHOLD ? undefined : dimensions);\n        this.onScroll(true, dimensions);\n\n        if(this.updateGradient) {\n          const {gradientRenderer} = this.chat;\n          gradientRenderer?.toNextPosition(dimensions.getProgress);\n          this.updateGradient = undefined;\n        }\n      }\n    });\n\n    // fix flickering date when opening unread chat and focusing message\n    if(forceDirection === FocusDirection.Static) {\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\n    }\n\n    return promise;\n  }\n\n  public scrollToEnd() {\n    return this.scrollToBubbleEnd(this.chatInner);\n  }\n\n  public async scrollToBubbleEnd(bubble: HTMLElement) {\n    /* if(DEBUG) {\n      this.log('scrollToNewLastBubble: will scroll into view:', bubble);\n    } */\n\n    if(bubble) {\n      this.scrollingToBubble = bubble;\n      const middleware = this.getMiddleware();\n      await this.scrollToBubble(bubble, 'end', undefined, undefined);\n      if(!middleware()) return;\n      this.scrollingToBubble = undefined;\n    }\n  }\n\n  // ! can't get it by chatInner.lastElementChild because placeholder can be the last...\n  // private getLastDateGroup() {\n  //   let lastTime = 0, lastElem: HTMLElement;\n  //   for(const i in this.dateMessages) {\n  //     const dateMessage = this.dateMessages[i];\n  //     if(dateMessage.firstTimestamp > lastTime) {\n  //       lastElem = dateMessage.container;\n  //       lastTime = dateMessage.firstTimestamp;\n  //     }\n  //   }\n\n  //   return lastElem;\n  // }\n\n  public async scrollToBubbleIfLast(bubble: HTMLElement) {\n    if(this.getLastBubble() === bubble) {\n      // return this.scrollToBubbleEnd(bubble);\n      return this.scrollToEnd();\n    }\n  }\n\n  public highlightBubble(element: HTMLElement) {\n    const datasetKey = 'highlightTimeout';\n    if(element.dataset[datasetKey]) {\n      clearTimeout(+element.dataset[datasetKey]);\n      element.classList.remove('is-highlighted');\n      void element.offsetWidth; // reflow\n    }\n\n    element.classList.add('is-highlighted');\n    element.dataset[datasetKey] = '' + setTimeout(() => {\n      element.classList.remove('is-highlighted');\n      delete element.dataset[datasetKey];\n    }, 2000);\n  }\n\n  private createDateBubble(timestamp: number, date: Date = new Date(timestamp * 1000)) {\n    let dateElement: HTMLElement;\n\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n\n    const isScheduled = this.chat.type === 'scheduled';\n\n    if(today.getTime() === date.getTime()) {\n      dateElement = i18n(isScheduled ? 'Chat.Date.ScheduledForToday' : 'Date.Today');\n    } else if(isScheduled && timestamp === SEND_WHEN_ONLINE_TIMESTAMP) {\n      dateElement = i18n('MessageScheduledUntilOnline');\n    } else {\n      const options: Intl.DateTimeFormatOptions = {\n        day: 'numeric',\n        month: 'long'\n      };\n\n      if(date.getFullYear() !== today.getFullYear()) {\n        options.year = 'numeric';\n      }\n\n      dateElement = new I18n.IntlDateElement({\n        date,\n        options\n      }).element;\n\n      if(isScheduled) {\n        dateElement = i18n('Chat.Date.ScheduledFor', [dateElement]);\n      }\n    }\n\n    const bubble = document.createElement('div');\n    bubble.className = 'bubble service is-date';\n    const bubbleContent = document.createElement('div');\n    bubbleContent.classList.add('bubble-content');\n    const serviceMsg = document.createElement('div');\n    serviceMsg.classList.add('service-msg');\n\n    serviceMsg.append(dateElement);\n\n    bubbleContent.append(serviceMsg);\n    bubble.append(bubbleContent);\n\n    return bubble;\n  }\n\n  public getDateForDateContainer(timestamp: number) {\n    const date = new Date(timestamp * 1000);\n    date.setHours(0, 0, 0);\n    return {date, dateTimestamp: date.getTime()};\n  }\n\n  public getDateContainerByTimestamp(timestamp: number) {\n    const {date, dateTimestamp} = this.getDateForDateContainer(timestamp);\n    if(!this.dateMessages[dateTimestamp]) {\n      const bubble = this.createDateBubble(timestamp, date);\n      // bubble.classList.add('is-sticky');\n      const fakeBubble = this.createDateBubble(timestamp, date);\n      fakeBubble.classList.add('is-fake');\n\n      const container = document.createElement('section');\n      container.className = 'bubbles-date-group';\n      container.append(bubble, fakeBubble);\n\n      this.dateMessages[dateTimestamp] = {\n        div: bubble,\n        container,\n        firstTimestamp: date.getTime()\n      };\n\n      const haveTimestamps = getObjectKeysAndSort(this.dateMessages, 'asc');\n      const length = haveTimestamps.length;\n      let i = 0, insertBefore: HTMLElement; // there can be 'first bubble' (e.g. bot description) so can't insert by index\n      for(; i < haveTimestamps.length; ++i) {\n        const t = haveTimestamps[i];\n        insertBefore = this.dateMessages[t].container;\n        if(dateTimestamp < t) {\n          break;\n        }\n      }\n\n      if(i === length && insertBefore) {\n        insertBefore = insertBefore.nextElementSibling as HTMLElement;\n      }\n\n      if(!insertBefore) {\n        this.chatInner.append(container);\n      } else {\n        this.chatInner.insertBefore(container, insertBefore);\n      }\n\n      if(this.stickyIntersector) {\n        this.stickyIntersector.observeStickyHeaderChanges(container);\n      }\n\n      if(this.chatInner.parentElement) {\n        this.container.classList.add('has-groups');\n      }\n    }\n\n    return this.dateMessages[dateTimestamp];\n  }\n\n  private destroyScrollable() {\n    this.scrollable.destroy();\n  }\n\n  public destroy() {\n    // this.chat.log.error('Bubbles destroying');\n\n    this.destroyScrollable();\n\n    this.listenerSetter.removeAll();\n\n    this.lazyLoadQueue.clear();\n    this.observer && this.observer.disconnect();\n    this.stickyIntersector && this.stickyIntersector.disconnect();\n\n    delete this.lazyLoadQueue;\n    this.observer && delete this.observer;\n    this.stickyIntersector && delete this.stickyIntersector;\n  }\n\n  public cleanup(bubblesToo = false) {\n    this.bubbles = {}; // clean it before so sponsored message won't be deleted faster on peer changing\n    // //console.time('appImManager cleanup');\n    this.setLoaded('top', false, false);\n    this.setLoaded('bottom', false, false);\n\n    // cancel scroll\n    cancelAnimationByKey(this.scrollable.container);\n\n    // do not wait ending of previous scale animation\n    interruptHeavyAnimation();\n\n    if(TEST_SCROLL !== undefined) {\n      TEST_SCROLL = TEST_SCROLL_TIMES;\n    }\n\n    this.skippedMids.clear();\n    this.dateMessages = {};\n    this.bubbleGroups.cleanup();\n    this.unreadOut.clear();\n    this.needUpdate.length = 0;\n    this.lazyLoadQueue.clear();\n    this.renderNewPromises.clear();\n\n    // clear messages\n    if(bubblesToo) {\n      this.scrollable.container.textContent = '';\n      this.chatInner.textContent = '';\n      this.cleanupPlaceholders();\n    }\n\n    this.firstUnreadBubble = null;\n    this.attachedUnreadBubble = false;\n\n    this.messagesQueue.length = 0;\n    this.messagesQueuePromise = null;\n\n    this.getHistoryTopPromise = this.getHistoryBottomPromise = undefined;\n    this.fetchNewPromise = undefined;\n    this.getSponsoredMessagePromise = undefined;\n    this.updateGradient = undefined;\n\n    if(this.stickyIntersector) {\n      this.stickyIntersector.disconnect();\n    }\n\n    if(this.observer) {\n      this.observer.disconnect();\n\n      this.unreaded.clear();\n      this.unreadedSeen.clear();\n      this.readPromise = undefined;\n\n      this.viewsMids.clear();\n    }\n\n    this.middlewareHelper.clean();\n\n    this.onAnimateLadder = undefined;\n    this.resolveLadderAnimation = undefined;\n    this.attachPlaceholderOnRender = undefined;\n    this.emptyPlaceholderBubble = undefined;\n    this.sponsoredMessage = undefined;\n    this.previousStickyDate = undefined;\n\n    this.scrollingToBubble = undefined;\n    // //console.timeEnd('appImManager cleanup');\n\n    this.isTopPaddingSet = false;\n\n    this.renderingMessages.clear();\n    this.bubblesToEject.clear();\n    this.bubblesToReplace.clear();\n\n    // this.reactions.clear();\n\n    if(this.isScrollingTimeout) {\n      clearTimeout(this.isScrollingTimeout);\n      this.isScrollingTimeout = 0;\n    }\n\n    this.container.classList.remove('has-sticky-dates');\n    this.scrollable.cancelMeasure();\n  }\n\n  private cleanupPlaceholders(bubble = this.emptyPlaceholderBubble) {\n    if(bubble) {\n      bubble.remove();\n\n      if(this.emptyPlaceholderBubble === bubble) {\n        this.emptyPlaceholderBubble = undefined;\n      }\n    }\n  }\n\n  public async setPeer(samePeer: boolean, peerId: PeerId, lastMsgId?: number, startParam?: string): Promise<{cached?: boolean, promise: Chat['setPeerPromise']}> {\n    const tempId = ++this.setPeerTempId;\n\n    if(!peerId) {\n      this.cleanup(true);\n      this.preloader.detach();\n      return null;\n    }\n\n    const perf = performance.now();\n    const log = this.log.bindPrefix('setPeer');\n    log.warn('start');\n\n    const middleware = () => {\n      return this.setPeerTempId === tempId;\n    };\n\n    const m = middlewarePromise(middleware, PEER_CHANGED_ERROR);\n\n    if(!samePeer) {\n      await m(this.chat.onChangePeer(m));\n    }\n\n    /* if(samePeer && this.chat.setPeerPromise) {\n      return {cached: true, promise: this.chat.setPeerPromise};\n    } */\n\n    const chatType = this.chat.type;\n\n    if(chatType === 'scheduled' || this.chat.isRestricted) {\n      lastMsgId = 0;\n    }\n\n    const historyStorage = await m(this.chat.getHistoryStorage());\n    const topMessage = chatType === 'pinned' ? await m(this.managers.appMessagesManager.getPinnedMessagesMaxId(peerId)) : historyStorage.maxId ?? 0;\n    const isTarget = lastMsgId !== undefined;\n\n    // * this one will fix topMessage for null message in history (e.g. channel comments with only 1 comment and it is a topMessage)\n    /* if(chatType !== 'pinned' && topMessage && !historyStorage.history.slice.includes(topMessage)) {\n      topMessage = 0;\n    } */\n\n    let followingUnread: boolean;\n    let readMaxId = 0, savedPosition: ReturnType<AppImManager['getChatSavedPosition']>, overrideAdditionMsgId: number;\n    if(!isTarget) {\n      if(!samePeer) {\n        savedPosition = this.chat.appImManager.getChatSavedPosition(this.chat);\n      }\n\n      if(savedPosition) {\n\n      } else if(topMessage) {\n        readMaxId = await m(this.managers.appMessagesManager.getReadMaxIdIfUnread(peerId, this.chat.threadId));\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\n        if(/* dialog.unread_count */readMaxId && !samePeer && (!dialog || dialog.unread_count !== 1)) {\n          const foundSlice = historyStorage.history.findSliceOffset(readMaxId);\n          if(foundSlice && foundSlice.slice.isEnd(SliceEnd.Bottom)) {\n            overrideAdditionMsgId = foundSlice.slice[foundSlice.offset - 25] || foundSlice.slice[0] || readMaxId;\n          }\n\n          followingUnread = !isTarget;\n          lastMsgId = readMaxId;\n        } else {\n          lastMsgId = topMessage;\n          // lastMsgID = topMessage;\n        }\n      }\n    }\n\n    const isJump = lastMsgId !== topMessage/*  && overrideAdditionMsgId === undefined */;\n\n    if(startParam === undefined && await m(this.chat.isStartButtonNeeded())) {\n      startParam = BOT_START_PARAM;\n    }\n\n    if(samePeer) {\n      const mounted = await m(this.getMountedBubble(lastMsgId));\n      if(mounted) {\n        if(isTarget) {\n          this.scrollToBubble(mounted.bubble, 'center');\n          this.highlightBubble(mounted.bubble);\n          this.chat.dispatchEvent('setPeer', lastMsgId, false);\n        } else if(topMessage && !isJump) {\n          // log('will scroll down', this.scroll.scrollTop, this.scroll.scrollHeight);\n          // scrollable.setScrollTopSilently(scrollable.scrollHeight);\n          this.scrollToEnd();\n          this.chat.dispatchEvent('setPeer', lastMsgId, true);\n        }\n\n        if(startParam !== undefined) {\n          this.chat.input.setStartParam(startParam);\n        }\n\n        return null;\n      }\n    } else {\n      if(this.peerId) { // * set new queue id if new peer (setting not from 0)\n        this.lazyLoadQueue.queueId = ++queueId;\n        this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\n      }\n\n      this.replyFollowHistory.length = 0;\n\n      this.passEntities = {\n        messageEntityBotCommand: await m(this.managers.appPeersManager.isAnyGroup(peerId)) || this.chat.isBot\n      };\n    }\n\n    if(DEBUG) {\n      log('setPeer peerId:', peerId, historyStorage, lastMsgId, topMessage);\n    }\n\n    // add last message, bc in getHistory will load < max_id\n    const additionMsgId = overrideAdditionMsgId ?? (isJump || chatType === 'scheduled' || this.chat.isRestricted ? 0 : topMessage);\n\n    let maxBubbleId = 0;\n    if(samePeer) {\n      const el = this.getBubbleByPoint('bottom'); // ! this may not work if being called when chat is hidden\n      // this.chat.log('[PM]: setCorrectIndex: get last element perf:', performance.now() - perf, el);\n      if(el) {\n        maxBubbleId = +el.dataset.mid;\n      }\n\n      if(maxBubbleId <= 0) {\n        maxBubbleId = Math.max(...Object.keys(this.bubbles).map((mid) => +mid));\n      }\n    } else {\n      this.isFirstLoad = true;\n      this.destroyResizeObserver();\n    }\n\n    const oldChatInner = this.chatInner;\n    const oldPlaceholderBubble = this.emptyPlaceholderBubble;\n    this.cleanup();\n    const chatInner = this.chatInner = document.createElement('div');\n    if(samePeer) {\n      chatInner.className = oldChatInner.className;\n      chatInner.classList.remove('disable-hover', 'is-scrolling');\n    } else {\n      chatInner.classList.add('bubbles-inner');\n    }\n\n    this.lazyLoadQueue.lock();\n\n    // const haveToScrollToBubble = (topMessage && (isJump || samePeer)) || isTarget;\n    const haveToScrollToBubble = samePeer || (topMessage && isJump) || isTarget;\n    const fromUp = maxBubbleId > 0 && (!lastMsgId || maxBubbleId < lastMsgId || lastMsgId < 0);\n    const scrollFromDown = !fromUp && samePeer;\n    const scrollFromUp = !scrollFromDown && fromUp/*  && (samePeer || forwardingUnread) */;\n    this.willScrollOnLoad = scrollFromDown || scrollFromUp;\n\n    this.setPeerOptions = {\n      lastMsgId,\n      topMessage\n    };\n\n    let result: Awaited<ReturnType<ChatBubbles['getHistory']>>;\n    if(!savedPosition) {\n      result = await m(this.getHistory1(lastMsgId, true, isJump, additionMsgId));\n    } else {\n      result = {\n        promise: getHeavyAnimationPromise().then(() => {\n          return this.performHistoryResult({history: savedPosition.mids}, true);\n        }) as any,\n        cached: true,\n        waitPromise: Promise.resolve()\n      };\n    }\n\n    this.setPeerCached = result.cached;\n\n    log.warn('got history');// warning\n\n    const {promise, cached} = result;\n\n    if(!cached && !samePeer) {\n      await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam));\n      this.scrollable.container.textContent = '';\n      // oldContainer.textContent = '';\n      // oldChatInner.remove();\n      this.preloader.attach(this.container);\n    }\n\n    /* this.ladderDeferred && this.ladderDeferred.resolve();\n    this.ladderDeferred = deferredPromise<void>(); */\n\n    animationIntersector.lockGroup(CHAT_ANIMATION_GROUP);\n    const setPeerPromise = m(promise).then(async() => {\n      log.warn('promise fulfilled');\n\n      const mountedByLastMsgId = haveToScrollToBubble ? await m(lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()}) : undefined;\n      if(cached && !samePeer) {\n        log.warn('finishing peer change');\n        await m(this.chat.finishPeerChange(isTarget, isJump, lastMsgId, startParam)); // * \n        log.warn('finished peer change');\n      }\n\n      this.preloader.detach();\n\n      if(this.resolveLadderAnimation) {\n        this.resolveLadderAnimation();\n        this.resolveLadderAnimation = undefined;\n      }\n\n      this.setPeerCached = undefined;\n\n      // this.ladderDeferred.resolve();\n\n      const scrollable = this.scrollable;\n      scrollable.lastScrollDirection = 0;\n      scrollable.lastScrollPosition = 0;\n      replaceContent(scrollable.container, chatInner);\n      // this.chat.topbar.container.nextElementSibling.replaceWith(container);\n\n      if(oldPlaceholderBubble) {\n        this.cleanupPlaceholders(oldPlaceholderBubble);\n      }\n\n      if(this.attachPlaceholderOnRender) {\n        this.attachPlaceholderOnRender();\n      }\n\n      if(!isTarget && this.chat.type === 'chat' && this.chat.topbar.pinnedMessage) {\n        this.chat.topbar.pinnedMessage.setCorrectIndex(0);\n      }\n\n      this.container.classList.toggle('has-groups', !!Object.keys(this.dateMessages).length);\n\n      log.warn('mounted chat', this.chatInner === chatInner, this.chatInner.parentElement, performance.now() - perf);\n\n      animationIntersector.unlockGroup(CHAT_ANIMATION_GROUP);\n      animationIntersector.checkAnimations(false, CHAT_ANIMATION_GROUP/* , true */);\n\n      // fastRaf(() => {\n      this.lazyLoadQueue.unlock();\n      // });\n\n      // if(dialog && lastMsgID && lastMsgID !== topMessage && (this.bubbles[lastMsgID] || this.firstUnreadBubble)) {\n      if(savedPosition) {\n        scrollable.setScrollTopSilently(savedPosition.top);\n        /* const mountedByLastMsgId = this.getMountedBubble(lastMsgId);\n        let bubble: HTMLElement = mountedByLastMsgId?.bubble;\n        if(!bubble?.parentElement) {\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId);\n        }\n\n        if(bubble) {\n          const top = bubble.getBoundingClientRect().top;\n          const distance = savedPosition.top - top;\n          scrollable.scrollTop += distance;\n        } */\n      } else if(haveToScrollToBubble) {\n        let unsetPadding: () => void;\n        if(scrollFromDown) {\n          scrollable.setScrollTopSilently(99999);\n        } else if(scrollFromUp) {\n          const set = this.setTopPadding();\n          if(set.isPaddingNeeded) {\n            unsetPadding = set.unsetPadding;\n          }\n\n          scrollable.setScrollTopSilently(0);\n        }\n\n        // const mountedByLastMsgId = lastMsgId ? this.getMountedBubble(lastMsgId) : {bubble: this.getLastBubble()};\n        let bubble: HTMLElement = (followingUnread && this.firstUnreadBubble) || mountedByLastMsgId?.bubble;\n        if(!bubble?.parentElement) {\n          bubble = this.findNextMountedBubbleByMsgId(lastMsgId, false) || this.findNextMountedBubbleByMsgId(lastMsgId, true);\n        }\n\n        let promise: Promise<void>;\n        // ! sometimes there can be no bubble\n        if(bubble) {\n          const lastBubble = this.getLastBubble();\n          const position: ScrollLogicalPosition = followingUnread ? 'start' : (!isJump && !isTarget && lastBubble === bubble ? 'end' : 'center');\n\n          if(position === 'end' && lastBubble === bubble && samePeer) {\n            promise = this.scrollToEnd();\n          } else {\n            promise = this.scrollToBubble(bubble, position, !samePeer ? FocusDirection.Static : undefined);\n          }\n\n          if(!followingUnread && isTarget) {\n            this.highlightBubble(bubble);\n          }\n        }\n\n        if(unsetPadding) {\n          (promise || Promise.resolve()).then(() => {\n            unsetPadding();\n          });\n        }\n      } else {\n        scrollable.setScrollTopSilently(99999);\n      }\n\n      // if(!cached) {\n      this.onRenderScrollSet();\n      // }\n\n      this.onScroll();\n\n      const afterSetPromise = Promise.all([setPeerPromise, getHeavyAnimationPromise()]);\n      afterSetPromise.then(() => { // check whether list isn't full\n        scrollable.checkForTriggers();\n\n        // if(cached) {\n        // this.onRenderScrollSet();\n        // }\n      });\n\n      this.chat.dispatchEvent('setPeer', lastMsgId, !isJump);\n\n      Promise.all([\n        this.setFetchReactionsInterval(afterSetPromise),\n        this.setFetchHistoryInterval({\n          afterSetPromise,\n          lastMsgId,\n          samePeer,\n          savedPosition,\n          topMessage\n        })\n      ]).then(() => {\n        log('scrolledAllDown:', scrollable.loadedAll.bottom);\n        // if(!this.unreaded.length && dialog) { // lol\n        if(scrollable.loadedAll.bottom && topMessage && !this.unreaded.size) { // lol\n          this.onScrolledAllDown();\n        }\n      });\n\n      if(chatType === 'chat') {\n        const dialog = await m(this.managers.appMessagesManager.getDialogOnly(peerId));\n        if(dialog?.pFlags.unread_mark) {\n          this.managers.appMessagesManager.markDialogUnread(peerId, true);\n        }\n      }\n\n      // this.chatInner.classList.remove('disable-hover', 'is-scrolling'); // warning, performance!\n    }).catch((err) => {\n      log.error('getHistory promise error:', err);\n      if(!middleware()) {\n        this.preloader.detach();\n      }\n\n      throw err;\n    });\n\n    return {cached, promise: setPeerPromise};\n  }\n\n  private async setFetchReactionsInterval(afterSetPromise: Promise<any>) {\n    const middleware = this.getMiddleware();\n    const needReactionsInterval = this.chat.isChannel;\n    if(needReactionsInterval) {\n      const fetchReactions = async() => {\n        if(!middleware()) return;\n\n        const mids: number[] = [];\n        for(const mid in this.bubbles) {\n          let message = await this.chat.getMessage(+mid);\n          if(message?._ !== 'message') {\n            continue;\n          }\n\n          message = await this.managers.appMessagesManager.getGroupsFirstMessage(message);\n          mids.push(message.mid);\n        }\n\n        const promise = mids.length ? this.managers.appReactionsManager.getMessagesReactions(this.peerId, mids) : Promise.resolve();\n        promise.then(() => {\n          setTimeout(fetchReactions, 10e3);\n        });\n      };\n\n      Promise.all([afterSetPromise, getHeavyAnimationPromise(), pause(500)]).then(() => {\n        fetchReactions();\n      });\n    }\n  }\n\n  private async setFetchHistoryInterval({\n    lastMsgId,\n    topMessage,\n    afterSetPromise,\n    savedPosition,\n    samePeer\n  }: {\n    lastMsgId: number,\n    topMessage: number,\n    afterSetPromise: Promise<any>,\n    savedPosition: ChatSavedPosition,\n    samePeer: boolean\n  }) {\n    const middleware = this.getMiddleware();\n    const peerId = this.peerId;\n\n    const needFetchInterval = await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId);\n    const needFetchNew = savedPosition || needFetchInterval;\n    if(!needFetchNew) {\n      return;\n    }\n\n    await afterSetPromise;\n    if(!middleware()) {\n      return;\n    }\n\n    this.setLoaded('bottom', false);\n    this.scrollable.checkForTriggers();\n\n    if(!needFetchInterval) {\n      return;\n    }\n\n    const f = () => {\n      this.fetchNewPromise = new Promise<void>(async(resolve) => {\n        if(!middleware() || !(await this.managers.appMessagesManager.isFetchIntervalNeeded(peerId))) {\n          resolve();\n          return;\n        }\n\n        this.managers.appMessagesManager.getNewHistory(peerId, this.chat.threadId).then((result) => {\n          if(!middleware() || !result) {\n            resolve();\n            return;\n          }\n\n          const {isBottomEnd} = result;\n          if(this.scrollable.loadedAll.bottom && this.scrollable.loadedAll.bottom !== isBottomEnd) {\n            this.setLoaded('bottom', isBottomEnd);\n            this.onScroll();\n          }\n\n          setTimeout(f, 30e3);\n          resolve();\n        });\n      }).finally(() => {\n        this.fetchNewPromise = undefined;\n      });\n    };\n\n    if(samePeer) {\n      setTimeout(f, 30e3);\n    } else {\n      f();\n    }\n  }\n\n  public async onScrolledAllDown() {\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\n      const historyMaxId = await this.chat.getHistoryMaxId();\n      this.managers.appMessagesManager.readHistory(this.peerId, historyMaxId, this.chat.threadId, true);\n    }\n  }\n\n  public async finishPeerChange() {\n    const [isChannel, canWrite, isAnyGroup] = await Promise.all([\n      this.chat.isChannel,\n      this.chat.canSend(),\n      this.chat.isAnyGroup\n    ]);\n\n    return () => {\n      this.chatInner.classList.toggle('has-rights', canWrite);\n      this.container.classList.toggle('is-chat-input-hidden', !canWrite);\n\n      this.chatInner.classList.toggle('is-chat', isAnyGroup);\n      this.chatInner.classList.toggle('is-channel', isChannel);\n\n      this.createResizeObserver();\n    };\n  }\n\n  public renderMessagesQueue(options: ChatBubbles['messagesQueue'][0]) {\n    this.messagesQueue.push(options);\n    return this.setMessagesQueuePromise();\n  }\n\n  public setMessagesQueuePromise() {\n    if(!this.messagesQueue.length) return Promise.resolve();\n\n    if(this.messagesQueuePromise) {\n      return this.messagesQueuePromise;\n    }\n\n    const middleware = this.getMiddleware();\n    const log = this.log.bindPrefix('queue');\n    const possibleError = PEER_CHANGED_ERROR;\n    const m = middlewarePromise(middleware, possibleError);\n\n    const processQueue = async(): Promise<void> => {\n      log('start');\n\n      // if(!this.chat.setPeerPromise) {\n      //   await pause(10000000);\n      // }\n\n      const renderQueue = this.messagesQueue.slice();\n      this.messagesQueue.length = 0;\n\n      const renderQueuePromises = renderQueue.map((promise) => {\n        const perf = performance.now();\n        promise.then((details) => {\n          log('render message time', performance.now() - perf, details);\n        });\n\n        return promise;\n      });\n\n      let loadQueue = await m(Promise.all(renderQueuePromises));\n      const filterQueue = (queue: typeof loadQueue) => {\n        return queue.filter((details) => {\n          // message can be deleted during rendering\n          return details && this.bubbles[details.bubble.dataset.mid] === details.bubble;\n        });\n      };\n\n      loadQueue = filterQueue(loadQueue);\n\n      log('messages rendered');\n\n      const reverse = loadQueue[0]?.reverse;\n\n      const {groups, avatarPromises} = this.groupBubbles(loadQueue.filter((details) => details.updatePosition));\n\n      // if(groups.length > 2 && loadQueue.length === 1) {\n      //   debugger;\n      // }\n\n      const promises = loadQueue.reduce((acc, details) => {\n        const perf = performance.now();\n\n        const promises = details.promises.slice();\n        const timePromises = promises.map(async(promise) => (await promise, performance.now() - perf));\n        Promise.all(timePromises).then((times) => {\n          log.groupCollapsed('media message time', performance.now() - perf, details, times);\n          times.forEach((time, idx) => {\n            log('media message time', time, idx, promises[idx]);\n          });\n          log.groupEnd();\n        });\n\n        // if(details.updatePosition) {\n        //   if(res) {\n        //     groups.add(res.group);\n        //     if(details.needAvatar) {\n        //       details.promises.push(res.group.createAvatar(details.message));\n        //     }\n        //   }\n        // }\n\n        acc.push(...details.promises);\n        return acc;\n      }, [] as Promise<any>[]);\n\n      promises.push(...avatarPromises);\n      // promises.push(pause(200));\n\n      // *    ,     reply  - ,    \n      // *     -     ,       \n      // promises.push(getHeavyAnimationPromise());\n\n      log('media promises to call', promises, loadQueue, this.isHeavyAnimationInProgress);\n      await m(Promise.all([...promises, this.setUnreadDelimiter()])); //    \n      await m(fastRafPromise()); // have to be the last\n      log('media promises end');\n\n      loadQueue = filterQueue(loadQueue);\n\n      const {restoreScroll, scrollSaver} = this.prepareToSaveScroll(reverse);\n      // if(this.messagesQueueOnRender) {\n      // this.messagesQueueOnRender();\n      // }\n\n      if(this.messagesQueueOnRenderAdditional) {\n        this.messagesQueueOnRenderAdditional();\n      }\n\n      this.ejectBubbles();\n      for(const [bubble, oldBubble] of this.bubblesToReplace) {\n        if(scrollSaver) {\n          scrollSaver.replaceSaved(oldBubble, bubble);\n        }\n\n        if(!loadQueue.find((details) => details.bubble === bubble)) {\n          continue;\n        }\n\n        const item = this.bubbleGroups.getItemByBubble(bubble);\n        item.mounted = false;\n        if(!groups.includes(item.group)) {\n          groups.push(item.group);\n        }\n\n        this.bubblesToReplace.delete(bubble);\n      }\n\n      if(this.chat.selection.isSelecting) {\n        loadQueue.forEach(({bubble}) => {\n          this.chat.selection.toggleElementCheckbox(bubble, true);\n        });\n      }\n\n      loadQueue.forEach(({message, bubble, updatePosition}) => {\n        if(message.pFlags.local && updatePosition) {\n          this.chatInner[(message as Message.message).pFlags.sponsored ? 'append' : 'prepend'](bubble);\n          return;\n        }\n      });\n\n      this.bubbleGroups.mountUnmountGroups(groups);\n      // this.bubbleGroups.findIncorrentPositions();\n\n      if(this.updatePlaceholderPosition) {\n        this.updatePlaceholderPosition();\n      }\n\n      if(restoreScroll) {\n        restoreScroll();\n      }\n\n      // this.setStickyDateManually();\n\n      if(this.messagesQueue.length) {\n        log('have new messages to render');\n        return processQueue();\n      } else {\n        log('end');\n      }\n    };\n\n    log('setting pause');\n    const promise = this.messagesQueuePromise = m(pause(0)).then(processQueue).finally(() => {\n      if(this.messagesQueuePromise === promise) {\n        this.messagesQueuePromise = null;\n      }\n    });\n\n    return promise;\n  }\n\n  private ejectBubbles() {\n    for(const bubble of this.bubblesToEject) {\n      bubble.remove();\n      // this.bubbleGroups.removeAndUnmountBubble(bubble);\n    }\n\n    this.bubblesToEject.clear();\n  }\n\n  public groupBubbles(items: Array<{\n    // Awaited<ReturnType<ChatBubbles['safeRenderMessage']>> &\n    bubble: HTMLElement,\n    message: Message.message | Message.messageService\n  }/*  & {\n    unmountIfFound?: boolean\n  } */>) {\n    let modifiedGroups: typeof groups;\n\n    if(this.chat.type === 'scheduled') {\n      modifiedGroups = new Set();\n      items.forEach(({bubble, message}) => {\n        const item = this.bubbleGroups.getItemByBubble(bubble);\n        const group = item?.group;\n        if(group && item.message.date !== message.date) {\n          this.bubbleGroups.removeItem(item);\n          modifiedGroups.add(group);\n        }\n      });\n    }\n\n    items.forEach(({bubble, message}) => {\n      this.bubbleGroups.prepareForGrouping(bubble, message);\n    });\n\n    const groups = this.bubbleGroups.groupUngrouped();\n\n    const avatarPromises = Array.from(groups).map((group) => {\n      if(group.avatar) return;\n      const firstItem = group.firstItem;\n      if(firstItem && this.chat.isAvatarNeeded(firstItem.message)) {\n        return group.createAvatar(firstItem.message);\n      }\n    }).filter(Boolean);\n\n    if(modifiedGroups) {\n      for(const group of modifiedGroups) {\n        groups.add(group);\n      }\n    }\n\n    return {\n      groups: [...groups],\n      avatarPromises\n    };\n  }\n\n  public getMiddleware(additionalCallback?: () => boolean) {\n    return this.middlewareHelper.get(additionalCallback);\n  }\n\n  private async safeRenderMessage(\n    message: Message.message | Message.messageService,\n    reverse?: boolean,\n    bubble?: HTMLElement,\n    updatePosition = true,\n    processResult?: (result: ReturnType<ChatBubbles['renderMessage']>, bubble: HTMLElement) => typeof result\n  ) {\n    if(!message || this.renderingMessages.has(message.mid) || (this.bubbles[message.mid] && !bubble)) {\n      return;\n    }\n\n    const middlewareHelper = this.getMiddleware().create();\n    const middleware = middlewareHelper.get();\n\n    let result: Awaited<ReturnType<ChatBubbles['renderMessage']>> & {updatePosition: typeof updatePosition};\n    try {\n      this.renderingMessages.add(message.mid);\n\n      // const groupedId = (message as Message.message).grouped_id;\n      const newBubble = document.createElement('div');\n      newBubble.middlewareHelper = middlewareHelper;\n      newBubble.dataset.mid = '' + message.mid;\n      newBubble.dataset.peerId = '' + message.peerId;\n      newBubble.dataset.timestamp = '' + message.date;\n\n      // const bubbleNew: Bubble = this.bubblesNew[message.mid] ??= {\n      //   bubble: newBubble,\n      //   mids: new Set(),\n      //   groupedId\n      // };\n\n      // bubbleNew.mids.add(message.mid);\n\n      if(bubble) {\n        bubble.middlewareHelper.destroy();\n        this.skippedMids.delete(message.mid);\n\n        this.bubblesToEject.add(bubble);\n        this.bubblesToReplace.delete(bubble);\n        this.bubblesToReplace.set(newBubble, bubble);\n        this.bubbleGroups.changeBubbleByBubble(bubble, newBubble);\n      }\n\n      bubble = this.bubbles[message.mid] = newBubble;\n      let originalPromise = this.renderMessage(message, reverse, bubble, middleware);\n      if(processResult) {\n        originalPromise = processResult(originalPromise, bubble);\n      }\n\n      const promise = originalPromise.then((r) => ((r && middleware() ? {...r, updatePosition} : undefined) as typeof result));\n\n      this.renderMessagesQueue(promise.catch(() => undefined));\n\n      result = await promise;\n      if(!middleware()) {\n        return;\n      }\n\n      if(!result) {\n        this.skippedMids.add(+message.mid);\n      }\n    } catch(err) {\n      this.log.error('renderMessage error:', err);\n    }\n\n    if(!middleware()) {\n      return;\n    }\n\n    this.renderingMessages.delete(message.mid);\n    return result;\n  }\n\n  private async messageContentHasToBeMuted(\n    message: Message.message,\n  ): Promise<boolean> {\n\n    // don't mute my messages\n    const myId = appImManager.myId;\n\n    if (message.fromId === myId) {\n      return false;\n    }\n\n    // which one?\n    // // don't mute my messages\n    // if (message.pFlags.out) {\n    //   return false;\n    // }\n\n    // IDK why isPeerLocalMuted doesn't return real value for forwards (from channels)\n\n\n    // TODO: private channels? how to? subscribe + mute + unsubscribe?\n\n    const isForwardFromChannel = this.isMessageForwardFromChannel(message);\n    if (isForwardFromChannel) {\n      const dialogOnly = await this.managers.appMessagesManager.getDialogOnly(message.fwdFromId);\n      // no data if not subscribed\n      const imSubscribedToChannel: boolean = !!(dialogOnly);\n      if (imSubscribedToChannel) {\n        // don't mute my subscriptions\n        return false;\n      }\n    }\n\n    // any forwards from muted peers\n    if (message.fwdFromId) {\n      // IDK why isPeerLocalMuted doesn't return real value\n      //  for forwards from channels in groups\n\n      const isMutedSourceFwd = await this.managers.appNotificationsManager.getPeerMuted(message.fwdFromId)\n\n      if (isMutedSourceFwd) {\n        // forward source is muted\n        return true\n      }\n    }\n\n    if (message.peerId !== message.fromId) {\n      // message is in group, skip mutes in DM\n\n      // const isMutedSender = await (\n      //   this.managers.appNotificationsManager.isPeerLocalMuted(message.fromId) as Promise<boolean>)\n\n      const isMutedSender = await this.managers.appNotificationsManager.getPeerMuted(message.fromId)\n      if (isMutedSender) {\n        // sender is muted\n        return true\n      }\n    }\n\n    return false;\n  }\n\n  // noinspection JSMethodCanBeStatic\n  private isMessageForwardFromChannel(message: Message.message): boolean {\n    return (\n      message.fwd_from\n      && message.fwd_from.from_id._ === 'peerChannel'\n    );\n  }\n\n  // reverse means top\n  private async renderMessage(\n    message: Message.message | Message.messageService,\n    reverse = false,\n    bubble: HTMLElement,\n    middleware: Middleware\n  ) {\n    // if(DEBUG) {\n    //   this.log('message to render:', message);\n    // }\n\n    // if(!bubble && this.bubbles[message.mid]) {\n    //   return;\n    // }\n\n    // await pause(1000);\n\n    const isMessage = message._ === 'message';\n    const groupedId = isMessage && message.grouped_id;\n    let albumMids: number[], reactionsMessage: Message.message;\n    const albumMessages = groupedId ? await this.managers.appMessagesManager.getMessagesByAlbum(groupedId) : undefined;\n\n    const albumMustBeRenderedFull = this.chat.type !== 'pinned';\n\n    if(groupedId && albumMustBeRenderedFull) { // will render only last album's message\n      albumMids = albumMessages.map((message) => message.mid);\n      const mainMid = getMainMidForGrouped(albumMids);\n      if(message.mid !== mainMid) {\n        return;\n      }\n    }\n\n    if(isMessage) {\n      reactionsMessage = groupedId ? albumMessages[0] : message;\n    }\n\n    // * can't use 'message.pFlags.out' here because this check will be used to define side of message (left-right)\n    const our = this.chat.isOurMessage(message);\n\n    const messageDiv = document.createElement('div');\n    messageDiv.classList.add('message', 'spoilers-container');\n\n    const contentWrapper = document.createElement('div');\n    contentWrapper.classList.add('bubble-content-wrapper');\n\n    const bubbleContainer = document.createElement('div');\n    bubbleContainer.classList.add('bubble-content');\n\n    bubble.classList.add('bubble');\n    contentWrapper.append(bubbleContainer);\n    bubble.append(contentWrapper);\n\n    const isInUnread = !our && !message.pFlags.out && (message.pFlags.unread ||\n      isMentionUnread(message)/*  ||\n      (this.historyStorage.readMaxId !== undefined && this.historyStorage.readMaxId < message.mid) */);\n    if(isInUnread && this.observer) {\n      // this.log('not our message', message, message.pFlags.unread);\n      this.observer.observe(bubble, this.unreadedObserverCallback);\n      this.unreaded.set(bubble, message.mid);\n    }\n\n    const loadPromises: Promise<any>[] = [];\n    const ret = {\n      bubble,\n      promises: loadPromises,\n      message,\n      reverse\n    };\n\n    if(message._ === 'messageService' && (!message.action || !SERVICE_AS_REGULAR.has(message.action._))) {\n      const action = message.action;\n      if(action) {\n        const _ = action._;\n        if(IGNORE_ACTIONS.has(_) || (langPack.hasOwnProperty(_) && !langPack[_])) {\n          return;\n        }\n      }\n\n      bubble.className = 'bubble service';\n\n      bubbleContainer.innerHTML = '';\n      const s = document.createElement('div');\n      s.classList.add('service-msg');\n      if(action) {\n        let promise: Promise<any>;\n        if(action._ === 'messageActionChannelMigrateFrom') {\n          const peerTitle = new PeerTitle();\n          promise = peerTitle.update({peerId: action.chat_id.toPeerId(true)});\n          s.append(i18n('ChatMigration.From', [peerTitle.element]));\n        } else if(action._ === 'messageActionChatMigrateTo') {\n          const peerTitle = new PeerTitle();\n          promise = peerTitle.update({peerId: action.channel_id.toPeerId(true)});\n          s.append(i18n('ChatMigration.To', [peerTitle.element]));\n        } else {\n          s.append(await wrapMessageActionTextNew(message));\n        }\n      }\n      bubbleContainer.append(s);\n\n      if(message.pFlags.is_single) { // * Ignore 'Discussion started'\n        bubble.classList.add('is-group-last');\n      }\n\n      return ret;\n    }\n\n    // todo: move to message props? wrap?\n    const hasToBeMuted: boolean = isMessage && await this.messageContentHasToBeMuted(message);\n\n    let messageMedia: MessageMedia = isMessage && message.media;\n\n    let messageMessage: string, totalEntities: MessageEntity[];\n    if(isMessage) {\n      if((messageMedia as MessageMedia.messageMediaDocument)?.document &&\n        !['video', 'gif'].includes(((messageMedia as MessageMedia.messageMediaDocument).document as MyDocument).type)) {\n        // * just filter these cases for documents caption\n      } else if(groupedId && albumMustBeRenderedFull) {\n        const t = getAlbumText(albumMessages);\n        messageMessage = t.message;\n        // totalEntities = t.entities;\n        totalEntities = t.totalEntities;\n      } else if(((messageMedia as MessageMedia.messageMediaDocument)?.document as MyDocument)?.type !== 'sticker') {\n        messageMessage = message.message;\n        totalEntities = message.entities;\n\n        if (hasToBeMuted) {\n          if (message.message) {\n            // mute whole message with Spoiler entity\n            // TODO: anything more elegant?\n            const muteMessageEntity: MessageEntity = {\n              _: \"messageEntitySpoiler\",\n              length: messageMessage.length,\n              offset: 0,\n            }\n            totalEntities.unshift(muteMessageEntity);\n          } else {\n            // no message text, do nothing\n          }\n        } else {\n          // not muted\n        }\n      }\n    } else {\n      if(message.action._ === 'messageActionPhoneCall') {\n        messageMedia = {\n          _: 'messageMediaCall',\n          action: message.action\n        };\n      }\n    }\n\n    let bigEmojis = 0, customEmojiSize: MediaSize;\n    if(totalEntities && !messageMedia) {\n      const emojiEntities = totalEntities.filter((e) => e._ === 'messageEntityEmoji'/*  || e._ === 'messageEntityCustomEmoji' */);\n      const strLength = messageMessage.replace(/\\s/g, '').length;\n      const emojiStrLength = emojiEntities.reduce((acc, curr) => acc + curr.length, 0);\n\n      if(emojiStrLength === strLength /* && emojiEntities.length <= 3 *//*  && totalEntities.length === emojiEntities.length */) {\n        bigEmojis = Math.min(BIG_EMOJI_SIZES_LENGTH, emojiEntities.length);\n\n        customEmojiSize = mediaSizes.active.customEmoji;\n\n        const size = BIG_EMOJI_SIZES[bigEmojis];\n        if(size) {\n          customEmojiSize = makeMediaSize(size, size);\n          bubble.style.setProperty('--emoji-size', size + 'px');\n        }\n      }\n    }\n\n    const richText = wrapRichText(messageMessage, {\n      entities: totalEntities,\n      passEntities: this.passEntities,\n      loadPromises,\n      lazyLoadQueue: this.lazyLoadQueue,\n      customEmojiSize,\n      middleware,\n      animationGroup: CHAT_ANIMATION_GROUP\n    });\n\n    let canHaveTail = true;\n    let isStandaloneMedia = false;\n    let needToSetHTML = true;\n    if(bigEmojis) {\n      if(rootScope.settings.emoji.big) {\n        const sticker = bigEmojis === 1 &&\n          !totalEntities.find((entity) => entity._ === 'messageEntityCustomEmoji') &&\n          await this.managers.appStickersManager.getAnimatedEmojiSticker(messageMessage);\n        if(bigEmojis === 1 && !messageMedia && sticker) {\n          messageMedia = {\n            _: 'messageMediaDocument',\n            document: sticker\n          };\n        } else {\n          const attachmentDiv = document.createElement('div');\n          attachmentDiv.classList.add('attachment', 'spoilers-container');\n\n          setInnerHTML(attachmentDiv, richText);\n\n          bubbleContainer.append(attachmentDiv);\n        }\n\n        bubble.classList.add('is-message-empty', 'emoji-big');\n        isStandaloneMedia = true;\n        canHaveTail = false;\n        needToSetHTML = false;\n      }\n\n      bubble.classList.add('can-have-big-emoji');\n    }\n\n    if(needToSetHTML) {\n      setInnerHTML(messageDiv, richText);\n    }\n\n    const timeSpan = MessageRender.setTime({\n      chatType: this.chat.type,\n      message,\n      reactionsMessage\n    });\n    messageDiv.append(timeSpan);\n    bubbleContainer.prepend(messageDiv);\n    // bubble.prepend(timeSpan, messageDiv); // that's bad\n\n    if(isMessage && message.views) {\n      bubble.classList.add('channel-post');\n\n      if(!message.fwd_from?.saved_from_msg_id && this.chat.type !== 'pinned') {\n        const forward = document.createElement('div');\n        forward.classList.add('bubble-beside-button', 'forward', 'tgico-forward_filled');\n        bubbleContainer.prepend(forward);\n        bubble.classList.add('with-beside-button');\n      }\n\n      if(!message.pFlags.is_outgoing && this.observer) {\n        this.observer.observe(bubble, this.viewsObserverCallback);\n      }\n    }\n\n    const replyMarkup = isMessage && message.reply_markup;\n    if(replyMarkup && replyMarkup._ === 'replyInlineMarkup' && replyMarkup.rows && replyMarkup.rows.length) {\n      const rows = replyMarkup.rows;\n\n      const containerDiv = document.createElement('div');\n      containerDiv.classList.add('reply-markup');\n      rows.forEach((row) => {\n        const buttons = row.buttons;\n        if(!buttons || !buttons.length) return;\n\n        const rowDiv = document.createElement('div');\n        rowDiv.classList.add('reply-markup-row');\n\n        buttons.forEach((button) => {\n          let text: DocumentFragment | HTMLElement | string = wrapRichText(button.text, {noLinks: true, noLinebreaks: true});\n\n          let buttonEl: HTMLButtonElement | HTMLAnchorElement;\n\n          switch(button._) {\n            case 'keyboardButtonUrl': {\n              const r = wrapRichText(' ', {\n                entities: [{\n                  _: 'messageEntityTextUrl',\n                  length: 1,\n                  offset: 0,\n                  url: button.url\n                }]\n              });\n\n              buttonEl = htmlToDocumentFragment(r).firstElementChild as HTMLAnchorElement;\n              buttonEl.classList.add('is-link');\n\n              break;\n            }\n\n            case 'keyboardButtonSwitchInline': {\n              buttonEl = document.createElement('button');\n              buttonEl.classList.add('is-switch-inline');\n              attachClickEvent(buttonEl, (e) => {\n                cancelEvent(e);\n\n                const botId = message.viaBotId || message.fromId;\n                let promise: Promise<PeerId>;\n                if(button.pFlags.same_peer) promise = Promise.resolve(this.peerId);\n                else promise = this.managers.appInlineBotsManager.checkSwitchReturn(botId).then((peerId) => {\n                  if(peerId) {\n                    return peerId;\n                  }\n\n                  return new Promise<PeerId>((resolve, reject) => {\n                    const popup = new PopupForward({\n                      [this.peerId]: []\n                    }, (peerId) => {\n                      resolve(peerId);\n                    }, true);\n\n                    popup.addEventListener('close', () => {\n                      reject();\n                    });\n                  });\n                });\n\n                promise.then((peerId) => {\n                  const threadId = this.peerId === peerId ? this.chat.threadId : undefined;\n                  this.chat.appImManager.setInnerPeer({peerId});\n                  this.managers.appInlineBotsManager.switchInlineQuery(peerId, threadId, botId, button.query);\n                });\n              });\n              break;\n            }\n\n            case 'keyboardButtonBuy': {\n              buttonEl = document.createElement('button');\n              buttonEl.classList.add('is-buy');\n\n              if(messageMedia?._ === 'messageMediaInvoice') {\n                if(messageMedia.receipt_msg_id) {\n                  text = i18n('Message.ReplyActionButtonShowReceipt');\n                }\n              }\n\n              break;\n            }\n\n            default: {\n              buttonEl = document.createElement('button');\n              break;\n            }\n          }\n\n          buttonEl.classList.add('reply-markup-button', 'rp', 'tgico');\n          if(typeof(text) === 'string') {\n            buttonEl.insertAdjacentHTML('beforeend', text);\n          } else {\n            buttonEl.append(text);\n          }\n\n          ripple(buttonEl);\n\n          rowDiv.append(buttonEl);\n        });\n\n        containerDiv.append(rowDiv);\n      });\n\n      attachClickEvent(containerDiv, (e) => {\n        let target = e.target as HTMLElement;\n\n        if(!target.classList.contains('reply-markup-button')) target = findUpClassName(target, 'reply-markup-button');\n        if(\n          !target ||\n          target.classList.contains('is-link') ||\n          target.classList.contains('is-switch-inline') ||\n          target.classList.contains('is-buy')\n        ) return;\n\n        cancelEvent(e);\n\n        const column = whichChild(target);\n        const row = rows[whichChild(target.parentElement)];\n\n        if(!row.buttons || !row.buttons[column]) {\n          this.log.warn('no such button', row, column, message);\n          return;\n        }\n\n        const button = row.buttons[column];\n        this.managers.appInlineBotsManager.callbackButtonClick(this.peerId, message.mid, button).then((callbackAnswer) => {\n          if(typeof callbackAnswer.message === 'string' && callbackAnswer.message.length) {\n            toast(wrapRichText(callbackAnswer.message, {noLinks: true, noLinebreaks: true}));\n          }\n\n          // console.log('callbackButtonClick callbackAnswer:', callbackAnswer);\n        });\n      });\n\n      canHaveTail = false;\n      bubble.classList.add('with-reply-markup');\n      contentWrapper.append(containerDiv);\n    }\n\n    const isOutgoing = message.pFlags.is_outgoing/*  && this.peerId !== rootScope.myId */;\n    if(our) {\n      if(message.pFlags.unread || isOutgoing) this.unreadOut.add(message.mid);\n      let status = '';\n      if(message.error) status = 'is-error';\n      else if(isOutgoing) status = 'is-sending';\n      else status = message.pFlags.unread || (message as Message.message).pFlags.is_scheduled ? 'is-sent' : 'is-read';\n      bubble.classList.add(status);\n    }\n\n    if(isOutgoing && !message.error) {\n      bubble.classList.add('is-outgoing');\n    }\n\n    const messageWithReplies = isMessage && await this.managers.appMessagesManager.getMessageWithCommentReplies(message);\n    const withReplies = !!messageWithReplies && message.mid > 0;\n\n    if(withReplies) {\n      bubble.classList.add('with-replies');\n    }\n\n    const fwdFrom = isMessage && message.fwd_from;\n    const fwdFromId = isMessage && message.fwdFromId;\n\n    const isOut = this.chat.isOutMessage(message);\n    let nameContainer: HTMLElement = bubbleContainer;\n\n    const canHideNameIfMedia = !message.viaBotId && (message.fromId === rootScope.myId || !message.pFlags.out);\n\n    // media\n    if(messageMedia/*  && messageMedia._ === 'messageMediaPhoto' */) {\n      let attachmentDiv = document.createElement('div');\n      attachmentDiv.classList.add('attachment');\n\n      if(!messageMessage) {\n        bubble.classList.add('is-message-empty');\n      }\n\n      let processingWebPage = false;\n\n      /* if(isMessage)  */switch(messageMedia._) {\n        case 'messageMediaPhoto': {\n          const photo = messageMedia.photo;\n          // //////this.log('messageMediaPhoto', photo);\n\n          if(!messageMessage) {\n            canHaveTail = false;\n          }\n\n          if(canHideNameIfMedia) {\n            bubble.classList.add('hide-name');\n          }\n\n          bubble.classList.add('photo');\n\n          if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\n            bubble.classList.add('is-album', 'is-grouped');\n            wrapAlbum({\n              messages: albumMessages,\n              attachmentDiv,\n              middleware: this.getMiddleware(),\n              isOut: our,\n              lazyLoadQueue: this.lazyLoadQueue,\n              chat: this.chat,\n              loadPromises,\n              autoDownload: this.chat.autoDownload\n            });\n\n            break;\n          }\n\n          const withTail = !IS_ANDROID && canHaveTail && !withReplies && USE_MEDIA_TAILS;\n          if(withTail) bubble.classList.add('with-media-tail');\n          wrapPhoto({\n            photo: photo as Photo.photo,\n            message,\n            container: attachmentDiv,\n            withTail,\n            isOut,\n            lazyLoadQueue: this.lazyLoadQueue,\n            middleware: this.getMiddleware(),\n            loadPromises,\n            autoDownloadSize: this.chat.autoDownload.photo\n          });\n\n          break;\n        }\n\n        case 'messageMediaWebPage': {\n          processingWebPage = true;\n\n          const webPage: WebPage = messageMedia.webpage;\n          // //////this.log('messageMediaWebPage', webpage);\n          if(webPage._ !== 'webPage') {\n            break;\n          }\n\n          bubble.classList.add('webpage');\n\n          const box = document.createElement('div');\n          box.classList.add('web');\n\n          const quote = document.createElement('div');\n          quote.classList.add('quote');\n\n          let previewResizer: HTMLDivElement, preview: HTMLDivElement;\n          const photo: Photo.photo = webPage.photo as any;\n          if(photo || webPage.document) {\n            previewResizer = document.createElement('div');\n            previewResizer.classList.add('preview-resizer');\n            preview = document.createElement('div');\n            preview.classList.add('preview');\n            previewResizer.append(preview);\n          }\n\n          const quoteTextDiv = document.createElement('div');\n          quoteTextDiv.classList.add('quote-text');\n\n          const doc = webPage.document as MyDocument;\n          if(doc) {\n            if(doc.type === 'gif' || doc.type === 'video' || doc.type === 'round') {\n              // if(doc.size <= 20e6) {\n              const mediaSize = doc.type === 'round' ? mediaSizes.active.round : mediaSizes.active.webpage;\n              if(doc.type === 'round') {\n                bubble.classList.add('round');\n                preview.classList.add('is-round');\n              } else {\n                bubble.classList.add('video');\n              }\n              wrapVideo({\n                doc,\n                container: preview,\n                message: message as Message.message,\n                boxWidth: mediaSize.width,\n                boxHeight: mediaSize.height,\n                lazyLoadQueue: this.lazyLoadQueue,\n                middleware: this.getMiddleware(),\n                isOut,\n                group: CHAT_ANIMATION_GROUP,\n                loadPromises,\n                autoDownload: this.chat.autoDownload,\n                noInfo: message.mid < 0\n              });\n              // }\n            } else {\n              const docDiv = await wrapDocument({\n                message: message as Message.message,\n                autoDownloadSize: this.chat.autoDownload.file,\n                lazyLoadQueue: this.lazyLoadQueue,\n                loadPromises,\n                sizeType: 'documentName',\n                searchContext: {\n                  useSearch: false,\n                  peerId: this.peerId,\n                  inputFilter: {\n                    _: 'inputMessagesFilterEmpty'\n                  }\n                }\n              });\n              preview.append(docDiv);\n              preview.classList.add('preview-with-document');\n              quoteTextDiv.classList.add('has-document');\n              // messageDiv.classList.add((webpage.type || 'document') + '-message');\n              // doc = null;\n            }\n          }\n\n          if(previewResizer) {\n            quoteTextDiv.append(previewResizer);\n          }\n\n          let t: HTMLElement;\n          if(webPage.site_name) {\n            const html = wrapRichText(webPage.url);\n            const a: HTMLAnchorElement = htmlToDocumentFragment(html).firstElementChild as any;\n            a.classList.add('webpage-name');\n            const strong = document.createElement('strong');\n            setInnerHTML(strong, wrapEmojiText(webPage.site_name));\n            a.textContent = '';\n            a.append(strong);\n            quoteTextDiv.append(a);\n            t = a;\n          }\n\n          const title = wrapWebPageTitle(webPage);\n          if(title.textContent) {\n            const titleDiv = document.createElement('div');\n            titleDiv.classList.add('title');\n            const strong = document.createElement('strong');\n            setInnerHTML(strong, title);\n            titleDiv.append(strong);\n            quoteTextDiv.append(titleDiv);\n            t = titleDiv;\n          }\n\n          const description = wrapWebPageDescription(webPage);\n          if(description.textContent) {\n            const textDiv = document.createElement('div');\n            textDiv.classList.add('text');\n            setInnerHTML(textDiv, description);\n            quoteTextDiv.append(textDiv);\n            t = textDiv;\n          }\n\n          /* if(t) {\n            t.append(timeSpan);\n          } else {\n            box.classList.add('no-text');\n          } */\n\n          quote.append(quoteTextDiv);\n\n          if(photo && !doc) {\n            bubble.classList.add('photo');\n\n            const size: PhotoSize.photoSize = photo.sizes[photo.sizes.length - 1] as any;\n            let isSquare = false;\n            if(size.w === size.h && t) {\n              bubble.classList.add('is-square-photo');\n              isSquare = true;\n              setAttachmentSize(photo, preview, 48, 48, false);\n\n              /* if(t) {\n                t.append(timeSpan);\n              } */\n            } else if(size.h > size.w) {\n              bubble.classList.add('is-vertical-photo');\n            }\n\n            wrapPhoto({\n              photo,\n              message,\n              container: preview,\n              boxWidth: isSquare ? 0 : mediaSizes.active.webpage.width,\n              boxHeight: isSquare ? 0 : mediaSizes.active.webpage.height,\n              isOut,\n              lazyLoadQueue: this.lazyLoadQueue,\n              middleware: this.getMiddleware(),\n              loadPromises,\n              withoutPreloader: isSquare,\n              autoDownloadSize: this.chat.autoDownload.photo\n            });\n          }\n\n          box.append(quote);\n\n          // bubble.prepend(box);\n          // if(timeSpan.parentElement === messageDiv) {\n          messageDiv.insertBefore(box, timeSpan);\n          // } else {\n          //   messageDiv.append(box);\n          // }\n\n          // this.log('night running', bubble.scrollHeight);\n\n          break;\n        }\n\n        case 'messageMediaDocument': {\n          const doc = messageMedia.document as MyDocument;\n\n          // this.log('messageMediaDocument', doc, bubble);\n\n          if(doc.sticker/*  && doc.size <= 1e6 */) {\n            bubble.classList.add('sticker');\n            canHaveTail = false;\n            isStandaloneMedia = true;\n\n            if(doc.animated) {\n              bubble.classList.add('sticker-animated');\n            }\n\n            const sizes = mediaSizes.active;\n            const isEmoji = bubble.classList.contains('emoji-big');\n            const boxSize = isEmoji ? sizes.emojiSticker : (doc.animated ? sizes.animatedSticker : sizes.staticSticker);\n            setAttachmentSize(doc, attachmentDiv, boxSize.width, boxSize.height);\n            // let preloader = new ProgressivePreloader(attachmentDiv, false);\n            bubbleContainer.style.minWidth = attachmentDiv.style.width;\n            bubbleContainer.style.minHeight = attachmentDiv.style.height;\n            // appPhotosManager.setAttachmentSize(doc, bubble);\n            wrapSticker({\n              doc,\n              div: attachmentDiv,\n              middleware,\n              lazyLoadQueue: this.lazyLoadQueue,\n              group: CHAT_ANIMATION_GROUP,\n              // play: !!message.pending || !multipleRender,\n              play: true,\n              loop: true,\n              emoji: isEmoji ? messageMessage : undefined,\n              withThumb: true,\n              loadPromises,\n              isOut,\n              noPremium: messageMedia?.pFlags?.nopremium\n            });\n\n            if(getStickerEffectThumb(doc) && (isInUnread || isOutgoing)/*  || true */) {\n              this.observer.observe(bubble, this.stickerEffectObserverCallback);\n            }\n          } else if(doc.type === 'video' || doc.type === 'gif' || doc.type === 'round'/*  && doc.size <= 20e6 */) {\n            // this.log('never get free 2', doc);\n\n            const isRound = doc.type === 'round';\n            if(isRound) {\n              isStandaloneMedia = true;\n            }\n\n            if(isRound || !messageMessage) {\n              canHaveTail = false;\n            }\n\n            if(canHideNameIfMedia) {\n              bubble.classList.add('hide-name');\n            }\n\n            bubble.classList.add(isRound ? 'round' : 'video');\n            if(albumMustBeRenderedFull && groupedId && albumMids.length !== 1) {\n              bubble.classList.add('is-album', 'is-grouped');\n\n              wrapAlbum({\n                messages: albumMessages,\n                attachmentDiv,\n                middleware,\n                isOut: our,\n                lazyLoadQueue: this.lazyLoadQueue,\n                chat: this.chat,\n                loadPromises,\n                autoDownload: this.chat.autoDownload\n              });\n            } else {\n              const withTail = !IS_ANDROID && !IS_APPLE && !isRound && canHaveTail && !withReplies && USE_MEDIA_TAILS;\n              if(withTail) bubble.classList.add('with-media-tail');\n              wrapVideo({\n                doc,\n                container: attachmentDiv,\n                message: message as Message.message,\n                boxWidth: mediaSizes.active.regular.width,\n                boxHeight: mediaSizes.active.regular.height,\n                withTail,\n                isOut,\n                lazyLoadQueue: this.lazyLoadQueue,\n                middleware,\n                group: CHAT_ANIMATION_GROUP,\n                loadPromises,\n                autoDownload: this.chat.autoDownload,\n                searchContext: isRound ? {\n                  peerId: this.peerId,\n                  inputFilter: {_: 'inputMessagesFilterRoundVoice'},\n                  threadId: this.chat.threadId,\n                  useSearch: !(message as Message.message).pFlags.is_scheduled,\n                  isScheduled: (message as Message.message).pFlags.is_scheduled\n                } : undefined,\n                noInfo: message.mid < 0\n              });\n            }\n          } else {\n            const newNameContainer = await wrapGroupedDocuments({\n              albumMustBeRenderedFull,\n              message,\n              bubble,\n              messageDiv,\n              chat: this.chat,\n              loadPromises,\n              autoDownloadSize: this.chat.autoDownload.file,\n              lazyLoadQueue: this.lazyLoadQueue,\n              searchContext: doc.type === 'voice' || doc.type === 'audio' ? {\n                peerId: this.peerId,\n                inputFilter: {_: doc.type === 'voice' ? 'inputMessagesFilterRoundVoice' : 'inputMessagesFilterMusic'},\n                threadId: this.chat.threadId,\n                useSearch: !(message as Message.message).pFlags.is_scheduled,\n                isScheduled: (message as Message.message).pFlags.is_scheduled\n              } : undefined,\n              sizeType: 'documentName'\n            });\n\n            if(newNameContainer) {\n              nameContainer = newNameContainer;\n            }\n\n            const lastContainer = messageDiv.lastElementChild.querySelector('.document-message, .document, .audio');\n            // lastContainer && lastContainer.append(timeSpan.cloneNode(true));\n            lastContainer && lastContainer.append(timeSpan);\n\n            bubble.classList.remove('is-message-empty');\n            messageDiv.classList.add((!(['photo', 'pdf'] as MyDocument['type'][]).includes(doc.type) ? doc.type || 'document' : 'document') + '-message');\n            processingWebPage = true;\n          }\n\n          break;\n        }\n\n        case 'messageMediaCall': {\n          const action = messageMedia.action;\n          const div = document.createElement('div');\n          div.classList.add('bubble-call', action.pFlags.video ? 'tgico-videocamera' : 'tgico-phone');\n\n          const type: CallType = action.pFlags.video ? 'video' : 'voice';\n          div.dataset.type = type;\n\n          const title = document.createElement('div');\n          title.classList.add('bubble-call-title');\n\n          _i18n(title, isOut ?\n            (action.pFlags.video ? 'CallMessageVideoOutgoing' : 'CallMessageOutgoing') :\n            (action.pFlags.video ? 'CallMessageVideoIncoming' : 'CallMessageIncoming'));\n\n          const subtitle = document.createElement('div');\n          subtitle.classList.add('bubble-call-subtitle');\n\n          if(action.duration !== undefined) {\n            subtitle.append(formatCallDuration(action.duration));\n          } else {\n            let langPackKey: LangPackKey;\n            switch(action.reason._) {\n              case 'phoneCallDiscardReasonBusy':\n                langPackKey = 'Call.StatusBusy';\n                break;\n              case 'phoneCallDiscardReasonMissed':\n                langPackKey = 'Chat.Service.Call.Missed';\n                break;\n              // case 'phoneCallDiscardReasonHangup':\n              default:\n                langPackKey = 'Chat.Service.Call.Cancelled';\n                break;\n            }\n\n            subtitle.classList.add('is-reason');\n            _i18n(subtitle, langPackKey);\n          }\n\n          subtitle.classList.add('tgico', 'arrow-' + (action.duration !== undefined ? 'green' : 'red'));\n\n          div.append(title, subtitle);\n\n          processingWebPage = true;\n\n          bubble.classList.remove('is-message-empty');\n          messageDiv.classList.add('call-message');\n          messageDiv.append(div);\n\n          break;\n        }\n\n        case 'messageMediaContact': {\n          // this.log('wrapping contact', message);\n\n          const contact = messageMedia;\n          const contactDiv = document.createElement('div');\n          contactDiv.classList.add('contact');\n          contactDiv.dataset.peerId = '' + contact.user_id;\n\n          processingWebPage = true;\n\n          const contactDetails = document.createElement('div');\n          contactDetails.className = 'contact-details';\n          const contactNameDiv = document.createElement('div');\n          contactNameDiv.className = 'contact-name';\n          contactNameDiv.append(\n            wrapEmojiText([\n              contact.first_name,\n              contact.last_name\n            ].filter(Boolean).join(' '))\n          );\n\n          const contactNumberDiv = document.createElement('div');\n          contactNumberDiv.className = 'contact-number';\n          contactNumberDiv.textContent = contact.phone_number ? '+' + formatPhoneNumber(contact.phone_number).formatted : 'Unknown phone number';\n\n          contactDiv.append(contactDetails);\n          contactDetails.append(contactNameDiv, contactNumberDiv);\n\n          const avatarElem = new AvatarElement();\n          avatarElem.updateWithOptions({\n            lazyLoadQueue: this.lazyLoadQueue,\n            peerId: contact.user_id.toPeerId()\n          });\n          avatarElem.classList.add('contact-avatar', 'avatar-54');\n\n          contactDiv.prepend(avatarElem);\n\n          bubble.classList.remove('is-message-empty');\n          messageDiv.classList.add('contact-message');\n          messageDiv.append(contactDiv);\n\n          break;\n        }\n\n        case 'messageMediaPoll': {\n          bubble.classList.remove('is-message-empty');\n\n          const pollElement = wrapPoll(message);\n          messageDiv.prepend(pollElement);\n          messageDiv.classList.add('poll-message');\n\n          break;\n        }\n\n        case 'messageMediaInvoice': {\n          const isTest = messageMedia.pFlags.test;\n          const photo = messageMedia.photo;\n\n          const priceEl = document.createElement(photo ? 'span' : 'div');\n          const f = document.createDocumentFragment();\n          const l = i18n(messageMedia.receipt_msg_id ? 'PaymentReceipt' : (isTest ? 'PaymentTestInvoice' : 'PaymentInvoice'));\n          l.classList.add('text-uppercase');\n          const joiner = ' ';\n          const p = document.createElement('span');\n          p.classList.add('text-bold');\n          p.textContent = paymentsWrapCurrencyAmount(messageMedia.total_amount, messageMedia.currency) + joiner;\n          f.append(p, l);\n          if(isTest && messageMedia.receipt_msg_id) {\n            const a = document.createElement('span');\n            a.classList.add('text-uppercase', 'pre-wrap');\n            a.append(joiner + '(Test)');\n            f.append(a);\n          }\n          setInnerHTML(priceEl, f);\n\n          if(photo) {\n            const mediaSize = mediaSizes.active.invoice;\n            wrapPhoto({\n              photo,\n              container: attachmentDiv,\n              withTail: false,\n              isOut,\n              lazyLoadQueue: this.lazyLoadQueue,\n              middleware,\n              loadPromises,\n              boxWidth: mediaSize.width,\n              boxHeight: mediaSize.height\n            });\n\n            bubble.classList.add('photo');\n\n            priceEl.classList.add('video-time');\n            attachmentDiv.append(priceEl);\n          } else {\n            attachmentDiv = undefined;\n          }\n\n          const titleDiv = document.createElement('div');\n          titleDiv.classList.add('bubble-primary-color');\n          setInnerHTML(titleDiv, wrapEmojiText(messageMedia.title));\n\n          const richText = wrapEmojiText(messageMedia.description);\n          messageDiv.prepend(...[titleDiv, !photo && priceEl, richText].filter(Boolean));\n\n          bubble.classList.remove('is-message-empty');\n          bubble.classList.add('is-invoice');\n\n          break;\n        }\n\n        default:\n          attachmentDiv = undefined;\n          bubble.classList.remove('is-message-empty');\n          messageDiv.append(i18n(UNSUPPORTED_LANG_PACK_KEY), timeSpan);\n          this.log.warn('unrecognized media type:', messageMedia._, message);\n          break;\n      }\n\n      if(!processingWebPage && attachmentDiv) {\n        bubbleContainer.append(attachmentDiv);\n      }\n\n      /* if(bubble.classList.contains('is-message-empty') && (bubble.classList.contains('photo') || bubble.classList.contains('video'))) {\n        bubble.classList.add('no-tail');\n\n        if(!bubble.classList.contains('with-media-tail')) {\n          bubble.classList.add('use-border-radius');\n        }\n      } */\n    }\n\n    if(isStandaloneMedia) {\n      bubble.classList.add('just-media');\n    }\n\n    let savedFrom = '';\n\n    // const needName = ((peerId.isAnyChat() && (peerId !== message.fromId || our)) && message.fromId !== rootScope.myId) || message.viaBotId;\n    const needName = (message.fromId !== rootScope.myId && this.chat.isAnyGroup) || message.viaBotId || (message as Message.message).pFlags.sponsored;\n    if(needName || fwdFrom || message.reply_to_mid) { // chat\n      let title: HTMLElement | DocumentFragment;\n      let titleVia: typeof title;\n\n      // is this right? shouldn't it be message.fwd_from.from_id._ ??\n      const isForwardFromChannel = message.from_id && message.from_id._ === 'peerChannel' && message.fromId === fwdFromId;\n\n      const isHidden = fwdFrom && !fwdFrom.from_id;\n      if(message.viaBotId) {\n        titleVia = document.createElement('span');\n        titleVia.innerText = '@' + (await this.managers.appUsersManager.getUser(message.viaBotId)).username;\n        titleVia.classList.add('peer-title');\n        bubble.classList.add('must-have-name');\n      }\n\n      if(isHidden) {\n        // /////this.log('message to render hidden', message);\n        title = document.createElement('span');\n        setInnerHTML(title, wrapEmojiText(fwdFrom.from_name));\n        title.classList.add('peer-title');\n        // title = fwdFrom.from_name;\n        bubble.classList.add('hidden-profile');\n      } else {\n        title = new PeerTitle({peerId: fwdFromId || message.fromId, withPremiumIcon: true}).element;\n      }\n\n      if(message.reply_to_mid && message.reply_to_mid !== this.chat.threadId && isMessage) {\n        await MessageRender.setReply({\n          chat: this.chat,\n          bubble,\n          bubbleContainer,\n          message\n        });\n      }\n\n      // this.log(title);\n\n      let nameDiv: HTMLElement;\n      if((fwdFromId || fwdFrom)) {\n        if(this.peerId !== rootScope.myId && !isForwardFromChannel) {\n          bubble.classList.add('forwarded');\n        }\n\n        if(message.savedFrom) {\n          savedFrom = message.savedFrom;\n          title.dataset.savedFrom = savedFrom;\n        }\n\n        nameDiv = document.createElement('div');\n        title.dataset.peerId = '' + fwdFromId;\n\n        if((this.peerId === rootScope.myId || this.peerId === REPLIES_PEER_ID || isForwardFromChannel) && !isStandaloneMedia) {\n          nameDiv.style.color = getPeerColorById(fwdFromId, false);\n          nameDiv.classList.add('colored-name');\n          nameDiv.append(title);\n        } else {\n          /* const fromTitle = message.fromId === this.myID || appPeersManager.isBroadcast(fwdFromId || message.fromId) ? '' : `<div class=\"name\" data-peer-id=\"${message.fromId}\" style=\"color: ${appPeersManager.getPeerColorByID(message.fromId, false)};\">${appPeersManager.getPeerTitle(message.fromId)}</div>`;\n          nameDiv.innerHTML = fromTitle + 'Forwarded from ' + title; */\n          const args: FormatterArguments = [title];\n          if(isStandaloneMedia) {\n            args.unshift(document.createElement('br'));\n          }\n          // todo: mark if muted?\n          nameDiv.append(i18n('ForwardedFrom', [args]));\n        }\n      } else if(!message.viaBotId) {\n        if(!isStandaloneMedia && needName) {\n          nameDiv = document.createElement('div');\n          nameDiv.append(title);\n\n          const peer = await this.managers.appPeersManager.getPeer(message.fromId);\n          const pFlags = (peer as User.user)?.pFlags;\n          if(pFlags && (pFlags.scam || pFlags.fake)) {\n            nameDiv.append(generateFakeIcon(pFlags.scam));\n          }\n\n          if(!our) {\n            nameDiv.style.color = getPeerColorById(message.fromId, false);\n            nameDiv.classList.add('colored-name');\n          }\n\n          nameDiv.dataset.peerId = '' + message.fromId;\n        } else /* if(!message.reply_to_mid) */ {\n          bubble.classList.add('hide-name');\n        }\n      }\n\n      if(message.viaBotId) {\n        if(!nameDiv) {\n          nameDiv = document.createElement('div');\n        } else {\n          nameDiv.append(' ');\n        }\n\n        const span = document.createElement('span');\n        span.append(i18n('ViaBot'), ' ', titleVia);\n        span.classList.add('is-via');\n\n        nameDiv.append(span);\n      }\n\n      if(nameDiv) {\n        nameDiv.classList.add('name');\n        nameContainer.append(nameDiv);\n      }\n    } else {\n      bubble.classList.add('hide-name');\n    }\n\n    if(this.chat.type === 'pinned') {\n      savedFrom = `${this.chat.peerId}_${message.mid}`;\n    }\n\n    const isThreadStarter = messageWithReplies && messageWithReplies.mid === this.chat.threadId;\n    if(isThreadStarter) {\n      bubble.classList.add('is-thread-starter', 'is-group-last');\n    }\n\n    if(savedFrom && (this.chat.type === 'pinned' || fwdFrom.saved_from_msg_id) && this.peerId !== REPLIES_PEER_ID) {\n      const goto = document.createElement('div');\n      goto.classList.add('bubble-beside-button', 'goto-original', 'tgico-arrow_next');\n      bubbleContainer.append(goto);\n      bubble.dataset.savedFrom = savedFrom;\n      bubble.classList.add('with-beside-button');\n    }\n\n    bubble.classList.add(isOut ? 'is-out' : 'is-in');\n\n    if(withReplies) {\n      const isFooter = MessageRender.renderReplies({\n        bubble,\n        bubbleContainer,\n        message: messageWithReplies,\n        messageDiv,\n        loadPromises,\n        lazyLoadQueue: this.lazyLoadQueue\n      });\n\n      if(isFooter) {\n        canHaveTail = true;\n      } else {\n        bubble.classList.add('with-beside-replies');\n      }\n    }\n\n    if(isMessage) {\n      this.appendReactionsElementToBubble(bubble, message, reactionsMessage);\n    }\n\n    /* if(isMessage) {\n      const reactionHover = document.createElement('div');\n      reactionHover.classList.add('bubble-reaction-hover');\n      contentWrapper.append(reactionHover);\n    } */\n\n    if(canHaveTail) {\n      bubble.classList.add('can-have-tail');\n\n      bubbleContainer.append(generateTail());\n    }\n\n    return ret;\n  }\n\n  private appendReactionsElementToBubble(\n    bubble: HTMLElement,\n    message: Message.message,\n    reactionsMessage: Message.message,\n    changedResults?: ReactionCount[]\n  ) {\n    if(this.peerId.isUser() && USER_REACTIONS_INLINE/*  || true */) {\n      return;\n    }\n\n    if(!reactionsMessage?.reactions || !reactionsMessage.reactions.results.length) {\n      return;\n    }\n\n    // message = this.appMessagesManager.getMessageWithReactions(message);\n\n    const reactionsElement = new ReactionsElement();\n    reactionsElement.init(reactionsMessage, 'block', bubble.middlewareHelper.get());\n    reactionsElement.render(changedResults);\n\n    if(bubble.classList.contains('is-message-empty')) {\n      bubble.querySelector('.bubble-content-wrapper').append(reactionsElement);\n    } else {\n      const messageDiv = bubble.querySelector('.message');\n      if(bubble.classList.contains('is-multiple-documents')) {\n        const documentContainer = messageDiv.lastElementChild as HTMLElement;\n        let documentMessageDiv = documentContainer.querySelector('.document-message');\n\n        let timeSpan: HTMLElement = documentMessageDiv && documentMessageDiv.querySelector('.time');\n        if(!timeSpan) {\n          timeSpan = MessageRender.setTime({\n            chatType: this.chat.type,\n            message,\n            reactionsMessage\n          });\n        }\n\n        reactionsElement.append(timeSpan);\n\n        if(!documentMessageDiv) {\n          documentMessageDiv = document.createElement('div');\n          documentMessageDiv.classList.add('document-message');\n          documentContainer.querySelector('.document-wrapper').prepend(documentMessageDiv);\n        }\n\n        documentMessageDiv.append(reactionsElement);\n      } else {\n        const timeSpan = Array.from(bubble.querySelectorAll('.time')).pop();\n        reactionsElement.append(timeSpan);\n\n        messageDiv.append(reactionsElement);\n      }\n    }\n  }\n\n  private prepareToSaveScroll(reverse?: boolean) {\n    const isMounted = !!this.chatInner.parentElement;\n    if(!isMounted) {\n      return {};\n    }\n\n    const log = this.log.bindPrefix('prepareToSaveScroll');\n    log('save');\n    const scrollSaver = this.createScrollSaver(reverse);\n    scrollSaver.save(); // * let's save scroll position by point before the slicing, not after\n\n    if(this.getRenderedLength() && !this.chat.setPeerPromise) {\n      const viewportSlice = this.getViewportSlice();\n      this.deleteViewportSlice(viewportSlice, true);\n    }\n\n    // scrollSaver.save(); // ! slicing will corrupt scroll position\n    // const saved = scrollSaver.getSaved();\n    // const hadScroll = saved.scrollHeight !== saved.clientHeight;\n\n    return {\n      restoreScroll: () => {\n        log('restore');\n        // scrollSaver.restore(_history.length === 1 && !reverse ? false : true);\n        scrollSaver.restore(reverse);\n        this.onRenderScrollSet(scrollSaver.getSaved());\n      },\n      scrollSaver\n    };\n  }\n\n  public async performHistoryResult(historyResult: HistoryResult | {history: (Message.message | Message.messageService | number)[]}, reverse: boolean) {\n    const log = false ? this.log.bindPrefix('perform-' + (Math.random() * 1000 | 0)) : undefined;\n    log && log('start', this.chatInner.parentElement);\n\n    let history = historyResult.history;\n    history = history.slice(); // need\n\n    if(this.needReflowScroll) {\n      reflowScrollableElement(this.scrollable.container);\n      this.needReflowScroll = false;\n    }\n\n    const cb = (message: Message.message | Message.messageService) => {\n      if(!message) {\n        return;\n      } else if(message.pFlags.local) {\n        return this.processLocalMessageRender(message);\n      } else {\n        return this.safeRenderMessage(message, reverse);\n      }\n    };\n\n    const messages = await Promise.all(history.map((mid) => {\n      return typeof(mid) === 'number' ? this.chat.getMessage(mid) : mid;\n    }));\n\n    const setLoadedPromises: Promise<any>[] = [];\n    if(!this.scrollable.loadedAll['bottom'] || !this.scrollable.loadedAll['top']) {\n      let isEnd = (historyResult as HistoryResult).isEnd;\n      if(!isEnd) {\n        const historyStorage = await this.chat.getHistoryStorage();\n        const firstSlice = historyStorage.history.first;\n        const lastSlice = historyStorage.history.last;\n        isEnd = {top: false, bottom: false, both: false};\n        if(firstSlice.isEnd(SliceEnd.Bottom) && (!firstSlice.length || history.includes(firstSlice[0]))) {\n          isEnd.bottom = true;\n        }\n\n        if(lastSlice.isEnd(SliceEnd.Top) && (!lastSlice.length || history.includes(lastSlice[lastSlice.length - 1]))) {\n          isEnd.top = true;\n        }\n      }\n\n      if(!isEnd.bottom && this.setPeerOptions) {\n        const {lastMsgId, topMessage} = this.setPeerOptions;\n        this.setPeerOptions = undefined;\n        if(!lastMsgId || this.bubbles[topMessage] || lastMsgId === topMessage) {\n          isEnd.bottom = true;\n        }\n      }\n\n      if(isEnd.top) setLoadedPromises.push(this.setLoaded('top', true));\n      if(isEnd.bottom) setLoadedPromises.push(this.setLoaded('bottom', true));\n    }\n\n    await Promise.all(setLoadedPromises);\n\n    // ! it is important to insert bubbles to group reversed way\n    // const length = history.length, promises: Promise<any>[] = [];\n    // if(reverse) for(let i = 0; i < length; ++i) promises.push(cb(messages[i]));\n    // else for(let i = length - 1; i >= 0; --i) promises.push(cb(messages[i]));\n    const promises = messages.map(cb);\n\n    // cannot combine them into one promise\n    await Promise.all(promises);\n    await this.messagesQueuePromise;\n\n    if(this.scrollable.loadedAll.top && this.messagesQueueOnRenderAdditional) {\n      this.messagesQueueOnRenderAdditional();\n\n      if(this.messagesQueueOnRenderAdditional) {\n        this.messagesQueueOnRenderAdditional();\n      }\n    }\n\n    log && log('performHistoryResult end');\n  }\n\n  private onRenderScrollSet(state?: {scrollHeight: number, clientHeight: number}) {\n    const className = 'has-sticky-dates';\n    if(!this.container.classList.contains(className)) {\n      const isLoading = !this.preloader.detached;\n\n      if(isLoading ||\n        (\n          state ??= {\n            scrollHeight: this.scrollable.scrollHeight,\n            clientHeight: this.scrollable.container.clientHeight\n          },\n          state.scrollHeight !== state.clientHeight\n        )\n      ) {\n        /* for(const timestamp in this.dateMessages) {\n          const dateMessage = this.dateMessages[timestamp];\n          dateMessage.div.classList.add('is-sticky');\n        } */\n\n        const middleware = this.getMiddleware();\n        const callback = () => {\n          if(!middleware()) return;\n          this.container.classList.add(className);\n        };\n\n        if(this.willScrollOnLoad) {\n          callback();\n        } else {\n          setTimeout(callback, 600);\n        }\n\n        return;\n      }\n    }\n\n    this.willScrollOnLoad = undefined;\n  }\n\n  public onDatePick = (timestamp: number) => {\n    const peerId = this.peerId;\n    this.managers.appMessagesManager.requestHistory(peerId, 0, 2, -1, timestamp, this.chat.threadId).then((history) => {\n      if(!history?.messages?.length) {\n        this.log.error('no history!');\n        return;\n      } else if(this.peerId !== peerId) {\n        return;\n      }\n\n      this.chat.setMessageId((history.messages[0] as MyMessage).mid);\n      // console.log('got history date:', history);\n    });\n  };\n\n  public requestHistory(maxId: number, loadCount: number, backLimit: number) {\n    // const middleware = this.getMiddleware();\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\n      return this.managers.acknowledged.appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit, this.chat.threadId);\n    } else if(this.chat.type === 'pinned') {\n      return this.managers.acknowledged.appMessagesManager.getSearch({\n        peerId: this.peerId,\n        inputFilter: {_: 'inputMessagesFilterPinned'},\n        maxId,\n        limit: loadCount,\n        backLimit\n      }).then((ackedResult) => {\n        return {\n          cached: ackedResult.cached,\n          result: Promise.resolve(ackedResult.result).then((value) => {\n            return {history: value.history.map((m) => m.mid)};\n          })\n        };\n      });\n    } else if(this.chat.type === 'scheduled') {\n      return this.managers.acknowledged.appMessagesManager.getScheduledMessages(this.peerId).then((ackedResult) => {\n        // this.setLoaded('top', true);\n        // this.setLoaded('bottom', true);\n        return {\n          cached: ackedResult.cached,\n          result: Promise.resolve(ackedResult.result).then((mids) => ({history: mids.slice().reverse()}))\n        };\n      });\n    }\n  }\n\n  private async animateAsLadder(additionMsgId: number, additionMsgIds: number[], isAdditionRender: boolean, backLimit: number, maxId: number) {\n    /* const middleware = this.getMiddleware();\n    await this.ladderDeferred; */\n\n    const log = this.log.bindPrefix('ladder');\n    if(this.chat.setPeerPromise && !this.resolveLadderAnimation) {\n      log.warn('will be delayed');\n      // @ts-ignore\n      this.resolveLadderAnimation = this.animateAsLadder.bind(this, additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\n      return;\n    }\n\n    /* if(!middleware()) {\n      return;\n    } */\n\n    if(!Object.keys(this.bubbles).length) {\n      log.warn('no bubbles');\n      return;\n    }\n\n    let sortedMids = getObjectKeysAndSort(this.bubbles, 'desc');\n\n    if(isAdditionRender && additionMsgIds.length) {\n      sortedMids = sortedMids.filter((mid) => !additionMsgIds.includes(mid));\n    }\n\n    let targetMid: number;\n    if(backLimit) {\n      targetMid = maxId || Math.max(...sortedMids); // * on discussion enter\n    } else {\n      if(additionMsgId) {\n        targetMid = additionMsgId;\n      } else { // * if maxId === 0\n        targetMid = Math.max(...sortedMids);\n      }\n    }\n\n    const topIds = sortedMids.slice(sortedMids.findIndex((mid) => targetMid > mid));\n    const middleIds = isAdditionRender ? [] : [targetMid];\n    const bottomIds = isAdditionRender ? [] : sortedMids.slice(0, sortedMids.findIndex((mid) => targetMid >= mid)).reverse();\n\n    if(DEBUG) {\n      log('targeting mid:', targetMid, maxId, additionMsgId,\n        topIds.map((m) => getServerMessageId(m)),\n        bottomIds.map((m) => getServerMessageId(m)));\n    }\n\n    const setBubbles: HTMLElement[] = [];\n\n    this.chatInner.classList.add('zoom-fading');\n    const delay = isAdditionRender ? 10 : 40;\n    const offsetIndex = isAdditionRender ? 0 : 1;\n    const animateAsLadder = (mids: number[], offsetIndex = 0) => {\n      const animationPromise = deferredPromise<void>();\n      let lastMsDelay = 0;\n      mids.forEach((mid, idx) => {\n        const bubble = this.bubbles[mid];\n        if(!bubble || this.skippedMids.has(mid)) {\n          log.warn('no bubble by mid:', mid);\n          return;\n        }\n\n        lastMsDelay = ((idx + offsetIndex) || 0.1) * delay;\n        // lastMsDelay = (idx + offsetIndex) * delay;\n        // lastMsDelay = (idx || 0.1) * 1000;\n\n        const contentWrapper = bubble.lastElementChild as HTMLElement;\n        const elementsToAnimate: HTMLElement[] = [contentWrapper];\n        const item = this.bubbleGroups.getItemByBubble(bubble);\n        if(item && item.group.avatar && item.group.lastItem === item) {\n          elementsToAnimate.push(item.group.avatar);\n        }\n\n        elementsToAnimate.forEach((element) => {\n          element.classList.add('zoom-fade', 'can-zoom-fade');\n          element.style.transitionDelay = lastMsDelay + 'ms';\n        });\n\n        if(idx === (mids.length - 1)) {\n          const onTransitionEnd = (e: TransitionEvent) => {\n            if(e.target !== contentWrapper) {\n              return;\n            }\n\n            animationPromise.resolve();\n            contentWrapper.removeEventListener('transitionend', onTransitionEnd);\n          };\n\n          contentWrapper.addEventListener('transitionend', onTransitionEnd);\n        }\n\n        setBubbles.push(...elementsToAnimate);\n      });\n\n      if(!mids.length) {\n        animationPromise.resolve();\n      }\n\n      return {lastMsDelay, animationPromise};\n    };\n\n    const topRes = animateAsLadder(topIds, offsetIndex);\n    const middleRes = animateAsLadder(middleIds);\n    const bottomRes = animateAsLadder(bottomIds, offsetIndex);\n    const promises = [topRes.animationPromise, middleRes.animationPromise, bottomRes.animationPromise];\n    const delays: number[] = [topRes.lastMsDelay, middleRes.lastMsDelay, bottomRes.lastMsDelay];\n\n    if(this.onAnimateLadder) {\n      await this.onAnimateLadder();\n    }\n\n    fastRaf(() => {\n      this.setStickyDateManually(); // ! maybe it's not efficient\n\n      setBubbles.forEach((element) => {\n        element.classList.remove('zoom-fade');\n      });\n    });\n\n    let promise: Promise<any>;\n    if(topIds.length || middleIds.length || bottomIds.length) {\n      promise = Promise.all(promises);\n\n      dispatchHeavyAnimationEvent(promise, Math.max(...delays) + 200) // * 200 - transition time\n      .then(() => {\n        fastRaf(() => {\n          setBubbles.forEach((element) => {\n            element.style.transitionDelay = '';\n            element.classList.remove('can-zoom-fade');\n          });\n\n          this.chatInner.classList.remove('zoom-fading');\n        });\n\n        // !  , -  - zoom-fade        ,\n        // ! ..   ,  ,     translateZ    scrollable\n        // if(!IS_SAFARI) {\n        //   this.needReflowScroll = true;\n        // }\n      });\n    }\n\n    return promise;\n  }\n\n  private async renderEmptyPlaceholder(\n    type: 'group' | 'saved' | 'noMessages' | 'noScheduledMessages' | 'greeting' | 'restricted',\n    bubble: HTMLElement,\n    message: any,\n    elements: (Node | string)[]\n  ) {\n    const BASE_CLASS = 'empty-bubble-placeholder';\n    bubble.classList.add(BASE_CLASS, BASE_CLASS + '-' + type);\n\n    let title: HTMLElement;\n    if(type === 'group') title = i18n('GroupEmptyTitle1');\n    else if(type === 'saved') title = i18n('ChatYourSelfTitle');\n    else if(type === 'noMessages' || type === 'greeting') title = i18n('NoMessages');\n    else if(type === 'noScheduledMessages') title = i18n('NoScheduledMessages');\n    else if(type === 'restricted') {\n      title = document.createElement('span');\n      title.innerText = await this.managers.appPeersManager.getRestrictionReasonText(this.peerId);\n    }\n    title.classList.add('center', BASE_CLASS + '-title');\n\n    elements.push(title);\n\n    let listElements: HTMLElement[];\n    if(type === 'group') {\n      elements.push(i18n('GroupEmptyTitle2'));\n      listElements = [\n        i18n('GroupDescription1'),\n        i18n('GroupDescription2'),\n        i18n('GroupDescription3'),\n        i18n('GroupDescription4')\n      ];\n    } else if(type === 'saved') {\n      listElements = [\n        i18n('ChatYourSelfDescription1'),\n        i18n('ChatYourSelfDescription2'),\n        i18n('ChatYourSelfDescription3'),\n        i18n('ChatYourSelfDescription4')\n      ];\n    } else if(type === 'greeting') {\n      const subtitle = i18n('NoMessagesGreetingsDescription');\n      subtitle.classList.add('center', BASE_CLASS + '-subtitle');\n\n      // findAndSplice(this.messagesQueue, q => q.bubble === bubble);\n\n      const stickerDiv = document.createElement('div');\n      stickerDiv.classList.add(BASE_CLASS + '-sticker');\n\n      const middleware = this.getMiddleware();\n\n      await this.managers.appStickersManager.getGreetingSticker().then(async(doc) => {\n        if(!middleware()) return;\n\n        const loadPromises: Promise<any>[] = [];\n        await wrapSticker({\n          doc,\n          // doc: appDocsManager.getDoc(\"5431607541660389336\"), // cubigator mockup\n          div: stickerDiv,\n          middleware,\n          lazyLoadQueue: this.lazyLoadQueue,\n          group: CHAT_ANIMATION_GROUP,\n          // play: !!message.pending || !multipleRender,\n          play: true,\n          loop: true,\n          withThumb: true,\n          loadPromises\n        });\n\n        attachClickEvent(stickerDiv, (e) => {\n          cancelEvent(e);\n          EmoticonsDropdown.onMediaClick({target: e.target});\n        });\n\n        return Promise.all(loadPromises);\n      });\n\n      // this.renderMessagesQueue({\n      //   message,\n      //   bubble,\n      //   reverse: false,\n      //   promises: [loadPromise]\n      // });\n\n      elements.push(subtitle, stickerDiv);\n    }\n\n    if(listElements) {\n      elements.push(\n        ...listElements.map((elem) => {\n          const span = document.createElement('span');\n          span.classList.add(BASE_CLASS + '-list-item');\n          span.append(elem);\n          return span;\n        })\n      );\n\n      if(type === 'group') {\n        listElements.forEach((elem) => {\n          const i = document.createElement('span');\n          i.classList.add('tgico-check');\n          elem.prepend(i);\n        });\n      } else if(type === 'saved') {\n        listElements.forEach((elem) => {\n          const i = document.createElement('span');\n          i.classList.add(BASE_CLASS + '-list-bullet');\n          i.innerText = '';\n          elem.prepend(i);\n        });\n      }\n    }\n\n    if(elements.length > 1) {\n      bubble.classList.add('has-description');\n    }\n\n    elements.forEach((element: any) => element.classList.add(BASE_CLASS + '-line'));\n  }\n\n  private async processLocalMessageRender(message: Message.message | Message.messageService, animate?: boolean) {\n    const isSponsored = !!(message as Message.message).pFlags.sponsored;\n    const middleware = this.getMiddleware();\n    const m = middlewarePromise(middleware);\n    return this.safeRenderMessage(message, isSponsored ? false : true, undefined, isSponsored, async(result) => {\n      const {bubble} = await m(result);\n      if(!bubble) {\n        return result;\n      }\n\n      bubble.classList.add('is-group-last', 'is-group-first');\n\n      const updatePosition = () => {\n        if(this.updatePlaceholderPosition === updatePosition) {\n          this.updatePlaceholderPosition = undefined;\n        }\n\n        appendTo[method](bubble);\n      };\n\n      if(!isSponsored) {\n        bubble.classList.add('bubble-first');\n        bubble.classList.remove('can-have-tail', 'is-in');\n      }\n\n      const elements: (Node | string)[] = [];\n      const isBot = this.chat.isBot;\n      let renderPromise: Promise<any>, appendTo = this.container, method: 'append' | 'prepend' = 'append';\n      if(this.chat.isRestricted) {\n        renderPromise = this.renderEmptyPlaceholder('restricted', bubble, message, elements);\n      } else if(isSponsored) {\n        let text: LangPackKey, mid: number, startParam: string, callback: () => void;\n\n        bubble.classList.add('avoid-selection');\n\n        const sponsoredMessage = this.sponsoredMessage = (message as Message.message).sponsoredMessage;\n        const peerId = getPeerId(sponsoredMessage.from_id);\n        // const peer = this.appPeersManager.getPeer(peerId);\n        if(sponsoredMessage.channel_post) {\n          text = 'OpenChannelPost';\n          mid = generateMessageId(sponsoredMessage.channel_post);\n        } else if(sponsoredMessage.start_param || isBot) {\n          text = 'Chat.Message.ViewBot';\n          startParam = sponsoredMessage.start_param;\n        } else {\n          text = await this.managers.appPeersManager.isAnyGroup(peerId) ? 'Chat.Message.ViewGroup' : 'Chat.Message.ViewChannel';\n        }\n\n        if(sponsoredMessage.chat_invite) {\n          callback = () => {\n            new PopupJoinChatInvite(sponsoredMessage.chat_invite_hash, sponsoredMessage.chat_invite as ChatInvite.chatInvite);\n          };\n        } else if(sponsoredMessage.chat_invite_hash) {\n          callback = () => {\n            const link: InternalLink = {\n              _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n              invite: sponsoredMessage.chat_invite_hash\n            };\n\n            this.chat.appImManager.processInternalLink(link);\n          };\n        } else {\n          callback = () => {\n            this.chat.appImManager.setInnerPeer({\n              peerId,\n              lastMsgId: mid,\n              startParam\n            });\n          };\n        }\n\n        const button = Button('btn-primary btn-primary-transparent bubble-view-button', {\n          text\n        });\n\n        this.observer.observe(button, this.viewsObserverCallback);\n\n        if(callback) {\n          attachClickEvent(button, callback);\n        }\n\n        bubble.querySelector('.bubble-content').prepend(button);\n\n        return result;\n      } else if(isBot && message._ === 'message') {\n        const b = document.createElement('b');\n        b.append(i18n('BotInfoTitle'));\n        elements.push(b, '\\n\\n');\n        appendTo = this.chatInner;\n        method = 'prepend';\n      } else if(await m(this.managers.appPeersManager.isAnyGroup(this.peerId)) && (await m(this.managers.appPeersManager.getPeer(this.peerId))).pFlags.creator) {\n        renderPromise = this.renderEmptyPlaceholder('group', bubble, message, elements);\n      } else if(this.chat.type === 'scheduled') {\n        renderPromise = this.renderEmptyPlaceholder('noScheduledMessages', bubble, message, elements);\n      } else if(rootScope.myId === this.peerId) {\n        renderPromise = this.renderEmptyPlaceholder('saved', bubble, message, elements);\n      } else if(this.peerId.isUser() && !isBot && await m(this.chat.canSend()) && this.chat.type === 'chat') {\n        renderPromise = this.renderEmptyPlaceholder('greeting', bubble, message, elements);\n      } else {\n        renderPromise = this.renderEmptyPlaceholder('noMessages', bubble, message, elements);\n      }\n\n      if(renderPromise) {\n        await renderPromise;\n      }\n\n      if(elements.length) {\n        const messageDiv = bubble.querySelector('.message, .service-msg');\n        messageDiv.prepend(...elements);\n      }\n\n      const isWaitingForAnimation = !!this.messagesQueueOnRenderAdditional;\n      const noTransition = this.setPeerCached && !isWaitingForAnimation;\n      if(noTransition) {\n        const setOn = bubble.firstElementChild;\n        setOn.classList.add('no-transition');\n\n        if(this.chat.setPeerPromise) {\n          this.chat.setPeerPromise.catch(noop).finally(() => {\n            setOn.classList.remove('no-transition');\n          });\n        }\n      }\n\n      if(animate === undefined && !noTransition) {\n        animate = true;\n      }\n\n      if(isWaitingForAnimation || animate) {\n        this.updatePlaceholderPosition = updatePosition;\n\n        this.onAnimateLadder = () => {\n          // appendTo[method](bubble);\n          this.onAnimateLadder = undefined;\n\n          // need raf here because animation won't fire if this message is single\n          if(!this.messagesQueuePromise) {\n            return fastRafPromise();\n          }\n        };\n      } else if(this.chat.setPeerPromise) {\n        this.attachPlaceholderOnRender = () => {\n          this.attachPlaceholderOnRender = undefined;\n          updatePosition();\n          // appendTo[method](bubble);\n        };\n      } else {\n        this.updatePlaceholderPosition = updatePosition;\n        // appendTo[method](bubble);\n      }\n\n      if(!isWaitingForAnimation && animate) {\n        await m(getHeavyAnimationPromise());\n        const additionMsgIds = getObjectKeysAndSort(this.bubbles);\n        indexOfAndSplice(additionMsgIds, message.mid);\n        this.animateAsLadder(message.mid, additionMsgIds, false, 0, 0);\n      }\n\n      // if(!isSponsored) {\n      this.emptyPlaceholderBubble = bubble;\n      // }\n\n      return result;\n    });\n  }\n\n  private generateLocalMessageId(addOffset = 0) {\n    // const INCREMENT = 0x10;\n    const offset = (this.chat.type === 'scheduled' ? -1 : 0) + addOffset;\n    // offset = generateMessageId(offset);\n    // id: -Math.abs(+this.peerId * INCREMENT + offset),\n    const id = -Math.abs(offset);\n    const mid = -Math.abs(generateMessageId(id));\n    return {id, mid};\n  }\n\n  private async generateLocalFirstMessage<T extends boolean>(service?: T, fill?: (message: GenerateLocalMessageType<T>) => void, addOffset = 0): Promise<GenerateLocalMessageType<T>> {\n    const {id, mid} = this.generateLocalMessageId(addOffset);\n    let message: Omit<Message.message | Message.messageService, 'message'> & {message?: string} = {\n      _: service ? 'messageService' : 'message',\n      date: 0,\n      id,\n      mid,\n      peer_id: await this.managers.appPeersManager.getOutputPeer(this.peerId),\n      pFlags: {\n        local: true\n      }\n    };\n\n    if(!service) {\n      message.message = '';\n    }/*  else {\n      (message as Message.messageService).action = {} as any;\n    } */\n\n    assumeType<GenerateLocalMessageType<T>>(message);\n\n    fill && fill(message);\n\n    const savedMessages = await this.managers.appMessagesManager.saveMessages([message], {storage: new Map() as any});\n    message = savedMessages[0];\n    message.mid = mid;\n    return message as any;\n  }\n\n  public getViewportSlice() {\n    // this.log.trace('viewport slice');\n    return getViewportSlice({\n      overflowElement: this.scrollable.container,\n      selector: '.bubbles-date-group .bubble:not(.is-date)',\n      extraSize: Math.max(700, windowSize.height) * 2\n    });\n  }\n\n  public deleteViewportSlice(slice: ReturnType<ChatBubbles['getViewportSlice']>, ignoreScrollSaving?: boolean) {\n    if(DO_NOT_SLICE_VIEWPORT_ON_RENDER) {\n      return;\n    }\n\n    const {invisibleTop, invisibleBottom} = slice;\n    const invisible = invisibleTop.concat(invisibleBottom);\n    if(!invisible.length) {\n      return;\n    }\n\n    if(invisibleTop.length) {\n      this.setLoaded('top', false);\n      this.getHistoryTopPromise = undefined;\n    }\n\n    if(invisibleBottom.length) {\n      this.setLoaded('bottom', false);\n      this.getHistoryBottomPromise = undefined;\n    }\n\n    const mids = invisible.map(({element}) => +element.dataset.mid);\n\n    let scrollSaver: ScrollSaver;\n    if(/* !!invisibleTop.length !== !!invisibleBottom.length &&  */!ignoreScrollSaving) {\n      scrollSaver = this.createScrollSaver(!!invisibleTop.length);\n      scrollSaver.save();\n    }\n\n    this.deleteMessagesByIds(mids, false, true);\n\n    if(scrollSaver) {\n      scrollSaver.restore();\n    } else if(invisibleTop.length) {\n      this.scrollable.lastScrollPosition = this.scrollable.scrollTop;\n    }\n  }\n\n  public sliceViewport(ignoreHeavyAnimation?: boolean) {\n    // Safari cannot reset the scroll.\n    if(IS_SAFARI || (this.isHeavyAnimationInProgress && !ignoreHeavyAnimation) || DO_NOT_SLICE_VIEWPORT) {\n      return;\n    }\n\n    // const scrollSaver = new ScrollSaver(this.scrollable, true);\n    // scrollSaver.save();\n    const slice = this.getViewportSlice();\n    // if(IS_SAFARI) slice.invisibleTop = [];\n    this.deleteViewportSlice(slice);\n    // scrollSaver.restore();\n  }\n\n  private async setLoaded(side: SliceSides, value: boolean, checkPlaceholders = true) {\n    const willChange = this.scrollable.loadedAll[side] !== value;\n    if(!willChange) {\n      return;\n    }\n\n    const log = this.log.bindPrefix('setLoaded');\n    log('change', side, value);\n\n    this.scrollable.loadedAll[side] = value;\n    this.scrollable.onScroll(); // ! WARNING\n    // return;\n\n    if(!checkPlaceholders) {\n      return;\n    }\n\n    if(!this.chat.isRestricted) {\n      if(side === 'bottom' && this.chat.isBroadcast/*  && false */) {\n        this.toggleSponsoredMessage(value);\n      }\n\n      if(side === 'top' && value && this.chat.isBot) {\n        return this.renderBotPlaceholder();\n      }\n    }\n\n    return this.checkIfEmptyPlaceholderNeeded();\n  }\n\n  private async toggleSponsoredMessage(value: boolean) {\n    const _log = this.log.bindPrefix('sponsored');\n    _log('checking');\n    const {mid} = this.generateLocalMessageId(SPONSORED_MESSAGE_ID_OFFSET);\n    if(value) {\n      const middleware = this.getMiddleware(() => {\n        return this.scrollable.loadedAll.bottom && !this.bubbles[mid] && this.getSponsoredMessagePromise === promise;\n      });\n\n      const promise = this.getSponsoredMessagePromise = this.managers.appChatsManager.getSponsoredMessage(this.peerId.toChatId())\n      .then(async(sponsoredMessages) => {\n        const sponsoredMessage = sponsoredMessages.messages[0];\n        if(!sponsoredMessage) {\n          _log('no message');\n          return;\n        }\n\n        const messagePromise = this.generateLocalFirstMessage(false, (message) => {\n          message.message = sponsoredMessage.message;\n          message.from_id = sponsoredMessage.from_id;\n          message.entities = sponsoredMessage.entities;\n          message.pFlags.sponsored = true;\n          message.sponsoredMessage = sponsoredMessage;\n        }, SPONSORED_MESSAGE_ID_OFFSET);\n\n        return Promise.all([\n          messagePromise,\n          this.getHistoryTopPromise, // wait for top load and execute rendering after or with it\n          this.messagesQueuePromise\n        ]).then(([message]) => {\n          if(!middleware()) return;\n          // this.processLocalMessageRender(message);\n          _log('rendering', message);\n          const promise = this.performHistoryResult({history: [message]}, false);\n        });\n      }).finally(() => {\n        this.getSponsoredMessagePromise = undefined;\n      });\n    } else {\n      _log('clearing rendered', mid);\n      this.deleteMessagesByIds([mid]);\n      this.getSponsoredMessagePromise = undefined;\n    }\n  }\n\n  private async renderBotPlaceholder() {\n    const _log = this.log.bindPrefix('bot placeholder');\n\n    const middleware = this.getMiddleware();\n    const result = await this.managers.acknowledged.appProfileManager.getProfile(this.peerId.toUserId());\n    _log('getting profile, cached:', result.cached);\n    const processPromise = result.result.then(async(userFull) => {\n      if(!middleware()) {\n        return;\n      }\n\n      if(!userFull.bot_info?.description) {\n        _log.warn('no description');\n        return this.checkIfEmptyPlaceholderNeeded();\n      }\n\n      const message = await this.generateLocalFirstMessage(false, (message) => {\n        const botInfo = userFull.bot_info;\n        message.message = botInfo.description;\n        if(botInfo.description_document) message.media = {_: 'messageMediaDocument', document: botInfo.description_document};\n        if(botInfo.description_photo) message.media = {_: 'messageMediaPhoto', photo: botInfo.description_photo};\n      });\n\n      if(!middleware()) {\n        return;\n      }\n\n      _log('rendering');\n      const renderPromise = this.processLocalMessageRender(message, !result.cached).then(() => {\n        _log('done');\n      });\n\n      return {renderPromise};\n    });\n\n    if(!result.cached) {\n      return;\n    }\n\n    return processPromise;\n  }\n\n  public async checkIfEmptyPlaceholderNeeded() {\n    if(this.scrollable.loadedAll.top &&\n      this.scrollable.loadedAll.bottom &&\n      this.emptyPlaceholderBubble === undefined &&\n      (\n        this.chat.isRestricted ||\n        !(await this.chat.getHistoryStorage()).count ||\n        (\n          !Object.keys(this.bubbles).length ||\n          // ! WARNING ! ! ! ! ! ! REPLACE LINE ABOVE WITH THESE\n          Object.keys(this.bubbles).length &&\n          !this.getRenderedLength()\n        ) ||\n        (this.chat.type === 'scheduled' && !Object.keys(this.bubbles).length)\n      )\n    ) {\n      this.log('inject empty peer placeholder');\n\n      const message = await this.generateLocalFirstMessage(true);\n      return {renderPromise: this.processLocalMessageRender(message)};\n    }\n  }\n\n  public getHistory1(maxId?: number, reverse?: boolean, isBackLimit?: boolean, additionMsgId?: number, justLoad?: boolean) {\n    const middleware = this.getMiddleware(justLoad ? undefined : () => {\n      return (reverse ? this.getHistoryTopPromise : this.getHistoryBottomPromise) === waitPromise;\n    });\n\n    const result = this.getHistory(maxId, reverse, isBackLimit, additionMsgId, justLoad, middleware);\n    const waitPromise = result.then((res) => res && (res.waitPromise || res.promise));\n\n    (reverse ? this.getHistoryTopPromise = waitPromise : this.getHistoryBottomPromise = waitPromise);\n    waitPromise.then(() => {\n      if(!middleware()) {\n        return;\n      }\n\n      (reverse ? this.getHistoryTopPromise = undefined : this.getHistoryBottomPromise = undefined);\n\n      if(!justLoad) {\n        // preload more\n        // if(!isFirstMessageRender) {\n        if(this.chat.type === 'chat'/*  || this.chat.type === 'discussion' */) {\n          /* const storage = this.appMessagesManager.getHistoryStorage(peerId, this.chat.threadId);\n            const isMaxIdInHistory = storage.history.indexOf(maxId) !== -1;\n            if(isMaxIdInHistory || true) { // * otherwise it is a search or jump */\n          setTimeout(() => {\n            if(reverse) {\n              this.loadMoreHistory(true, true);\n            } else {\n              this.loadMoreHistory(false, true);\n            }\n          }, 0);\n          // }\n        }\n        // }\n\n        // this.scrollable.onScroll();\n      }\n    });\n\n    return result;\n  }\n\n  /**\n   * Load and render history\n   * @param maxId max message id\n   * @param reverse 'true' means up\n   * @param isBackLimit is search\n   * @param additionMsgId for the last message\n   * @param justLoad do not render\n   */\n  public async getHistory(\n    maxId = 0,\n    reverse = false,\n    isBackLimit = false,\n    additionMsgId = 0,\n    justLoad = false,\n    middleware?: () => boolean\n  ): Promise<{cached: boolean, promise: Promise<void>, waitPromise: Promise<any>}> {\n    const peerId = this.peerId;\n\n    const isBroadcast = this.chat.isBroadcast;\n    // console.time('appImManager call getHistory');\n    const pageCount = Math.min(30, windowSize.height / 40/*  * 1.25 */ | 0);\n    // const loadCount = Object.keys(this.bubbles).length > 0 ? 50 : pageCount;\n    const realLoadCount = isBroadcast ? 20 : (Object.keys(this.bubbles).length > 0 ? Math.max(35, pageCount) : pageCount);\n    // const realLoadCount = pageCount;//const realLoadCount = 50;\n    let loadCount = realLoadCount;\n\n    /* if(TEST_SCROLL) {\n      //loadCount = 1;\n      if(Object.keys(this.bubbles).length > 0)\n      return {cached: false, promise: Promise.resolve(true)};\n    } */\n    if(TEST_SCROLL !== undefined) {\n      if(TEST_SCROLL) {\n        if(Object.keys(this.bubbles).length > 0) {\n          --TEST_SCROLL;\n        }\n      } else {\n        return {cached: false, promise: Promise.resolve(), waitPromise: Promise.resolve()};\n      }\n    }\n\n    // //console.time('render history total');\n\n    let backLimit = 0;\n    if(isBackLimit) {\n      backLimit = loadCount;\n\n      if(!reverse) { // if not jump\n        loadCount = 0;\n        // maxId = this.appMessagesManager.incrementMessageId(maxId, 1);\n      }\n    }\n\n    let additionMsgIds: number[];\n    if(additionMsgId && !isBackLimit) {\n      if(this.chat.type === 'pinned') {\n        additionMsgIds = [additionMsgId];\n      } else {\n        const historyStorage = await this.chat.getHistoryStorage();\n        const slice = historyStorage.history.slice;\n        if(slice.length < loadCount && !slice.isEnd(SliceEnd.Both)) {\n          additionMsgIds = slice.slice();\n\n          // * filter last album, because we don't know is it the last item\n          for(let i = additionMsgIds.length - 1; i >= 0; --i) {\n            const message = await this.chat.getMessage(additionMsgIds[i]);\n            if((message as Message.message)?.grouped_id) additionMsgIds.splice(i, 1);\n            else break;\n          }\n\n          maxId = additionMsgIds[additionMsgIds.length - 1] || maxId;\n        }\n      }\n    }\n\n    /* const result = additionMsgID ?\n      {history: [additionMsgID]} :\n      appMessagesManager.getHistory(this.peerId, maxId, loadCount, backLimit); */\n    let result: AckedResult<MyHistoryResult> = await this.requestHistory(maxId, loadCount, backLimit) as any;\n    let resultPromise: typeof result['result'];\n\n    // const isFirstMessageRender = !!additionMsgID && result.cached && !appMessagesManager.getMessage(additionMsgID).grouped_id;\n    const isAdditionRender = additionMsgIds?.length && !result.cached;\n    const isFirstMessageRender = (this.isFirstLoad && backLimit && !result.cached) || isAdditionRender;\n    if(isAdditionRender) {\n      resultPromise = result.result;\n\n      result = {\n        cached: true,\n        result: Promise.resolve({history: additionMsgIds})\n      };\n\n      // additionMsgID = 0;\n    }\n\n    this.isFirstLoad = false;\n\n    const processResult = async(historyResult: Awaited<typeof result['result']>) => {\n      if((historyResult as HistoryResult).isEnd?.top) {\n        if(this.chat.type === 'discussion') { // * inject discussion start\n          const serviceStartMessageId = await this.managers.appMessagesManager.getThreadServiceMessageId(this.peerId, this.chat.threadId);\n          if(serviceStartMessageId) historyResult.history.push(serviceStartMessageId);\n          const mids = await this.chat.getMidsByMid(this.chat.threadId);\n          historyResult.history.push(...mids.reverse());\n        }\n\n        // synchronize bot placeholder appearance\n        await this.managers.appProfileManager.getProfileByPeerId(peerId);\n\n        // await this.setLoaded('top', true);\n      }\n    };\n\n    const sup = (historyResult: Awaited<typeof result['result']>) => {\n      return getHeavyAnimationPromise().then(() => {\n        return processResult(historyResult);\n      }).then(() => {\n        if(!isAdditionRender && additionMsgId) {\n          historyResult.history.unshift(additionMsgId);\n        }\n\n        return this.performHistoryResult(historyResult, reverse);\n      });\n    };\n\n    const processPromise = (_promise: typeof result['result']) => {\n      const promise = Promise.resolve(_promise).then((result) => {\n        if(middleware && !middleware()) {\n          throw PEER_CHANGED_ERROR;\n        }\n\n        if(justLoad) {\n          //   -  \n          this.scrollable.onScroll();\n          // fastRaf(() => {\n          //   this.scrollable.checkForTriggers();\n          // });\n          return;\n        }\n\n        return sup(result);\n      }, (err) => {\n        this.log.error('getHistory error:', err);\n        throw err;\n      });\n\n      return promise;\n    };\n\n    let promise: Promise<void>, cached: boolean;\n    if(!result.cached) {\n      cached = false;\n      promise = processPromise(result.result);\n    } else if(justLoad) {\n      //   -  \n      this.scrollable.onScroll();\n      return null;\n    } else {\n      cached = true;\n      promise = sup(await result.result);\n    }\n\n    const waitPromise = isAdditionRender ? processPromise(resultPromise) : promise;\n\n    if(isFirstMessageRender && rootScope.settings.animationsEnabled/*  && false */) {\n      let times = isAdditionRender ? 2 : 1;\n      this.messagesQueueOnRenderAdditional = () => {\n        this.log('messagesQueueOnRenderAdditional');\n\n        if(--times) return;\n\n        this.messagesQueueOnRenderAdditional = undefined;\n\n        const promise = this.animateAsLadder(additionMsgId, additionMsgIds, isAdditionRender, backLimit, maxId);\n        promise.then(() => {\n          setTimeout(() => { // preload messages\n            this.loadMoreHistory(reverse, true);\n          }, 0);\n        });\n      };\n    } else {\n      this.messagesQueueOnRenderAdditional = undefined;\n    }\n\n    if(justLoad) {\n      return null;\n    }\n\n    return {cached, promise, waitPromise};\n  }\n\n  public async setUnreadDelimiter() {\n    if(!(this.chat.type === 'chat' || this.chat.type === 'discussion')) {\n      return;\n    }\n\n    if(this.attachedUnreadBubble) {\n      return;\n    }\n\n    const historyMaxId = await this.chat.getHistoryMaxId();\n    let readMaxId = await this.managers.appMessagesManager.getReadMaxIdIfUnread(this.peerId, this.chat.threadId);\n    if(!readMaxId) return;\n\n    readMaxId = Object.keys(this.bubbles)\n    .filter((mid) => !this.bubbles[mid].classList.contains('is-out'))\n    .map((i) => +i)\n    .sort((a, b) => a - b)\n    .find((i) => i > readMaxId);\n\n    if(readMaxId && this.bubbles[readMaxId]) {\n      const bubble = this.bubbles[readMaxId];\n      if(this.firstUnreadBubble && this.firstUnreadBubble !== bubble) {\n        this.firstUnreadBubble.classList.remove('is-first-unread');\n        this.firstUnreadBubble = null;\n      }\n\n      if(readMaxId !== historyMaxId) {\n        bubble.classList.add('is-first-unread');\n      }\n\n      this.firstUnreadBubble = bubble;\n      this.attachedUnreadBubble = true;\n    }\n  }\n\n  public deleteEmptyDateGroups() {\n    const mustBeCount = this.stickyIntersector ? STICKY_OFFSET : 1;\n    let deleted = false;\n    for(const i in this.dateMessages) {\n      const dateMessage = this.dateMessages[i];\n\n      if(dateMessage.container.childElementCount === mustBeCount) { // only date div + sentinel div\n        dateMessage.container.remove();\n        if(this.stickyIntersector) {\n          this.stickyIntersector.unobserve(dateMessage.container, dateMessage.div);\n        }\n        delete this.dateMessages[i];\n        deleted = true;\n\n        // * no sense in it\n        /* if(dateMessage.div === this.previousStickyDate) {\n          this.previousStickyDate = undefined;\n        } */\n      }\n    }\n\n    if(!deleted) {\n      return;\n    }\n\n    if(!Object.keys(this.dateMessages).length) {\n      this.container.classList.remove('has-groups');\n    }\n\n    this.checkIfEmptyPlaceholderNeeded();\n    this.setStickyDateManually();\n  }\n}\n\nexport function generateTail() {\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.setAttributeNS(null, 'viewBox', '0 0 11 20');\n  svg.setAttributeNS(null, 'width', '11');\n  svg.setAttributeNS(null, 'height', '20');\n  svg.classList.add('bubble-tail');\n\n  const use = document.createElementNS('http://www.w3.org/2000/svg', 'use');\n  use.setAttributeNS(null, 'href', '#message-tail-filled');\n\n  svg.append(use);\n\n  return svg;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {copyTextToClipboard} from '../clipboard';\n// import SelectionSaver from \"../selectionSaver\";\n// import selectElementContents from \"./selectElementContents\";\n\nexport default function copyFromElement(element: HTMLElement) {\n  copyTextToClipboard(element.textContent);\n  // const saver = new SelectionSaver();\n  // saver.save();\n  // selectElementContents(element);\n  // document.execCommand('copy');\n  // saver.restore();\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {MediaSizeType} from '../../helpers/mediaSizes';\nimport {Message} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\nimport {MediaSearchContext} from '../appMediaPlaybackController';\nimport Chat from '../chat/chat';\nimport LazyLoadQueue from '../lazyLoadQueue';\nimport wrapDocument from './document';\n\nexport default async function wrapGroupedDocuments({albumMustBeRenderedFull, message, bubble, messageDiv, chat, loadPromises, autoDownloadSize, lazyLoadQueue, searchContext, useSearch, sizeType, managers}: {\n  albumMustBeRenderedFull: boolean,\n  message: any,\n  messageDiv: HTMLElement,\n  bubble: HTMLElement,\n  uploading?: boolean,\n  chat: Chat,\n  loadPromises?: Promise<any>[],\n  autoDownloadSize?: number,\n  lazyLoadQueue?: LazyLoadQueue,\n  searchContext?: MediaSearchContext,\n  useSearch?: boolean,\n  sizeType?: MediaSizeType,\n  managers?: AppManagers\n}) {\n  let nameContainer: HTMLElement;\n  const mids = albumMustBeRenderedFull ? await chat.getMidsByMid(message.mid) : [message.mid];\n  /* if(isPending) {\n    mids.reverse();\n  } */\n\n  const promises = mids.map(async(mid, idx) => {\n    const message = (await chat.getMessage(mid)) as Message.message;\n    const div = await wrapDocument({\n      message,\n      loadPromises,\n      autoDownloadSize,\n      lazyLoadQueue,\n      searchContext,\n      sizeType,\n      managers\n    });\n\n    const container = document.createElement('div');\n    container.classList.add('document-container');\n    container.dataset.mid = '' + mid;\n    container.dataset.peerId = '' + message.peerId;\n\n    const wrapper = document.createElement('div');\n    wrapper.classList.add('document-wrapper');\n\n    if(message.message) {\n      const messageDiv = document.createElement('div');\n      messageDiv.classList.add('document-message');\n\n      const richText = wrapRichText(message.message, {\n        entities: message.totalEntities\n      });\n\n      setInnerHTML(messageDiv, richText);\n      wrapper.append(messageDiv);\n    }\n\n    if(mids.length > 1) {\n      const selection = document.createElement('div');\n      selection.classList.add('document-selection');\n      container.append(selection);\n\n      container.classList.add('grouped-item');\n\n      if(idx === 0) {\n        nameContainer = wrapper;\n      }\n    }\n\n    wrapper.append(div);\n    container.append(wrapper);\n    return container;\n  });\n\n  const containers = await Promise.all(promises);\n  messageDiv.append(...containers);\n\n  if(mids.length > 1) {\n    bubble.classList.add('is-multiple-documents', 'is-grouped');\n  }\n\n  return nameContainer;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport rootScope from '../../lib/rootScope';\nimport PollElement from '../poll';\n\nexport default function wrapPoll(message: any, managers: AppManagers = rootScope.managers) {\n  const elem = new PollElement();\n  elem.message = message;\n  elem.managers = managers;\n  elem.setAttribute('peer-id', '' + message.peerId);\n  elem.setAttribute('poll-id', message.media.poll.id);\n  elem.setAttribute('message-id', '' + message.mid);\n  elem.render();\n  return elem;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement, {addCancelButton} from '.';\nimport PopupPeer, {PopupPeerButtonCallbackCheckboxes, PopupPeerOptions} from './peer';\nimport rootScope from '../../lib/rootScope';\nimport {FormatterArguments, LangPackKey} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\n\nexport default class PopupPinMessage {\n  constructor(private peerId: PeerId, private mid: number, private unpin?: true, private onConfirm?: () => void) {\n    this.construct();\n  }\n\n  private async construct() {\n    const {peerId, mid, unpin, onConfirm} = this;\n    let title: LangPackKey, description: LangPackKey, descriptionArgs: FormatterArguments;\n    const buttons: PopupPeerOptions['buttons'] = [], checkboxes: PopupPeerOptions['checkboxes'] = [];\n\n    const managers = PopupElement.MANAGERS;\n\n    const canUnpin = await managers.appPeersManager.canPinMessage(peerId);\n\n    const callback = (checked: PopupPeerButtonCallbackCheckboxes, oneSide?: boolean, silent?: boolean) => {\n      setTimeout(() => { // * ,   document.elementFromPoint  popup-peer    \n        let promise: Promise<any>;\n        if(unpin && !mid) {\n          if(canUnpin) {\n            promise = managers.appMessagesManager.unpinAllMessages(peerId);\n          } else {\n            promise = managers.appMessagesManager.hidePinnedMessages(peerId);\n          }\n        } else {\n          promise = managers.appMessagesManager.updatePinnedMessage(peerId, mid, unpin, silent, oneSide);\n        }\n\n        if(onConfirm) {\n          promise.then(onConfirm);\n        }\n      }, 300);\n    };\n\n    if(unpin) {\n      let buttonText: LangPackKey = 'UnpinMessage';\n      if(!mid) {\n        if(canUnpin) {\n          title = 'Popup.Unpin.AllTitle';\n          description = 'Chat.UnpinAllMessagesConfirmation';\n          descriptionArgs = ['' + ((await managers.appMessagesManager.getPinnedMessagesCount(peerId)) || 1)];\n        } else {\n          title = 'Popup.Unpin.HideTitle';\n          description = 'Popup.Unpin.HideDescription';\n          buttonText = 'Popup.Unpin.Hide';\n        }\n      } else {\n        title = 'UnpinMessageAlertTitle';\n        description = 'Chat.Confirm.Unpin';\n      }\n\n      buttons.push({\n        langKey: buttonText,\n        isDanger: true,\n        callback\n      });\n    } else {\n      title = 'PinMessageAlertTitle';\n      const pinButtonText: LangPackKey = 'PinMessage';\n\n      if(peerId.isAnyChat()) {\n        buttons.push({\n          langKey: pinButtonText,\n          callback: (checked) => callback(checked, false, !checked.size)\n        });\n\n        if(await managers.appChatsManager.isBroadcast(peerId.toChatId())) {\n          description = 'PinMessageAlertChannel';\n        } else {\n          description = 'PinMessageAlert';\n\n          checkboxes.push({\n            text: 'PinNotify',\n            checked: true\n          });\n        }\n      } else {\n        description = 'PinMessageAlertChat';\n\n        if(peerId === rootScope.myId) {\n          buttons.push({\n            langKey: pinButtonText,\n            callback\n          });\n        } else {\n          buttons.push({\n            langKey: pinButtonText,\n            callback: (checked) => callback(checked, !checked.size)\n          });\n\n          checkboxes.push({\n            text: 'PinAlsoFor',\n            textArgs: [new PeerTitle({peerId}).element],\n            checked: true\n          });\n        }\n      }\n    }\n\n    addCancelButton(buttons);\n\n    const popup = new PopupPeer('popup-delete-chat', {\n      peerId,\n      titleLangKey: title,\n      descriptionLangKey: description,\n      descriptionLangArgs: descriptionArgs,\n      buttons,\n      checkboxes\n    });\n\n    popup.show();\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function isSelectionEmpty(selection = window.getSelection()) {\r\n  if(!selection || !selection.rangeCount) {\r\n    return true;\r\n  }\r\n\r\n  const selectionRange = selection.getRangeAt(0);\r\n  if(!selectionRange.toString() || !selectionRange.START_TO_END) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport appDownloadManager from '../lib/appManagers/appDownloadManager';\nimport lottieLoader from '../lib/rlottie/lottieLoader';\nimport rootScope from '../lib/rootScope';\nimport {getEmojiToneIndex} from '../vendor/emoji';\nimport mediaSizes from './mediaSizes';\nimport {saveLottiePreview} from './saveLottiePreview';\n\nexport default function preloadAnimatedEmojiSticker(emoji: string, width?: number, height?: number) {\n  return rootScope.managers.appStickersManager.preloadAnimatedEmojiSticker(emoji).then(({doc}) => {\n    if(!doc) {\n      return;\n    }\n\n    return appDownloadManager.downloadMedia({media: doc})\n    .then(async(blob) => {\n      const mediaSize = mediaSizes.active.emojiSticker;\n      const toneIndex = getEmojiToneIndex(emoji);\n      const animation = await lottieLoader.loadAnimationWorker({\n        container: undefined,\n        animationData: blob,\n        width: width ?? mediaSize.width,\n        height: height ?? mediaSize.height,\n        name: 'doc' + doc.id,\n        autoplay: false,\n        loop: false,\n        toneIndex\n      }, 'none');\n\n      animation.addEventListener('firstFrame', () => {\n        saveLottiePreview(doc, animation.canvas[0], toneIndex);\n        animation.remove();\n      }, {once: true});\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {ReportReason} from '../../layer';\nimport InputField from '../inputField';\nimport {toastNew} from '../toast';\nimport wrapStickerEmoji from '../wrappers/stickerEmoji';\nimport PopupPeer from './peer';\n\nexport default class PopupReportMessagesConfirm extends PopupPeer {\n  public static STICKER_EMOJI = '';\n  constructor(peerId: PeerId, mids: number[], reason: ReportReason['_'], onConfirm?: () => void) {\n    super('popup-report-messages-confirm', {\n      noTitle: true,\n      descriptionLangKey: 'ReportInfo',\n      buttons: [{\n        langKey: 'ReportChat',\n        callback: () => {\n          if(!inputField.isValid()) {\n            return;\n          }\n\n          onConfirm && onConfirm();\n          this.managers.appMessagesManager.reportMessages(peerId, mids, reason, inputField.value).then((bool) => {\n            if(!bool) return;\n\n            toastNew({\n              langPackKey: 'ReportSentInfo'\n            });\n          });\n        }\n      }],\n      body: true\n    });\n\n    const div = document.createElement('div');\n    const size = 100;\n    wrapStickerEmoji({\n      div,\n      emoji: PopupReportMessagesConfirm.STICKER_EMOJI,\n      width: size,\n      height: size\n    }).then(({render}) => render).finally(() => {\n      this.show();\n    });\n\n    this.header.append(div);\n\n    const inputField = new InputField({\n      label: 'ReportHint',\n      maxLength: 512,\n      placeholder: 'ReportChatDescription'\n    });\n\n    inputField.input.addEventListener('input', () => {\n      this.buttons[0].element.toggleAttribute('disabled', !inputField.isValid());\n    });\n\n    this.body.append(inputField.container);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport whichChild from '../../helpers/dom/whichChild';\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\nimport {ReportReason} from '../../layer';\nimport {LangPackKey} from '../../lib/langPack';\nimport Button from '../button';\nimport PopupPeer from './peer';\nimport PopupReportMessagesConfirm from './reportMessagesConfirm';\n\nexport default class PopupReportMessages extends PopupPeer {\n  constructor(peerId: PeerId, mids: number[], onConfirm?: () => void) {\n    super('popup-report-messages', {titleLangKey: 'ChatTitle.ReportMessages', buttons: [], body: true});\n\n    mids = mids.slice();\n\n    const buttons: [LangPackKey, ReportReason['_']][] = [\n      ['ReportChatSpam', 'inputReportReasonSpam'],\n      ['ReportChatViolence', 'inputReportReasonViolence'],\n      ['ReportChatChild', 'inputReportReasonChildAbuse'],\n      ['ReportChatPornography', 'inputReportReasonPornography'],\n      ['ReportChatOther', 'inputReportReasonOther'],\n      ['ReportChatPersonalDetails', 'inputReportReasonPersonalDetails'],\n      ['ReportChatIllegalDrugs', 'inputReportReasonIllegalDrugs']\n    ];\n\n    const className = 'btn-primary btn-transparent';\n    buttons.forEach((b) => {\n      const button = Button(className, {/* icon: 'edit',  */text: b[0]});\n      this.body.append(button);\n    });\n\n    const preloadStickerPromise = preloadAnimatedEmojiSticker(PopupReportMessagesConfirm.STICKER_EMOJI);\n\n    attachClickEvent(this.body, (e) => {\n      const target = findUpClassName(e.target, 'btn-primary');\n      const reason = buttons[whichChild(target)][1];\n\n      preloadStickerPromise.then(() => {\n        this.hide();\n\n        new PopupReportMessagesConfirm(peerId, mids, reason, onConfirm);\n      });\n    }, {listenerSetter: this.listenerSetter});\n\n    this.body.style.margin = '0 -1rem';\n    this.buttonsEl.style.marginTop = '.5rem';\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport I18n, {i18n} from '../../lib/langPack';\nimport PopupPeer from './peer';\n\nexport default class PopupSponsored extends PopupPeer {\n  constructor() {\n    super('popup-sponsored', {\n      titleLangKey: 'Chat.Message.Sponsored.What',\n      descriptionLangKey: 'Chat.Message.Ad.Text',\n      descriptionLangArgs: [i18n('Chat.Message.Sponsored.Link')],\n      buttons: [{\n        langKey: 'OK',\n        isCancel: true\n      }, {\n        langKey: 'Chat.Message.Ad.ReadMore',\n        callback: () => {\n          window.open(I18n.format('Chat.Message.Sponsored.Link', true));\n        },\n        isCancel: true\n      }],\n      scrollable: true\n    });\n\n    this.scrollable.append(this.description);\n\n    this.show();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '.';\nimport {Message, Reaction} from '../../layer';\nimport {SettingSection} from '../sidebarLeft';\nimport ReactionsElement from '../chat/reactions';\nimport {horizontalMenu} from '../horizontalMenu';\nimport Scrollable from '../scrollable';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport appDialogsManager from '../../lib/appManagers/appDialogsManager';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport wrapSticker from '../wrappers/sticker';\nimport ReactionElement from '../chat/reaction';\nimport getUserStatusString from '../wrappers/getUserStatusString';\nimport {makeMediaSize} from '../../helpers/mediaSize';\nimport wrapCustomEmoji from '../wrappers/customEmoji';\n\nexport default class PopupReactedList extends PopupElement {\n  constructor(\n    private message: Message.message\n  ) {\n    super('popup-reacted-list', {closable: true, overlayClosable: true, body: true});\n\n    this.init();\n  }\n\n  private async init() {\n    const middleware = this.middlewareHelper.get();\n    const message = await this.managers.appMessagesManager.getGroupsFirstMessage(this.message);\n    if(!middleware()) return;\n    const canViewReadParticipants = await this.managers.appMessagesManager.canViewMessageReadParticipants(message);\n    if(!middleware()) return;\n    // this.body.append(generateDelimiter());\n\n    const reactionsElement = new ReactionsElement();\n    const newMessage: Message.message = {\n      ...message,\n      mid: 0,\n      id: 0,\n      reactions: {\n        _: 'messageReactions',\n        results: [],\n\n        ...message.reactions,\n\n        pFlags: {},\n        recent_reactions: []\n      }\n    };\n\n    newMessage.reactions.results = newMessage.reactions.results.map((reactionCount) => {\n      return {\n        ...reactionCount,\n        chosen_order: undefined,\n        pFlags: {}\n      };\n    });\n\n    reactionsElement.init(newMessage, 'block', this.middlewareHelper.get());\n    reactionsElement.render();\n    reactionsElement.classList.add('no-stripe');\n    reactionsElement.classList.remove('has-no-reactions');\n\n    reactionsElement.append(this.btnClose);\n\n    this.header.append(reactionsElement);\n\n    const tabsContainer = document.createElement('div');\n    tabsContainer.classList.add('tabs-container');\n    tabsContainer.dataset.animation = 'tabs';\n\n    const loaders: Map<HTMLElement, ScrollableLoader> = new Map();\n\n    let hasAllReactions = false;\n    if(newMessage.reactions.results.length) {\n      const reaction = this.createFakeReaction('reactions', newMessage.reactions.results.reduce((acc, r) => acc + r.count, 0));\n\n      reactionsElement.prepend(reaction);\n      newMessage.reactions.results.unshift(reaction.reactionCount);\n      hasAllReactions = true;\n    }\n\n    let hasReadParticipants = false;\n    if(canViewReadParticipants) {\n      try {\n        const readUserIds = await this.managers.appMessagesManager.getMessageReadParticipants(message.peerId, message.mid);\n        if(!middleware()) return;\n        if(!readUserIds.length) {\n          throw '';\n        }\n\n        const reaction = this.createFakeReaction('checks', readUserIds.length);\n\n        reactionsElement.prepend(reaction);\n        newMessage.reactions.results.unshift(reaction.reactionCount);\n        hasReadParticipants = true;\n      } catch(err) {\n\n      }\n    }\n\n    newMessage.reactions.results.forEach((reactionCount) => {\n      const scrollable = new Scrollable(undefined);\n      scrollable.container.classList.add('tabs-tab');\n\n      const section = new SettingSection({\n        noShadow: true,\n        noDelimiter: true\n      });\n\n      const chatlist = appDialogsManager.createChatList({\n        dialogSize: 72\n      });\n\n      appDialogsManager.setListClickListener(chatlist, () => {\n        this.hide();\n      }, undefined, false, true);\n\n      section.content.append(chatlist);\n      scrollable.container.append(section.container);\n\n      const skipReadParticipants = (reactionCount.reaction as any) !== 'checks';\n      const skipReactionsList = (reactionCount.reaction as any) === 'checks';\n      if(['checks', 'reactions'].includes(reactionCount.reaction as any)) {\n        reactionCount.reaction = undefined;\n      }\n\n      const size = 24;\n      const mediaSize = makeMediaSize(size, size);\n\n      let nextOffset: string;\n      const loader = new ScrollableLoader({\n        scrollable,\n        getPromise: async() => {\n          const result = await this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(message, undefined, reactionCount.reaction, nextOffset, skipReadParticipants, skipReactionsList);\n          nextOffset = result.nextOffset;\n\n          await Promise.all(result.combined.map(async({peerId, reaction}) => {\n            const {dom} = appDialogsManager.addDialogNew({\n              peerId: peerId,\n              autonomous: true,\n              container: chatlist,\n              avatarSize: 54,\n              rippleEnabled: false,\n              meAsSaved: false\n            });\n\n            if(reaction) {\n              const stickerContainer = document.createElement('div');\n              stickerContainer.classList.add('reacted-list-reaction-icon');\n\n              if(reaction._ === 'reactionEmoji') {\n                const availableReaction = await this.managers.appReactionsManager.getReactionCached(reaction.emoticon);\n\n                wrapSticker({\n                  doc: availableReaction.static_icon,\n                  div: stickerContainer,\n                  width: 24,\n                  height: 24,\n                  middleware\n                });\n              } else if(reaction._ === 'reactionCustomEmoji') {\n                stickerContainer.append(wrapCustomEmoji({\n                  docIds: [reaction.document_id],\n                  size: mediaSize,\n                  middleware\n                }));\n              }\n\n              dom.listEl.append(stickerContainer);\n            }\n\n            replaceContent(dom.lastMessageSpan, getUserStatusString(await this.managers.appUsersManager.getUser(peerId.toUserId())));\n          }));\n\n          return !nextOffset;\n        }\n      });\n\n      loaders.set(scrollable.container, loader);\n\n      tabsContainer.append(scrollable.container);\n    });\n\n    this.body.append(tabsContainer);\n\n    const selectTab = horizontalMenu(reactionsElement, tabsContainer, (id, tabContent) => {\n      if(id === (reactionsElement.childElementCount - 1)) {\n        return false;\n      }\n\n      const reaction = reactionsElement.children[id] as ReactionElement;\n      const prevId = selectTab.prevId();\n      if(prevId !== -1) {\n        (reactionsElement.children[prevId] as ReactionElement).setIsChosen(false);\n      }\n\n      reaction.setIsChosen(true);\n\n      const loader = loaders.get(tabContent);\n      loader.load();\n    }, undefined, undefined, undefined, this.listenerSetter);\n\n    // selectTab(hasAllReactions && hasReadParticipants ? 1 : 0, false);\n    selectTab(0, false);\n\n    this.show();\n  }\n\n  private createFakeReaction(icon: string, count: number) {\n    const reaction = new ReactionElement();\n    reaction.init('block', this.middlewareHelper.get());\n    reaction.reactionCount = {\n      _: 'reactionCount',\n      count: count,\n      reaction: icon as any\n    };\n    reaction.setCanRenderAvatars(false);\n    reaction.renderCounter();\n\n    const allReactionsSticker = document.createElement('div');\n    allReactionsSticker.classList.add('reaction-counter', 'reaction-sticker-icon', 'tgico-' + icon);\n    reaction.prepend(allReactionsSticker);\n\n    return reaction;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport {IS_MOBILE, IS_SAFARI} from '../../environment/userAgent';\nimport assumeType from '../../helpers/assumeType';\nimport callbackify from '../../helpers/callbackify';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {getMiddleware} from '../../helpers/middleware';\nimport noop from '../../helpers/noop';\nimport {fastRaf} from '../../helpers/schedulers';\nimport {Message, AvailableReaction, Reaction} from '../../layer';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport lottieLoader from '../../lib/rlottie/lottieLoader';\nimport RLottiePlayer from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport animationIntersector, {AnimationItemGroup} from '../animationIntersector';\nimport Scrollable, {ScrollableBase, ScrollableX} from '../scrollable';\nimport wrapSticker from '../wrappers/sticker';\n\nconst REACTIONS_CLASS_NAME = 'btn-menu-reactions';\nconst REACTION_CLASS_NAME = REACTIONS_CLASS_NAME + '-reaction';\n\nconst REACTION_SIZE = 26;\nconst PADDING = 4;\nexport const REACTION_CONTAINER_SIZE = REACTION_SIZE + PADDING * 2;\n\nconst CAN_USE_TRANSFORM = !IS_SAFARI;\n\ntype ChatReactionsMenuPlayers = {\n  select?: RLottiePlayer,\n  appear?: RLottiePlayer,\n  selectWrapper: HTMLElement,\n  appearWrapper: HTMLElement,\n  reaction: Reaction\n};\nexport class ChatReactionsMenu {\n  public widthContainer: HTMLElement;\n  public container: HTMLElement;\n  private reactionsMap: Map<HTMLElement, ChatReactionsMenuPlayers>;\n  public scrollable: ScrollableBase;\n  private animationGroup: AnimationItemGroup;\n  private middleware: ReturnType<typeof getMiddleware>;\n  private message: Message.message;\n\n  constructor(\n    private managers: AppManagers,\n    private type: 'horizontal' | 'vertical',\n    middleware: ChatReactionsMenu['middleware']\n  ) {\n    const widthContainer = this.widthContainer = document.createElement('div');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container');\n    widthContainer.classList.add(REACTIONS_CLASS_NAME + '-container-' + type);\n\n    const reactionsContainer = this.container = document.createElement('div');\n    reactionsContainer.classList.add(REACTIONS_CLASS_NAME);\n\n    const reactionsScrollable = this.scrollable = type === 'vertical' ? new Scrollable(undefined) : new ScrollableX(undefined);\n    reactionsContainer.append(reactionsScrollable.container);\n    reactionsScrollable.onAdditionalScroll = this.onScroll;\n    reactionsScrollable.setListeners();\n\n    reactionsScrollable.container.classList.add('no-scrollbar');\n\n    // ['big'].forEach((type) => {\n    //   const bubble = document.createElement('div');\n    //   bubble.classList.add(REACTIONS_CLASS_NAME + '-bubble', REACTIONS_CLASS_NAME + '-bubble-' + type);\n    //   reactionsContainer.append(bubble);\n    // });\n\n    this.reactionsMap = new Map();\n    this.animationGroup = `CHAT-MENU-REACTIONS-${Date.now()}`;\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      reactionsContainer.addEventListener('mousemove', this.onMouseMove);\n    }\n\n    attachClickEvent(reactionsContainer, (e) => {\n      const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n      if(!reactionDiv) return;\n\n      const players = this.reactionsMap.get(reactionDiv);\n      if(!players) return;\n\n      this.managers.appReactionsManager.sendReaction(this.message, players.reaction);\n    });\n\n    widthContainer.append(reactionsContainer);\n\n    this.middleware = middleware ?? getMiddleware();\n  }\n\n  public init(message: Message.message) {\n    this.message = message;\n\n    const middleware = this.middleware.get();\n    // const result = Promise.resolve(this.appReactionsManager.getAvailableReactionsForPeer(message.peerId)).then((res) => pause(1000).then(() => res));\n    const result = this.managers.appReactionsManager.getAvailableReactionsByMessage(message);\n    callbackify(result, (reactions) => {\n      if(!middleware() || !reactions.length) return;\n      reactions.forEach((reaction) => {\n        if(reaction.pFlags.premium && !rootScope.premium) return;\n        this.renderReaction(reaction);\n      });\n\n      const setVisible = () => {\n        this.container.classList.add('is-visible');\n      };\n\n      if(result instanceof Promise) {\n        fastRaf(setVisible);\n      } else {\n        setVisible();\n      }\n    });\n  }\n\n  public cleanup() {\n    this.middleware.clean();\n    this.scrollable.removeListeners();\n    this.reactionsMap.clear();\n    animationIntersector.setOverrideIdleGroup(this.animationGroup, false);\n    animationIntersector.checkAnimations(true, this.animationGroup, true);\n  }\n\n  private onScroll = () => {\n    this.reactionsMap.forEach((players, div) => {\n      this.onScrollProcessItem(div, players);\n    });\n  };\n\n  private canUseAnimations() {\n    return rootScope.settings.animationsEnabled && !IS_MOBILE;\n  }\n\n  private renderReaction(reaction: AvailableReaction) {\n    const reactionDiv = document.createElement('div');\n    reactionDiv.classList.add(REACTION_CLASS_NAME);\n\n    const scaleContainer = document.createElement('div');\n    scaleContainer.classList.add(REACTION_CLASS_NAME + '-scale');\n\n    const appearWrapper = document.createElement('div');\n    let selectWrapper: HTMLElement;;\n    appearWrapper.classList.add(REACTION_CLASS_NAME + '-appear');\n\n    if(this.canUseAnimations()) {\n      selectWrapper = document.createElement('div');\n      selectWrapper.classList.add(REACTION_CLASS_NAME + '-select', 'hide');\n    }\n\n    const players: ChatReactionsMenuPlayers = {\n      selectWrapper,\n      appearWrapper,\n      reaction: {_: 'reactionEmoji', emoticon: reaction.reaction}\n    };\n    this.reactionsMap.set(reactionDiv, players);\n\n    const middleware = this.middleware.get();\n\n    const hoverScale = IS_TOUCH_SUPPORTED ? 1 : 1.25;\n    const size = REACTION_SIZE * hoverScale;\n\n    const options = {\n      width: size,\n      height: size,\n      skipRatio: 1,\n      needFadeIn: false,\n      withThumb: false,\n      group: this.animationGroup,\n      middleware\n    };\n\n    if(!this.canUseAnimations()) {\n      delete options.needFadeIn;\n      delete options.withThumb;\n\n      wrapSticker({\n        doc: reaction.static_icon,\n        div: appearWrapper,\n        ...options\n      });\n    } else {\n      let isFirst = true;\n      wrapSticker({\n        doc: reaction.appear_animation,\n        div: appearWrapper,\n        play: true,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        players.appear = player;\n\n        player.addEventListener('enterFrame', (frameNo) => {\n          if(player.maxFrame === frameNo) {\n            selectLoadPromise.then((selectPlayer) => {\n              assumeType<RLottiePlayer>(selectPlayer);\n              appearWrapper.classList.add('hide');\n              selectWrapper.classList.remove('hide');\n\n              if(isFirst) {\n                players.select = selectPlayer;\n                isFirst = false;\n              }\n            }, noop);\n          }\n        });\n      }, noop);\n\n      const selectLoadPromise = wrapSticker({\n        doc: reaction.select_animation,\n        div: selectWrapper,\n        ...options\n      }).then(({render}) => render).then((player) => {\n        assumeType<RLottiePlayer>(player);\n\n        return lottieLoader.waitForFirstFrame(player);\n      }).catch(noop);\n    }\n\n    scaleContainer.append(appearWrapper);\n    selectWrapper && scaleContainer.append(selectWrapper);\n    reactionDiv.append(scaleContainer);\n    this.scrollable.append(reactionDiv);\n  }\n\n  private onScrollProcessItem(div: HTMLElement, players: ChatReactionsMenuPlayers) {\n    // return;\n\n    const scaleContainer = div.firstElementChild as HTMLElement;\n    const visibleRect = getVisibleRect(div, this.scrollable.container);\n    let transform: string;\n    if(!visibleRect) {\n      if(!players.appearWrapper.classList.contains('hide') || !players.appear) {\n        return;\n      }\n\n      if(players.select) {\n        players.select.stop();\n      }\n\n      players.appear.stop();\n      players.appear.autoplay = true;\n      players.appearWrapper.classList.remove('hide');\n      players.selectWrapper.classList.add('hide');\n\n      transform = '';\n    } else if(visibleRect.overflow.left || visibleRect.overflow.right) {\n      const diff = Math.abs(visibleRect.rect.left - visibleRect.rect.right);\n      const scale = Math.min(diff ** 2 / REACTION_CONTAINER_SIZE ** 2, 1);\n\n      transform = 'scale(' + scale + ')';\n    } else {\n      transform = '';\n    }\n\n    if(CAN_USE_TRANSFORM) {\n      scaleContainer.style.transform = transform;\n    }\n  }\n\n  private onMouseMove = (e: MouseEvent) => {\n    const reactionDiv = findUpClassName(e.target, REACTION_CLASS_NAME);\n    if(!reactionDiv) {\n      return;\n    }\n\n    const players = this.reactionsMap.get(reactionDiv);\n    if(!players) {\n      return;\n    }\n\n    // do not play select animation when appearing\n    if(!players.appear?.paused) {\n      return;\n    }\n\n    const player = players.select;\n    if(!player) {\n      return;\n    }\n\n    if(player.paused) {\n      player.autoplay = true;\n      player.restart();\n    }\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type Chat from './chat';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport {copyTextToClipboard} from '../../helpers/clipboard';\r\nimport PopupSendNow from '../popups/sendNow';\r\nimport {toast} from '../toast';\r\nimport I18n, {i18n, LangPackKey} from '../../lib/langPack';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {Message, Poll, Chat as MTChat, MessageMedia, AvailableReaction, MessageEntity, InputStickerSet, StickerSet, Document, Reaction} from '../../layer';\r\nimport PopupReportMessages from '../popups/reportMessages';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport PopupSponsored from '../popups/sponsored';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport PeerTitle from '../peerTitle';\r\nimport StackedAvatars from '../stackedAvatars';\r\nimport {IS_APPLE} from '../../environment/userAgent';\r\nimport PopupReactedList from '../popups/reactedList';\r\nimport {ChatReactionsMenu, REACTION_CONTAINER_SIZE} from './reactionsMenu';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport positionMenu, {MenuPositionPadding} from '../../helpers/positionMenu';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {SERVICE_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\r\nimport filterUnique from '../../helpers/array/filterUnique';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\r\nimport PopupStickers from '../popups/stickers';\r\n\r\nexport default class ChatContextMenu {\r\n  private buttons: (ButtonMenuItemOptions & {verify: () => boolean | Promise<boolean>, notDirect?: () => boolean, withSelection?: true, isSponsored?: true, localName?: 'views' | 'emojis'})[];\r\n  private element: HTMLElement;\r\n\r\n  private isSelectable: boolean;\r\n  private isSelected: boolean;\r\n  private target: HTMLElement;\r\n  private isTargetAGroupedItem: boolean;\r\n  private isTextSelected: boolean;\r\n  private isAnchorTarget: boolean;\r\n  private isUsernameTarget: boolean;\r\n  private isSponsored: boolean;\r\n  private isOverBubble: boolean;\r\n  private peerId: PeerId;\r\n  private mid: number;\r\n  private message: Message.message | Message.messageService;\r\n  private noForwards: boolean;\r\n\r\n  private reactionsMenu: ChatReactionsMenu;\r\n  private listenerSetter: ListenerSetter;\r\n  private attachListenerSetter: ListenerSetter;\r\n\r\n  private viewerPeerId: PeerId;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private canOpenReactedList: boolean;\r\n\r\n  private emojiInputsPromise: CancellablePromise<InputStickerSet.inputStickerSetID[]>;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.attachListenerSetter = new ListenerSetter();\r\n    this.middleware = getMiddleware();\r\n  }\r\n\r\n  public attachTo(element: HTMLElement) {\r\n    this.attachListenerSetter.removeAll();\r\n\r\n    if(IS_TOUCH_SUPPORTED/*  && false */) {\r\n      attachClickEvent(element, (e) => {\r\n        if(this.chat.selection.isSelecting) {\r\n          return;\r\n        }\r\n\r\n        this.chat.log('touchend', e);\r\n\r\n        const badSelectors = [\r\n          '.name',\r\n          '.peer-title',\r\n          '.reply',\r\n          '.document',\r\n          'audio-element',\r\n          'avatar-element',\r\n          'a',\r\n          '.bubble-beside-button',\r\n          'replies-element',\r\n          '[data-saved-from]:not(.bubble)',\r\n          'poll-element',\r\n          '.attachment',\r\n          '.reply-markup-button'\r\n        ];\r\n        const good = !(e.target as HTMLElement).closest(badSelectors.join(', '));\r\n        if(good) {\r\n          cancelEvent(e);\r\n          // onContextMenu((e as TouchEvent).changedTouches[0]);\r\n          // onContextMenu((e as TouchEvent).changedTouches ? (e as TouchEvent).changedTouches[0] : e as MouseEvent);\r\n          this.onContextMenu(e);\r\n        }\r\n      }, {listenerSetter: this.attachListenerSetter});\r\n    } else attachContextMenuListener(element, this.onContextMenu, this.attachListenerSetter);\r\n  }\r\n\r\n  private onContextMenu = (e: MouseEvent | Touch | TouchEvent) => {\r\n    let bubble: HTMLElement, contentWrapper: HTMLElement;\r\n\r\n    try {\r\n      contentWrapper = findUpClassName(e.target, 'bubble-content-wrapper');\r\n      bubble = contentWrapper ? contentWrapper.parentElement : findUpClassName(e.target, 'bubble');\r\n    } catch(e) {}\r\n\r\n    // ! context menu click by date bubble (there is no pointer-events)\r\n    if(!bubble || bubble.classList.contains('bubble-first')) return;\r\n\r\n    let element = this.element;\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('preventDefault')) (e as any).preventDefault();\r\n    if(element && element.classList.contains('active')) {\r\n      return false;\r\n    }\r\n    if(e instanceof MouseEvent || e.hasOwnProperty('cancelBubble')) (e as any).cancelBubble = true;\r\n\r\n    let mid = +bubble.dataset.mid;\r\n    if(!mid) return;\r\n\r\n    const r = async() => {\r\n      const isSponsored = this.isSponsored = mid < 0;\r\n      this.isSelectable = this.chat.selection.canSelectBubble(bubble);\r\n      this.peerId = this.chat.peerId;\r\n      // this.msgID = msgID;\r\n      this.target = e.target as HTMLElement;\r\n      this.isTextSelected = !isSelectionEmpty();\r\n      this.isAnchorTarget = this.target.tagName === 'A' && (\r\n        (this.target as HTMLAnchorElement).target === '_blank' ||\r\n        this.target.classList.contains('anchor-url')\r\n      );\r\n      this.isUsernameTarget = this.target.tagName === 'A' && this.target.classList.contains('mention');\r\n\r\n      // *         ,     ,    \r\n      if(this.chat.selection.isSelecting && !contentWrapper) {\r\n        if(isSponsored) {\r\n          return;\r\n        }\r\n\r\n        const mids = await this.chat.getMidsByMid(mid);\r\n        if(mids.length > 1) {\r\n          const selectedMid = this.chat.selection.isMidSelected(this.peerId, mid) ?\r\n            mid :\r\n            mids.find((mid) => this.chat.selection.isMidSelected(this.peerId, mid));\r\n          if(selectedMid) {\r\n            mid = selectedMid;\r\n          }\r\n        }\r\n      }\r\n\r\n      this.isOverBubble = !!contentWrapper;\r\n\r\n      const groupedItem = findUpClassName(this.target, 'grouped-item');\r\n      this.isTargetAGroupedItem = !!groupedItem;\r\n      if(groupedItem) {\r\n        this.mid = +groupedItem.dataset.mid;\r\n      } else {\r\n        this.mid = mid;\r\n      }\r\n\r\n      this.isSelected = this.chat.selection.isMidSelected(this.peerId, this.mid);\r\n      this.message = await this.chat.getMessage(this.mid);\r\n      this.noForwards = !isSponsored && !(await this.managers.appMessagesManager.canForward(this.message));\r\n      this.viewerPeerId = undefined;\r\n      this.canOpenReactedList = undefined;\r\n\r\n      const initResult = await this.init();\r\n      if(!initResult) {\r\n        return;\r\n      }\r\n\r\n      element = initResult.element;\r\n      const {cleanup, destroy, menuPadding, reactionsMenu, reactionsMenuPosition} = initResult;\r\n      let isReactionsMenuVisible = false;\r\n      if(reactionsMenu) {\r\n        const className = 'is-visible';\r\n        isReactionsMenuVisible = reactionsMenu.container.classList.contains(className);\r\n        if(isReactionsMenuVisible) reactionsMenu.container.classList.remove(className);\r\n\r\n        if(reactionsMenuPosition === 'horizontal') {\r\n          const offsetSize = element[/* reactionsMenuPosition === 'vertical' ? 'offsetHeight' :  */'offsetWidth'];\r\n          // if(reactionsMenu.scrollable.container.scrollWidth > offsetWidth) {\r\n          const INNER_CONTAINER_PADDING = 8;\r\n          const visibleLength = (offsetSize - INNER_CONTAINER_PADDING) / REACTION_CONTAINER_SIZE;\r\n          const nextVisiblePart = visibleLength % 1;\r\n          const MIN_NEXT_VISIBLE_PART = 0.65;\r\n          if(nextVisiblePart < MIN_NEXT_VISIBLE_PART) {\r\n            const minSize = (offsetSize + (MIN_NEXT_VISIBLE_PART - nextVisiblePart) * REACTION_CONTAINER_SIZE) | 0;\r\n            element.style[/* reactionsMenuPosition === 'vertical' ? 'minHeight' :  */'minWidth'] = minSize + 'px';\r\n          }\r\n          // }\r\n        }\r\n      }\r\n\r\n      const side: 'left' | 'right' = bubble.classList.contains('is-in') ? 'left' : 'right';\r\n      // bubble.parentElement.append(element);\r\n      // appImManager.log('contextmenu', e, bubble, side);\r\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, element, side, menuPadding);\r\n\r\n      if(reactionsMenu) {\r\n        reactionsMenu.widthContainer.style.top = element.style.top;\r\n        reactionsMenu.widthContainer.style.left = element.style.left;\r\n        reactionsMenu.widthContainer.style.setProperty('--menu-width', element[reactionsMenuPosition === 'vertical' ? 'offsetHeight' : 'offsetWidth'] + 'px');\r\n        element.parentElement.append(reactionsMenu.widthContainer);\r\n        if(isReactionsMenuVisible) void reactionsMenu.container.offsetLeft; // reflow\r\n      }\r\n\r\n      contextMenuController.openBtnMenu(element, () => {\r\n        if(reactionsMenu) {\r\n          reactionsMenu.container.classList.remove('is-visible');\r\n        }\r\n\r\n        this.mid = 0;\r\n        this.peerId = undefined;\r\n        this.target = null;\r\n        this.viewerPeerId = undefined;\r\n        this.canOpenReactedList = undefined;\r\n        cleanup();\r\n\r\n        setTimeout(() => {\r\n          destroy();\r\n        }, 300);\r\n      });\r\n\r\n      if(isReactionsMenuVisible) {\r\n        reactionsMenu.container.classList.add('is-visible');\r\n      }\r\n    };\r\n\r\n    r();\r\n  };\r\n\r\n  public cleanup() {\r\n    this.listenerSetter.removeAll();\r\n    this.reactionsMenu && this.reactionsMenu.cleanup();\r\n    this.middleware.clean();\r\n  }\r\n\r\n  public destroy() {\r\n    this.cleanup();\r\n    this.attachListenerSetter.removeAll();\r\n  }\r\n\r\n  private async filterButtons(buttons: ChatContextMenu['buttons']) {\r\n    if(this.isSponsored) {\r\n      return buttons.filter((button) => {\r\n        return button.isSponsored;\r\n      });\r\n    } else {\r\n      return filterAsync(buttons, async(button) => {\r\n        let good: boolean;\r\n\r\n        // if((appImManager.chatSelection.isSelecting && !button.withSelection) || (button.withSelection && !appImManager.chatSelection.isSelecting)) {\r\n        if(this.chat.selection.isSelecting && !button.withSelection) {\r\n          good = false;\r\n        } else {\r\n          good = this.isOverBubble || IS_TOUCH_SUPPORTED || true ?\r\n            await button.verify() :\r\n            button.notDirect && await button.verify() && button.notDirect();\r\n        }\r\n\r\n        return !!good;\r\n      });\r\n    }\r\n  }\r\n\r\n  private setButtons() {\r\n    const verifyFavoriteSticker = async(toAdd: boolean) => {\r\n      const doc = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document;\r\n      if(!(doc as MyDocument)?.sticker) {\r\n        return false;\r\n      }\r\n\r\n      const favedStickers = await this.managers.acknowledged.appStickersManager.getFavedStickersStickers();\r\n      if(!favedStickers.cached) {\r\n        return false;\r\n      }\r\n\r\n      const found = (await favedStickers.result).some((_doc) => _doc.id === doc.id);\r\n      return toAdd ? !found : found;\r\n    };\r\n\r\n    this.buttons = [{\r\n      icon: 'send2',\r\n      text: 'MessageScheduleSend',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'send2',\r\n      text: 'Message.Context.Selection.SendNow',\r\n      onClick: this.onSendScheduledClick,\r\n      verify: () => this.chat.type === 'scheduled' && this.isSelected && !this.chat.selection.selectionSendNowBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'MessageScheduleEditTime',\r\n      onClick: () => {\r\n        this.chat.input.scheduleSending(() => {\r\n          assumeType<Message.message>(this.message);\r\n          this.managers.appMessagesManager.editMessage(this.message, this.message.message, {\r\n            scheduleDate: this.chat.input.scheduleDate,\r\n            entities: this.message.entities\r\n          });\r\n\r\n          this.chat.input.onMessageSent(false, false);\r\n        }, new Date(this.message.date * 1000));\r\n      },\r\n      verify: () => this.chat.type === 'scheduled'\r\n    }, {\r\n      icon: 'reply',\r\n      text: 'Reply',\r\n      onClick: this.onReplyClick,\r\n      verify: async() => await this.chat.canSend() &&\r\n        !this.message.pFlags.is_outgoing &&\r\n        !!this.chat.input.messageInput &&\r\n        this.chat.type !== 'scheduled'/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'AddToFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, false),\r\n      verify: () => verifyFavoriteSticker(true)\r\n    }, {\r\n      icon: 'favourites',\r\n      text: 'DeleteFromFavorites',\r\n      onClick: this.onFaveStickerClick.bind(this, true),\r\n      verify: () => verifyFavoriteSticker(false)\r\n    }, {\r\n      icon: 'edit',\r\n      text: 'Edit',\r\n      onClick: this.onEditClick,\r\n      verify: async() => (await this.managers.appMessagesManager.canEditMessage(this.message, 'text')) && !!this.chat.input.messageInput\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && !this.isTextSelected && (!this.isAnchorTarget || (this.message as Message.message).message !== this.target.innerText)\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Chat.CopySelectedText',\r\n      onClick: this.onCopyClick,\r\n      verify: () => !this.noForwards && !!(this.message as Message.message).message && this.isTextSelected\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Message.Context.Selection.Copy',\r\n      onClick: this.onCopyClick,\r\n      verify: async() => {\r\n        if(!this.isSelected || this.noForwards) {\r\n          return false;\r\n        }\r\n\r\n        for(const [peerId, mids] of this.chat.selection.selectedMids) {\r\n          const storageKey: MessagesStorageKey = `${peerId}_${this.chat.type === 'scheduled' ? 'scheduled' : 'history'}`;\r\n          for(const mid of mids) {\r\n            const message = (await this.managers.appMessagesManager.getMessageFromStorage(storageKey, mid)) as Message.message;\r\n            if(!!message.message) {\r\n              return true;\r\n            }\r\n          }\r\n        }\r\n\r\n        return false;\r\n      },\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'CopyLink',\r\n      onClick: this.onCopyAnchorLinkClick,\r\n      verify: () => this.isAnchorTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Username',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.isUsernameTarget,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'copy',\r\n      text: 'Text.Context.Copy.Hashtag',\r\n      onClick: () => {\r\n        copyTextToClipboard(this.target.innerHTML);\r\n      },\r\n      verify: () => this.target.classList.contains('anchor-hashtag'),\r\n      withSelection: true\r\n    }, {\r\n      icon: 'link',\r\n      text: 'MessageContext.CopyMessageLink1',\r\n      onClick: this.onCopyLinkClick,\r\n      verify: async() => await this.managers.appPeersManager.isChannel(this.peerId) && !this.message.pFlags.is_outgoing\r\n    }, {\r\n      icon: 'pin',\r\n      text: 'Message.Context.Pin',\r\n      onClick: this.onPinClick,\r\n      verify: async() => !this.message.pFlags.is_outgoing &&\r\n        this.message._ !== 'messageService' &&\r\n        !this.message.pFlags.pinned &&\r\n        await this.managers.appPeersManager.canPinMessage(this.peerId) &&\r\n        this.chat.type !== 'scheduled'\r\n    }, {\r\n      icon: 'unpin',\r\n      text: 'Message.Context.Unpin',\r\n      onClick: this.onUnpinClick,\r\n      verify: async() => (this.message as Message.message).pFlags.pinned && await this.managers.appPeersManager.canPinMessage(this.peerId)\r\n    }, {\r\n      icon: 'download',\r\n      text: 'MediaViewer.Context.Download',\r\n      onClick: () => {\r\n        appDownloadManager.downloadToDisc({media: (this.message as any).media.document});\r\n      },\r\n      verify: () => {\r\n        if(this.message.pFlags.is_outgoing) {\r\n          return false;\r\n        }\r\n\r\n        const doc: MyDocument = ((this.message as Message.message).media as MessageMedia.messageMediaDocument)?.document as any;\r\n        if(!doc) return false;\r\n\r\n        let hasTarget = !!IS_TOUCH_SUPPORTED;\r\n        const isGoodType = !doc.type || !(['gif', 'video'/* , 'sticker' */] as MyDocument['type'][]).includes(doc.type);\r\n        if(isGoodType) hasTarget ||= !!findUpClassName(this.target, 'document') || !!findUpClassName(this.target, 'audio') || !!findUpClassName(this.target, 'media-sticker-wrapper');\r\n        return isGoodType && hasTarget;\r\n      }\r\n    }, {\r\n      icon: 'checkretract',\r\n      text: 'Chat.Poll.Unvote',\r\n      onClick: this.onRetractVote,\r\n      verify: () => {\r\n        const poll = (this.message as any).media?.poll as Poll;\r\n        return poll && poll.chosenIndexes.length && !poll.pFlags.closed && !poll.pFlags.quiz;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'stop',\r\n      text: 'Chat.Poll.Stop',\r\n      onClick: this.onStopPoll,\r\n      verify: async() => {\r\n        const poll = (this.message as any).media?.poll;\r\n        return await this.managers.appMessagesManager.canEditMessage(this.message, 'poll') && poll && !poll.pFlags.closed && !this.message.pFlags.is_outgoing;\r\n      }/* ,\r\n      cancelEvent: true */\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Forward',\r\n      onClick: this.onForwardClick, // let forward the message if it's outgoing but not ours (like a changelog)\r\n      verify: () => !this.noForwards && this.chat.type !== 'scheduled' && (!this.message.pFlags.is_outgoing || this.message.fromId === SERVICE_PEER_ID) && this.message._ !== 'messageService'\r\n    }, {\r\n      icon: 'forward',\r\n      text: 'Message.Context.Selection.Forward',\r\n      onClick: this.onForwardClick,\r\n      verify: () => this.chat.selection.selectionForwardBtn &&\r\n        this.isSelected &&\r\n        !this.chat.selection.selectionForwardBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'flag',\r\n      text: 'ReportChat',\r\n      onClick: () => {\r\n        new PopupReportMessages(this.peerId, [this.mid]);\r\n      },\r\n      verify: async() => !this.message.pFlags.out && this.message._ === 'message' && !this.message.pFlags.is_outgoing && await this.managers.appPeersManager.isChannel(this.peerId),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Select',\r\n      onClick: this.onSelectClick,\r\n      verify: () => !(this.message as Message.messageService).action && !this.isSelected && this.isSelectable,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'select',\r\n      text: 'Message.Context.Selection.Clear',\r\n      onClick: this.onClearSelectionClick,\r\n      verify: () => this.isSelected,\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      onClick: () => {\r\n        if(this.viewerPeerId) {\r\n          this.chat.appImManager.setInnerPeer({\r\n            peerId: this.viewerPeerId\r\n          });\r\n        } else if(this.canOpenReactedList) {\r\n          new PopupReactedList(this.message as Message.message);\r\n        } else {\r\n          return false;\r\n        }\r\n      },\r\n      verify: async() => !this.peerId.isUser() && (!!(this.message as Message.message).reactions?.recent_reactions?.length || await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message)),\r\n      notDirect: () => true,\r\n      localName: 'views'\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: async() => this.managers.appMessagesManager.canDeleteMessage(this.message)\r\n    }, {\r\n      icon: 'delete danger',\r\n      text: 'Message.Context.Selection.Delete',\r\n      onClick: this.onDeleteClick,\r\n      verify: () => this.isSelected && !this.chat.selection.selectionDeleteBtn.hasAttribute('disabled'),\r\n      notDirect: () => true,\r\n      withSelection: true\r\n    }, {\r\n      icon: 'info',\r\n      text: 'Chat.Message.Sponsored.What',\r\n      onClick: () => {\r\n        new PopupSponsored();\r\n      },\r\n      verify: () => false,\r\n      isSponsored: true\r\n    }, {\r\n      // icon: 'smile',\r\n      text: 'Loading',\r\n      onClick: () => {\r\n        this.emojiInputsPromise.then((inputs) => {\r\n          new PopupStickers(inputs, true).show();\r\n        });\r\n      },\r\n      verify: () => !!this.getUniqueCustomEmojisFromMessage(this.message).length,\r\n      notDirect: () => true,\r\n      localName: 'emojis'\r\n    }];\r\n  }\r\n\r\n  private getUniqueCustomEmojisFromMessage(message: Message) {\r\n    const docIds: DocId[] = [];\r\n\r\n    const entities = (message as Message.message).entities;\r\n    if(entities) {\r\n      const filtered = entities.filter((entity) => entity._ === 'messageEntityCustomEmoji') as MessageEntity.messageEntityCustomEmoji[];\r\n      docIds.push(...filtered.map((entity) => entity.document_id));\r\n    }\r\n\r\n    const reactions = (message as Message.message).reactions;\r\n    if(reactions) {\r\n      const results = reactions.results.filter((reactionCount) => reactionCount.reaction._ === 'reactionCustomEmoji');\r\n      docIds.push(...results.map((reactionCount) => (reactionCount.reaction as Reaction.reactionCustomEmoji).document_id));\r\n    }\r\n\r\n    return filterUnique(docIds);\r\n  }\r\n\r\n  private async init() {\r\n    this.cleanup();\r\n    this.setButtons();\r\n\r\n    const filteredButtons = await this.filterButtons(this.buttons);\r\n    if(!filteredButtons.length) {\r\n      return;\r\n    }\r\n\r\n    const element = this.element = ButtonMenu(filteredButtons, this.listenerSetter);\r\n    element.id = 'bubble-contextmenu';\r\n    element.classList.add('contextmenu');\r\n\r\n    const viewsButton = filteredButtons.find((button) => button.localName === 'views');\r\n    if(viewsButton) {\r\n      const reactions = (this.message as Message.message).reactions;\r\n      const recentReactions = reactions?.recent_reactions;\r\n      const isViewingReactions = !!recentReactions?.length;\r\n      const participantsCount = await this.managers.appMessagesManager.canViewMessageReadParticipants(this.message) ?\r\n        ((await this.managers.appPeersManager.getPeer(this.peerId)) as MTChat.chat).participants_count :\r\n        undefined;\r\n      const reactedLength = reactions ? reactions.results.reduce((acc, r) => acc + r.count, 0) : undefined;\r\n\r\n      viewsButton.element.classList.add('tgico-' + (isViewingReactions ? 'reactions' : 'checks'));\r\n      const i18nElem = new I18n.IntlElement({\r\n        key: isViewingReactions ? (\r\n          participantsCount === undefined ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted'\r\n        ) : 'NobodyViewed',\r\n        args: isViewingReactions ? (\r\n          participantsCount === undefined ? [reactedLength] : [participantsCount, participantsCount]\r\n        ) : undefined,\r\n        element: viewsButton.textElement\r\n      });\r\n\r\n      let fakeText: HTMLElement;\r\n      if(isViewingReactions) {\r\n        if(participantsCount === undefined) {\r\n          fakeText = i18n('Chat.Context.ReactedFast', [reactedLength]);\r\n        } else {\r\n          fakeText = i18n(\r\n            recentReactions.length === participantsCount ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            [recentReactions.length, participantsCount]\r\n          );\r\n        }\r\n      } else {\r\n        fakeText = i18n('Loading');\r\n      }\r\n\r\n      fakeText.classList.add('btn-menu-item-text-fake');\r\n      viewsButton.element.append(fakeText);\r\n\r\n      const AVATAR_SIZE = 22;\r\n      const MAX_AVATARS = 3;\r\n      const PADDING_PER_AVATAR = 1.125;\r\n      i18nElem.element.style.visibility = 'hidden';\r\n      i18nElem.element.style.paddingRight = isViewingReactions ? PADDING_PER_AVATAR * Math.min(MAX_AVATARS, recentReactions.length) + 'rem' : '1rem';\r\n      const middleware = this.middleware.get();\r\n      this.managers.appMessagesManager.getMessageReactionsListAndReadParticipants(this.message as Message.message).then((result) => {\r\n        if(!middleware()) {\r\n          return;\r\n        }\r\n\r\n        if(fakeText) {\r\n          fakeText.remove();\r\n        }\r\n\r\n        const reactions = result.combined;\r\n        const reactedLength = participantsCount === undefined ?\r\n          result.reactionsCount :\r\n          (\r\n            isViewingReactions ?\r\n              reactions.filter((reaction) => reaction.reaction).length :\r\n              reactions.length\r\n          );\r\n\r\n        let fakeElem: HTMLElement;\r\n        if(reactions.length === 1) {\r\n          fakeElem = new PeerTitle({\r\n            peerId: reactions[0].peerId,\r\n            onlyFirstName: true,\r\n            dialog: false\r\n          }).element;\r\n\r\n          if(!isViewingReactions || result.readParticipants.length <= 1) {\r\n            this.viewerPeerId = reactions[0].peerId;\r\n          }\r\n        } else if(isViewingReactions) {\r\n          const isFull = reactedLength === reactions.length || participantsCount === undefined;\r\n          fakeElem = i18n(\r\n            isFull ? 'Chat.Context.ReactedFast' : 'Chat.Context.Reacted',\r\n            isFull ? [reactedLength] : [reactedLength, reactions.length]\r\n          );\r\n        } else {\r\n          if(!reactions.length) {\r\n            i18nElem.element.style.visibility = '';\r\n          } else {\r\n            fakeElem = i18n('MessageSeen', [reactions.length]);\r\n          }\r\n        }\r\n\r\n        if(fakeElem) {\r\n          fakeElem.style.paddingRight = PADDING_PER_AVATAR * Math.min(MAX_AVATARS, reactedLength) + 'rem';\r\n          fakeElem.classList.add('btn-menu-item-text-fake');\r\n          viewsButton.element.append(fakeElem);\r\n        }\r\n\r\n        if(reactions.length) {\r\n          const avatars = new StackedAvatars({avatarSize: AVATAR_SIZE});\r\n          avatars.render(recentReactions ? recentReactions.map((r) => getPeerId(r.peer_id)) : reactions.map((reaction) => reaction.peerId));\r\n          viewsButton.element.append(avatars.container);\r\n\r\n          // if(reactions.length > 1) {\r\n          // if(isViewingReactions) {\r\n          this.canOpenReactedList = true;\r\n          // }\r\n        }\r\n      });\r\n    }\r\n\r\n    let menuPadding: MenuPositionPadding;\r\n    let reactionsMenu: ChatReactionsMenu;\r\n    let reactionsMenuPosition: 'horizontal' | 'vertical';\r\n    if(this.message._ === 'message' && !this.chat.selection.isSelecting && !this.message.pFlags.is_outgoing && !this.message.pFlags.is_scheduled) {\r\n      reactionsMenuPosition = (IS_APPLE || IS_TOUCH_SUPPORTED)/*  && false */ ? 'horizontal' : 'vertical';\r\n      reactionsMenu = this.reactionsMenu = new ChatReactionsMenu(this.managers, reactionsMenuPosition, this.middleware);\r\n      reactionsMenu.init(await this.managers.appMessagesManager.getGroupsFirstMessage(this.message));\r\n      // element.prepend(reactionsMenu.widthContainer);\r\n\r\n      const size = 36;\r\n      const margin = 8;\r\n      const totalSize = size + margin;\r\n      const paddingLeft = 0, paddingRight = 0;\r\n      if(reactionsMenuPosition === 'vertical') {\r\n        menuPadding = {\r\n          top: paddingLeft,\r\n          // bottom: 36, // positionMenu will detect it itself somehow\r\n          left: totalSize\r\n        };\r\n      } else {\r\n        menuPadding = {\r\n          top: totalSize,\r\n          right: paddingRight,\r\n          left: paddingLeft\r\n        };\r\n      }\r\n    }\r\n\r\n    const emojisButton = filteredButtons.find((button) => button.localName === 'emojis');\r\n    if(emojisButton) {\r\n      emojisButton.element.classList.add('is-multiline');\r\n      emojisButton.element.parentElement.insertBefore(document.createElement('hr'), emojisButton.element);\r\n\r\n      const setPadding = () => {\r\n        menuPadding ??= {};\r\n        menuPadding.bottom = 24;\r\n      };\r\n\r\n      const docIds = this.getUniqueCustomEmojisFromMessage(this.message);\r\n      const inputsPromise = this.emojiInputsPromise = deferredPromise();\r\n\r\n      await this.managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then(async(docs) => {\r\n        const p = async(docs: Document.document[]) => {\r\n          const s: Map<StickerSet['id'], InputStickerSet.inputStickerSetID> = new Map();\r\n          docs.forEach((doc) => {\r\n            if(!doc || s.has(doc.stickerSetInput.id)) {\r\n              return;\r\n            }\r\n\r\n            s.set(doc.stickerSetInput.id, doc.stickerSetInput);\r\n          });\r\n\r\n          const inputs = [...s.values()];\r\n          inputsPromise.resolve(inputs);\r\n          if(s.size === 1) {\r\n            const result = await this.managers.acknowledged.appStickersManager.getStickerSet(inputs[0]);\r\n            const promise = result.result.then((set) => {\r\n              const el = i18n('MessageContainsEmojiPack', [wrapEmojiText(set.set.title)]);\r\n              replaceContent(emojisButton.textElement, el);\r\n            });\r\n\r\n            return result.cached ? promise : (setPadding(), undefined);\r\n          }\r\n\r\n          replaceContent(emojisButton.textElement, i18n('MessageContainsEmojiPacks', [s.size]));\r\n        };\r\n\r\n        if(docs.some((doc) => !doc)) {\r\n          setPadding();\r\n          this.managers.appEmojiManager.getCustomEmojiDocuments(docIds).then(p);\r\n        } else {\r\n          return p(docs);\r\n        }\r\n      });\r\n      // emojisButton.element.append(i18n('Loading'));\r\n    }\r\n\r\n    this.chat.container.append(element);\r\n\r\n    return {\r\n      element,\r\n      cleanup: () => {\r\n        this.cleanup();\r\n        reactionsMenu && reactionsMenu.cleanup();\r\n      },\r\n      destroy: () => {\r\n        element.remove();\r\n        reactionsMenu && reactionsMenu.widthContainer.remove();\r\n      },\r\n      menuPadding,\r\n      reactionsMenu,\r\n      reactionsMenuPosition\r\n    };\r\n  }\r\n\r\n  private onSendScheduledClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionSendNowBtn);\r\n    } else {\r\n      new PopupSendNow(this.peerId, await this.chat.getMidsByMid(this.mid));\r\n    }\r\n  };\r\n\r\n  private onReplyClick = () => {\r\n    this.chat.input.initMessageReply(this.mid);\r\n  };\r\n\r\n  private onFaveStickerClick = (unfave?: boolean) => {\r\n    const docId = ((this.message as Message.message).media as MessageMedia.messageMediaDocument).document.id;\r\n    this.managers.appStickersManager.faveSticker(docId, unfave);\r\n  };\r\n\r\n  private onEditClick = () => {\r\n    this.chat.input.initMessageEditing(this.mid);\r\n  };\r\n\r\n  private onCopyClick = async() => {\r\n    if(isSelectionEmpty()) {\r\n      const mids = this.chat.selection.isSelecting ?\r\n        [...this.chat.selection.selectedMids.get(this.peerId)].sort((a, b) => a - b) :\r\n        [this.mid];\r\n\r\n      const parts: string[] = await Promise.all(mids.map(async(mid) => {\r\n        const message = (await this.chat.getMessage(mid)) as Message.message;\r\n        return message?.message ? message.message + '\\n' : '';\r\n      }));\r\n\r\n      const str = parts.join('');\r\n\r\n      copyTextToClipboard(str);\r\n    } else {\r\n      document.execCommand('copy');\r\n      // cancelSelection();\r\n    }\r\n  };\r\n\r\n  private onCopyAnchorLinkClick = () => {\r\n    copyTextToClipboard((this.target as HTMLAnchorElement).href);\r\n  };\r\n\r\n  private onCopyLinkClick = async() => {\r\n    let threadMessage: Message.message;\r\n    const {peerId, mid} = this;\r\n    const threadId = this.chat.threadId;\r\n    if(this.chat.type === 'discussion') {\r\n      threadMessage = (await this.managers.appMessagesManager.getMessageByPeer(peerId, threadId)) as Message.message;\r\n    }\r\n\r\n    const username = await this.managers.appPeersManager.getPeerUsername(threadMessage ? threadMessage.fromId : peerId);\r\n    const msgId = getServerMessageId(mid);\r\n    let url = 'https://t.me/';\r\n    let key: LangPackKey;\r\n    if(username) {\r\n      url += username + '/' + (threadMessage ? getServerMessageId(threadMessage.fwd_from.channel_post) : msgId);\r\n      if(threadMessage) url += '?comment=' + msgId;\r\n      key = 'LinkCopied';\r\n    } else {\r\n      url += 'c/' + peerId.toChatId() + '/' + msgId;\r\n      if(threadMessage) url += '?thread=' + getServerMessageId(threadMessage.mid);\r\n      key = 'LinkCopiedPrivateInfo';\r\n    }\r\n\r\n    toast(I18n.format(key, true));\r\n\r\n    copyTextToClipboard(url);\r\n  };\r\n\r\n  private onPinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid);\r\n  };\r\n\r\n  private onUnpinClick = () => {\r\n    new PopupPinMessage(this.peerId, this.mid, true);\r\n  };\r\n\r\n  private onRetractVote = () => {\r\n    this.managers.appPollsManager.sendVote(this.message, []);\r\n  };\r\n\r\n  private onStopPoll = () => {\r\n    this.managers.appPollsManager.stopPoll(this.message);\r\n  };\r\n\r\n  private onForwardClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionForwardBtn);\r\n    } else {\r\n      const peerId = this.peerId;\r\n      const mids = this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid);\r\n      new PopupForward({\r\n        [peerId]: mids\r\n      });\r\n    }\r\n  };\r\n\r\n  private onSelectClick = () => {\r\n    this.chat.selection.toggleByElement(findUpClassName(this.target, 'grouped-item') || findUpClassName(this.target, 'bubble'));\r\n  };\r\n\r\n  private onClearSelectionClick = () => {\r\n    this.chat.selection.cancelSelection();\r\n  };\r\n\r\n  private onDeleteClick = async() => {\r\n    if(this.chat.selection.isSelecting) {\r\n      simulateClickEvent(this.chat.selection.selectionDeleteBtn);\r\n    } else {\r\n      new PopupDeleteMessages(this.peerId, this.isTargetAGroupedItem ? [this.mid] : await this.chat.getMidsByMid(this.mid), this.chat.type);\r\n    }\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\n\r\nexport default class SendMenu {\r\n  public sendMenu: HTMLDivElement;\r\n  private sendMenuButtons: (ButtonMenuItemOptions & {verify: () => boolean})[];\r\n  private type: 'schedule' | 'reminder';\r\n\r\n  constructor(options: {\r\n    onSilentClick: () => void,\r\n    onScheduleClick: () => void,\r\n    listenerSetter?: ListenerSetter,\r\n    openSide: string,\r\n    onContextElement: HTMLElement,\r\n    onOpen?: () => boolean\r\n  }) {\r\n    this.sendMenuButtons = [{\r\n      icon: 'mute',\r\n      text: 'Chat.Send.WithoutSound',\r\n      onClick: options.onSilentClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.ScheduledMessage',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'schedule'\r\n    }, {\r\n      icon: 'schedule',\r\n      text: 'Chat.Send.SetReminder',\r\n      onClick: options.onScheduleClick,\r\n      verify: () => this.type === 'reminder'\r\n    }];\r\n\r\n    this.sendMenu = ButtonMenu(this.sendMenuButtons, options.listenerSetter);\r\n    this.sendMenu.classList.add('menu-send', options.openSide);\r\n\r\n    attachContextMenuListener(options.onContextElement, (e: any) => {\r\n      if(options.onOpen && !options.onOpen()) {\r\n        return;\r\n      }\r\n\r\n      this.sendMenuButtons.forEach((button) => {\r\n        button.element.classList.toggle('hide', !button.verify());\r\n      });\r\n\r\n      cancelEvent(e);\r\n      contextMenuController.openBtnMenu(this.sendMenu);\r\n    }, options.listenerSetter);\r\n  }\r\n\r\n  public setPeerId(peerId: PeerId) {\r\n    this.type = peerId === rootScope.myId ? 'reminder' : 'schedule';\r\n  }\r\n};\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from '../chat/chat';\r\nimport PopupElement from '.';\r\nimport CheckboxField from '../checkboxField';\r\nimport InputField from '../inputField';\r\nimport RadioField from '../radioField';\r\nimport Scrollable from '../scrollable';\r\nimport SendContextMenu from '../chat/sendContextMenu';\r\nimport I18n, {_i18n} from '../../lib/langPack';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Poll} from '../../layer';\r\n\r\nconst MAX_LENGTH_QUESTION = 255;\r\nconst MAX_LENGTH_OPTION = 100;\r\nconst MAX_LENGTH_SOLUTION = 200;\r\n\r\nexport default class PopupCreatePoll extends PopupElement {\r\n  private questionInputField: InputField;\r\n  private questions: HTMLElement;\r\n  protected scrollable: Scrollable;\r\n  private tempId = 0;\r\n\r\n  private anonymousCheckboxField: CheckboxField;\r\n  private multipleCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n  private quizCheckboxField: PopupCreatePoll['anonymousCheckboxField'];\r\n\r\n  private correctAnswers: Uint8Array[];\r\n  private quizSolutionField: InputField;\r\n  private optionInputFields: InputField[];\r\n\r\n  constructor(private chat: Chat) {\r\n    super('popup-create-poll popup-new-media', {closable: true, withConfirm: 'Create', body: true, title: 'NewPoll'});\r\n    this.construct();\r\n  }\r\n\r\n  private async construct() {\r\n    this.questionInputField = new InputField({\r\n      placeholder: 'AskAQuestion',\r\n      label: 'AskAQuestion',\r\n      name: 'question',\r\n      maxLength: MAX_LENGTH_QUESTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    this.optionInputFields = [];\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      const sendMenu = new SendContextMenu({\r\n        onSilentClick: () => {\r\n          this.chat.input.sendSilent = true;\r\n          this.send();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.chat.input.scheduleSending(() => {\r\n            this.send();\r\n          });\r\n        },\r\n        openSide: 'bottom-left',\r\n        onContextElement: this.btnConfirm\r\n      });\r\n\r\n      sendMenu.setPeerId(this.chat.peerId);\r\n\r\n      this.header.append(sendMenu.sendMenu);\r\n    }\r\n\r\n    this.header.append(this.questionInputField.container);\r\n\r\n    const hr = document.createElement('hr');\r\n    const d = document.createElement('div');\r\n    d.classList.add('caption');\r\n    _i18n(d, 'PollOptions');\r\n\r\n    this.questions = document.createElement('form');\r\n    this.questions.classList.add('poll-create-questions');\r\n\r\n    const dd = document.createElement('div');\r\n    dd.classList.add('poll-create-settings');\r\n\r\n    const settingsCaption = document.createElement('div');\r\n    settingsCaption.classList.add('caption');\r\n    _i18n(settingsCaption, 'Settings');\r\n\r\n    if(!(await this.chat.managers.appPeersManager.isBroadcast(this.chat.peerId))) {\r\n      this.anonymousCheckboxField = new CheckboxField({\r\n        text: 'NewPoll.Anonymous',\r\n        name: 'anonymous'\r\n      });\r\n      this.anonymousCheckboxField.input.checked = true;\r\n      dd.append(this.anonymousCheckboxField.label);\r\n    }\r\n\r\n    this.multipleCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.MultipleChoice',\r\n      name: 'multiple'\r\n    });\r\n    this.quizCheckboxField = new CheckboxField({\r\n      text: 'NewPoll.Quiz',\r\n      name: 'quiz'\r\n    });\r\n\r\n    this.listenerSetter.add(this.multipleCheckboxField.input)('change', () => {\r\n      const checked = this.multipleCheckboxField.input.checked;\r\n      this.quizCheckboxField.input.toggleAttribute('disabled', checked);\r\n    });\r\n\r\n    this.listenerSetter.add(this.quizCheckboxField.input)('change', () => {\r\n      const checked = this.quizCheckboxField.input.checked;\r\n\r\n      (Array.from(this.questions.children) as HTMLElement[]).map((el) => {\r\n        el.classList.toggle('radio-field', checked);\r\n      });\r\n\r\n      if(!checked) {\r\n        this.correctAnswers = undefined;\r\n        this.quizSolutionField.setValueSilently('');\r\n      }\r\n\r\n      quizElements.forEach((el) => el.classList.toggle('hide', !checked));\r\n\r\n      this.multipleCheckboxField.input.toggleAttribute('disabled', checked);\r\n      this.handleChange();\r\n    });\r\n\r\n    dd.append(this.multipleCheckboxField.label, this.quizCheckboxField.label);\r\n\r\n    const quizElements: HTMLElement[] = [];\r\n\r\n    const quizSolutionCaption = document.createElement('div');\r\n    quizSolutionCaption.classList.add('caption');\r\n    _i18n(quizSolutionCaption, 'AccDescrQuizExplanation');\r\n\r\n    const quizHr = document.createElement('hr');\r\n\r\n    const quizSolutionContainer = document.createElement('div');\r\n    quizSolutionContainer.classList.add('poll-create-questions');\r\n\r\n    this.quizSolutionField = new InputField({\r\n      placeholder: 'NewPoll.Explanation.Placeholder',\r\n      label: 'NewPoll.Explanation.Placeholder',\r\n      name: 'solution',\r\n      maxLength: MAX_LENGTH_SOLUTION\r\n    });\r\n\r\n    this.listenerSetter.add(this.questionInputField.input)('input', () => {\r\n      this.handleChange();\r\n    });\r\n\r\n    const quizSolutionSubtitle = document.createElement('div');\r\n    quizSolutionSubtitle.classList.add('subtitle');\r\n    _i18n(quizSolutionSubtitle, 'AddAnExplanationInfo');\r\n\r\n    quizSolutionContainer.append(this.quizSolutionField.container, quizSolutionSubtitle);\r\n\r\n    quizElements.push(quizHr, quizSolutionCaption, quizSolutionContainer);\r\n    quizElements.forEach((el) => el.classList.add('hide'));\r\n\r\n    this.body.parentElement.insertBefore(hr, this.body);\r\n    this.body.append(d, this.questions, document.createElement('hr'), settingsCaption, dd, ...quizElements);\r\n\r\n    attachClickEvent(this.btnConfirm, this.onSubmitClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.scrollable = new Scrollable(this.body);\r\n    this.appendMoreField();\r\n\r\n    this.onEscape = () => {\r\n      return !this.getFilledAnswers().length;\r\n    };\r\n\r\n    this.handleChange();\r\n  }\r\n\r\n  private getFilledAnswers() {\r\n    const answers = Array.from(this.questions.children).map((el, idx) => {\r\n      const input = el.querySelector('.input-field-input') as HTMLElement;\r\n      return input instanceof HTMLInputElement ? input.value : getRichValue(input, false).value;\r\n    }).filter((v) => !!v.trim());\r\n\r\n    return answers;\r\n  }\r\n\r\n  private onSubmitClick = () => {\r\n    this.send();\r\n  };\r\n\r\n  private validate() {\r\n    const question = this.questionInputField.value;\r\n    if(!question) {\r\n      return false;\r\n    }\r\n\r\n    if(question.length > MAX_LENGTH_QUESTION) {\r\n      return false;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked && !this.correctAnswers?.length) {\r\n      return false;\r\n    }\r\n\r\n    const answers = this.getFilledAnswers();\r\n    if(answers.length < 2) {\r\n      return false;\r\n    }\r\n\r\n    const tooLongOption = answers.find((a) => a.length > MAX_LENGTH_OPTION);\r\n    if(tooLongOption) {\r\n      return false;\r\n    }\r\n\r\n    const {value: quizSolution} = getRichValue(this.quizSolutionField.input, false);\r\n    if(quizSolution.length > MAX_LENGTH_SOLUTION) {\r\n      return false;\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private handleChange() {\r\n    const valid = this.validate();\r\n    this.btnConfirm.toggleAttribute('disabled', !valid);\r\n  }\r\n\r\n  public async send(force = false) {\r\n    const question = this.questionInputField.value;\r\n\r\n    const answers = this.getFilledAnswers();\r\n\r\n    const {value: quizSolution, entities: quizSolutionEntities} = getRichValue(this.quizSolutionField.input);\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.chat.input.scheduleSending(() => {\r\n        this.send(true);\r\n      });\r\n\r\n      return;\r\n    }\r\n\r\n    this.hide();\r\n\r\n    // const randomID = [nextRandomInt(0xFFFFFFFF), nextRandomInt(0xFFFFFFFF)];\r\n    // const randomIDS = bigint(randomID[0]).shiftLeft(32).add(bigint(randomID[1])).toString();\r\n\r\n    const pFlags: Poll['pFlags'] = {};\r\n\r\n    if(this.anonymousCheckboxField && !this.anonymousCheckboxField.input.checked) {\r\n      pFlags.public_voters = true;\r\n    }\r\n\r\n    if(this.multipleCheckboxField.input.checked) {\r\n      pFlags.multiple_choice = true;\r\n    }\r\n\r\n    if(this.quizCheckboxField.input.checked) {\r\n      pFlags.quiz = true;\r\n    }\r\n\r\n    const poll: Poll = {\r\n      _: 'poll',\r\n      pFlags,\r\n      question,\r\n      answers: answers.map((value, idx) => {\r\n        return {\r\n          _: 'pollAnswer',\r\n          text: value,\r\n          option: new Uint8Array([idx])\r\n        };\r\n      }),\r\n      id: undefined\r\n    };\r\n    // poll.id = randomIDS;\r\n\r\n    const inputMediaPoll = await this.chat.managers.appPollsManager.getInputMediaPoll(poll, this.correctAnswers, quizSolution, quizSolutionEntities);\r\n\r\n    // console.log('Will try to create poll:', inputMediaPoll);\r\n\r\n    this.chat.managers.appMessagesManager.sendOther(this.chat.peerId, inputMediaPoll, {\r\n      ...this.chat.getMessageSendingParams()\r\n    });\r\n\r\n    if(this.chat.input.helperType === 'reply') {\r\n      this.chat.input.clearHelper();\r\n    }\r\n\r\n    this.chat.input.onMessageSent(false, false);\r\n  }\r\n\r\n  onInput = (e: Event) => {\r\n    const target = e.target as HTMLInputElement;\r\n\r\n    const radioLabel = findUpTag(target, 'LABEL');\r\n    const isEmpty = isInputEmpty(target);\r\n    if(!isEmpty) {\r\n      target.parentElement.classList.add('is-filled');\r\n      radioLabel.classList.remove('hidden-widget');\r\n      radioLabel.firstElementChild.removeAttribute('disabled');\r\n    }\r\n\r\n    const isLast = !radioLabel.nextElementSibling;\r\n    if(isLast && !isEmpty && this.questions.childElementCount < 10) {\r\n      this.appendMoreField();\r\n    }\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  onDeleteClick = (e: MouseEvent) => {\r\n    const target = e.target as HTMLSpanElement;\r\n    const label = findUpTag(target, 'LABEL');\r\n    const idx = whichChild(label);\r\n\r\n    if(this.correctAnswers && this.correctAnswers[0][0] === idx) {\r\n      this.correctAnswers = undefined;\r\n    }\r\n\r\n    label.remove();\r\n    this.optionInputFields.splice(idx, 1);\r\n\r\n    this.optionInputFields.forEach((inputField, idx) => {\r\n      inputField.options.labelOptions.length = 0;\r\n      inputField.options.labelOptions.push(idx + 1);\r\n      const i18nElement = I18n.weakMap.get(inputField.label.firstElementChild as HTMLElement);\r\n      i18nElement.update();\r\n    });\r\n\r\n    this.handleChange();\r\n  };\r\n\r\n  private appendMoreField() {\r\n    const tempId = this.tempId++;\r\n    const idx = this.questions.childElementCount + 1;\r\n    const questionField = new InputField({\r\n      placeholder: 'NewPoll.OptionsAddOption',\r\n      label: 'NewPoll.OptionLabel',\r\n      labelOptions: [idx],\r\n      name: 'question-' + tempId,\r\n      maxLength: MAX_LENGTH_OPTION\r\n    });\r\n    this.listenerSetter.add(questionField.input)('input', this.onInput);\r\n\r\n    const radioField = new RadioField({\r\n      text: '',\r\n      name: 'question'\r\n    });\r\n    radioField.main.append(questionField.container);\r\n    attachClickEvent(questionField.input, cancelEvent, {listenerSetter: this.listenerSetter});\r\n    radioField.label.classList.add('hidden-widget');\r\n    radioField.input.disabled = true;\r\n    if(!this.quizCheckboxField.input.checked) {\r\n      radioField.label.classList.remove('radio-field');\r\n    }\r\n    this.listenerSetter.add(radioField.input)('change', () => {\r\n      const checked = radioField.input.checked;\r\n      if(checked) {\r\n        const idx = whichChild(radioField.label);\r\n        this.correctAnswers = [new Uint8Array([idx])];\r\n        this.handleChange();\r\n      }\r\n    });\r\n\r\n    const deleteBtn = document.createElement('span');\r\n    deleteBtn.classList.add('btn-icon', 'tgico-close');\r\n    questionField.container.append(deleteBtn);\r\n\r\n    attachClickEvent(deleteBtn, this.onDeleteClick, {listenerSetter: this.listenerSetter, once: true});\r\n\r\n    this.questions.append(radioField.label);\r\n\r\n    this.scrollable.scrollIntoViewNew({\r\n      element: this.questions.lastElementChild as HTMLElement,\r\n      position: 'center'\r\n    });\r\n    // this.scrollable.scrollTo(this.scrollable.scrollHeight, 'top', true, true);\r\n\r\n    this.optionInputFields.push(questionField);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pause from './schedulers/pause';\r\nimport {makeMediaSize} from './mediaSize';\r\nimport scaleMediaElement from './canvas/scaleMediaElement';\r\nimport preloadVideo from './preloadVideo';\r\n\r\nexport function createPosterFromMedia(media: HTMLVideoElement | HTMLImageElement) {\r\n  let width: number, height: number;\r\n  if(media instanceof HTMLVideoElement) {\r\n    width = media.videoWidth;\r\n    height = media.videoHeight;\r\n  } else {\r\n    width = media.naturalWidth;\r\n    height = media.naturalHeight;\r\n  }\r\n\r\n  return scaleMediaElement({\r\n    media,\r\n    mediaSize: makeMediaSize(width, height),\r\n    boxSize: makeMediaSize(320, 240),\r\n    quality: .9\r\n  });\r\n}\r\n\r\nexport function createPosterFromVideo(video: HTMLVideoElement): ReturnType<typeof scaleMediaElement> {\r\n  return new Promise((resolve, reject) => {\r\n    video.onseeked = () => {\r\n      video.onseeked = () => {\r\n        createPosterFromMedia(video).then(resolve);\r\n\r\n        video.onseeked = undefined;\r\n      };\r\n\r\n      video.currentTime = 0;\r\n    };\r\n\r\n    video.onerror = reject;\r\n    video.currentTime = Math.min(video.duration, 1);\r\n  });\r\n}\r\n\r\nexport async function createPosterForVideo(url: string) {\r\n  const video = await preloadVideo(url);\r\n\r\n  return Promise.race([\r\n    pause(2000) as Promise<undefined>,\r\n    createPosterFromVideo(video)\r\n  ]);\r\n}\r\n\r\n\r\n","/**\n * @returns duration in ms\n */\nexport default function getGifDuration(image: HTMLImageElement) {\n  const src = image.src;\n\n  return fetch(src)\n  .then((response) => response.arrayBuffer())\n  .then((arrayBuffer) => {\n    const d = new Uint8Array(arrayBuffer);\n    // Thanks to http://justinsomnia.org/2006/10/gif-animation-duration-calculation/\n    // And http://www.w3.org/Graphics/GIF/spec-gif89a.txt\n    let duration = 0;\n    for(let i = 0, length = d.length; i < length; ++i) {\n      // Find a Graphic Control Extension hex(21F904__ ____ __00)\n      if(d[i] == 0x21 &&\n       d[i + 1] == 0xF9 &&\n       d[i + 2] == 0x04 &&\n       d[i + 7] == 0x00) {\n        // Swap 5th and 6th bytes to get the delay per frame\n        const delay = (d[i + 5] << 8) | (d[i + 4] & 0xFF);\n\n        // Should be aware browsers have a minimum frame delay\n        // e.g. 6ms for IE, 2ms modern browsers (50fps)\n        duration += delay < 2 ? 10 : delay;\n      }\n    }\n\n    return duration / 1000;\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type Chat from '../chat/chat';\nimport InputField from '../inputField';\nimport PopupElement from '.';\nimport Scrollable from '../scrollable';\nimport {toast} from '../toast';\nimport CheckboxField from '../checkboxField';\nimport SendContextMenu from '../chat/sendContextMenu';\nimport {createPosterFromMedia, createPosterFromVideo} from '../../helpers/createPoster';\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\nimport I18n, {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\nimport calcImageInBox from '../../helpers/calcImageInBox';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport getGifDuration from '../../helpers/getGifDuration';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport createVideo from '../../helpers/dom/createVideo';\nimport prepareAlbum from '../prepareAlbum';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport {ThumbCache} from '../../lib/storages/thumbs';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\nimport {THUMB_TYPE_FULL} from '../../lib/mtproto/mtproto_config';\nimport wrapDocument from '../wrappers/document';\n\ntype SendFileParams = Partial<{\n  file: File,\n  objectURL: string,\n  thumb: {\n    blob: Blob,\n    url: string,\n    size: MediaSize\n  },\n  width: number,\n  height: number,\n  duration: number,\n  noSound: boolean,\n  itemDiv: HTMLElement\n}>;\n\nlet currentPopup: PopupNewMedia;\n\nexport function getCurrentNewMediaPopup() {\n  return currentPopup;\n}\n\nexport default class PopupNewMedia extends PopupElement {\n  private input: HTMLElement;\n  private mediaContainer: HTMLElement;\n  private groupCheckboxField: CheckboxField;\n  private mediaCheckboxField: CheckboxField;\n  private wasInputValue: string;\n\n  private willAttach: Partial<{\n    type: 'media' | 'document',\n    isMedia: true,\n    group: boolean,\n    sendFileDetails: SendFileParams[]\n  }>;\n  private inputField: InputField;\n  private captionLengthMax: number;\n\n  constructor(private chat: Chat, private files: File[], willAttachType: PopupNewMedia['willAttach']['type']) {\n    super('popup-send-photo popup-new-media', {closable: true, withConfirm: 'Modal.Send', confirmShortcutIsSendShortcut: true, body: true, title: true});\n    this.construct(willAttachType);\n  }\n\n  private async construct(willAttachType: PopupNewMedia['willAttach']['type']) {\n    this.willAttach = {\n      type: willAttachType,\n      sendFileDetails: [],\n      group: false\n    };\n\n    const config = await this.managers.apiManager.getConfig();\n    this.captionLengthMax = config.caption_length_max;\n\n    attachClickEvent(this.btnConfirm, () => this.send(), {listenerSetter: this.listenerSetter});\n\n    if(this.chat.type !== 'scheduled') {\n      const sendMenu = new SendContextMenu({\n        onSilentClick: () => {\n          this.chat.input.sendSilent = true;\n          this.send();\n        },\n        onScheduleClick: () => {\n          this.chat.input.scheduleSending(() => {\n            this.send();\n          });\n        },\n        openSide: 'bottom-left',\n        onContextElement: this.btnConfirm,\n        listenerSetter: this.listenerSetter\n      });\n\n      sendMenu.setPeerId(this.chat.peerId);\n\n      this.header.append(sendMenu.sendMenu);\n    }\n\n    this.mediaContainer = document.createElement('div');\n    this.mediaContainer.classList.add('popup-photo');\n    const scrollable = new Scrollable(null);\n    scrollable.container.append(this.mediaContainer);\n\n    this.inputField = new InputField({\n      placeholder: 'PreviewSender.CaptionPlaceholder',\n      label: 'Caption',\n      name: 'photo-caption',\n      maxLength: this.captionLengthMax,\n      withLinebreaks: true\n    });\n    this.input = this.inputField.input;\n\n    this.inputField.value = this.wasInputValue = this.chat.input.messageInputField.input.innerHTML;\n    this.chat.input.messageInputField.value = '';\n\n    this.body.append(scrollable.container);\n    this.container.append(this.inputField.container);\n\n    this.attachFiles();\n\n    this.addEventListener('close', () => {\n      this.files = [];\n      currentPopup = undefined;\n    });\n\n    currentPopup = this;\n  }\n\n  public appendDrops(element: HTMLElement) {\n    this.body.append(element);\n  }\n\n  get type() {\n    return this.willAttach.type;\n  }\n\n  set type(type: PopupNewMedia['willAttach']['type']) {\n    this.willAttach.type = type;\n  }\n\n  private appendGroupCheckboxField() {\n    const good = this.files.length > 1;\n    if(good && !this.groupCheckboxField) {\n      this.groupCheckboxField = new CheckboxField({\n        text: 'PreviewSender.GroupItems',\n        name: 'group-items'\n      });\n      this.container.append(...[this.groupCheckboxField.label, this.mediaCheckboxField?.label, this.inputField.container].filter(Boolean));\n\n      this.willAttach.group = true;\n      this.groupCheckboxField.setValueSilently(this.willAttach.group);\n\n      this.listenerSetter.add(this.groupCheckboxField.input)('change', () => {\n        const checked = this.groupCheckboxField.checked;\n\n        this.willAttach.group = checked;\n\n        this.attachFiles();\n      });\n    } else if(this.groupCheckboxField) {\n      this.groupCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  private appendMediaCheckboxField() {\n    const good = !!this.files.find((file) => MEDIA_MIME_TYPES_SUPPORTED.has(file.type));\n    if(good && !this.mediaCheckboxField) {\n      this.mediaCheckboxField = new CheckboxField({\n        text: 'PreviewSender.CompressFile',\n        name: 'compress-items'\n      });\n      this.container.append(...[this.groupCheckboxField?.label, this.mediaCheckboxField.label, this.inputField.container].filter(Boolean));\n\n      this.mediaCheckboxField.setValueSilently(this.willAttach.type === 'media');\n\n      this.listenerSetter.add(this.mediaCheckboxField.input)('change', () => {\n        const checked = this.mediaCheckboxField.checked;\n\n        this.willAttach.type = checked ? 'media' : 'document';\n\n        this.attachFiles();\n      });\n    } else if(this.mediaCheckboxField) {\n      this.mediaCheckboxField.label.classList.toggle('hide', !good);\n    }\n  }\n\n  public addFiles(files: File[]) {\n    const toPush = files.filter((file) => {\n      const found = this.files.find((_file) => {\n        return _file.lastModified === file.lastModified && _file.name === file.name && _file.size === file.size;\n      });\n\n      return !found;\n    });\n\n    if(toPush.length) {\n      this.files.push(...toPush);\n      this.attachFiles();\n    }\n  }\n\n  private onKeyDown = (e: KeyboardEvent) => {\n    const target = e.target as HTMLElement;\n    if(target !== this.input) {\n      if(target.tagName === 'INPUT' || target.hasAttribute('contenteditable')) {\n        return;\n      }\n\n      this.input.focus();\n      placeCaretAtEnd(this.input);\n    }\n  };\n\n  private send(force = false) {\n    if(this.chat.type === 'scheduled' && !force) {\n      this.chat.input.scheduleSending(() => {\n        this.send(true);\n      });\n\n      return;\n    }\n\n    let caption = this.inputField.value;\n    if(caption.length > this.captionLengthMax) {\n      toast(I18n.format('Error.PreviewSender.CaptionTooLong', true));\n      return;\n    }\n\n    this.hide();\n    const willAttach = this.willAttach;\n    willAttach.isMedia = willAttach.type === 'media' ? true : undefined;\n    const {sendFileDetails, isMedia} = willAttach;\n\n    // console.log('will send files with options:', willAttach);\n\n    const {peerId, input} = this.chat;\n\n    sendFileDetails.forEach((d) => {\n      d.itemDiv = undefined;\n    });\n\n    const {length} = sendFileDetails;\n    const sendingParams = this.chat.getMessageSendingParams();\n    this.iterate((sendFileDetails) => {\n      if(caption && sendFileDetails.length !== length) {\n        this.managers.appMessagesManager.sendText(peerId, caption, {\n          ...sendingParams,\n          clearDraft: true\n        });\n\n        caption = undefined;\n      }\n\n      const w = {\n        ...willAttach,\n        sendFileDetails\n      };\n\n      this.managers.appMessagesManager.sendAlbum(peerId, w.sendFileDetails.map((d) => d.file), Object.assign({\n        ...sendingParams,\n        caption,\n        isMedia: isMedia,\n        clearDraft: true as true\n      }, w));\n\n      caption = undefined;\n    });\n\n    input.replyToMsgId = this.chat.threadId;\n    input.onMessageSent();\n  }\n\n  private async attachMedia(params: SendFileParams, itemDiv: HTMLElement) {\n    itemDiv.classList.add('popup-item-media');\n\n    const file = params.file;\n    const isVideo = file.type.startsWith('video/');\n\n    let promise: Promise<void>;\n    if(isVideo) {\n      const video = createVideo();\n      const source = document.createElement('source');\n      source.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n      video.autoplay = true;\n      video.controls = false;\n      video.muted = true;\n\n      video.addEventListener('timeupdate', () => {\n        video.pause();\n      }, {once: true});\n\n      promise = onMediaLoad(video).then(async() => {\n        params.width = video.videoWidth;\n        params.height = video.videoHeight;\n        params.duration = Math.floor(video.duration);\n\n        const audioDecodedByteCount = (video as any).webkitAudioDecodedByteCount;\n        if(audioDecodedByteCount !== undefined) {\n          params.noSound = !audioDecodedByteCount;\n        }\n\n        itemDiv.append(video);\n        const thumb = await createPosterFromVideo(video);\n        params.thumb = {\n          url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n          ...thumb\n        };\n      });\n\n      video.append(source);\n    } else {\n      const img = new Image();\n      promise = new Promise<void>((resolve) => {\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          itemDiv.append(img);\n\n          if(file.type === 'image/gif') {\n            params.noSound = true;\n\n            Promise.all([\n              getGifDuration(img).then((duration) => {\n                params.duration = Math.ceil(duration);\n              }),\n\n              createPosterFromMedia(img).then(async(thumb) => {\n                params.thumb = {\n                  url: await apiManagerProxy.invoke('createObjectURL', thumb.blob),\n                  ...thumb\n                };\n              })\n            ]).then(() => {\n              resolve();\n            });\n          } else {\n            resolve();\n          }\n        };\n      });\n\n      img.src = params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    return promise;\n  }\n\n  private async attachDocument(params: SendFileParams, itemDiv: HTMLElement): ReturnType<PopupNewMedia['attachMedia']> {\n    itemDiv.classList.add('popup-item-document');\n    const file = params.file;\n\n    const isPhoto = file.type.startsWith('image/');\n    const isAudio = file.type.startsWith('audio/');\n    if(isPhoto || isAudio || file.size < 20e6) {\n      params.objectURL = await apiManagerProxy.invoke('createObjectURL', file);\n    }\n\n    const doc = {\n      _: 'document',\n      file: file,\n      file_name: file.name || '',\n      size: file.size,\n      type: isPhoto ? 'photo' : 'doc'\n    } as MyDocument;\n\n    let cacheContext: ThumbCache;\n    if(params.objectURL) {\n      cacheContext = {\n        url: params.objectURL,\n        downloaded: file.size,\n        type: THUMB_TYPE_FULL\n      };\n    }\n\n    const docDiv = await wrapDocument({\n      message: {\n        _: 'message',\n        pFlags: {\n          is_outgoing: true\n        },\n        mid: 0,\n        peerId: 0,\n        media: {\n          _: 'messageMediaDocument',\n          document: doc\n        }\n      } as any,\n      cacheContext\n    });\n\n    const promise = new Promise<void>((resolve) => {\n      const finish = () => {\n        itemDiv.append(docDiv);\n        resolve();\n      };\n\n      if(isPhoto) {\n        const img = new Image();\n        img.src = params.objectURL;\n        img.onload = () => {\n          params.width = img.naturalWidth;\n          params.height = img.naturalHeight;\n\n          finish();\n        };\n\n        img.onerror = finish;\n      } else {\n        finish();\n      }\n    });\n\n    return promise;\n  }\n\n  private attachFile = (file: File) => {\n    const willAttach = this.willAttach;\n    const shouldCompress = this.shouldCompress(file.type);\n\n    const params: SendFileParams = {};\n    params.file = file;\n\n    const itemDiv = document.createElement('div');\n    itemDiv.classList.add('popup-item');\n\n    params.itemDiv = itemDiv;\n\n    const promise = shouldCompress ? this.attachMedia(params, itemDiv) : this.attachDocument(params, itemDiv);\n    willAttach.sendFileDetails.push(params);\n    return promise;\n  };\n\n  private shouldCompress(mimeType: string) {\n    return this.willAttach.type === 'media' && MEDIA_MIME_TYPES_SUPPORTED.has(mimeType);\n  }\n\n  private onRender() {\n    // show now\n    if(!this.element.classList.contains('active')) {\n      this.listenerSetter.add(document.body)('keydown', this.onKeyDown);\n      this.addEventListener('close', () => {\n        if(this.wasInputValue) {\n          this.chat.input.messageInputField.value = this.wasInputValue;\n        }\n      });\n      this.show();\n    }\n  }\n\n  private setTitle() {\n    const {willAttach, title, files} = this;\n    let key: LangPackKey;\n    const args: FormatterArguments = [];\n    if(willAttach.type === 'document') {\n      key = 'PreviewSender.SendFile';\n      args.push(files.length);\n    } else {\n      let foundPhotos = 0, foundVideos = 0, foundFiles = 0;\n      files.forEach((file) => {\n        if(file.type.startsWith('image/')) ++foundPhotos;\n        else if(file.type.startsWith('video/')) ++foundVideos;\n        else ++foundFiles;\n      });\n\n      if([foundPhotos, foundVideos, foundFiles].filter((n) => n > 0).length > 1) {\n        key = 'PreviewSender.SendFile';\n        args.push(files.length);\n      } else\n\n      /* const sum = foundPhotos + foundVideos;\n      if(sum > 1 && willAttach.group) {\n        key = 'PreviewSender.SendAlbum';\n        const albumsLength = Math.ceil(sum / 10);\n        args.push(albumsLength);\n      } else  */if(foundPhotos) {\n        key = 'PreviewSender.SendPhoto';\n        args.push(foundPhotos);\n      } else if(foundVideos) {\n        key = 'PreviewSender.SendVideo';\n        args.push(foundVideos);\n      }\n    }\n\n    replaceContent(title, i18n(key, args));\n  }\n\n  private appendMediaToContainer(div: HTMLElement, params: SendFileParams) {\n    if(this.shouldCompress(params.file.type)) {\n      const size = calcImageInBox(params.width, params.height, 380, 320);\n      div.style.width = size.width + 'px';\n      div.style.height = size.height + 'px';\n    }\n\n    this.mediaContainer.append(div);\n  }\n\n  private iterate(cb: (sendFileDetails: SendFileParams[]) => void) {\n    const {sendFileDetails} = this.willAttach;\n    if(!this.willAttach.group) {\n      sendFileDetails.forEach((p) => cb([p]));\n      return;\n    }\n\n    const length = sendFileDetails.length;\n    for(let i = 0; i < length;) {\n      const firstType = sendFileDetails[i].file.type;\n      let k = 0;\n      for(; k < 10 && i < length; ++i, ++k) {\n        const type = sendFileDetails[i].file.type;\n        if(this.shouldCompress(firstType) !== this.shouldCompress(type)) {\n          break;\n        }\n      }\n\n      cb(sendFileDetails.slice(i - k, i));\n    }\n  }\n\n  private attachFiles() {\n    const {files, willAttach, mediaContainer} = this;\n    willAttach.sendFileDetails.length = 0;\n\n    this.appendGroupCheckboxField();\n    this.appendMediaCheckboxField();\n\n    Promise.all(files.map(this.attachFile)).then(() => {\n      mediaContainer.innerHTML = '';\n\n      if(!files.length) {\n        return;\n      }\n\n      this.setTitle();\n\n      this.iterate((sendFileDetails) => {\n        if(this.shouldCompress(sendFileDetails[0].file.type) && sendFileDetails.length > 1) {\n          const albumContainer = document.createElement('div');\n          albumContainer.classList.add('popup-item-album', 'popup-item');\n          albumContainer.append(...sendFileDetails.map((s) => s.itemDiv));\n\n          prepareAlbum({\n            container: albumContainer,\n            items: sendFileDetails.map((o) => ({w: o.width, h: o.height})),\n            maxWidth: 380,\n            minWidth: 100,\n            spacing: 4\n          });\n\n          mediaContainer.append(albumContainer);\n        } else {\n          sendFileDetails.forEach((params) => {\n            this.appendMediaToContainer(params.itemDiv, params);\n          });\n        }\n      });\n    }).then(() => {\n      this.onRender();\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport fastSmoothScroll from '../fastSmoothScroll';\r\nimport cancelEvent from './cancelEvent';\r\nimport {attachClickEvent, detachClickEvent} from './clickEvent';\r\nimport findUpAsChild from './findUpAsChild';\r\nimport findUpClassName from './findUpClassName';\r\n\r\ntype ArrowKey = 'ArrowUp' | 'ArrowDown' | 'ArrowLeft' | 'ArrowRight';\r\nconst HANDLE_EVENT = 'keydown';\r\nconst ACTIVE_CLASS_NAME = 'active';\r\n\r\nconst AXIS_Y_KEYS: ArrowKey[] = ['ArrowUp', 'ArrowDown'];\r\nconst AXIS_X_KEYS: ArrowKey[] = ['ArrowLeft', 'ArrowRight'];\r\n\r\nexport type ListNavigationOptions = {\r\n  list: HTMLElement,\r\n  type: 'xy' | 'x' | 'y',\r\n  onSelect: (target: Element) => void | boolean | Promise<boolean>,\r\n  once: boolean,\r\n  waitForKey?: string[]\r\n};\r\n\r\nexport default function attachListNavigation({list, type, onSelect, once, waitForKey}: ListNavigationOptions) {\r\n  let waitForKeySet = waitForKey?.length ? new Set(waitForKey) : undefined;\r\n  const keyNames = new Set(type === 'xy' ? AXIS_Y_KEYS.concat(AXIS_X_KEYS) : (type === 'x' ? AXIS_X_KEYS : AXIS_Y_KEYS));\r\n\r\n  let target: Element;\r\n  const getCurrentTarget = () => {\r\n    return target || list.querySelector('.' + ACTIVE_CLASS_NAME) || list.firstElementChild;\r\n  };\r\n\r\n  const setCurrentTarget = (_target: Element, scrollTo: boolean) => {\r\n    if(target === _target) {\r\n      return;\r\n    }\r\n\r\n    let hadTarget = false;\r\n    if(target) {\r\n      hadTarget = true;\r\n      target.classList.remove(ACTIVE_CLASS_NAME);\r\n    }\r\n\r\n    target = _target;\r\n    if(!target) return;\r\n    target.classList.add(ACTIVE_CLASS_NAME);\r\n\r\n    if(hadTarget && scrollable && scrollTo) {\r\n      fastSmoothScroll({\r\n        container: scrollable,\r\n        element: target as HTMLElement,\r\n        position: 'center',\r\n        forceDuration: 100,\r\n        axis: type === 'x' ? 'x' : 'y'\r\n      });\r\n    }\r\n  };\r\n\r\n  const getNextTargetX = (currentTarget: Element, isNext: boolean) => {\r\n    let nextTarget: Element;\r\n    if(isNext) nextTarget = currentTarget.nextElementSibling || list.firstElementChild;\r\n    else nextTarget = currentTarget.previousElementSibling || list.lastElementChild;\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  const getNextTargetY = (currentTarget: Element, isNext: boolean) => {\r\n    const property = isNext ? 'nextElementSibling' : 'previousElementSibling';\r\n    const endProperty = isNext ? 'firstElementChild' : 'lastElementChild';\r\n    const currentRect = currentTarget.getBoundingClientRect();\r\n\r\n    let nextTarget = currentTarget[property] || list[endProperty];\r\n    while(nextTarget !== currentTarget) {\r\n      const targetRect = nextTarget.getBoundingClientRect();\r\n      if(targetRect.x === currentRect.x && targetRect.y !== currentRect.y) {\r\n        break;\r\n      }\r\n\r\n      nextTarget = nextTarget[property] || list[endProperty];\r\n    }\r\n\r\n    return nextTarget;\r\n  };\r\n\r\n  let handleArrowKey: (currentTarget: Element, key: ArrowKey) => Element;\r\n  if(type === 'xy') { // flex-direction: row; flex-wrap: wrap;\r\n    handleArrowKey = (currentTarget, key) => {\r\n      if(key === 'ArrowUp' || key === 'ArrowDown') return getNextTargetY(currentTarget, key === 'ArrowDown');\r\n      else return getNextTargetX(currentTarget, key === 'ArrowRight');\r\n    };\r\n  } else { // flex-direction: row | column;\r\n    handleArrowKey = (currentTarget, key) => getNextTargetX(currentTarget, key === 'ArrowRight' || key === 'ArrowDown');\r\n  }\r\n\r\n  let onKeyDown = (e: KeyboardEvent) => {\r\n    const key = e.key;\r\n    if(!keyNames.has(key as any)) {\r\n      if(key === 'Enter' || (type !== 'xy' && key === 'Tab')) {\r\n        cancelEvent(e);\r\n        fireSelect(getCurrentTarget());\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    cancelEvent(e);\r\n\r\n    if(list.childElementCount > 1) {\r\n      let currentTarget = getCurrentTarget();\r\n      currentTarget = handleArrowKey(currentTarget, key as any);\r\n      setCurrentTarget(currentTarget, true);\r\n    }\r\n  };\r\n\r\n  const scrollable = findUpClassName(list, 'scrollable');\r\n  list.classList.add('navigable-list');\r\n\r\n  const onMouseMove = (e: MouseEvent) => {\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n  };\r\n\r\n  const onClick = (e: Event) => {\r\n    cancelEvent(e); // cancel keyboard closening\r\n\r\n    const target = findUpAsChild(e.target as HTMLElement, list) as HTMLElement;\r\n    if(!target) {\r\n      return;\r\n    }\r\n\r\n    setCurrentTarget(target, false);\r\n    fireSelect(getCurrentTarget());\r\n  };\r\n\r\n  const fireSelect = async(target: Element) => {\r\n    const canContinue = await onSelect(target);\r\n    if(canContinue !== undefined ? !canContinue : once) {\r\n      detach();\r\n    }\r\n  };\r\n\r\n  let attached = false;\r\n  const attach = () => {\r\n    if(attached) return;\r\n    attached = true;\r\n    // const input = document.activeElement as HTMLElement;\r\n    // input.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n    list.addEventListener('mousemove', onMouseMove, {passive: true});\r\n    attachClickEvent(list, onClick);\r\n  };\r\n\r\n  const detach = () => {\r\n    if(!attached) return;\r\n    attached = false;\r\n    // input.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n    list.removeEventListener('mousemove', onMouseMove);\r\n    detachClickEvent(list, onClick);\r\n  };\r\n\r\n  const resetTarget = () => {\r\n    if(waitForKeySet) return;\r\n    setCurrentTarget(list.firstElementChild, false);\r\n  };\r\n\r\n  if(waitForKeySet) {\r\n    const _onKeyDown = onKeyDown;\r\n    onKeyDown = (e) => {\r\n      if(waitForKeySet.has(e.key)) {\r\n        cancelEvent(e);\r\n\r\n        document.removeEventListener(HANDLE_EVENT, onKeyDown, {capture: true});\r\n        onKeyDown = _onKeyDown;\r\n        document.addEventListener(HANDLE_EVENT, onKeyDown, {capture: true, passive: false});\r\n\r\n        waitForKeySet = undefined;\r\n        resetTarget();\r\n      }\r\n    };\r\n  } else {\r\n    resetTarget();\r\n  }\r\n\r\n  attach();\r\n\r\n  return {\r\n    attach,\r\n    detach,\r\n    resetTarget\r\n  };\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport attachListNavigation, {ListNavigationOptions} from '../../helpers/dom/attachListNavigation';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {IS_MOBILE} from '../../environment/userAgent';\r\nimport rootScope from '../../lib/rootScope';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport SetTransition from '../singleTransition';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nexport default class AutocompleteHelper extends EventListenerBase<{\r\n  hidden: () => void,\r\n  visible: () => void,\r\n  hiding: () => void\r\n}> {\r\n  protected hidden = true;\r\n  protected container: HTMLElement;\r\n  protected list: HTMLElement;\r\n  protected resetTarget: () => void;\r\n  protected attach: () => void;\r\n  protected detach: () => void;\r\n  protected init?(): void;\r\n\r\n  protected controller: AutocompleteHelperController;\r\n  protected listType: 'xy' | 'x' | 'y';\r\n  protected onSelect: ListNavigationOptions['onSelect'];\r\n  protected waitForKey?: string[];\r\n\r\n  protected navigationItem: NavigationItem;\r\n\r\n  constructor(options: {\r\n    appendTo: HTMLElement,\r\n    controller?: AutocompleteHelper['controller'],\r\n    listType: AutocompleteHelper['listType'],\r\n    onSelect: AutocompleteHelper['onSelect'],\r\n    waitForKey?: AutocompleteHelper['waitForKey']\r\n  }) {\r\n    super(false);\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('autocomplete-helper', 'z-depth-1');\r\n\r\n    options.appendTo.append(this.container);\r\n\r\n    this.attachNavigation();\r\n\r\n    this.controller && this.controller.addHelper(this);\r\n  }\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    if(enabled) {\r\n      this.attach && this.attach();\r\n    } else {\r\n      this.detach && this.detach();\r\n    }\r\n  }\r\n\r\n  protected onVisible = () => {\r\n    if(this.detach) { // it can be so because 'visible' calls before animation's end\r\n      this.detach();\r\n    }\r\n\r\n    const list = this.list;\r\n    const {attach, detach, resetTarget} = attachListNavigation({\r\n      list,\r\n      type: this.listType,\r\n      onSelect: this.onSelect,\r\n      once: true,\r\n      waitForKey: this.waitForKey\r\n    });\r\n\r\n    this.attach = attach;\r\n    this.detach = detach;\r\n    this.resetTarget = resetTarget;\r\n    if(!IS_MOBILE && !this.navigationItem) {\r\n      this.navigationItem = {\r\n        type: 'autocomplete-helper',\r\n        onPop: () => {\r\n          this.navigationItem = undefined;\r\n          this.toggle(true);\r\n        },\r\n        noBlurOnPop: true\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n\r\n    this.addEventListener('hidden', () => {\r\n      this.resetTarget = undefined;\r\n      this.attach = undefined;\r\n      this.detach = undefined;\r\n\r\n      list.innerHTML = '';\r\n      detach();\r\n\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n    }, {once: true});\r\n  };\r\n\r\n  protected attachNavigation() {\r\n    this.addEventListener('visible', this.onVisible);\r\n  }\r\n\r\n  public toggle(hide?: boolean, fromController = false, skipAnimation?: boolean) {\r\n    if(this.init) {\r\n      return;\r\n    }\r\n\r\n    if(hide === undefined) {\r\n      hide = this.container.classList.contains('is-visible') && !this.container.classList.contains('backwards');\r\n    }\r\n\r\n    if(this.hidden === hide) {\r\n      if(!hide) {\r\n        this.dispatchEvent('visible'); // reset target and listener\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    this.hidden = hide;\r\n\r\n    if(!hide) {\r\n      this.controller && this.controller.hideOtherHelpers(this);\r\n      this.dispatchEvent('visible'); // fire it before so target will be set\r\n    } else {\r\n      if(this.navigationItem) {\r\n        appNavigationController.removeItem(this.navigationItem);\r\n        this.navigationItem = undefined;\r\n      }\r\n\r\n      if(!fromController && this.controller) {\r\n        this.controller.hideOtherHelpers();\r\n      }\r\n\r\n      if(this.detach) { // force detach here\r\n        this.detach();\r\n      }\r\n    }\r\n\r\n    const useRafs = this.controller || hide ? 0 : 2;\r\n\r\n    if(hide) {\r\n      this.dispatchEvent('hiding');\r\n    }\r\n\r\n    SetTransition(\r\n      this.container,\r\n      'is-visible',\r\n      !hide,\r\n      rootScope.settings.animationsEnabled && !skipAnimation ? 300 : 0,\r\n      () => {\r\n        this.hidden && this.dispatchEvent('hidden');\r\n      },\r\n      useRafs\r\n    );\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport preloadAnimatedEmojiSticker from '../../helpers/preloadAnimatedEmojiSticker';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport {CHAT_ANIMATION_GROUP} from '../../lib/appManagers/appImManager';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport rootScope from '../../lib/rootScope';\r\nimport {EmoticonsDropdown} from '../emoticonsDropdown';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport attachStickerViewerListeners from '../stickerViewer';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class StickersHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private onChangeScreen: () => void;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      onSelect: async(target) => {\r\n        return !(await EmoticonsDropdown.onMediaClick({target}, true));\r\n      },\r\n      waitForKey: ['ArrowUp', 'ArrowDown']\r\n    });\r\n\r\n    this.container.classList.add('stickers-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', true);\r\n    });\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n\r\n        this.listenerSetter.removeAll();\r\n        this.listenerSetter = undefined;\r\n      }\r\n\r\n      rootScope.dispatchEvent('choosing_sticker', false);\r\n    });\r\n  }\r\n\r\n  public checkEmoticon(emoticon: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    if(this.lazyLoadQueue) {\r\n      this.lazyLoadQueue.clear();\r\n    }\r\n\r\n    preloadAnimatedEmojiSticker(emoticon);\r\n    this.managers.appStickersManager.getStickersByEmoticon(emoticon)\r\n    .then((stickers) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const container = this.list.cloneNode() as HTMLElement;\r\n\r\n      let ready: Promise<void>;\r\n\r\n      this.lazyLoadQueue.clear();\r\n      if(stickers.length) {\r\n        ready = new Promise<void>((resolve) => {\r\n          const promises: Promise<any>[] = [];\r\n          stickers.forEach((sticker) => {\r\n            container.append(this.superStickerRenderer.renderSticker(sticker as MyDocument, undefined, promises));\r\n          });\r\n\r\n          (Promise.all(promises) as Promise<any>).finally(resolve);\r\n        });\r\n      } else {\r\n        ready = Promise.resolve();\r\n      }\r\n\r\n      ready.then(() => {\r\n        this.list.replaceWith(container);\r\n        this.list = container;\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n            this.list.style.width = width + 'px';\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n\r\n          this.listenerSetter = new ListenerSetter();\r\n          attachStickerViewerListeners({listenTo: this.container, listenerSetter: this.listenerSetter});\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!stickers.length);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('stickers-helper-stickers', 'super-stickers');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, CHAT_ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {SEND_WHEN_ONLINE_TIMESTAMP} from '../../lib/mtproto/constants';\r\nimport Button from '../button';\r\nimport PopupDatePicker from './datePicker';\r\n\r\nconst getMinDate = () => {\r\n  const date = new Date();\r\n  // date.setDate(date.getDate() - 1);\r\n  date.setHours(0, 0, 0, 0);\r\n  return date;\r\n};\r\n\r\nconst getMaxDate = () => {\r\n  const date = new Date();\r\n  date.setFullYear(date.getFullYear() + 1);\r\n  date.setDate(date.getDate() - 1);\r\n  return date;\r\n};\r\n\r\nconst checkDate = (date: Date) => {\r\n  return date.getTime() > getMaxDate().getTime() ? new Date() : date;\r\n};\r\n\r\nexport default class PopupSchedule extends PopupDatePicker {\r\n  constructor(initDate: Date, onPick: (timestamp: number) => void, canSendWhenOnline: boolean) {\r\n    super(checkDate(initDate), onPick, {\r\n      noButtons: true,\r\n      noTitle: true,\r\n      closable: true,\r\n      withConfirm: true,\r\n      minDate: getMinDate(),\r\n      maxDate: getMaxDate(),\r\n      withTime: true,\r\n      showOverflowMonths: true,\r\n      confirmShortcutIsSendShortcut: true,\r\n      title: true\r\n    });\r\n\r\n    this.element.classList.add('popup-schedule');\r\n    this.header.append(this.controlsDiv);\r\n    this.title.replaceWith(this.monthTitle);\r\n    this.body.append(this.btnConfirm);\r\n\r\n    if(canSendWhenOnline) {\r\n      const btnSendWhenOnline = Button('btn-primary btn-secondary btn-primary-transparent primary', {text: 'Schedule.SendWhenOnline'});\r\n      this.body.append(btnSendWhenOnline);\r\n\r\n      attachClickEvent(btnSendWhenOnline, () => {\r\n        onPick(SEND_WHEN_ONLINE_TIMESTAMP);\r\n        this.hide();\r\n      });\r\n    }\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n *\r\n * Originally from:\r\n * https://github.com/zhukov/webogram\r\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\r\n * https://github.com/zhukov/webogram/blob/master/LICENSE\r\n */\r\n\r\nimport {MessageEntity} from '../../layer';\r\nimport combineSameEntities from '../../lib/richTextProcessor/combineSameEntities';\r\nimport getRichElementValue from './getRichElementValue';\r\n\r\nexport default function getRichValueWithCaret(field: HTMLElement, withEntities = true) {\r\n  const lines: string[] = [];\r\n  const line: string[] = [];\r\n\r\n  const sel = window.getSelection();\r\n  let selNode: Node;\r\n  let selOffset: number;\r\n  if(sel && sel.rangeCount) {\r\n    const range = sel.getRangeAt(0);\r\n    const startOffset = range.startOffset;\r\n    if(\r\n      range.startContainer &&\r\n      range.startContainer == range.endContainer &&\r\n      startOffset == range.endOffset\r\n    ) {\r\n      // * if focused on img, or caret has been set via placeCaretAtEnd\r\n      const possibleChildrenFocusOffset = startOffset - 1;\r\n      const childNodes = field.childNodes;\r\n      if(range.startContainer === field && childNodes[possibleChildrenFocusOffset]) {\r\n        selNode = childNodes[possibleChildrenFocusOffset];\r\n        selOffset = 0;\r\n\r\n        for(let i = 0; i < range.endOffset; ++i) {\r\n          const node = childNodes[i];\r\n          const value = node.nodeValue || (node as HTMLImageElement).alt;\r\n\r\n          if(value) {\r\n            selOffset += value.length;\r\n          }\r\n        }\r\n      } else {\r\n        selNode = range.startContainer;\r\n        selOffset = startOffset;\r\n      }\r\n    }\r\n  }\r\n\r\n  const entities: MessageEntity[] = withEntities ? [] : undefined;\r\n  getRichElementValue(field, lines, line, selNode, selOffset, entities);\r\n\r\n  if(line.length) {\r\n    lines.push(line.join(''));\r\n  }\r\n\r\n  let value = lines.join('\\n');\r\n  const caretPos = value.indexOf('\\x01');\r\n  if(caretPos != -1) {\r\n    value = value.substr(0, caretPos) + value.substr(caretPos + 1);\r\n  }\r\n  value = value.replace(/\\u00A0/g, ' ');\r\n\r\n  if(entities) {\r\n    combineSameEntities(entities);\r\n  }\r\n\r\n  return {value, entities, caretPos};\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport {appendEmoji, getEmojiFromElement} from '../emoticonsDropdown/tabs/emoji';\r\nimport {ScrollableX} from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\n\r\nexport default class EmojiHelper extends AutocompleteHelper {\r\n  private scrollable: ScrollableX;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    chatInput: ChatInput,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'x',\r\n      onSelect: (target) => {\r\n        chatInput.onEmojiSelected(getEmojiFromElement(target as any), true);\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('emoji-helper');\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('emoji-helper-emojis', 'super-emojis');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new ScrollableX(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollLeft = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(emojis: string[], waitForKey: boolean) {\r\n    if(this.init) {\r\n      if(!emojis.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    emojis = emojis.slice(0, 80);\r\n\r\n    if(emojis.length) {\r\n      this.list.innerHTML = '';\r\n      emojis.forEach((emoji) => {\r\n        appendEmoji(emoji, this.list, false, true);\r\n      });\r\n    }\r\n\r\n    this.waitForKey = waitForKey ? ['ArrowUp', 'ArrowDown'] : undefined;\r\n    this.toggle(!emojis.length);\r\n\r\n    /* window.requestAnimationFrame(() => {\r\n      this.container.style.width = (3 * 2) + (emojis.length * 44) + 'px';\r\n    }); */\r\n  }\r\n\r\n  public checkQuery(query: string, firstChar: string) {\r\n    const middleware = this.controller.getMiddleware();\r\n    this.managers.appEmojiManager.getBothEmojiKeywords().then(async() => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const q = query.replace(/^:/, '');\r\n      const emojis = await this.managers.appEmojiManager.searchEmojis(q);\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      this.render(emojis, firstChar !== ':');\r\n      // console.log(emojis);\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport AvatarElement from '../avatar';\r\nimport PeerTitle from '../peerTitle';\r\nimport Scrollable from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\n\r\nexport default class AutocompletePeerHelper extends AutocompleteHelper {\r\n  protected static BASE_CLASS = 'autocomplete-peer-helper';\r\n  protected static BASE_CLASS_LIST_ELEMENT = AutocompletePeerHelper.BASE_CLASS + '-list-element';\r\n  private scrollable: Scrollable;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    protected className: string,\r\n    onSelect: (target: Element) => boolean | void\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'y',\r\n      onSelect\r\n    });\r\n\r\n    this.container.classList.add(AutocompletePeerHelper.BASE_CLASS, className);\r\n  }\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add(AutocompletePeerHelper.BASE_CLASS + '-list', this.className + '-list');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n  }\r\n\r\n  public render(data: {peerId: PeerId, name?: string, description?: string}[], doNotShow?: boolean) {\r\n    if(this.init) {\r\n      if(!data.length) {\r\n        return;\r\n      }\r\n\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(data.length) {\r\n      this.list.innerHTML = '';\r\n      data.forEach((d) => {\r\n        const div = AutocompletePeerHelper.listElement({\r\n          className: this.className,\r\n          peerId: d.peerId,\r\n          name: d.name,\r\n          description: d.description\r\n        });\r\n\r\n        this.list.append(div);\r\n      });\r\n    }\r\n\r\n    if(!doNotShow) {\r\n      this.toggle(!data.length);\r\n    }\r\n  }\r\n\r\n  public static listElement(options: {\r\n    className: string,\r\n    peerId: PeerId,\r\n    name?: string,\r\n    description?: string\r\n  }) {\r\n    const BASE = AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT;\r\n    options.className += '-list-element';\r\n\r\n    const div = document.createElement('div');\r\n    div.classList.add(BASE, options.className);\r\n    div.dataset.peerId = '' + options.peerId;\r\n\r\n    const avatar = new AvatarElement();\r\n    avatar.classList.add('avatar-30', BASE + '-avatar', options.className + '-avatar');\r\n    avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: options.peerId\r\n    });\r\n\r\n    const name = document.createElement('div');\r\n    name.classList.add(BASE + '-name', options.className + '-name');\r\n    if(!options.name) {\r\n      name.append(new PeerTitle({\r\n        peerId: options.peerId,\r\n        dialog: false,\r\n        onlyFirstName: false,\r\n        plainText: false\r\n      }).element);\r\n    } else {\r\n      setInnerHTML(name, wrapEmojiText(options.name));\r\n    }\r\n\r\n    div.append(avatar, name);\r\n\r\n    if(options.description) {\r\n      const description = document.createElement('div');\r\n      description.classList.add(BASE + '-description', options.className + '-description');\r\n      setInnerHTML(description, wrapEmojiText(options.description));\r\n      div.append(description);\r\n    }\r\n\r\n    return div;\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {BotInfo, ChatFull, UserFull} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport SearchIndex from '../../lib/searchIndex';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport function processPeerFullForCommands(peerId: PeerId, full: ChatFull.chatFull | ChatFull.channelFull | UserFull.userFull, query?: string) {\n  const botInfos: BotInfo.botInfo[] = [].concat(full.bot_info);\n  let index: SearchIndex<string>;\n\n  if(query !== undefined) {\n    index = new SearchIndex<string>({\n      ignoreCase: true\n    });\n  }\n\n  type T = {peerId: PeerId, name: string, description: string, index: number, command: string};\n  const commands: Map<string, T> = new Map();\n  botInfos.forEach((botInfo) => {\n    if(!botInfo.commands) {\n      return;\n    }\n\n    botInfo.commands.forEach(({command, description}, idx) => {\n      const c = '/' + command;\n      commands.set(command, {\n        peerId: botInfo.user_id ? botInfo.user_id.toPeerId(false) : peerId,\n        command: command,\n        name: c,\n        description: description,\n        index: idx\n      });\n\n      if(index) {\n        index.indexObject(command, c);\n      }\n    });\n  });\n\n  let out: T[];\n  if(!index) {\n    out = [...commands.values()];\n  } else {\n    const found = index.search(query);\n    out = Array.from(found).map((command) => commands.get(command));\n  }\n\n  out = out.sort((a, b) => commands.get(a.command).index - commands.get(b.command).index);\n\n  return out;\n}\n\nexport default class CommandsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo,\n      controller,\n      'commands-helper',\n      (target) => {\n        const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n        return chatInput.getReadyToSend(() => {\n          chatInput.messageInput.innerHTML = innerHTML;\n          chatInput.sendMessage(true);\n        });\n      }\n    );\n  }\n\n  public async checkQuery(query: string, peerId: PeerId) {\n    if(!(await this.managers.appUsersManager.isBot(peerId))) {\n      return false;\n    }\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getProfileByPeerId(peerId).then((full) => {\n      if(!middleware()) {\n        return;\n      }\n\n      const filtered = processPeerFullForCommands(peerId, full, query);\n      this.render(filtered);\n      // console.log('found commands', found, filtered);\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\n\r\nexport default class AutocompleteHelperController {\r\n  private helpers: Set<AutocompleteHelper> = new Set();\r\n  private middleware = getMiddleware();\r\n  /* private tempId = 0;\r\n\r\n  public incrementToggleCount() {\r\n    return ++this.tempId;\r\n  }\r\n\r\n  public getToggleCount() {\r\n    return this.tempId;\r\n  } */\r\n\r\n  public toggleListNavigation(enabled: boolean) {\r\n    for(const helper of this.helpers) {\r\n      helper.toggleListNavigation(enabled);\r\n    }\r\n  }\r\n\r\n  public getMiddleware() {\r\n    this.middleware.clean();\r\n    return this.middleware.get();\r\n  }\r\n\r\n  public addHelper(helper: AutocompleteHelper) {\r\n    this.helpers.add(helper);\r\n  }\r\n\r\n  public hideOtherHelpers(preserveHelper?: AutocompleteHelper) {\r\n    this.helpers.forEach((helper) => {\r\n      if(helper !== preserveHelper) {\r\n        helper.toggle(true, true);\r\n      }\r\n    });\r\n\r\n    if(!preserveHelper) {\r\n      this.middleware.clean();\r\n    }\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport type {MessageEntity} from '../../layer';\nimport AutocompleteHelperController from './autocompleteHelperController';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class MentionsHelper extends AutocompletePeerHelper {\n  constructor(\n    appendTo: HTMLElement,\n    controller: AutocompleteHelperController,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(\n      appendTo,\n      controller,\n      'mentions-helper',\n      (target) => {\n        const userId = (target as HTMLElement).dataset.peerId.toUserId();\n        const user = Promise.resolve(managers.appUsersManager.getUser(userId)).then((user) => {\n          let str = '', entity: MessageEntity;\n          if(user.username) {\n            str = '@' + user.username;\n          } else {\n            str = user.first_name || user.last_name;\n            entity = {\n              _: 'messageEntityMentionName',\n              length: str.length,\n              offset: 0,\n              user_id: user.id\n            };\n          }\n\n          str += ' ';\n          chatInput.insertAtCaret(str, entity);\n        });\n      }\n    );\n  }\n\n  public checkQuery(query: string, peerId: PeerId, topMsgId: number) {\n    const trimmed = query.trim(); // check that there is no whitespace\n    if(query.length !== trimmed.length) return false;\n\n    const middleware = this.controller.getMiddleware();\n    this.managers.appProfileManager.getMentions(peerId && peerId.toChatId(), trimmed, topMsgId).then(async(peerIds) => {\n      if(!middleware()) return;\n\n      const username = trimmed.slice(1).toLowerCase();\n\n      const p = peerIds.map(async(peerId) => {\n        const user = await this.managers.appUsersManager.getUser(peerId);\n        if(user.username && user.username.toLowerCase() === username) { // hide full matched suggestion\n          return;\n        }\n\n        return {\n          peerId,\n          description: user.username ? '@' + user.username : undefined\n        };\n      });\n\n      this.render((await Promise.all(p)).filter(Boolean));\n    });\n\n    return true;\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatInput from './input';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport {KeyboardButton, ReplyMarkup} from '../../layer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport findUpAsChild from '../../helpers/dom/findUpAsChild';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport confirmationPopup from '../confirmationPopup';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\n\r\nexport default class ReplyKeyboard extends DropdownHover {\r\n  private static BASE_CLASS = 'reply-keyboard';\r\n  private appendTo: HTMLElement;\r\n  private listenerSetter: ListenerSetter;\r\n  private managers: AppManagers;\r\n  private btnHover: HTMLElement;\r\n  private peerId: PeerId;\r\n  private touchListener: Listener;\r\n  private chatInput: ChatInput;\r\n\r\n  constructor(options: {\r\n    listenerSetter: ListenerSetter,\r\n    managers: AppManagers,\r\n    appendTo: HTMLElement,\r\n    btnHover: HTMLElement,\r\n    chatInput: ChatInput\r\n  }) {\r\n    super({\r\n      element: document.createElement('div')\r\n    });\r\n\r\n    safeAssign(this, options);\r\n\r\n    this.element.classList.add(ReplyKeyboard.BASE_CLASS);\r\n    this.element.style.display = 'none';\r\n\r\n    this.attachButtonListener(this.btnHover, this.listenerSetter);\r\n    this.listenerSetter.add(rootScope)('history_reply_markup', async({peerId}) => {\r\n      if(this.peerId === peerId) {\r\n        if(this.checkAvailability() && this.isActive()) {\r\n          await this.render();\r\n        }\r\n\r\n        getHeavyAnimationPromise().then(() => {\r\n          this.checkForceReply();\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  protected init() {\r\n    this.appendTo.append(this.element);\r\n\r\n    this.listenerSetter.add(this)('open', async() => {\r\n      await this.render();\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        this.touchListener = this.listenerSetter.add(document.body)('touchstart', this.onBodyTouchStart, {passive: false, capture: true}) as any as Listener;\r\n        this.listenerSetter.add(this)('close', () => {\r\n          this.listenerSetter.remove(this.touchListener);\r\n        }, {once: true});\r\n      }\r\n    });\r\n\r\n    attachClickEvent(this.element, (e) => {\r\n      const target = findUpClassName(e.target, 'btn');\r\n      if(!target) {\r\n        return;\r\n      }\r\n\r\n      const type = target.dataset.type as KeyboardButton['_'];\r\n      const {peerId} = this;\r\n      switch(type) {\r\n        case 'keyboardButtonRequestPhone': {\r\n          confirmationPopup({\r\n            titleLangKey: 'ShareYouPhoneNumberTitle',\r\n            button: {\r\n              langKey: 'OK'\r\n            },\r\n            descriptionLangKey: 'AreYouSureShareMyContactInfoBot'\r\n          }).then(() => {\r\n            this.managers.appMessagesManager.sendContact(peerId, rootScope.myId);\r\n          });\r\n          break;\r\n        }\r\n\r\n        default: {\r\n          this.managers.appMessagesManager.sendText(peerId, target.dataset.text);\r\n          break;\r\n        }\r\n      }\r\n\r\n      this.toggle(false);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    return super.init();\r\n  }\r\n\r\n  private onBodyTouchStart = (e: TouchEvent) => {\r\n    const target = e.touches[0].target as HTMLElement;\r\n    if(!findUpAsChild(target, this.element) && target !== this.btnHover) {\r\n      cancelEvent(e);\r\n      this.toggle(false);\r\n    }\r\n  };\r\n\r\n  public async checkForceReply() {\r\n    const replyMarkup = await this.getReplyMarkup();\r\n    if(replyMarkup._ === 'replyKeyboardForceReply' &&\r\n      !replyMarkup.pFlags.hidden &&\r\n      !replyMarkup.pFlags.used) {\r\n      replyMarkup.pFlags.used = true;\r\n      this.chatInput.initMessageReply(replyMarkup.mid);\r\n    }\r\n  }\r\n\r\n  private async getReplyMarkup() {\r\n    return (await this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId)).replyMarkup ?? {\r\n      _: 'replyKeyboardHide'\r\n    };\r\n  }\r\n\r\n  public async render(replyMarkup?: ReplyMarkup.replyKeyboardMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup() as any;\r\n    }\r\n\r\n    this.element.textContent = '';\r\n\r\n    for(const row of replyMarkup.rows) {\r\n      const div = document.createElement('div');\r\n      div.classList.add(ReplyKeyboard.BASE_CLASS + '-row');\r\n\r\n      for(const button of row.buttons) {\r\n        const btn = document.createElement('button');\r\n        btn.classList.add(ReplyKeyboard.BASE_CLASS + '-button', 'btn');\r\n        setInnerHTML(btn, wrapEmojiText(button.text));\r\n        btn.dataset.text = button.text;\r\n        btn.dataset.type = button._;\r\n        div.append(btn);\r\n      }\r\n\r\n      this.element.append(div);\r\n    }\r\n  }\r\n\r\n  public async checkAvailability(replyMarkup?: ReplyMarkup) {\r\n    if(replyMarkup === undefined) {\r\n      replyMarkup = await this.getReplyMarkup();\r\n    }\r\n\r\n    const hide = replyMarkup._ === 'replyKeyboardHide' || !(replyMarkup as ReplyMarkup.replyInlineMarkup).rows?.length;\r\n    this.btnHover.classList.toggle('hide', hide);\r\n\r\n    if(hide) {\r\n      this.toggle(false);\r\n    }\r\n\r\n    return !hide;\r\n  }\r\n\r\n  public setPeer(peerId: PeerId) {\r\n    this.peerId = peerId;\r\n\r\n    this.checkAvailability();\r\n    this.checkForceReply();\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport {WebDocument} from '../../layer';\r\nimport {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport LazyLoadQueue from '../lazyLoadQueue';\r\nimport Scrollable from '../scrollable';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport Button from '../button';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {MyPhoto} from '../../lib/appManagers/appPhotosManager';\r\nimport assumeType from '../../helpers/assumeType';\r\nimport GifsMasonry from '../gifsMasonry';\r\nimport {SuperStickerRenderer} from '../emoticonsDropdown/tabs/stickers';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport readBlobAsDataURL from '../../helpers/blob/readBlobAsDataURL';\r\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\r\nimport renderMediaWithFadeIn from '../../helpers/dom/renderMediaWithFadeIn';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\r\nimport wrapRichText from '../../lib/richTextProcessor/wrapRichText';\r\nimport generateQId from '../../lib/appManagers/utils/inlineBots/generateQId';\r\nimport appDownloadManager from '../../lib/appManagers/appDownloadManager';\r\nimport {AnimationItemGroup} from '../animationIntersector';\r\nimport wrapPhoto from '../wrappers/photo';\r\n\r\nconst ANIMATION_GROUP: AnimationItemGroup = 'INLINE-HELPER';\r\n// const GRID_ITEMS = 5;\r\n\r\nexport default class InlineHelper extends AutocompleteHelper {\r\n  private scrollable: Scrollable;\r\n  private lazyLoadQueue: LazyLoadQueue;\r\n  private gifsMasonry: GifsMasonry;\r\n  private superStickerRenderer: SuperStickerRenderer;\r\n  private onChangeScreen: () => void;\r\n  public checkQuery: (peerId: PeerId, username: string, query: string) => ReturnType<InlineHelper['_checkQuery']>;\r\n\r\n  constructor(\r\n    appendTo: HTMLElement,\r\n    controller: AutocompleteHelperController,\r\n    private chat: Chat,\r\n    private managers: AppManagers\r\n  ) {\r\n    super({\r\n      appendTo,\r\n      controller,\r\n      listType: 'xy',\r\n      waitForKey: ['ArrowUp', 'ArrowDown'],\r\n      onSelect: (target) => {\r\n        if(!target) return false; // can happen when there is only button\r\n        const {peerId, botId, queryId} = this.list.dataset;\r\n        return this.chat.input.getReadyToSend(() => {\r\n          const queryAndResultIds = generateQId(queryId, (target as HTMLElement).dataset.resultId);\r\n          this.managers.appInlineBotsManager.sendInlineResult(peerId.toPeerId(), botId, queryAndResultIds, {\r\n            ...this.chat.getMessageSendingParams(),\r\n            clearDraft: true\r\n          });\r\n\r\n          this.chat.input.onMessageSent(true, true);\r\n        });\r\n      }\r\n    });\r\n\r\n    this.container.classList.add('inline-helper');\r\n\r\n    this.addEventListener('visible', () => {\r\n      setTimeout(() => { // it is not rendered yet\r\n        this.scrollable.container.scrollTop = 0;\r\n      }, 0);\r\n    });\r\n\r\n    this.checkQuery = debounce(this._checkQuery, 200, true, true);\r\n\r\n    this.addEventListener('hidden', () => {\r\n      if(this.onChangeScreen) {\r\n        mediaSizes.removeEventListener('changeScreen', this.onChangeScreen);\r\n        this.onChangeScreen = undefined;\r\n      }\r\n    });\r\n  }\r\n\r\n  public _checkQuery = async(peerId: PeerId, username: string, query: string) => {\r\n    const middleware = this.controller.getMiddleware();\r\n\r\n    const peer = await this.managers.appUsersManager.resolveUsername(username);\r\n    if(!middleware()) {\r\n      throw 'PEER_CHANGED';\r\n    }\r\n\r\n    if(peer._ !== 'user') {\r\n      throw 'NOT_A_BOT';\r\n    }\r\n\r\n    const renderPromise = this.managers.appInlineBotsManager.getInlineResults(peerId, peer.id, query).then((botResults) => {\r\n      if(!middleware()) {\r\n        throw 'PEER_CHANGED';\r\n      }\r\n\r\n      if(this.init) {\r\n        this.init();\r\n        this.init = null;\r\n      }\r\n\r\n      const list = this.list.cloneNode() as HTMLElement;\r\n      list.dataset.peerId = '' + peerId;\r\n      list.dataset.botId = '' + peer.id;\r\n      list.dataset.queryId = '' + botResults.query_id;\r\n\r\n      const gifsMasonry = new GifsMasonry(null, ANIMATION_GROUP, this.scrollable, false);\r\n\r\n      this.lazyLoadQueue.clear();\r\n      this.superStickerRenderer.clear();\r\n\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isGallery = !!botResults.pFlags.gallery;\r\n      // botResults.results.length = 3;\r\n      for(const item of botResults.results) {\r\n        const container = document.createElement('div');\r\n        container.classList.add('inline-helper-result');\r\n        container.dataset.resultId = item.id;\r\n\r\n        const preview = isGallery ? undefined : document.createElement('div');\r\n        if(preview) {\r\n          preview.classList.add('inline-helper-result-preview');\r\n\r\n          container.append(preview);\r\n        }\r\n\r\n        list.append(container);\r\n\r\n        if(!isGallery) {\r\n          preview.classList.add('empty');\r\n          setInnerHTML(preview, wrapEmojiText([...item.title.trim()][0]));\r\n\r\n          const title = document.createElement('div');\r\n          title.classList.add('inline-helper-result-title');\r\n          setInnerHTML(title, wrapEmojiText(item.title));\r\n\r\n          const description = document.createElement('div');\r\n          description.classList.add('inline-helper-result-description');\r\n          setInnerHTML(description, wrapRichText(item.description, {\r\n            noCommands: true,\r\n            noLinks: true\r\n          }));\r\n\r\n          container.append(title, description);\r\n\r\n          const separator = document.createElement('div');\r\n          separator.classList.add('inline-helper-separator');\r\n\r\n          list.append(separator);\r\n        } else {\r\n          container.classList.add('grid-item');\r\n        }\r\n\r\n        if(item._ === 'botInlineResult') {\r\n          if(item.thumb && item.thumb.mime_type.indexOf('image/') === 0) {\r\n            let mediaContainer: HTMLElement;\r\n            if(preview) {\r\n              mediaContainer = document.createElement('div');\r\n              preview.append(mediaContainer);\r\n            } else {\r\n              mediaContainer = container;\r\n            }\r\n\r\n            mediaContainer.classList.add('media-container');\r\n            isGallery && mediaContainer.classList.add('no-border-radius');\r\n\r\n            this.lazyLoadQueue.push({\r\n              div: container,\r\n              load: () => {\r\n                return appDownloadManager.download({\r\n                  dcId: 4,\r\n                  location: {\r\n                    _: 'inputWebFileLocation',\r\n                    access_hash: (item.thumb as WebDocument.webDocument).access_hash,\r\n                    url: item.thumb.url\r\n                  },\r\n                  size: item.thumb.size,\r\n                  mimeType: item.thumb.mime_type\r\n                }).then((blob) => {\r\n                  const image = new Image();\r\n                  image.classList.add('media-photo');\r\n                  readBlobAsDataURL(blob).then((dataURL) => {\r\n                    renderMediaWithFadeIn(mediaContainer, image, dataURL, true);\r\n                  });\r\n                });\r\n              }\r\n            });\r\n          }\r\n        } else {\r\n          const media = item.document as MyDocument || item.photo as MyPhoto;\r\n          if((['sticker', 'gif'] as MyDocument['type'][]).includes((media as MyDocument)?.type) && isGallery) {\r\n            assumeType<MyDocument>(media);\r\n\r\n            if(media.type === 'gif') {\r\n              gifsMasonry.add(media, container);\r\n            } else if(media.type === 'sticker') {\r\n              container.classList.add('super-sticker');\r\n              this.superStickerRenderer.renderSticker(media, container, loadPromises);\r\n              if(media.animated) {\r\n                this.superStickerRenderer.observeAnimated(container);\r\n              }\r\n            }\r\n          } else if(media) {\r\n            const size = isGallery ? 48 : undefined;\r\n            isGallery && container.classList.add('no-border-radius');\r\n            wrapPhoto({\r\n              photo: media,\r\n              container: isGallery ? container : preview,\r\n              boxWidth: size,\r\n              boxHeight: size,\r\n              middleware,\r\n              lazyLoadQueue: this.lazyLoadQueue,\r\n              loadPromises\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      return Promise.all(loadPromises).then(() => {\r\n        if(!middleware()) {\r\n          gifsMasonry.clear();\r\n          return;\r\n        }\r\n\r\n        list.classList.toggle('is-gallery', isGallery);\r\n        list.classList.toggle('super-stickers', isGallery);\r\n        this.container.classList.toggle('is-gallery', isGallery);\r\n\r\n        /* if(isGallery) {\r\n          list.style.gridTemplateColumns = `repeat(${Math.min(botResults.results.length, 4)}, 1fr)`;\r\n        }\r\n\r\n        this.container.style.setProperty('width', isGallery ? `${Math.min(botResults.results.length, 4) * 25}%` : '', 'important'); */\r\n\r\n        const parent = this.list.parentElement;\r\n        parent.textContent = '';\r\n        if(botResults.switch_pm) {\r\n          const btnSwitchToPM = Button('btn-primary btn-secondary btn-primary-transparent primary');\r\n          setInnerHTML(btnSwitchToPM, wrapEmojiText(botResults.switch_pm.text));\r\n          attachClickEvent(btnSwitchToPM, (e) => {\r\n            this.chat.appImManager.setInnerPeer({peerId});\r\n            this.managers.appInlineBotsManager.switchToPM(peerId, peer.id, botResults.switch_pm.start_param);\r\n          });\r\n          parent.append(btnSwitchToPM);\r\n        }\r\n        parent.append(this.list = list);\r\n\r\n        if(this.gifsMasonry) {\r\n          this.gifsMasonry.detach();\r\n        }\r\n        this.gifsMasonry = gifsMasonry;\r\n        gifsMasonry.attach();\r\n\r\n        if(!this.onChangeScreen) {\r\n          this.onChangeScreen = () => {\r\n            if(this.list.classList.contains('is-gallery')) {\r\n              const width = (this.list.childElementCount * mediaSizes.active.esgSticker.width) + (this.list.childElementCount - 1 * 1);\r\n              this.list.style.width = width + 'px';\r\n            } else {\r\n              this.list.style.width = '';\r\n            }\r\n          };\r\n          mediaSizes.addEventListener('changeScreen', this.onChangeScreen);\r\n        }\r\n\r\n        this.onChangeScreen();\r\n\r\n        this.toggle(!botResults.results.length && !botResults.switch_pm);\r\n        this.scrollable.scrollTop = 0;\r\n      });\r\n    });\r\n\r\n    return {user: peer, renderPromise};\r\n  };\r\n\r\n  protected init() {\r\n    this.list = document.createElement('div');\r\n    this.list.classList.add('inline-helper-results');\r\n\r\n    this.container.append(this.list);\r\n\r\n    this.scrollable = new Scrollable(this.container);\r\n    this.lazyLoadQueue = new LazyLoadQueue();\r\n    this.superStickerRenderer = new SuperStickerRenderer(this.lazyLoadQueue, ANIMATION_GROUP, this.managers);\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type ChatInput from './input';\nimport callbackify from '../../helpers/callbackify';\nimport AutocompletePeerHelper from './autocompletePeerHelper';\nimport {processPeerFullForCommands} from './commandsHelper';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst CLASS_NAME = 'bot-commands';\nexport default class ChatBotCommands extends AutocompletePeerHelper {\n  private userId: UserId;\n\n  constructor(\n    appendTo: HTMLElement,\n    chatInput: ChatInput,\n    private managers: AppManagers\n  ) {\n    super(appendTo, undefined, CLASS_NAME, (target) => {\n      const innerHTML = target.querySelector(`.${AutocompletePeerHelper.BASE_CLASS_LIST_ELEMENT}-name`).innerHTML;\n      return chatInput.getReadyToSend(() => {\n        chatInput.messageInput.innerHTML = innerHTML;\n        chatInput.sendMessage(true);\n        this.toggle(true);\n      });\n    });\n  }\n\n  public setUserId(userId: UserId, middleware: () => boolean) {\n    if(this.userId === userId && this.list?.childElementCount) {\n      this.toggle(false);\n      return;\n    }\n\n    this.userId = userId;\n    return callbackify(this.managers.appProfileManager.getProfile(userId), (full) => {\n      if(!middleware()) return;\n      const filtered = processPeerFullForCommands(userId.toPeerId(false), full);\n\n      const PADDING_TOP = 8;\n      // const PADDING_BOTTOM = 8;\n      const PADDING_BOTTOM = 24;\n      const height = filtered.length * 50 + PADDING_TOP + PADDING_BOTTOM;\n      this.container.style.setProperty('--height', height + 'px');\n\n      this.render(filtered);\n\n      // this.container.style.top =\n    });\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {AckedResult} from '../lib/mtproto/superMessagePort';\r\nimport {Modify} from '../types';\r\n\r\nexport default async function modifyAckedResult<T>(acked: AckedResult<T>): Promise<Modify<AckedResult<T>, {result: T | Promise<T>}>> {\r\n  return {\r\n    cached: acked.cached,\r\n    result: acked.cached ? await acked.result : acked.result\r\n  };\r\n}\r\n\r\nexport function modifyAckedPromise<T>(promise: Promise<AckedResult<T>>) {\r\n  return promise.then(modifyAckedResult);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {getMiddleware} from '../../helpers/middleware';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport {ChatFull} from '../../layer';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\r\nimport {i18n} from '../../lib/langPack';\r\nimport {AckedResult} from '../../lib/mtproto/superMessagePort';\r\nimport rootScope from '../../lib/rootScope';\r\nimport AvatarElement from '../avatar';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport PeerTitle from '../peerTitle';\r\nimport SetTransition from '../singleTransition';\r\nimport getChatMembersString from '../wrappers/getChatMembersString';\r\n\r\nconst SEND_AS_ANIMATION_DURATION = 300;\r\n\r\nexport default class ChatSendAs {\r\n  private avatar: AvatarElement;\r\n  private container: HTMLElement;\r\n  private closeBtn: HTMLElement;\r\n  private btnMenu: HTMLElement;\r\n  private sendAsPeerIds: PeerId[];\r\n  private sendAsPeerId: PeerId;\r\n  private updatingPromise: ReturnType<ChatSendAs['updateManual']>;\r\n  private middleware: ReturnType<typeof getMiddleware>;\r\n  private listenerSetter: ListenerSetter;\r\n  private peerId: PeerId;\r\n  private addedListener: boolean;\r\n\r\n  constructor(\r\n    private managers: AppManagers,\r\n    private onReady: (container: HTMLElement, skipAnimation?: boolean) => void,\r\n    private onChange: (sendAsPeerId: PeerId) => void\r\n  ) {\r\n    this.middleware = getMiddleware();\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.construct();\r\n  }\r\n\r\n  private construct() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('new-message-send-as-container');\r\n\r\n    this.closeBtn = document.createElement('div');\r\n    this.closeBtn.classList.add('new-message-send-as-close', 'new-message-send-as-avatar', 'tgico-close');\r\n\r\n    const sendAsButtons: ButtonMenuItemOptions[] = [{\r\n      text: 'SendMessageAsTitle',\r\n      onClick: undefined\r\n    }];\r\n\r\n    let previousAvatar: HTMLElement;\r\n    const onSendAsMenuToggle = (visible: boolean) => {\r\n      if(visible) {\r\n        previousAvatar = this.avatar;\r\n      }\r\n\r\n      const isChanged = this.avatar !== previousAvatar;\r\n      const useRafs = !visible && isChanged ? 2 : 0;\r\n\r\n      SetTransition(this.closeBtn, 'is-visible', visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      if(!isChanged) {\r\n        SetTransition(previousAvatar, 'is-visible', !visible, SEND_AS_ANIMATION_DURATION, undefined, useRafs);\r\n      }\r\n    };\r\n\r\n    ButtonMenuToggle({\r\n      noRipple: true,\r\n      listenerSetter: this.listenerSetter,\r\n      container: this.container\r\n    }, 'top-right', sendAsButtons, () => {\r\n      onSendAsMenuToggle(true);\r\n    }, () => {\r\n      onSendAsMenuToggle(false);\r\n    });\r\n\r\n    sendAsButtons[0].element.classList.add('btn-menu-item-header');\r\n    this.btnMenu = this.container.firstElementChild as any;\r\n    this.btnMenu.classList.add('scrollable', 'scrollable-y');\r\n    this.container.append(this.closeBtn);\r\n  }\r\n\r\n  private async updateButtons(peerIds: PeerId[]) {\r\n    const promises: Promise<ButtonMenuItemOptions>[] = peerIds.map(async(sendAsPeerId, idx) => {\r\n      const textElement = document.createElement('div');\r\n\r\n      const subtitle = document.createElement('div');\r\n      subtitle.classList.add('btn-menu-item-subtitle');\r\n      if(sendAsPeerId.isUser()) {\r\n        subtitle.append(i18n('Chat.SendAs.PersonalAccount'));\r\n      } else if(sendAsPeerId === this.peerId) {\r\n        subtitle.append(i18n('VoiceChat.DiscussionGroup'));\r\n      } else {\r\n        subtitle.append(await getChatMembersString(sendAsPeerId.toChatId()));\r\n      }\r\n\r\n      textElement.append(\r\n        new PeerTitle({peerId: sendAsPeerId}).element,\r\n        subtitle\r\n      );\r\n\r\n      return {\r\n        onClick: idx ? async() => {\r\n          const currentPeerId = this.peerId;\r\n          this.changeSendAsPeerId(sendAsPeerId);\r\n\r\n          const middleware = this.middleware.get();\r\n          const executeButtonsUpdate = () => {\r\n            if(this.sendAsPeerId !== sendAsPeerId || !middleware()) return;\r\n            const peerIds = this.sendAsPeerIds.slice();\r\n            indexOfAndSplice(peerIds, sendAsPeerId);\r\n            peerIds.unshift(sendAsPeerId);\r\n            this.updateButtons(peerIds);\r\n          };\r\n\r\n          if(rootScope.settings.animationsEnabled) {\r\n            setTimeout(executeButtonsUpdate, 250);\r\n          } else {\r\n            executeButtonsUpdate();\r\n          }\r\n\r\n          // return;\r\n          this.managers.appMessagesManager.saveDefaultSendAs(currentPeerId, sendAsPeerId);\r\n        } : undefined,\r\n        textElement\r\n      };\r\n    });\r\n\r\n    const buttons = await Promise.all(promises);\r\n    const btnMenu = ButtonMenu(buttons/* , this.listenerSetter */);\r\n    buttons.forEach((button, idx) => {\r\n      const peerId = peerIds[idx];\r\n      const avatar = new AvatarElement();\r\n      avatar.classList.add('avatar-26', 'btn-menu-item-icon');\r\n      avatar.updateWithOptions({peerId});\r\n\r\n      if(!idx) {\r\n        avatar.classList.add('active');\r\n      }\r\n\r\n      button.element.prepend(avatar);\r\n    });\r\n\r\n    Array.from(this.btnMenu.children).slice(1).forEach((node) => node.remove());\r\n    this.btnMenu.append(...Array.from(btnMenu.children));\r\n  }\r\n\r\n  private async updateAvatar(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    const previousAvatar = this.avatar;\r\n    if(previousAvatar) {\r\n      if(previousAvatar.peerId === sendAsPeerId) {\r\n        return;\r\n      }\r\n    }\r\n\r\n    if(!previousAvatar) {\r\n      skipAnimation = true;\r\n    }\r\n\r\n    const useRafs = skipAnimation ? 0 : 2;\r\n    const duration = skipAnimation ? 0 : SEND_AS_ANIMATION_DURATION;\r\n    const avatar = this.avatar = new AvatarElement();\r\n    avatar.classList.add('new-message-send-as-avatar', 'avatar-30');\r\n    await avatar.updateWithOptions({\r\n      isDialog: false,\r\n      peerId: sendAsPeerId\r\n    });\r\n\r\n    SetTransition(avatar, 'is-visible', true, duration, undefined, useRafs);\r\n    if(previousAvatar) {\r\n      SetTransition(previousAvatar, 'is-visible', false, duration, () => {\r\n        previousAvatar.remove();\r\n      }, useRafs);\r\n    }\r\n\r\n    this.container.append(avatar);\r\n  }\r\n\r\n  private changeSendAsPeerId(sendAsPeerId: PeerId, skipAnimation?: boolean) {\r\n    this.sendAsPeerId = sendAsPeerId;\r\n    this.onChange(sendAsPeerId);\r\n    return this.updateAvatar(sendAsPeerId, skipAnimation);\r\n  }\r\n\r\n  private getDefaultSendAs(): Promise<AckedResult<PeerId>> {\r\n    // return rootScope.myId;\r\n    return this.managers.acknowledged.appProfileManager.getChannelFull(this.peerId.toChatId()).then((acked) => {\r\n      return {\r\n        cached: acked.cached,\r\n        result: acked.result.then((channelFull) => {\r\n          return channelFull.default_send_as ? getPeerId(channelFull.default_send_as) : undefined\r\n        })\r\n      };\r\n    });\r\n  }\r\n\r\n  public async updateManual(skipAnimation?: boolean): Promise<() => void> {\r\n    const peerId = this.peerId;\r\n    if(this.updatingPromise || !(await this.managers.appPeersManager.isChannel(peerId))) {\r\n      return;\r\n    }\r\n\r\n    const middleware = this.middleware.get(() => {\r\n      return !this.updatingPromise || this.updatingPromise === updatingPromise;\r\n    });\r\n\r\n    const {container} = this;\r\n    const chatId = peerId.toChatId();\r\n    const result = (await modifyAckedPromise(this.getDefaultSendAs())).result;\r\n    // const result = Promise.resolve(this.getDefaultSendAs());\r\n\r\n    const wasSkippingAnimation = skipAnimation;\r\n    if(result instanceof Promise) {\r\n      skipAnimation = undefined;\r\n    }\r\n\r\n    const auto = wasSkippingAnimation && !skipAnimation;\r\n\r\n    const updatingPromise = this.updatingPromise = callbackify(result, async(sendAsPeerId) => {\r\n      if(!middleware() || sendAsPeerId === undefined) return;\r\n\r\n      await this.changeSendAsPeerId(sendAsPeerId, skipAnimation);\r\n      if(!middleware()) return;\r\n\r\n      this.managers.appChatsManager.getSendAs(chatId).then((sendAsPeers) => {\r\n        if(!middleware()) return;\r\n\r\n        const peers = sendAsPeers.filter((sendAsPeer) => !sendAsPeer.pFlags.premium_required).map((sendAsPeer) => sendAsPeer.peer);\r\n        const peerIds = peers.map((peer) => getPeerId(peer));\r\n        this.sendAsPeerIds = peerIds.slice();\r\n\r\n        indexOfAndSplice(peerIds, sendAsPeerId);\r\n        peerIds.unshift(sendAsPeerId);\r\n        this.updateButtons(peerIds);\r\n      });\r\n\r\n      const callback = () => {\r\n        this.onReady(container, skipAnimation);\r\n\r\n        if(!this.addedListener) {\r\n          this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\r\n            if(this.peerId === peerId) {\r\n              this.update();\r\n            }\r\n          });\r\n\r\n          this.addedListener = true;\r\n        }\r\n      };\r\n\r\n      if(auto) {\r\n        callback();\r\n        return;\r\n      }\r\n\r\n      return callback;\r\n    });\r\n\r\n    updatingPromise.finally(() => {\r\n      if(this.updatingPromise === updatingPromise) {\r\n        this.updatingPromise = undefined;\r\n      }\r\n    });\r\n\r\n    if(!auto) {\r\n      return updatingPromise;\r\n    }\r\n  }\r\n\r\n  public update(skipAnimation?: boolean) {\r\n    return this.updateManual(skipAnimation).then((callback) => callback && callback());\r\n  }\r\n\r\n  public setPeerId(peerId?: PeerId) {\r\n    /* if(this.avatar) {\r\n      this.avatar.remove();\r\n      this.avatar = undefined;\r\n    } */\r\n\r\n    this.middleware.clean();\r\n    this.updatingPromise = undefined;\r\n    this.peerId = peerId;\r\n  }\r\n\r\n  public destroy() {\r\n    this.container.remove();\r\n    this.setPeerId();\r\n    this.listenerSetter.removeAll();\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {_i18n} from '../lib/langPack';\nimport InputField, {InputFieldOptions} from './inputField';\nimport SetTransition from './singleTransition';\n\nexport default class InputFieldAnimated extends InputField {\n  public inputFake: HTMLElement;\n\n  // public onLengthChange: (length: number, isOverflow: boolean) => void;\n  // protected wasInputFakeClientHeight: number;\n  // protected showScrollDebounced: () => void;\n\n  constructor(options?: InputFieldOptions) {\n    super(options);\n\n    this.input.addEventListener('input', () => {\n      this.inputFake.innerHTML = this.input.innerHTML;\n      this.onFakeInput();\n    });\n\n    if(options.placeholder) {\n      _i18n(this.inputFake, options.placeholder, undefined, 'placeholder');\n    }\n\n    this.input.classList.add('scrollable', 'scrollable-y');\n    // this.wasInputFakeClientHeight = 0;\n    // this.showScrollDebounced = debounce(() => this.input.classList.remove('no-scrollbar'), 150, false, true);\n    this.inputFake = document.createElement('div');\n    this.inputFake.setAttribute('contenteditable', 'true');\n    this.inputFake.className = this.input.className + ' input-field-input-fake';\n  }\n\n  public onFakeInput(setHeight = true) {\n    const {scrollHeight: newHeight/* , clientHeight */} = this.inputFake;\n    /* if(this.wasInputFakeClientHeight && this.wasInputFakeClientHeight !== clientHeight) {\n      this.input.classList.add('no-scrollbar'); // !         ,      reflow   overflow.\n      this.showScrollDebounced();\n    } */\n\n    const currentHeight = +this.input.style.height.replace('px', '');\n    if(currentHeight === newHeight) {\n      return;\n    }\n\n    const TRANSITION_DURATION_FACTOR = 50;\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight))\n    );\n\n    // this.wasInputFakeClientHeight = clientHeight;\n    this.input.style.transitionDuration = `${transitionDuration}ms`;\n\n    if(setHeight) {\n      this.input.style.height = newHeight ? newHeight + 'px' : '';\n    }\n\n    const className = 'is-changing-height';\n    SetTransition(this.input, className, true, transitionDuration, () => {\n      this.input.classList.remove(className);\n    });\n  }\n\n  public setValueSilently(value: string, fromSet?: boolean) {\n    super.setValueSilently(value, fromSet);\n\n    this.inputFake.innerHTML = value;\n    if(!fromSet) {\n      this.onFakeInput();\n    }\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {MyDocument} from '../../lib/appManagers/appDocsManager';\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport type {MyDraftMessage} from '../../lib/appManagers/appDraftsManager';\r\nimport type Chat from './chat';\r\nimport Recorder from '../../../public/recorder.min';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n// import Recorder from '../opus-recorder/dist/recorder.min';\r\nimport opusDecodeController from '../../lib/opusDecodeController';\r\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\r\nimport emoticonsDropdown from '../emoticonsDropdown';\r\nimport PopupCreatePoll from '../popups/createPoll';\r\nimport PopupForward from '../popups/forward';\r\nimport PopupNewMedia from '../popups/newMedia';\r\nimport {toast, toastNew} from '../toast';\r\nimport {MessageEntity, DraftMessage, WebPage, Message, UserFull} from '../../layer';\r\nimport StickersHelper from './stickersHelper';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport ButtonMenuToggle from '../buttonMenuToggle';\r\nimport ListenerSetter, {Listener} from '../../helpers/listenerSetter';\r\nimport Button from '../button';\r\nimport PopupSchedule from '../popups/schedule';\r\nimport SendMenu from './sendContextMenu';\r\nimport rootScope from '../../lib/rootScope';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE, IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport I18n, {i18n, join, LangPackKey} from '../../lib/langPack';\r\nimport {generateTail} from './bubbles';\r\nimport findUpClassName from '../../helpers/dom/findUpClassName';\r\nimport ButtonCorner from '../buttonCorner';\r\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport cancelSelection from '../../helpers/dom/cancelSelection';\r\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getRichValue from '../../helpers/dom/getRichValue';\r\nimport isInputEmpty from '../../helpers/dom/isInputEmpty';\r\nimport isSendShortcutPressed from '../../helpers/dom/isSendShortcutPressed';\r\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getRichValueWithCaret from '../../helpers/dom/getRichValueWithCaret';\r\nimport EmojiHelper from './emojiHelper';\r\nimport CommandsHelper from './commandsHelper';\r\nimport AutocompleteHelperController from './autocompleteHelperController';\r\nimport AutocompleteHelper from './autocompleteHelper';\r\nimport MentionsHelper from './mentionsHelper';\r\nimport fixSafariStickyInput from '../../helpers/dom/fixSafariStickyInput';\r\nimport ReplyKeyboard from './replyKeyboard';\r\nimport InlineHelper from './inlineHelper';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport noop from '../../helpers/noop';\r\nimport {putPreloader} from '../putPreloader';\r\nimport SetTransition from '../singleTransition';\r\nimport PeerTitle from '../peerTitle';\r\nimport {fastRaf} from '../../helpers/schedulers';\r\nimport PopupDeleteMessages from '../popups/deleteMessages';\r\nimport fixSafariStickyInputFocusing, {IS_STICKY_INPUT_BUGGED} from '../../helpers/dom/fixSafariStickyInputFocusing';\r\nimport PopupPeer from '../popups/peer';\r\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\r\nimport appMediaPlaybackController from '../appMediaPlaybackController';\r\nimport {BOT_START_PARAM, NULL_PEER_ID} from '../../lib/mtproto/mtproto_config';\r\nimport setCaretAt from '../../helpers/dom/setCaretAt';\r\nimport CheckboxField from '../checkboxField';\r\nimport DropdownHover from '../../helpers/dropdownHover';\r\nimport RadioForm from '../radioForm';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport toggleDisability from '../../helpers/dom/toggleDisability';\r\nimport callbackify from '../../helpers/callbackify';\r\nimport ChatBotCommands from './botCommands';\r\nimport copy from '../../helpers/object/copy';\r\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\r\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\r\nimport PopupElement from '../popups';\r\nimport getEmojiEntityFromEmoji from '../../lib/richTextProcessor/getEmojiEntityFromEmoji';\r\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\r\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\r\nimport parseMarkdown from '../../lib/richTextProcessor/parseMarkdown';\r\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\r\nimport wrapDraft from '../wrappers/draft';\r\nimport wrapMessageForReply from '../wrappers/messageForReply';\r\nimport getServerMessageId from '../../lib/appManagers/utils/messageId/getServerMessageId';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport contextMenuController from '../../helpers/contextMenuController';\r\nimport {emojiFromCodePoints} from '../../vendor/emoji';\r\nimport {modifyAckedPromise} from '../../helpers/modifyAckedResult';\r\nimport ChatSendAs from './sendAs';\r\nimport filterAsync from '../../helpers/array/filterAsync';\r\nimport InputFieldAnimated from '../inputFieldAnimated';\r\nimport getStickerEffectThumb from '../../lib/appManagers/utils/stickers/getStickerEffectThumb';\r\nimport PopupStickers from '../popups/stickers';\r\nimport wrapPeerTitle from '../wrappers/peerTitle';\r\nimport wrapReply from '../wrappers/reply';\r\n\r\nconst RECORD_MIN_TIME = 500;\r\nconst POSTING_MEDIA_NOT_ALLOWED = 'Posting media content isn\\'t allowed in this group.';\r\n\r\ntype ChatInputHelperType = 'edit' | 'webpage' | 'forward' | 'reply';\r\n\r\nexport default class ChatInput {\r\n  // private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?::|.)(?!.*[:@]).*|(?:[@\\/]\\S*))$/;\r\n  private static AUTO_COMPLETE_REG_EXP = /(\\s|^)((?:(?:@|^\\/)\\S*)|(?::|^[^:@\\/])(?!.*[:@\\/]).*)$/;\r\n  public messageInput: HTMLElement;\r\n  public messageInputField: InputFieldAnimated;\r\n  private fileInput: HTMLInputElement;\r\n  private inputMessageContainer: HTMLDivElement;\r\n  private btnSend: HTMLButtonElement;\r\n  private btnCancelRecord: HTMLButtonElement;\r\n  private lastUrl = '';\r\n  private lastTimeType = 0;\r\n\r\n  public chatInput: HTMLElement;\r\n  public inputContainer: HTMLElement;\r\n  public rowsWrapper: HTMLDivElement;\r\n  private newMessageWrapper: HTMLDivElement;\r\n  private btnToggleEmoticons: HTMLButtonElement;\r\n  private btnToggleReplyMarkup: HTMLButtonElement;\r\n  private btnSendContainer: HTMLDivElement;\r\n\r\n  private replyKeyboard: ReplyKeyboard;\r\n\r\n  private attachMenu: HTMLElement;\r\n  private attachMenuButtons: (ButtonMenuItemOptions & {verify: (peerId: PeerId, threadId: number) => boolean | Promise<boolean>})[];\r\n\r\n  private sendMenu: SendMenu;\r\n\r\n  private replyElements: {\r\n    container: HTMLElement,\r\n    cancelBtn: HTMLButtonElement,\r\n    iconBtn: HTMLButtonElement\r\n  } = {} as any;\r\n\r\n  private forwardElements: {\r\n    changePeer: ButtonMenuItemOptions,\r\n    showSender: ButtonMenuItemOptions,\r\n    hideSender: ButtonMenuItemOptions,\r\n    showCaption: ButtonMenuItemOptions,\r\n    hideCaption: ButtonMenuItemOptions,\r\n    container: HTMLElement,\r\n    modifyArgs?: ButtonMenuItemOptions[]\r\n  };\r\n  private forwardHover: DropdownHover;\r\n  private forwardWasDroppingAuthor: boolean;\r\n\r\n  private getWebPagePromise: Promise<void>;\r\n  private willSendWebPage: WebPage = null;\r\n  private forwarding: {[fromPeerId: PeerId]: number[]};\r\n  public replyToMsgId: number;\r\n  public editMsgId: number;\r\n  public editMessage: Message.message;\r\n  private noWebPage: true;\r\n  public scheduleDate: number;\r\n  public sendSilent: true;\r\n  public startParam: string;\r\n\r\n  private recorder: any;\r\n  public recording = false;\r\n  private recordCanceled = false;\r\n  private recordTimeEl: HTMLElement;\r\n  private recordRippleEl: HTMLElement;\r\n  private recordStartTime = 0;\r\n  private recordingOverlayListener: Listener;\r\n  private recordingNavigationItem: NavigationItem;\r\n\r\n  // private scrollTop = 0;\r\n  // private scrollOffsetTop = 0;\r\n  // private scrollDiff = 0;\r\n\r\n  public helperType: Exclude<ChatInputHelperType, 'webpage'>;\r\n  private helperFunc: () => void | Promise<void>;\r\n  private helperWaitingForward: boolean;\r\n\r\n  public willAttachType: 'document' | 'media';\r\n\r\n  private lockRedo = false;\r\n  private canRedoFromHTML = '';\r\n  private readonly undoHistory: string[] = [];\r\n  private readonly executedHistory: string[] = [];\r\n  private canUndoFromHTML = '';\r\n\r\n  private autocompleteHelperController: AutocompleteHelperController;\r\n  private stickersHelper: StickersHelper;\r\n  private emojiHelper: EmojiHelper;\r\n  private commandsHelper: CommandsHelper;\r\n  private mentionsHelper: MentionsHelper;\r\n  private inlineHelper: InlineHelper;\r\n  private listenerSetter: ListenerSetter;\r\n\r\n  private pinnedControlBtn: HTMLButtonElement;\r\n\r\n  private goDownBtn: HTMLButtonElement;\r\n  private goDownUnreadBadge: HTMLElement;\r\n  private goMentionBtn: HTMLButtonElement;\r\n  private goMentionUnreadBadge: HTMLSpanElement;\r\n  private btnScheduled: HTMLButtonElement;\r\n\r\n  private btnPreloader: HTMLButtonElement;\r\n\r\n  private saveDraftDebounced: () => void;\r\n\r\n  private fakeRowsWrapper: HTMLDivElement;\r\n\r\n  private previousQuery: string;\r\n\r\n  private releaseMediaPlayback: () => void;\r\n\r\n  private botStartBtn: HTMLButtonElement;\r\n  private rowsWrapperWrapper: HTMLDivElement;\r\n  private controlContainer: HTMLElement;\r\n  private fakeSelectionWrapper: HTMLDivElement;\r\n\r\n  private fakeWrapperTo: HTMLElement;\r\n  private toggleBotStartBtnDisability: () => void;\r\n\r\n  private botCommandsToggle: HTMLElement;\r\n  private botCommands: ChatBotCommands;\r\n  private botCommandsIcon: HTMLDivElement;\r\n  private hasBotCommands: boolean;\r\n\r\n  // private activeContainer: HTMLElement;\r\n\r\n  private sendAs: ChatSendAs;\r\n  public sendAsPeerId: PeerId;\r\n\r\n  constructor(\r\n    private chat: Chat,\r\n    private appImManager: AppImManager,\r\n    private managers: AppManagers\r\n  ) {\r\n    this.listenerSetter = new ListenerSetter();\r\n  }\r\n\r\n  public construct() {\r\n    this.chatInput = document.createElement('div');\r\n    this.chatInput.classList.add('chat-input', 'hide');\r\n\r\n    this.inputContainer = document.createElement('div');\r\n    this.inputContainer.classList.add('chat-input-container');\r\n\r\n    this.rowsWrapperWrapper = document.createElement('div');\r\n    this.rowsWrapperWrapper.classList.add('rows-wrapper-wrapper');\r\n\r\n    this.rowsWrapper = document.createElement('div');\r\n    this.rowsWrapper.classList.add('rows-wrapper', 'chat-input-wrapper');\r\n\r\n    this.rowsWrapperWrapper.append(this.rowsWrapper);\r\n\r\n    const tail = generateTail();\r\n    this.rowsWrapper.append(tail);\r\n\r\n    const fakeRowsWrapper = this.fakeRowsWrapper = document.createElement('div');\r\n    fakeRowsWrapper.classList.add('fake-wrapper', 'fake-rows-wrapper');\r\n\r\n    const fakeSelectionWrapper = this.fakeSelectionWrapper = document.createElement('div');\r\n    fakeSelectionWrapper.classList.add('fake-wrapper', 'fake-selection-wrapper');\r\n\r\n    this.inputContainer.append(this.rowsWrapperWrapper, fakeRowsWrapper, fakeSelectionWrapper);\r\n    this.chatInput.append(this.inputContainer);\r\n\r\n    this.goDownBtn = ButtonCorner({icon: 'arrow_down', className: 'bubbles-corner-button bubbles-go-down hide'});\r\n    this.inputContainer.append(this.goDownBtn);\r\n\r\n    attachClickEvent(this.goDownBtn, (e) => {\r\n      cancelEvent(e);\r\n      this.chat.bubbles.onGoDownClick();\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    // * constructor end\r\n\r\n    /* let setScrollTopTimeout: number;\r\n    // @ts-ignore\r\n    let height = window.visualViewport.height; */\r\n    // @ts-ignore\r\n    // this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n    //   const scrollable = this.chat.bubbles.scrollable;\r\n    //   const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n    //   /* if(wasScrolledDown) {\r\n    //     this.saveScroll();\r\n    //   } */\r\n\r\n    //   // @ts-ignore\r\n    //   let newHeight = window.visualViewport.height;\r\n    //   const diff = height - newHeight;\r\n    //   const scrollTop = scrollable.scrollTop;\r\n    //   const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n    //   console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n    //   scrollable.scrollTop = needScrollTop;\r\n\r\n    //   if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n    //   setScrollTopTimeout = window.setTimeout(() => {\r\n    //     const diff = height - newHeight;\r\n    //     const isScrolledDown = scrollable.scrollHeight - Math.round(scrollable.scrollTop + scrollable.container.offsetHeight + diff) <= 1;\r\n    //     height = newHeight;\r\n\r\n    //     scrollable.scrollTop = needScrollTop;\r\n\r\n    //     console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n\r\n    //     /* if(isScrolledDown) {\r\n    //       scrollable.scrollTop = scrollable.scrollHeight;\r\n    //     } */\r\n\r\n    //     //scrollable.scrollTop += diff;\r\n    //     setScrollTopTimeout = 0;\r\n    //   }, 0);\r\n    // });\r\n\r\n    // ! Can't use it with resizeObserver\r\n    /* this.listenerSetter.add(window.visualViewport)('resize', () => {\r\n      const scrollable = this.chat.bubbles.scrollable;\r\n      const wasScrolledDown = scrollable.isScrolledDown;\r\n\r\n      // @ts-ignore\r\n      let newHeight = window.visualViewport.height;\r\n      const diff = height - newHeight;\r\n      const needScrollTop = wasScrolledDown ? scrollable.scrollHeight : scrollable.scrollTop + diff; // * wasScrolledDown     ,     \r\n\r\n      //console.log('resize before', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, wasScrolledDown, scrollable.lastScrollTop, diff, needScrollTop);\r\n\r\n      scrollable.scrollTop = needScrollTop;\r\n      height = newHeight;\r\n\r\n      if(setScrollTopTimeout) clearTimeout(setScrollTopTimeout);\r\n      setScrollTopTimeout = window.setTimeout(() => { // * try again for scrolled down Android Chrome\r\n        scrollable.scrollTop = needScrollTop;\r\n\r\n        //console.log('resize after', scrollable.scrollTop, scrollable.container.clientHeight, scrollable.scrollHeight, scrollable.isScrolledDown, scrollable.lastScrollTop, isScrolledDown);\r\n        setScrollTopTimeout = 0;\r\n      }, 0);\r\n    }); */\r\n\r\n    const c = this.controlContainer = document.createElement('div');\r\n    c.classList.add('chat-input-control', 'chat-input-wrapper');\r\n    this.inputContainer.append(c);\r\n  }\r\n\r\n  public constructPeerHelpers() {\r\n    this.replyElements.container = document.createElement('div');\r\n    this.replyElements.container.classList.add('reply-wrapper');\r\n\r\n    this.replyElements.iconBtn = ButtonIcon('');\r\n    this.replyElements.cancelBtn = ButtonIcon('close reply-cancel', {noRipple: true});\r\n\r\n    this.replyElements.container.append(this.replyElements.iconBtn, this.replyElements.cancelBtn);\r\n\r\n    //\r\n\r\n    const onHideAuthorClick = () => {\r\n      isChangingAuthor = true;\r\n      return this.canToggleHideAuthor();\r\n    };\r\n\r\n    const onHideCaptionClick = () => {\r\n      isChangingAuthor = false;\r\n    };\r\n\r\n    const forwardElements: ChatInput['forwardElements'] = this.forwardElements = {} as any;\r\n    let isChangingAuthor = false;\r\n    const forwardButtons: ButtonMenuItemOptions[] = [\r\n      forwardElements.showSender = {\r\n        text: 'Chat.Alert.Forward.Action.Show1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideSender = {\r\n        text: 'Chat.Alert.Forward.Action.Hide1',\r\n        onClick: onHideAuthorClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.showCaption = {\r\n        text: 'Chat.Alert.Forward.Action.ShowCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: true})\r\n      },\r\n      forwardElements.hideCaption = {\r\n        text: 'Chat.Alert.Forward.Action.HideCaption',\r\n        onClick: onHideCaptionClick,\r\n        checkboxField: new CheckboxField({checked: false})\r\n      },\r\n      forwardElements.changePeer = {\r\n        text: 'Chat.Alert.Forward.Action.Another',\r\n        onClick: () => {\r\n          this.changeForwardRecipient();\r\n        },\r\n        icon: 'replace'\r\n      }\r\n    ];\r\n    const forwardBtnMenu = forwardElements.container = ButtonMenu(forwardButtons, this.listenerSetter);\r\n    // forwardBtnMenu.classList.add('top-center');\r\n\r\n    const children = Array.from(forwardBtnMenu.children) as HTMLElement[];\r\n    const groups: {\r\n      elements: HTMLElement[],\r\n      onChange: (value: string, event: Event) => void\r\n    }[] = [{\r\n      elements: children.slice(0, 2),\r\n      onChange: (value, e) => {\r\n        const checked = !!+value;\r\n        if(isChangingAuthor) {\r\n          this.forwardWasDroppingAuthor = !checked;\r\n        }\r\n\r\n        const replyTitle = this.replyElements.container.querySelector('.reply-title');\r\n        if(replyTitle) {\r\n          const el = replyTitle.firstElementChild as HTMLElement;\r\n          const i = I18n.weakMap.get(el) as I18n.IntlElement;\r\n          const langPackKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n          i.key = langPackKey;\r\n          i.update();\r\n        }\r\n      }\r\n    }, {\r\n      elements: children.slice(2, 4),\r\n      onChange: (value) => {\r\n        const checked = !!+value;\r\n        let b: ButtonMenuItemOptions;\r\n        if(checked && this.forwardWasDroppingAuthor !== undefined) {\r\n          b = this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender;\r\n        } else {\r\n          b = checked ? forwardElements.showSender : forwardElements.hideSender;\r\n        }\r\n\r\n        b.checkboxField.checked = true;\r\n      }\r\n    }];\r\n    groups.forEach((group) => {\r\n      const container = RadioForm(group.elements.map((e) => {\r\n        return {\r\n          container: e,\r\n          input: e.querySelector('input')\r\n        };\r\n      }), group.onChange);\r\n\r\n      const hr = document.createElement('hr');\r\n      container.append(hr);\r\n      forwardBtnMenu.append(container);\r\n    });\r\n\r\n    forwardBtnMenu.append(forwardElements.changePeer.element);\r\n\r\n    if(!IS_TOUCH_SUPPORTED) {\r\n      const forwardHover = this.forwardHover = new DropdownHover({\r\n        element: forwardBtnMenu\r\n      });\r\n    }\r\n\r\n    forwardElements.modifyArgs = forwardButtons.slice(0, -1);\r\n    this.replyElements.container.append(forwardBtnMenu);\r\n\r\n    forwardElements.modifyArgs.forEach((b, idx) => {\r\n      const {input} = b.checkboxField;\r\n      input.type = 'radio';\r\n      input.name = idx < 2 ? 'author' : 'caption';\r\n      input.value = '' + +!(idx % 2);\r\n    });\r\n\r\n    //\r\n\r\n    this.newMessageWrapper = document.createElement('div');\r\n    this.newMessageWrapper.classList.add('new-message-wrapper');\r\n\r\n    this.btnToggleEmoticons = ButtonIcon('none toggle-emoticons', {noRipple: true});\r\n\r\n    this.inputMessageContainer = document.createElement('div');\r\n    this.inputMessageContainer.classList.add('input-message-container');\r\n\r\n    if(this.chat.type === 'chat') {\r\n      this.goDownUnreadBadge = document.createElement('span');\r\n      this.goDownUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goDownBtn.append(this.goDownUnreadBadge);\r\n\r\n      this.goMentionBtn = ButtonCorner({icon: 'mention', className: 'bubbles-corner-button bubbles-go-mention'});\r\n      this.goMentionUnreadBadge = document.createElement('span');\r\n      this.goMentionUnreadBadge.classList.add('badge', 'badge-24', 'badge-primary');\r\n      this.goMentionBtn.append(this.goMentionUnreadBadge);\r\n      this.inputContainer.append(this.goMentionBtn);\r\n\r\n      attachClickEvent(this.goMentionBtn, (e) => {\r\n        cancelEvent(e);\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        this.managers.appMessagesManager.goToNextMention(this.chat.peerId).then((mid) => {\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          if(mid) {\r\n            this.chat.setMessageId(mid);\r\n          }\r\n        });\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.btnScheduled = ButtonIcon('scheduled btn-scheduled float hide', {noRipple: true});\r\n\r\n      attachClickEvent(this.btnScheduled, (e) => {\r\n        this.appImManager.openScheduled(this.chat.peerId);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_new', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.btnScheduled.classList.remove('hide');\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId}) => {\r\n        if(this.chat.peerId !== peerId) {\r\n          return;\r\n        }\r\n\r\n        this.managers.appMessagesManager.getScheduledMessages(this.chat.peerId).then((value) => {\r\n          this.btnScheduled.classList.toggle('hide', !value.length);\r\n        });\r\n      });\r\n\r\n      this.btnToggleReplyMarkup = ButtonIcon('botcom toggle-reply-markup float hide', {noRipple: true});\r\n      this.replyKeyboard = new ReplyKeyboard({\r\n        appendTo: this.rowsWrapper,\r\n        listenerSetter: this.listenerSetter,\r\n        managers: this.managers,\r\n        btnHover: this.btnToggleReplyMarkup,\r\n        chatInput: this\r\n      });\r\n      this.listenerSetter.add(this.replyKeyboard)('open', () => this.btnToggleReplyMarkup.classList.add('active'));\r\n      this.listenerSetter.add(this.replyKeyboard)('close', () => this.btnToggleReplyMarkup.classList.remove('active'));\r\n\r\n      this.botCommands = new ChatBotCommands(this.rowsWrapper, this, this.managers);\r\n      this.botCommandsToggle = document.createElement('div');\r\n      this.botCommandsToggle.classList.add('new-message-bot-commands');\r\n\r\n      const scaler = document.createElement('div');\r\n      scaler.classList.add('new-message-bot-commands-icon-scale');\r\n\r\n      const icon = this.botCommandsIcon = document.createElement('div');\r\n      icon.classList.add('animated-menu-icon', 'animated-menu-close-icon');\r\n      scaler.append(icon);\r\n      this.botCommandsToggle.append(scaler);\r\n\r\n      attachClickEvent(this.botCommandsToggle, (e) => {\r\n        cancelEvent(e);\r\n        const isShown = icon.classList.contains('state-back');\r\n        if(isShown) {\r\n          this.botCommands.toggle(true);\r\n          icon.classList.remove('state-back');\r\n        } else {\r\n          this.botCommands.setUserId(this.chat.peerId.toUserId(), this.chat.bubbles.getMiddleware());\r\n          icon.classList.add('state-back');\r\n        }\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      this.botCommands.addEventListener('visible', () => {\r\n        icon.classList.add('state-back');\r\n      });\r\n\r\n      this.botCommands.addEventListener('hiding', () => {\r\n        icon.classList.remove('state-back');\r\n      });\r\n    }\r\n\r\n    this.attachMenuButtons = [{\r\n      icon: 'image',\r\n      text: 'Chat.Input.Attach.PhotoOrVideo',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        const accept = [...MEDIA_MIME_TYPES_SUPPORTED].join(', ');\r\n        this.fileInput.setAttribute('accept', accept);\r\n        this.willAttachType = 'media';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'document',\r\n      text: 'Chat.Input.Attach.Document',\r\n      onClick: () => {\r\n        this.fileInput.value = '';\r\n        this.fileInput.removeAttribute('accept');\r\n        this.willAttachType = 'document';\r\n        this.fileInput.click();\r\n      },\r\n      verify: () => this.chat.canSend('send_media')\r\n    }, {\r\n      icon: 'poll',\r\n      text: 'Poll',\r\n      onClick: () => {\r\n        PopupElement.createPopup(PopupCreatePoll, this.chat).show();\r\n      },\r\n      verify: (peerId) => peerId.isAnyChat() && this.chat.canSend('send_polls')\r\n    }];\r\n\r\n    this.attachMenu = ButtonMenuToggle({noRipple: true, listenerSetter: this.listenerSetter}, 'top-left', this.attachMenuButtons);\r\n    this.attachMenu.classList.add('attach-file', 'tgico-attach');\r\n    this.attachMenu.classList.remove('tgico-more');\r\n\r\n    // this.inputContainer.append(this.sendMenu);\r\n\r\n    this.recordTimeEl = document.createElement('div');\r\n    this.recordTimeEl.classList.add('record-time');\r\n\r\n    this.fileInput = document.createElement('input');\r\n    this.fileInput.type = 'file';\r\n    this.fileInput.multiple = true;\r\n    this.fileInput.style.display = 'none';\r\n\r\n    this.newMessageWrapper.append(...[this.botCommandsToggle, this.btnToggleEmoticons, this.inputMessageContainer, this.btnScheduled, this.btnToggleReplyMarkup, this.attachMenu, this.recordTimeEl, this.fileInput].filter(Boolean));\r\n\r\n    this.rowsWrapper.append(this.replyElements.container);\r\n    this.autocompleteHelperController = new AutocompleteHelperController();\r\n    this.stickersHelper = new StickersHelper(this.rowsWrapper, this.autocompleteHelperController, this.managers);\r\n    this.emojiHelper = new EmojiHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.commandsHelper = new CommandsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.mentionsHelper = new MentionsHelper(this.rowsWrapper, this.autocompleteHelperController, this, this.managers);\r\n    this.inlineHelper = new InlineHelper(this.rowsWrapper, this.autocompleteHelperController, this.chat, this.managers);\r\n    this.rowsWrapper.append(this.newMessageWrapper);\r\n\r\n    this.btnCancelRecord = ButtonIcon('delete btn-circle z-depth-1 btn-record-cancel');\r\n\r\n    this.btnSendContainer = document.createElement('div');\r\n    this.btnSendContainer.classList.add('btn-send-container');\r\n\r\n    this.recordRippleEl = document.createElement('div');\r\n    this.recordRippleEl.classList.add('record-ripple');\r\n\r\n    this.btnSend = ButtonIcon('none btn-circle z-depth-1 btn-send animated-button-icon');\r\n    this.btnSend.insertAdjacentHTML('afterbegin', `\r\n    <span class=\"tgico tgico-send\"></span>\r\n    <span class=\"tgico tgico-schedule\"></span>\r\n    <span class=\"tgico tgico-check\"></span>\r\n    <span class=\"tgico tgico-microphone_filled\"></span>\r\n    `);\r\n\r\n    this.btnSendContainer.append(this.recordRippleEl, this.btnSend);\r\n\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.sendMenu = new SendMenu({\r\n        onSilentClick: () => {\r\n          this.sendSilent = true;\r\n          this.sendMessage();\r\n        },\r\n        onScheduleClick: () => {\r\n          this.scheduleSending(undefined);\r\n        },\r\n        listenerSetter: this.listenerSetter,\r\n        openSide: 'top-left',\r\n        onContextElement: this.btnSend,\r\n        onOpen: () => {\r\n          return !this.isInputEmpty() || !!Object.keys(this.forwarding).length;\r\n        }\r\n      });\r\n\r\n      this.btnSendContainer.append(this.sendMenu.sendMenu);\r\n    }\r\n\r\n    this.inputContainer.append(this.btnCancelRecord, this.btnSendContainer);\r\n\r\n    emoticonsDropdown.attachButtonListener(this.btnToggleEmoticons, this.listenerSetter);\r\n    this.listenerSetter.add(emoticonsDropdown)('open', this.onEmoticonsOpen);\r\n    this.listenerSetter.add(emoticonsDropdown)('close', this.onEmoticonsClose);\r\n\r\n    this.attachMessageInputField();\r\n\r\n    /* this.attachMenu.addEventListener('mousedown', (e) => {\r\n      const hidden = this.attachMenu.querySelectorAll('.hide');\r\n      if(hidden.length === this.attachMenuButtons.length) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        cancelEvent(e);\r\n        return false;\r\n      }\r\n    }, {passive: false, capture: true}); */\r\n\r\n    this.listenerSetter.add(rootScope)('settings_updated', () => {\r\n      if(this.stickersHelper || this.emojiHelper) {\r\n        // this.previousQuery = undefined;\r\n        this.previousQuery = '';\r\n        this.checkAutocomplete();\r\n        /* if(!rootScope.settings.stickers.suggest) {\r\n          this.stickersHelper.checkEmoticon('');\r\n        } else {\r\n          this.onMessageInput();\r\n        } */\r\n      }\r\n\r\n      if(this.messageInputField) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('draft_updated', ({peerId, threadId, draft, force}) => {\r\n      if(this.chat.threadId !== threadId || this.chat.peerId !== peerId) return;\r\n      this.setDraft(draft, true, force);\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('peer_changing', (chat) => {\r\n      if(this.chat === chat) {\r\n        this.saveDraft();\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(this.appImManager)('chat_changing', ({from, to}) => {\r\n      if(this.chat === from) {\r\n        this.autocompleteHelperController.toggleListNavigation(false);\r\n      } else if(this.chat === to) {\r\n        this.autocompleteHelperController.toggleListNavigation(true);\r\n      }\r\n    });\r\n\r\n    if(this.chat.type === 'scheduled') {\r\n      this.listenerSetter.add(rootScope)('scheduled_delete', ({peerId, mids}) => {\r\n        if(this.chat.peerId === peerId && mids.includes(this.editMsgId)) {\r\n          this.onMessageSent();\r\n        }\r\n      });\r\n    } else {\r\n      this.listenerSetter.add(rootScope)('history_delete', ({peerId, msgs}) => {\r\n        if(this.chat.peerId === peerId) {\r\n          if(msgs.has(this.editMsgId)) {\r\n            this.onMessageSent();\r\n          }\r\n\r\n          if(this.replyToMsgId && msgs.has(this.replyToMsgId)) {\r\n            this.clearHelper('reply');\r\n          }\r\n\r\n          /* if(this.chat.isStartButtonNeeded()) {\r\n            this.setStartParam(BOT_START_PARAM);\r\n          } */\r\n        }\r\n      });\r\n\r\n      this.listenerSetter.add(rootScope)('dialogs_multiupdate', (dialogs) => {\r\n        if(dialogs.has(this.chat.peerId)) {\r\n          if(this.startParam === BOT_START_PARAM) {\r\n            this.setStartParam();\r\n          } else { // updateNewMessage comes earlier than dialog appers\r\n            this.center(true);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    try {\r\n      this.recorder = new Recorder({\r\n        // encoderBitRate: 32,\r\n        // encoderPath: \"../dist/encoderWorker.min.js\",\r\n        encoderSampleRate: 48000,\r\n        monitorGain: 0,\r\n        numberOfChannels: 1,\r\n        recordingGain: 1,\r\n        reuseWorker: true\r\n      });\r\n    } catch(err) {\r\n      console.error('Recorder constructor error:', err);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n\r\n    this.listenerSetter.add(this.fileInput)('change', (e) => {\r\n      const files = (e.target as HTMLInputElement & EventTarget).files;\r\n      if(!files.length) {\r\n        return;\r\n      }\r\n\r\n      PopupElement.createPopup(PopupNewMedia, this.chat, Array.from(files).slice(), this.willAttachType);\r\n      this.fileInput.value = '';\r\n    }, false);\r\n\r\n    /* let time = Date.now();\r\n    this.btnSend.addEventListener('touchstart', (e) => {\r\n      time = Date.now();\r\n    });\r\n\r\n    let eventName1 = 'touchend';\r\n    this.btnSend.addEventListener(eventName1, (e: Event) => {\r\n      //cancelEvent(e);\r\n      console.log(eventName1 + ', time: ' + (Date.now() - time));\r\n    });\r\n\r\n    let eventName = 'mousedown';\r\n    this.btnSend.addEventListener(eventName, (e: Event) => {\r\n      cancelEvent(e);\r\n      console.log(eventName + ', time: ' + (Date.now() - time));\r\n    }); */\r\n    attachClickEvent(this.btnSend, this.onBtnSendClick, {listenerSetter: this.listenerSetter, touchMouseDown: true});\r\n\r\n    if(this.recorder) {\r\n      attachClickEvent(this.btnCancelRecord, this.onCancelRecordClick, {listenerSetter: this.listenerSetter});\r\n\r\n      this.recorder.onstop = () => {\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n        this.recordRippleEl.style.transform = '';\r\n      };\r\n\r\n      this.recorder.ondataavailable = (typedArray: Uint8Array) => {\r\n        if(this.releaseMediaPlayback) {\r\n          this.releaseMediaPlayback();\r\n          this.releaseMediaPlayback = undefined;\r\n        }\r\n\r\n        if(this.recordingOverlayListener) {\r\n          this.listenerSetter.remove(this.recordingOverlayListener);\r\n          this.recordingOverlayListener = undefined;\r\n        }\r\n\r\n        if(this.recordingNavigationItem) {\r\n          appNavigationController.removeItem(this.recordingNavigationItem);\r\n          this.recordingNavigationItem = undefined;\r\n        }\r\n\r\n        if(this.recordCanceled) {\r\n          return;\r\n        }\r\n\r\n        const {peerId, threadId} = this.chat;\r\n        const replyToMsgId = this.replyToMsgId;\r\n\r\n        const duration = (Date.now() - this.recordStartTime) / 1000 | 0;\r\n        const dataBlob = new Blob([typedArray], {type: 'audio/ogg'});\r\n        /* const fileName = new Date().toISOString() + \".opus\";\r\n        console.log('Recorder data received', typedArray, dataBlob); */\r\n\r\n        // let perf = performance.now();\r\n        opusDecodeController.decode(typedArray, true).then((result) => {\r\n          // console.log('WAVEFORM!:', /* waveform,  */performance.now() - perf);\r\n\r\n          opusDecodeController.setKeepAlive(false);\r\n\r\n          //  objectURL    audio/wav\r\n          this.managers.appMessagesManager.sendFile(peerId, dataBlob, {\r\n            isVoiceMessage: true,\r\n            isMedia: true,\r\n            duration,\r\n            waveform: result.waveform,\r\n            objectURL: result.url,\r\n            replyToMsgId,\r\n            threadId,\r\n            clearDraft: true\r\n          });\r\n\r\n          this.onMessageSent(false, true);\r\n        });\r\n      };\r\n    }\r\n\r\n    attachClickEvent(this.replyElements.cancelBtn, this.onHelperCancel, {listenerSetter: this.listenerSetter});\r\n    attachClickEvent(this.replyElements.container, this.onHelperClick, {listenerSetter: this.listenerSetter});\r\n\r\n    this.saveDraftDebounced = debounce(() => this.saveDraft(), 2500, false, true);\r\n\r\n    this.botStartBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button');\r\n    this.botStartBtn.append(i18n('BotStart'));\r\n\r\n    attachClickEvent(this.botStartBtn, () => {\r\n      const {startParam} = this;\r\n      if(startParam === undefined) {\r\n        return;\r\n      }\r\n\r\n      const toggle = this.toggleBotStartBtnDisability = toggleDisability([this.botStartBtn], true);\r\n      const peerId = this.chat.peerId;\r\n      const middleware = this.chat.bubbles.getMiddleware(() => {\r\n        return this.chat.peerId === peerId && this.startParam === startParam && this.toggleBotStartBtnDisability === toggle;\r\n      });\r\n\r\n      this.managers.appMessagesManager.startBot(peerId.toUserId(), undefined, startParam).then(() => {\r\n        if(middleware()) {\r\n          toggle();\r\n          this.toggleBotStartBtnDisability = undefined;\r\n          this.setStartParam();\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.controlContainer.append(this.botStartBtn);\r\n  }\r\n\r\n  public constructPinnedHelpers() {\r\n    this.pinnedControlBtn = Button('btn-primary btn-transparent text-bold chat-input-control-button', {icon: 'unpin'});\r\n    this.controlContainer.append(this.pinnedControlBtn);\r\n\r\n    this.listenerSetter.add(this.pinnedControlBtn)('click', () => {\r\n      const peerId = this.chat.peerId;\r\n\r\n      new PopupPinMessage(peerId, 0, true, () => {\r\n        this.chat.appImManager.setPeer(); // * close tab\r\n\r\n        // ! ,     ,  ,      \r\n        const originalChat = this.chat.appImManager.chat;\r\n        if(originalChat.topbar.pinnedMessage) {\r\n          originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\r\n        }\r\n      });\r\n    });\r\n\r\n    this.chatInput.classList.add('type-pinned');\r\n  }\r\n\r\n  public _center(neededFakeContainer: HTMLElement, animate?: boolean) {\r\n    if(!neededFakeContainer && !this.inputContainer.classList.contains('is-centering')) {\r\n      return;\r\n    }\r\n\r\n    if(neededFakeContainer === this.fakeWrapperTo) {\r\n      return;\r\n    }\r\n\r\n    /* if(neededFakeContainer === this.botStartContainer && this.fakeWrapperTo === this.fakeSelectionWrapper) {\r\n      this.inputContainer.classList.remove('is-centering');\r\n      void this.rowsWrapper.offsetLeft; // reflow\r\n      // this.inputContainer.classList.add('is-centering');\r\n      // void this.rowsWrapper.offsetLeft; // reflow\r\n    } */\r\n\r\n    const fakeSelectionWrapper = neededFakeContainer || this.fakeWrapperTo;\r\n    const forwards = !!neededFakeContainer;\r\n    const oldFakeWrapperTo = this.fakeWrapperTo;\r\n    let transform = '', borderRadius = '', needTranslateX: number;\r\n    // if(forwards) {]\r\n    const fakeSelectionRect = fakeSelectionWrapper.getBoundingClientRect();\r\n    const fakeRowsRect = this.fakeRowsWrapper.getBoundingClientRect();\r\n    const widthFrom = fakeRowsRect.width;\r\n    const widthTo = fakeSelectionRect.width;\r\n\r\n    if(widthFrom !== widthTo) {\r\n      const scale = (widthTo/*  - 8 */) / widthFrom;\r\n      const initTranslateX = (widthFrom - widthTo) / 2;\r\n      needTranslateX = fakeSelectionRect.left - fakeRowsRect.left - initTranslateX;\r\n\r\n      if(forwards) {\r\n        transform = `translateX(${needTranslateX}px) scaleX(${scale})`;\r\n        // transform = `translateX(0px) scaleX(${scale})`;\r\n\r\n        if(scale < 1) {\r\n          const br = 12;\r\n          borderRadius = '' + (br + br * (1 - scale)) + 'px';\r\n        }\r\n      }\r\n      // scale = widthTo / widthFrom;\r\n    }\r\n    // }\r\n\r\n    this.fakeWrapperTo = neededFakeContainer;\r\n\r\n    const duration = animate ? 200 : 0;\r\n    SetTransition(this.inputContainer, 'is-centering', forwards, duration);\r\n    SetTransition(this.rowsWrapperWrapper, 'is-centering-to-control', !!(forwards && neededFakeContainer && neededFakeContainer.classList.contains('chat-input-control')), duration);\r\n    this.rowsWrapper.style.transform = transform;\r\n    this.rowsWrapper.style.borderRadius = borderRadius;\r\n\r\n    return {\r\n      transform,\r\n      borderRadius,\r\n      needTranslateX: oldFakeWrapperTo && (\r\n          (\r\n            neededFakeContainer &&\r\n            neededFakeContainer.classList.contains('chat-input-control') &&\r\n            oldFakeWrapperTo === this.fakeSelectionWrapper\r\n          ) || oldFakeWrapperTo.classList.contains('chat-input-control')\r\n        ) ? needTranslateX * -.5 : needTranslateX,\r\n      widthFrom,\r\n      widthTo\r\n    };\r\n  }\r\n\r\n  public async center(animate = false) {\r\n    return this._center(await this.getNeededFakeContainer(), animate);\r\n  }\r\n\r\n  public setStartParam(startParam?: string) {\r\n    if(this.startParam === startParam) {\r\n      return;\r\n    }\r\n\r\n    this.startParam = startParam;\r\n    this.center(true);\r\n  }\r\n\r\n  public async getNeededFakeContainer(startParam = this.startParam) {\r\n    if(this.chat.selection.isSelecting) {\r\n      return this.fakeSelectionWrapper;\r\n    } else if(\r\n      startParam !== undefined ||\r\n      !(await this.chat.canSend()) ||\r\n      this.chat.type === 'pinned' ||\r\n      await this.chat.isStartButtonNeeded()\r\n    ) {\r\n      return this.controlContainer;\r\n    }\r\n  }\r\n\r\n  // public getActiveContainer() {\r\n  //   if(this.chat.selection.isSelecting) {\r\n  //     return this.chat\r\n  //   }\r\n  //   return this.startParam !== undefined ? this.botStartContainer : this.rowsWrapper;\r\n  // }\r\n\r\n  // public setActiveContainer() {\r\n  //   const container = this.activeContainer;\r\n  //   const newContainer = this.getActiveContainer();\r\n  //   if(newContainer === container) {\r\n  //     return;\r\n  //   }\r\n\r\n\r\n  // }\r\n\r\n  private onCancelRecordClick = (e?: Event) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    this.recordCanceled = true;\r\n    this.recorder.stop();\r\n    opusDecodeController.setKeepAlive(false);\r\n  };\r\n\r\n  private onEmoticonsOpen = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, true);\r\n  };\r\n\r\n  private onEmoticonsClose = () => {\r\n    const toggleClass = IS_TOUCH_SUPPORTED ? 'flip-icon' : 'active';\r\n    this.btnToggleEmoticons.classList.toggle(toggleClass, false);\r\n  };\r\n\r\n  public getReadyToSend(callback: () => void) {\r\n    return this.chat.type === 'scheduled' ? (this.scheduleSending(callback), true) : (callback(), false);\r\n  }\r\n\r\n  public scheduleSending = async(callback: () => void = this.sendMessage.bind(this, true), initDate = new Date()) => {\r\n    const {peerId} = this.chat;\r\n    const middleware = this.chat.bubbles.getMiddleware();\r\n    const canSendWhenOnline = rootScope.myId !== peerId && peerId.isUser() && await this.managers.appUsersManager.isUserOnlineVisible(peerId);\r\n\r\n    new PopupSchedule(initDate, (timestamp) => {\r\n      if(!middleware()) {\r\n        return;\r\n      }\r\n\r\n      const minTimestamp = (Date.now() / 1000 | 0) + 10;\r\n      if(timestamp <= minTimestamp) {\r\n        timestamp = undefined;\r\n      }\r\n\r\n      this.scheduleDate = timestamp;\r\n      callback();\r\n\r\n      if(this.chat.type !== 'scheduled' && timestamp) {\r\n        setTimeout(() => { // ! need timeout here because .forwardMessages will be called after timeout\r\n          if(!middleware()) {\r\n            return;\r\n          }\r\n\r\n          const popups = PopupElement.getPopups(PopupStickers);\r\n          popups.forEach((popup) => popup.hide());\r\n\r\n          this.appImManager.openScheduled(peerId);\r\n        }, 0);\r\n      }\r\n    }, canSendWhenOnline).show();\r\n  };\r\n\r\n  public async setUnreadCount() {\r\n    if(!this.goDownUnreadBadge) {\r\n      return;\r\n    }\r\n\r\n    const dialog = await this.managers.appMessagesManager.getDialogOnly(this.chat.peerId);\r\n    const count = dialog?.unread_count;\r\n    this.goDownUnreadBadge.innerText = '' + (count || '');\r\n    this.goDownUnreadBadge.classList.toggle('badge-gray', await this.managers.appNotificationsManager.isPeerLocalMuted(this.chat.peerId, true));\r\n\r\n    if(this.goMentionUnreadBadge && this.chat.type === 'chat') {\r\n      const hasMentions = !!(dialog?.unread_mentions_count && dialog.unread_count);\r\n      this.goMentionUnreadBadge.innerText = hasMentions ? '' + (dialog.unread_mentions_count) : '';\r\n      this.goMentionBtn.classList.toggle('is-visible', hasMentions);\r\n    }\r\n  }\r\n\r\n  public saveDraft() {\r\n    if(!this.chat.peerId || this.editMsgId || this.chat.type === 'scheduled') return;\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    let draft: DraftMessage.draftMessage;\r\n    if(value.length || this.replyToMsgId) {\r\n      draft = {\r\n        _: 'draftMessage',\r\n        date: tsNow(true),\r\n        message: value,\r\n        entities: entities.length ? entities : undefined,\r\n        pFlags: {\r\n          no_webpage: this.noWebPage\r\n        },\r\n        reply_to_msg_id: this.replyToMsgId\r\n      };\r\n    }\r\n\r\n    this.managers.appDraftsManager.syncDraft(this.chat.peerId, this.chat.threadId, draft);\r\n  }\r\n\r\n  public destroy() {\r\n    // this.chat.log.error('Input destroying');\r\n\r\n    this.listenerSetter.removeAll();\r\n  }\r\n\r\n  public cleanup(helperToo = true) {\r\n    if(!this.chat.peerId) {\r\n      this.chatInput.classList.add('hide');\r\n      this.goDownBtn.classList.add('hide');\r\n    }\r\n\r\n    cancelSelection();\r\n\r\n    this.lastTimeType = 0;\r\n    this.startParam = undefined;\r\n\r\n    if(this.toggleBotStartBtnDisability) {\r\n      this.toggleBotStartBtnDisability();\r\n      this.toggleBotStartBtnDisability = undefined;\r\n    }\r\n\r\n    if(this.messageInput) {\r\n      this.clearInput();\r\n      helperToo && this.clearHelper();\r\n    }\r\n  }\r\n\r\n  public async setDraft(draft?: MyDraftMessage, fromUpdate = true, force = false) {\r\n    if((!force && !isInputEmpty(this.messageInput)) || this.chat.type === 'scheduled') return false;\r\n\r\n    if(!draft) {\r\n      draft = await this.managers.appDraftsManager.getDraft(this.chat.peerId, this.chat.threadId);\r\n\r\n      if(!draft) {\r\n        if(force) { // this situation can only happen when sending message with clearDraft\r\n          /* const height = this.chatInput.getBoundingClientRect().height;\r\n          const willChangeHeight = 78 - height;\r\n          this.willChangeHeight = willChangeHeight; */\r\n          if(this.chat.container.classList.contains('is-helper-active')) {\r\n            this.t();\r\n          }\r\n\r\n          this.messageInputField.inputFake.textContent = '';\r\n          this.messageInputField.onFakeInput(false);\r\n\r\n          ((this.chat.bubbles.messagesQueuePromise || Promise.resolve()) as Promise<any>).then(() => {\r\n            fastRaf(() => {\r\n              this.onMessageSent();\r\n            });\r\n          });\r\n        }\r\n\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const wrappedDraft = wrapDraft(draft);\r\n\r\n    if(this.messageInputField.value === wrappedDraft && this.replyToMsgId === draft.reply_to_msg_id) return false;\r\n\r\n    if(fromUpdate) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.noWebPage = draft.pFlags.no_webpage;\r\n    if(draft.reply_to_msg_id) {\r\n      this.initMessageReply(draft.reply_to_msg_id);\r\n    }\r\n\r\n    this.setInputValue(wrappedDraft, fromUpdate, fromUpdate);\r\n    return true;\r\n  }\r\n\r\n  private createSendAs() {\r\n    this.sendAsPeerId = undefined;\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      let firstChange = true;\r\n      this.sendAs = new ChatSendAs(\r\n        this.managers,\r\n        (container, skipAnimation) => {\r\n          let useRafs = 0;\r\n          if(!container.parentElement) {\r\n            this.newMessageWrapper.prepend(container);\r\n            useRafs = 2;\r\n          }\r\n\r\n          this.updateOffset('as', true, skipAnimation, useRafs);\r\n        },\r\n        (sendAsPeerId) => {\r\n          this.sendAsPeerId = sendAsPeerId;\r\n\r\n          // do not change placeholder earlier than finishPeerChange does\r\n          if(firstChange) {\r\n            firstChange = false;\r\n            return;\r\n          }\r\n\r\n          this.getPlaceholderKey().then((key) => {\r\n            this.updateMessageInputPlaceholder(key);\r\n          });\r\n        }\r\n      );\r\n    } else {\r\n      this.sendAs = undefined;\r\n    }\r\n\r\n    return this.sendAs;\r\n  }\r\n\r\n  public async finishPeerChange(startParam?: string) {\r\n    const peerId = this.chat.peerId;\r\n\r\n    const {forwardElements, btnScheduled, replyKeyboard, sendMenu, goDownBtn, chatInput, botCommandsToggle} = this;\r\n\r\n    const previousSendAs = this.sendAs;\r\n    const sendAs = this.createSendAs();\r\n\r\n    const [\r\n      isBroadcast,\r\n      canPinMessage,\r\n      isBot,\r\n      canSend,\r\n      neededFakeContainer,\r\n      ackedPeerFull,\r\n      ackedScheduledMids,\r\n      setSendAsCallback,\r\n      filteredAttachMenuButtons\r\n    ] = await Promise.all([\r\n      this.managers.appPeersManager.isBroadcast(peerId),\r\n      this.managers.appPeersManager.canPinMessage(peerId),\r\n      this.managers.appPeersManager.isBot(peerId),\r\n      this.chat.canSend(),\r\n      this.getNeededFakeContainer(startParam),\r\n      modifyAckedPromise(this.managers.acknowledged.appProfileManager.getProfileByPeerId(peerId)),\r\n      btnScheduled ? modifyAckedPromise(this.managers.acknowledged.appMessagesManager.getScheduledMessages(peerId)) : undefined,\r\n      sendAs ? (sendAs.setPeerId(this.chat.peerId), sendAs.updateManual(true)) : undefined,\r\n      this.filterAttachMenuButtons()\r\n    ]);\r\n\r\n    const placeholderKey = this.messageInput ? await this.getPlaceholderKey() : undefined;\r\n\r\n    return () => {\r\n      // console.warn('[input] finishpeerchange start');\r\n\r\n      chatInput.classList.remove('hide');\r\n      goDownBtn.classList.toggle('is-broadcast', isBroadcast);\r\n      goDownBtn.classList.remove('hide');\r\n\r\n      if(this.goDownUnreadBadge) {\r\n        this.setUnreadCount();\r\n      }\r\n\r\n      if(this.chat.type === 'pinned') {\r\n        chatInput.classList.toggle('can-pin', canPinMessage);\r\n      }/*  else if(this.chat.type === 'chat') {\r\n      } */\r\n\r\n      if(forwardElements) {\r\n        this.forwardWasDroppingAuthor = false;\r\n        forwardElements.showCaption.checkboxField.setValueSilently(true);\r\n        forwardElements.showSender.checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      if(btnScheduled && ackedScheduledMids) {\r\n        btnScheduled.classList.add('hide');\r\n        const middleware = this.chat.bubbles.getMiddleware();\r\n        callbackify(ackedScheduledMids.result, (mids) => {\r\n          if(!middleware() || !mids) return;\r\n          btnScheduled.classList.toggle('hide', !mids.length);\r\n        });\r\n      }\r\n\r\n      if(this.newMessageWrapper) {\r\n        this.updateOffset(null, false, true);\r\n      }\r\n\r\n      if(botCommandsToggle) {\r\n        this.hasBotCommands = undefined;\r\n        this.botCommands.toggle(true, undefined, true);\r\n        this.updateBotCommandsToggle(true);\r\n        botCommandsToggle.remove();\r\n        if(isBot) {\r\n          const middleware = this.chat.bubbles.getMiddleware();\r\n          const result = ackedPeerFull.result;\r\n          callbackify(result, (userFull) => {\r\n            if(!middleware()) return;\r\n            this.updateBotCommands(userFull as UserFull.userFull, !(result instanceof Promise));\r\n          });\r\n        }\r\n      }\r\n\r\n      if(previousSendAs) {\r\n        previousSendAs.destroy();\r\n      }\r\n\r\n      if(setSendAsCallback) {\r\n        setSendAsCallback();\r\n      }\r\n\r\n      if(replyKeyboard) {\r\n        replyKeyboard.setPeer(peerId);\r\n      }\r\n\r\n      if(sendMenu) {\r\n        sendMenu.setPeerId(peerId);\r\n      }\r\n\r\n      if(this.messageInput) {\r\n        this.updateMessageInput(canSend, placeholderKey, filteredAttachMenuButtons);\r\n      } else if(this.pinnedControlBtn) {\r\n        this.pinnedControlBtn.append(i18n(canPinMessage ? 'Chat.Input.UnpinAll' : 'Chat.Pinned.DontShow'));\r\n      }\r\n\r\n      // * testing\r\n      // this.startParam = this.appPeersManager.isBot(peerId) ? '123' : undefined;\r\n\r\n      this.startParam = startParam;\r\n\r\n      this._center(neededFakeContainer, false);\r\n\r\n      // console.warn('[input] finishpeerchange ends');\r\n    };\r\n  }\r\n\r\n  private updateOffset(type: 'commands' | 'as', forwards: boolean, skipAnimation?: boolean, useRafs?: number) {\r\n    if(type) {\r\n      this.newMessageWrapper.dataset.offset = type;\r\n    } else {\r\n      delete this.newMessageWrapper.dataset.offset;\r\n    }\r\n\r\n    SetTransition(this.newMessageWrapper, 'has-offset', forwards, skipAnimation ? 0 : 300, undefined, useRafs);\r\n  }\r\n\r\n  private updateBotCommands(userFull: UserFull.userFull, skipAnimation?: boolean) {\r\n    this.hasBotCommands = !!userFull.bot_info?.commands?.length;\r\n    this.updateBotCommandsToggle(skipAnimation);\r\n  }\r\n\r\n  private updateBotCommandsToggle(skipAnimation?: boolean) {\r\n    const {botCommandsToggle, hasBotCommands} = this;\r\n\r\n    const show = !!hasBotCommands && this.isInputEmpty();\r\n    if(!hasBotCommands) {\r\n      if(!botCommandsToggle.parentElement) {\r\n        return;\r\n      }\r\n\r\n      botCommandsToggle.remove();\r\n    }\r\n\r\n    const forwards = show;\r\n    const useRafs = botCommandsToggle.parentElement ? 0 : 2;\r\n\r\n    if(!botCommandsToggle.parentElement) {\r\n      this.newMessageWrapper.prepend(botCommandsToggle);\r\n    }\r\n\r\n    this.updateOffset('commands', forwards, skipAnimation, useRafs);\r\n  }\r\n\r\n  private async getPlaceholderKey() {\r\n    const {peerId, threadId} = this.chat;\r\n    let key: LangPackKey;\r\n    if(threadId) {\r\n      key = 'Comment';\r\n    } else if(await this.managers.appPeersManager.isBroadcast(peerId)) {\r\n      key = 'ChannelBroadcast';\r\n    } else if(\r\n      (this.sendAsPeerId !== undefined && this.sendAsPeerId !== rootScope.myId) ||\r\n      await this.managers.appMessagesManager.isAnonymousSending(peerId)\r\n    ) {\r\n      key = 'SendAnonymously';\r\n    } else {\r\n      key = 'Message';\r\n    }\r\n\r\n    return key;\r\n  }\r\n\r\n  private updateMessageInputPlaceholder(key: LangPackKey) {\r\n    // console.warn('[input] update placeholder');\r\n    const i = I18n.weakMap.get(this.messageInput) as I18n.IntlElement;\r\n    if(!i) {\r\n      return;\r\n    }\r\n\r\n    i.compareAndUpdate({key});\r\n  }\r\n\r\n  private filterAttachMenuButtons() {\r\n    if(!this.attachMenuButtons) return;\r\n    const {peerId, threadId} = this.chat;\r\n    return filterAsync(this.attachMenuButtons, (button) => {\r\n      return button.verify(peerId, threadId);\r\n    });\r\n  }\r\n\r\n  public updateMessageInput(canSend: boolean, placeholderKey: LangPackKey, visible: ChatInput['attachMenuButtons']) {\r\n    const {chatInput, attachMenu, messageInput} = this;\r\n    const {peerId, threadId} = this.chat;\r\n    const isHidden = chatInput.classList.contains('is-hidden');\r\n    const willBeHidden = !canSend;\r\n    if(isHidden !== willBeHidden) {\r\n      chatInput.classList.add('no-transition');\r\n      chatInput.classList.toggle('is-hidden', !canSend);\r\n      void chatInput.offsetLeft; // reflow\r\n      chatInput.classList.remove('no-transition');\r\n    }\r\n\r\n    this.updateMessageInputPlaceholder(placeholderKey);\r\n\r\n    this.attachMenuButtons && this.attachMenuButtons.forEach((button) => {\r\n      button.element.classList.toggle('hide', !visible.includes(button));\r\n    });\r\n\r\n    if(!canSend) {\r\n      messageInput.removeAttribute('contenteditable');\r\n    } else {\r\n      messageInput.setAttribute('contenteditable', 'true');\r\n      this.setDraft(undefined, false);\r\n\r\n      if(!messageInput.innerHTML) {\r\n        this.messageInputField.onFakeInput();\r\n      }\r\n    }\r\n\r\n    if(attachMenu) {\r\n      attachMenu.toggleAttribute('disabled', !visible.length);\r\n      attachMenu.classList.toggle('btn-disabled', !visible.length);\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private attachMessageInputField() {\r\n    const oldInputField = this.messageInputField;\r\n    this.messageInputField = new InputFieldAnimated({\r\n      placeholder: 'Message',\r\n      name: 'message',\r\n      withLinebreaks: true\r\n    });\r\n\r\n    this.messageInputField.input.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInputField.inputFake.classList.replace('input-field-input', 'input-message-input');\r\n    this.messageInput = this.messageInputField.input;\r\n    this.messageInput.classList.add('no-scrollbar');\r\n    this.attachMessageInputListeners();\r\n\r\n    if(IS_STICKY_INPUT_BUGGED) {\r\n      fixSafariStickyInputFocusing(this.messageInput);\r\n    }\r\n\r\n    if(oldInputField) {\r\n      oldInputField.input.replaceWith(this.messageInputField.input);\r\n      oldInputField.inputFake.replaceWith(this.messageInputField.inputFake);\r\n    } else {\r\n      this.inputMessageContainer.append(this.messageInputField.input, this.messageInputField.inputFake);\r\n    }\r\n  }\r\n\r\n  private attachMessageInputListeners() {\r\n    this.listenerSetter.add(this.messageInput)('keydown', (e: KeyboardEvent) => {\r\n      const key = e.key;\r\n      if(isSendShortcutPressed(e)) {\r\n        cancelEvent(e);\r\n        this.sendMessage();\r\n      } else if(e.ctrlKey || e.metaKey) {\r\n        this.handleMarkdownShortcut(e);\r\n      } else if((key === 'PageUp' || key === 'PageDown') && !e.shiftKey) { // * fix pushing page to left (Chrome Windows)\r\n        e.preventDefault();\r\n\r\n        if(key === 'PageUp') {\r\n          const range = document.createRange();\r\n          const sel = window.getSelection();\r\n\r\n          range.setStart(this.messageInput.childNodes[0] || this.messageInput, 0);\r\n          range.collapse(true);\r\n\r\n          sel.removeAllRanges();\r\n          sel.addRange(range);\r\n        } else {\r\n          placeCaretAtEnd(this.messageInput);\r\n        }\r\n      }\r\n    });\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      attachClickEvent(this.messageInput, (e) => {\r\n        this.appImManager.selectTab(1); // * set chat tab for album orientation\r\n        // this.saveScroll();\r\n        emoticonsDropdown.toggle(false);\r\n      }, {listenerSetter: this.listenerSetter});\r\n\r\n      /* this.listenerSetter.add(window)('resize', () => {\r\n        this.restoreScroll();\r\n      }); */\r\n\r\n      /* if(isSafari) {\r\n        this.listenerSetter.add(this.messageInput)('mousedown', () => {\r\n          window.requestAnimationFrame(() => {\r\n            window.requestAnimationFrame(() => {\r\n              emoticonsDropdown.toggle(false);\r\n            });\r\n          });\r\n        });\r\n      } */\r\n    }\r\n\r\n    /* this.listenerSetter.add(this.messageInput)('beforeinput', (e: Event) => {\r\n      // * validate due to manual formatting through browser's context menu\r\n      const inputType = (e as InputEvent).inputType;\r\n      //console.log('message beforeinput event', e);\r\n\r\n      if(inputType.indexOf('format') === 0) {\r\n        //console.log('message beforeinput format', e, inputType, this.messageInput.innerHTML);\r\n        const markdownType = inputType.split('format')[1].toLowerCase() as MarkdownType;\r\n        if(this.applyMarkdown(markdownType)) {\r\n          cancelEvent(e); // * cancel legacy markdown event\r\n        }\r\n      }\r\n    }); */\r\n    this.listenerSetter.add(this.messageInput)('input', this.onMessageInput);\r\n    this.listenerSetter.add(this.messageInput)('keyup', () => {\r\n      this.checkAutocomplete();\r\n    });\r\n\r\n    if(this.chat.type === 'chat' || this.chat.type === 'discussion') {\r\n      this.listenerSetter.add(this.messageInput)('focusin', () => {\r\n        if(this.chat.bubbles.scrollable.loadedAll.bottom) {\r\n          this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private prepareDocumentExecute = () => {\r\n    this.executedHistory.push(this.messageInput.innerHTML);\r\n    return () => this.canUndoFromHTML = this.messageInput.innerHTML;\r\n  };\r\n\r\n  private undoRedo = (e: Event, type: 'undo' | 'redo', needHTML: string) => {\r\n    cancelEvent(e); // cancel legacy event\r\n\r\n    let html = this.messageInput.innerHTML;\r\n    if(html && html !== needHTML) {\r\n      this.lockRedo = true;\r\n\r\n      let sameHTMLTimes = 0;\r\n      do {\r\n        document.execCommand(type, false, null);\r\n        const currentHTML = this.messageInput.innerHTML;\r\n        if(html === currentHTML) {\r\n          if(++sameHTMLTimes > 2) { // * unlink, removeFormat (   , :    (  ),  )\r\n            break;\r\n          }\r\n        } else {\r\n          sameHTMLTimes = 0;\r\n        }\r\n\r\n        html = currentHTML;\r\n      } while(html !== needHTML);\r\n\r\n      this.lockRedo = false;\r\n    }\r\n  };\r\n\r\n  public applyMarkdown(type: MarkdownType, href?: string) {\r\n    const MONOSPACE_FONT = 'var(--font-monospace)';\r\n    const SPOILER_FONT = 'spoiler';\r\n    const commandsMap: Partial<{[key in typeof type]: string | (() => void)}> = {\r\n      bold: 'Bold',\r\n      italic: 'Italic',\r\n      underline: 'Underline',\r\n      strikethrough: 'Strikethrough',\r\n      monospace: () => document.execCommand('fontName', false, MONOSPACE_FONT),\r\n      link: href ? () => document.execCommand('createLink', false, href) : () => document.execCommand('unlink', false, null),\r\n      spoiler: () => document.execCommand('fontName', false, SPOILER_FONT)\r\n    };\r\n\r\n    if(!commandsMap[type]) {\r\n      return false;\r\n    }\r\n\r\n    const command = commandsMap[type];\r\n\r\n    // type = 'monospace';\r\n\r\n    const saveExecuted = this.prepareDocumentExecute();\r\n    const executed: any[] = [];\r\n    /**\r\n     * * clear previous formatting, due to Telegram's inability to handle several entities\r\n     */\r\n    /* const checkForSingle = () => {\r\n      const nodes = getSelectedNodes();\r\n      //console.log('Using formatting:', commandsMap[type], nodes, this.executedHistory);\r\n\r\n      const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n      //const differentParents = !!nodes.find((node) => node.parentNode !== firstParent);\r\n      const differentParents = parents.length > 1;\r\n\r\n      let notSingle = false;\r\n      if(differentParents) {\r\n        notSingle = true;\r\n      } else {\r\n        const node = nodes[0];\r\n        if(node && (node.parentNode as HTMLElement) !== this.messageInput && (node.parentNode.parentNode as HTMLElement) !== this.messageInput) {\r\n          notSingle = true;\r\n        }\r\n      }\r\n\r\n      if(notSingle) {\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n        //}\r\n\r\n        executed.push(document.execCommand('unlink', false, null));\r\n        executed.push(document.execCommand('removeFormat', false, null));\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n\r\n        //if(type === 'monospace') {\r\n          executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n        //}\r\n      }\r\n    }; */\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n    const checkType = (type: MarkdownType) => {\r\n      let haveThisType = false;\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const selection = window.getSelection();\r\n      if(!selection.isCollapsed) {\r\n        const range = selection.getRangeAt(0);\r\n        const tag = markdownTags[type];\r\n\r\n        const node = range.commonAncestorContainer;\r\n        if((node.parentNode as HTMLElement).matches(tag.match) || (node instanceof HTMLElement && node.matches(tag.match))) {\r\n          haveThisType = true;\r\n        }\r\n      }\r\n\r\n      return haveThisType;\r\n    };\r\n\r\n    // * monospace can't be combined with different types\r\n    if(type === 'monospace' || type === 'spoiler') {\r\n      // executed.push(document.execCommand('styleWithCSS', false, 'true'));\r\n\r\n      const haveThisType = checkType(type);\r\n      // executed.push(document.execCommand('removeFormat', false, null));\r\n\r\n      if(haveThisType) {\r\n        executed.push(this.resetCurrentFontFormatting());\r\n      } else {\r\n        if(type === 'monospace' || checkType('monospace')) {\r\n          executed.push(this.resetCurrentFormatting());\r\n        }\r\n\r\n        executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n      }\r\n    } else {\r\n      if(checkType('monospace')) {\r\n        executed.push(this.resetCurrentFormatting());\r\n      }\r\n\r\n      executed.push(typeof(command) === 'function' ? command() : document.execCommand(command, false, null));\r\n    }\r\n\r\n    executed.push(document.execCommand('styleWithCSS', false, 'false'));\r\n\r\n    // checkForSingle();\r\n    saveExecuted();\r\n    if(this.appImManager.markupTooltip) {\r\n      this.appImManager.markupTooltip.setActiveMarkupButton();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private resetCurrentFormatting() {\r\n    return document.execCommand('removeFormat', false, null);\r\n  }\r\n\r\n  private resetCurrentFontFormatting() {\r\n    return document.execCommand('fontName', false, 'Roboto');\r\n  }\r\n\r\n  private handleMarkdownShortcut = (e: KeyboardEvent) => {\r\n    // console.log('handleMarkdownShortcut', e);\r\n    const formatKeys: {[key: string]: MarkdownType} = {\r\n      'KeyB': 'bold',\r\n      'KeyI': 'italic',\r\n      'KeyU': 'underline',\r\n      'KeyS': 'strikethrough',\r\n      'KeyM': 'monospace',\r\n      'KeyP': 'spoiler'\r\n    };\r\n\r\n    if(this.appImManager.markupTooltip) {\r\n      formatKeys['KeyK'] = 'link';\r\n    }\r\n\r\n    const code = e.code;\r\n    const applyMarkdown = formatKeys[code];\r\n\r\n    const selection = document.getSelection();\r\n    if(selection.toString().trim().length && applyMarkdown) {\r\n      // * \r\n      if(code === 'KeyK') {\r\n        this.appImManager.markupTooltip.showLinkEditor();\r\n      } else {\r\n        this.applyMarkdown(applyMarkdown);\r\n      }\r\n\r\n      cancelEvent(e); // cancel legacy event\r\n    }\r\n\r\n    // return;\r\n    if(code === 'KeyZ') {\r\n      let html = this.messageInput.innerHTML;\r\n\r\n      if(e.shiftKey) {\r\n        if(this.undoHistory.length) {\r\n          this.executedHistory.push(html);\r\n          html = this.undoHistory.pop();\r\n          this.undoRedo(e, 'redo', html);\r\n          html = this.messageInput.innerHTML;\r\n          this.canRedoFromHTML = this.undoHistory.length ? html : '';\r\n          this.canUndoFromHTML = html;\r\n        }\r\n      } else {\r\n        // * ,        ,     saveExecuted\r\n        if(this.executedHistory.length && (!this.canUndoFromHTML || html === this.canUndoFromHTML)) {\r\n          this.undoHistory.push(html);\r\n          html = this.executedHistory.pop();\r\n          this.undoRedo(e, 'undo', html);\r\n\r\n          // *      ,    -,       \r\n          this.canUndoFromHTML = this.canRedoFromHTML = this.messageInput.innerHTML;\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private onMessageInput = (e?: Event) => {\r\n    // * validate due to manual formatting through browser's context menu\r\n    /* const inputType = (e as InputEvent).inputType;\r\n    console.log('message input event', e);\r\n    if(inputType === 'formatBold') {\r\n      console.log('message input format', this.messageInput.innerHTML);\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(!isSelectionSingle()) {\r\n      alert('not single');\r\n    } */\r\n\r\n    // console.log('messageInput input', this.messageInput.innerText);\r\n    // const value = this.messageInput.innerText;\r\n    const {value: richValue, entities: markdownEntities, caretPos} = getRichValueWithCaret(this.messageInputField.input);\r\n\r\n    // const entities = parseEntities(value);\r\n    const value = parseMarkdown(richValue, markdownEntities, true);\r\n    const entities = mergeEntities(markdownEntities, parseEntities(value));\r\n\r\n    // this.chat.log('messageInput entities', richValue, value, markdownEntities, caretPos);\r\n\r\n    if(this.canRedoFromHTML && !this.lockRedo && this.messageInput.innerHTML !== this.canRedoFromHTML) {\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n    }\r\n\r\n    const urlEntities: Array<MessageEntity.messageEntityUrl | MessageEntity.messageEntityTextUrl> = (!this.editMessage?.media || this.editMessage.media._ === 'messageMediaWebPage') && entities.filter((e) => e._ === 'messageEntityUrl' || e._ === 'messageEntityTextUrl') as any;\r\n    if(urlEntities.length) {\r\n      for(const entity of urlEntities) {\r\n        let url: string;\r\n        if(entity._ === 'messageEntityTextUrl') {\r\n          url = entity.url;\r\n        } else {\r\n          url = richValue.slice(entity.offset, entity.offset + entity.length);\r\n\r\n          if(!(url.includes('http://') || url.includes('https://'))) {\r\n            continue;\r\n          }\r\n        }\r\n\r\n        // console.log('messageInput url:', url);\r\n\r\n        if(this.lastUrl !== url) {\r\n          this.lastUrl = url;\r\n          // this.willSendWebPage = null;\r\n          const promise = this.getWebPagePromise = this.managers.appWebPagesManager.getWebPage(url).then((webpage) => {\r\n            if(this.getWebPagePromise === promise) this.getWebPagePromise = undefined;\r\n            if(this.lastUrl !== url) return;\r\n            if(webpage._  === 'webPage') {\r\n              // console.log('got webpage: ', webpage);\r\n\r\n              this.setTopInfo('webpage', () => {}, webpage.site_name || webpage.title || 'Webpage', webpage.description || webpage.url || '');\r\n              delete this.noWebPage;\r\n              this.willSendWebPage = webpage;\r\n            } else if(this.willSendWebPage) {\r\n              this.onHelperCancel();\r\n            }\r\n          });\r\n        }\r\n\r\n        break;\r\n      }\r\n    } else if(this.lastUrl) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n\r\n      if(this.helperType) {\r\n        this.helperFunc();\r\n      } else {\r\n        this.clearHelper();\r\n      }\r\n    }\r\n\r\n    const isEmpty = !richValue.trim();\r\n    if(isEmpty) {\r\n      if(this.lastTimeType) {\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageCancelAction'});\r\n      }\r\n\r\n      if(this.appImManager.markupTooltip) {\r\n        this.appImManager.markupTooltip.hide();\r\n      }\r\n\r\n      // * Chrome has a bug - it will preserve the formatting if the input with monospace text is cleared\r\n      // * so have to reset formatting\r\n      if(document.activeElement === this.messageInput) {\r\n        // document.execCommand('styleWithCSS', false, 'true');\r\n        setTimeout(() => {\r\n          if(document.activeElement === this.messageInput) {\r\n            this.resetCurrentFontFormatting();\r\n          }\r\n        }, 0);\r\n        // document.execCommand('styleWithCSS', false, 'false');\r\n      }\r\n    } else {\r\n      const time = Date.now();\r\n      if(time - this.lastTimeType >= 6000) {\r\n        this.lastTimeType = time;\r\n        this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: 'sendMessageTypingAction'});\r\n      }\r\n\r\n      if(this.botCommands) {\r\n        this.botCommands.toggle(true);\r\n      }\r\n    }\r\n\r\n    if(this.botCommands) {\r\n      this.updateBotCommandsToggle();\r\n    }\r\n\r\n    if(!this.editMsgId) {\r\n      this.saveDraftDebounced();\r\n    }\r\n\r\n    this.checkAutocomplete(richValue, caretPos, entities);\r\n\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  public insertAtCaret(insertText: string, insertEntity?: MessageEntity, isHelper = true) {\r\n    const {value: fullValue, caretPos, entities} = getRichValueWithCaret(this.messageInput);\r\n    const pos = caretPos >= 0 ? caretPos : fullValue.length;\r\n    const prefix = fullValue.substr(0, pos);\r\n    const suffix = fullValue.substr(pos);\r\n\r\n    const matches = isHelper ? prefix.match(ChatInput.AUTO_COMPLETE_REG_EXP) : null;\r\n\r\n    const matchIndex = matches ? matches.index + (matches[0].length - matches[2].length) : prefix.length;\r\n    const newPrefix = prefix.slice(0, matchIndex);\r\n    const newValue = newPrefix + insertText + suffix;\r\n\r\n    // merge emojis\r\n    const hadEntities = parseEntities(fullValue);\r\n    mergeEntities(entities, hadEntities);\r\n\r\n    // max for additional whitespace\r\n    const insertLength = insertEntity ? Math.max(insertEntity.length, insertText.length) : insertText.length;\r\n    const addEntities: MessageEntity[] = [];\r\n    if(insertEntity) {\r\n      addEntities.push(insertEntity);\r\n      insertEntity.offset = matchIndex;\r\n    }\r\n\r\n    // add offset to entities next to emoji\r\n    const diff = matches ? insertLength - matches[2].length : insertLength;\r\n    entities.forEach((entity) => {\r\n      if(entity.offset >= matchIndex) {\r\n        entity.offset += diff;\r\n      }\r\n    });\r\n\r\n    mergeEntities(entities, addEntities);\r\n\r\n    if(/* caretPos !== -1 && caretPos !== fullValue.length */true) {\r\n      const caretEntity: MessageEntity.messageEntityCaret = {\r\n        _: 'messageEntityCaret',\r\n        offset: matchIndex + insertLength,\r\n        length: 0\r\n      };\r\n\r\n      let insertCaretAtIndex = 0;\r\n      for(let length = entities.length; insertCaretAtIndex < length; ++insertCaretAtIndex) {\r\n        const entity = entities[insertCaretAtIndex];\r\n        if(entity.offset > caretEntity.offset) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      entities.splice(insertCaretAtIndex, 0, caretEntity);\r\n    }\r\n\r\n    // const saveExecuted = this.prepareDocumentExecute();\r\n    // can't exec .value here because it will instantly check for autocomplete\r\n    const value = documentFragmentToHTML(wrapDraftText(newValue, {entities}));\r\n    this.messageInputField.setValueSilently(value);\r\n\r\n    const caret = this.messageInput.querySelector('.composer-sel');\r\n    if(caret) {\r\n      setCaretAt(caret);\r\n      caret.remove();\r\n    }\r\n\r\n    // but it's needed to be checked only here\r\n    this.onMessageInput();\r\n\r\n    // saveExecuted();\r\n\r\n    // document.execCommand('insertHTML', true, wrapEmojiText(emoji));\r\n  }\r\n\r\n  public onEmojiSelected = (emoji: string, autocomplete: boolean) => {\r\n    this.insertAtCaret(emoji, getEmojiEntityFromEmoji(emoji), autocomplete);\r\n  };\r\n\r\n  private async checkAutocomplete(value?: string, caretPos?: number, entities?: MessageEntity[]) {\r\n    // return;\r\n\r\n    if(value === undefined) {\r\n      const r = getRichValueWithCaret(this.messageInputField.input, true);\r\n      value = r.value;\r\n      caretPos = r.caretPos;\r\n      entities = r.entities;\r\n    }\r\n\r\n    if(caretPos === -1) {\r\n      caretPos = value.length;\r\n    }\r\n\r\n    if(entities === undefined) {\r\n      const _value = parseMarkdown(value, entities, true);\r\n      entities = mergeEntities(entities, parseEntities(_value));\r\n    }\r\n\r\n    value = value.slice(0, caretPos);\r\n\r\n    if(this.previousQuery === value) {\r\n      return;\r\n    }\r\n\r\n    this.previousQuery = value;\r\n\r\n    const matches = value.match(ChatInput.AUTO_COMPLETE_REG_EXP);\r\n    let foundHelper: AutocompleteHelper;\r\n    if(matches) {\r\n      const entity = entities[0];\r\n\r\n      let query = matches[2];\r\n      const firstChar = query[0];\r\n\r\n      if(this.stickersHelper &&\r\n        rootScope.settings.stickers.suggest &&\r\n        await this.chat.canSend('send_stickers') &&\r\n        entity?._ === 'messageEntityEmoji' && entity.length === value.length && !entity.offset) {\r\n        foundHelper = this.stickersHelper;\r\n        this.stickersHelper.checkEmoticon(value);\r\n      } else if(firstChar === '@') { // mentions\r\n        const topMsgId = this.chat.threadId ? getServerMessageId(this.chat.threadId) : undefined;\r\n        if(await this.mentionsHelper.checkQuery(query, this.chat.peerId.isUser() ? NULL_PEER_ID : this.chat.peerId, topMsgId)) {\r\n          foundHelper = this.mentionsHelper;\r\n        }\r\n      } else if(!matches[1] && firstChar === '/') { // commands\r\n        if(await this.commandsHelper.checkQuery(query, this.chat.peerId)) {\r\n          foundHelper = this.commandsHelper;\r\n        }\r\n      } else if(rootScope.settings.emoji.suggest) { // emoji\r\n        query = query.replace(/^\\s*/, '');\r\n        if(!value.match(/^\\s*:(.+):\\s*$/) && !value.match(/:[;!@#$%^&*()-=|]/) && query) {\r\n          foundHelper = this.emojiHelper;\r\n          this.emojiHelper.checkQuery(query, firstChar);\r\n        }\r\n      }\r\n    }\r\n\r\n    foundHelper = this.checkInlineAutocomplete(value, foundHelper);\r\n\r\n    this.autocompleteHelperController.hideOtherHelpers(foundHelper);\r\n  }\r\n\r\n  private checkInlineAutocomplete(value: string, foundHelper?: AutocompleteHelper): AutocompleteHelper {\r\n    let needPlaceholder = false;\r\n\r\n    if(!foundHelper) {\r\n      const inlineMatch = value.match(/^@([a-zA-Z\\\\d_]{3,32})\\s/);\r\n      if(inlineMatch) {\r\n        const username = inlineMatch[1];\r\n        const query = value.slice(inlineMatch[0].length);\r\n        needPlaceholder = inlineMatch[0].length === value.length;\r\n\r\n        foundHelper = this.inlineHelper;\r\n\r\n        if(!this.btnPreloader) {\r\n          this.btnPreloader = ButtonIcon('none btn-preloader float show disable-hover', {noRipple: true});\r\n          putPreloader(this.btnPreloader, true);\r\n          this.inputMessageContainer.parentElement.insertBefore(this.btnPreloader, this.inputMessageContainer.nextSibling);\r\n        } else {\r\n          SetTransition(this.btnPreloader, 'show', true, 400);\r\n        }\r\n\r\n        this.inlineHelper.checkQuery(this.chat.peerId, username, query).then(({user, renderPromise}) => {\r\n          if(needPlaceholder && user.bot_inline_placeholder) {\r\n            this.messageInput.dataset.inlinePlaceholder = user.bot_inline_placeholder;\r\n          }\r\n\r\n          renderPromise.then(() => {\r\n            SetTransition(this.btnPreloader, 'show', false, 400);\r\n          });\r\n        }).catch(noop);\r\n      }\r\n    }\r\n\r\n    if(!needPlaceholder) {\r\n      delete this.messageInput.dataset.inlinePlaceholder;\r\n    }\r\n\r\n    if(foundHelper !== this.inlineHelper) {\r\n      if(this.btnPreloader) {\r\n        SetTransition(this.btnPreloader, 'show', false, 400);\r\n      }\r\n    }\r\n\r\n    return foundHelper;\r\n  }\r\n\r\n  private setRecording(value: boolean) {\r\n    if(this.recording === value) {\r\n      return;\r\n    }\r\n\r\n    SetTransition(this.chatInput, 'is-recording', value, 200);\r\n    this.recording = value;\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  private onBtnSendClick = async(e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!this.recorder || this.recording || !this.isInputEmpty() || this.forwarding || this.editMsgId) {\r\n      if(this.recording) {\r\n        if((Date.now() - this.recordStartTime) < RECORD_MIN_TIME) {\r\n          this.onCancelRecordClick();\r\n        } else {\r\n          this.recorder.stop();\r\n        }\r\n      } else {\r\n        this.sendMessage();\r\n      }\r\n    } else {\r\n      const isAnyChat = this.chat.peerId.isAnyChat();\r\n      if(isAnyChat && !(await this.chat.canSend('send_media'))) {\r\n        toast(POSTING_MEDIA_NOT_ALLOWED);\r\n        return;\r\n      }\r\n\r\n      this.chatInput.classList.add('is-locked');\r\n      blurActiveElement();\r\n\r\n      let restricted = false;\r\n      if(!isAnyChat) {\r\n        const userFull = await this.managers.appProfileManager.getProfile(this.chat.peerId.toUserId());\r\n        if(userFull?.pFlags.voice_messages_forbidden) {\r\n          toastNew({\r\n            langPackKey: 'Chat.SendVoice.PrivacyError',\r\n            langPackArguments: [await wrapPeerTitle({peerId: this.chat.peerId})]\r\n          });\r\n          restricted = true;\r\n        }\r\n      }\r\n\r\n      if(restricted) {\r\n        this.chatInput.classList.remove('is-locked');\r\n        return;\r\n      }\r\n\r\n      this.recorder.start().then(() => {\r\n        this.releaseMediaPlayback = appMediaPlaybackController.setSingleMedia();\r\n        this.recordCanceled = false;\r\n\r\n        this.setRecording(true);\r\n        opusDecodeController.setKeepAlive(true);\r\n\r\n        const showDiscardPopup = () => {\r\n          new PopupPeer('popup-cancel-record', {\r\n            titleLangKey: 'DiscardVoiceMessageTitle',\r\n            descriptionLangKey: 'DiscardVoiceMessageDescription',\r\n            buttons: [{\r\n              langKey: 'DiscardVoiceMessageAction',\r\n              callback: () => {\r\n                simulateClickEvent(this.btnCancelRecord);\r\n              }\r\n            }, {\r\n              langKey: 'Continue',\r\n              isCancel: true\r\n            }]\r\n          }).show();\r\n        };\r\n\r\n        this.recordingOverlayListener = this.listenerSetter.add(document.body)('mousedown', (e) => {\r\n          if(!findUpClassName(e.target, 'chat-input') && !findUpClassName(e.target, 'popup-cancel-record')) {\r\n            cancelEvent(e);\r\n            showDiscardPopup();\r\n          }\r\n        }, {capture: true, passive: false}) as any;\r\n\r\n        appNavigationController.pushItem(this.recordingNavigationItem = {\r\n          type: 'voice',\r\n          onPop: () => {\r\n            setTimeout(() => {\r\n              showDiscardPopup();\r\n            }, 0);\r\n\r\n            return false;\r\n          }\r\n        });\r\n\r\n        this.recordStartTime = Date.now();\r\n\r\n        const sourceNode: MediaStreamAudioSourceNode = this.recorder.sourceNode;\r\n        const context = sourceNode.context;\r\n\r\n        const analyser = context.createAnalyser();\r\n        sourceNode.connect(analyser);\r\n        // analyser.connect(context.destination);\r\n        analyser.fftSize = 32;\r\n\r\n        const frequencyData = new Uint8Array(analyser.frequencyBinCount);\r\n        const max = frequencyData.length * 255;\r\n        const min = 54 / 150;\r\n        const r = () => {\r\n          if(!this.recording) return;\r\n\r\n          analyser.getByteFrequencyData(frequencyData);\r\n\r\n          let sum = 0;\r\n          frequencyData.forEach((value) => {\r\n            sum += value;\r\n          });\r\n\r\n          const percents = Math.min(1, (sum / max) + min);\r\n          // console.log('frequencyData', frequencyData, percents);\r\n\r\n          this.recordRippleEl.style.transform = `scale(${percents})`;\r\n\r\n          const diff = Date.now() - this.recordStartTime;\r\n          const ms = diff % 1000;\r\n\r\n          const formatted = toHHMMSS(diff / 1000) + ',' + ('00' + Math.round(ms / 10)).slice(-2);\r\n\r\n          this.recordTimeEl.innerText = formatted;\r\n\r\n          fastRaf(r);\r\n        };\r\n\r\n        r();\r\n      }).catch((e: Error) => {\r\n        switch(e.name as string) {\r\n          case 'NotAllowedError': {\r\n            toast('Please allow access to your microphone');\r\n            break;\r\n          }\r\n\r\n          case 'NotReadableError': {\r\n            toast(e.message);\r\n            break;\r\n          }\r\n\r\n          default:\r\n            console.error('Recorder start error:', e, e.name, e.message);\r\n            toast(e.message);\r\n            break;\r\n        }\r\n\r\n        this.setRecording(false);\r\n        this.chatInput.classList.remove('is-locked');\r\n      });\r\n    }\r\n  };\r\n\r\n  private onHelperCancel = async(e?: Event, force?: boolean) => {\r\n    if(e) {\r\n      cancelEvent(e);\r\n    }\r\n\r\n    if(this.willSendWebPage) {\r\n      const lastUrl = this.lastUrl;\r\n      let needReturn = false;\r\n      if(this.helperType) {\r\n        // if(this.helperFunc) {\r\n        await this.helperFunc();\r\n        // }\r\n\r\n        needReturn = true;\r\n      }\r\n\r\n      // * restore values\r\n      this.lastUrl = lastUrl;\r\n      this.noWebPage = true;\r\n      this.willSendWebPage = null;\r\n\r\n      if(needReturn) return;\r\n    }\r\n\r\n    if(this.helperType === 'edit' && !force) {\r\n      const message = this.editMessage\r\n      const value = parseMarkdown(this.messageInputField.value, []);\r\n      if(message.message !== value) {\r\n        new PopupPeer('discard-editing', {\r\n          buttons: [{\r\n            langKey: 'Alert.Confirm.Discard',\r\n            callback: () => {\r\n              this.onHelperCancel(undefined, true);\r\n            }\r\n          }],\r\n          descriptionLangKey: 'Chat.Edit.Cancel.Text'\r\n        }).show();\r\n\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n  };\r\n\r\n  private onHelperClick = (e: Event) => {\r\n    cancelEvent(e);\r\n\r\n    if(!findUpClassName(e.target, 'reply')) return;\r\n    if(this.helperType === 'forward') {\r\n      const {forwardElements} = this;\r\n      if(forwardElements && IS_TOUCH_SUPPORTED && !forwardElements.container.classList.contains('active')) {\r\n        contextMenuController.openBtnMenu(forwardElements.container);\r\n      }\r\n    } else if(this.helperType === 'reply') {\r\n      this.chat.setMessageId(this.replyToMsgId);\r\n    } else if(this.helperType === 'edit') {\r\n      this.chat.setMessageId(this.editMsgId);\r\n    }\r\n  };\r\n\r\n  private changeForwardRecipient() {\r\n    if(this.helperWaitingForward) return;\r\n    this.helperWaitingForward = true;\r\n\r\n    const forwarding = copy(this.forwarding);\r\n    const helperFunc = this.helperFunc;\r\n    this.clearHelper();\r\n    this.updateSendBtn();\r\n    let selected = false;\r\n    const popup = new PopupForward(forwarding, () => {\r\n      selected = true;\r\n    });\r\n\r\n    popup.addEventListener('close', () => {\r\n      this.helperWaitingForward = false;\r\n\r\n      if(!selected) {\r\n        helperFunc();\r\n      }\r\n    });\r\n  }\r\n\r\n  public async clearInput(canSetDraft = true, fireEvent = true, clearValue = '') {\r\n    if(document.activeElement === this.messageInput && IS_MOBILE_SAFARI) { // fix first char uppercase\r\n      const i = document.createElement('input');\r\n      document.body.append(i);\r\n      fixSafariStickyInput(i);\r\n      this.messageInputField.setValueSilently(clearValue);\r\n      fixSafariStickyInput(this.messageInput);\r\n      i.remove();\r\n    } else {\r\n      this.messageInputField.setValueSilently(clearValue);\r\n    }\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      // this.messageInput.innerText = '';\r\n    } else {\r\n      // this.attachMessageInputField();\r\n      // this.messageInput.innerText = '';\r\n\r\n      // clear executions\r\n      this.canRedoFromHTML = '';\r\n      this.undoHistory.length = 0;\r\n      this.executedHistory.length = 0;\r\n      this.canUndoFromHTML = '';\r\n    }\r\n\r\n    let set = false;\r\n    if(canSetDraft) {\r\n      set = await this.setDraft(undefined, false);\r\n    }\r\n\r\n    if(!set && fireEvent) {\r\n      this.onMessageInput();\r\n    }\r\n  }\r\n\r\n  public isInputEmpty() {\r\n    return isInputEmpty(this.messageInput);\r\n  }\r\n\r\n  public updateSendBtn() {\r\n    let icon: 'send' | 'record' | 'edit' | 'schedule';\r\n\r\n    const isInputEmpty = this.isInputEmpty();\r\n\r\n    if(this.editMsgId) icon = 'edit';\r\n    else if(!this.recorder || this.recording || !isInputEmpty || this.forwarding) icon = this.chat.type === 'scheduled' ? 'schedule' : 'send';\r\n    else icon = 'record';\r\n\r\n    ['send', 'record', 'edit', 'schedule'].forEach((i) => {\r\n      this.btnSend.classList.toggle(i, icon === i);\r\n    });\r\n\r\n    if(this.btnScheduled) {\r\n      this.btnScheduled.classList.toggle('show', isInputEmpty);\r\n    }\r\n\r\n    if(this.btnToggleReplyMarkup) {\r\n      this.btnToggleReplyMarkup.classList.toggle('show', isInputEmpty);\r\n    }\r\n  }\r\n\r\n  public onMessageSent(clearInput = true, clearReply?: boolean) {\r\n    if(this.chat.type !== 'scheduled') {\r\n      this.managers.appMessagesManager.readAllHistory(this.chat.peerId, this.chat.threadId, true);\r\n    }\r\n\r\n    this.scheduleDate = undefined;\r\n    this.sendSilent = undefined;\r\n\r\n    const value = this.messageInputField.value;\r\n    const entities = parseEntities(value);\r\n    const emojiEntities: MessageEntity.messageEntityEmoji[] = entities.filter((entity) => entity._ === 'messageEntityEmoji') as any;\r\n    emojiEntities.forEach((entity) => {\r\n      const emoji = emojiFromCodePoints(entity.unicode);\r\n      this.managers.appEmojiManager.pushRecentEmoji(emoji);\r\n    });\r\n\r\n    if(clearInput) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n      this.clearInput();\r\n    }\r\n\r\n    if(clearReply || clearInput) {\r\n      this.clearHelper();\r\n    }\r\n\r\n    this.updateSendBtn();\r\n  }\r\n\r\n  public sendMessage(force = false) {\r\n    const {editMsgId, chat} = this;\r\n    if(chat.type === 'scheduled' && !force && !editMsgId) {\r\n      this.scheduleSending();\r\n      return;\r\n    }\r\n\r\n    const {peerId} = chat;\r\n    const {noWebPage} = this;\r\n    const sendingParams = this.chat.getMessageSendingParams();\r\n\r\n    const {value, entities} = getRichValue(this.messageInputField.input);\r\n\r\n    // return;\r\n    if(editMsgId) {\r\n      const message = this.editMessage;\r\n      if(value.trim() || message.media) {\r\n        this.managers.appMessagesManager.editMessage(message, value, {\r\n          entities,\r\n          noWebPage: noWebPage\r\n        });\r\n\r\n        this.onMessageSent();\r\n      } else {\r\n        new PopupDeleteMessages(peerId, [editMsgId], chat.type);\r\n\r\n        return;\r\n      }\r\n    } else if(value.trim()) {\r\n      this.managers.appMessagesManager.sendText(peerId, value, {\r\n        entities,\r\n        ...sendingParams,\r\n        noWebPage: noWebPage,\r\n        webPage: this.getWebPagePromise ? undefined : this.willSendWebPage,\r\n        clearDraft: true\r\n      });\r\n\r\n      if(this.chat.type === 'scheduled') {\r\n        this.onMessageSent(true);\r\n      } else {\r\n        this.onMessageSent(false, false);\r\n      }\r\n      // this.onMessageSent();\r\n    }\r\n\r\n    // * wait for sendText set messageId for invokeAfterMsg\r\n    if(this.forwarding) {\r\n      const forwarding = copy(this.forwarding);\r\n      // setTimeout(() => {\r\n      for(const fromPeerId in forwarding) {\r\n        this.managers.appMessagesManager.forwardMessages(peerId, fromPeerId.toPeerId(), forwarding[fromPeerId], {\r\n          ...sendingParams,\r\n          dropAuthor: this.forwardElements && this.forwardElements.hideSender.checkboxField.checked,\r\n          dropCaptions: this.isDroppingCaptions()\r\n        }).catch(async(err: ApiError) => {\r\n          if(err.type === 'VOICE_MESSAGES_FORBIDDEN') {\r\n            toastNew({\r\n              langPackKey: 'Chat.SendVoice.PrivacyError',\r\n              langPackArguments: [await wrapPeerTitle({peerId})]\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      if(!value) {\r\n        this.onMessageSent();\r\n      }\r\n      // }, 0);\r\n    }\r\n\r\n    // this.onMessageSent();\r\n  }\r\n\r\n  public async sendMessageWithDocument(\r\n    document: MyDocument | DocId,\r\n    force = false,\r\n    clearDraft = false,\r\n    silent = false\r\n  ) {\r\n    document = await this.managers.appDocsManager.getDoc(document);\r\n\r\n    const flag = document.type === 'sticker' ? 'send_stickers' : (document.type === 'gif' ? 'send_gifs' : 'send_media');\r\n    if(this.chat.peerId.isAnyChat() && !(await this.chat.canSend(flag))) {\r\n      toast(POSTING_MEDIA_NOT_ALLOWED);\r\n      return false;\r\n    }\r\n\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendMessageWithDocument(document, true, clearDraft, silent));\r\n      return false;\r\n    }\r\n\r\n    if(!document) {\r\n      return false;\r\n    }\r\n\r\n    if(getStickerEffectThumb(document) && !rootScope.premium) {\r\n      return false;\r\n    }\r\n\r\n    this.managers.appMessagesManager.sendFile(this.chat.peerId, document, {\r\n      ...this.chat.getMessageSendingParams(),\r\n      isMedia: true,\r\n      clearDraft: clearDraft || undefined,\r\n      silent\r\n    });\r\n    this.onMessageSent(clearDraft, true);\r\n\r\n    if(document.type === 'sticker') {\r\n      emoticonsDropdown.stickersTab?.unshiftRecentSticker(document);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  private canToggleHideAuthor() {\r\n    const {forwardElements} = this;\r\n    if(!forwardElements) return false;\r\n    const hideCaptionCheckboxField = forwardElements.hideCaption.checkboxField;\r\n    return !hideCaptionCheckboxField.checked ||\r\n      findUpTag(hideCaptionCheckboxField.label, 'FORM').classList.contains('hide');\r\n  }\r\n\r\n  private isDroppingCaptions() {\r\n    return !this.canToggleHideAuthor();\r\n  }\r\n\r\n  /* public sendSomething(callback: () => void, force = false) {\r\n    if(this.chat.type === 'scheduled' && !force) {\r\n      this.scheduleSending(() => this.sendSomething(callback, true));\r\n      return false;\r\n    }\r\n\r\n    callback();\r\n    this.onMessageSent(false, true);\r\n\r\n    return true;\r\n  } */\r\n\r\n  public async initMessageEditing(mid: number) {\r\n    const message = (await this.chat.getMessage(mid)) as Message.message;\r\n\r\n    let input = documentFragmentToHTML(wrapDraftText(message.message, {entities: message.totalEntities}));\r\n    const f = async() => {\r\n      const replyFragment = await wrapMessageForReply(message, undefined, [message.mid]);\r\n      this.setTopInfo('edit', f, i18n('AccDescrEditing'), replyFragment, input, message);\r\n\r\n      this.editMsgId = mid;\r\n      this.editMessage = message;\r\n      input = undefined;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public initMessagesForward(fromPeerIdsMids: {[fromPeerId: PeerId]: number[]}) {\r\n    const f = async() => {\r\n      // const peerTitles: string[]\r\n      const fromPeerIds = Object.keys(fromPeerIdsMids).map((fromPeerId) => fromPeerId.toPeerId());\r\n      const smth: Set<string> = new Set();\r\n      let length = 0, messagesWithCaptionsLength = 0;\r\n\r\n      const p = fromPeerIds.map(async(fromPeerId) => {\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        const promises = mids.map(async(mid) => {\r\n          const message = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mid)) as Message.message;\r\n          if(message.fwd_from?.from_name && !message.fromId && !message.fwdFromId) {\r\n            smth.add('N' + message.fwd_from.from_name);\r\n          } else {\r\n            smth.add('P' + message.fromId);\r\n          }\r\n\r\n          if(message.media && message.message) {\r\n            ++messagesWithCaptionsLength;\r\n          }\r\n        });\r\n\r\n        await Promise.all(promises);\r\n\r\n        length += mids.length;\r\n      });\r\n\r\n      await Promise.all(p);\r\n\r\n      const onlyFirstName = smth.size > 2;\r\n      const peerTitles = [...smth].map((smth) => {\r\n        const type = smth[0];\r\n        smth = smth.slice(1);\r\n        if(type === 'P') {\r\n          const peerId = smth.toPeerId();\r\n          return peerId === rootScope.myId ? i18n('Chat.Accessory.Forward.You') : new PeerTitle({peerId, dialog: false, onlyFirstName}).element;\r\n        } else {\r\n          return onlyFirstName ? smth.split(' ')[0] : smth;\r\n        }\r\n      });\r\n\r\n      const {forwardElements} = this;\r\n      const form = findUpTag(forwardElements.showCaption.checkboxField.label, 'FORM');\r\n      form.classList.toggle('hide', !messagesWithCaptionsLength);\r\n      const hideCaption = forwardElements.hideCaption.checkboxField.checked;\r\n      if(messagesWithCaptionsLength && hideCaption) {\r\n        forwardElements.hideSender.checkboxField.setValueSilently(true);\r\n      } else if(this.forwardWasDroppingAuthor !== undefined) {\r\n        (this.forwardWasDroppingAuthor ? forwardElements.hideSender : forwardElements.showSender).checkboxField.setValueSilently(true);\r\n      }\r\n\r\n      const titleKey: LangPackKey = forwardElements.showSender.checkboxField.checked ? 'Chat.Accessory.Forward' : 'Chat.Accessory.Hidden';\r\n      const title = i18n(titleKey, [length]);\r\n\r\n      const senderTitles = document.createDocumentFragment();\r\n      if(peerTitles.length < 3) {\r\n        senderTitles.append(...join(peerTitles, false));\r\n      } else {\r\n        senderTitles.append(peerTitles[0], i18n('AndOther', [peerTitles.length - 1]));\r\n      }\r\n\r\n      let firstMessage: Message.message, usingFullAlbum: boolean;\r\n      if(fromPeerIds.length === 1) {\r\n        const fromPeerId = fromPeerIds[0];\r\n        const mids = fromPeerIdsMids[fromPeerId];\r\n        firstMessage = (await this.managers.appMessagesManager.getMessageByPeer(fromPeerId, mids[0])) as Message.message;\r\n\r\n        usingFullAlbum = !!firstMessage.grouped_id;\r\n        if(usingFullAlbum) {\r\n          const albumMids = await this.managers.appMessagesManager.getMidsByMessage(firstMessage);\r\n          if(albumMids.length !== length || albumMids.find((mid) => !mids.includes(mid))) {\r\n            usingFullAlbum = false;\r\n          }\r\n        }\r\n      }\r\n\r\n      const subtitleFragment = document.createDocumentFragment();\r\n      const delimiter = ': ';\r\n      if(usingFullAlbum || length === 1) {\r\n        const mids = fromPeerIdsMids[fromPeerIds[0]];\r\n        const replyFragment = await wrapMessageForReply(firstMessage, undefined, mids);\r\n        subtitleFragment.append(\r\n          senderTitles,\r\n          delimiter,\r\n          replyFragment\r\n        );\r\n      } else {\r\n        subtitleFragment.append(\r\n          i18n('Chat.Accessory.Forward.From'),\r\n          delimiter,\r\n          senderTitles\r\n        );\r\n      }\r\n\r\n      const newReply = this.setTopInfo('forward', f, title, subtitleFragment);\r\n\r\n      forwardElements.modifyArgs.forEach((b, idx) => {\r\n        const text = b.textElement;\r\n        const intl: I18n.IntlElement = I18n.weakMap.get(text) as any;\r\n        intl.args = [idx < 2 ? fromPeerIds.length : messagesWithCaptionsLength];\r\n        intl.update();\r\n      });\r\n\r\n      if(this.forwardHover) {\r\n        this.forwardHover.attachButtonListener(newReply, this.listenerSetter);\r\n      }\r\n\r\n      this.forwarding = fromPeerIdsMids;\r\n    };\r\n\r\n    f();\r\n  }\r\n\r\n  public async initMessageReply(mid: number) {\r\n    if(this.replyToMsgId === mid) {\r\n      return;\r\n    }\r\n\r\n    let message = await this.chat.getMessage(mid);\r\n    const f = () => {\r\n      let peerTitleEl: HTMLElement;\r\n      if(!message) { // load missing replying message\r\n        peerTitleEl = i18n('Loading');\r\n\r\n        this.managers.appMessagesManager.wrapSingleMessage(this.chat.peerId, mid).then((_message) => {\r\n          if(this.replyToMsgId !== mid) {\r\n            return;\r\n          }\r\n\r\n          message = _message;\r\n          if(!message) {\r\n            this.clearHelper('reply');\r\n          } else {\r\n            f();\r\n          }\r\n        });\r\n      } else {\r\n        peerTitleEl = new PeerTitle({\r\n          peerId: message.fromId,\r\n          dialog: false\r\n        }).element;\r\n      }\r\n\r\n      this.setTopInfo('reply', f, peerTitleEl, message && (message as Message.message).message, undefined, message);\r\n      this.replyToMsgId = mid;\r\n    };\r\n    f();\r\n  }\r\n\r\n  public clearHelper(type?: ChatInputHelperType) {\r\n    if(this.helperType === 'edit' && type !== 'edit') {\r\n      this.clearInput();\r\n    }\r\n\r\n    if(type) {\r\n      this.lastUrl = '';\r\n      delete this.noWebPage;\r\n      this.willSendWebPage = null;\r\n    }\r\n\r\n    if(type !== 'reply') {\r\n      this.replyToMsgId = undefined;\r\n      this.forwarding = undefined;\r\n    }\r\n\r\n    this.editMsgId = this.editMessage = undefined;\r\n    this.helperType = this.helperFunc = undefined;\r\n\r\n    if(this.chat.container.classList.contains('is-helper-active')) {\r\n      appNavigationController.removeByType('input-helper');\r\n      this.chat.container.classList.remove('is-helper-active');\r\n      this.t();\r\n    }\r\n  }\r\n\r\n  private t() {\r\n    const className = 'is-toggling-helper';\r\n    SetTransition(this.chat.container, className, true, 150, () => {\r\n      this.chat.container.classList.remove(className);\r\n    });\r\n  }\r\n\r\n  public setInputValue(value: string, clear = true, focus = true) {\r\n    if(!value) value = '';\r\n\r\n    if(clear) this.clearInput(false, false, value);\r\n    else this.messageInputField.setValueSilently(value);\r\n\r\n    fastRaf(() => {\r\n      focus && placeCaretAtEnd(this.messageInput);\r\n      this.onMessageInput();\r\n      this.messageInput.scrollTop = this.messageInput.scrollHeight;\r\n    });\r\n  }\r\n\r\n  public setTopInfo(\r\n    type: ChatInputHelperType,\r\n    callerFunc: () => void,\r\n    title: Parameters<typeof wrapReply>[0] = '',\r\n    subtitle: Parameters<typeof wrapReply>[1] = '',\r\n    input?: string,\r\n    message?: any\r\n  ) {\r\n    if(this.willSendWebPage && type === 'reply') {\r\n      return;\r\n    }\r\n\r\n    if(type !== 'webpage') {\r\n      this.clearHelper(type);\r\n      this.helperType = type;\r\n      this.helperFunc = callerFunc;\r\n    }\r\n\r\n    const replyParent = this.replyElements.container;\r\n    const oldReply = replyParent.lastElementChild.previousElementSibling;\r\n    const haveReply = oldReply.classList.contains('reply');\r\n\r\n    this.replyElements.iconBtn.replaceWith(this.replyElements.iconBtn = ButtonIcon((type === 'webpage' ? 'link' : type) + ' active reply-icon', {noRipple: true}));\r\n    const {container} = wrapReply(title, subtitle, message);\r\n    if(haveReply) {\r\n      oldReply.replaceWith(container);\r\n    } else {\r\n      replyParent.insertBefore(container, replyParent.lastElementChild);\r\n    }\r\n\r\n    if(type === 'webpage') {\r\n      container.style.cursor = 'default';\r\n    }\r\n\r\n    if(!this.chat.container.classList.contains('is-helper-active')) {\r\n      this.chat.container.classList.add('is-helper-active');\r\n      this.t();\r\n    }\r\n\r\n    /* const scroll = appImManager.scrollable;\r\n    if(scroll.isScrolledDown && !scroll.scrollLocked && !appImManager.messagesQueuePromise && !appImManager.setPeerPromise) {\r\n      scroll.scrollTo(scroll.scrollHeight, 'top', true, true, 200);\r\n    } */\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'input-helper',\r\n        onPop: () => {\r\n          this.onHelperCancel();\r\n        }\r\n      });\r\n    }\r\n\r\n    if(input !== undefined) {\r\n      this.setInputValue(input);\r\n    }\r\n\r\n    setTimeout(() => {\r\n      this.updateSendBtn();\r\n    }, 0);\r\n\r\n    return container;\r\n  }\r\n\r\n  // public saveScroll() {\r\n  //   this.scrollTop = this.chat.bubbles.scrollable.container.scrollTop;\r\n  //   this.scrollOffsetTop = this.chatInput.offsetTop;\r\n  // }\r\n\r\n  // public restoreScroll() {\r\n  //   if(this.chatInput.style.display) return;\r\n  //   //console.log('input resize', offsetTop, this.chatInput.offsetTop);\r\n  //   let newOffsetTop = this.chatInput.offsetTop;\r\n  //   let container = this.chat.bubbles.scrollable.container;\r\n  //   let scrollTop = container.scrollTop;\r\n  //   let clientHeight = container.clientHeight;\r\n  //   let maxScrollTop = container.scrollHeight;\r\n\r\n  //   if(newOffsetTop < this.scrollOffsetTop) {\r\n  //     this.scrollDiff = this.scrollOffsetTop - newOffsetTop;\r\n  //     container.scrollTop += this.scrollDiff;\r\n  //   } else if(scrollTop !== this.scrollTop) {\r\n  //     let endDiff = maxScrollTop - (scrollTop + clientHeight);\r\n  //     if(endDiff < this.scrollDiff/*  && false */) {\r\n  //       //container.scrollTop -= endDiff;\r\n  //     } else {\r\n  //       container.scrollTop -= this.scrollDiff;\r\n  //     }\r\n  //   }\r\n  // }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport documentFragmentToHTML from '../../helpers/dom/documentFragmentToHTML';\nimport {DraftMessage} from '../../layer';\nimport mergeEntities from '../../lib/richTextProcessor/mergeEntities';\nimport parseEntities from '../../lib/richTextProcessor/parseEntities';\nimport wrapDraftText from '../../lib/richTextProcessor/wrapDraftText';\n\nexport default function wrapDraft(draft: DraftMessage.draftMessage) {\n  const myEntities = parseEntities(draft.message);\n  const apiEntities = draft.entities || [];\n  const totalEntities = mergeEntities(apiEntities.slice(), myEntities); // ! only in this order, otherwise bold and emoji formatting won't work\n\n  return documentFragmentToHTML(wrapDraftText(draft.message, {entities: totalEntities}));\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function setCaretAt(node: Node) {\n  // node.appendChild(document.createTextNode(''));\n\n  const originalNode = node;\n  node = node.previousSibling;\n\n  if(node.nodeType === 1) {\n    const newNode = document.createTextNode('');\n    node.parentNode.insertBefore(newNode, !originalNode.nextSibling || originalNode.nextSibling.nodeType === node.nodeType ? originalNode : originalNode.nextSibling);\n    node = newNode;\n  }\n\n  if(window.getSelection && document.createRange) {\n    const range = document.createRange();\n    if(node) {\n      range.setStartAfter(node);\n      range.insertNode(node);\n      range.setStart(node, node.nodeValue.length);\n    }\n\n    range.collapse(true);\n\n    const sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type Chat from './chat';\r\nimport type ChatTopbar from './topbar';\r\nimport mediaSizes from '../../helpers/mediaSizes';\r\nimport DivAndCaption from '../divAndCaption';\r\nimport ripple from '../ripple';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport {Message} from '../../layer';\r\nimport safeAssign from '../../helpers/object/safeAssign';\r\n\r\nconst classNames: string[] = ['is-pinned-message-shown', 'is-pinned-audio-shown'];\r\nconst CLASSNAME_BASE = 'pinned-container';\r\nconst HEIGHT = 52;\r\n\r\nexport default class PinnedContainer {\r\n  public wrapperUtils: HTMLElement;\r\n  public btnClose: HTMLElement;\r\n  protected wrapper: HTMLElement;\r\n\r\n  protected topbar: ChatTopbar;\r\n  protected chat: Chat;\r\n  protected listenerSetter: ListenerSetter;\r\n  public className: string;\r\n  public divAndCaption: DivAndCaption<(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message?: any) => void>;\r\n\r\n  protected floating = false;\r\n\r\n  public onClose?: () => void | Promise<boolean>;\r\n\r\n  constructor(options: {\r\n    topbar: PinnedContainer['topbar'],\r\n    chat: PinnedContainer['chat'],\r\n    listenerSetter: PinnedContainer['listenerSetter'],\r\n    className: PinnedContainer['className'],\r\n    divAndCaption: PinnedContainer['divAndCaption'],\r\n    onClose?: PinnedContainer['onClose'],\r\n    floating?: PinnedContainer['floating']\r\n  }) {\r\n    safeAssign(this, options);\r\n\r\n    const {divAndCaption, className} = this;\r\n    divAndCaption.container.classList.add(CLASSNAME_BASE, 'hide');\r\n    divAndCaption.title.classList.add(CLASSNAME_BASE + '-title');\r\n    divAndCaption.subtitle.classList.add(CLASSNAME_BASE + '-subtitle');\r\n    divAndCaption.content.classList.add(CLASSNAME_BASE + '-content');\r\n\r\n    this.btnClose = document.createElement('button');\r\n    this.btnClose.classList.add(CLASSNAME_BASE + '-close', `pinned-${className}-close`, 'btn-icon', 'tgico-close');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add(CLASSNAME_BASE + '-wrapper');\r\n    ripple(this.wrapper);\r\n\r\n    this.wrapperUtils = document.createElement('div');\r\n    this.wrapperUtils.classList.add(CLASSNAME_BASE + '-wrapper-utils');\r\n    this.wrapperUtils.append(this.btnClose);\r\n\r\n    this.wrapper.append(...Array.from(divAndCaption.container.children), this.wrapperUtils);\r\n\r\n    divAndCaption.container.append(this.wrapper/* , this.close */);\r\n\r\n    this.attachOnCloseEvent(this.btnClose);\r\n  }\r\n\r\n  public attachOnCloseEvent(elem: HTMLElement) {\r\n    attachClickEvent(elem, (e) => {\r\n      cancelEvent(e);\r\n\r\n      ((this.onClose ? this.onClose() : null) || Promise.resolve(true)).then((needClose) => {\r\n        if(needClose) {\r\n          this.toggle(true);\r\n        }\r\n      });\r\n    }, {listenerSetter: this.listenerSetter});\r\n  }\r\n\r\n  public toggle(hide?: boolean) {\r\n    const isHidden = this.divAndCaption.container.classList.contains('hide');\r\n    if(hide === undefined) {\r\n      hide = !isHidden;\r\n    } else if(hide === isHidden) {\r\n      return;\r\n    }\r\n\r\n    // const scrollable = this.chat.bubbles.scrollable;\r\n\r\n    const isFloating = (this.floating || mediaSizes.isMobile) && !hide;\r\n    // const scrollTop = isFloating || this.divAndCaption.container.classList.contains('is-floating') ? scrollable.scrollTop : undefined;\r\n\r\n    this.divAndCaption.container.classList.toggle('is-floating', isFloating);\r\n    this.divAndCaption.container.classList.toggle('hide', hide);\r\n\r\n    this.topbar.container.classList.toggle('is-pinned-floating', isFloating);\r\n    this.topbar.container.classList.toggle(`is-pinned-${this.className}-shown`, !hide);\r\n\r\n    // const active = classNames.filter((className) => this.topbar.container.classList.contains(className));\r\n    // const maxActive = hide ? 0 : 1;\r\n\r\n    // * not sure when it became unneeded\r\n    // if(scrollTop !== undefined && active.length <= maxActive/*  && !scrollable.isScrolledDown */) {\r\n    //   scrollable.scrollTop = scrollTop + ((hide ? -1 : 1) * HEIGHT);\r\n    // }\r\n\r\n    this.topbar.setFloating();\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n\r\n  public isVisible() {\r\n    return !this.divAndCaption.container.classList.contains('hide');\r\n  }\r\n\r\n  public isFloating() {\r\n    return this.divAndCaption.container.classList.contains('is-floating');\r\n  }\r\n\r\n  public fill(title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment, message: Message.message) {\r\n    this.divAndCaption.container.dataset.peerId = '' + message.peerId;\r\n    this.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    this.divAndCaption.fill(title, subtitle, message);\r\n    this.topbar.setUtilsWidth();\r\n  }\r\n}\r\n","// https://github.com/evgeny-nadymov/telegram-react/blob/master/src/Components/ColumnMiddle/PinnedMessageBorder.js\n\nenum BAR_HEIGHTS {\n  ONE = 32,\n  TWO = 15,\n  THREE = 10,\n  FOUR = 8,\n  MORE = 8\n};\n\nconst GAP = 1;\nconst WIDTH = 2;\nconst BASE_CLASS = 'pinned-message-border';\n\nexport default class PinnedMessageBorder {\n  private border: HTMLElement;\n  private wrapper: HTMLElement;\n  private svg: SVGSVGElement;\n  private defs: SVGDefsElement;\n  private clipPath: SVGClipPathElement;\n  private path: SVGPathElement;\n  private mark: HTMLElement;\n\n  private count: number;\n  private index: number;\n\n  private drawRect = (x: number, y: number, width: number, height: number, radius: number) => {\n    return `M${x},${y + radius}a${radius},${radius},0,0,1,${width},0v${height - 2 * radius}a${radius},${radius},0,0,1,${-width},0Z`;\n  };\n\n  private getClipPath = (id: string, barHeight: number, count: number) => {\n    const radius = 1;\n\n    let d = '';\n    /* if(count === 3) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius)\n        + this.drawRect(0, barHeight + GAP, WIDTH, barHeight + 1, radius)\n        + this.drawRect(0, barHeight * 2 + GAP * 2 + 1, WIDTH, barHeight, radius);\n    } */if(count === 2) {\n      d = this.drawRect(0, 0, WIDTH, barHeight, radius) + this.drawRect(0, barHeight + GAP * 2, WIDTH, barHeight, radius);\n    } else {\n      for(let i = 0; i < count; ++i) {\n        d += this.drawRect(0, (barHeight + GAP) * i, WIDTH, barHeight, radius);\n      }\n    }\n\n    if(!this.clipPath) {\n      this.clipPath = document.createElementNS('http://www.w3.org/2000/svg', 'clipPath');\n      this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n      this.clipPath.append(this.path);\n    }\n\n    this.clipPath.id = id;\n    this.path.setAttributeNS(null, 'd', d);\n\n    return this.clipPath;\n  };\n\n  private getBarHeight = (count: number, index: number) => {\n    let barHeight: number;\n    if(count <= 1) {\n      barHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      barHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      barHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      barHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      barHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return barHeight;\n  };\n\n  private getMarkHeight = (count: number, index: number) => {\n    let markHeight: number;\n    if(count <= 1) {\n      markHeight = BAR_HEIGHTS.ONE;\n    } else if(count === 2) {\n      markHeight = BAR_HEIGHTS.TWO;\n    } else if(count === 3) {\n      markHeight = BAR_HEIGHTS.THREE;\n    } else if(count === 4) {\n      markHeight = BAR_HEIGHTS.FOUR;\n    } else if(count > 3) {\n      markHeight = BAR_HEIGHTS.MORE;\n    }\n\n    return markHeight;\n  };\n\n  private getMarkTranslateY = (index: number, barHeight: number, count: number) => {\n    if(count === 1) {\n      return 0;\n    } else if(count === 2) {\n      return !index ? 0 : barHeight + GAP;\n    }\n\n    if(count === 3) {\n      if(!index) {\n        return 0;\n      } else if(index === 1) {\n        return barHeight + GAP;\n      }\n\n      return barHeight * 2 + GAP * 2 + 1;\n    } else {\n      return (barHeight + GAP) * index;\n    }\n  };\n\n  private getTrackTranslateY = (index: number, count: number, barHeight: number, trackHeight: number) => {\n    if(count <= 4) {\n      return 0;\n    }\n\n    if(index <= 1) {\n      return 0;\n    } else if(index >= (count - 2)) {\n      return trackHeight - BAR_HEIGHTS.ONE - barHeight;\n    }\n\n    // return (index + 1) * barHeight + index * GAP;\n    return (index - 2) * barHeight + index * GAP;\n    // return (barHeight + GAP * 2) / 2 + (index - 2) * (barHeight + GAP);\n  };\n\n  private getTrackHeight = (count: number, barHeight: number) => {\n    return count <= 3 ? BAR_HEIGHTS.ONE : barHeight * count + GAP * (count - 1);\n  };\n\n  public render(count: number, index: number) {\n    if(!this.border) {\n      this.border = document.createElement('div');\n      this.border.classList.add(BASE_CLASS);\n\n      this.wrapper = document.createElement('div');\n      this.border.append(this.wrapper);\n    }\n\n    if(count === 1) {\n      if(this.count !== count) {\n        this.wrapper.className = BASE_CLASS + '-wrapper-1';\n        this.border.classList.remove(BASE_CLASS + '-mask');\n        this.wrapper.innerHTML = this.wrapper.style.cssText = '';\n      }\n\n      return this.border;\n    }\n\n    const barHeight = this.getBarHeight(count, index);\n    const markHeight = this.getMarkHeight(count, index);\n    const trackHeight = this.getTrackHeight(count, barHeight);\n\n    const clipPathId = `clipPath_${count}`;\n    const clipPath = this.getClipPath(clipPathId, barHeight, count);\n\n    const markTranslateY = this.getMarkTranslateY(index, barHeight, count);\n    const trackTranslateY = this.getTrackTranslateY(index, count, barHeight, trackHeight);\n\n    this.border.classList.toggle(BASE_CLASS + '-mask', count > 4);\n\n    if(index <= 1) {\n      this.border.classList.add('mask-bottom');\n      this.border.classList.remove('mask-top');\n    } else if(index >= (count - 2)) {\n      this.border.classList.add('mask-top');\n      this.border.classList.remove('mask-bottom');\n    } else {\n      this.border.classList.add('mask-top', 'mask-bottom');\n    }\n\n    this.wrapper.className = BASE_CLASS + '-wrapper';\n    this.wrapper.style.cssText = `clip-path: url(#${clipPathId}); width: 2px; height: ${trackHeight}px; transform: translateY(-${trackTranslateY}px);`;\n\n    if(!this.svg) {\n      this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n      this.svg.setAttributeNS(null, 'height', '0');\n      this.svg.setAttributeNS(null, 'width', '0');\n\n      this.defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n      this.defs.append(clipPath);\n\n      this.svg.append(this.defs);\n\n      this.mark = document.createElement('div');\n      this.mark.classList.add(BASE_CLASS + '-mark');\n    }\n\n    if(!this.svg.parentElement) {\n      this.wrapper.append(this.svg, this.mark);\n    }\n\n    this.mark.style.cssText = `height: ${markHeight}px; transform: translateY(${markTranslateY}px);`;\n\n    this.count = count;\n    this.index = index;\n\n    return this.border;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AppMessagesManager} from '../../lib/appManagers/appMessagesManager';\nimport type ChatTopbar from './topbar';\nimport rootScope from '../../lib/rootScope';\nimport appMediaPlaybackController, {AppMediaPlaybackController} from '../appMediaPlaybackController';\nimport DivAndCaption from '../divAndCaption';\nimport PinnedContainer from './pinnedContainer';\nimport Chat from './chat';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport {formatFullSentTime} from '../../helpers/date';\nimport ButtonIcon from '../buttonIcon';\nimport {DocumentAttribute} from '../../layer';\nimport MediaProgressLine from '../mediaProgressLine';\nimport VolumeSelector from '../volumeSelector';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nexport default class ChatAudio extends PinnedContainer {\n  private toggleEl: HTMLElement;\n  private progressLine: MediaProgressLine;\n  private volumeSelector: VolumeSelector;\n  private fasterEl: HTMLElement;\n  private repeatEl: HTMLButtonElement;\n\n  constructor(protected topbar: ChatTopbar, protected chat: Chat, protected managers: AppManagers) {\n    super({\n      topbar,\n      chat,\n      listenerSetter: topbar.listenerSetter,\n      className: 'audio',\n      divAndCaption: new DivAndCaption(\n        'pinned-audio',\n        (title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment) => {\n          replaceContent(this.divAndCaption.title, title);\n          replaceContent(this.divAndCaption.subtitle, subtitle);\n        }\n      ),\n      onClose: () => {\n        appMediaPlaybackController.stop();\n      },\n      floating: true\n    });\n\n    this.divAndCaption.border.remove();\n\n    const prevEl = ButtonIcon('fast_rewind active', {noRipple: true});\n    const nextEl = ButtonIcon('fast_forward active', {noRipple: true});\n\n    const attachClick = (elem: HTMLElement, callback: () => void) => {\n      attachClickEvent(elem, (e) => {\n        cancelEvent(e);\n        callback();\n      }, {listenerSetter: this.topbar.listenerSetter});\n    };\n\n    attachClick(prevEl, () => {\n      appMediaPlaybackController.previous();\n    });\n\n    attachClick(nextEl, () => {\n      appMediaPlaybackController.next();\n    });\n\n    this.toggleEl = ButtonIcon('', {noRipple: true});\n    this.toggleEl.classList.add('active', 'pinned-audio-ico', 'tgico');\n    attachClick(this.toggleEl, () => {\n      appMediaPlaybackController.toggle();\n    });\n    this.wrapper.prepend(this.wrapper.firstElementChild, prevEl, this.toggleEl, nextEl);\n\n    this.volumeSelector = new VolumeSelector(this.listenerSetter, true);\n    const volumeProgressLineContainer = document.createElement('div');\n    volumeProgressLineContainer.classList.add('progress-line-container');\n    volumeProgressLineContainer.append(this.volumeSelector.container);\n    const tunnel = document.createElement('div');\n    tunnel.classList.add('pinned-audio-volume-tunnel');\n    this.volumeSelector.btn.classList.add('pinned-audio-volume', 'active');\n    this.volumeSelector.btn.prepend(tunnel);\n    this.volumeSelector.btn.append(volumeProgressLineContainer);\n\n    this.repeatEl = ButtonIcon('audio_repeat', {noRipple: true});\n    attachClick(this.repeatEl, () => {\n      const params = appMediaPlaybackController.getPlaybackParams();\n      if(!params.round) {\n        appMediaPlaybackController.round = true;\n      } else if(params.loop) {\n        appMediaPlaybackController.round = false;\n        appMediaPlaybackController.loop = false;\n      } else {\n        appMediaPlaybackController.loop = !appMediaPlaybackController.loop;\n      }\n    });\n\n    const fasterEl = this.fasterEl = ButtonIcon('playback_2x', {noRipple: true});\n    attachClick(fasterEl, () => {\n      appMediaPlaybackController.playbackRate = fasterEl.classList.contains('active') ? 1 : 1.75;\n    });\n\n    this.wrapperUtils.prepend(this.volumeSelector.btn, fasterEl, this.repeatEl);\n\n    const progressWrapper = document.createElement('div');\n    progressWrapper.classList.add('pinned-audio-progress-wrapper');\n\n    this.progressLine = new MediaProgressLine(undefined, undefined, true, true);\n    this.progressLine.container.classList.add('pinned-audio-progress');\n    progressWrapper.append(this.progressLine.container);\n    this.wrapper.insertBefore(progressWrapper, this.wrapperUtils);\n\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('play', this.onMediaPlay);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('pause', this.onPause);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('stop', this.onStop);\n    this.topbar.listenerSetter.add(appMediaPlaybackController)('playbackParams', this.onPlaybackParams);\n\n    const playingDetails = appMediaPlaybackController.getPlayingDetails();\n    if(playingDetails) {\n      this.onMediaPlay(playingDetails);\n      this.onPlaybackParams(playingDetails.playbackParams);\n    }\n  }\n\n  public destroy() {\n    if(this.progressLine) {\n      this.progressLine.removeListeners();\n    }\n  }\n\n  private onPlaybackParams = (playbackParams: ReturnType<AppMediaPlaybackController['getPlaybackParams']>) => {\n    this.fasterEl.classList.toggle('active', playbackParams.playbackRate > 1);\n\n    this.repeatEl.classList.remove('tgico-audio_repeat', 'tgico-audio_repeat_single');\n    this.repeatEl.classList.add(playbackParams.loop ? 'tgico-audio_repeat_single' : 'tgico-audio_repeat');\n    this.repeatEl.classList.toggle('active', playbackParams.loop || playbackParams.round);\n  };\n\n  private onPause = () => {\n    this.toggleEl.classList.remove('flip-icon');\n  };\n\n  private onStop = () => {\n    this.toggle(true);\n  };\n\n  private onMediaPlay = ({doc, message, media, playbackParams}: ReturnType<AppMediaPlaybackController['getPlayingDetails']>) => {\n    let title: string | HTMLElement | DocumentFragment, subtitle: string | HTMLElement | DocumentFragment;\n    const isMusic = doc.type !== 'voice' && doc.type !== 'round';\n    if(!isMusic) {\n      title = new PeerTitle({peerId: message.fromId, fromName: message.fwd_from?.from_name}).element;\n\n      // subtitle = 'Voice message';\n      subtitle = formatFullSentTime(message.date);\n    } else {\n      const audioAttribute = doc.attributes.find((attr) => attr._ === 'documentAttributeAudio') as DocumentAttribute.documentAttributeAudio;\n      title = wrapEmojiText(audioAttribute?.title ?? doc.file_name);\n      subtitle = audioAttribute?.performer ? wrapEmojiText(audioAttribute.performer) : i18n('AudioUnknownArtist');\n    }\n\n    this.fasterEl.classList.toggle('hide', isMusic);\n    this.repeatEl.classList.toggle('hide', !isMusic);\n\n    this.onPlaybackParams(playbackParams);\n    this.volumeSelector.setVolume();\n\n    this.progressLine.setMedia(media);\n\n    this.fill(title, subtitle, message);\n    // this.toggleEl.classList.add('flip-icon');\n    this.toggleEl.classList.toggle('flip-icon', !media.paused);\n    this.toggle(false);\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport PopupPinMessage from '../popups/unpinMessage';\r\nimport PinnedContainer from './pinnedContainer';\r\nimport PinnedMessageBorder from './pinnedMessageBorder';\r\nimport ReplyContainer, {wrapReplyDivAndCaption} from './replyContainer';\r\nimport rootScope from '../../lib/rootScope';\r\nimport Chat from './chat';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport {getHeavyAnimationPromise} from '../../hooks/useHeavyAnimationCheck';\r\nimport {i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport handleScrollSideEvent from '../../helpers/dom/handleScrollSideEvent';\r\nimport debounce from '../../helpers/schedulers/debounce';\r\nimport throttle from '../../helpers/schedulers/throttle';\r\nimport {AppManagers} from '../../lib/appManagers/managers';\r\nimport {Message} from '../../layer';\r\nimport {logger} from '../../lib/logger';\r\n\r\nclass AnimatedSuper {\r\n  static DURATION = 200;\r\n  static BASE_CLASS = 'animated-super';\r\n  container: HTMLDivElement;\r\n  rows: {[index: string]: {element: HTMLElement, timeout?: number, new?: true}} = {};\r\n  clearTimeout: number;\r\n\r\n  constructor() {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedSuper.BASE_CLASS;\r\n  }\r\n\r\n  public getRow(index: number, animateFirst = false) {\r\n    if(this.rows[index]) return this.rows[index].element;\r\n    const row = document.createElement('div');\r\n    const isFirst = !Object.keys(this.rows).length && !animateFirst;\r\n    row.className = AnimatedSuper.BASE_CLASS + '-row' + (isFirst ? '' : ' is-hiding hide');\r\n    this.rows[index] = {element: row, new: true};\r\n    this.container.append(row);\r\n    return row;\r\n  }\r\n\r\n  public clearRow(index: number) {\r\n    if(!this.rows[index]) return;\r\n    this.rows[index].element.remove();\r\n    delete this.rows[index];\r\n  }\r\n\r\n  public clearRows(currentIndex?: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      for(const i in this.rows) {\r\n        if(+i === currentIndex) continue;\r\n        this.clearRow(+i);\r\n      }\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  public setNewRow(index: number, reflow = false) {\r\n    const row = this.rows[index];\r\n    if(row.new) {\r\n      if(reflow) {\r\n        row.element.classList.remove('hide');\r\n        void row.element.offsetLeft; // reflow\r\n      } else {\r\n        row.element.classList.remove('is-hiding', 'hide');\r\n      }\r\n\r\n      delete row.new;\r\n    }\r\n\r\n    this.clearRows(index);\r\n  }\r\n\r\n  public animate(index: number, previousIndex: number, fromTop = index > previousIndex, ignorePrevious = false) {\r\n    if(index === previousIndex) { // * handle if set index 0 and previousIndex 0\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const row = this.rows[index];\r\n    const previousRow = this.rows[previousIndex];\r\n    if(!previousRow && !ignorePrevious) {\r\n      return this.setNewRow(index);\r\n    }\r\n\r\n    const sides = ['from-top', 'from-bottom'];\r\n    if(!fromTop) sides.reverse();\r\n\r\n    row.element.classList.add(sides[0]);\r\n    row.element.classList.remove(sides[1]);\r\n    if(previousRow) {\r\n      previousRow.element.classList.add(sides[1]);\r\n      previousRow.element.classList.remove(sides[0]);\r\n    }\r\n\r\n    if(row.new) {\r\n      this.setNewRow(index, true);\r\n    }\r\n\r\n    row.element.classList.toggle('is-hiding', false);\r\n    previousRow && previousRow.element.classList.toggle('is-hiding', true);\r\n\r\n    /* const height = row.element.getBoundingClientRect().height;\r\n    row.element.style.transform = `translateY(${fromTop ? height * -1 : height}px)`;\r\n    if(previousRow) {\r\n      previousRow.element.style.transform = `translateY(${fromTop ? height : height * -1}px)`;\r\n    } */\r\n\r\n    /* row.element.style.setProperty('--height', row.element.getBoundingClientRect().height + 'px');\r\n    if(previousRow) {\r\n      previousRow.element.style.setProperty('--height', previousRow.element.getBoundingClientRect().height + 'px');\r\n    } */\r\n\r\n    this.clearRows(index);\r\n  }\r\n}\r\n\r\nclass AnimatedCounter {\r\n  static EMPTY_INDEX = -1;\r\n  static BASE_CLASS = 'animated-counter';\r\n  container: HTMLElement;\r\n  decimals: {\r\n    container: HTMLElement,\r\n    placeholder: HTMLElement,\r\n    animatedSuper: AnimatedSuper\r\n  }[] = [];\r\n  previousNumber = 0;\r\n  clearTimeout: number;\r\n\r\n  constructor(private reverse = false) {\r\n    this.container = document.createElement('div');\r\n    this.container.className = AnimatedCounter.BASE_CLASS;\r\n  }\r\n\r\n  getDecimal(index: number) {\r\n    if(this.decimals[index]) return this.decimals[index];\r\n    const item = document.createElement('div');\r\n    item.className = AnimatedCounter.BASE_CLASS + '-decimal';\r\n\r\n    const placeholder = document.createElement('div');\r\n    placeholder.className = AnimatedCounter.BASE_CLASS + '-decimal-placeholder';\r\n\r\n    const animatedSuper = new AnimatedSuper();\r\n    animatedSuper.container.className = AnimatedCounter.BASE_CLASS + '-decimal-wrapper';\r\n\r\n    item.append(placeholder, animatedSuper.container);\r\n\r\n    this.container.append(item);\r\n\r\n    return this.decimals[index] = {container: item, placeholder, animatedSuper};\r\n  }\r\n\r\n  clear(number: number) {\r\n    if(this.clearTimeout) clearTimeout(this.clearTimeout);\r\n\r\n    const decimals = ('' + number).length;\r\n    if(decimals >= this.decimals.length) {\r\n      return;\r\n    }\r\n\r\n    this.clearTimeout = window.setTimeout(() => {\r\n      const byDecimal = this.decimals.splice(decimals, this.decimals.length - decimals);\r\n      byDecimal.forEach((decimal) => {\r\n        decimal.container.remove();\r\n      });\r\n    }, AnimatedSuper.DURATION);\r\n  }\r\n\r\n  /* prepareNumber(number: number) {\r\n    const decimals = ('' + number).length;\r\n    if(this.decimals.length < decimals) {\r\n      for(let i = this.decimals.length; i < decimals; ++i) {\r\n        this.getDecimal(i);\r\n      }\r\n    }\r\n  } */\r\n\r\n  hideLeft(number: number) {\r\n    const decimals = ('' + number).length;\r\n    const byDecimal = this.decimals.slice(decimals);// this.decimals.splice(deleteCount, this.decimals.length - deleteCount);\r\n    byDecimal.forEach((decimal) => {\r\n      const previousDecimalNumber = +decimal.placeholder.innerText || 0;\r\n      const row = decimal.animatedSuper.getRow(AnimatedCounter.EMPTY_INDEX, true);\r\n      decimal.animatedSuper.animate(AnimatedCounter.EMPTY_INDEX, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.clear(number);\r\n  }\r\n\r\n  setCount(number: number) {\r\n    // this.prepareNumber(number);\r\n\r\n    const previousByDecimal = Array.from('' + this.previousNumber).map((n) => +n);\r\n    const byDecimal = Array.from('' + number).map((n) => +n);\r\n    byDecimal.forEach((decimalNumber, idx) => {\r\n      const decimal = this.getDecimal(idx);\r\n      // const row = decimal.animatedSuper.getRow(number, true);\r\n      const row = decimal.animatedSuper.getRow(decimalNumber, true);\r\n      const previousDecimalNumber = previousByDecimal[idx] ?? AnimatedCounter.EMPTY_INDEX;\r\n      row.innerText = decimal.placeholder.innerText = '' + decimalNumber;\r\n      // decimal.animatedSuper.animate(number, this.previousNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n      decimal.animatedSuper.animate(decimalNumber, previousDecimalNumber, this.reverse ? number < this.previousNumber : number > this.previousNumber, true);\r\n    });\r\n\r\n    this.hideLeft(number);\r\n    // this.clear(number);\r\n    this.previousNumber = number;\r\n  }\r\n}\r\n\r\nexport default class ChatPinnedMessage {\r\n  private static LOAD_COUNT = 50;\r\n  private static LOAD_OFFSET = 5;\r\n\r\n  public pinnedMessageContainer: PinnedContainer;\r\n  private pinnedMessageBorder: PinnedMessageBorder;\r\n\r\n  private pinnedMaxMid = 0;\r\n  public pinnedMid = 0;\r\n  public pinnedIndex = -1;\r\n  private wasPinnedIndex = 0;\r\n  private wasPinnedMediaIndex = 0;\r\n\r\n  public locked = false;\r\n  private waitForScrollBottom = false;\r\n\r\n  public count = 0;\r\n  private mids: number[] = [];\r\n  private offsetIndex = 0;\r\n\r\n  private loading = false;\r\n  private loadedBottom = false;\r\n  private loadedTop = false;\r\n\r\n  private animatedSubtitle: AnimatedSuper;\r\n  private animatedMedia: AnimatedSuper;\r\n  private animatedCounter: AnimatedCounter;\r\n\r\n  private listenerSetter: ListenerSetter;\r\n  private scrollDownListenerSetter: ListenerSetter = null;\r\n\r\n  public hidden = false;\r\n\r\n  private getCurrentIndexPromise: Promise<any> = null;\r\n  private btnOpen: HTMLButtonElement;\r\n\r\n  private setPinnedMessage: () => void;\r\n\r\n  private isStatic: boolean;\r\n\r\n  private debug: boolean;\r\n\r\n  public setCorrectIndexThrottled: (lastScrollDirection?: number) => void;\r\n\r\n  private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, private managers: AppManagers) {\r\n    this.listenerSetter = new ListenerSetter();\r\n    this.log = logger('PM');\r\n    this.debug = true;\r\n    this.isStatic = false;\r\n\r\n    const dAC = new ReplyContainer('pinned-message');\r\n    this.pinnedMessageContainer = new PinnedContainer({\r\n      topbar,\r\n      chat,\r\n      listenerSetter: this.listenerSetter,\r\n      className: 'message',\r\n      divAndCaption: dAC,\r\n      onClose: async() => {\r\n        if(await managers.appPeersManager.canPinMessage(this.chat.peerId)) {\r\n          new PopupPinMessage(this.chat.peerId, this.pinnedMid, true);\r\n        } else {\r\n          new PopupPinMessage(this.chat.peerId, 0, true);\r\n        }\r\n\r\n        return false;\r\n      }\r\n    });\r\n\r\n    this.pinnedMessageBorder = new PinnedMessageBorder();\r\n    dAC.border.replaceWith(this.pinnedMessageBorder.render(1, 0));\r\n\r\n    this.animatedSubtitle = new AnimatedSuper();\r\n    dAC.subtitle.append(this.animatedSubtitle.container);\r\n\r\n    this.animatedMedia = new AnimatedSuper();\r\n    this.animatedMedia.container.classList.add('pinned-message-media-container');\r\n    dAC.content.prepend(this.animatedMedia.container);\r\n\r\n    this.animatedCounter = new AnimatedCounter(true);\r\n    dAC.title.append(i18n('PinnedMessage'), ' ', this.animatedCounter.container);\r\n\r\n    const btnClose = this.pinnedMessageContainer.btnClose.cloneNode(true) as HTMLElement;\r\n    this.pinnedMessageContainer.attachOnCloseEvent(btnClose);\r\n    dAC.container.prepend(btnClose);\r\n\r\n    this.btnOpen = ButtonIcon('pinlist pinned-container-close pinned-message-pinlist', {noRipple: true});\r\n\r\n    this.pinnedMessageContainer.wrapperUtils.prepend(this.btnOpen);\r\n\r\n    attachClickEvent(this.btnOpen, (e) => {\r\n      cancelEvent(e);\r\n      this.topbar.openPinned(true);\r\n    }, {listenerSetter: this.listenerSetter});\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        // this.wasPinnedIndex = 0;\r\n        // setTimeout(() => {\r\n        if(this.hidden) {\r\n          this.pinnedMessageContainer.toggle(this.hidden = false);\r\n        }\r\n\r\n        this.loadedTop = this.loadedBottom = false;\r\n        this.pinnedIndex = -1;\r\n        this.pinnedMid = 0;\r\n        this.count = 0;\r\n        this.mids = [];\r\n        this.offsetIndex = 0;\r\n        this.pinnedMaxMid = 0;\r\n        this.setCorrectIndex(0);\r\n        // }, 300);\r\n      }\r\n    });\r\n\r\n    this.listenerSetter.add(rootScope)('peer_pinned_hidden', ({peerId}) => {\r\n      if(peerId === this.chat.peerId) {\r\n        this.pinnedMessageContainer.toggle(this.hidden = true);\r\n      }\r\n    });\r\n\r\n    // * 200 - no lags\r\n    // * 100 - need test\r\n    this.setPinnedMessage = debounce(() => this._setPinnedMessage(), 100, true, true);\r\n    this.setCorrectIndexThrottled = throttle(this.setCorrectIndex.bind(this), 100, false);\r\n\r\n    this.isStatic = this.chat.type === 'discussion';\r\n  }\r\n\r\n  public destroy() {\r\n    this.pinnedMessageContainer.divAndCaption.container.remove();\r\n    this.pinnedMessageContainer.toggle(true);\r\n    this.listenerSetter.removeAll();\r\n    this.unsetScrollDownListener(false);\r\n  }\r\n\r\n  public setCorrectIndex(lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n    // return;\r\n\r\n    if(this.locked || this.hidden/*  || this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise */) {\r\n      return;\r\n    }\r\n\r\n    if((this.loadedBottom || this.loadedTop) && !this.count) {\r\n      return;\r\n    }\r\n\r\n    // const perf = performance.now();\r\n    const el = this.chat.bubbles.getBubbleByPoint('bottom');\r\n    // this.log('setCorrectIndex: get last element perf:', performance.now() - perf, el);\r\n    if(!el) return;\r\n\r\n    // return;\r\n\r\n    const mid = el.dataset.mid;\r\n    if(el && mid !== undefined) {\r\n      // this.log('setCorrectIndex will test mid:', mid);\r\n      this.testMid(+mid, lastScrollDirection);\r\n    }\r\n  }\r\n\r\n  public testMid(mid: number, lastScrollDirection?: number) {\r\n    if(this.isStatic) return;\r\n\r\n    // if(lastScrollDirection !== undefined) return;\r\n    if(this.hidden) return;\r\n\r\n    // this.log('testMid', mid);\r\n\r\n    let currentIndex: number = this.mids.findIndex((_mid) => _mid <= mid);\r\n    if(currentIndex !== -1 && !this.isNeededMore(currentIndex)) {\r\n      currentIndex += this.offsetIndex;\r\n    } else if(this.loadedTop && mid < this.mids[this.mids.length - 1]) {\r\n      // currentIndex = 0;\r\n      currentIndex = this.mids.length - 1 + this.offsetIndex;\r\n    } else {\r\n      if(!this.getCurrentIndexPromise) {\r\n        this.getCurrentIndexPromise = this.getCurrentIndex(mid, lastScrollDirection !== undefined);\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    // const idx = Math.max(0, this.mids.indexOf(mid));\r\n\r\n    /* if(currentIndex === this.count) {\r\n      currentIndex = 0;\r\n    } */\r\n\r\n    // this.log('testMid: pinned currentIndex', currentIndex, mid);\r\n\r\n    const changed = this.pinnedIndex !== currentIndex;\r\n    if(changed) {\r\n      if(this.waitForScrollBottom && lastScrollDirection !== undefined) {\r\n        if(this.pinnedIndex === 0 || this.pinnedIndex > currentIndex) { //          - \r\n          return;\r\n        }\r\n      }\r\n\r\n      this.pinnedIndex = currentIndex;\r\n      this.pinnedMid = this.mids.find((_mid) => _mid <= mid) || this.mids[this.mids.length - 1];\r\n      this.setPinnedMessage();\r\n    }\r\n  }\r\n\r\n  private isNeededMore(currentIndex: number) {\r\n    return (this.count > ChatPinnedMessage.LOAD_COUNT &&\r\n      (\r\n        (!this.loadedBottom && currentIndex <= ChatPinnedMessage.LOAD_OFFSET) ||\r\n        (!this.loadedTop && (this.count - 1 - currentIndex) <= ChatPinnedMessage.LOAD_OFFSET)\r\n      )\r\n    );\r\n  }\r\n\r\n  private async getCurrentIndex(mid: number, correctAfter = true) {\r\n    if(this.loading) return;\r\n    this.loading = true;\r\n\r\n    try {\r\n      const log = this.debug ? this.log.bindPrefix('getCurrentIndex') : undefined;\r\n      log && log('start', mid, correctAfter);\r\n\r\n      let gotRest = false;\r\n      const promises = [\r\n        this.managers.appMessagesManager.getSearch({\r\n          peerId: this.chat.peerId,\r\n          inputFilter: {_: 'inputMessagesFilterPinned'},\r\n          maxId: mid,\r\n          limit: ChatPinnedMessage.LOAD_COUNT,\r\n          backLimit: ChatPinnedMessage.LOAD_COUNT\r\n        })\r\n        .then((r) => {\r\n          gotRest = true;\r\n          return r;\r\n        })\r\n      ];\r\n\r\n      if(!this.pinnedMaxMid) {\r\n        const promise = this.managers.appMessagesManager.getPinnedMessage(this.chat.peerId).then((p) => {\r\n          if(!p.maxId) return;\r\n          this.pinnedMaxMid = p.maxId;\r\n\r\n          if(!gotRest && correctAfter) {\r\n            this.mids = [this.pinnedMaxMid];\r\n            this.count = p.count;\r\n            this.pinnedIndex = 0;\r\n            this.pinnedMid = this.mids[0];\r\n            this.setPinnedMessage();\r\n            // this.pinnedMessageContainer.toggle(false);\r\n          }\r\n        });\r\n\r\n        promises.push(promise as any);\r\n      }\r\n\r\n      const result = (await Promise.all(promises))[0];\r\n\r\n      let backLimited = result.history.findIndex((message) => message.mid <= mid);\r\n      if(backLimited === -1) {\r\n        backLimited = result.history.length;\r\n      }/*  else {\r\n        backLimited -= 1;\r\n      } */\r\n\r\n      this.offsetIndex = result.offset_id_offset ? result.offset_id_offset - backLimited : 0;\r\n      this.mids = result.history.map((message) => message.mid).slice();\r\n      this.count = result.count;\r\n\r\n      if(!this.count) {\r\n        this.pinnedMessageContainer.toggle(true);\r\n      }\r\n\r\n      this.loadedTop = (this.offsetIndex + this.mids.length) === this.count;\r\n      this.loadedBottom = !this.offsetIndex;\r\n\r\n      log && log('result', mid, result, backLimited, this.offsetIndex, this.loadedTop, this.loadedBottom);\r\n    } catch(err) {\r\n      this.log.error('getCurrentIndex error', err);\r\n    }\r\n\r\n    this.loading = false;\r\n\r\n    if(this.locked) {\r\n      this.testMid(mid);\r\n    } else if(correctAfter) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n\r\n    this.getCurrentIndexPromise = null;\r\n    // return result.offset_id_offset || 0;\r\n  }\r\n\r\n  public setScrollDownListener() {\r\n    this.waitForScrollBottom = true;\r\n\r\n    if(!this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter = new ListenerSetter();\r\n      handleScrollSideEvent(this.chat.bubbles.scrollable.container, 'bottom', () => {\r\n        this.unsetScrollDownListener();\r\n      }, this.scrollDownListenerSetter);\r\n    }\r\n  }\r\n\r\n  public unsetScrollDownListener(refreshPosition = true) {\r\n    this.waitForScrollBottom = false;\r\n\r\n    if(this.scrollDownListenerSetter) {\r\n      this.scrollDownListenerSetter.removeAll();\r\n      this.scrollDownListenerSetter = null;\r\n    }\r\n\r\n    if(refreshPosition) {\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async handleFollowingPinnedMessage() {\r\n    this.locked = true;\r\n\r\n    this.debug && this.log('handleFollowingPinnedMessage');\r\n    try {\r\n      this.setScrollDownListener();\r\n\r\n      const setPeerPromise = this.chat.setPeerPromise;\r\n      if(setPeerPromise instanceof Promise) {\r\n        await setPeerPromise;\r\n      }\r\n\r\n      // await this.chat.bubbles.scrollable.scrollLockedPromise;\r\n      await getHeavyAnimationPromise();\r\n\r\n      if(this.getCurrentIndexPromise) {\r\n        await this.getCurrentIndexPromise;\r\n      }\r\n\r\n      this.debug && this.log('handleFollowingPinnedMessage: unlock');\r\n      this.locked = false;\r\n\r\n      /* // ,   \r\n      setTimeout(() => {\r\n        this.log('handleFollowingPinnedMessage: unlock');\r\n        this.locked = false;\r\n      }, 50); */\r\n    } catch(err) {\r\n      this.log.error('handleFollowingPinnedMessage error:', err);\r\n\r\n      this.locked = false;\r\n      this.waitForScrollBottom = false;\r\n      this.setCorrectIndex(0);\r\n    }\r\n  }\r\n\r\n  public async followPinnedMessage(mid: number) {\r\n    const message = await this.chat.getMessage(mid);\r\n    if(!message) {\r\n      return;\r\n    }\r\n\r\n    this.chat.setMessageId(mid);\r\n    (this.chat.setPeerPromise || Promise.resolve()).then(() => { // * debounce fast clicker\r\n      this.handleFollowingPinnedMessage();\r\n      this.testMid(this.pinnedIndex >= (this.count - 1) ? this.pinnedMaxMid : mid - 1);\r\n    });\r\n  }\r\n\r\n  public async _setPinnedMessage() {\r\n    // ///this.log('setting pinned message', message);\r\n    // return;\r\n    /* const promise: Promise<any> = this.chat.setPeerPromise || this.chat.bubbles.messagesQueuePromise || Promise.resolve();\r\n    Promise.all([\r\n      promise\r\n    ]).then(() => { */\r\n    // const mids = results[0];\r\n    const count = this.count;\r\n    if(count) {\r\n      const pinnedIndex = this.pinnedIndex;\r\n      const message = await this.chat.getMessage(this.pinnedMid);\r\n\r\n      // this.animatedCounter.prepareNumber(count);\r\n\r\n      // setTimeout(() => {\r\n      const isLast = pinnedIndex === 0;\r\n      this.animatedCounter.container.classList.toggle('is-last', isLast);\r\n      // SetTransition(this.animatedCounter.container, 'is-last', isLast, AnimatedSuper.DURATION);\r\n      if(!isLast) {\r\n        this.animatedCounter.setCount(count - pinnedIndex);\r\n      }\r\n      // }, 100);\r\n\r\n      // this.pinnedMessageContainer.fill(undefined, message.message, message);\r\n      this.pinnedMessageContainer.toggle(false);\r\n\r\n      const fromTop = pinnedIndex > this.wasPinnedIndex;\r\n\r\n      this.debug && this.log('setPinnedMessage: fromTop', fromTop, pinnedIndex, this.wasPinnedIndex);\r\n\r\n      const writeTo = this.animatedSubtitle.getRow(pinnedIndex);\r\n      const writeMediaTo = this.animatedMedia.getRow(pinnedIndex);\r\n      writeMediaTo.classList.add('pinned-message-media');\r\n      // writeMediaTo.innerHTML = writeMediaTo.style.cssText = writeMediaTo.dataset.docId = '';\r\n      const loadPromises: Promise<any>[] = [];\r\n      const isMediaSet = await wrapReplyDivAndCaption({\r\n        title: undefined,\r\n        titleEl: null,\r\n        subtitle: (message as Message.message).message,\r\n        subtitleEl: writeTo,\r\n        message,\r\n        mediaEl: writeMediaTo,\r\n        loadPromises\r\n      });\r\n\r\n      await Promise.all(loadPromises);\r\n\r\n      this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-media', isMediaSet);\r\n\r\n      // if(this.wasPinnedIndex !== this.pinnedIndex) {\r\n      this.animatedSubtitle.animate(pinnedIndex, this.wasPinnedIndex);\r\n      if(isMediaSet) {\r\n        this.animatedMedia.animate(pinnedIndex, this.wasPinnedMediaIndex); // * wasPinnedMediaIndex - ,      \r\n        this.wasPinnedMediaIndex = pinnedIndex;\r\n      } else {\r\n        this.animatedMedia.clearRows();\r\n      }\r\n      // }\r\n\r\n      this.pinnedMessageBorder.render(count, count - pinnedIndex - 1);\r\n      this.wasPinnedIndex = pinnedIndex;\r\n      this.pinnedMessageContainer.divAndCaption.container.dataset.mid = '' + message.mid;\r\n    } else {\r\n      this.pinnedMessageContainer.toggle(true);\r\n      this.wasPinnedIndex = 0;\r\n    }\r\n\r\n    this.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-many', this.count > 1);\r\n    // });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ListenerSetter from '../listenerSetter';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\n\r\nexport default function handleScrollSideEvent(elem: HTMLElement, side: 'top' | 'bottom', callback: () => void, listenerSetter: ListenerSetter) {\r\n  if(IS_TOUCH_SUPPORTED) {\r\n    let lastY: number;\r\n    const options = {passive: true};\r\n    listenerSetter.add(elem)('touchstart', (e) => {\r\n      if(e.touches.length > 1) {\r\n        onTouchEnd();\r\n        return;\r\n      }\r\n\r\n      lastY = e.touches[0].clientY;\r\n\r\n      listenerSetter.add(elem)('touchmove', onTouchMove, options);\r\n      listenerSetter.add(elem)('touchend', onTouchEnd, options);\r\n    }, options);\r\n\r\n    const onTouchMove = (e: TouchEvent) => {\r\n      const clientY = e.touches[0].clientY;\r\n\r\n      const isDown = clientY < lastY;\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n      lastY = clientY;\r\n      // alert('isDown: ' + !!isDown);\r\n    };\r\n\r\n    const onTouchEnd = () => {\r\n      listenerSetter.removeManual(elem, 'touchmove', onTouchMove, options);\r\n      listenerSetter.removeManual(elem, 'touchend', onTouchEnd, options);\r\n    };\r\n  } else {\r\n    listenerSetter.add(elem)('wheel', (e) => {\r\n      const isDown = e.deltaY > 0;\r\n      // this.log('wheel', e, isDown);\r\n      if(side === 'bottom' && isDown) callback();\r\n      else if(side === 'top' && !isDown) callback();\r\n    }, {passive: true});\r\n  }\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {Channel} from '../../lib/appManagers/appChatsManager';\nimport type {AppSidebarRight} from '../sidebarRight';\nimport type Chat from './chat';\nimport {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport rootScope from '../../lib/rootScope';\nimport AvatarElement from '../avatar';\nimport Button from '../button';\nimport ButtonIcon from '../buttonIcon';\nimport ButtonMenuToggle from '../buttonMenuToggle';\nimport ChatAudio from './audio';\nimport ChatPinnedMessage from './pinnedMessage';\nimport {ButtonMenuItemOptions} from '../buttonMenu';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport PopupDeleteDialog from '../popups/deleteDialog';\nimport appNavigationController from '../appNavigationController';\nimport {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../sidebarLeft';\nimport PeerTitle from '../peerTitle';\nimport {i18n} from '../../lib/langPack';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport findUpTag from '../../helpers/dom/findUpTag';\nimport {toast, toastNew} from '../toast';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {ChatFull, Chat as MTChat, GroupCall} from '../../layer';\nimport PopupPickUser from '../popups/pickUser';\nimport PopupPeer from '../popups/peer';\nimport AppEditContactTab from '../sidebarRight/tabs/editContact';\nimport appMediaPlaybackController from '../appMediaPlaybackController';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../../lib/calls/types';\nimport PopupMute from '../popups/mute';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport hasRights from '../../lib/appManagers/utils/chats/hasRights';\nimport wrapPeerTitle from '../wrappers/peerTitle';\nimport groupCallsController from '../../lib/calls/groupCallsController';\nimport apiManagerProxy from '../../lib/mtproto/mtprotoworker';\n\ntype ButtonToVerify = {element?: HTMLElement, verify: () => boolean | Promise<boolean>};\n\nexport default class ChatTopbar {\n  public container: HTMLDivElement;\n  private btnBack: HTMLButtonElement;\n  private chatInfo: HTMLDivElement;\n  private avatarElement: AvatarElement;\n  private title: HTMLDivElement;\n  private subtitle: HTMLDivElement;\n  private chatUtils: HTMLDivElement;\n  private btnJoin: HTMLButtonElement;\n  private btnPinned: HTMLButtonElement;\n  private btnCall: HTMLButtonElement;\n  private btnGroupCall: HTMLButtonElement;\n  private btnMute: HTMLButtonElement;\n  private btnSearch: HTMLButtonElement;\n  private btnMore: HTMLElement;\n\n  private chatAudio: ChatAudio;\n  public pinnedMessage: ChatPinnedMessage;\n\n  private setUtilsRAF: number;\n  private setPeerStatusInterval: number;\n\n  public listenerSetter: ListenerSetter;\n\n  private menuButtons: (ButtonMenuItemOptions & {verify: ButtonToVerify['verify']})[];\n  private buttonsToVerify: ButtonToVerify[];\n  private chatInfoContainer: HTMLDivElement;\n\n  constructor(\n    private chat: Chat,\n    private appSidebarRight: AppSidebarRight,\n    private managers: AppManagers\n  ) {\n    this.listenerSetter = new ListenerSetter();\n\n    this.menuButtons = [];\n    this.buttonsToVerify = [];\n  }\n\n  public construct() {\n    // this.chat.log.error('Topbar construction');\n\n    this.container = document.createElement('div');\n    this.container.classList.add('sidebar-header', 'topbar', 'hide');\n    this.container.dataset.floating = '0';\n\n    this.btnBack = ButtonIcon('left sidebar-close-button', {noRipple: true});\n\n    // * chat info section\n    this.chatInfoContainer = document.createElement('div');\n    this.chatInfoContainer.classList.add('chat-info-container');\n\n    this.chatInfo = document.createElement('div');\n    this.chatInfo.classList.add('chat-info');\n\n    const person = document.createElement('div');\n    person.classList.add('person');\n\n    const content = document.createElement('div');\n    content.classList.add('content');\n\n    const top = document.createElement('div');\n    top.classList.add('top');\n\n    this.title = document.createElement('div');\n    this.title.classList.add('user-title');\n\n    top.append(this.title);\n\n    const bottom = document.createElement('div');\n    bottom.classList.add('bottom');\n\n    if(this.subtitle) {\n      bottom.append(this.subtitle);\n    }\n\n    content.append(top, bottom);\n    if(this.avatarElement) {\n      person.append(this.avatarElement);\n    }\n\n    person.append(content);\n    this.chatInfo.append(person);\n\n    // * chat utils section\n    this.chatUtils = document.createElement('div');\n    this.chatUtils.classList.add('chat-utils');\n\n    this.chatAudio = new ChatAudio(this, this.chat, this.managers);\n\n    if(this.menuButtons.length) {\n      this.btnMore = ButtonMenuToggle({listenerSetter: this.listenerSetter}, 'bottom-left', this.menuButtons, this.verifyButtons);\n    }\n\n    this.chatUtils.append(...[\n      // this.chatAudio ? this.chatAudio.divAndCaption.container : null,\n      this.pinnedMessage ? this.pinnedMessage.pinnedMessageContainer.divAndCaption.container : null,\n      this.btnJoin,\n      this.btnPinned,\n      this.btnCall,\n      this.btnGroupCall,\n      this.btnMute,\n      this.btnSearch,\n      this.btnMore\n    ].filter(Boolean));\n\n    this.pushButtonToVerify(this.btnCall, this.verifyCallButton.bind(this, 'voice'));\n    this.pushButtonToVerify(this.btnGroupCall, this.verifyVideoChatButton);\n\n    this.chatInfoContainer.append(this.btnBack, this.chatInfo, this.chatUtils);\n    this.container.append(this.chatInfoContainer);\n\n    if(this.chatAudio) {\n      // this.container.append(this.chatAudio.divAndCaption.container, this.chatUtils);\n      this.container.append(this.chatAudio.divAndCaption.container);\n    }\n\n    // * construction end\n\n    // * fix topbar overflow section\n\n    this.listenerSetter.add(window)('resize', this.onResize);\n    this.listenerSetter.add(mediaSizes)('changeScreen', this.onChangeScreen);\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'pinned-container');\n      blurActiveElement();\n      if(container) {\n        cancelEvent(e);\n\n        if(findUpClassName(e.target, 'progress-line')) {\n          return;\n        }\n\n        const mid = +container.dataset.mid;\n        if(container.classList.contains('pinned-message')) {\n          // if(!this.pinnedMessage.locked) {\n          this.pinnedMessage.followPinnedMessage(mid);\n          // }\n        } else {\n          const peerId = container.dataset.peerId.toPeerId();\n          const searchContext = appMediaPlaybackController.getSearchContext();\n          this.chat.appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: mid,\n            type: searchContext.isScheduled ? 'scheduled' : (searchContext.threadId ? 'discussion' : undefined),\n            threadId: searchContext.threadId\n          });\n        }\n      } else {\n        if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n          onBtnBackClick();\n        } else if(findUpTag(e.target, 'AVATAR-ELEMENT')) {\n          this.appSidebarRight.toggleSidebar(!document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME));\n        } else {\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      }\n    }, {listenerSetter: this.listenerSetter});\n\n    const onBtnBackClick = (e?: Event) => {\n      if(e) {\n        cancelEvent(e);\n      }\n\n      // const item = appNavigationController.findItemByType('chat');\n      // * return manually to chat by arrow, since can't get back to\n      if(mediaSizes.activeScreen === ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n        this.chat.appImManager.setPeer({peerId: this.peerId});\n      } else {\n        const isFirstChat = this.chat.appImManager.chats.indexOf(this.chat) === 0;\n        appNavigationController.back(isFirstChat ? 'im' : 'chat');\n        /* return;\n\n        if(mediaSizes.activeScreen === ScreenSize.medium && !appNavigationController.findItemByType('chat')) {\n          this.chat.appImManager.setPeer(0);\n          blurActiveElement();\n        } else {\n          appNavigationController.back('chat');\n        } */\n      }\n    };\n\n    attachClickEvent(this.btnBack, onBtnBackClick, {listenerSetter: this.listenerSetter});\n  }\n\n  private pushButtonToVerify(element: HTMLElement, verify: ButtonToVerify['verify']) {\n    if(!element) {\n      return;\n    }\n\n    this.buttonsToVerify.push({element, verify});\n  }\n\n  private verifyButtons = (e?: Event) => {\n    const isMenuOpen = !!e || !!(this.btnMore && this.btnMore.classList.contains('menu-open'));\n\n    e && cancelEvent(e);\n\n    const r = async() => {\n      const deleteButtonText = await this.managers.appPeersManager.getDeleteButtonText(this.peerId);\n      if(isMenuOpen) {\n        // delete button\n        this.menuButtons[this.menuButtons.length - 1].element.lastChild.replaceWith(i18n(deleteButtonText));\n      }\n\n      const buttons = this.buttonsToVerify.concat(isMenuOpen ? this.menuButtons : []);\n      const results = await Promise.all(buttons.map(async(button) => {\n        return {\n          result: await button.verify(),\n          button\n        }\n      }));\n\n      results.forEach(({button, result}) => {\n        button.element.classList.toggle('hide', !result);\n      });\n    };\n\n    r();\n  };\n\n  private verifyVideoChatButton = async(type?: 'group' | 'broadcast') => {\n    if(!IS_GROUP_CALL_SUPPORTED || this.peerId.isUser()) return false;\n\n    const currentGroupCall = groupCallsController.groupCall;\n    const chatId = this.peerId.toChatId();\n    if(currentGroupCall?.chatId === chatId) {\n      return false;\n    }\n\n    if(type) {\n      if(((await this.managers.appPeersManager.isBroadcast(this.peerId)) && type === 'group') ||\n        ((await this.managers.appPeersManager.isAnyGroup(this.peerId)) && type === 'broadcast')) {\n        return false;\n      }\n    }\n\n    const chat = await this.managers.appChatsManager.getChatTyped(chatId);\n    return (chat as MTChat.chat).pFlags?.call_active || hasRights(chat, 'manage_call');\n  };\n\n  private verifyCallButton = async(type?: CallType) => {\n    if(!IS_CALL_SUPPORTED || !this.peerId.isUser()) return false;\n    const userId = this.peerId.toUserId();\n    const userFull = await this.managers.appProfileManager.getCachedFullUser(userId);\n\n    return !!userFull && !!(type === 'voice' ? userFull.pFlags.phone_calls_available : userFull.pFlags.video_calls_available);\n  };\n\n  public constructUtils() {\n    this.menuButtons = [{\n      icon: 'search',\n      text: 'Search',\n      onClick: () => {\n        this.chat.initSearch();\n      },\n      verify: () => mediaSizes.isMobile\n    }, /* {\n      icon: 'pinlist',\n      text: 'Pinned Messages',\n      onClick: () => this.openPinned(false),\n      verify: () => mediaSizes.isMobile\n    }, */{\n      icon: 'mute',\n      text: 'ChatList.Context.Mute',\n      onClick: this.onMuteClick,\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && !(await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'unmute',\n      text: 'ChatList.Context.Unmute',\n      onClick: () => {\n        this.managers.appMessagesManager.togglePeerMute(this.peerId);\n      },\n      verify: async() => this.chat.type === 'chat' && rootScope.myId !== this.peerId && (await this.managers.appNotificationsManager.isPeerLocalMuted(this.peerId, false))\n    }, {\n      icon: 'comments',\n      text: 'ViewDiscussion',\n      onClick: () => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        Promise.resolve(this.managers.appProfileManager.getChannelFull(this.peerId.toChatId())).then((channelFull) => {\n          if(middleware() && channelFull.linked_chat_id) {\n            this.chat.appImManager.setInnerPeer({\n              peerId: channelFull.linked_chat_id.toPeerId(true)\n            });\n          }\n        });\n      },\n      verify: async() => {\n        const chatFull = await this.managers.appProfileManager.getCachedFullChat(this.peerId.toChatId());\n        return this.chat.type === 'chat' && !!(chatFull as ChatFull.channelFull)?.linked_chat_id;\n      }\n    }, {\n      icon: 'phone',\n      text: 'Call',\n      onClick: this.onCallClick.bind(this, 'voice'),\n      verify: this.verifyCallButton.bind(this, 'voice')\n    }, {\n      icon: 'videocamera',\n      text: 'VideoCall',\n      onClick: this.onCallClick.bind(this, 'video'),\n      verify: this.verifyCallButton.bind(this, 'video')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.LiveStream',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'broadcast')\n    }, {\n      icon: 'videochat',\n      text: 'PeerInfo.Action.VoiceChat',\n      onClick: this.onJoinGroupCallClick,\n      verify: this.verifyVideoChatButton.bind(this, 'group')\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.SelectMessages',\n      onClick: () => {\n        const selection = this.chat.selection;\n        selection.toggleSelection(true, true);\n        apiManagerProxy.getState().then((state) => {\n          if(state.chatContextMenuHintWasShown) {\n            return;\n          }\n\n          const original = selection.toggleByElement.bind(selection);\n          selection.toggleByElement = async(bubble) => {\n            this.managers.appStateManager.pushToState('chatContextMenuHintWasShown', true);\n            toast(i18n('Chat.Menu.Hint'));\n\n            selection.toggleByElement = original;\n            selection.toggleByElement(bubble);\n          };\n        });\n      },\n      verify: () => !this.chat.selection.isSelecting && !!this.chat.bubbles.getRenderedLength()\n    }, {\n      icon: 'select',\n      text: 'Chat.Menu.ClearSelection',\n      onClick: () => {\n        this.chat.selection.cancelSelection();\n      },\n      verify: () => this.chat.selection.isSelecting\n    }, {\n      icon: 'adduser',\n      text: 'AddContact',\n      onClick: () => {\n        if(!this.appSidebarRight.isTabExists(AppEditContactTab)) {\n          const tab = this.appSidebarRight.createTab(AppEditContactTab);\n          tab.peerId = this.peerId;\n          tab.open();\n\n          this.appSidebarRight.toggleSidebar(true);\n        }\n      },\n      verify: async() => this.peerId.isUser() && !(await this.managers.appPeersManager.isContact(this.peerId))\n    }, {\n      icon: 'forward',\n      text: 'ShareContact',\n      onClick: () => {\n        const contactPeerId = this.peerId;\n        new PopupPickUser({\n          peerTypes: ['dialogs', 'contacts'],\n          onSelect: (peerId) => {\n            return new Promise((resolve, reject) => {\n              new PopupPeer('', {\n                titleLangKey: 'SendMessageTitle',\n                descriptionLangKey: 'SendContactToGroupText',\n                descriptionLangArgs: [new PeerTitle({peerId, dialog: true}).element],\n                buttons: [{\n                  langKey: 'Send',\n                  callback: () => {\n                    resolve();\n\n                    this.managers.appMessagesManager.sendContact(peerId, contactPeerId);\n                    this.chat.appImManager.setInnerPeer({peerId});\n                  }\n                }, {\n                  langKey: 'Cancel',\n                  callback: () => {\n                    reject();\n                  },\n                  isCancel: true\n                }],\n                peerId,\n                overlayClosable: true\n              }).show();\n            });\n          },\n          placeholder: 'ShareModal.Search.Placeholder',\n          chatRightsAction: 'send_messages',\n          selfPresence: 'ChatYourSelf'\n        });\n      },\n      verify: async() => rootScope.myId !== this.peerId && this.peerId.isUser() && (await this.managers.appPeersManager.isContact(this.peerId)) && !!(await this.managers.appUsersManager.getUser(this.peerId.toUserId())).phone\n    }, {\n      icon: 'lock',\n      text: 'BlockUser',\n      onClick: () => {\n        new PopupPeer('', {\n          peerId: this.peerId,\n          titleLangKey: 'BlockUser',\n          descriptionLangKey: 'AreYouSureBlockContact2',\n          descriptionLangArgs: [new PeerTitle({peerId: this.peerId}).element],\n          buttons: [{\n            langKey: 'BlockUser',\n            isDanger: true,\n            callback: () => {\n              this.managers.appUsersManager.toggleBlock(this.peerId, true).then((value) => {\n                if(value) {\n                  toastNew({langPackKey: 'UserBlocked'});\n                }\n              });\n            }\n          }]\n        }).show();\n      },\n      verify: async() => {\n        if(!this.peerId.isUser()) return false;\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return this.peerId !== rootScope.myId && userFull && !userFull.pFlags?.blocked;\n      }\n    }, {\n      icon: 'lockoff',\n      text: 'Unblock',\n      onClick: () => {\n        this.managers.appUsersManager.toggleBlock(this.peerId, false).then((value) => {\n          if(value) {\n            toastNew({langPackKey: 'UserUnblocked'});\n          }\n        });\n      },\n      verify: async() => {\n        const userFull = await this.managers.appProfileManager.getCachedFullUser(this.peerId.toUserId());\n        return !!userFull?.pFlags?.blocked;\n      }\n    }, {\n      icon: 'delete danger',\n      text: 'Delete',\n      onClick: () => {\n        new PopupDeleteDialog(this.peerId/* , 'leave' */);\n      },\n      verify: async() => this.chat.type === 'chat' && !!(await this.managers.appMessagesManager.getDialogOnly(this.peerId))\n    }];\n\n    this.btnSearch = ButtonIcon('search');\n    this.attachClickEvent(this.btnSearch, (e) => {\n      this.chat.initSearch();\n    }, true);\n  }\n\n  public attachClickEvent(el: HTMLElement, cb: (e: MouseEvent) => void, noBlur?: boolean) {\n    attachClickEvent(el, (e) => {\n      cancelEvent(e);\n      !noBlur && blurActiveElement();\n      cb(e);\n    }, {listenerSetter: this.listenerSetter});\n  }\n\n  private onCallClick(type: CallType) {\n    this.chat.appImManager.callUser(this.peerId.toUserId(), type);\n  }\n\n  private onJoinGroupCallClick = () => {\n    this.chat.appImManager.joinGroupCall(this.peerId);\n  };\n\n  private constructAvatar() {\n    const avatarElement = new AvatarElement();\n    avatarElement.isDialog = true;\n    avatarElement.classList.add('avatar-42', 'person-avatar');\n    return avatarElement;\n  }\n\n  private get peerId() {\n    return this.chat.peerId;\n  }\n\n  public constructPeerHelpers() {\n    this.avatarElement = this.constructAvatar();\n\n    this.subtitle = document.createElement('div');\n    this.subtitle.classList.add('info');\n\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n\n    this.btnJoin = Button('btn-primary btn-color-primary chat-join hide');\n    this.btnCall = ButtonIcon('phone');\n    this.btnGroupCall = ButtonIcon('videochat');\n    this.btnPinned = ButtonIcon('pinlist');\n    this.btnMute = ButtonIcon('mute');\n\n    this.attachClickEvent(this.btnCall, this.onCallClick.bind(this, 'voice'));\n    this.attachClickEvent(this.btnGroupCall, this.onJoinGroupCallClick);\n\n    this.attachClickEvent(this.btnPinned, () => {\n      this.openPinned(true);\n    });\n\n    this.attachClickEvent(this.btnMute, this.onMuteClick);\n\n    this.attachClickEvent(this.btnJoin, async() => {\n      const middleware = this.chat.bubbles.getMiddleware();\n      this.btnJoin.setAttribute('disabled', 'true');\n\n      const chatId = this.peerId.toChatId();\n      let promise: Promise<any>;\n      if(await this.managers.appChatsManager.isChannel(chatId)) {\n        promise = this.managers.appChatsManager.joinChannel(chatId);\n      } else {\n        promise = this.managers.appChatsManager.addChatUser(chatId, rootScope.myId);\n      }\n\n      promise.finally(() => {\n        if(!middleware()) {\n          return;\n        }\n\n        this.btnJoin.removeAttribute('disabled');\n      });\n    });\n\n    this.listenerSetter.add(rootScope)('chat_update', async(chatId) => {\n      if(this.peerId === chatId.toPeerId(true)) {\n        const chat = await this.managers.appChatsManager.getChat(chatId) as Channel/*  | Chat */;\n\n        this.btnJoin.classList.toggle('hide', !(chat as Channel)?.pFlags?.left);\n        this.setUtilsWidth();\n        this.verifyButtons();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('dialog_notify_settings', (dialog) => {\n      if(dialog.peerId === this.peerId) {\n        this.setMutedState();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_typings', ({peerId}) => {\n      if(this.peerId === peerId) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('user_update', (userId) => {\n      if(this.peerId === userId.toPeerId()) {\n        this.setPeerStatus();\n      }\n    });\n\n    this.listenerSetter.add(rootScope)('peer_full_update', (peerId) => {\n      if(this.peerId === peerId) {\n        this.verifyButtons();\n      }\n    });\n\n    if(this.pinnedMessage) {\n      this.chat.addEventListener('setPeer', (mid, isTopMessage) => {\n        const middleware = this.chat.bubbles.getMiddleware();\n        apiManagerProxy.getState().then((state) => {\n          if(!middleware()) return;\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[this.chat.peerId];\n\n          if(isTopMessage) {\n            this.pinnedMessage.unsetScrollDownListener();\n            this.pinnedMessage.testMid(mid, 0); // * because slider will not let get bubble by document.elementFromPoint\n          } else if(!this.pinnedMessage.locked) {\n            this.pinnedMessage.handleFollowingPinnedMessage();\n            this.pinnedMessage.testMid(mid);\n          }\n        });\n      });\n    }\n\n    this.setPeerStatusInterval = window.setInterval(this.setPeerStatus, 60e3);\n\n    return this;\n  }\n\n  public constructPinnedHelpers() {\n    this.listenerSetter.add(rootScope)('peer_pinned_messages', ({peerId, mids}) => {\n      if(peerId !== this.peerId) return;\n\n      if(mids) {\n        this.setTitle();\n      }\n    });\n  }\n\n  public constructDiscussionHelpers() {\n    this.pinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n  }\n\n  public openPinned(byCurrent: boolean) {\n    this.chat.appImManager.setInnerPeer({\n      peerId: this.peerId,\n      lastMsgId: byCurrent ? +this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.dataset.mid : 0,\n      type: 'pinned'\n    });\n  }\n\n  private onMuteClick = () => {\n    new PopupMute(this.peerId);\n  };\n\n  private onResize = () => {\n    this.setUtilsWidth(true);\n    this.setFloating();\n  };\n\n  private onChangeScreen = (from: ScreenSize, to: ScreenSize) => {\n    this.container.classList.toggle('is-pinned-floating', mediaSizes.isMobile);\n    // this.chatAudio && this.chatAudio.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.classList.toggle('is-floating', to === ScreenSize.mobile);\n    this.onResize();\n  };\n\n  public destroy() {\n    // this.chat.log.error('Topbar destroying');\n    this.listenerSetter.removeAll();\n    window.clearInterval(this.setPeerStatusInterval);\n\n    if(this.pinnedMessage) {\n      this.pinnedMessage.destroy(); // *     \n    }\n\n    if(this.chatAudio) {\n      this.chatAudio.destroy();\n    }\n\n    delete this.chatAudio;\n    delete this.pinnedMessage;\n  }\n\n  public cleanup() {\n    if(!this.chat.peerId) {\n      this.container.classList.add('hide');\n    }\n  }\n\n  public async finishPeerChange(isTarget: boolean) {\n    const peerId = this.peerId;\n\n    let newAvatar: AvatarElement;\n    if(this.avatarElement) {\n      newAvatar = this.constructAvatar();\n    }\n\n    const [isBroadcast, isAnyChat, chat, _, setTitleCallback, setStatusCallback, state] = await Promise.all([\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isAnyChat(peerId),\n      peerId.isAnyChat() ? this.managers.appChatsManager.getChat(peerId.toChatId()) : undefined,\n      newAvatar ? newAvatar.updateWithOptions({peerId}) : undefined,\n      this.setTitleManual(),\n      this.setPeerStatusManual(true),\n      apiManagerProxy.getState()\n    ]);\n\n    return () => {\n      this.btnMute && this.btnMute.classList.toggle('hide', !isBroadcast);\n      if(this.btnJoin) {\n        if(isAnyChat && !this.chat.isRestricted) {\n          replaceContent(this.btnJoin, i18n(isBroadcast ? 'Chat.Subscribe' : 'ChannelJoin'));\n          this.btnJoin.classList.toggle('hide', !chat?.pFlags?.left);\n        } else {\n          this.btnJoin.classList.add('hide');\n        }\n      }\n\n      if(newAvatar) {\n        this.avatarElement.replaceWith(newAvatar);\n        this.avatarElement = newAvatar;\n      }\n\n      this.setUtilsWidth();\n\n      this.verifyButtons();\n\n      if(this.pinnedMessage) { // * replace with new one\n        if(this.chat.type === 'chat') {\n          if(this.chat.wasAlreadyUsed) { // * change\n            const newPinnedMessage = new ChatPinnedMessage(this, this.chat, this.managers);\n            this.pinnedMessage.pinnedMessageContainer.divAndCaption.container.replaceWith(newPinnedMessage.pinnedMessageContainer.divAndCaption.container);\n            this.pinnedMessage.destroy();\n            // this.pinnedMessage.pinnedMessageContainer.toggle(true);\n            this.pinnedMessage = newPinnedMessage;\n          }\n\n          this.pinnedMessage.hidden = !!state.hiddenPinnedMessages[peerId];\n        } else if(this.chat.type === 'discussion') {\n          this.pinnedMessage.pinnedMid = this.chat.threadId;\n          this.pinnedMessage.count = 1;\n          this.pinnedMessage.pinnedIndex = 0;\n          this.pinnedMessage._setPinnedMessage();\n        }\n      }\n\n      setTitleCallback();\n      setStatusCallback && setStatusCallback();\n      this.setMutedState();\n\n      this.container.classList.remove('hide');\n    };\n  }\n\n  public async setTitleManual(count?: number) {\n    const peerId = this.peerId;\n    const middleware = () => this.peerId === peerId;\n    let titleEl: HTMLElement, icons: Element[];\n    if(this.chat.type === 'pinned') {\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('PinnedMessagesCount', [count]);\n\n      if(count === undefined) {\n        this.managers.appMessagesManager.getSearchCounters(peerId, [{_: 'inputMessagesFilterPinned'}], false).then((result) => {\n          if(!middleware()) return;\n          const count = result[0].count;\n          this.setTitle(count);\n\n          // !  2,      \n          if(!count) {\n            this.chat.appImManager.setPeer(); // * close tab\n\n            // ! ,     ,  ,      \n            const originalChat = this.chat.appImManager.chat;\n            if(originalChat.topbar.pinnedMessage) {\n              originalChat.topbar.pinnedMessage.pinnedMessageContainer.toggle(true);\n            }\n          }\n        });\n      }\n    } else if(this.chat.type === 'scheduled') {\n      titleEl = i18n(peerId === rootScope.myId ? 'Reminders' : 'ScheduledMessages');\n    } else if(this.chat.type === 'discussion') {\n      if(count === undefined) {\n        const result = await this.managers.acknowledged.appMessagesManager.getHistory(peerId, 0, 1, 0, this.chat.threadId);\n        if(!middleware()) return;\n        if(result.cached) {\n          const historyResult = await result.result;\n          if(!middleware()) return;\n          count = historyResult.count;\n        } else result.result.then((historyResult) => {\n          if(!middleware()) return;\n          this.setTitle(historyResult.count);\n        });\n      }\n\n      if(count === undefined) titleEl = i18n('Loading');\n      else titleEl = i18n('Chat.Title.Comments', [count]);\n    } else if(this.chat.type === 'chat') {\n      [titleEl/* , icons */] = await Promise.all([\n        wrapPeerTitle({\n          peerId,\n          dialog: true,\n          withIcons: true\n        })\n        // generateTitleIcons(peerId)\n      ]);\n\n      if(!middleware()) {\n        return;\n      }\n    }\n\n    return () => {\n      replaceContent(this.title, titleEl);\n      // if(icons) {\n      //   this.title.append(...icons);\n      // }\n    };\n  }\n\n  public setTitle(count?: number) {\n    this.setTitleManual(count).then((setTitleCallback) => setTitleCallback());\n  }\n\n  public async setMutedState() {\n    if(!this.btnMute) return;\n\n    const peerId = this.peerId;\n    const muted = await this.managers.appNotificationsManager.isPeerLocalMuted(peerId, false);\n    if(await this.managers.appPeersManager.isBroadcast(peerId)) { // not human\n      this.btnMute.classList.remove('tgico-mute', 'tgico-unmute');\n      this.btnMute.classList.add(muted ? 'tgico-unmute' : 'tgico-mute');\n      this.btnMute.style.display = '';\n    } else {\n      this.btnMute.style.display = 'none';\n    }\n  }\n\n  // !    ,    -    ,          ,    !\n  public setUtilsWidth = (resize = false) => {\n    // return;\n    if(this.setUtilsRAF) window.cancelAnimationFrame(this.setUtilsRAF);\n\n    if(IS_SAFARI && resize) {\n      this.chatUtils.classList.add('hide');\n    }\n\n    // mutationObserver.disconnect();\n    this.setUtilsRAF = window.requestAnimationFrame(() => {\n      // mutationRAF = window.requestAnimationFrame(() => {\n\n      // setTimeout(() => {\n      if(IS_SAFARI && resize) {\n        this.chatUtils.classList.remove('hide');\n      }\n      /* this.chatInfo.style.removeProperty('--utils-width');\n          void this.chatInfo.offsetLeft; // reflow */\n      const width = /* chatUtils.scrollWidth */this.chatUtils.getBoundingClientRect().width;\n      this.chat.log('utils width:', width);\n      this.container.style.setProperty('--utils-width', width + 'px');\n      // this.chatInfo.classList.toggle('have-utils-width', !!width);\n      // }, 0);\n\n      this.setUtilsRAF = 0;\n\n      // mutationObserver.observe(chatUtils, observeOptions);\n      // });\n    });\n  };\n\n  public setFloating = () => {\n    const containers = [this.chatAudio, this.pinnedMessage && this.pinnedMessage.pinnedMessageContainer].filter(Boolean);\n    const count = containers.reduce((acc, container) => {\n      const isFloating = container.isFloating();\n      this.container.classList.toggle(`is-pinned-${container.className}-floating`, isFloating);\n\n      if(!container.isVisible()) {\n        return acc;\n      }\n\n      return acc + +isFloating;\n    }, 0);\n    this.container.dataset.floating = '' + count;\n  };\n\n  public setPeerStatusManual = async(needClear = false) => {\n    if(!this.subtitle) return;\n\n    const peerId = this.peerId;\n    return this.chat.appImManager.setPeerStatus(\n      peerId,\n      this.subtitle,\n      needClear,\n      false,\n      () => peerId === this.peerId\n    );\n  };\n\n  public setPeerStatus = (needClear?: boolean) => {\n    return this.setPeerStatusManual(needClear).then((callback) => {\n      if(callback) {\n        callback();\n      }\n    });\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport appSidebarRight from '..';\r\nimport {attachClickEvent} from '../../../helpers/dom/clickEvent';\r\nimport AppSearch, {SearchGroup} from '../../appSearch';\r\nimport ButtonIcon from '../../buttonIcon';\r\nimport InputSearch from '../../inputSearch';\r\nimport PopupElement from '../../popups';\r\nimport PopupDatePicker from '../../popups/datePicker';\r\nimport {SliderSuperTab} from '../../slider';\r\n\r\nexport default class AppPrivateSearchTab extends SliderSuperTab {\r\n  private inputSearch: InputSearch;\r\n  private appSearch: AppSearch;\r\n  private btnPickDate: HTMLElement;\r\n\r\n  private peerId: PeerId;\r\n  private threadId = 0;\r\n  private query = '';\r\n  private onDatePick: (timestamp: number) => void;\r\n\r\n  onOpenAfterTimeout() {\r\n    this.appSearch.beginSearch(this.peerId, this.threadId, this.query);\r\n  }\r\n\r\n  protected init() {\r\n    this.container.id = 'search-private-container';\r\n    this.container.classList.add('chatlist-container');\r\n    this.inputSearch = new InputSearch('Search');\r\n    this.title.replaceWith(this.inputSearch.container);\r\n\r\n    this.btnPickDate = ButtonIcon('calendar sidebar-header-right');\r\n    this.header.append(this.btnPickDate);\r\n\r\n    const c = document.createElement('div');\r\n    c.classList.add('chatlist-container');\r\n    this.scrollable.container.replaceWith(c);\r\n    this.appSearch = new AppSearch(c, this.inputSearch, {\r\n      messages: new SearchGroup('Chat.Search.PrivateSearch', 'messages')\r\n    });\r\n  }\r\n\r\n  open(peerId: PeerId, threadId?: number, onDatePick?: AppPrivateSearchTab['onDatePick'], query?: string) {\r\n    const ret = super.open();\r\n\r\n    if(!this.peerId) {\r\n      this.query = query;\r\n      this.peerId = peerId;\r\n      this.threadId = threadId;\r\n      this.onDatePick = onDatePick;\r\n\r\n      this.btnPickDate.classList.toggle('hide', !this.onDatePick);\r\n      if(this.onDatePick) {\r\n        attachClickEvent(this.btnPickDate, () => {\r\n          PopupElement.createPopup(PopupDatePicker, new Date(), this.onDatePick).show();\r\n        });\r\n      }\r\n\r\n      query && this.appSearch.searchInput.inputField.setValueSilently(query);\r\n\r\n      appSidebarRight.toggleSidebar(true);\r\n    } else {\r\n      this.appSearch.beginSearch(this.peerId, this.threadId, query);\r\n    }\r\n\r\n    return ret;\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type ChatTopbar from './topbar';\r\nimport AppSearch, {SearchGroup} from '../appSearch';\r\nimport PopupDatePicker from '../popups/datePicker';\r\nimport ripple from '../ripple';\r\nimport InputSearch from '../inputSearch';\r\nimport type Chat from './chat';\r\nimport findUpTag from '../../helpers/dom/findUpTag';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport whichChild from '../../helpers/dom/whichChild';\r\nimport replaceContent from '../../helpers/dom/replaceContent';\r\nimport {i18n} from '../../lib/langPack';\r\nimport ListenerSetter from '../../helpers/listenerSetter';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport appNavigationController, {NavigationItem} from '../appNavigationController';\r\nimport {IS_MOBILE_SAFARI} from '../../environment/userAgent';\r\nimport PopupElement from '../popups';\r\nimport {DIALOG_LIST_ELEMENT_TAG} from '../../lib/appManagers/appDialogsManager';\r\n\r\nexport default class ChatSearch {\r\n  private element: HTMLElement;\r\n  private backBtn: HTMLElement;\r\n  private inputSearch: InputSearch;\r\n\r\n  private results: HTMLElement;\r\n\r\n  private footer: HTMLElement;\r\n  private dateBtn: HTMLElement;\r\n  private foundCountEl: HTMLElement;\r\n  private controls: HTMLElement;\r\n  private downBtn: HTMLElement;\r\n  private upBtn: HTMLElement;\r\n\r\n  private appSearch: AppSearch;\r\n  private searchGroup: SearchGroup;\r\n\r\n  private foundCount = 0;\r\n  private selectedIndex = 0;\r\n  private setPeerPromise: Promise<any>;\r\n  private listenerSetter: ListenerSetter;\r\n  private navigationItem: NavigationItem;\r\n\r\n  constructor(private topbar: ChatTopbar, private chat: Chat, query?: string) {\r\n    this.element = document.createElement('div');\r\n    this.element.classList.add('sidebar-header', 'chat-search', 'chatlist-container');\r\n\r\n    this.backBtn = document.createElement('button');\r\n    this.backBtn.classList.add('btn-icon', 'tgico-left', 'sidebar-close-button');\r\n    ripple(this.backBtn);\r\n\r\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\r\n\r\n    const attachClick = (element: HTMLElement, callback: (e: MouseEvent) => void) => {\r\n      attachClickEvent(element, callback, {listenerSetter});\r\n    };\r\n\r\n    attachClick(this.backBtn, () => {\r\n      this.destroy();\r\n    });\r\n\r\n    this.inputSearch = new InputSearch('Search');\r\n\r\n    // Results\r\n    this.results = document.createElement('div');\r\n    this.results.classList.add('chat-search-results', 'chatlist-container');\r\n\r\n    this.searchGroup = new SearchGroup(false, 'messages', undefined, '', false);\r\n    attachClick(this.searchGroup.list, this.onResultsClick);\r\n\r\n    this.appSearch = new AppSearch(this.results, this.inputSearch, {\r\n      messages: this.searchGroup\r\n    }, (count) => {\r\n      this.foundCount = count;\r\n\r\n      if(!this.foundCount) {\r\n        replaceContent(this.foundCountEl, this.inputSearch.value ? i18n('NoResult') : '');\r\n        this.results.classList.remove('active');\r\n        this.chat.bubbles.container.classList.remove('search-results-active');\r\n        this.upBtn.setAttribute('disabled', 'true');\r\n        this.downBtn.setAttribute('disabled', 'true');\r\n      } else {\r\n        this.selectResult(this.searchGroup.list.children[0] as HTMLElement);\r\n      }\r\n    });\r\n    this.appSearch.beginSearch(this.chat.peerId, this.chat.threadId);\r\n\r\n    // appImManager.topbar.parentElement.insertBefore(this.results, appImManager.bubblesContainer);\r\n    this.chat.bubbles.container.append(this.results);\r\n\r\n    // Footer\r\n    this.footer = document.createElement('div');\r\n    this.footer.classList.add('chat-search-footer');\r\n\r\n    attachClick(this.footer, this.onFooterClick);\r\n    ripple(this.footer);\r\n\r\n    this.foundCountEl = document.createElement('span');\r\n    this.foundCountEl.classList.add('chat-search-count');\r\n\r\n    this.dateBtn = document.createElement('button');\r\n    this.dateBtn.classList.add('btn-icon', 'tgico-calendar');\r\n\r\n    this.controls = document.createElement('div');\r\n    this.controls.classList.add('chat-search-controls');\r\n\r\n    this.upBtn = document.createElement('button');\r\n    this.upBtn.classList.add('btn-icon', 'tgico-up');\r\n    this.downBtn = document.createElement('button');\r\n    this.downBtn.classList.add('btn-icon', 'tgico-down');\r\n\r\n    this.upBtn.setAttribute('disabled', 'true');\r\n    this.downBtn.setAttribute('disabled', 'true');\r\n\r\n    attachClick(this.dateBtn, this.onDateClick);\r\n    attachClick(this.upBtn, this.onUpClick);\r\n    attachClick(this.downBtn, this.onDownClick);\r\n    this.controls.append(this.upBtn, this.downBtn);\r\n\r\n    this.footer.append(this.foundCountEl, this.dateBtn, this.controls);\r\n\r\n    this.topbar.container.parentElement.insertBefore(this.footer, chat.input.chatInput);\r\n\r\n    // Append container\r\n    this.element.append(this.backBtn, this.inputSearch.container);\r\n\r\n    this.topbar.container.classList.add('hide-pinned');\r\n    this.topbar.container.parentElement.append(this.element);\r\n\r\n    this.inputSearch.input.focus();\r\n\r\n    if(query) {\r\n      this.setQuery(query);\r\n    }\r\n\r\n    if(!IS_MOBILE_SAFARI) {\r\n      this.navigationItem = {\r\n        type: 'mobile-search',\r\n        onPop: () => {\r\n          this.destroy();\r\n        }\r\n      };\r\n\r\n      appNavigationController.pushItem(this.navigationItem);\r\n    }\r\n  }\r\n\r\n  public destroy() {\r\n    this.topbar.container.classList.remove('hide-pinned');\r\n    this.element.remove();\r\n    this.inputSearch.remove();\r\n    this.results.remove();\r\n    this.footer.remove();\r\n    this.listenerSetter.removeAll();\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n    this.chat.search = undefined;\r\n    appNavigationController.removeItem(this.navigationItem);\r\n  }\r\n\r\n  public setQuery(query: string) {\r\n    this.inputSearch.inputField.value = query;\r\n  }\r\n\r\n  private onDateClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    PopupElement.createPopup(PopupDatePicker, new Date(), this.chat.bubbles.onDatePick).show();\r\n  };\r\n\r\n  private selectResult(elem: HTMLElement) {\r\n    if(this.setPeerPromise) return this.setPeerPromise;\r\n\r\n    const peerId = elem.dataset.peerId.toPeerId();\r\n    const lastMsgId = +elem.dataset.mid || undefined;\r\n\r\n    const index = whichChild(elem);\r\n\r\n    if(index === (this.foundCount - 1)) {\r\n      this.upBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.upBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    if(!index) {\r\n      this.downBtn.setAttribute('disabled', 'true');\r\n    } else {\r\n      this.downBtn.removeAttribute('disabled');\r\n    }\r\n\r\n    this.results.classList.remove('active');\r\n    this.chat.bubbles.container.classList.remove('search-results-active');\r\n\r\n    const res = this.chat.setPeer(peerId, lastMsgId);\r\n    this.setPeerPromise = ((res instanceof Promise ? res : Promise.resolve(res)) as Promise<any>).then(() => {\r\n      this.selectedIndex = index;\r\n      replaceContent(this.foundCountEl, i18n('Of', [index + 1, this.foundCount]));\r\n\r\n      const renderedCount = this.searchGroup.list.childElementCount;\r\n      if(this.selectedIndex >= (renderedCount - 6)) {\r\n        this.appSearch.searchMore();\r\n      }\r\n    }).finally(() => {\r\n      this.setPeerPromise = null;\r\n    });\r\n  }\r\n\r\n  private onResultsClick = (e: MouseEvent) => {\r\n    const target = findUpTag(e.target, DIALOG_LIST_ELEMENT_TAG);\r\n    if(target) {\r\n      this.selectResult(target);\r\n    }\r\n  };\r\n\r\n  private onFooterClick = (e: MouseEvent) => {\r\n    if(this.foundCount) {\r\n      this.chat.bubbles.container.classList.toggle('search-results-active');\r\n      this.results.classList.toggle('active');\r\n    }\r\n  };\r\n\r\n  private onUpClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex + 1] as HTMLElement);\r\n  };\r\n\r\n  private onDownClick = (e: MouseEvent) => {\r\n    cancelEvent(e);\r\n    this.selectResult(this.searchGroup.list.children[this.selectedIndex - 1] as HTMLElement);\r\n  };\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport {renderImageFromUrlPromise} from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\n\ntype ChatBackgroundPatternRendererInitOptions = {\n  url: string,\n  width: number,\n  height: number,\n  mask?: boolean\n};\n\nexport default class ChatBackgroundPatternRenderer {\n  private static INSTANCES: ChatBackgroundPatternRenderer[] = [];\n\n  // private pattern: CanvasPattern;\n  private objectUrl: string;\n  private options: ChatBackgroundPatternRendererInitOptions;\n  private canvases: Set<HTMLCanvasElement>;\n  // private createCanvasPatternPromise: Promise<CanvasPattern>;\n  // private exportCanvasPatternToImagePromise: Promise<string>;\n  private renderImageFromUrlPromise: Promise<HTMLImageElement>;\n  private img: HTMLImageElement;\n\n  constructor() {\n    this.canvases = new Set();\n  }\n\n  public static getInstance(options: ChatBackgroundPatternRendererInitOptions) {\n    let instance = this.INSTANCES.find((instance) => {\n      return deepEqual(instance.options, options);\n    });\n\n    if(!instance) {\n      instance = new ChatBackgroundPatternRenderer();\n      instance.init(options);\n      this.INSTANCES.push(instance);\n    }\n\n    return instance;\n  }\n\n  public init(options: ChatBackgroundPatternRendererInitOptions) {\n    // if(this.options) {\n    //   if(this.options.width !== options.width || this.options.height !== options.height) {\n    //     this.createCanvasPatternPromise =\n    //       this.pattern =\n    //       this.exportCanvasPatternToImagePromise =\n    //       undefined;\n    //   }\n    // }\n\n    this.options = options;\n  }\n\n  public renderToCanvas(canvas: HTMLCanvasElement) {\n    // return this.createCanvasPattern(canvas).then(() => {\n    // return this.fillCanvas(canvas);\n    // });\n\n    return this.renderImageFromUrl(this.options.url).then(() => {\n      return this.fillCanvas(canvas);\n    });\n  }\n\n  private renderImageFromUrl(url: string) {\n    if(this.renderImageFromUrlPromise) return this.renderImageFromUrlPromise;\n    const img = this.img = document.createElement('img');\n    img.crossOrigin = 'anonymous';\n    return this.renderImageFromUrlPromise = renderImageFromUrlPromise(img, url, false).then(() => img);\n  }\n\n  /* private createCanvasPattern(canvas: HTMLCanvasElement) {\n    if(this.createCanvasPatternPromise) return this.createCanvasPatternPromise;\n    return this.createCanvasPatternPromise = this.renderImageFromUrl(this.options.url).then((img) => {\n      let createPatternFrom: HTMLImageElement | HTMLCanvasElement;\n      if(IS_SAFARI) {\n        const canvas = createPatternFrom = document.createElement('canvas');\n        canvas.width = img.naturalWidth;\n        canvas.height = img.naturalHeight;\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      } else {\n        createPatternFrom = img;\n      }\n\n      const perf = performance.now();\n      this.pattern = canvas.getContext('2d').createPattern(createPatternFrom, 'repeat-x');\n      console.warn('creating pattern time:', performance.now() - perf);\n\n      return this.pattern;\n    });\n  }\n\n  public exportCanvasPatternToImage(canvas: HTMLCanvasElement) {\n    if(this.exportCanvasPatternToImagePromise) return this.exportCanvasPatternToImagePromise;\n    return this.exportCanvasPatternToImagePromise = new Promise<string>((resolve) => {\n      canvas.toBlob((blob) => {\n        const newUrl = this.objectUrl = URL.createObjectURL(blob);\n        resolve(newUrl);\n      }, 'image/png');\n    });\n  } */\n\n  public cleanup(canvas: HTMLCanvasElement) {\n    this.canvases.delete(canvas);\n\n    if(!this.canvases.size) {\n      indexOfAndSplice(ChatBackgroundPatternRenderer.INSTANCES, this);\n\n      if(this.objectUrl) {\n        URL.revokeObjectURL(this.objectUrl);\n      }\n    }\n  }\n\n  public fillCanvas(canvas: HTMLCanvasElement) {\n    const context = canvas.getContext('2d');\n    const {width, height} = canvas;\n    // const perf = performance.now();\n    // if(context.fillStyle instanceof CanvasPattern) {\n    //   context.clearRect(0, 0, width, height);\n    // }\n\n    const img = this.img;\n\n    let imageWidth = img.width, imageHeight = img.height;\n    // if(imageHeight < height) {\n    let patternHeight = 1480 * canvas.dpr;\n    // * correct\n    // if(+canvas.dataset.originalHeight !== height) hhh *= 2 / 3;\n    // * but have to make it good\n    if(+canvas.dataset.originalHeight !== height) patternHeight *= .875;\n    const ratio = patternHeight / imageHeight;\n    imageWidth *= ratio;\n    imageHeight = patternHeight;\n    // }\n\n    if(this.options.mask) {\n      context.fillStyle = '#000';\n      context.fillRect(0, 0, width, height);\n      context.globalCompositeOperation = 'destination-out';\n    } else {\n      context.globalCompositeOperation = 'source-over';\n    }\n\n    const d = (y: number) => {\n      for(let x = 0; x < width; x += imageWidth) {\n        context.drawImage(img, x, y, imageWidth, imageHeight);\n      }\n    };\n\n    const centerY = height / 2 - imageHeight / 2;\n    d(centerY);\n\n    if(centerY > 0) {\n      let topY = centerY;\n      do {\n        d(topY -= imageHeight);\n      } while(topY >= 0);\n    }\n\n    const endY = height - 1;\n    for(let bottomY = centerY + imageHeight; bottomY < endY; bottomY += imageHeight) {\n      d(bottomY);\n    }\n\n    // for(let x = 0; x < width; x += imageWidth) {\n    //   for(let y = 0; y < height; y += imageHeight) {\n    //     context.drawImage(img, x, y, imageWidth, imageHeight);\n    //   }\n    // }\n    // context.fillStyle = this.pattern;\n    // context.fillRect(0, 0, width, height);\n    // console.warn('fill canvas time', performance.now() - perf);\n  }\n\n  public setCanvasDimensions(canvas: HTMLCanvasElement) {\n    const devicePixelRatio = Math.min(2, window.devicePixelRatio);\n    const width = this.options.width * devicePixelRatio;\n    let height = this.options.height * devicePixelRatio;\n\n    canvas.dpr = devicePixelRatio;\n    canvas.dataset.originalHeight = '' + height;\n    if(mediaSizes.activeScreen === ScreenSize.large) height *= 1.5;\n    canvas.width = width;\n    canvas.height = height;\n  }\n\n  public createCanvas() {\n    const canvas = document.createElement('canvas');\n    this.canvases.add(canvas);\n    this.setCanvasDimensions(canvas);\n    return canvas;\n  }\n\n  public resize(width: number, height: number) {\n    this.init({\n      ...this.options,\n      width,\n      height\n    });\n\n    const promises: Promise<any>[] = [];\n    for(const canvas of this.canvases) {\n      this.setCanvasDimensions(canvas);\n      promises.push(this.renderToCanvas(canvas));\n    }\n\n    return Promise.all(promises);\n  }\n\n  public static resizeInstances(width: number, height: number) {\n    return Promise.all(this.INSTANCES.map((instance) => instance.resize(width, height)));\n  }\n\n  /* public setResizeMode(resizing: boolean) {\n    const canvases = Array.from(this.canvases);\n    const canvas = canvases[canvases.length - 1];\n    canvas.style.display = resizing ? 'none' : '';\n    const img = this.img;\n    img.style.display = resizing ? '' : 'none';\n\n    return {img, canvas};\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {ChatRights} from '../../lib/appManagers/appChatsManager';\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\nimport type {MessagesStorageKey} from '../../lib/appManagers/appMessagesManager';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger, LogTypes} from '../../lib/logger';\nimport rootScope from '../../lib/rootScope';\nimport appSidebarRight from '../sidebarRight';\nimport ChatBubbles from './bubbles';\nimport ChatContextMenu from './contextMenu';\nimport ChatInput from './input';\nimport ChatSelection from './selection';\nimport ChatTopbar from './topbar';\nimport {NULL_PEER_ID, REPLIES_PEER_ID} from '../../lib/mtproto/mtproto_config';\nimport SetTransition from '../singleTransition';\nimport AppPrivateSearchTab from '../sidebarRight/tabs/search';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport ChatSearch from './search';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport getAutoDownloadSettingsByPeerId, {ChatAutoDownloadSettings} from '../../helpers/autoDownload';\nimport ChatBackgroundGradientRenderer from './gradientRenderer';\nimport ChatBackgroundPatternRenderer from './patternRenderer';\nimport pause from '../../helpers/schedulers/pause';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport SlicedArray from '../../helpers/slicedArray';\nimport themeController from '../../helpers/themeController';\nimport AppSharedMediaTab from '../sidebarRight/tabs/sharedMedia';\nimport noop from '../../helpers/noop';\nimport middlewarePromise from '../../helpers/middlewarePromise';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport {Message} from '../../layer';\n\nexport type ChatType = 'chat' | 'pinned' | 'replies' | 'discussion' | 'scheduled';\n\nexport default class Chat extends EventListenerBase<{\n  setPeer: (mid: number, isTopMessage: boolean) => void\n}> {\n  public container: HTMLElement;\n  public backgroundEl: HTMLElement;\n\n  public topbar: ChatTopbar;\n  public bubbles: ChatBubbles;\n  public input: ChatInput;\n  public selection: ChatSelection;\n  public contextMenu: ChatContextMenu;\n  public search: ChatSearch;\n\n  public wasAlreadyUsed: boolean;\n  // public initPeerId = 0;\n  public peerId: PeerId;\n  public threadId: number;\n  public setPeerPromise: Promise<void>;\n  public peerChanged: boolean;\n\n  public log: ReturnType<typeof logger>;\n\n  public type: ChatType;\n  public messagesStorageKey: MessagesStorageKey;\n\n  public noForwards: boolean;\n\n  public inited: boolean;\n\n  public isRestricted: boolean;\n  public autoDownload: ChatAutoDownloadSettings;\n\n  public gradientRenderer: ChatBackgroundGradientRenderer;\n  public patternRenderer: ChatBackgroundPatternRenderer;\n  public gradientCanvas: HTMLCanvasElement;\n  public patternCanvas: HTMLCanvasElement;\n  public backgroundTempId: number;\n  public setBackgroundPromise: Promise<void>;\n  public sharedMediaTab: AppSharedMediaTab;\n  public sharedMediaTabs: AppSharedMediaTab[];\n  // public renderDarkPattern: () => Promise<void>;\n\n  public isBot: boolean;\n  public isChannel: boolean;\n  public isBroadcast: boolean;\n  public isAnyGroup: boolean;\n  public isMegagroup: boolean;\n\n  constructor(\n    public appImManager: AppImManager,\n    public managers: AppManagers\n  ) {\n    super();\n\n    this.type = 'chat';\n\n    this.container = document.createElement('div');\n    this.container.classList.add('chat', 'tabs-tab');\n\n    this.backgroundEl = document.createElement('div');\n    this.backgroundEl.classList.add('chat-background');\n\n    // * constructor end\n\n    this.log = logger('CHAT', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n    // this.log.error('Chat construction');\n\n    this.peerId = NULL_PEER_ID;\n\n    this.container.append(this.backgroundEl);\n    this.appImManager.chatsContainer.append(this.container);\n\n    this.backgroundTempId = 0;\n    this.sharedMediaTabs = [];\n  }\n\n  public setBackground(url: string, skipAnimation?: boolean): Promise<void> {\n    const theme = themeController.getTheme();\n\n    let item: HTMLElement;\n    const isColorBackground = !!theme.background.color && !theme.background.slug && !theme.background.intensity;\n    if(\n      isColorBackground &&\n      document.documentElement.style.cursor === 'grabbing' &&\n      this.gradientRenderer &&\n      !this.patternRenderer\n    ) {\n      this.gradientCanvas.dataset.colors = theme.background.color;\n      this.gradientRenderer.init(this.gradientCanvas);\n      return Promise.resolve();\n    }\n\n    const tempId = ++this.backgroundTempId;\n\n    const previousGradientRenderer = this.gradientRenderer;\n    const previousPatternRenderer = this.patternRenderer;\n    const previousGradientCanvas = this.gradientCanvas;\n    const previousPatternCanvas = this.patternCanvas;\n\n    this.gradientRenderer =\n      this.patternRenderer =\n      this.gradientCanvas =\n      this.patternCanvas =\n      // this.renderDarkPattern =\n      undefined;\n\n    const intensity = theme.background.intensity && theme.background.intensity / 100;\n    const isDarkPattern = !!intensity && intensity < 0;\n\n    let patternRenderer: ChatBackgroundPatternRenderer;\n    let patternCanvas = item?.firstElementChild as HTMLCanvasElement;\n    let gradientCanvas: HTMLCanvasElement;\n    if(!item) {\n      item = document.createElement('div');\n      item.classList.add('chat-background-item');\n\n      if(url) {\n        if(intensity) {\n          item.classList.add('is-pattern');\n\n          const rect = this.appImManager.chatsContainer.getBoundingClientRect();\n          patternRenderer = this.patternRenderer = ChatBackgroundPatternRenderer.getInstance({\n            url,\n            width: rect.width,\n            height: rect.height,\n            mask: isDarkPattern\n          });\n\n          patternCanvas = this.patternCanvas = patternRenderer.createCanvas();\n          patternCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-pattern-canvas');\n\n          if(isDarkPattern) {\n            item.classList.add('is-dark');\n          }\n\n          // if(isDarkPattern) {\n          //   this.renderDarkPattern = () => {\n          //     return patternRenderer.exportCanvasPatternToImage(patternCanvas).then((url) => {\n          //       if(this.backgroundTempId !== tempId) {\n          //         return;\n          //       }\n\n          //       gradientCanvas.style.webkitMaskImage = `url(${url})`;\n          //     });\n          //   };\n          // }\n        } else if(theme.background.slug) {\n          item.classList.add('is-image');\n        }\n      } else if(theme.background.color) {\n        item.classList.add('is-color');\n      }\n    }\n\n    let gradientRenderer: ChatBackgroundGradientRenderer;\n    const color = theme.background.color;\n    if(color) {\n      // if(color.includes(',')) {\n      const {canvas, gradientRenderer: _gradientRenderer} = ChatBackgroundGradientRenderer.create(color);\n      gradientRenderer = this.gradientRenderer = _gradientRenderer;\n      gradientCanvas = this.gradientCanvas = canvas;\n      gradientCanvas.classList.add('chat-background-item-canvas', 'chat-background-item-color-canvas');\n\n      if(rootScope.settings.animationsEnabled) {\n        gradientRenderer.scrollAnimate(true);\n      }\n      // } else {\n      //   item.style.backgroundColor = color;\n      //   item.style.backgroundImage = 'none';\n      // }\n    }\n\n    if(patternRenderer) {\n      const setOpacityTo = isDarkPattern ? gradientCanvas : patternCanvas;\n      setOpacityTo.style.setProperty('--opacity-max', '' + Math.abs(intensity));\n    }\n\n    const promise = new Promise<void>((resolve) => {\n      const cb = () => {\n        if(this.backgroundTempId !== tempId) {\n          if(patternRenderer) {\n            patternRenderer.cleanup(patternCanvas);\n          }\n\n          if(gradientRenderer) {\n            gradientRenderer.cleanup();\n          }\n\n          return;\n        }\n\n        const prev = this.backgroundEl.lastElementChild as HTMLElement;\n\n        if(prev === item) {\n          resolve();\n          return;\n        }\n\n        const append = [\n          gradientCanvas,\n          // isDarkPattern && this.renderDarkPattern ? undefined : patternCanvas\n          patternCanvas\n        ].filter(Boolean);\n        if(append.length) {\n          item.append(...append);\n        }\n\n        this.backgroundEl.append(item);\n\n        SetTransition(item, 'is-visible', true, !skipAnimation ? 200 : 0, prev ? () => {\n          if(previousPatternRenderer) {\n            previousPatternRenderer.cleanup(previousPatternCanvas);\n          }\n\n          if(previousGradientRenderer) {\n            previousGradientRenderer.cleanup();\n          }\n\n          prev.remove();\n        } : null, 2);\n\n        resolve();\n      };\n\n      if(patternRenderer) {\n        const renderPatternPromise = patternRenderer.renderToCanvas(patternCanvas);\n        renderPatternPromise.then(() => {\n          if(this.backgroundTempId !== tempId) {\n            return;\n          }\n\n          // let promise: Promise<any>;\n          // if(isDarkPattern && this.renderDarkPattern) {\n          //   promise = this.renderDarkPattern();\n          // } else {\n          // const promise = Promise.resolve();\n          // }\n\n          // promise.then(cb);\n          cb();\n        });\n      } else if(url) {\n        renderImageFromUrl(item, url, cb);\n      } else {\n        cb();\n      }\n    });\n\n    return this.setBackgroundPromise = Promise.race([\n      pause(500),\n      promise\n    ]);\n  }\n\n  public setType(type: ChatType) {\n    this.type = type;\n  }\n\n  public init(/* peerId: PeerId */) {\n    // this.initPeerId = peerId;\n\n    this.topbar = new ChatTopbar(this, appSidebarRight, this.managers);\n    this.bubbles = new ChatBubbles(this, this.managers);\n    this.input = new ChatInput(this, this.appImManager, this.managers);\n    this.contextMenu = new ChatContextMenu(this, this.managers);\n    this.selection = new ChatSelection(this, this.bubbles, this.input, this.managers);\n\n    if(this.type === 'chat') {\n      this.topbar.constructUtils();\n      this.topbar.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.topbar.constructPinnedHelpers();\n    } else if(this.type === 'discussion') {\n      this.topbar.constructUtils();\n      this.topbar.constructDiscussionHelpers();\n    }\n\n    this.topbar.construct();\n    this.input.construct();\n\n    if(this.type === 'chat') { // *   ,   -   \n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'pinned') {\n      this.bubbles.constructPinnedHelpers();\n      this.input.constructPinnedHelpers();\n    } else if(this.type === 'scheduled') {\n      this.bubbles.constructScheduledHelpers();\n      this.input.constructPeerHelpers();\n    } else if(this.type === 'discussion') {\n      this.bubbles.constructPeerHelpers();\n      this.input.constructPeerHelpers();\n    }\n\n    if(this.type !== 'scheduled' && !IS_TOUCH_SUPPORTED) {\n      this.bubbles.setReactionsHoverListeners();\n    }\n\n    this.bubbles.attachContainerListeners();\n\n    this.container.classList.add('type-' + this.type);\n    this.container.append(this.topbar.container, this.bubbles.container, this.input.chatInput);\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_migrate', ({migrateFrom, migrateTo}) => {\n      if(this.peerId === migrateFrom) {\n        this.setPeer(migrateTo);\n      }\n    });\n\n    this.bubbles.listenerSetter.add(rootScope)('dialog_drop', (e) => {\n      if(e.peerId === this.peerId) {\n        this.appImManager.setPeer();\n      }\n    });\n  }\n\n  public beforeDestroy() {\n    this.bubbles.cleanup();\n  }\n\n  private cleanupBackground() {\n    ++this.backgroundTempId;\n    if(this.patternRenderer) {\n      this.patternRenderer.cleanup(this.patternCanvas);\n      this.patternRenderer = undefined;\n    }\n\n    if(this.gradientRenderer) {\n      this.gradientRenderer.cleanup();\n      this.gradientRenderer = undefined;\n    }\n  }\n\n  public destroy() {\n    // const perf = performance.now();\n\n    this.topbar.destroy();\n    this.bubbles.destroy();\n    this.input.destroy();\n    this.contextMenu && this.contextMenu.destroy();\n    this.selection && this.selection.attachListeners(undefined, undefined);\n\n    this.cleanupBackground();\n\n    delete this.topbar;\n    delete this.bubbles;\n    delete this.input;\n    delete this.selection;\n    delete this.contextMenu;\n\n    this.container.remove();\n\n    // this.log.error('Chat destroy time:', performance.now() - perf);\n  }\n\n  public cleanup(helperToo = true) {\n    this.input.cleanup(helperToo);\n    this.topbar.cleanup();\n    this.selection.cleanup();\n  }\n\n  public async onChangePeer(m: ReturnType<typeof middlewarePromise>) {\n    const {peerId} = this;\n\n    const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n    if(searchTab) {\n      searchTab.close();\n    }\n\n    const [\n      noForwards,\n      isRestricted,\n      isAnyGroup,\n      _,\n      isMegagroup,\n      isBroadcast,\n      isChannel,\n      isBot\n    ] = await m(Promise.all([\n      this.managers.appPeersManager.noForwards(peerId),\n      this.managers.appPeersManager.isRestricted(peerId),\n      this._isAnyGroup(peerId),\n      this.setAutoDownloadMedia(),\n      this.managers.appPeersManager.isMegagroup(peerId),\n      this.managers.appPeersManager.isBroadcast(peerId),\n      this.managers.appPeersManager.isChannel(peerId),\n      this.managers.appPeersManager.isBot(peerId)\n    ]));\n\n    this.noForwards = noForwards;\n    this.isRestricted = isRestricted;\n    this.isAnyGroup = isAnyGroup;\n    this.isMegagroup = isMegagroup;\n    this.isBroadcast = isBroadcast;\n    this.isChannel = isChannel;\n    this.isBot = isBot;\n\n    this.container.classList.toggle('no-forwards', this.noForwards);\n\n    this.sharedMediaTab = appSidebarRight.createSharedMediaTab();\n    this.sharedMediaTabs.push(this.sharedMediaTab);\n\n    this.sharedMediaTab.setPeer(peerId, this.threadId);\n    this.input.clearHelper(); // \n    this.selection.cleanup(); // TODO: REFACTOR !!!!!!\n  }\n\n  public setPeer(peerId: PeerId, lastMsgId?: number, startParam?: string) {\n    if(!peerId) {\n      this.inited = undefined;\n    } else if(!this.inited) {\n      if(this.init) {\n        this.init(/* peerId */);\n        this.init = null;\n      }\n\n      this.inited = true;\n    }\n\n    // const appMediaViewer = (window as any).appMediaViewer as AppMediaViewerBase<any, any, any>;\n    // if(appMediaViewer) {\n    //   appMediaViewer.close();\n    // }\n\n    const samePeer = this.peerId === peerId;\n    if(!samePeer) {\n      this.appImManager.dispatchEvent('peer_changing', this);\n      this.peerId = peerId || NULL_PEER_ID;\n      this.messagesStorageKey = `${this.peerId}_${this.type === 'scheduled' ? 'scheduled' : 'history'}`;\n    } else if(this.setPeerPromise) {\n      return;\n    }\n\n    if(!peerId) {\n      appSidebarRight.toggleSidebar(false);\n      this.cleanup(true);\n      this.bubbles.setPeer(false, peerId);\n      this.appImManager.dispatchEvent('peer_changed', peerId);\n\n      appSidebarRight.replaceSharedMediaTab();\n      this.destroySharedMediaTab();\n      this.sharedMediaTab = undefined;\n\n      return;\n    }\n\n    this.peerChanged = samePeer;\n\n    const bubblesSetPeerPromise = this.bubbles.setPeer(samePeer, peerId, lastMsgId, startParam);\n    const setPeerPromise = this.setPeerPromise = bubblesSetPeerPromise.then((result) => {\n      return result.promise;\n    }).catch(noop).finally(() => {\n      if(this.setPeerPromise === setPeerPromise) {\n        this.setPeerPromise = null;\n      }\n    });\n\n    return bubblesSetPeerPromise;\n  }\n\n  public destroySharedMediaTab(tab = this.sharedMediaTab) {\n    indexOfAndSplice(this.sharedMediaTabs, tab);\n    tab.destroy();\n  }\n\n  public async setAutoDownloadMedia() {\n    this.autoDownload = await getAutoDownloadSettingsByPeerId(this.peerId);\n  }\n\n  public setMessageId(messageId?: number) {\n    return this.setPeer(this.peerId, messageId);\n  }\n\n  public async finishPeerChange(isTarget: boolean, isJump: boolean, lastMsgId: number, startParam?: string) {\n    if(this.peerChanged) return;\n\n    const peerId = this.peerId;\n    this.peerChanged = true;\n    this.wasAlreadyUsed = true;\n\n    const middleware = this.bubbles.getMiddleware();\n\n    this.cleanup(false);\n\n    const sharedMediaTab = this.sharedMediaTab;\n    sharedMediaTab.loadSidebarMedia(true);\n\n    const callbacksPromise = Promise.all([\n      this.topbar.finishPeerChange(isTarget),\n      this.bubbles.finishPeerChange(),\n      this.input.finishPeerChange(startParam)\n    ]);\n\n    const [callbacks] = await Promise.all([\n      callbacksPromise,\n      sharedMediaTab.fillProfileElements()\n    ]);\n\n    if(!middleware()) {\n      return;\n    }\n\n    callbacks.forEach((callback) => {\n      callback();\n    });\n\n    appSidebarRight.replaceSharedMediaTab(sharedMediaTab);\n\n    this.sharedMediaTabs.filter((tab) => tab !== sharedMediaTab).forEach((tab) => this.destroySharedMediaTab(tab));\n\n    this.log.setPrefix('CHAT-' + peerId + '-' + this.type);\n\n    this.appImManager.dispatchEvent('peer_changed', peerId);\n  }\n\n  public getMessage(mid: number) {\n    return this.managers.appMessagesManager.getMessageFromStorage(this.messagesStorageKey, mid);\n  }\n\n  public async getMidsByMid(mid: number) {\n    return this.managers.appMessagesManager.getMidsByMessage(await this.getMessage(mid));\n  }\n\n  public getHistoryStorage(ignoreThreadId?: boolean) {\n    return this.managers.appMessagesManager.getHistoryStorageTransferable(this.peerId, ignoreThreadId ? undefined : this.threadId)\n    .then((historyStorageTransferable) => {\n      return {\n        ...historyStorageTransferable,\n        history: SlicedArray.fromJSON<number>(historyStorageTransferable.historySerialized)\n      }\n    });\n  }\n\n  public getHistoryMaxId() {\n    return this.getHistoryStorage().then((historyStorage) => historyStorage.maxId);\n  }\n\n  public async _isAnyGroup(peerId: PeerId) {\n    return peerId === rootScope.myId || peerId === REPLIES_PEER_ID || (await this.managers.appPeersManager.isAnyGroup(peerId));\n  }\n\n  public initSearch(query?: string) {\n    if(!this.peerId) return;\n\n    if(mediaSizes.isMobile) {\n      if(!this.search) {\n        this.search = new ChatSearch(this.topbar, this, query);\n      } else {\n        this.search.setQuery(query);\n      }\n    } else {\n      let tab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(!tab) {\n        tab = appSidebarRight.createTab(AppPrivateSearchTab);\n      }\n\n      tab.open(this.peerId, this.threadId, this.bubbles.onDatePick, query);\n    }\n  }\n\n  public canSend(action?: ChatRights) {\n    return this.managers.appMessagesManager.canSendToPeer(this.peerId, this.threadId, action);\n  }\n\n  public isStartButtonNeeded() {\n    return Promise.all([\n      this.managers.appPeersManager.isBot(this.peerId),\n      this.managers.appMessagesManager.getDialogOnly(this.peerId),\n      this.getHistoryStorage(true)\n    ]).then(([isBot, dialog, historyStorage]) => {\n      return isBot && !dialog && !historyStorage.history.length;\n    });\n  }\n\n  public getMessageSendingParams() {\n    return {\n      threadId: this.threadId,\n      replyToMsgId: this.input.replyToMsgId,\n      scheduleDate: this.input.scheduleDate,\n      sendSilent: this.input.sendSilent,\n      sendAsPeerId: this.input.sendAsPeerId\n    };\n  }\n\n  public isOurMessage(message: Message.message | Message.messageService) {\n    return message.fromId === rootScope.myId || (!!message.pFlags.out && this.isMegagroup);\n  }\n\n  public isOutMessage(message: Message.message | Message.messageService) {\n    const fwdFrom = (message as Message.message).fwd_from;\n    const isOut = this.isOurMessage(message) && (!fwdFrom || this.peerId !== rootScope.myId);\n    return !!isOut;\n  }\n\n  public isAvatarNeeded(message: Message.message | Message.messageService) {\n    return this.isAnyGroup && !this.isOutMessage(message);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {State} from '../config/state';\nimport rootScope from '../lib/rootScope';\n\nexport type ChatAutoDownloadSettings = {\n  photo: number,\n  video: number,\n  file: number\n};\n\nexport default async function getAutoDownloadSettingsByPeerId(peerId: PeerId): Promise<ChatAutoDownloadSettings> {\n  let type: keyof State['settings']['autoDownload'];\n\n  let photoSizeMax = 0, videoSizeMax = 0, fileSizeMax = 0;\n  const settings = rootScope.settings;\n  const appPeersManager = rootScope.managers.appPeersManager;\n  if(!settings.autoDownloadNew.pFlags.disabled && peerId) {\n    if(peerId.isUser()) {\n      if(await appPeersManager.isContact(peerId)) {\n        type = 'contacts';\n      } else {\n        type = 'private';\n      }\n    } else if(await appPeersManager.isBroadcast(peerId)) {\n      type = 'channels';\n    } else {\n      type = 'groups';\n    }\n\n    if(settings.autoDownload.photo[type]) photoSizeMax = settings.autoDownloadNew.photo_size_max;\n    if(settings.autoDownload.video[type]) videoSizeMax = settings.autoDownloadNew.video_size_max;\n    if(settings.autoDownload.file[type]) fileSizeMax = settings.autoDownloadNew.file_size_max;\n  }\n\n  return {\n    photo: photoSizeMax,\n    video: videoSizeMax,\n    file: fileSizeMax\n  };\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport type {AppImManager} from '../../lib/appManagers/appImManager';\r\nimport ButtonIcon from '../buttonIcon';\r\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\r\nimport {IS_APPLE, IS_MOBILE} from '../../environment/userAgent';\r\nimport appNavigationController from '../appNavigationController';\r\nimport {_i18n} from '../../lib/langPack';\r\nimport cancelEvent from '../../helpers/dom/cancelEvent';\r\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\r\nimport getSelectedNodes from '../../helpers/dom/getSelectedNodes';\r\nimport isSelectionEmpty from '../../helpers/dom/isSelectionEmpty';\r\nimport {MarkdownType, markdownTags} from '../../helpers/dom/getRichElementValue';\r\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\r\nimport clamp from '../../helpers/number/clamp';\r\nimport matchUrl from '../../lib/richTextProcessor/matchUrl';\r\nimport matchUrlProtocol from '../../lib/richTextProcessor/matchUrlProtocol';\r\n// import { logger } from \"../../lib/logger\";\r\n\r\nexport default class MarkupTooltip {\r\n  public container: HTMLElement;\r\n  private wrapper: HTMLElement;\r\n  private buttons: {[type in MarkdownType]: HTMLElement} = {} as any;\r\n  private linkBackButton: HTMLElement;\r\n  private linkApplyButton: HTMLButtonElement;\r\n  private hideTimeout: number;\r\n  private addedListener = false;\r\n  private waitingForMouseUp = false;\r\n  private linkInput: HTMLInputElement;\r\n  private savedRange: Range;\r\n  private mouseUpCounter: number = 0;\r\n  // private log: ReturnType<typeof logger>;\r\n\r\n  constructor(private appImManager: AppImManager) {\r\n    // this.log = logger('MARKUP');\r\n  }\r\n\r\n  private init() {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('markup-tooltip', 'z-depth-1', 'hide');\r\n\r\n    this.wrapper = document.createElement('div');\r\n    this.wrapper.classList.add('markup-tooltip-wrapper');\r\n\r\n    const tools1 = document.createElement('div');\r\n    const tools2 = document.createElement('div');\r\n    tools1.classList.add('markup-tooltip-tools');\r\n    tools2.classList.add('markup-tooltip-tools');\r\n\r\n    const arr = ['bold', 'italic', 'underline', 'strikethrough', 'monospace', 'spoiler', 'link'] as (keyof MarkupTooltip['buttons'])[];\r\n    arr.forEach((c) => {\r\n      const button = ButtonIcon(c, {noRipple: true});\r\n      tools1.append(this.buttons[c] = button);\r\n\r\n      if(c !== 'link') {\r\n        button.addEventListener('mousedown', (e) => {\r\n          cancelEvent(e);\r\n          this.appImManager.chat.input.applyMarkdown(c);\r\n          this.cancelClosening();\r\n\r\n          /* this.mouseUpCounter = 0;\r\n          this.setMouseUpEvent(); */\r\n          // this.hide();\r\n        });\r\n      } else {\r\n        attachClickEvent(button, (e) => {\r\n          cancelEvent(e);\r\n          this.showLinkEditor();\r\n          this.cancelClosening();\r\n        });\r\n      }\r\n    });\r\n\r\n    this.linkBackButton = ButtonIcon('left', {noRipple: true});\r\n    this.linkInput = document.createElement('input');\r\n    _i18n(this.linkInput, 'MarkupTooltip.LinkPlaceholder', undefined, 'placeholder');\r\n    this.linkInput.classList.add('input-clear');\r\n    this.linkInput.addEventListener('keydown', (e) => {\r\n      const valid = !this.linkInput.value.length || !!matchUrl(this.linkInput.value);// /^(http)|(https):\\/\\//i.test(this.linkInput.value);\r\n\r\n      if(e.key === 'Enter') {\r\n        if(!valid) {\r\n          if(this.linkInput.classList.contains('error')) {\r\n            this.linkInput.classList.remove('error');\r\n            void this.linkInput.offsetLeft; // reflow\r\n          }\r\n\r\n          this.linkInput.classList.add('error');\r\n        } else {\r\n          this.applyLink(e);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.linkInput.addEventListener('input', (e) => {\r\n      const valid = this.isLinkValid();\r\n\r\n      this.linkInput.classList.toggle('is-valid', valid);\r\n      this.linkInput.classList.remove('error');\r\n    });\r\n\r\n    this.linkBackButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkBackButton click');\r\n      cancelEvent(e);\r\n      this.container.classList.remove('is-link');\r\n      // input.value = '';\r\n      this.resetSelection();\r\n      this.setTooltipPosition();\r\n      this.cancelClosening();\r\n    });\r\n\r\n    this.linkApplyButton = ButtonIcon('check markup-tooltip-link-apply', {noRipple: true});\r\n    this.linkApplyButton.addEventListener('mousedown', (e) => {\r\n      // this.log('linkApplyButton click');\r\n      this.applyLink(e);\r\n    });\r\n\r\n    const applyDiv = document.createElement('div');\r\n    applyDiv.classList.add('markup-tooltip-link-apply-container');\r\n\r\n    const delimiter1 = document.createElement('span');\r\n    const delimiter2 = document.createElement('span');\r\n    const delimiter3 = document.createElement('span');\r\n    delimiter1.classList.add('markup-tooltip-delimiter');\r\n    delimiter2.classList.add('markup-tooltip-delimiter');\r\n    delimiter3.classList.add('markup-tooltip-delimiter');\r\n    tools1.insertBefore(delimiter1, this.buttons.link);\r\n    applyDiv.append(delimiter3, this.linkApplyButton);\r\n    tools2.append(this.linkBackButton, delimiter2, this.linkInput, applyDiv);\r\n    // tools1.insertBefore(delimiter2, this.buttons.link.nextSibling);\r\n\r\n    this.wrapper.append(tools1, tools2);\r\n    this.container.append(this.wrapper);\r\n    document.body.append(this.container);\r\n\r\n    window.addEventListener('resize', () => {\r\n      this.hide();\r\n    });\r\n  }\r\n\r\n  public showLinkEditor() {\r\n    if(!this.container || !this.container.classList.contains('is-visible')) { // * if not inited yet (Ctrl+A + Ctrl+K)\r\n      this.show();\r\n    }\r\n\r\n    const button = this.buttons.link;\r\n    this.container.classList.add('is-link');\r\n\r\n    const selection = document.getSelection();\r\n    this.savedRange = selection.getRangeAt(0);\r\n\r\n    if(button.classList.contains('active')) {\r\n      const startContainer = this.savedRange.startContainer;\r\n      const anchor = startContainer.parentElement as HTMLAnchorElement;\r\n      this.linkInput.value = anchor.href;\r\n    } else {\r\n      this.linkInput.value = '';\r\n    }\r\n\r\n    this.setTooltipPosition(true);\r\n\r\n    setTimeout(() => {\r\n      this.linkInput.focus(); // !!! instant focus will break animation\r\n    }, 200);\r\n    this.linkInput.classList.toggle('is-valid', this.isLinkValid());\r\n  }\r\n\r\n  private applyLink(e: Event) {\r\n    cancelEvent(e);\r\n    this.resetSelection();\r\n    let url = this.linkInput.value;\r\n    if(url && !matchUrlProtocol(url)) {\r\n      url = 'https://' + url;\r\n    }\r\n    this.appImManager.chat.input.applyMarkdown('link', url);\r\n    setTimeout(() => {\r\n      this.hide();\r\n    }, 0);\r\n  }\r\n\r\n  private isLinkValid() {\r\n    return !this.linkInput.value.length || !!matchUrl(this.linkInput.value);\r\n  }\r\n\r\n  private resetSelection(range: Range = this.savedRange) {\r\n    const selection = window.getSelection();\r\n    selection.removeAllRanges();\r\n    selection.addRange(range);\r\n    this.appImManager.chat.input.messageInput.focus();\r\n  }\r\n\r\n  public hide() {\r\n    // return;\r\n\r\n    if(this.init) return;\r\n\r\n    this.container.classList.remove('is-visible');\r\n    // document.removeEventListener('mouseup', this.onMouseUp);\r\n    document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n    this.waitingForMouseUp = false;\r\n\r\n    appNavigationController.removeByType('markup');\r\n\r\n    if(this.hideTimeout) clearTimeout(this.hideTimeout);\r\n    this.hideTimeout = window.setTimeout(() => {\r\n      this.hideTimeout = undefined;\r\n      this.container.classList.add('hide');\r\n      this.container.classList.remove('is-link');\r\n    }, 200);\r\n  }\r\n\r\n  public getActiveMarkupButton() {\r\n    const nodes = getSelectedNodes();\r\n    const parents = [...new Set(nodes.map((node) => node.parentNode))];\r\n    // if(parents.length > 1 && parents) return [];\r\n\r\n    const currentMarkups: Set<HTMLElement> = new Set();\r\n    (parents as HTMLElement[]).forEach((node) => {\r\n      for(const type in markdownTags) {\r\n        const tag = markdownTags[type as MarkdownType];\r\n        const closest = node.closest(tag.match + ', [contenteditable]');\r\n        if(closest !== this.appImManager.chat.input.messageInput) {\r\n          currentMarkups.add(this.buttons[type as MarkdownType]);\r\n        }\r\n      }\r\n    });\r\n\r\n\r\n    return [...currentMarkups];\r\n  }\r\n\r\n  public setActiveMarkupButton() {\r\n    const activeButtons = this.getActiveMarkupButton();\r\n\r\n    for(const i in this.buttons) {\r\n      // @ts-ignore\r\n      const button = this.buttons[i];\r\n      button.classList.toggle('active', activeButtons.includes(button));\r\n    }\r\n  }\r\n\r\n  private setTooltipPosition(isLinkToggle = false) {\r\n    const selection = document.getSelection();\r\n    const range = selection.getRangeAt(0);\r\n\r\n    const bodyRect = document.body.getBoundingClientRect();\r\n    const selectionRect = range.getBoundingClientRect();\r\n    const inputRect = this.appImManager.chat.input.rowsWrapper.getBoundingClientRect();\r\n\r\n    this.container.style.maxWidth = inputRect.width + 'px';\r\n\r\n    const visibleRect = getVisibleRect(undefined, this.appImManager.chat.input.messageInput, false, selectionRect);\r\n\r\n    const selectionTop = visibleRect.rect.top/* selectionRect.top */ + (bodyRect.top * -1);\r\n\r\n    const currentTools = this.container.classList.contains('is-link') ? this.wrapper.lastElementChild : this.wrapper.firstElementChild;\r\n\r\n    const sizesRect = currentTools.getBoundingClientRect();\r\n    const top = selectionTop - sizesRect.height - 8;\r\n\r\n    const minX = inputRect.left;\r\n    const maxX = (inputRect.left + inputRect.width) - Math.min(inputRect.width, sizesRect.width);\r\n    let left: number;\r\n    if(isLinkToggle) {\r\n      const containerRect = this.container.getBoundingClientRect();\r\n      left = clamp(containerRect.left, minX, maxX);\r\n    } else {\r\n      const x = selectionRect.left + (selectionRect.width - sizesRect.width) / 2;\r\n      left = clamp(x, minX, maxX);\r\n    }\r\n\r\n    /* const isClamped = x !== minX && x !== maxX && (left === minX || left === maxX || this.container.getBoundingClientRect().left >= maxX);\r\n\r\n    if(isLinkToggle && this.container.classList.contains('is-link') && !isClamped) return; */\r\n\r\n    this.container.style.transform = `translate3d(${left}px, ${top}px, 0)`;\r\n  }\r\n\r\n  public show() {\r\n    if(this.init) {\r\n      this.init();\r\n      this.init = null;\r\n    }\r\n\r\n    if(isSelectionEmpty()) {\r\n      this.hide();\r\n      return;\r\n    }\r\n\r\n    if(this.hideTimeout !== undefined) {\r\n      clearTimeout(this.hideTimeout);\r\n    }\r\n\r\n    if(this.container.classList.contains('is-visible')) {\r\n      return;\r\n    }\r\n\r\n    this.setActiveMarkupButton();\r\n\r\n    this.container.classList.remove('is-link');\r\n    const isFirstShow = this.container.classList.contains('hide');\r\n    if(isFirstShow) {\r\n      this.container.classList.remove('hide');\r\n      this.container.classList.add('no-transition');\r\n    }\r\n\r\n    this.setTooltipPosition();\r\n\r\n    if(isFirstShow) {\r\n      void this.container.offsetLeft; // reflow\r\n      this.container.classList.remove('no-transition');\r\n    }\r\n\r\n    this.container.classList.add('is-visible');\r\n\r\n    if(!IS_MOBILE) {\r\n      appNavigationController.pushItem({\r\n        type: 'markup',\r\n        onPop: () => {\r\n          this.hide();\r\n        }\r\n      });\r\n    }\r\n\r\n    // this.log('selection', selectionRect, activeButton);\r\n  }\r\n\r\n  /* private onMouseUp = (e: Event) => {\r\n    this.log('onMouseUp');\r\n    if(findUpClassName(e.target, 'markup-tooltip')) return;\r\n\r\n    this.hide();\r\n    //document.removeEventListener('mouseup', this.onMouseUp);\r\n  }; */\r\n\r\n  private onMouseUpSingle = (e?: Event) => {\r\n    // this.log('onMouseUpSingle');\r\n    this.waitingForMouseUp = false;\r\n\r\n    if(IS_TOUCH_SUPPORTED) {\r\n      e && cancelEvent(e);\r\n      if(this.mouseUpCounter++ === 0) {\r\n        this.resetSelection(this.savedRange);\r\n      } else {\r\n        this.hide();\r\n        return;\r\n      }\r\n    }\r\n\r\n    this.show();\r\n\r\n    /* !isTouchSupported && document.addEventListener('mouseup', this.onMouseUp); */\r\n  };\r\n\r\n  public setMouseUpEvent() {\r\n    if(this.waitingForMouseUp) return;\r\n    this.waitingForMouseUp = true;\r\n\r\n    // this.log('setMouseUpEvent');\r\n\r\n    document.addEventListener('mouseup', this.onMouseUpSingle, {once: true});\r\n  }\r\n\r\n  public cancelClosening() {\r\n    if(IS_TOUCH_SUPPORTED && !IS_APPLE) {\r\n      document.removeEventListener('mouseup', this.onMouseUpSingle);\r\n      document.addEventListener('mouseup', (e) => {\r\n        cancelEvent(e);\r\n        this.mouseUpCounter = 1;\r\n        this.waitingForMouseUp = false;\r\n        this.setMouseUpEvent();\r\n      }, {once: true});\r\n    }\r\n  }\r\n\r\n  public handleSelection() {\r\n    if(this.addedListener) return;\r\n    this.addedListener = true;\r\n    document.addEventListener('selectionchange', (e) => {\r\n      // this.log('selectionchange');\r\n\r\n      if(document.activeElement === this.linkInput) {\r\n        return;\r\n      }\r\n\r\n      const messageInput = this.appImManager.chat.input.messageInput;\r\n      if(document.activeElement !== messageInput) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      const selection = document.getSelection();\r\n      if(isSelectionEmpty(selection)) {\r\n        this.hide();\r\n        return;\r\n      }\r\n\r\n      if(IS_TOUCH_SUPPORTED) {\r\n        if(IS_APPLE) {\r\n          this.show();\r\n          this.setTooltipPosition(); // * because can skip this in .show();\r\n        } else {\r\n          if(this.mouseUpCounter === 2) {\r\n            this.mouseUpCounter = 0;\r\n            return;\r\n          }\r\n\r\n          this.savedRange = selection.getRangeAt(0);\r\n          this.setMouseUpEvent();\r\n          /* document.addEventListener('touchend', (e) => {\r\n            cancelEvent(e);\r\n            this.resetSelection(range);\r\n            this.show();\r\n          }, {once: true, passive: false}); */\r\n        }\r\n      } else if(this.container && this.container.classList.contains('is-visible')) {\r\n        this.setTooltipPosition();\r\n      } else if(messageInput.matches(':active')) {\r\n        this.setMouseUpEvent();\r\n      } else {\r\n        this.show();\r\n      }\r\n    });\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nexport default function getSelectedNodes() {\r\n  const nodes: Node[] = [];\r\n  const selection = window.getSelection();\r\n  for(let i = 0; i < selection.rangeCount; ++i) {\r\n    const range = selection.getRangeAt(i);\r\n    let {startContainer, endContainer} = range;\r\n    if(endContainer.nodeType !== 3) endContainer = endContainer.firstChild;\r\n\r\n    while(startContainer && startContainer !== endContainer) {\r\n      nodes.push(startContainer.nodeType === 3 ? startContainer : startContainer.firstChild);\r\n      startContainer = startContainer.nextSibling;\r\n    }\r\n\r\n    if(nodes[nodes.length - 1] !== endContainer) {\r\n      nodes.push(endContainer);\r\n    }\r\n  }\r\n\r\n  // * filter null's due to <br>\r\n  return nodes.filter((node) => !!node);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport generatePathData from '../../helpers/generatePathData';\r\nimport {FormatterArguments, i18n, LangPackKey} from '../../lib/langPack';\r\n\r\nexport default class ChatDragAndDrop {\r\n  container: HTMLDivElement;\r\n  svg: SVGSVGElement;\r\n  outlineWrapper: HTMLDivElement;\r\n  path: SVGPathElement;\r\n\r\n  constructor(appendTo: HTMLElement, private options: {\r\n    icon?: string,\r\n    header: LangPackKey,\r\n    headerArgs?: FormatterArguments,\r\n    subtitle?: LangPackKey,\r\n    onDrop: (e: DragEvent) => void\r\n  }) {\r\n    this.container = document.createElement('div');\r\n    this.container.classList.add('drop', 'z-depth-1');\r\n\r\n    this.outlineWrapper = document.createElement('div');\r\n    this.outlineWrapper.classList.add('drop-outline-wrapper');\r\n\r\n    this.svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\r\n    this.svg.classList.add('drop-outline');\r\n\r\n    this.path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\r\n    this.path.classList.add('drop-outline-path');\r\n\r\n    let dropIcon: HTMLElement;\r\n    if(options.icon) {\r\n      dropIcon = document.createElement('div');\r\n      dropIcon.classList.add('drop-icon', 'tgico-' + options.icon);\r\n    }\r\n\r\n    const dropHeader = document.createElement('div');\r\n    dropHeader.classList.add('drop-header');\r\n    dropHeader.append(i18n(options.header, options.headerArgs));\r\n\r\n    let dropSubtitle: HTMLElement;\r\n    if(options.subtitle) {\r\n      dropSubtitle = document.createElement('div');\r\n      dropSubtitle.classList.add('drop-subtitle');\r\n      dropSubtitle.append(i18n(options.subtitle));\r\n    }\r\n\r\n    this.svg.append(this.path);\r\n    this.outlineWrapper.append(this.svg);\r\n\r\n    this.container.append(...[this.outlineWrapper, dropIcon, dropHeader, dropSubtitle].filter(Boolean));\r\n    appendTo.append(this.container);\r\n\r\n    this.container.addEventListener('dragover', this.onDragOver);\r\n    this.container.addEventListener('dragleave', this.onDragLeave);\r\n    this.container.addEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  onDragOver = (e: DragEvent) => {\r\n    this.container.classList.add('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', true, 500);\r\n  };\r\n\r\n  onDragLeave = (e: DragEvent) => {\r\n    this.container.classList.remove('is-dragover');\r\n    // SetTransition(this.container, 'is-dragover', false, 500);\r\n  };\r\n\r\n  onDrop = (e: DragEvent) => {\r\n    this.options.onDrop(e);\r\n  };\r\n\r\n  destroy() {\r\n    delete this.options;\r\n    this.container.remove();\r\n    this.container.removeEventListener('dragover', this.onDragOver);\r\n    this.container.removeEventListener('dragleave', this.onDragLeave);\r\n    this.container.removeEventListener('drop', this.onDrop);\r\n  }\r\n\r\n  setPath() {\r\n    const rect = this.outlineWrapper.getBoundingClientRect();\r\n    this.svg.setAttributeNS(null, 'preserveAspectRatio', 'none');\r\n    this.svg.setAttributeNS(null, 'viewBox', `0 0 ${rect.width} ${rect.height}`);\r\n    this.svg.setAttributeNS(null, 'width', `${rect.width}`);\r\n    this.svg.setAttributeNS(null, 'height', `${rect.height}`);\r\n\r\n    const radius = 10;\r\n    // const strokeWidth = 2;\r\n    const sizeX = rect.width - radius;\r\n    const sizeY = rect.height - radius;\r\n    const pos = radius / 2;\r\n    const d = generatePathData(pos, pos, sizeX, sizeY, radius, radius, radius, radius);\r\n    this.path.setAttributeNS(null, 'd', d);\r\n  }\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport {doubleRaf} from '../schedulers';\r\n\r\nexport default function disableTransition(elements: HTMLElement[]) {\r\n  elements.forEach((el) => el.classList.add('no-transition'));\r\n\r\n  doubleRaf().then(() => {\r\n    elements.forEach((el) => el.classList.remove('no-transition'));\r\n  });\r\n}\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport const MAX_SPEED = 8.2;\nexport const MIN_SPEED = 0.8;\n\n// import { MIN_SPEED, MAX_SPEED } from './BlobDrawable';\n\ntype Radius = number[];\n\nexport default class LineBlobDrawable {\n  public maxRadius: number;\n  public minRadius: number;\n  private N: number;\n  private radius: Radius;\n  private radiusNext: Radius;\n  private progress: number[];\n  private speed: number[];\n\n  constructor(n: number) {\n    this.maxRadius = 10;\n    this.minRadius = 0;\n\n    this.N = n;\n    this.radius = new Array(n + 1);\n\n    this.radiusNext = new Array(n + 1);\n    this.progress = new Array(n + 1);\n    this.speed = new Array(n + 1);\n\n    for(let i = 0; i <= n; i++) {\n      this.generateBlob(this.radius, i);\n      this.generateBlob(this.radiusNext, i);\n      this.progress[i] = 0;\n    }\n  }\n\n  private generateBlob(radius: Radius, i: number) {\n    const {maxRadius, minRadius, speed} = this;\n\n    const radDif = maxRadius - minRadius;\n    radius[i] = minRadius + Math.random() * radDif;\n    speed[i] = 0.017 + 0.003 * Math.random();\n  }\n\n  private generateNextBlob() {\n    const {radius, radiusNext, progress, N} = this;\n    for(let i = 0; i < N; i++) {\n      this.generateBlob(radius, i);\n      this.generateBlob(radiusNext, i);\n      progress[i] = 0.0;\n    }\n  }\n\n  public update(amplitude: number, speedScale: number) {\n    const {N, progress, speed, radius, radiusNext} = this;\n    for(let i = 0; i <= N; i++) {\n      progress[i] += (speed[i] * MIN_SPEED) + amplitude * speed[i] * MAX_SPEED * speedScale;\n      if(progress[i] >= 1.0) {\n        progress[i] = 0.0;\n        radius[i] = radiusNext[i];\n        this.generateBlob(radiusNext, i);\n      }\n    }\n  }\n\n  public draw(left: number, top: number, right: number, bottom: number, canvas: HTMLCanvasElement, paint: (ctx: CanvasRenderingContext2D) => void, pinnedTop: number, progressToPinned: number) {\n    if(canvas.getContext) {\n      const ctx = canvas.getContext('2d');\n      // ctx.globalAlpha = 0.5;\n      // ctx.lineWidth = 1;\n\n      ctx.beginPath();\n      ctx.moveTo(right, bottom);\n      ctx.lineTo(left, bottom);\n\n      const {radius, radiusNext, N} = this;\n      for(let i = 0; i <= N; i++) {\n        if(i === 0) {\n          const progress = this.progress[i];\n          const r1 = radius[i] * (1.0 - progress) + radiusNext[i] * progress;\n          const y = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.lineTo(left, y);\n        } else {\n          const progress = this.progress[i - 1];\n          const r1 = radius[i - 1] * (1.0 - progress) + radiusNext[i - 1] * progress;\n          const progressNext = this.progress[i];\n          const r2 = radius[i] * (1.0 - progressNext) + radiusNext[i] * progressNext;\n          const x1 = (right - left) / N * (i - 1);\n          const x2 = (right - left) / N * i;\n          const cx = x1 + (x2 - x1) / 2;\n\n          const y1 = (top - r1) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          const y2 = (top - r2) * progressToPinned + pinnedTop * (1.0 - progressToPinned);\n          ctx.bezierCurveTo(cx, y1, cx, y2, x2, y2);\n          if(i === N) {\n            ctx.lineTo(right, bottom);\n          }\n        }\n      }\n\n      // ctx.scale(1.0, 1.0);\n      paint(ctx);\n      ctx.fill();\n      ctx.closePath();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport LineBlobDrawable from './lineBlobDrawable';\n\nexport class WeavingState {\n  public shader: (ctx: CanvasRenderingContext2D, left: number, top: number, right: number, bottom: number) => void;\n\n  constructor(public stateId: GROUP_CALL_STATE) {\n    this.createGradient(stateId);\n  }\n\n  public createGradient(stateId: GROUP_CALL_STATE) {\n    this.shader = (ctx, left, top, right, bottom) => {\n      ctx.fillStyle = WeavingState.getGradientFromType(ctx, stateId, left, top, right, bottom);\n    };\n  }\n\n  // Android colors\n  static getGradientFromType(ctx: CanvasRenderingContext2D, type: GROUP_CALL_STATE, x0: number, y0: number, x1: number, y1: number) {\n    const gradient = ctx.createLinearGradient(x0, y0, x1, y1);\n    if(type === GROUP_CALL_STATE.MUTED_BY_ADMIN) {\n      gradient.addColorStop(0, '#F05459');\n      gradient.addColorStop(.4, '#766EE9');\n      gradient.addColorStop(1, '#57A4FE');\n    } else if(type === GROUP_CALL_STATE.UNMUTED) {\n      gradient.addColorStop(0, '#52CE5D');\n      gradient.addColorStop(1, '#00B1C0');\n    } else if(type === GROUP_CALL_STATE.MUTED) {\n      gradient.addColorStop(0, '#0976E3');\n      gradient.addColorStop(1, '#2BCEFF');\n    } else if(type === GROUP_CALL_STATE.CONNECTING) {\n      gradient.addColorStop(0, '#8599aa');\n      gradient.addColorStop(1, '#8599aa');\n    }\n\n    return gradient;\n  }\n\n  update(height: number, width: number, dt: number, amplitude: number) {\n    // TODO: move gradient here\n  }\n}\n\nexport default class TopbarWeave {\n  private focused: boolean;\n  private resizing: boolean;\n  private lastUpdateTime: number;\n  private amplitude: number;\n  private amplitude2: number;\n\n  private states: Map<GROUP_CALL_STATE, WeavingState>;\n  private previousState: WeavingState;\n  private currentState: WeavingState;\n  private progressToState: number;\n\n  private scale: number;\n  private left: number;\n  private top: number;\n  private right: number;\n  private bottom: number;\n\n  private mounted: boolean;\n  private media: MediaQueryList;\n\n  private container: HTMLDivElement;\n  private canvas: HTMLCanvasElement;\n\n  private resizeHandler: number;\n  private raf: number;\n\n  private lbd: LineBlobDrawable;\n  private lbd1: LineBlobDrawable;\n  private lbd2: LineBlobDrawable;\n\n  private animateToAmplitude: number;\n  private animateAmplitudeDiff: number;\n  private animateAmplitudeDiff2: number;\n\n  constructor() {\n    this.focused = true;\n    this.resizing = false;\n    this.lastUpdateTime = Date.now();\n    this.amplitude = 0.0;\n    this.amplitude2 = 0.0;\n\n    this.states = new Map([\n      [GROUP_CALL_STATE.UNMUTED, new WeavingState(GROUP_CALL_STATE.UNMUTED)],\n      [GROUP_CALL_STATE.MUTED, new WeavingState(GROUP_CALL_STATE.MUTED)],\n      [GROUP_CALL_STATE.MUTED_BY_ADMIN, new WeavingState(GROUP_CALL_STATE.MUTED_BY_ADMIN)],\n      [GROUP_CALL_STATE.CONNECTING, new WeavingState(GROUP_CALL_STATE.CONNECTING)]\n    ]);\n    this.previousState = null;\n    this.currentState = this.states.get(GROUP_CALL_STATE.CONNECTING);\n    this.progressToState = 1.0;\n  }\n\n  public componentDidMount() {\n    if(this.mounted) {\n      return;\n    }\n\n    this.mounted = true;\n    // window.addEventListener('blur', this.handleBlur);\n    // window.addEventListener('focus', this.handleFocus);\n    window.addEventListener('resize', this.handleResize);\n    this.media = window.matchMedia('screen and (min-resolution: 2dppx)');\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    this.setSize();\n    this.forceUpdate();\n\n    this.lbd = new LineBlobDrawable(3);\n    this.lbd1 = new LineBlobDrawable(7);\n    this.lbd2 = new LineBlobDrawable(8);\n    this.setAmplitude(this.amplitude);\n\n    this.draw();\n  }\n\n  public componentWillUnmount() {\n    this.mounted = false;\n    // window.removeEventListener('blur', this.handleBlur);\n    // window.removeEventListener('focus', this.handleFocus);\n    window.removeEventListener('resize', this.handleResize);\n    this.media.addEventListener('change', this.handleDevicePixelRatioChanged);\n\n    const {canvas} = this;\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  private setSize() {\n    this.scale = window.devicePixelRatio;\n    this.top = 20 * this.scale;\n    this.right = (this.mounted ? this.container.offsetWidth : 1261) * this.scale;\n    this.bottom = (this.mounted ? this.container.offsetHeight : 68) * this.scale;\n    this.left = 0 * this.scale;\n    this.setCanvasSize();\n  }\n\n  private setCanvasSize() {\n    this.canvas.width = this.right;\n    this.canvas.height = this.bottom;\n  }\n\n  private handleDevicePixelRatioChanged = (e: Event) => {\n    this.setSize();\n    this.forceUpdate();\n  }\n\n  private handleResize = () => {\n    if(this.resizeHandler) {\n      clearTimeout(this.resizeHandler);\n      this.resizeHandler = null;\n    }\n\n    this.resizing = true;\n    this.resizeCanvas();\n    this.resizeHandler = window.setTimeout(() => {\n      this.resizing = false;\n      this.invokeDraw();\n    }, 250);\n  }\n\n  private resizeCanvas() {\n    this.scale = window.devicePixelRatio;\n    this.right = this.container.offsetWidth * this.scale;\n\n    this.forceUpdate();\n    this.invokeDraw();\n  }\n\n  public handleFocus = () => {\n    this.focused = true;\n    this.invokeDraw();\n  }\n\n  public handleBlur = () => {\n    this.focused = false;\n  }\n\n  private invokeDraw = () => {\n    if(this.raf) return;\n\n    this.draw();\n  }\n\n  private draw = (force = false) => {\n    this.raf = null;\n    if(!this.mounted) {\n      return;\n    }\n    const {lbd, lbd1, lbd2, scale, left, top, right, bottom, currentState, previousState, focused, resizing, canvas} = this;\n    if(!focused && !resizing && this.progressToState >= 1.0) {\n      return;\n    }\n\n    // console.log('[top] draw', [focused, resizing, this.mounted]);\n\n    const newTime = Date.now();\n    let dt = (newTime - this.lastUpdateTime);\n    if(dt > 20) {\n      dt = 17;\n    }\n\n    // console.log('draw start', this.amplitude, this.animateToAmplitude);\n    if(this.animateToAmplitude !== this.amplitude) {\n      this.amplitude += this.animateAmplitudeDiff * dt;\n      if(this.animateAmplitudeDiff > 0) {\n        if(this.amplitude > this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude < this.animateToAmplitude) {\n          this.amplitude = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(this.animateToAmplitude !== this.amplitude2) {\n      this.amplitude2 += this.animateAmplitudeDiff2 * dt;\n      if(this.animateAmplitudeDiff2 > 0) {\n        if(this.amplitude2 > this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      } else {\n        if(this.amplitude2 < this.animateToAmplitude) {\n          this.amplitude2 = this.animateToAmplitude;\n        }\n      }\n    }\n\n    if(previousState) {\n      this.progressToState += dt / 250;\n      if(this.progressToState > 1) {\n        this.progressToState = 1;\n        this.previousState = null;\n      }\n    }\n\n    const {amplitude, amplitude2, progressToState} = this;\n\n    const top1 = 6 * amplitude2 * scale;\n    const top2 = 6 * amplitude2 * scale;\n\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    lbd.minRadius = 0;\n    lbd.maxRadius = (2 + 2 * amplitude) * scale;\n    lbd1.minRadius = 0;\n    lbd1.maxRadius = (3 + 9 * amplitude) * scale;\n    lbd2.minRadius = 0;\n    lbd2.maxRadius = (3 + 9 * amplitude) * scale;\n\n    lbd.update(amplitude, 0.3);\n    lbd1.update(amplitude, 0.7);\n    lbd2.update(amplitude, 0.7);\n\n    for(let i = 0; i < 2; i++) {\n      if(i === 0 && !previousState) {\n        continue;\n      }\n\n      let alpha = 1;\n      let state: WeavingState = null;\n      if(i === 0) {\n        alpha = 1 - progressToState;\n        state = previousState;\n        // previousState.setToPaint(paint);\n      } else {\n        alpha = previousState ? progressToState : 1;\n        currentState.update(bottom - top, right - left, dt, amplitude);\n        state = currentState;\n        // currentState.setToPaint(paint);\n      }\n\n      const paint1 = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = 0.3 * alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n      const paint = (ctx: CanvasRenderingContext2D) => {\n        ctx.globalAlpha = i === 0 ? 1 : alpha;\n        state.shader(ctx, left, top, right, bottom);\n      };\n\n      lbd1.draw(left, top - top1, right, bottom, canvas, paint1, top, 1.0);\n      lbd2.draw(left, top - top2, right, bottom, canvas, paint1, top, 1.0);\n      lbd.draw(left, top, right, bottom, canvas, paint, top, 1.0);\n    }\n\n    if(!force) {\n      this.raf = requestAnimationFrame(() => this.draw());\n    }\n  };\n\n  public setCurrentState = (stateId: GROUP_CALL_STATE, animated: boolean) => {\n    const {currentState, states} = this;\n\n    if(currentState?.stateId === stateId) {\n      return;\n    }\n\n    this.previousState = animated ? currentState : null;\n    this.currentState = states.get(stateId);\n    this.progressToState = this.previousState ? 0.0 : 1.0;\n  };\n\n  public setAmplitude(value: number) {\n    const {amplitude} = this;\n    this.animateToAmplitude = value;\n    this.animateAmplitudeDiff = (value - amplitude) / 250;\n    this.animateAmplitudeDiff2 = (value - amplitude) / 120;\n  }\n\n  private forceUpdate() {\n    this.setCanvasSize();\n  }\n\n  public render(className: string) {\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add(className + '-canvas');\n\n    container.append(canvas);\n\n    return container;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport rootScope from '../rootScope';\nimport lottieLoader, {LottieAssetName} from './lottieLoader';\nimport type RLottiePlayer from './rlottiePlayer';\nimport {RLottieColor} from './rlottiePlayer';\n\nexport type RLottieIconOptions = {\n  width: number,\n  height: number,\n  container?: HTMLElement,\n  skipAnimation?: boolean\n};\n\nexport type RLottieIconItemPartOptions = {\n  startFrame: number,\n  endFrame: number,\n  name?: string\n};\n\nexport type RLottieIconItemOptions = {\n  name: LottieAssetName,\n  parts: RLottieIconItemPartOptions[],\n  initFrame?: number,\n  player?: RLottiePlayer,\n  autoplay?: boolean,\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n};\n\nexport class RLottieIconItemPart implements RLottieIconItemPartOptions {\n  public startFrame: number;\n  public endFrame: number;\n  public name?: string;\n\n  constructor(public item: RLottieIconItem, options: RLottieIconItemPartOptions) {\n    safeAssign(this, options);\n  }\n\n  public play(callback?: () => void) {\n    return this.item.playPart(this, callback);\n  }\n}\n\n// export type RLottieIconItemPart = RLottieIconItemPartOptions;\n\nexport class RLottieIconItem implements RLottieIconItemOptions {\n  public name: LottieAssetName;\n  public parts: RLottieIconItemPart[];\n  public player: RLottiePlayer;\n  public initFrame: number;\n  public autoplay: boolean;\n  public color: RLottieColor;\n  public inverseColor: RLottieColor;\n  public loadPromise: Promise<void>;\n  public onLoadForPart: () => void;\n  public onLoadForColor: () => void;\n\n  constructor(public icon: RLottieIcon, options: RLottieIconItemOptions) {\n    this.autoplay = false;\n\n    safeAssign(this, options);\n\n    this.parts = this.parts.map((options) => this.createPart(options));\n  }\n\n  public load() {\n    let loadPromise = this.loadPromise;\n    if(loadPromise) {\n      return loadPromise;\n    }\n\n    const {container, canvas, width, height} = this.icon;\n    loadPromise = lottieLoader.loadAnimationAsAsset({\n      container,\n      canvas,\n      width,\n      height,\n      group: 'none',\n      loop: false,\n      autoplay: this.autoplay ?? false,\n      initFrame: this.initFrame,\n      skipFirstFrameRendering: this.initFrame === undefined,\n      color: this.color,\n      inverseColor: this.inverseColor\n    }, this.name).then((player) => {\n      return lottieLoader.waitForFirstFrame(player);\n    }).then((player) => {\n      this.player = player;\n\n      if(this.onLoadForColor) {\n        this.onLoadForColor();\n        this.onLoadForColor = undefined;\n      }\n\n      if(this.onLoadForPart) {\n        this.onLoadForPart();\n        this.onLoadForPart = undefined;\n      }\n    });\n\n    this.loadPromise = loadPromise;\n    this.icon.loadPromises.set(this.name, loadPromise);\n    return loadPromise;\n  }\n\n  public createPart(options: RLottieIconItemPartOptions) {\n    return new RLottieIconItemPart(this, options);\n  }\n\n  public getPart(index: string | number | RLottieIconItemPart) {\n    if(index instanceof RLottieIconItemPart) return index;\n    else if(typeof(index) === 'string') return this.parts.find((part) => part.name === index);\n    else return this.parts[index];\n  }\n\n  public playPart(part: RLottieIconItemPart, callback?: () => void) {\n    return this.icon.playPart(this, part, callback);\n  }\n}\n\nexport default class RLottieIcon {\n  public container: HTMLElement;\n  public canvas: HTMLCanvasElement;\n  public width: number;\n  public height: number;\n\n  protected items: Map<LottieAssetName, RLottieIconItem>;\n  public loadPromises: Map<LottieAssetName, Promise<void>>;\n\n  protected skipAnimation: boolean;\n\n  constructor(options: RLottieIconOptions) {\n    safeAssign(this, options);\n\n    if(!this.container) this.container = document.createElement('div');\n    this.container.classList.add('rlottie-icon');\n\n    const {width, height} = this;\n    this.container.style.width = width + 'px';\n    this.container.style.height = height + 'px';\n\n    const canvas = this.canvas = document.createElement('canvas');\n    canvas.classList.add('rlottie');\n    canvas.width = width;\n    canvas.height = height;\n\n    this.items = new Map();\n    this.loadPromises = new Map();\n  }\n\n  public get loadPromise() {\n    return Promise.all([...this.loadPromises.values()]).then(noop);\n  }\n\n  public getItem(name?: LottieAssetName): RLottieIconItem {\n    return !name && this.items.size === 1 ? this.items.values().next().value : this.items.get(name);\n  }\n\n  public add(options: Omit<RLottieIconItemOptions, 'player'>) {\n    const item = new RLottieIconItem(this, options);\n    this.items.set(options.name, item);\n\n    return item;\n  }\n\n  public playPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], callback?: () => void) {\n    if(!item.player) {\n      item.onLoadForPart = () => {\n        this.playPart(item, index, callback);\n      };\n\n      return;\n    }\n\n    const part = item.getPart(index);\n    item.player.playPart({\n      from: rootScope.settings.animationsEnabled && !this.skipAnimation ? part.startFrame : part.endFrame,\n      to: part.endFrame,\n      callback\n    });\n  }\n\n  /* public playToPart(item: RLottieIconItem, index: Parameters<RLottieIconItem['getPart']>[0], toEnd: boolean) {\n    if(!item.player) return;\n    const part = item.getPart(index);\n    const toFrame = toEnd ? part.endFrame : part.startFrame;\n    item.player.playToFrame({\n      frame: toFrame\n    });\n  } */\n\n  public static generateEqualParts(length: number, frameCount: number): RLottieIconItemPartOptions[] {\n    return new Array(length).fill(0).map((_, idx) => {\n      const startFrame = idx * frameCount;\n      return {startFrame, endFrame: startFrame + frameCount - 1};\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport noop from '../helpers/noop';\nimport safeAssign from '../helpers/object/safeAssign';\nimport {LottieAssetName} from '../lib/rlottie/lottieLoader';\nimport RLottieIcon, {RLottieIconItemPartOptions, RLottieIconItemPart} from '../lib/rlottie/rlottieIcon';\nimport {RLottieColor} from '../lib/rlottie/rlottiePlayer';\n\nexport type SuperRLottieIconAddItemOptions = {name: LottieAssetName, parts: RLottieIconItemPartOptions};\nexport type SuperRLottieIconGetInfoResult = RLottieIconItemPart;\nexport class SuperRLottieIcon<Options extends {\n  PartState: any,\n  ColorState?: any,\n  Items?: {\n    name: string\n  }[]\n}> extends RLottieIcon {\n  protected getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult;\n  protected getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor;\n\n  protected partState: Options['PartState'];\n  protected colorState: Options['ColorState'];\n  protected loaded: boolean;\n\n  constructor(options: {\n    width: number,\n    height: number,\n    skipAnimation?: boolean,\n    getPart: (state: Options['PartState'], prevState?: Options['PartState']) => SuperRLottieIconGetInfoResult,\n    getColor?: (state: Options['ColorState'], prevState?: Options['ColorState']) => RLottieColor,\n  }) {\n    super({\n      width: options.width,\n      height: options.height\n    });\n\n    safeAssign(this, options);\n\n    // hook the first call\n    /* const originalFunction = this.setState.bind(this);\n    this.setState = (partState, colorState) => {\n      this.setState = originalFunction;\n      this.load(partState, colorState);\n      return originalFunction(partState, colorState);\n    }; */\n  }\n\n  public load(partState: Options['PartState'], colorState?: Options['ColorState']) {\n    if(this.loaded) {\n      return this.loadPromise;\n    }\n\n    this.loaded = true;\n    this.partState = partState;\n    this.colorState = colorState;\n\n    const part = this.getPart(partState);\n    const color = colorState !== undefined && this.getColor && this.getColor(colorState);\n\n    const item = part.item;\n    item.initFrame = part.endFrame;\n    item.color = color;\n\n    const promises = [...this.items.values()].map((item) => item.load());\n    return Promise.all(promises).then(noop);\n  }\n\n  /**\n   * Will redirect setting color state to part callback to synchronize the rendering\n   */\n  public setState(partState: Options['PartState'], colorState?: Options['ColorState'], partCallback?: () => void) {\n    if(!this.loaded) this.load(partState, colorState);\n\n    let changedPartState = false, changedColorState = false;\n    if(partState !== undefined) changedPartState = this.setPartState(partState, colorState, partCallback);\n    else if(colorState !== undefined) changedColorState = this.setColorState(colorState);\n\n    return changedPartState || changedColorState;\n  }\n\n  public setPartState(state: Options['PartState'], colorState?: Options['ColorState'], callback?: () => void) {\n    const {partState: prevState} = this;\n    if(prevState === state) {\n      return colorState !== undefined ? this.setColorState(colorState) : false;\n    }\n\n    if(colorState !== undefined) {\n      this.setColorState(colorState, false);\n    }\n\n    this.partState = state;\n\n    const part = this.getPart(state, prevState);\n    part.play(callback);\n\n    return true;\n  }\n\n  public setColorState(state: Options['ColorState'], renderIfPaused = true) {\n    const {colorState: prevState} = this;\n    if(prevState === state || !this.getColor) {\n      return false;\n    }\n\n    this.colorState = state;\n\n    const item = this.getItem();\n    const color = this.getColor(state, prevState);\n    const invoke = () => {\n      item.player.setColor(color, renderIfPaused);\n    };\n\n    if(item.player) {\n      invoke();\n    } else {\n      item.onLoadForColor = invoke;\n    }\n\n    return true;\n  }\n\n  public destroy() {\n    this.items.forEach((item) => {\n      item.loadPromise.then(() => {\n        item.player.remove();\n      });\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {RLottieIconItemPartOptions} from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_MICROPHONE_BUTTON_STATE} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_MICROPHONE_BUTTON_STATE\n}> {\n  constructor() {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n        let partName: string;\n        switch(state) {\n          case states.HAND:\n            partName = prevState === states.MUTED ? 'muted-to-hand' : 'unmuted-to-hand';\n            break;\n          case states.MUTED:\n            partName = prevState === states.HAND ? 'hand-to-muted' : 'mute';\n            break;\n          case states.UNMUTED:\n            partName = 'unmute';\n            break;\n        }\n\n        return this.getItem().getPart(partName);\n      }\n    });\n\n    const className = 'group-call-microphone-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts: RLottieIconItemPartOptions[] = [{\n      startFrame: 0,\n      endFrame: 35,\n      name: 'hand-to-muted'\n    }, {\n      startFrame: 36,\n      endFrame: 68,\n      name: 'unmute'\n    }, {\n      startFrame: 69,\n      endFrame: 98,\n      name: 'mute'\n    }, {\n      startFrame: 99,\n      endFrame: 135,\n      name: 'muted-to-hand'\n    }, {\n      startFrame: 136,\n      endFrame: 172,\n      name: 'unmuted-to-hand'\n    }, {\n      startFrame: 173,\n      endFrame: 201,\n      name: 'scheduled-crossing'\n    }, {\n      startFrame: 202,\n      endFrame: 236,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 237,\n      endFrame: 273,\n      name: 'scheduled-to-hand'\n    }, {\n      startFrame: 274,\n      endFrame: 310,\n      name: 'scheduled-crossed-to-hand'\n    }, {\n      startFrame: 311,\n      endFrame: 343,\n      name: 'scheduled-uncrossing'\n    }, {\n      startFrame: 344,\n      endFrame: 375,\n      name: 'scheduled-to-muted'\n    }, {\n      startFrame: 376,\n      endFrame: 403,\n      name: 'play-to-muted'\n    }];\n\n    this.add({\n      name: 'voip_filled',\n      parts\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport RLottieIcon from '../../lib/rlottie/rlottieIcon';\nimport {GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE, getColorByMutedState, clearMutedStateModifier} from '.';\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallParticipantMutedIcon extends SuperRLottieIcon<{\n  PartState: GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE,\n  ColorState: GROUP_CALL_PARTICIPANT_MUTED_STATE\n}> {\n  constructor(private colored: boolean) {\n    super({\n      width: 32,\n      height: 32,\n      getPart: (state, prevState) => {\n        const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n\n        let index: number;\n        switch(state) {\n          case states.HAND:\n            index = 3;\n            break;\n          case states.MUTED:\n            index = prevState === states.HAND ? 0 : 2;\n            break;\n          case states.UNMUTED:\n            index = 1;\n            break;\n        }\n\n        return this.getItem().getPart(index);\n      },\n      getColor: colored ? (state, prevState) => {\n        return getColorByMutedState(state);\n      } : undefined\n    });\n\n    const className = 'group-call-participant-muted-icon';\n    this.container.classList.add(className + '-container');\n\n    const parts = RLottieIcon.generateEqualParts(4, 21);\n    this.add({\n      name: 'voice_outlined2',\n      parts\n    });\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n    return super.setState(clearMutedStateModifier(state), state);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupElement from '../popups';\nimport {hexToRgb} from '../../helpers/color';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport customProperties from '../../helpers/dom/customProperties';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport {RLottieColor} from '../../lib/rlottie/rlottiePlayer';\nimport rootScope from '../../lib/rootScope';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIcon from './microphoneIcon';\nimport GroupCallParticipantsElement from './participants';\nimport GroupCallParticipantsVideoElement from './participantVideos';\nimport PopupPeer from '../popups/peer';\nimport GroupCallDescriptionElement from './description';\nimport GroupCallTitleElement from './title';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport Scrollable from '../scrollable';\nimport {MovableState} from '../movableElement';\nimport animationIntersector from '../animationIntersector';\nimport {IS_APPLE_MOBILE} from '../../environment/userAgent';\nimport throttle from '../../helpers/schedulers/throttle';\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport makeButton from '../call/button';\nimport MovablePanel from '../../helpers/movablePanel';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport themeController from '../../helpers/themeController';\nimport groupCallsController from '../../lib/calls/groupCallsController';\n\nexport enum GROUP_CALL_PARTICIPANT_MUTED_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_FOR_ME,\n  MUTED_BY_ADMIN,\n  HAND\n}\n\nexport type GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE = Exclude<GROUP_CALL_PARTICIPANT_MUTED_STATE, GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_BY_ADMIN | GROUP_CALL_PARTICIPANT_MUTED_STATE.MUTED_FOR_ME>;\n\nexport function getGroupCallParticipantMutedState(participant: GroupCallParticipant) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  if(participant.pFlags.muted_by_you) {\n    return states.MUTED_FOR_ME;\n  } else if(participant.raise_hand_rating !== undefined) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return participant.pFlags.can_self_unmute ? states.MUTED : states.MUTED_BY_ADMIN;\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nexport function clearMutedStateModifier(state: GROUP_CALL_PARTICIPANT_MUTED_STATE): GROUP_CALL_PARTICIPANT_CLEARED_MUTED_STATE {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  switch(state) {\n    case states.MUTED_BY_ADMIN:\n    case states.MUTED_FOR_ME:\n      return states.MUTED;\n    default:\n      return state;\n  }\n}\n\nexport function getColorByMutedState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE) {\n  const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n  let colorStr: 'blue' | 'green' | 'secondary' | 'red';\n  switch(state) {\n    case states.HAND:\n      colorStr = 'blue';\n      break;\n    case states.MUTED:\n    case states.MUTED_FOR_ME:\n    case states.MUTED_BY_ADMIN:\n      colorStr = state === states.MUTED ? 'secondary' : 'red';\n      break;\n    case states.UNMUTED:\n      colorStr = 'green';\n      break;\n  }\n\n  const propertyValue = customProperties.getProperty('gc-' + colorStr + '-text-color');\n  const color: RLottieColor = hexToRgb(propertyValue);\n\n  return color;\n}\n\nexport enum GROUP_CALL_MICROPHONE_BUTTON_STATE {\n  HAND,\n  MUTED,\n  UNMUTED,\n}\n\nexport function getGroupCallMicrophoneButtonState(groupCall: GroupCall.groupCall, participant: GroupCallParticipant) {\n  const states = GROUP_CALL_MICROPHONE_BUTTON_STATE;\n  if(!participant.pFlags.can_self_unmute) {\n    return states.HAND;\n  } else if(participant.pFlags.muted) {\n    return states.MUTED\n  } else {\n    return states.UNMUTED;\n  }\n}\n\nlet previousState: MovableState = {\n  width: 420,\n  height: 640\n};\n\nconst className = 'group-call';\n\nexport default class PopupGroupCall extends PopupElement {\n  private instance: GroupCallInstance;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallBodyHeaderDescription: GroupCallDescriptionElement;\n  private groupCallParticipants: GroupCallParticipantsElement;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private groupCallMicrophoneIcon: GroupCallMicrophoneIcon;\n  private videosCount: number;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n  private btnInvite: HTMLButtonElement;\n  private btnShowColumn: HTMLButtonElement;\n  private movablePanel: MovablePanel;\n  private buttonsContainer: HTMLDivElement;\n  private btnFullScreen2: HTMLButtonElement;\n  private btnVideo: HTMLDivElement;\n  private btnScreen: HTMLDivElement;\n\n  constructor() {\n    super('popup-group-call', {\n      body: true,\n      withoutOverlay: true,\n      closable: true,\n      title: true\n    });\n\n    this.videosCount = 0;\n    this.container.classList.add(className, 'night');\n\n    const instance = this.instance = groupCallsController.groupCall;\n    const {listenerSetter} = this;\n\n    if(!IS_APPLE_MOBILE) {\n      const btnFullScreen = this.btnFullScreen = ButtonIcon('fullscreen');\n      const btnFullScreen2 = this.btnFullScreen2 = ButtonIcon('fullscreen ' + className + '-cfs');\n      const btnExitFullScreen = this.btnExitFullScreen = ButtonIcon('smallscreen');\n\n      attachClickEvent(btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(btnFullScreen2, this.onFullScreenClick, {listenerSetter});\n\n      attachClickEvent(btnExitFullScreen, () => {\n        cancelFullScreen();\n      }, {listenerSetter});\n\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n    }\n\n    const btnInvite = this.btnInvite = ButtonIcon('adduser');\n    const btnShowColumn = this.btnShowColumn = ButtonIcon('rightpanel ' + className + '-only-big');\n\n    attachClickEvent(btnShowColumn, this.toggleRightColumn, {listenerSetter});\n\n    const headerInfo = document.createElement('div');\n    headerInfo.classList.add(className + '-header-info');\n\n    this.title.classList.add(className + '-header-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-header-subtitle');\n\n    headerInfo.append(this.title, subtitle);\n\n    this.header.classList.add(className + '-header');\n    this.header.append(...[this.btnExitFullScreen, headerInfo/* , btnInvite */, this.btnFullScreen, btnShowColumn].filter(Boolean));\n\n    const newHeader = this.header.cloneNode(false) as HTMLElement;\n    const newHeaderInfo = headerInfo.cloneNode(false) as HTMLElement;\n    const newHeaderTitle = this.title.cloneNode(false) as HTMLElement;\n\n    newHeaderInfo.append(newHeaderTitle);\n\n    const btnHideColumn = ButtonIcon('rightpanel');\n    newHeader.append(...[btnHideColumn, newHeaderInfo, this.btnFullScreen2].filter(Boolean));\n\n    attachClickEvent(btnHideColumn, this.toggleRightColumn, {listenerSetter});\n\n    this.body.prepend(newHeader);\n\n    const videosScrollable = new Scrollable(undefined);\n    videosScrollable.container.classList.add('group-call-big-video-container');\n    this.container.append(videosScrollable.container);\n\n    this.groupCallTitle = new GroupCallTitleElement(this.title);\n    this.groupCallDescription = new GroupCallDescriptionElement(subtitle);\n    this.groupCallBodyHeaderDescription = new GroupCallDescriptionElement(newHeaderTitle);\n    this.constructButtons();\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      appendTo: videosScrollable.container,\n      instance,\n      listenerSetter,\n      displayPinned: true,\n      onLengthChange: (length) => {\n        this.videosCount = length;\n        this.toggleBigLayout();\n      },\n      managers: this.managers\n    });\n    this.groupCallParticipants = new GroupCallParticipantsElement({\n      appendTo: this.body,\n      instance,\n      listenerSetter,\n      managers: this.managers\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: 400,\n        minHeight: 480,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'chatlist') ||\n            findUpClassName(target, 'group-call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            findUpClassName(target, 'group-call-participants-video-container') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      onResize: () => this.toggleBigLayout(),\n      previousState\n    });\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      if(this.instance?.id === groupCall.id) {\n        this.updateInstance();\n      }\n    });\n\n    listenerSetter.add(instance)('pinned', () => {\n      this.setHasPinned();\n    });\n\n    listenerSetter.add(this.groupCallParticipantsVideo)('toggleControls', this.onToggleControls);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.groupCallParticipantsVideo.destroy();\n      this.groupCallParticipants.destroy();\n      this.groupCallMicrophoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.toggleRightColumn();\n    this.onFullScreenChange();\n\n    this.updateInstance();\n  }\n\n  private constructButtons() {\n    const buttons = this.buttonsContainer = document.createElement('div');\n    buttons.classList.add(className + '-buttons');\n\n    const _makeButton = makeButton.bind(null, className, this.listenerSetter);\n\n    const btnVideo = this.btnVideo = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Video',\n      callback: this.onVideoClick,\n      icon: 'videocamera_filled'\n    });\n\n    const btnScreen = this.btnScreen = _makeButton({\n      // text: 'VoiceChat.Video.Stream.Screencast',\n      callback: this.onScreenClick,\n      icon: 'sharescreen_filled'\n    });\n\n    btnScreen.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnMute = _makeButton({\n      noRipple: true,\n      callback: throttle(this.onMuteClick, 600, true)\n    });\n    btnMute.classList.add(className + '-microphone-button');\n\n    const microphoneIcon = this.groupCallMicrophoneIcon = new GroupCallMicrophoneIcon();\n    btnMute.append(microphoneIcon.container);\n\n    const btnMore = _makeButton({\n      // text: 'VoiceChat.Video.Stream.More'\n      icon: 'settings_filled'\n    });\n\n    btnMore.classList.add('btn-disabled');\n    btnMore.classList.toggle('hide', !IS_SCREEN_SHARING_SUPPORTED);\n\n    const btnLeave = _makeButton({\n      // text: 'VoiceChat.Leave',\n      isDanger: true,\n      callback: this.onLeaveClick,\n      icon: 'close'\n    });\n\n    buttons.append(btnVideo, btnScreen, btnMute, btnMore, btnLeave);\n\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onToggleControls = (show: boolean) => {\n    this.container.classList.toggle('show-controls', show);\n    this.buttonsContainer.classList.toggle('show-controls', show);\n  };\n\n  private toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n  private onVideoClick = () => {\n    const toggle = this.toggleDisability([this.btnVideo], true);\n    this.instance.toggleVideoSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onScreenClick = () => {\n    const toggle = this.toggleDisability([this.btnScreen], true);\n    this.instance.toggleScreenSharing().finally(() => {\n      toggle();\n    });\n  };\n\n  private onMuteClick = () => {\n    const participant = this.instance.participant;\n    if(!participant.pFlags.can_self_unmute) {\n      if(participant.raise_hand_rating === undefined) {\n        this.instance.changeRaiseHand(true);\n      }\n    } else {\n      this.instance.toggleMuted();\n    }\n  };\n\n  private onLeaveClick = async() => {\n    const hangUp = (discard: boolean) => {\n      this.instance.hangUp(discard);\n    };\n\n    if(await this.managers.appChatsManager.hasRights(this.instance.chatId, 'manage_call')) {\n      new PopupPeer('popup-end-video-chat', {\n        titleLangKey: 'VoiceChat.End.Title',\n        descriptionLangKey: 'VoiceChat.End.Text',\n        checkboxes: [{\n          text: 'VoiceChat.End.Third'\n        }],\n        buttons: [{\n          langKey: 'VoiceChat.End.OK',\n          callback: (checkboxes) => {\n            hangUp(!!checkboxes.size);\n          },\n          isDanger: true\n        }]\n      }).show();\n    } else {\n      hangUp(false);\n    }\n  };\n\n  public getContainer() {\n    return this.container;\n  }\n\n  private onFullScreenChange = () => {\n    this.toggleBigLayout();\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n    }\n  };\n\n  private toggleBigLayout = () => {\n    const isFull = isFullScreen();\n    const movable = this.movablePanel?.movable;\n    const isBig = (isFull || !!(movable && movable.width >= 680)) && !!this.videosCount;\n\n    /* if(!isBig && isFull) {\n      cancelFullScreen();\n      return;\n    } */\n\n    const wasBig = this.container.classList.contains('is-big-layout');\n    let buttons: HTMLElement[];\n    if(isBig && !wasBig) { // fix buttons transition to 0 opacity\n      buttons = Array.from(this.buttonsContainer.children) as HTMLElement[];\n      buttons.forEach((element) => {\n        element.style.opacity = '0';\n      });\n\n      void this.buttonsContainer.offsetLeft;\n    }\n\n    this.container.classList.toggle('is-big-layout', isBig);\n    this.btnInvite.classList.toggle('hide', isBig);\n    this.btnShowColumn.classList.toggle('hide', !isBig);\n\n    if(buttons) {\n      // window.requestAnimationFrame(() => {\n      buttons.forEach((element) => {\n        element.style.opacity = '';\n      });\n      // });\n    }\n  };\n\n  private toggleRightColumn = () => {\n    this.container.classList.toggle('is-right-column-shown');\n  };\n\n  private setHasPinned() {\n    this.container.classList.toggle('has-pinned', !!this.instance.pinnedSource);\n  }\n\n  private updateInstance() {\n    if(this.instance.state === GROUP_CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.hide();\n      return;\n    }\n\n    const {participant, groupCall} = this.instance;\n    if(!participant) {\n      return;\n    }\n\n    this.setTitle();\n    this.setDescription();\n    this.setHasPinned();\n\n    const microphoneButtonState = getGroupCallMicrophoneButtonState(groupCall as any, participant);\n    this.container.dataset.micState = microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.HAND ? 'hand' : (microphoneButtonState === GROUP_CALL_MICROPHONE_BUTTON_STATE.MUTED ? 'muted' : 'unmuted');\n    this.groupCallMicrophoneIcon.setState(microphoneButtonState);\n  }\n\n  private setTitle() {\n    this.groupCallTitle.update(this.instance);\n  }\n\n  private setDescription() {\n    this.groupCallDescription.update(this.instance);\n    this.groupCallBodyHeaderDescription.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCallParticipant} from '../../layer';\nimport {i18n} from '../../lib/langPack';\nimport {GROUP_CALL_PARTICIPANT_MUTED_STATE} from '.';\nimport {GroupCallParticipantVideoType} from './participantVideo';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\n\nconst className = 'group-call-participant-status';\nexport default class GroupCallParticipantStatusElement {\n  public container: HTMLElement;\n\n  constructor(private withIcons: GroupCallParticipantVideoType[]) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n  }\n\n  public setState(state: GROUP_CALL_PARTICIPANT_MUTED_STATE, participant: GroupCallParticipant) {\n    const states = GROUP_CALL_PARTICIPANT_MUTED_STATE;\n    const icons = this.withIcons.filter((type) => !!participant[type]).map((type) => {\n      const iconClassName = `tgico-${type === 'presentation' ? 'listscreenshare' : 'videocamera_filled'}`;\n      const i = document.createElement('i');\n      i.classList.add(className + '-icon', className + '-icon-' + type, iconClassName);\n      return i;\n    });\n\n    let element2: HTMLElement, actionClassName: string;\n    if(state === states.MUTED_FOR_ME) {\n      element2 = i18n('VoiceChat.Status.MutedForYou');\n      actionClassName = 'is-muted';\n    } else if(state === states.UNMUTED) {\n      element2 = i18n('VoiceChat.Status.Speaking');\n      actionClassName = 'is-speaking';\n    } else if(state === states.HAND) {\n      element2 = i18n('VoiceChat.Status.WantsSpeak');\n      actionClassName = 'is-waiting';\n    } else if(participant.about && !icons.length) {\n      setInnerHTML(this.container, wrapEmojiText(participant.about));\n      return;\n    } else {\n      element2 = i18n('VoiceChat.Status.Listening');\n      actionClassName = 'is-listening';\n    }\n\n    const span = document.createElement('span');\n    span.classList.add(className, actionClassName);\n    span.append(...icons, element2);\n\n    replaceContent(this.container, span);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport positionElementByIndex from '../../helpers/dom/positionElementByIndex';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport {fastRaf} from '../../helpers/schedulers';\nimport SortedList, {SortedElementBase} from '../../helpers/sortedList';\nimport {GroupCallParticipant} from '../../layer';\nimport appDialogsManager, {DialogDom, AppDialogsManager} from '../../lib/appManagers/appDialogsManager';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport type GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport type LazyLoadQueue from '../lazyLoadQueue';\n\ninterface SortedParticipant extends SortedElementBase {\n  dom: DialogDom,\n  mutedIcon: GroupCallParticipantMutedIcon,\n  status: GroupCallParticipantStatusElement\n}\n\nexport default class GroupCallParticipantsList extends SortedList<SortedParticipant> {\n  public list: HTMLUListElement;\n\n  protected lazyLoadQueue: LazyLoadQueue;\n  protected avatarSize = 54;\n  protected rippleEnabled = true;\n  protected autonomous = true;\n  protected createChatListOptions: Parameters<AppDialogsManager['createChatList']>[0] = {/* new: true,  */dialogSize: 72};\n\n  constructor(private instance: GroupCallInstance) {\n    super({\n      getIndex: async(element) => (await this.instance.getParticipantByPeerId(element.id)).date,\n      onDelete: (element) => {\n        element.dom.listEl.remove();\n        this.onElementDestroy(element);\n      },\n      onUpdate: async(element) => {\n        const participant = await this.instance.getParticipantByPeerId(element.id);\n        const state = getGroupCallParticipantMutedState(participant);\n\n        element.mutedIcon.setState(state);\n        element.status.setState(state, participant);\n      },\n      onSort: (element, idx) => {\n        positionElementByIndex(element.dom.listEl, this.list, idx);\n      },\n      onElementCreate: (base) => {\n        const {dom} = appDialogsManager.addDialogNew({\n          peerId: base.id,\n          container: false,\n          avatarSize: this.avatarSize,\n          autonomous: this.autonomous,\n          meAsSaved: false,\n          rippleEnabled: this.rippleEnabled,\n          lazyLoadQueue: this.lazyLoadQueue\n        });\n\n        const className = 'group-call-participant';\n        dom.listEl.classList.add(className);\n\n        const mutedIcon = new GroupCallParticipantMutedIcon(true);\n        const status = new GroupCallParticipantStatusElement(['presentation', 'video']);\n        replaceContent(dom.lastMessageSpan, status.container);\n        dom.listEl.append(mutedIcon.container);\n        (base as SortedParticipant).mutedIcon = mutedIcon;\n        (base as SortedParticipant).status = status;\n\n        /* instance.getParticipantByPeerId(base.id).then((participant) => {\n          const mutedState = getGroupCallParticipantMutedState(participant);\n\n          mutedIcon.setState(mutedState);\n          status.setState(mutedState, participant);\n        }); */\n\n        (base as SortedParticipant).dom = dom;\n\n        return base as SortedParticipant;\n      },\n      updateElementWith: fastRaf\n    });\n\n    this.list = appDialogsManager.createChatList(this.createChatListOptions);\n  }\n\n  public destroy() {\n    this.elements.forEach((element) => {\n      this.onElementDestroy(element);\n    });\n  }\n\n  protected onElementDestroy(element: SortedParticipant) {\n    element.mutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {animate} from '../../helpers/animation';\n\nexport default function callVideoCanvasBlur(video: HTMLVideoElement) {\n  const canvas = document.createElement('canvas');\n  canvas.classList.add('call-video-blur');\n  const size = 16;\n  canvas.width = size;\n  canvas.height = size;\n\n  const ctx = canvas.getContext('2d', {alpha: false});\n  ctx.filter = 'blur(2px)';\n  const renderFrame = () => {\n    ctx.drawImage(video, 0, 0, video.videoWidth, video.videoHeight, 0, 0, canvas.width, canvas.height);\n  };\n\n  animate(() => {\n    renderFrame();\n    return canvas.isConnected;\n  });\n\n  renderFrame();\n\n  return canvas;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipant} from '../../layer';\nimport type {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {i18n} from '../../lib/langPack';\nimport PeerTitle from '../peerTitle';\nimport {getGroupCallParticipantMutedState} from '.';\nimport GroupCallParticipantMutedIcon from './participantMutedIcon';\nimport GroupCallParticipantStatusElement from './participantStatus';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport callVideoCanvasBlur from '../call/videoCanvasBlur';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../../lib/appManagers/managers';\n\nconst className = 'group-call-participant-video';\n\nexport type GroupCallParticipantVideoType = 'video' | 'presentation';\nexport default class GroupCallParticipantVideoElement {\n  public container: HTMLElement;\n  private peerTitle: PeerTitle;\n  private subtitle: HTMLElement;\n  private info: HTMLElement;\n  private left: HTMLElement;\n  private right: HTMLElement;\n  private header: HTMLElement;\n  private groupCallParticipantMutedIcon: GroupCallParticipantMutedIcon;\n  private groupCallParticipantStatus: GroupCallParticipantStatusElement;\n\n  constructor(private managers: AppManagers, private instance: GroupCallInstance, public source: GroupCallOutputSource) {\n    this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    this.info = document.createElement('div');\n    this.info.classList.add(className + '-info');\n\n    this.left = document.createElement('div');\n    this.left.classList.add(className + '-info-left');\n\n    this.right = document.createElement('div');\n    this.right.classList.add(className + '-info-right');\n\n    this.info.append(this.left, this.right);\n\n    this.container.append(this.info);\n  }\n\n  public setPinned(value: boolean) {\n    if(!value) {\n      if(this.header) {\n        this.header.remove();\n        this.header = undefined;\n      }\n\n      return;\n    } else if(this.header) {\n      return;\n    }\n\n    // if(!this.header) {\n    this.header = document.createElement('div');\n    this.header.classList.add(className + '-header');\n\n    const icon = document.createElement('i');\n    icon.classList.add('group-call-pin-icon', 'tgico-pin');\n    this.header.append(icon);\n\n    this.container.append(this.header);\n    // }\n\n    // this.container.classList.toggle('is-pinned', value);\n  }\n\n  public setParticipant(participant: GroupCallParticipant, type: GroupCallParticipantVideoType, video: HTMLVideoElement) {\n    let peerTitleElement: HTMLElement;\n    if(participant.pFlags.self) {\n      peerTitleElement = i18n('VoiceChat.Status.You');\n      peerTitleElement.classList.add('peer-title');\n    } else {\n      this.peerTitle = new PeerTitle({\n        peerId: getPeerId(participant.peer)\n      });\n\n      peerTitleElement = this.peerTitle.element;\n    }\n\n    this.groupCallParticipantMutedIcon = new GroupCallParticipantMutedIcon(false);\n    this.groupCallParticipantStatus = new GroupCallParticipantStatusElement([type]);\n\n    this.left.append(peerTitleElement, this.groupCallParticipantStatus.container);\n\n    this.right.append(this.groupCallParticipantMutedIcon.container);\n\n    video.classList.add(className, 'call-video');\n\n    if(video.paused) {\n      video.play();\n    }\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(className + '-blur');\n\n    this.container.prepend(canvas, video);\n\n    this.updateParticipant(participant);\n  }\n\n  public updateParticipant(participant: GroupCallParticipant) {\n    const state = getGroupCallParticipantMutedState(participant);\n\n    this.groupCallParticipantMutedIcon.setState(state);\n    this.groupCallParticipantStatus.setState(state, participant);\n  }\n\n  public destroy() {\n    this.groupCallParticipantMutedIcon.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipant} from '../../layer';\nimport {GroupCallOutputSource} from '../../lib/appManagers/appGroupCallsManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport GroupCallParticipantVideoElement, {GroupCallParticipantVideoType} from './participantVideo';\n\nexport default class GroupCallParticipantsVideoElement extends ControlsHover {\n  private container: HTMLDivElement;\n  private instance: GroupCallInstance;\n  private participantsElements: Map<PeerId, Map<GroupCallParticipantVideoType, GroupCallParticipantVideoElement>>;\n  private displayPinned: boolean;\n  private containers: Map<HTMLElement, GroupCallParticipantVideoElement>;\n  private onLengthChange: (length: number) => void;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    displayPinned: boolean,\n    onLengthChange?: GroupCallParticipantsVideoElement['onLengthChange'],\n    managers: AppManagers\n  }) {\n    super();\n    safeAssign(this, options);\n\n    const className = 'group-call-participants-video';\n    const container = this.container = document.createElement('div');\n    this.container.classList.add(className + '-container');\n\n    options.appendTo.append(container);\n\n    this.participantsElements = new Map();\n    this.containers = new Map();\n\n    const {listenerSetter} = this;\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    listenerSetter.add(this.instance)('pinned', (source) => {\n      this.participantsElements.forEach((map) => {\n        map.forEach((element) => {\n          this.setElementDisplay(element, source);\n        });\n      });\n    });\n\n    attachClickEvent(this.container, (e) => {\n      const container = findUpClassName(e.target, 'group-call-participant-video-container');\n      if(!container) {\n        return;\n      }\n\n      const element = this.containers.get(container);\n      if(this.instance.pinnedSource === element.source) {\n        this.instance.unpinAll();\n        return;\n      }\n\n      this.instance.pinSource(element.source);\n    }, {listenerSetter});\n\n    this.setInstance(this.instance);\n\n    this.setup({\n      element: container,\n      listenerSetter: listenerSetter,\n      showOnLeaveToClassName: 'group-call-buttons'\n    });\n  }\n\n  private shouldDisplayElement(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    return this.displayPinned ? !pinnedSource || element.source === pinnedSource : pinnedSource && element.source !== pinnedSource;\n  }\n\n  private setElementDisplay(element: GroupCallParticipantVideoElement, pinnedSource: GroupCallOutputSource) {\n    const shouldDisplay = this.shouldDisplayElement(element, pinnedSource);\n    element.container.classList.toggle('video-hidden', !shouldDisplay);\n\n    const isPinned = element.source === pinnedSource;\n    element.setPinned(isPinned);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const types: GroupCallParticipantVideoType[] = ['video', 'presentation'];\n    const hasAnyVideo = types.some((type) => !!participant[type]);\n    let participantElements = this.participantsElements.get(peerId);\n    if(!hasAnyVideo && !participantElements) {\n      return;\n    }\n\n    if(!participantElements) {\n      this.participantsElements.set(peerId, participantElements = new Map());\n    }\n\n    types.forEach((type) => {\n      let element = participantElements.get(type);\n      const participantVideo = participant[type];\n      if(!!participantVideo === !!element) {\n        if(element) {\n          element.updateParticipant(participant);\n        }\n\n        return;\n      }\n\n      if(participantVideo) {\n        const result = this.instance.getVideoElementFromParticipantByType(participant, type);\n        if(!result) {\n          return;\n        }\n\n        const {video, source} = result;\n\n        element = new GroupCallParticipantVideoElement(this.managers, this.instance, source);\n\n        this.containers.set(element.container, element);\n\n        this.setElementDisplay(element, this.instance.pinnedSource);\n        participantElements.set(type, element);\n        element.setParticipant(participant, type, video);\n\n        this.container.prepend(element.container);\n      } else {\n        participantElements.delete(type);\n        element.container.remove();\n\n        if(!participantElements.size) {\n          this.participantsElements.delete(peerId);\n          this.containers.delete(element.container);\n          element.destroy();\n        }\n      }\n\n      this._onLengthChange();\n    });\n  }\n\n  private _onLengthChange() {\n    const length = this.container.childElementCount;\n    this.container.dataset.length = '' + length;\n    this.container.dataset.layout = length <= 2 ? '1' : (length === 3 ? '3' : '4');\n\n    this.onLengthChange && this.onLengthChange(length);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    (await instance.participants).forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.containers.forEach((element) => {\n      element.destroy();\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport PopupGroupCall from '.';\nimport filterAsync from '../../helpers/array/filterAsync';\nimport contextMenuController from '../../helpers/contextMenuController';\nimport {attachContextMenuListener} from '../../helpers/dom/attachContextMenuListener';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, isFullScreen} from '../../helpers/dom/fullScreen';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport noop from '../../helpers/noop';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport positionMenu from '../../helpers/positionMenu';\nimport ScrollableLoader from '../../helpers/scrollableLoader';\nimport {GroupCallParticipant} from '../../layer';\nimport type {AppChatsManager} from '../../lib/appManagers/appChatsManager';\nimport type {AppGroupCallsManager} from '../../lib/appManagers/appGroupCallsManager';\nimport appImManager from '../../lib/appManagers/appImManager';\nimport type {AppPeersManager} from '../../lib/appManagers/appPeersManager';\nimport {AppManagers} from '../../lib/appManagers/managers';\nimport getPeerId from '../../lib/appManagers/utils/peers/getPeerId';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport rootScope from '../../lib/rootScope';\nimport ButtonMenu, {ButtonMenuItemOptions} from '../buttonMenu';\nimport confirmationPopup from '../confirmationPopup';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport Scrollable from '../scrollable';\nimport GroupCallParticipantsList from './participantsList';\nimport GroupCallParticipantsVideoElement from './participantVideos';\n\nexport class GroupCallParticipantContextMenu {\n  private buttons: (ButtonMenuItemOptions & {verify: (peerId: PeerId) => boolean | Promise<boolean>})[];\n  private element: HTMLDivElement;\n  private chatId: ChatId;\n  private targetPeerId: PeerId;\n  private participant: GroupCallParticipant;\n  private instance: GroupCallInstance;\n  private canManageCall: boolean;\n  private managers: AppManagers;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    onContextElement: HTMLElement,\n    managers: AppManagers,\n    instance: GroupCallInstance,\n  }) {\n    this.buttons = [{\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MutePeer',\n      verify: () => this.canManageCall && this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmutePeer',\n      verify: () => this.canManageCall && !this.participant.pFlags.can_self_unmute,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'gc_microphoneoff',\n      text: 'VoiceChat.MuteForMe',\n      verify: () => !this.canManageCall && !this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(true)\n    }, {\n      icon: 'gc_microphone',\n      text: 'VoiceChat.UnmuteForMe',\n      verify: () => !this.canManageCall && this.participant.pFlags.muted_by_you,\n      onClick: () => this.toggleParticipantMuted(false)\n    }, {\n      icon: 'newprivate',\n      text: 'VoiceChat.OpenProfile',\n      verify: () => true,\n      onClick: this.onOpenProfileClick\n    }, {\n      icon: 'deleteuser danger',\n      text: 'VoiceChat.RemovePeer',\n      verify: () => this.managers.appChatsManager.hasRights(this.chatId, 'ban_users'),\n      onClick: async() => {\n        confirmationPopup({\n          peerId: this.targetPeerId,\n          title: new PeerTitle({peerId: this.targetPeerId}).element,\n          descriptionLangKey: await this.managers.appChatsManager.isBroadcast(this.chatId) ? 'VoiceChat.RemovePeer.Confirm.Channel' : 'VoiceChat.RemovePeer.Confirm',\n          descriptionLangArgs: [new PeerTitle({peerId: this.targetPeerId}).element],\n          button: {\n            langKey: 'VoiceChat.RemovePeer.Confirm.OK',\n            isDanger: true\n          }\n        }).then(() => {\n          this.managers.appChatsManager.kickFromChat(this.chatId, this.targetPeerId);\n        }, noop);\n      }\n    }];\n\n    const {listenerSetter} = options;\n    this.managers = options.managers;\n    this.instance = options.instance;\n    this.chatId = this.instance.chatId;\n\n    this.element = ButtonMenu(this.buttons, listenerSetter);\n    this.element.classList.add('group-call-participant-menu', 'night');\n\n    attachContextMenuListener(options.onContextElement, async(e: any) => {\n      const li = findUpClassName(e.target, 'group-call-participant');\n      if(!li) {\n        return;\n      }\n\n      if(this.element.parentElement !== appendTo) {\n        appendTo.append(this.element);\n      }\n\n      cancelEvent(e);\n\n      const peerId = this.targetPeerId = li.dataset.peerId.toPeerId();\n      this.participant = await this.instance.getParticipantByPeerId(peerId);\n      if(this.participant.pFlags.self) {\n        return;\n      }\n\n      this.canManageCall = await this.managers.appChatsManager.hasRights(this.chatId, 'manage_call');\n\n      await filterAsync(this.buttons, async(button) => {\n        const good = await button.verify(peerId);\n        button.element.classList.toggle('hide', !good);\n        return good;\n      });\n\n      positionMenu((e as TouchEvent).touches ? (e as TouchEvent).touches[0] : e as MouseEvent, this.element, 'right');\n      contextMenuController.openBtnMenu(this.element);\n    }, listenerSetter);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        const peerId = getPeerId(participant.peer);\n        if(this.targetPeerId === peerId) {\n          contextMenuController.close();\n        }\n      }\n    });\n\n    let appendTo: HTMLElement = document.body;\n    addFullScreenListener(document.body, () => {\n      const isFull = isFullScreen();\n      appendTo = isFull ? PopupElement.getPopups(PopupGroupCall)[0].getContainer(): document.body;\n\n      if(!isFull) {\n        contextMenuController.close();\n      }\n    }, listenerSetter);\n  }\n\n  private onOpenProfileClick = () => {\n    const popup = PopupElement.getPopups(PopupGroupCall)[0];\n    if(popup) {\n      popup.hide();\n    }\n\n    appImManager.setInnerPeer({peerId: this.targetPeerId});\n  };\n\n  private toggleParticipantMuted = (muted: boolean) => {\n    this.instance.editParticipant(this.participant, {\n      muted\n    });\n  };\n};\n\nexport default class GroupCallParticipantsElement {\n  private container: HTMLDivElement;\n  private sortedList: GroupCallParticipantsList;\n  private instance: GroupCallInstance;\n  private listenerSetter: ListenerSetter;\n  private groupCallParticipantsVideo: GroupCallParticipantsVideoElement;\n  private contextMenu: GroupCallParticipantContextMenu;\n  private managers: AppManagers;\n\n  constructor(options: {\n    appendTo: HTMLElement,\n    instance: GroupCallInstance,\n    listenerSetter: ListenerSetter,\n    managers: AppManagers\n  }) {\n    safeAssign(this, options);\n\n    const className = 'group-call-participants';\n\n    const scrollable = new Scrollable(undefined);\n    scrollable.container.classList.add(className + '-scrollable');\n\n    const container = this.container = document.createElement('div');\n    container.classList.add(className);\n\n    // const invite = Button(`btn-primary btn-transparent ${className}-invite`, {icon: 'adduser', text: 'VoiceChat.Invite.InviteMembers'});\n\n    const sortedList = this.sortedList = new GroupCallParticipantsList(this.instance);\n\n    const {instance, listenerSetter} = this;\n    this.contextMenu = new GroupCallParticipantContextMenu({\n      ...options,\n      onContextElement: sortedList.list,\n      listenerSetter,\n      instance\n    });\n\n    this.groupCallParticipantsVideo = new GroupCallParticipantsVideoElement({\n      ...options,\n      appendTo: scrollable.container,\n      displayPinned: false\n    });\n\n    scrollable.append(/* invite,  */sortedList.list);\n    container.append(scrollable.container);\n\n    options.appendTo.append(container);\n\n    listenerSetter.add(rootScope)('group_call_participant', ({groupCallId, participant}) => {\n      if(this.instance.id === groupCallId) {\n        this.updateParticipant(participant);\n      }\n    });\n\n    const scrollableLoader = new ScrollableLoader({\n      scrollable,\n      getPromise: () => {\n        return this.managers.appGroupCallsManager.getGroupCallParticipants(this.instance.id).then(({participants, isEnd}) => {\n          participants.forEach((participant) => {\n            this.updateParticipant(participant);\n          });\n\n          return isEnd;\n        });\n      }\n    });\n\n    this.setInstance(instance);\n  }\n\n  private updateParticipant(participant: GroupCallParticipant) {\n    const peerId = getPeerId(participant.peer);\n    const has = this.sortedList.has(peerId);\n    if(participant.pFlags.left) {\n      if(has) {\n        this.sortedList.delete(peerId);\n      }\n\n      return;\n    }\n\n    if(!has) {\n      this.sortedList.add(peerId);\n      return;\n    }\n\n    this.sortedList.update(peerId);\n  }\n\n  public async setInstance(instance: GroupCallInstance) {\n    // @ts-ignore\n    /* const users = appUsersManager.users;\n    for(const userId in users) {\n      const participant: GroupCallParticipant = {\n        _: 'groupCallParticipant',\n        date: 0,\n        peer: {_: 'peerUser', user_id: userId.toPeerId()},\n        pFlags: {\n          muted: true\n        },\n        source: 1\n      };\n\n      instance.participants.set(userId.toPeerId(), participant);\n      this.updateParticipant(participant);\n    } */\n    const participants = await instance.participants;\n    participants.forEach((participant) => {\n      this.updateParticipant(participant);\n    });\n  }\n\n  public destroy() {\n    this.sortedList.destroy();\n    this.groupCallParticipantsVideo.destroy();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport GROUP_CALL_STATE from '../../lib/calls/groupCallState';\nimport I18n, {LangPackKey, FormatterArguments} from '../../lib/langPack';\n\nexport default class GroupCallDescriptionElement {\n  private descriptionIntl: I18n.IntlElement;\n\n  constructor(private appendTo: HTMLElement) {\n    this.descriptionIntl = new I18n.IntlElement({\n      key: 'VoiceChat.Status.Connecting'\n    });\n\n    this.descriptionIntl.element.classList.add('group-call-description');\n  }\n\n  public detach() {\n    this.descriptionIntl.element.remove();\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {state} = instance;\n\n    let key: LangPackKey, args: FormatterArguments;\n    if(state === GROUP_CALL_STATE.CONNECTING) {\n      key = 'VoiceChat.Status.Connecting';\n    } else {\n      key = 'VoiceChat.Status.Members';\n      args = [(instance.groupCall as GroupCall.groupCall).participants_count];\n    }\n\n    const {descriptionIntl} = this;\n    descriptionIntl.compareAndUpdate({\n      key,\n      args\n    });\n\n    if(!this.descriptionIntl.element.parentElement) {\n      this.appendTo.append(this.descriptionIntl.element);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport setInnerHTML from '../../helpers/dom/setInnerHTML';\nimport {GroupCall} from '../../layer';\nimport GroupCallInstance from '../../lib/calls/groupCallInstance';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport PeerTitle from '../peerTitle';\n\nexport default class GroupCallTitleElement {\n  private peerTitle: PeerTitle;\n\n  constructor(private appendTo: HTMLElement) {\n    this.peerTitle = new PeerTitle({peerId: 0});\n  }\n\n  public update(instance: GroupCallInstance) {\n    const {peerTitle, appendTo} = this;\n    const groupCall = instance.groupCall as GroupCall.groupCall;\n    const peerId = instance.chatId.toPeerId(true);\n    if(groupCall.title) {\n      setInnerHTML(appendTo, wrapEmojiText(groupCall.title));\n    } else {\n      if(peerTitle.peerId !== peerId) {\n        peerTitle.peerId = peerId;\n        peerTitle.update();\n      }\n\n      if(peerTitle.element.parentElement !== appendTo) {\n        appendTo.append(peerTitle.element);\n      }\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport {i18n, LangPackKey} from '../../lib/langPack';\nimport ripple from '../ripple';\n\nexport default function makeButton(className: string, listenerSetter: ListenerSetter, options: {\n  text?: LangPackKey | HTMLElement,\n  isDanger?: boolean,\n  noRipple?: boolean,\n  callback?: () => void,\n  icon?: string,\n  isConfirm?: boolean,\n}) {\n  const _className = className + '-button';\n  const buttonDiv = document.createElement('div');\n  buttonDiv.classList.add(_className, 'call-button', 'rp-overflow');\n\n  if(options.icon) {\n    buttonDiv.classList.add('tgico-' + options.icon);\n  }\n\n  if(!options.noRipple) {\n    ripple(buttonDiv);\n  }\n\n  if(options.isDanger) {\n    buttonDiv.classList.add(_className + '-red');\n  }\n\n  if(options.isConfirm) {\n    buttonDiv.classList.add(_className + '-green');\n  }\n\n  if(options.callback) {\n    attachClickEvent(buttonDiv, options.callback, {listenerSetter});\n  }\n\n  let ret = buttonDiv;\n  if(options.text) {\n    const div = document.createElement('div');\n    div.classList.add(_className + '-container', 'call-button-container');\n\n    const textEl = typeof(options.text) === 'string' ? i18n(options.text) : options.text;\n    textEl.classList.add(_className + '-text', 'call-button-text');\n\n    div.append(buttonDiv, textEl);\n\n    ret = div;\n  }\n\n  return ret;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport findUpClassName from '../helpers/dom/findUpClassName';\nimport EventListenerBase from '../helpers/eventListenerBase';\nimport mediaSizes from '../helpers/mediaSizes';\nimport clamp from '../helpers/number/clamp';\nimport safeAssign from '../helpers/object/safeAssign';\nimport windowSize from '../helpers/windowSize';\nimport SwipeHandler from './swipeHandler';\n\ntype ResizeSide = 'n' | 'e' | 's' | 'w' | 'ne' | 'se' | 'sw' | 'nw';\nexport type MovableState = {\n  top?: number;\n  left?: number;\n  width: number;\n  height: number;\n};\n\nconst className = 'movable-element';\nconst resizeHandlerClassName = className + '-resize-handler';\n\nexport type MovableElementOptions = {\n  minWidth: MovableElement['minWidth'],\n  minHeight: MovableElement['minHeight'],\n  element: MovableElement['element'],\n  verifyTouchTarget?: MovableElement['verifyTouchTarget']\n};\n\nexport default class MovableElement extends EventListenerBase<{\n  resize: () => void\n}> {\n  private minWidth: number;\n  private minHeight: number;\n  private element: HTMLElement;\n  private verifyTouchTarget: (e: TouchEvent | MouseEvent) => boolean;\n\n  private top: number;\n  private left: number;\n  private _width: number;\n  private _height: number;\n\n  private swipeHandler: SwipeHandler;\n  private handlers: HTMLElement[];\n\n  constructor(options: MovableElementOptions) {\n    super(true);\n    safeAssign(this, options);\n\n    this.top = this.left = this.width = this.height = 0;\n    this.element.classList.add(className);\n\n    this.addResizeHandlers();\n    this.setSwipeHandler();\n\n    mediaSizes.addEventListener('resize', this.onResize);\n  }\n\n  private onResize = () => {\n    this.fixDimensions();\n    this.fixPosition();\n    this.setPosition();\n  };\n\n  public destroyElements() {\n    this.element.classList.remove(className);\n\n    if(this.handlers) {\n      this.handlers.forEach((handler) => {\n        handler.remove();\n      });\n    }\n  }\n\n  public destroy() {\n    mediaSizes.removeEventListener('resize', this.onResize);\n    this.swipeHandler.removeListeners();\n  }\n\n  private addResizeHandlers() {\n    const sides: ResizeSide[] = ['n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'];\n    this.handlers = sides.map((side) => {\n      const div = document.createElement('div');\n      div.dataset.side = side;\n      div.classList.add(resizeHandlerClassName, resizeHandlerClassName + '-side-' + side);\n      this.element.append(div);\n      return div;\n    });\n  }\n\n  private setSwipeHandler() {\n    let startTop: number, startLeft: number, startWidth: number, startHeight: number, resizingSide: ResizeSide;\n    const swipeHandler = this.swipeHandler = new SwipeHandler({\n      element: this.element,\n      onSwipe: (xDiff, yDiff, e) => {\n        xDiff *= -1; // to right will be positive\n        yDiff *= -1; // to bottom will be positive\n        // console.log(xDiff, yDiff, e);\n\n        if(resizingSide) {\n          if(resizingSide.includes('e') || resizingSide.includes('w')) {\n            const isEnlarging = resizingSide.includes('e') && xDiff > 0 || resizingSide.includes('w') && xDiff < 0;\n            const resizeDiff = Math.abs(xDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('e') ? windowSize.width - startLeft : startWidth + startLeft;\n            this.width = Math.min(maxPossible, startWidth + resizeDiff);\n          }\n\n          if(resizingSide.includes('n') || resizingSide.includes('s')) {\n            const isEnlarging = resizingSide.includes('s') && yDiff > 0 || resizingSide.includes('n') && yDiff < 0;\n            const resizeDiff = Math.abs(yDiff) * (isEnlarging ? 1 : -1);\n\n            const maxPossible = resizingSide.includes('s') ? windowSize.height - startTop : startHeight + startTop;\n            this.height = Math.min(maxPossible, startHeight + resizeDiff);\n          }\n\n          this.fixDimensions();\n\n          if(resizingSide.includes('w')) {\n            this.left = Math.min(startLeft + startWidth - this.minWidth, startLeft + xDiff);\n          }\n\n          if(resizingSide.includes('n')) {\n            this.top = Math.min(startTop + startHeight - this.minHeight, startTop + yDiff);\n          }\n        } else {\n          this.top = startTop + yDiff;\n          this.left = startLeft + xDiff;\n        }\n\n        this.fixPosition();\n        this.setPosition();\n      },\n      verifyTouchTarget: (e) => {\n        const target = e.target;\n        if(this.verifyTouchTarget && !this.verifyTouchTarget(e)) {\n          return false;\n        }\n\n        const resizeHandler = findUpClassName(target, resizeHandlerClassName);\n        if(resizeHandler) {\n          resizingSide = resizeHandler.dataset.side as ResizeSide;\n          swipeHandler.setCursor('');\n        } else {\n          resizingSide = undefined;\n          swipeHandler.setCursor('grabbing');\n        }\n\n        return true;\n      },\n      onFirstSwipe: () => {\n        startTop = this.top;\n        startLeft = this.left;\n        startWidth = this.width;\n        startHeight = this.height;\n      }\n    });\n  }\n\n  public setPositionToCenter() {\n    this.top = (windowSize.height / 2) - (this.height / 2);\n    this.left = (windowSize.width / 2) - (this.width / 2);\n    this.setPosition();\n  }\n\n  private fixDimensions() {\n    this.width = clamp(this.width, this.minWidth, windowSize.width);\n    this.height = clamp(this.height, this.minHeight, windowSize.height);\n  }\n\n  private fixPosition() {\n    this.top = clamp(this.top, 0, windowSize.height - this.height);\n    this.left = clamp(this.left, 0, windowSize.width - this.width);\n  }\n\n  private setPosition() {\n    this.element.style.top = this.top + 'px';\n    this.element.style.left = this.left + 'px';\n    this.element.style.right = 'auto';\n    this.element.style.bottom = 'auto';\n    this.element.style.width = this.width + 'px';\n    this.element.style.height = this.height + 'px';\n\n    this.dispatchEvent('resize');\n  }\n\n  public get width() {\n    return this._width;\n  }\n\n  public get height() {\n    return this._height;\n  }\n\n  private set width(value: number) {\n    this._width = value;\n  }\n\n  private set height(value: number) {\n    this._height = value;\n  }\n\n  public get state(): MovableState {\n    const {top, left, width, height} = this;\n    return {\n      top,\n      left,\n      width,\n      height\n    };\n  }\n\n  public set state(state: MovableState) {\n    const {top, left, width, height} = state;\n    this.top = top;\n    this.left = left;\n    this.width = width;\n    this.height = height;\n    this.onResize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport MovableElement, {MovableElementOptions, MovableState} from '../components/movableElement';\nimport IS_TOUCH_SUPPORTED from '../environment/touchSupport';\nimport ListenerSetter from './listenerSetter';\nimport mediaSizes, {ScreenSize} from './mediaSizes';\nimport safeAssign from './object/safeAssign';\n\nexport default class MovablePanel {\n  #movable: MovableElement;\n  private listenerSetter: ListenerSetter;\n  private previousState: MovableState;\n  private onResize: () => void;\n  private movableOptions: MovableElementOptions;\n\n  constructor(options: {\n    listenerSetter: ListenerSetter,\n    previousState: MovableState,\n    onResize?: () => void,\n    movableOptions: MovableElementOptions\n  }) {\n    safeAssign(this, options);\n\n    this.toggleMovable(!IS_TOUCH_SUPPORTED);\n\n    this.listenerSetter.add(mediaSizes)('changeScreen', (from, to) => {\n      if(to === ScreenSize.mobile || from === ScreenSize.mobile) {\n        this.toggleMovable(!IS_TOUCH_SUPPORTED);\n      }\n    });\n  }\n\n  public destroy() {\n    const movable = this.movable;\n    if(movable) {\n      movable.destroy();\n    }\n  }\n\n  public get movable() {\n    return this.#movable;\n  }\n\n  public get state() {\n    return this.movable ? this.movable.state : this.previousState;\n  }\n\n  public set state(state: MovableState) {\n    this.previousState = state;\n  }\n\n  private toggleMovable(enabled: boolean) {\n    let {movable} = this;\n    if(enabled) {\n      if(movable) {\n        return;\n      }\n\n      movable = this.#movable = new MovableElement(this.movableOptions);\n\n      movable.state = this.previousState;\n      if(this.previousState.top === undefined) {\n        movable.setPositionToCenter();\n      }\n\n      if(this.onResize) {\n        this.listenerSetter.add(movable)('resize', this.onResize);\n      }\n    } else {\n      if(!movable) {\n        return;\n      }\n\n      this.previousState = movable.state;\n      movable.destroyElements();\n      movable.destroy();\n      this.#movable = undefined;\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function toggleClassName(className: string, elements: HTMLElement[], disable: boolean) {\n  elements.forEach((element) => {\n    element.classList.toggle(className, disable);\n  });\n\n  return () => toggleClassName(className, elements, !disable);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport toHHMMSS from '../../helpers/string/toHHMMSS';\nimport CALL_STATE from '../../lib/calls/callState';\nimport {i18n, LangPackKey} from '../../lib/langPack';\n\nexport default class CallDescriptionElement {\n  private container: HTMLElement;\n  private state: CALL_STATE;\n  private interval: number;\n\n  constructor(private appendTo: HTMLElement) {\n    this.container = document.createElement('div');\n    this.container.classList.add('call-description');\n  }\n\n  public detach() {\n    if(this.interval !== undefined) {\n      clearInterval(this.interval);\n      this.interval = undefined;\n    }\n\n    this.container.remove();\n    this.state = undefined;\n  }\n\n  public update(instance: any) {\n    const {connectionState} = instance;\n\n    if(this.state === connectionState) {\n      return;\n    }\n\n    this.state = connectionState;\n\n    let element: HTMLElement;\n    if(connectionState === CALL_STATE.CONNECTED) {\n      element = document.createElement('span');\n      element.classList.add('call-description-duration');\n\n      const setTime = () => {\n        element.innerText = toHHMMSS(instance.duration, true);\n      };\n\n      this.interval = window.setInterval(setTime, 1000);\n      setTime();\n    } else {\n      let langPackKey: LangPackKey;\n      switch(connectionState) {\n        case CALL_STATE.PENDING:\n          langPackKey = instance.isOutgoing ? 'Call.StatusRinging' : 'Call.StatusCalling';\n          break;\n        case CALL_STATE.REQUESTING:\n          langPackKey = 'Call.StatusRequesting';\n          break;\n        case CALL_STATE.EXCHANGING_KEYS:\n          langPackKey = 'VoipExchangingKeys';\n          break;\n        case CALL_STATE.CLOSED:\n          langPackKey = instance.connectedAt !== undefined ? 'Call.StatusEnded' : 'Call.StatusFailed';\n          break;\n        default:\n          langPackKey = 'Call.StatusConnecting';\n          break;\n      }\n\n      element = i18n(langPackKey);\n      if(this.interval !== undefined) {\n        clearInterval(this.interval);\n        this.interval = undefined;\n      }\n    }\n\n    this.container.classList.toggle('has-duration', connectionState === CALL_STATE.CONNECTED);\n    replaceContent(this.container, element);\n\n    if(!this.container.parentElement) {\n      this.appendTo.append(this.container);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {SuperRLottieIcon} from '../superIcon';\n\nexport default class GroupCallMicrophoneIconMini extends SuperRLottieIcon<{\n  PartState: boolean,\n  ColorState: boolean,\n  Items: {\n    name: 'voice_mini'\n  }[]\n}> {\n  constructor(colored?: boolean, skipAnimation?: boolean) {\n    super({\n      width: 36,\n      height: 36,\n      getPart: (state) => {\n        return this.getItem().getPart(state ? 'unmute' : 'mute');\n      },\n      getColor: colored ? (state) => {\n        return state ? [255, 255, 255] : [158, 158, 158];\n      } : undefined,\n      skipAnimation\n    });\n\n    this.add({\n      name: 'voice_mini',\n      parts: [{\n        startFrame: 0,\n        endFrame: 35,\n        name: 'hand-to-muted'\n      }, {\n        startFrame: 36,\n        endFrame: 68,\n        name: 'unmute'\n      }, {\n        startFrame: 69,\n        endFrame: 98,\n        name: 'mute'\n      }, {\n        startFrame: 99,\n        endFrame: 135,\n        name: 'muted-to-hand'\n      }, {\n        startFrame: 136,\n        endFrame: 171,\n        name: 'unmuted-to-hand'\n      }]\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport IS_SCREEN_SHARING_SUPPORTED from '../../environment/screenSharingSupport';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport {attachClickEvent} from '../../helpers/dom/clickEvent';\nimport ControlsHover from '../../helpers/dom/controlsHover';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {addFullScreenListener, cancelFullScreen, isFullScreen, requestFullScreen} from '../../helpers/dom/fullScreen';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport MovablePanel from '../../helpers/movablePanel';\nimport onMediaLoad from '../../helpers/onMediaLoad';\nimport themeController from '../../helpers/themeController';\nimport toggleClassName from '../../helpers/toggleClassName';\nimport CallInstance from '../../lib/calls/callInstance';\nimport CALL_STATE from '../../lib/calls/callState';\nimport I18n, {i18n} from '../../lib/langPack';\nimport wrapEmojiText from '../../lib/richTextProcessor/wrapEmojiText';\nimport animationIntersector from '../animationIntersector';\nimport AvatarElement from '../avatar';\nimport ButtonIcon from '../buttonIcon';\nimport GroupCallMicrophoneIconMini from '../groupCall/microphoneIconMini';\nimport {MovableState} from '../movableElement';\nimport PeerTitle from '../peerTitle';\nimport PopupElement from '../popups';\nimport SetTransition from '../singleTransition';\nimport makeButton from './button';\nimport CallDescriptionElement from './description';\nimport callVideoCanvasBlur from './videoCanvasBlur';\n\nconst className = 'call';\n\nconst MIN_WIDTH = 400;\nconst MIN_HEIGHT = 580;\n\nconst INIT_STATE: MovableState = {\n  width: MIN_WIDTH,\n  height: MIN_HEIGHT\n};\n\nlet previousState: MovableState = {...INIT_STATE};\n\nexport default class PopupCall extends PopupElement {\n  private peerId: PeerId;\n\n  private description: CallDescriptionElement;\n  private emojisSubtitle: HTMLElement;\n\n  private partyStates: HTMLElement;\n  private partyMutedState: HTMLElement;\n\n  private firstButtonsRow: HTMLElement;\n  private secondButtonsRow: HTMLElement;\n\n  private declineI18nElement: I18n.IntlElement;\n\n  private makeButton: (options: Parameters<typeof makeButton>[2]) => HTMLElement;\n  private btnAccept: HTMLElement;\n  private btnDecline: HTMLElement;\n  private btnVideo: HTMLElement;\n  private btnScreen: HTMLElement;\n  private btnMute: HTMLElement;\n  private btnFullScreen: HTMLButtonElement;\n  private btnExitFullScreen: HTMLButtonElement;\n\n  private movablePanel: MovablePanel;\n  private microphoneIcon: GroupCallMicrophoneIconMini;\n  private muteI18nElement: I18n.IntlElement;\n\n  private videoContainers: {\n    input?: HTMLElement,\n    output?: HTMLElement\n  };\n\n  private controlsHover: ControlsHover;\n\n  constructor(private instance: CallInstance) {\n    super('popup-call', {\n      withoutOverlay: true,\n      closable: true\n    });\n\n    this.videoContainers = {};\n\n    const {container, listenerSetter} = this;\n    container.classList.add(className, 'night');\n\n    const avatarContainer = document.createElement('div');\n    avatarContainer.classList.add(className + '-avatar');\n\n    const peerId = this.peerId = this.instance.interlocutorUserId.toPeerId();\n    const avatar = new AvatarElement();\n    avatar.classList.add('avatar-full');\n    avatar.updateWithOptions({\n      isBig: true,\n      peerId: peerId\n    });\n    avatarContainer.append(avatar);\n\n    const title = new PeerTitle({\n      peerId\n    }).element;\n\n    title.classList.add(className + '-title');\n\n    const subtitle = document.createElement('div');\n    subtitle.classList.add(className + '-subtitle');\n\n    const description = this.description = new CallDescriptionElement(subtitle);\n\n    const emojisSubtitle = this.emojisSubtitle = document.createElement('div');\n    emojisSubtitle.classList.add(className + '-emojis');\n\n    container.append(avatarContainer, title, subtitle);\n\n    if(!IS_MOBILE) {\n      this.btnFullScreen = ButtonIcon('fullscreen');\n      this.btnExitFullScreen = ButtonIcon('smallscreen hide');\n      attachClickEvent(this.btnFullScreen, this.onFullScreenClick, {listenerSetter});\n      attachClickEvent(this.btnExitFullScreen, () => cancelFullScreen(), {listenerSetter});\n      addFullScreenListener(this.container, this.onFullScreenChange, listenerSetter);\n      this.header.prepend(this.btnExitFullScreen);\n      this.header.append(this.btnFullScreen);\n\n      container.append(emojisSubtitle);\n    } else {\n      this.header.append(emojisSubtitle);\n    }\n\n    this.partyStates = document.createElement('div');\n    this.partyStates.classList.add(className + '-party-states');\n\n    this.partyMutedState = document.createElement('div');\n    this.partyMutedState.classList.add(className + '-party-state');\n    const stateText = i18n('VoipUserMicrophoneIsOff', [new PeerTitle({peerId, onlyFirstName: true, limitSymbols: 18}).element]);\n    stateText.classList.add(className + '-party-state-text');\n    const mutedIcon = new GroupCallMicrophoneIconMini(false, true);\n    mutedIcon.setState(false, false);\n    this.partyMutedState.append(\n      mutedIcon.container,\n      stateText\n    );\n\n    this.partyStates.append(this.partyMutedState);\n    this.container.append(this.partyStates);\n\n    this.makeButton = makeButton.bind(null, className, this.listenerSetter);\n    this.constructFirstButtons();\n    this.constructSecondButtons();\n\n    listenerSetter.add(instance)('state', () => {\n      this.updateInstance();\n    });\n\n    listenerSetter.add(instance)('mediaState', () => {\n      this.updateInstance();\n    });\n\n    this.movablePanel = new MovablePanel({\n      listenerSetter,\n      movableOptions: {\n        minWidth: MIN_WIDTH,\n        minHeight: MIN_HEIGHT,\n        element: this.element,\n        verifyTouchTarget: (e) => {\n          const target = e.target;\n          if(findUpClassName(target, 'call-button') ||\n            findUpClassName(target, 'btn-icon') ||\n            isFullScreen()) {\n            return false;\n          }\n\n          return true;\n        }\n      },\n      // onResize: () => this.toggleBigLayout(),\n      previousState: !this.instance.wasTryingToJoin && !this.instance.isOutgoing ? {...INIT_STATE} : previousState\n    });\n\n    const movableElement = this.movablePanel.movable;\n    if(movableElement) {\n      this.listenerSetter.add(movableElement)('resize', () => {\n        this.resizeVideoContainers();\n      });\n    }\n\n    const controlsHover = this.controlsHover = new ControlsHover();\n    controlsHover.setup({\n      element: this.container,\n      listenerSetter: this.listenerSetter,\n      showOnLeaveToClassName: 'call-buttons'\n    });\n    controlsHover.showControls(false);\n\n    this.addEventListener('close', () => {\n      const {movablePanel} = this;\n      previousState = movablePanel.state;\n\n      this.microphoneIcon.destroy();\n\n      movablePanel.destroy();\n    });\n\n    this.updateInstance();\n  }\n\n  public getCallInstance() {\n    return this.instance;\n  }\n\n  private constructFirstButtons() {\n    const buttons = this.firstButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-first');\n\n    const toggleDisability = toggleClassName.bind(null, 'btn-disabled');\n\n    const btnVideo = this.btnVideo = this.makeButton({\n      text: 'Call.Camera',\n      icon: 'videocamera_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleVideoSharing().finally(toggle);\n      }\n    });\n\n    const btnScreen = this.btnScreen = this.makeButton({\n      text: 'Call.Screen',\n      icon: 'sharescreen_filled',\n      callback: () => {\n        const toggle = toggleDisability([btnVideo, btnScreen], true);\n        this.instance.toggleScreenSharing().finally(toggle);\n      }\n    });\n\n    if(!IS_SCREEN_SHARING_SUPPORTED) {\n      btnScreen.classList.add('hide');\n      this.container.classList.add('no-screen');\n    }\n\n    this.muteI18nElement = new I18n.IntlElement({\n      key: 'Call.Mute'\n    });\n    const btnMute = this.btnMute = this.makeButton({\n      text: this.muteI18nElement.element,\n      callback: () => {\n        this.instance.toggleMuted();\n      }\n    });\n\n    const microphoneIcon = this.microphoneIcon = new GroupCallMicrophoneIconMini(true, true);\n    btnMute.firstElementChild.append(microphoneIcon.container);\n\n    // btnVideo.classList.add('disabled');\n    // btnScreen.classList.add('disabled');\n\n    buttons.append(btnVideo, btnScreen, btnMute);\n    this.container.append(buttons);\n  }\n\n  private constructSecondButtons() {\n    const buttons = this.secondButtonsRow = document.createElement('div');\n    buttons.classList.add(className + '-buttons', 'is-second');\n\n    this.declineI18nElement = new I18n.IntlElement({\n      key: 'Call.Decline'\n    });\n    const btnDecline = this.btnDecline = this.makeButton({\n      text: this.declineI18nElement.element,\n      icon: 'endcall_filled',\n      callback: () => {\n        this.instance.hangUp('phoneCallDiscardReasonHangup');\n      },\n      isDanger: true\n    });\n\n    const btnAccept = this.btnAccept = this.makeButton({\n      text: 'Call.Accept',\n      icon: 'phone_filled',\n      callback: () => {\n        this.instance.acceptCall();\n      },\n      isConfirm: true\n    });\n\n    buttons.append(btnDecline, btnAccept);\n    this.container.append(buttons);\n  }\n\n  private onFullScreenClick = () => {\n    requestFullScreen(this.container);\n  };\n\n  private onFullScreenChange = () => {\n    const isFull = isFullScreen();\n\n    const {btnFullScreen, btnExitFullScreen} = this;\n\n    const wasFullScreen = this.container.classList.contains('is-full-screen');\n    this.container.classList.toggle('is-full-screen', isFull);\n    btnFullScreen && btnFullScreen.classList.toggle('hide', isFull);\n    btnExitFullScreen && btnExitFullScreen.classList.toggle('hide', !isFull);\n    this.btnClose.classList.toggle('hide', isFull);\n\n    if(isFull !== wasFullScreen) {\n      animationIntersector.checkAnimations(isFull);\n\n      themeController.setThemeColor(isFull ? '#000000' : undefined);\n\n      this.resizeVideoContainers();\n    }\n  };\n\n  private createVideoContainer(video: HTMLVideoElement) {\n    const _className = className + '-video';\n    const container = document.createElement('div');\n    container.classList.add(_className + '-container');\n\n    video.classList.add(_className);\n    if(video.paused) {\n      video.play();\n    }\n\n    attachClickEvent(container, () => {\n      if(!container.classList.contains('small')) {\n        return;\n      }\n\n      const big = Object.values(this.videoContainers).find((container) => !container.classList.contains('small'));\n      big.classList.add('small');\n      big.style.cssText = container.style.cssText;\n      container.classList.remove('small');\n      container.style.cssText = '';\n\n      this.resizeVideoContainers();\n    });\n\n    const canvas = callVideoCanvasBlur(video);\n    canvas.classList.add(_className + '-blur');\n\n    container.append(canvas, video);\n\n    return container;\n  }\n\n  private updateInstance() {\n    const {instance} = this;\n    const {connectionState} = instance;\n    if(connectionState === CALL_STATE.CLOSED) {\n      if(this.container.classList.contains('is-full-screen')) {\n        cancelFullScreen();\n      }\n\n      this.btnVideo.classList.add('disabled');\n\n      this.hide();\n      return;\n    }\n\n    const isPendingIncoming = !instance.isOutgoing && connectionState === CALL_STATE.PENDING;\n    this.declineI18nElement.compareAndUpdate({\n      key: connectionState === CALL_STATE.PENDING ? 'Call.Decline' : 'Call.End'\n    });\n    this.btnAccept.classList.toggle('disable', !isPendingIncoming);\n    this.btnAccept.classList.toggle('hide-me', !isPendingIncoming);\n    this.container.classList.toggle('two-button-rows', isPendingIncoming);\n\n    const isMuted = instance.isMuted;\n    const onFrame = () => {\n      this.btnMute.firstElementChild.classList.toggle('active', isMuted);\n    };\n\n    const player = this.microphoneIcon.getItem().player;\n    this.microphoneIcon.setState(!isMuted, !isMuted, onFrame);\n    if(!player) {\n      onFrame();\n    }\n\n    this.muteI18nElement.compareAndUpdate({\n      key: isMuted ? 'VoipUnmute' : 'Call.Mute'\n    });\n\n    const isSharingVideo = instance.isSharingVideo;\n    this.btnVideo.firstElementChild.classList.toggle('active', isSharingVideo);\n\n    const isSharingScreen = instance.isSharingScreen;\n    this.btnScreen.firstElementChild.classList.toggle('active', isSharingScreen);\n\n    const outputState = instance.getMediaState('output');\n\n    SetTransition(this.partyMutedState, 'is-visible', !!outputState?.muted, 300);\n\n    const containers = this.videoContainers;\n    const oldContainers = {...containers};\n    ['input' as const, 'output' as const].forEach((type) => {\n      const mediaState = instance.getMediaState(type);\n      const video = instance.getVideoElement(type) as HTMLVideoElement;\n\n      const hasFrame = !!(video && video.videoWidth && video.videoHeight);\n      if(video && !hasFrame && !video.dataset.hasPromise) {\n        video.dataset.hasPromise = '1';\n        // container.classList.add('hide');\n        onMediaLoad(video).then(() => {\n          delete video.dataset.hasPromise;\n          this.updateInstance();\n          // this.resizeVideoContainers();\n          // container.classList.remove('hide');\n        });\n      }\n\n      const isActive = !!video && hasFrame && !!(mediaState && (mediaState.videoState === 'active' || mediaState.screencastState === 'active'));\n      let videoContainer = containers[type];\n\n      if(isActive && video && !videoContainer) {\n        videoContainer = containers[type] = this.createVideoContainer(video);\n        this.container.append(videoContainer);\n      }\n\n      if(!isActive && videoContainer) {\n        videoContainer.remove();\n        delete containers[type];\n      }\n    });\n\n    {\n      const input = containers.input;\n      const output = containers.output;\n      if(Object.keys(oldContainers).length !== Object.keys(containers).length && input) {\n        input.classList.toggle('small', !!output);\n      }\n\n      if(output && !input) {\n        output.classList.remove('small');\n      }\n    }\n\n    this.resizeVideoContainers();\n\n    this.container.classList.toggle('no-video', !Object.keys(containers).length);\n\n    if(!this.emojisSubtitle.textContent && connectionState < CALL_STATE.EXCHANGING_KEYS) {\n      Promise.resolve(instance.getEmojisFingerprint()).then((emojis) => {\n        replaceContent(this.emojisSubtitle, wrapEmojiText(emojis.join('')));\n      });\n    }\n\n    this.setDescription();\n  }\n\n  private resizeVideoContainers() {\n    Object.values(this.videoContainers).forEach((container) => {\n      const isSmall = container.classList.contains('small');\n      if(isSmall) {\n        const video = container.querySelector('video');\n        const popupWidth = this.movablePanel.state;\n        const MAX_WIDTH_PX = 240;\n        const MAX_HEIGHT_PX = 240;\n\n        const isVertical = video.videoHeight > video.videoWidth;\n        const MAX_SIZE = isVertical ? MAX_HEIGHT_PX : MAX_WIDTH_PX;\n\n        const biggestSideSize = 1 / 3 * (isFullScreen() ? 0xFFFF : (isVertical ? popupWidth.height : popupWidth.width));\n        const widthRatio = isVertical ? video.videoWidth / video.videoHeight : 1;\n        const heightRatio = isVertical ? 1 : video.videoHeight / video.videoWidth;\n        container.style.width = biggestSideSize * widthRatio + 'px';\n        container.style.height = biggestSideSize * heightRatio + 'px';\n        container.style.maxWidth = MAX_SIZE * widthRatio + 'px';\n        container.style.maxHeight = MAX_SIZE * heightRatio + 'px';\n      } else {\n        container.style.cssText = '';\n      }\n    });\n  }\n\n  private setDescription() {\n    this.description.update(this.instance);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport cancelEvent from '../helpers/dom/cancelEvent';\nimport {attachClickEvent} from '../helpers/dom/clickEvent';\nimport ListenerSetter from '../helpers/listenerSetter';\nimport GROUP_CALL_STATE from '../lib/calls/groupCallState';\nimport rootScope from '../lib/rootScope';\nimport ButtonIcon from './buttonIcon';\nimport TopbarWeave from './topbarWeave';\nimport SetTransition from './singleTransition';\nimport PopupGroupCall from './groupCall';\nimport GroupCallDescriptionElement from './groupCall/description';\nimport GroupCallTitleElement from './groupCall/title';\nimport PopupElement from './popups';\nimport throttle from '../helpers/schedulers/throttle';\nimport GroupCallInstance from '../lib/calls/groupCallInstance';\nimport CALL_STATE from '../lib/calls/callState';\nimport replaceContent from '../helpers/dom/replaceContent';\nimport PeerTitle from './peerTitle';\nimport CallDescriptionElement from './call/description';\nimport PopupCall from './call';\nimport GroupCallMicrophoneIconMini from './groupCall/microphoneIconMini';\nimport CallInstance from '../lib/calls/callInstance';\nimport {AppManagers} from '../lib/appManagers/managers';\nimport groupCallsController from '../lib/calls/groupCallsController';\nimport StreamManager from '../lib/calls/streamManager';\nimport callsController from '../lib/calls/callsController';\n\nfunction convertCallStateToGroupState(state: CALL_STATE, isMuted: boolean) {\n  switch(state) {\n    case CALL_STATE.CLOSING:\n    case CALL_STATE.CLOSED:\n      return GROUP_CALL_STATE.CLOSED;\n    case CALL_STATE.CONNECTED:\n      return isMuted ? GROUP_CALL_STATE.MUTED : GROUP_CALL_STATE.UNMUTED;\n    default:\n      return GROUP_CALL_STATE.CONNECTING;\n  }\n}\n\nconst CLASS_NAME = 'topbar-call';\n\nexport default class TopbarCall {\n  public container: HTMLElement;\n  private listenerSetter: ListenerSetter;\n  private weave: TopbarWeave;\n  private center: HTMLDivElement;\n  private groupCallTitle: GroupCallTitleElement;\n  private groupCallDescription: GroupCallDescriptionElement;\n  private groupCallMicrophoneIconMini: GroupCallMicrophoneIconMini;\n  private callDescription: CallDescriptionElement;\n\n  private currentDescription: GroupCallDescriptionElement | CallDescriptionElement;\n\n  private instance: GroupCallInstance | any/* CallInstance */;\n  private instanceListenerSetter: ListenerSetter;\n\n  constructor(\n    private managers: AppManagers\n  ) {\n    const listenerSetter = this.listenerSetter = new ListenerSetter();\n\n    listenerSetter.add(callsController)('instance', ({instance}) => {\n      if(!this.instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(callsController)('accepting', (instance) => {\n      if(this.instance !== instance) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(groupCallsController)('instance', (instance) => {\n      this.updateInstance(instance);\n    });\n\n    listenerSetter.add(rootScope)('group_call_update', (groupCall) => {\n      const instance = groupCallsController.groupCall;\n      if(instance?.id === groupCall.id) {\n        this.updateInstance(instance);\n      }\n    });\n\n    listenerSetter.add(StreamManager.ANALYSER_LISTENER)('amplitude', ({amplitudes, type}) => {\n      const {weave} = this;\n      if(!amplitudes.length || !weave/*  || type !== 'input' */) return;\n\n      let max = 0;\n      for(let i = 0; i < amplitudes.length; ++i) {\n        const {type, value} = amplitudes[i];\n        max = value > max ? value : max;\n      }\n\n      weave.setAmplitude(max);\n    });\n  }\n\n  private onState = () => {\n    this.updateInstance(this.instance);\n  };\n\n  private clearCurrentInstance() {\n    if(!this.instance) return;\n    this.center.textContent = '';\n\n    if(this.currentDescription) {\n      this.currentDescription.detach();\n      this.currentDescription = undefined;\n    }\n\n    this.instance = undefined;\n    this.instanceListenerSetter.removeAll();\n  }\n\n  private updateInstance(instance: TopbarCall['instance']) {\n    if(this.construct) {\n      this.construct();\n      this.construct = undefined;\n    }\n\n    const isChangingInstance = this.instance !== instance;\n    if(isChangingInstance) {\n      this.clearCurrentInstance();\n\n      this.instance = instance;\n      this.instanceListenerSetter = new ListenerSetter();\n\n      this.instanceListenerSetter.add(instance as GroupCallInstance)('state', this.onState);\n\n      if(instance instanceof GroupCallInstance) {\n        this.currentDescription = this.groupCallDescription;\n      } else {\n        this.currentDescription = this.callDescription;\n        this.instanceListenerSetter.add(instance)('muted', this.onState);\n      }\n\n      this.container.classList.toggle('is-call', !(instance instanceof GroupCallInstance));\n    }\n\n    const isMuted = this.instance.isMuted;\n    const state = instance instanceof GroupCallInstance ? instance.state : convertCallStateToGroupState(instance.connectionState, isMuted);\n\n    const {weave} = this;\n\n    weave.componentDidMount();\n\n    const isClosed = state === GROUP_CALL_STATE.CLOSED;\n    if((!document.body.classList.contains('is-calling') || isChangingInstance) || isClosed) {\n      if(isClosed) {\n        weave.setAmplitude(0);\n      }\n\n      SetTransition(document.body, 'is-calling', !isClosed, 250, isClosed ? () => {\n        weave.componentWillUnmount();\n\n        this.clearCurrentInstance();\n      }: undefined);\n    }\n\n    if(isClosed) {\n      return;\n    }\n\n    weave.setCurrentState(state, true);\n    // if(state === GROUP_CALL_STATE.CONNECTING) {\n    //   weave.setCurrentState(state, true);\n    // } else {\n    //   /* var a = 0;\n    //   animate(() => {\n    //     a += 0.1;\n    //     if(a > 1) a = 0;\n    //     weave.setAmplitude(a);\n    //     return true;\n    //   });\n    //   weave.setAmplitude(1); */\n    //   weave.setCurrentState(state, true);\n    // }\n\n    this.setTitle(instance);\n    this.setDescription(instance);\n    this.groupCallMicrophoneIconMini.setState(!isMuted);\n  }\n\n  private setDescription(instance: TopbarCall['instance']) {\n    return this.currentDescription.update(instance as any);\n  }\n\n  private setTitle(instance: TopbarCall['instance']) {\n    if(instance instanceof GroupCallInstance) {\n      return this.groupCallTitle.update(instance);\n    } else {\n      replaceContent(this.center, new PeerTitle({peerId: instance.interlocutorUserId.toPeerId()}).element);\n    }\n  }\n\n  private construct() {\n    const {listenerSetter} = this;\n    const container = this.container = document.createElement('div');\n    container.classList.add('sidebar-header', CLASS_NAME + '-container');\n\n    const left = document.createElement('div');\n    left.classList.add(CLASS_NAME + '-left');\n\n    const groupCallMicrophoneIconMini = this.groupCallMicrophoneIconMini = new GroupCallMicrophoneIconMini();\n\n    const mute = ButtonIcon();\n    mute.append(groupCallMicrophoneIconMini.container);\n    left.append(mute);\n\n    const throttledMuteClick = throttle(() => {\n      this.instance.toggleMuted();\n    }, 600, true);\n\n    attachClickEvent(mute, (e) => {\n      cancelEvent(e);\n      throttledMuteClick();\n    }, {listenerSetter});\n\n    const center = this.center = document.createElement('div');\n    center.classList.add(CLASS_NAME + '-center');\n\n    this.groupCallTitle = new GroupCallTitleElement(center);\n    this.groupCallDescription = new GroupCallDescriptionElement(left);\n\n    this.callDescription = new CallDescriptionElement(left);\n\n    const right = document.createElement('div');\n    right.classList.add(CLASS_NAME + '-right');\n\n    const end = ButtonIcon('endcall_filled');\n    right.append(end);\n\n    attachClickEvent(end, (e) => {\n      cancelEvent(e);\n\n      const {instance} = this;\n      if(!instance) {\n        return;\n      }\n\n      if(instance instanceof GroupCallInstance) {\n        instance.hangUp();\n      } else {\n        instance.hangUp('phoneCallDiscardReasonHangup');\n      }\n    }, {listenerSetter});\n\n    attachClickEvent(container, () => {\n      if(this.instance instanceof GroupCallInstance) {\n        if(PopupElement.getPopups(PopupGroupCall).length) {\n          return;\n        }\n\n        new PopupGroupCall().show();\n      } else if(this.instance instanceof CallInstance) {\n        const popups = PopupElement.getPopups(PopupCall);\n        if(popups.find((popup) => popup.getCallInstance() === this.instance)) {\n          return;\n        }\n\n        new PopupCall(this.instance).show();\n      }\n    }, {listenerSetter});\n\n    container.append(left, center, right);\n\n    const weave = this.weave = new TopbarWeave();\n    const weaveContainer = weave.render(CLASS_NAME + '-weave');\n    container.prepend(weaveContainer);\n\n    document.getElementById('column-center').prepend(container);\n    weave.componentDidMount();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getPeerTitle from '../../components/wrappers/getPeerTitle';\nimport wrapMessageForReply from '../../components/wrappers/messageForReply';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport {FontFamily} from '../../config/font';\nimport {IS_MOBILE} from '../../environment/userAgent';\nimport IS_VIBRATE_SUPPORTED from '../../environment/vibrateSupport';\nimport deferredPromise, {CancellablePromise} from '../../helpers/cancellablePromise';\nimport idleController from '../../helpers/idleController';\nimport deepEqual from '../../helpers/object/deepEqual';\nimport tsNow from '../../helpers/tsNow';\nimport {Message, MessagePeerReaction, PeerNotifySettings} from '../../layer';\nimport I18n, {FormatterArguments, LangPackKey} from '../langPack';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport singleInstance from '../mtproto/singleInstance';\nimport webPushApiManager, {PushSubscriptionNotify} from '../mtproto/webPushApiManager';\nimport fixEmoji from '../richTextProcessor/fixEmoji';\nimport wrapPlainText from '../richTextProcessor/wrapPlainText';\nimport rootScope from '../rootScope';\nimport appImManager from './appImManager';\nimport appRuntimeManager from './appRuntimeManager';\nimport {AppManagers} from './managers';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getPeerId from './utils/peers/getPeerId';\n\ntype MyNotification = Notification & {\n  hidden?: boolean,\n  show?: () => void,\n};\n\nexport type NotifyOptions = Partial<{\n  tag: string;\n  image: string;\n  key: string;\n  title: string;\n  message: string;\n  silent: boolean;\n  onclick: () => void;\n  noIncrement: boolean;\n}>;\n\nexport type NotificationSettings = {\n  nodesktop: boolean,\n  volume: number,\n  novibrate: boolean,\n  nopreview: boolean,\n  nopush: boolean,\n  nosound: boolean\n};\n\nexport class UiNotificationsManager {\n  private notificationsUiSupport: boolean;\n  private notificationsShown: {[key: string]: MyNotification | true} = {};\n  private notificationIndex = 0;\n  private notificationsCount = 0;\n  private soundsPlayed: {[tag: string]: number} = {};\n  private vibrateSupport = IS_VIBRATE_SUPPORTED;\n  private nextSoundAt: number;\n  private prevSoundVolume: number;\n\n  private faviconEl: HTMLLinkElement = document.head.querySelector('link[rel=\"icon\"]');\n\n  private titleBackup = document.title;\n  private titleChanged = false;\n  private titleInterval: number;\n  private prevFavicon: string;\n\n  private notifySoundEl: HTMLElement;\n\n  private stopped = false;\n\n  private topMessagesDeferred: CancellablePromise<void>;\n\n  private settings: NotificationSettings = {} as any;\n\n  private registeredDevice: any;\n  private pushInited = false;\n\n  private managers: AppManagers;\n  private setAppBadge: (contents?: any) => Promise<void>;\n\n  construct(managers: AppManagers) {\n    this.managers = managers;\n\n    navigator.vibrate = navigator.vibrate || (navigator as any).mozVibrate || (navigator as any).webkitVibrate;\n    this.setAppBadge = (navigator as any).setAppBadge && (navigator as any).setAppBadge.bind(navigator);\n    this.setAppBadge && this.setAppBadge(0);\n\n    this.notificationsUiSupport = ('Notification' in window) || ('mozNotification' in navigator);\n\n    this.notifySoundEl = document.createElement('div');\n    this.notifySoundEl.id = 'notify-sound';\n    document.body.append(this.notifySoundEl);\n\n    this.topMessagesDeferred = deferredPromise<void>();\n\n    singleInstance.addEventListener('deactivated', () => {\n      this.stop();\n    });\n\n    singleInstance.addEventListener('activated', () => {\n      if(this.stopped) {\n        this.start();\n      }\n    });\n\n    idleController.addEventListener('change', (idle) => {\n      if(this.stopped) {\n        return;\n      }\n\n      if(!idle) {\n        this.clear();\n      }\n\n      this.toggleToggler();\n    });\n\n    rootScope.addEventListener('notification_reset', (peerString) => {\n      this.soundReset(peerString);\n    });\n\n    rootScope.addEventListener('notification_cancel', (str) => {\n      this.cancel(str);\n    });\n\n    if(this.setAppBadge) {\n      rootScope.addEventListener('folder_unread', (folder) => {\n        if(folder.id === 0) {\n          this.setAppBadge(folder.unreadUnmutedPeerIds.size);\n        }\n      });\n    }\n\n    webPushApiManager.addEventListener('push_init', (tokenData) => {\n      this.pushInited = true;\n      if(!this.settings.nodesktop && !this.settings.nopush) {\n        if(tokenData) {\n          this.registerDevice(tokenData);\n        } else {\n          webPushApiManager.subscribe();\n        }\n      } else {\n        this.unregisterDevice(tokenData);\n      }\n    });\n    webPushApiManager.addEventListener('push_subscribe', (tokenData) => {\n      this.registerDevice(tokenData);\n    });\n    webPushApiManager.addEventListener('push_unsubscribe', (tokenData) => {\n      this.unregisterDevice(tokenData);\n    });\n\n    rootScope.addEventListener('dialogs_multiupdate', () => {\n      // unregisterTopMsgs()\n      this.topMessagesDeferred.resolve();\n    }, {once: true});\n\n    webPushApiManager.addEventListener('push_notification_click', (notificationData) => {\n      if(notificationData.action === 'push_settings') {\n        /* this.topMessagesDeferred.then(() => {\n          $modal.open({\n            templateUrl: templateUrl('settings_modal'),\n            controller: 'SettingsModalController',\n            windowClass: 'settings_modal_window mobile_modal',\n            backdrop: 'single'\n          })\n        }); */\n        return;\n      }\n\n      if(notificationData.action === 'mute1d') {\n        this.managers.apiManager.invokeApi('account.updateDeviceLocked', {\n          period: 86400\n        }).then(() => {\n          // var toastData = toaster.pop({\n          //   type: 'info',\n          //   body: _('push_action_mute1d_success'),\n          //   bodyOutputType: 'trustedHtml',\n          //   clickHandler: () => {\n          //     toaster.clear(toastData)\n          //   },\n          //   showCloseButton: false\n          // })\n        });\n\n        return;\n      }\n\n      const peerId = notificationData.custom && notificationData.custom.peerId.toPeerId();\n      console.log('click', notificationData, peerId);\n      if(peerId) {\n        this.topMessagesDeferred.then(async() => {\n          if(notificationData.custom.channel_id &&\n              !(await this.managers.appChatsManager.hasChat(notificationData.custom.channel_id))) {\n            return;\n          }\n\n          if(peerId.isUser() && !(await this.managers.appUsersManager.hasUser(peerId))) {\n            return;\n          }\n\n          appImManager.setInnerPeer({\n            peerId,\n            lastMsgId: generateMessageId(+notificationData.custom.msg_id)\n          });\n        });\n      }\n    });\n  }\n\n  public async buildNotification({message, fwdCount, peerReaction, peerTypeNotifySettings}: {\n    message: Message.message | Message.messageService,\n    fwdCount?: number,\n    peerReaction?: MessagePeerReaction,\n    peerTypeNotifySettings?: PeerNotifySettings\n  }) {\n    const peerId = message.peerId;\n    const isAnyChat = peerId.isAnyChat();\n    const notification: NotifyOptions = {};\n    const peerString = await this.managers.appPeersManager.getPeerString(peerId);\n    let notificationMessage: string;\n\n    if(peerTypeNotifySettings.show_previews) {\n      if(message._ === 'message' && message.fwd_from && fwdCount > 1) {\n        notificationMessage = I18n.format('Notifications.Forwarded', true, [fwdCount]);\n      } else {\n        notificationMessage = await wrapMessageForReply(message, undefined, undefined, true);\n\n        const reaction = peerReaction?.reaction;\n        if(reaction?._ === 'reactionEmoji') {\n          const langPackKey: LangPackKey = /* isAnyChat ? 'Notification.Group.Reacted' :  */'Notification.Contact.Reacted';\n          const args: FormatterArguments = [\n            fixEmoji(reaction.emoticon), // can be plain heart\n            notificationMessage\n          ];\n\n          /* if(isAnyChat) {\n            args.unshift(appPeersManager.getPeerTitle(message.fromId, true));\n          } */\n\n          notificationMessage = I18n.format(langPackKey, true, args);\n        }\n      }\n    } else {\n      notificationMessage = I18n.format('Notifications.New', true);\n    }\n\n    if(peerReaction) {\n      notification.noIncrement = true;\n      notification.silent = true;\n    }\n\n    const notificationFromPeerId = peerReaction ? getPeerId(peerReaction.peer_id) : message.fromId;\n    notification.title = await getPeerTitle(peerId, true, undefined, undefined, this.managers);\n    if(isAnyChat && notificationFromPeerId !== message.peerId) {\n      notification.title = await getPeerTitle(notificationFromPeerId, true, undefined, undefined, this.managers) +\n        ' @ ' +\n        notification.title;\n    }\n\n    notification.title = wrapPlainText(notification.title);\n\n    notification.onclick = () => {\n      appImManager.setInnerPeer({peerId, lastMsgId: message.mid});\n    };\n\n    notification.message = notificationMessage;\n    notification.key = 'msg' + message.mid;\n    notification.tag = peerString;\n    notification.silent = true;// message.pFlags.silent || false;\n\n    const peerPhoto = await this.managers.appPeersManager.getPeerPhoto(peerId);\n    if(peerPhoto) {\n      this.managers.appAvatarsManager.loadAvatar(peerId, peerPhoto, 'photo_small').then((url) => {\n        // ! WARNING, message can be already read\n        if(message.pFlags.unread || peerReaction) {\n          notification.image = url;\n          this.notify(notification);\n        }\n      });\n    } else {\n      this.notify(notification);\n    }\n  }\n\n  private toggleToggler(enable = idleController.isIdle) {\n    if(IS_MOBILE) return;\n\n    const resetTitle = (isBlink?: boolean) => {\n      this.titleChanged = false;\n      document.title = this.titleBackup;\n      this.setFavicon();\n    };\n\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n\n    if(!enable) {\n      resetTitle();\n    } else {\n      this.titleInterval = window.setInterval(() => {\n        const count = this.notificationsCount;\n        if(!count) {\n          this.toggleToggler(false);\n        } else if(this.titleChanged) {\n          resetTitle(true);\n        } else {\n          this.titleChanged = true;\n          document.title = I18n.format('Notifications.Count', true, [count]);\n          // this.setFavicon('assets/img/favicon_unread.ico');\n\n          // fetch('assets/img/favicon.ico')\n          // .then((res) => res.blob())\n          // .then((blob) => {\n          // const img = document.createElement('img');\n          // img.src = URL.createObjectURL(blob);\n\n          const canvas = document.createElement('canvas');\n          canvas.width = 32 * window.devicePixelRatio;\n          canvas.height = canvas.width;\n\n          const ctx = canvas.getContext('2d');\n          ctx.beginPath();\n          ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, 2 * Math.PI, false);\n          ctx.fillStyle = '#3390ec';\n          ctx.fill();\n\n          let fontSize = 24;\n          let str = '' + count;\n          if(count < 10) {\n            fontSize = 22;\n          } else if(count < 100) {\n            fontSize = 20;\n          } else {\n            str = '99+';\n            fontSize = 16;\n          }\n\n          fontSize *= window.devicePixelRatio;\n\n          ctx.font = `700 ${fontSize}px ${FontFamily}`;\n          ctx.textBaseline = 'middle';\n          ctx.textAlign = 'center';\n          ctx.fillStyle = 'white';\n          ctx.fillText(str, canvas.width / 2, canvas.height * .5625);\n\n          /* const ctx = canvas.getContext('2d');\n            ctx.drawImage(img, 0, 0, canvas.width, canvas.height); */\n\n          this.setFavicon(canvas.toDataURL());\n          // });\n        }\n      }, 1000);\n    }\n  }\n\n  private setFavicon(href: string = 'assets/img/favicon.ico') {\n    if(this.prevFavicon === href) {\n      return;\n    }\n\n    const link = this.faviconEl.cloneNode() as HTMLLinkElement;\n    link.href = href;\n    this.faviconEl.parentNode.replaceChild(link, this.faviconEl);\n    this.faviconEl = link;\n\n    this.prevFavicon = href;\n  }\n\n  public notify(data: NotifyOptions) {\n    // console.log('notify', data, rootScope.idle.isIDLE, this.notificationsUiSupport, this.stopped);\n\n    if(this.stopped) {\n      return;\n    }\n\n    // FFOS Notification blob src bug workaround\n    /* if(Config.Navigator.ffos && !Config.Navigator.ffos2p) {\n      data.image = 'https://telegram.org/img/t_logo.png'\n    }\n    else if (data.image && !angular.isString(data.image)) {\n      if (Config.Navigator.ffos2p) {\n        FileManager.getDataUrl(data.image, 'image/jpeg').then(function (url) {\n          data.image = url\n          notify(data)\n        })\n        return false\n      } else {\n        data.image = FileManager.getUrl(data.image, 'image/jpeg')\n      }\n    }\n    else */ if(!data.image) {\n      data.image = 'assets/img/logo_filled_rounded.png';\n    }\n    // console.log('notify image', data.image)\n\n    if(!data.noIncrement) {\n      ++this.notificationsCount;\n    }\n\n    if(!this.titleInterval) {\n      this.toggleToggler();\n    }\n\n    const idx = ++this.notificationIndex;\n    const key = data.key || 'k' + idx;\n    this.notificationsShown[key] = true;\n\n    const now = tsNow();\n    if(this.settings.volume > 0 && !this.settings.nosound/* &&\n      (\n        !data.tag ||\n        !this.soundsPlayed[data.tag] ||\n        now > this.soundsPlayed[data.tag] + 60000\n      ) */\n    ) {\n      this.testSound(this.settings.volume);\n      this.soundsPlayed[data.tag] = now;\n    }\n\n    if(!this.notificationsUiSupport ||\n      'Notification' in window && Notification.permission !== 'granted') {\n      return false;\n    }\n\n    if(this.settings.nodesktop) {\n      if(this.vibrateSupport && !this.settings.novibrate) {\n        navigator.vibrate([200, 100, 200]);\n        return;\n      }\n\n      return;\n    }\n\n    let notification: MyNotification;\n\n    if('Notification' in window) {\n      try {\n        if(data.tag) {\n          for(const i in this.notificationsShown) {\n            const notification = this.notificationsShown[i];\n            if(typeof(notification) !== 'boolean' && notification.tag === data.tag) {\n              notification.hidden = true;\n            }\n          }\n        }\n\n        notification = new Notification(data.title, {\n          icon: data.image || '',\n          body: data.message || '',\n          tag: data.tag || '',\n          silent: data.silent || false\n        });\n\n        // console.log('notify constructed notification');\n      } catch(e) {\n        this.notificationsUiSupport = false;\n        webPushApiManager.setLocalNotificationsDisabled();\n        return;\n      }\n    } /* else if('mozNotification' in navigator) {\n      notification = navigator.mozNotification.createNotification(data.title, data.message || '', data.image || '')\n    } else if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n      window.external.msSiteModeSetIconOverlay('img/icons/icon16.png', data.title)\n      window.external.msSiteModeActivate()\n      notification = {\n        index: idx\n      }\n    } */ else {\n      return;\n    }\n\n    notification.onclick = () => {\n      notification.close();\n      appRuntimeManager.focus();\n      this.clear();\n      if(data.onclick) {\n        data.onclick();\n      }\n    };\n\n    notification.onclose = () => {\n      if(!notification.hidden) {\n        delete this.notificationsShown[key];\n        this.clear();\n      }\n    };\n\n    if(notification.show) {\n      notification.show();\n    }\n    this.notificationsShown[key] = notification;\n\n    if(!IS_MOBILE) {\n      setTimeout(() => {\n        this.hide(key);\n      }, 8000);\n    }\n  }\n\n  public updateLocalSettings = () => {\n    const keys = ['notify_nodesktop', 'notify_volume', 'notify_novibrate', 'notify_nopreview', 'notify_nopush'];\n    const promises = keys.map(() => undefined);\n    // const promises = keys.map((k) => stateStorage.get(k as any));\n    Promise.all(promises)\n    .then((updSettings) => {\n      this.settings.nodesktop = updSettings[0];\n      this.settings.volume = updSettings[1] === undefined ? 0.5 : updSettings[1];\n      this.settings.novibrate = updSettings[2];\n      this.settings.nopreview = updSettings[3];\n      this.settings.nopush = updSettings[4];\n\n      if(this.pushInited) {\n        const needPush = !this.settings.nopush && !this.settings.nodesktop && webPushApiManager.isAvailable || false;\n        const hasPush = this.registeredDevice !== false;\n        if(needPush !== hasPush) {\n          if(needPush) {\n            webPushApiManager.subscribe();\n          } else {\n            webPushApiManager.unsubscribe();\n          }\n        }\n      }\n\n      webPushApiManager.setSettings(this.settings);\n    });\n\n    apiManagerProxy.getState().then((state) => {\n      this.settings.nosound = !state.settings.notifications.sound;\n    });\n  }\n\n  public getLocalSettings() {\n    return this.settings;\n  }\n\n  private hide(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification && typeof(notification) !== 'boolean') {\n      try {\n        if(notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }\n      } catch(e) {}\n    }\n  }\n\n  public soundReset(tag: string) {\n    delete this.soundsPlayed[tag];\n  }\n\n  private requestPermission = () => {\n    Notification.requestPermission();\n    window.removeEventListener('click', this.requestPermission);\n  };\n\n  public testSound(volume: number) {\n    const now = tsNow();\n    if(this.nextSoundAt && now < this.nextSoundAt && this.prevSoundVolume === volume) {\n      return;\n    }\n\n    this.nextSoundAt = now + 1000;\n    this.prevSoundVolume = volume;\n    const filename = 'assets/audio/notification.mp3';\n    const audio = document.createElement('audio');\n    audio.autoplay = true;\n    audio.setAttribute('mozaudiochannel', 'notification');\n    audio.volume = volume;\n    audio.innerHTML = `\n      <source src=\"${filename}\" type=\"audio/mpeg\" />\n      <embed hidden=\"true\" autostart=\"true\" loop=\"false\" volume=\"${volume * 100}\" src=\"${filename}\" />\n    `;\n    this.notifySoundEl.append(audio);\n\n    audio.addEventListener('ended', () => {\n      audio.remove();\n    }, {once: true});\n  }\n\n  public cancel(key: string) {\n    const notification = this.notificationsShown[key];\n    if(notification) {\n      if(this.notificationsCount > 0) {\n        --this.notificationsCount;\n      }\n\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.hidden = true;\n          notification.close();\n        }/*  else if(notificationsMsSiteMode &&\n          notification.index === notificationIndex) {\n          window.external.msSiteModeClearIconOverlay()\n        } */\n      } catch(e) {}\n\n      delete this.notificationsShown[key];\n    }\n  }\n\n  public clear() {\n    /* if(notificationsMsSiteMode) {\n      window.external.msSiteModeClearIconOverlay()\n    } else { */\n    for(const i in this.notificationsShown) {\n      const notification = this.notificationsShown[i];\n      try {\n        if(typeof(notification) !== 'boolean' && notification.close) {\n          notification.close();\n        }\n      } catch(e) {}\n    }\n    /* } */\n    this.notificationsShown = {};\n    this.notificationsCount = 0;\n\n    webPushApiManager.hidePushNotifications();\n  }\n\n  public start() {\n    this.updateLocalSettings();\n    rootScope.addEventListener('settings_updated', this.updateLocalSettings);\n    webPushApiManager.start();\n\n    if(!this.notificationsUiSupport) {\n      return false;\n    }\n\n    if('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {\n      window.addEventListener('click', this.requestPermission);\n    }\n\n    try {\n      if('onbeforeunload' in window) {\n        window.addEventListener('beforeunload', this.clear);\n      }\n    } catch(e) {}\n  }\n\n  private stop() {\n    this.clear();\n    window.clearInterval(this.titleInterval);\n    this.titleInterval = 0;\n    this.setFavicon();\n    this.stopped = true;\n  }\n\n  private registerDevice(tokenData: PushSubscriptionNotify) {\n    if(this.registeredDevice && deepEqual(this.registeredDevice, tokenData)) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.registerDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: [],\n      app_sandbox: false,\n      secret: new Uint8Array()\n    }).then(() => {\n      this.registeredDevice = tokenData;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n\n  private unregisterDevice(tokenData: PushSubscriptionNotify) {\n    if(!this.registeredDevice) {\n      return false;\n    }\n\n    this.managers.apiManager.invokeApi('account.unregisterDevice', {\n      token_type: tokenData.tokenType,\n      token: tokenData.tokenValue,\n      other_uids: []\n    }).then(() => {\n      this.registeredDevice = false;\n    }, (error) => {\n      error.handled = true;\n    });\n  }\n}\n\nconst uiNotificationsManager = new UiNotificationsManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.uiNotificationsManager = uiNotificationsManager);\nexport default uiNotificationsManager;\n","export default async function getFilesFromEvent(e: ClipboardEvent | DragEvent, onlyTypes = false): Promise<any[]> {\n  const files: any[] = [];\n\n  const scanFiles = async(entry: any, item: DataTransferItem) => {\n    if(entry.isDirectory) {\n      const directoryReader = entry.createReader();\n      await new Promise<void>((resolve, reject) => {\n        directoryReader.readEntries(async(entries: any) => {\n          for(const entry of entries) {\n            await scanFiles(entry, item);\n          }\n\n          resolve();\n        });\n      });\n    } else if(entry) {\n      if(onlyTypes) {\n        files.push(entry.type);\n      } else {\n        const itemFile = item.getAsFile(); // * Safari can't handle entry.file with pasting\n        const file = entry instanceof File ?\n          entry :\n          (\n            entry instanceof DataTransferItem ?\n              entry.getAsFile() :\n              await new Promise((resolve, reject) => entry.file(resolve, (err: any) => resolve(itemFile)))\n          );\n\n        /* if(!onlyTypes) {\n          console.log('getFilesFromEvent: got file', item, file);\n        } */\n\n        if(!file) return;\n        files.push(file);\n      }\n    }\n  };\n\n  if(e instanceof DragEvent && e.dataTransfer.files && !e.dataTransfer.items) {\n    for(let i = 0; i < e.dataTransfer.files.length; i++) {\n      const file = e.dataTransfer.files[i];\n      files.push(onlyTypes ? file.type : file);\n    }\n  } else {\n    // @ts-ignore\n    const items = (e.dataTransfer || e.clipboardData || e.originalEvent.clipboardData).items;\n\n    const promises: Promise<any>[] = [];\n    for(let i = 0; i < items.length; ++i) {\n      const item: DataTransferItem = items[i];\n      if(item.kind === 'file') {\n        const entry = (onlyTypes ? item : item.webkitGetAsEntry()) || item.getAsFile();\n        promises.push(scanFiles(entry, item));\n      }\n    }\n\n    await Promise.all(promises);\n  }\n\n  /* if(!onlyTypes) {\n    console.log('getFilesFromEvent: got files:', e, files);\n  } */\n\n  return files;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\nimport appSidebarLeft, {LEFT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarLeft';\nimport appSidebarRight, {RIGHT_COLUMN_ACTIVE_CLASSNAME} from '../../components/sidebarRight';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {logger, LogTypes} from '../logger';\nimport rootScope from '../rootScope';\nimport Chat, {ChatType} from '../../components/chat/chat';\nimport PopupNewMedia, {getCurrentNewMediaPopup} from '../../components/popups/newMedia';\nimport MarkupTooltip from '../../components/chat/markupTooltip';\nimport IS_TOUCH_SUPPORTED from '../../environment/touchSupport';\nimport SetTransition from '../../components/singleTransition';\nimport ChatDragAndDrop from '../../components/chat/dragAndDrop';\nimport {doubleRaf} from '../../helpers/schedulers';\nimport lottieLoader from '../rlottie/lottieLoader';\nimport useHeavyAnimationCheck, {dispatchHeavyAnimationEvent} from '../../hooks/useHeavyAnimationCheck';\nimport stateStorage from '../stateStorage';\nimport {MOUNT_CLASS_TO} from '../../config/debug';\nimport appNavigationController from '../../components/appNavigationController';\nimport AppPrivateSearchTab from '../../components/sidebarRight/tabs/search';\nimport I18n, {i18n, join, LangPackKey} from '../langPack';\nimport {ChatFull, ChatInvite, ChatParticipant, ChatParticipants, Message, MessageAction, MessageMedia, SendMessageAction} from '../../layer';\nimport PeerTitle from '../../components/peerTitle';\nimport PopupPeer from '../../components/popups/peer';\nimport blurActiveElement from '../../helpers/dom/blurActiveElement';\nimport cancelEvent from '../../helpers/dom/cancelEvent';\nimport disableTransition from '../../helpers/dom/disableTransition';\nimport placeCaretAtEnd from '../../helpers/dom/placeCaretAtEnd';\nimport replaceContent from '../../helpers/dom/replaceContent';\nimport whichChild from '../../helpers/dom/whichChild';\nimport PopupElement from '../../components/popups';\nimport singleInstance, {InstanceDeactivateReason, SingleInstance} from '../mtproto/singleInstance';\nimport PopupStickers from '../../components/popups/stickers';\nimport PopupJoinChatInvite from '../../components/popups/joinChatInvite';\nimport {toast, toastNew} from '../../components/toast';\nimport debounce from '../../helpers/schedulers/debounce';\nimport pause from '../../helpers/schedulers/pause';\nimport {InternalLink, InternalLinkTypeMap, INTERNAL_LINK_TYPE} from './internalLink';\nimport MEDIA_MIME_TYPES_SUPPORTED from '../../environment/mediaMimeTypesSupport';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport telegramMeWebManager from '../mtproto/telegramMeWebManager';\nimport {ONE_DAY} from '../../helpers/date';\nimport type {GroupCallId, MyGroupCall} from './appGroupCallsManager';\nimport TopbarCall from '../../components/topbarCall';\nimport confirmationPopup from '../../components/confirmationPopup';\nimport IS_GROUP_CALL_SUPPORTED from '../../environment/groupCallSupport';\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\nimport {CallType} from '../calls/types';\nimport {Awaited, Modify, SendMessageEmojiInteractionData} from '../../types';\nimport htmlToSpan from '../../helpers/dom/htmlToSpan';\nimport getVisibleRect from '../../helpers/dom/getVisibleRect';\nimport {attachClickEvent, simulateClickEvent} from '../../helpers/dom/clickEvent';\nimport PopupCall from '../../components/call';\nimport copy from '../../helpers/object/copy';\nimport getObjectKeysAndSort from '../../helpers/object/getObjectKeysAndSort';\nimport type GroupCallInstance from '../calls/groupCallInstance';\nimport type CallInstance from '../calls/callInstance';\nimport numberThousandSplitter from '../../helpers/number/numberThousandSplitter';\nimport ChatBackgroundPatternRenderer from '../../components/chat/patternRenderer';\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport compareVersion from '../../helpers/compareVersion';\nimport {AppManagers} from './managers';\nimport uiNotificationsManager from './uiNotificationsManager';\nimport appMediaPlaybackController from '../../components/appMediaPlaybackController';\nimport {PHONE_NUMBER_REG_EXP} from '../richTextProcessor';\nimport wrapEmojiText from '../richTextProcessor/wrapEmojiText';\nimport wrapRichText from '../richTextProcessor/wrapRichText';\nimport wrapUrl from '../richTextProcessor/wrapUrl';\nimport generateMessageId from './utils/messageId/generateMessageId';\nimport getUserStatusString from '../../components/wrappers/getUserStatusString';\nimport getChatMembersString from '../../components/wrappers/getChatMembersString';\nimport {STATE_INIT} from '../../config/state';\nimport CacheStorageController from '../files/cacheStorage';\nimport themeController from '../../helpers/themeController';\nimport overlayCounter from '../../helpers/overlayCounter';\nimport appDialogsManager from './appDialogsManager';\nimport idleController from '../../helpers/idleController';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {AckedResult} from '../mtproto/superMessagePort';\nimport groupCallsController from '../calls/groupCallsController';\nimport callsController from '../calls/callsController';\nimport getFilesFromEvent from '../../helpers/files/getFilesFromEvent';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport appRuntimeManager from './appRuntimeManager';\nimport paymentsWrapCurrencyAmount from '../../helpers/paymentsWrapCurrencyAmount';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport PopupPayment from '../../components/popups/payment';\n\nexport const CHAT_ANIMATION_GROUP: AnimationItemGroup = 'chat';\n\nexport type ChatSavedPosition = {\n  mids: number[],\n  top: number\n};\n\nexport type ChatSetPeerOptions = {\n  peerId?: PeerId,\n  lastMsgId?: number,\n  threadId?: number,\n  startParam?: string\n};\n\nexport type ChatSetInnerPeerOptions = Modify<ChatSetPeerOptions, {\n  peerId: PeerId\n}> & {\n  type?: ChatType\n};\n\nexport class AppImManager extends EventListenerBase<{\n  chat_changing: (details: {from: Chat, to: Chat}) => void,\n  peer_changed: (peerId: PeerId) => void,\n  peer_changing: (chat: Chat) => void,\n}> {\n  public columnEl = document.getElementById('column-center') as HTMLDivElement;\n  public chatsContainer: HTMLElement;\n\n  public offline = false;\n  public updateStatusInterval = 0;\n\n  public log: ReturnType<typeof logger>;\n\n  public setPeerPromise: Promise<void> = null;\n\n  public tabId = -1;\n\n  public chats: Chat[] = [];\n  private prevTab: HTMLElement;\n  private chatsSelectTabDebounced: () => void;\n\n  public markupTooltip: MarkupTooltip;\n  private backgroundPromises: {[slug: string]: Promise<string>};\n\n  private topbarCall: TopbarCall;\n  public emojiAnimationContainer: HTMLDivElement;\n\n  private lastBackgroundUrl: string;\n\n  public managers: AppManagers;\n\n  public cacheStorage = new CacheStorageController('cachedFiles');\n\n  get myId() {\n    return rootScope.myId;\n  }\n\n  get chat(): Chat {\n    return this.chats[this.chats.length - 1];\n  }\n\n  public construct(managers: AppManagers) {\n    this.managers = managers;\n\n    const {\n      apiUpdatesManager\n    } = managers;\n    apiUpdatesManager.attach(I18n.lastRequestedLangCode);\n\n    appMediaPlaybackController.construct(managers);\n    uiNotificationsManager.construct(managers);\n    uiNotificationsManager.start();\n\n    this.log = logger('IM', LogTypes.Log | LogTypes.Warn | LogTypes.Debug | LogTypes.Error);\n\n    this.backgroundPromises = {};\n    STATE_INIT.settings.themes.forEach((theme) => {\n      if(theme.background.slug) {\n        const url = 'assets/img/' + theme.background.slug + '.svg' + (IS_FIREFOX ? '?1' : '');\n        this.backgroundPromises[theme.background.slug] = Promise.resolve(url);\n      }\n    });\n\n    this.selectTab(0);\n\n    idleController.addEventListener('change', (idle) => {\n      this.offline = idle;\n      this.updateStatus();\n      if(idle) {\n        clearInterval(this.updateStatusInterval);\n      } else {\n        this.updateStatusInterval = window.setInterval(() => this.updateStatus(), 50e3);\n      }\n    });\n\n    this.chatsContainer = document.createElement('div');\n    this.chatsContainer.classList.add('chats-container', 'tabs-container');\n    this.chatsContainer.dataset.animation = 'navigation';\n\n    this.emojiAnimationContainer = document.createElement('div');\n    this.emojiAnimationContainer.classList.add('emoji-animation-container');\n    this.appendEmojiAnimationContainer(mediaSizes.activeScreen);\n\n    this.columnEl.append(this.chatsContainer);\n\n    this.createNewChat();\n    this.chatsSelectTab(this.chat.container);\n\n    appNavigationController.onHashChange = this.onHashChange;\n    // window.addEventListener('hashchange', this.onHashChange);\n\n    this.setSettings();\n    rootScope.addEventListener('settings_updated', this.setSettings);\n\n    const onPremiumToggle = (isPremium: boolean) => {\n      document.body.classList.toggle('is-premium', isPremium);\n    };\n    rootScope.addEventListener('premium_toggle', onPremiumToggle);\n    onPremiumToggle(rootScope.premium);\n\n    useHeavyAnimationCheck(() => {\n      animationIntersector.setOnlyOnePlayableGroup('lock');\n      animationIntersector.checkAnimations(true);\n    }, () => {\n      animationIntersector.setOnlyOnePlayableGroup();\n      animationIntersector.checkAnimations(false);\n    });\n\n    if(IS_FIREFOX && apiManagerProxy.oldVersion && compareVersion(apiManagerProxy.oldVersion, '1.4.3') === -1) {\n      this.deleteFilesIterative((response) => {\n        return response.headers.get('Content-Type') === 'image/svg+xml';\n      }).then(() => {\n        this.applyCurrentTheme();\n      });\n    } else {\n      this.applyCurrentTheme();\n    }\n\n    // * fix simultaneous opened both sidebars, can happen when floating sidebar is opened with left sidebar\n    mediaSizes.addEventListener('changeScreen', (from, to) => {\n      if(document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME) &&\n        document.body.classList.contains(RIGHT_COLUMN_ACTIVE_CLASSNAME)) {\n        appSidebarRight.toggleSidebar(false);\n      }\n\n      this.appendEmojiAnimationContainer(to);\n    });\n\n    mediaSizes.addEventListener('resize', () => {\n      // const perf = performance.now();\n      const rect = this.chatsContainer.getBoundingClientRect();\n      ChatBackgroundPatternRenderer.resizeInstances(rect.width, rect.height).then(() => {\n        // this.log.warn('resize bg time:', performance.now() - perf);\n        // for(const chat of this.chats) {\n        //   if(chat.renderDarkPattern) {\n        //     chat.renderDarkPattern();\n        //   }\n        // }\n      });\n    });\n\n    this.addEventListener('peer_changing', (chat) => {\n      this.saveChatPosition(chat);\n    });\n\n    rootScope.addEventListener('theme_change', () => {\n      this.applyCurrentTheme();\n    });\n\n    rootScope.addEventListener('choosing_sticker', (choosing) => {\n      this.setChoosingStickerTyping(!choosing);\n    });\n\n    rootScope.addEventListener('peer_typings', ({peerId, typings}) => {\n      const chat = this.chat;\n      if(\n        !chat ||\n        chat.peerId !== peerId ||\n        overlayCounter.isOverlayActive || (\n          mediaSizes.activeScreen === ScreenSize.mobile &&\n          this.tabId !== 1\n        )\n      ) {\n        return;\n      }\n\n      const typing = typings.find((typing) => typing.action._ === 'sendMessageEmojiInteraction');\n      if(typing?.action?._ === 'sendMessageEmojiInteraction') {\n        const action = typing.action;\n        const bubble = chat.bubbles.bubbles[generateMessageId(typing.action.msg_id)];\n        if(bubble && bubble.classList.contains('emoji-big') && getVisibleRect(bubble, chat.bubbles.scrollable.container)) {\n          const stickerWrapper: HTMLElement = bubble.querySelector('.media-sticker-wrapper:not(.bubble-hover-reaction-sticker):not(.reaction-sticker)');\n\n          const data: SendMessageEmojiInteractionData = JSON.parse(action.interaction.data);\n          data.a.forEach((a) => {\n            setTimeout(() => {\n              simulateClickEvent(stickerWrapper);\n            }, a.t * 1000);\n          });\n\n          this.managers.appMessagesManager.setTyping(peerId, {\n            _: 'sendMessageEmojiInteractionSeen',\n            emoticon: action.emoticon\n          });\n        }\n      }\n    });\n\n    const onInstanceDeactivated = (reason: InstanceDeactivateReason) => {\n      const isUpdated = reason === 'version';\n      const popup = new PopupElement('popup-instance-deactivated', {overlayClosable: true});\n      const c = document.createElement('div');\n      c.classList.add('instance-deactivated-container');\n      (popup as any).container.replaceWith(c);\n\n      const header = document.createElement('div');\n      header.classList.add('header');\n      header.append(i18n(isUpdated ? 'Deactivated.Version.Title' : 'Deactivated.Title'));\n\n      const subtitle = document.createElement('div');\n      subtitle.classList.add('subtitle');\n      subtitle.append(i18n(isUpdated ? 'Deactivated.Version.Subtitle' : 'Deactivated.Subtitle'));\n\n      c.append(header, subtitle);\n\n      document.body.classList.add('deactivated');\n\n      const onClose = isUpdated ? () => {\n        appRuntimeManager.reload();\n      } : () => {\n        document.body.classList.add('deactivated-backwards');\n\n        singleInstance.activateInstance();\n\n        setTimeout(() => {\n          document.body.classList.remove('deactivated', 'deactivated-backwards');\n        }, 333);\n      };\n\n      popup.addEventListener('close', onClose);\n      popup.show();\n    };\n\n    singleInstance.addEventListener('deactivated', onInstanceDeactivated);\n    if(singleInstance.deactivatedReason) {\n      onInstanceDeactivated(singleInstance.deactivatedReason);\n    }\n\n    // remove scroll listener when setting chat to tray\n    this.addEventListener('chat_changing', ({to}) => {\n      this.toggleChatGradientAnimation(to);\n    });\n\n    rootScope.addEventListener('service_notification', (update) => {\n      confirmationPopup({\n        button: {langKey: 'OK', isCancel: true},\n        description: wrapRichText(update.message)\n      });\n    });\n\n    rootScope.addEventListener('payment_sent', async({peerId, mid, receiptMessage}) => {\n      const message = await this.managers.appMessagesManager.getMessageByPeer(peerId, mid);\n      if(!message) {\n        return;\n      }\n\n      const action = receiptMessage.action as MessageAction.messageActionPaymentSent;\n      toastNew({\n        langPackKey: 'PaymentInfoHint',\n        langPackArguments: [\n          paymentsWrapCurrencyAmount(action.total_amount, action.currency),\n          wrapEmojiText(((message as Message.message).media as MessageMedia.messageMediaInvoice).title)\n        ]\n      });\n    });\n\n    (window as any).onSpoilerClick = (e: MouseEvent) => {\n      const spoiler = findUpClassName(e.target, 'spoiler');\n      const parentElement = findUpClassName(spoiler, 'spoilers-container') || spoiler.parentElement;\n\n      const className = 'is-spoiler-visible';\n      const isVisible = parentElement.classList.contains(className);\n      if(!isVisible) {\n        cancelEvent(e);\n\n        if(CLICK_EVENT_NAME !== 'click') {\n          window.addEventListener('click', cancelEvent, {capture: true, once: true});\n        }\n      }\n\n      const duration = 400 / 2;\n      const showDuration = 5000;\n      const useRafs = !isVisible ? 2 : 0;\n      if(useRafs) {\n        parentElement.classList.add('will-change');\n      }\n\n      const spoilerTimeout = parentElement.dataset.spoilerTimeout;\n      if(spoilerTimeout !== null) {\n        clearTimeout(+spoilerTimeout);\n        delete parentElement.dataset.spoilerTimeout;\n      }\n\n      SetTransition(parentElement, className, true, duration, () => {\n        parentElement.dataset.spoilerTimeout = '' + window.setTimeout(() => {\n          SetTransition(parentElement, className, false, duration, () => {\n            parentElement.classList.remove('will-change');\n            delete parentElement.dataset.spoilerTimeout;\n          });\n        }, showDuration);\n      }, useRafs);\n    };\n\n    rootScope.addEventListener('sticker_updated', ({type, faved}) => {\n      if(type === 'faved') {\n        toastNew({\n          langPackKey: faved ? 'AddedToFavorites' : 'RemovedFromFavorites'\n        });\n      } else if(!faved) {\n        toastNew({\n          langPackKey: 'RemovedFromRecent'\n        });\n      }\n    });\n\n    apiManagerProxy.addEventListener('notificationBuild', (options) => {\n      if(this.chat.peerId === options.message.peerId && !idleController.isIdle) {\n        return;\n      }\n\n      uiNotificationsManager.buildNotification(options);\n    });\n\n    this.addEventListener('peer_changed', async(peerId) => {\n      document.body.classList.toggle('has-chat', !!peerId);\n\n      this.emojiAnimationContainer.textContent = '';\n\n      this.overrideHash(peerId);\n\n      apiManagerProxy.updateTabState('chatPeerIds', this.chats.map((chat) => chat.peerId).filter(Boolean));\n    });\n\n    // stateStorage.get('chatPositions').then((c) => {\n    stateStorage.setToCache('chatPositions', /* c ||  */{});\n    // });\n\n    if(IS_CALL_SUPPORTED || IS_GROUP_CALL_SUPPORTED) {\n      this.topbarCall = new TopbarCall(managers);\n    }\n\n    if(IS_CALL_SUPPORTED) {\n      callsController.addEventListener('instance', ({instance/* , hasCurrent */}) => {\n        // if(hasCurrent) {\n        // return;\n        // }\n\n        const popup = new PopupCall(instance);\n\n        instance.addEventListener('acceptCallOverride', () => {\n          return this.discardCurrentCall(instance.interlocutorUserId.toPeerId(), undefined, instance)\n          .then(() => {\n            callsController.dispatchEvent('accepting', instance);\n            return true;\n          })\n          .catch(() => false);\n        });\n\n        popup.addEventListener('close', () => {\n          const currentCall = callsController.currentCall;\n          if(currentCall && currentCall !== instance && !instance.wasTryingToJoin) {\n            instance.hangUp('phoneCallDiscardReasonBusy');\n          }\n        }, {once: true});\n\n        popup.show();\n      });\n\n      callsController.addEventListener('incompatible', (userId) => {\n        toastNew({\n          langPackKey: 'VoipPeerIncompatible',\n          langPackArguments: [\n            new PeerTitle({peerId: userId.toPeerId()}).element\n          ]\n        });\n      });\n    }\n\n    // ! do not remove this line\n    // ! instance can be deactivated before the UI starts, because it waits in background for RAF that is delayed\n    singleInstance.activateInstance();\n\n    const setAuthorized = () => {\n      telegramMeWebManager.setAuthorized(true);\n    };\n\n    setInterval(setAuthorized, ONE_DAY);\n    setAuthorized();\n\n    this.addAnchorListener<{}>({\n      name: 'showMaskedAlert',\n      callback: (params, element) => {\n        const href = element.href;\n\n        const a = element.cloneNode(true) as HTMLAnchorElement;\n        a.className = 'anchor-url';\n        a.innerText = href;\n        a.removeAttribute('onclick');\n\n        new PopupPeer('popup-masked-url', {\n          titleLangKey: 'OpenUrlTitle',\n          descriptionLangKey: 'OpenUrlAlert2',\n          descriptionLangArgs: [a],\n          buttons: [{\n            langKey: 'Open',\n            callback: () => {\n              a.click();\n            }\n          }]\n        }).show();\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {command: string, bot: string}}>({\n      name: 'execBotCommand',\n      callback: ({uriParams}) => {\n        const {command, bot} = uriParams;\n\n        /* const promise = bot ? this.openUsername(bot).then(() => this.chat.peerId) : Promise.resolve(this.chat.peerId);\n        promise.then((peerId) => {\n          this.managers.appMessagesManager.sendText(peerId, '/' + command);\n        }); */\n\n        this.managers.appMessagesManager.sendText(this.chat.peerId, '/' + command + (bot ? '@' + bot : ''));\n\n        // console.log(command, bot);\n      }\n    });\n\n    this.addAnchorListener<{uriParams: {hashtag: string}}>({\n      name: 'searchByHashtag',\n      callback: ({uriParams}) => {\n        const {hashtag} = uriParams;\n        if(!hashtag) {\n          return;\n        }\n\n        this.chat.initSearch('#' + hashtag + ' ');\n      }\n    });\n\n    ([\n      ['addstickers', INTERNAL_LINK_TYPE.STICKER_SET],\n      ['addemoji', INTERNAL_LINK_TYPE.EMOJI_SET]\n    ] as [\n      'addstickers' | 'addemoji',\n      INTERNAL_LINK_TYPE.STICKER_SET | INTERNAL_LINK_TYPE.EMOJI_SET\n    ][]).forEach(([name, type]) => {\n      this.addAnchorListener<{pathnameParams: [typeof name, string]}>({\n        name,\n        callback: ({pathnameParams}) => {\n          if(!pathnameParams[1]) {\n            return;\n          }\n\n          const link: InternalLink = {\n            _: type,\n            set: pathnameParams[1]\n          };\n\n          this.processInternalLink(link);\n        }\n      });\n\n      this.addAnchorListener<{\n        uriParams: {\n          set: string\n        }\n      }>({\n        name,\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(type, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    });\n\n    // * t.me/invoice/asdasdad\n    // * t.me/$asdasdad\n    this.addAnchorListener<{pathnameParams: ['invoice', string] | string}>({\n      name: 'invoice',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.INVOICE,\n          slug: pathnameParams.length > 1 ? pathnameParams[1] : pathnameParams[0].slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    // Support old t.me/joinchat/asd and new t.me/+asd\n    this.addAnchorListener<{pathnameParams: ['joinchat', string]}>({\n      name: 'joinchat',\n      callback: ({pathnameParams}) => {\n        const link: InternalLink = {\n          _: INTERNAL_LINK_TYPE.JOIN_CHAT,\n          invite: pathnameParams[1] || decodeURIComponent(pathnameParams[0]).slice(1)\n        };\n\n        this.processInternalLink(link);\n      }\n    });\n\n    if(IS_GROUP_CALL_SUPPORTED) {\n      this.addAnchorListener<{\n        uriParams: Omit<InternalLink.InternalLinkVoiceChat, '_'>\n      }>({\n        name: 'voicechat',\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.VOICE_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    }\n\n    this.addAnchorListener<{\n    //   pathnameParams: ['c', string, string],\n    //   uriParams: {thread?: number}\n    // } | {\n    //   pathnameParams: [string, string?],\n    //   uriParams: {comment?: number}\n      pathnameParams: ['c', string, string] | [string, string?],\n      uriParams: {thread?: string, comment?: string} | {comment?: string, start?: string}\n    }>({\n      name: 'im',\n      callback: async({pathnameParams, uriParams}) => {\n        let link: InternalLink;\n        if(PHONE_NUMBER_REG_EXP.test(pathnameParams[0])) {\n          link = {\n            _: INTERNAL_LINK_TYPE.USER_PHONE_NUMBER,\n            phone: pathnameParams[0].slice(1)\n          };\n        } else if(pathnameParams[0] === 'c') {\n          link = {\n            _: INTERNAL_LINK_TYPE.PRIVATE_POST,\n            channel: pathnameParams[1],\n            post: pathnameParams[2],\n            thread: 'thread' in uriParams && uriParams.thread,\n            comment: uriParams.comment\n          };\n        } else {\n          link = {\n            _: INTERNAL_LINK_TYPE.MESSAGE,\n            domain: pathnameParams[0],\n            post: pathnameParams[1],\n            comment: uriParams.comment,\n            start: 'start' in uriParams ? uriParams.start : undefined\n          };\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        domain: string,\n\n        // telegrampassport\n        scope?: string,\n        nonce?: string,\n        payload?: string,\n        bot_id?: string,\n        public_key?: string,\n        callback_url?: string,\n\n        // regular\n        start?: string,\n        startgroup?: string,\n        game?: string,\n        voicechat?: string,\n        post?: string,\n        thread?: string,\n        comment?: string,\n        phone?: string\n      }\n    }>({\n      name: 'resolve',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        let link: InternalLink;\n        if(uriParams.phone) {\n          link = this.makeLink(INTERNAL_LINK_TYPE.USER_PHONE_NUMBER, uriParams as Required<typeof uriParams>);\n        } else if(uriParams.domain === 'telegrampassport') {\n\n        } else {\n          link = this.makeLink(INTERNAL_LINK_TYPE.MESSAGE, uriParams);\n        }\n\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        channel: string,\n        post: string,\n        thread?: string,\n        comment?: string\n      }\n    }>({\n      name: 'privatepost',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.PRIVATE_POST, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    this.addAnchorListener<{\n      uriParams: {\n        slug: string\n      }\n    }>({\n      name: 'invoice',\n      protocol: 'tg',\n      callback: ({uriParams}) => {\n        const link = this.makeLink(INTERNAL_LINK_TYPE.INVOICE, uriParams);\n        this.processInternalLink(link);\n      }\n    });\n\n    ['joinchat' as const, 'join' as const].forEach((name) => {\n      this.addAnchorListener<{\n        uriParams: {\n          invite: string\n        }\n      }>({\n        name,\n        protocol: 'tg',\n        callback: ({uriParams}) => {\n          const link = this.makeLink(INTERNAL_LINK_TYPE.JOIN_CHAT, uriParams);\n          this.processInternalLink(link);\n        }\n      });\n    });\n\n    this.onHashChange(true);\n    this.attachKeydownListener();\n  }\n\n  private deleteFilesIterative(callback: (response: Response) => boolean) {\n    return this.cacheStorage.timeoutOperation((cache) => {\n      const perf = performance.now();\n      return cache.keys().then((requests) => {\n        const promises = requests.map((request) => {\n          return cache.match(request).then((response) => {\n            return callback(response);\n          });\n        });\n\n        return Promise.all(promises).then((values) => {\n          values.map((isBad, idx) => {\n            if(!isBad) {\n              return;\n            }\n\n            const request = requests[idx];\n            return cache.delete(request);\n          });\n\n          return Promise.all(values.filter(Boolean));\n        });\n      }).then(() => {\n        this.log('deleted files', performance.now() - perf);\n      });\n    });\n  }\n\n  private toggleChatGradientAnimation(activatingChat: Chat) {\n    this.chats.forEach((chat) => {\n      if(chat.gradientRenderer) {\n        chat.gradientRenderer.scrollAnimate(rootScope.settings.animationsEnabled && chat === activatingChat);\n      }\n    });\n  }\n\n  private appendEmojiAnimationContainer(screen: ScreenSize) {\n    const appendTo = screen === ScreenSize.mobile ? this.columnEl : document.body;\n    if(this.emojiAnimationContainer.parentElement !== appendTo) {\n      appendTo.append(this.emojiAnimationContainer)\n    }\n  }\n\n  private attachKeydownListener() {\n    const IGNORE_KEYS = new Set(['PageUp', 'PageDown', 'Meta', 'Control']);\n    const onKeyDown = (e: KeyboardEvent) => {\n      const key = e.key;\n      if(overlayCounter.isOverlayActive || IGNORE_KEYS.has(key)) return;\n\n      const target = e.target as HTMLElement;\n\n      // if(target.tagName === 'INPUT') return;\n\n      // this.log('onkeydown', e, document.activeElement);\n\n      const chat = this.chat;\n\n      if(e.code === 'KeyC' && (e.ctrlKey || e.metaKey) && target.tagName !== 'INPUT') {\n        return;\n      } else if(e.altKey && (key === 'ArrowUp' || key === 'ArrowDown')) {\n        cancelEvent(e);\n        this.managers.dialogsStorage.getNextDialog(this.chat.peerId, key === 'ArrowDown', appDialogsManager.filterId).then((dialog) => {\n          if(dialog) {\n            this.setPeer({peerId: dialog.peerId});\n          }\n        });\n      } else if(key === 'ArrowUp' && this.chat.type !== 'scheduled') {\n        if(!chat.input.editMsgId && chat.input.isInputEmpty()) {\n          this.managers.appMessagesManager.getFirstMessageToEdit(chat.peerId, chat.threadId).then((message) => {\n            if(message) {\n              chat.input.initMessageEditing(message.mid);\n              cancelEvent(e); // * prevent from scrolling\n            }\n          });\n        } else {\n          return;\n        }\n      } else if(key === 'ArrowDown') {\n        return;\n      }\n\n      if(\n        chat?.input?.messageInput &&\n        e.target !== chat.input.messageInput &&\n        target.tagName !== 'INPUT' &&\n        !target.hasAttribute('contenteditable') &&\n        !IS_TOUCH_SUPPORTED &&\n        (!mediaSizes.isMobile || this.tabId === 1) &&\n        !chat.selection.isSelecting &&\n        !chat.input.recording\n      ) {\n        chat.input.messageInput.focus();\n        placeCaretAtEnd(chat.input.messageInput);\n\n        // clone and dispatch same event to new input. it is needed for sending message if input was blurred\n        const newEvent = new KeyboardEvent(e.type, e);\n        chat.input.messageInput.dispatchEvent(newEvent);\n      }\n    };\n\n    document.body.addEventListener('keydown', onKeyDown);\n  }\n\n  private makeLink<T extends INTERNAL_LINK_TYPE>(type: T, uriParams: Omit<InternalLinkTypeMap[T], '_'>) {\n    return {\n      _: type,\n      ...uriParams\n    } as any as InternalLinkTypeMap[T];\n  }\n\n  public async processInternalLink(link: InternalLink) {\n    switch(link?._) {\n      case INTERNAL_LINK_TYPE.MESSAGE: {\n        const postId = link.post ? generateMessageId(+link.post) : undefined;\n        const commentId = link.comment ? generateMessageId(+link.comment) : undefined;\n\n        this.openUsername({\n          userName: link.domain,\n          lastMsgId: postId,\n          commentId,\n          startParam: link.start\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.PRIVATE_POST: {\n        const chatId = link.channel.toChatId();\n        const peerId = chatId.toPeerId(true);\n\n        const chat = await this.managers.appChatsManager.getChat(chatId);\n        if(chat.deleted) {\n          try {\n            await this.managers.appChatsManager.resolveChannel(chatId);\n          } catch(err) {\n            toastNew({langPackKey: 'LinkNotFound'});\n            throw err;\n          }\n        }\n\n        const postId = generateMessageId(+link.post);\n        const threadId = link.thread ? generateMessageId(+link.thread) : undefined;\n\n        if(threadId) this.openThread(peerId, postId, threadId);\n        else this.setInnerPeer({\n          peerId,\n          lastMsgId: postId,\n          threadId\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.EMOJI_SET:\n      case INTERNAL_LINK_TYPE.STICKER_SET: {\n        new PopupStickers({id: link.set}, link._ === INTERNAL_LINK_TYPE.EMOJI_SET).show();\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.JOIN_CHAT: {\n        this.managers.appChatsManager.checkChatInvite(link.invite).then((chatInvite) => {\n          if((chatInvite as ChatInvite.chatInvitePeek).chat) {\n            this.managers.appChatsManager.saveApiChat((chatInvite as ChatInvite.chatInvitePeek).chat, true);\n          }\n\n          // console.log(chatInvite);\n\n          if(chatInvite._ === 'chatInviteAlready' ||\n            chatInvite._ === 'chatInvitePeek'/*  && chatInvite.expires > tsNow(true) */) {\n            this.setInnerPeer({\n              peerId: chatInvite.chat.id.toPeerId(true)\n            });\n            return;\n          }\n\n          new PopupJoinChatInvite(link.invite, chatInvite);\n        }, (err) => {\n          if(err.type === 'INVITE_HASH_EXPIRED') {\n            toast(i18n('InviteExpired'));\n          }\n        });\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.VOICE_CHAT: {\n        if(IS_GROUP_CALL_SUPPORTED) {\n          this.joinGroupCall(link.chat_id.toPeerId(true), link.id);\n        }\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.USER_PHONE_NUMBER: {\n        this.managers.appUsersManager.resolvePhone(link.phone).then((user) => {\n          this.setInnerPeer({\n            peerId: user.id.toPeerId(false)\n          });\n        }).catch((err) => {\n          if(err.type === 'PHONE_NOT_OCCUPIED') {\n            toastNew({langPackKey: 'Alert.UserDoesntExists'});\n          }\n        });\n\n        break;\n      }\n\n      case INTERNAL_LINK_TYPE.INVOICE: {\n        this.managers.appPaymentsManager.getInputInvoiceBySlug(link.slug).then((inputInvoice) => {\n          this.managers.appPaymentsManager.getPaymentForm(inputInvoice).then((paymentForm) => {\n            // const message: Message.message = {\n            //   _: 'message',\n            //   date: 0,\n            //   id: 0,\n            //   peerId: 0,\n            //   peer_id: undefined,\n            //   message: '',\n            //   media: {\n            //     _: 'messageMediaInvoice',\n            //     currency: paymentForm.invoice.currency,\n            //     description: paymentForm.description,\n\n            //   }\n            // };\n            new PopupPayment(undefined, inputInvoice, paymentForm);\n          });\n        });\n        break;\n      }\n\n      default: {\n        this.log.warn('Not supported internal link:', link);\n        break;\n      }\n    }\n  }\n\n  public openUrl(url: string) {\n    const {url: wrappedUrl, onclick} = wrapUrl(url);\n    const a = document.createElement('a');\n    a.href = wrappedUrl;\n\n    (window as any)[onclick](a);\n  }\n\n  private addAnchorListener<Params extends {pathnameParams?: any, uriParams?: any}>(options: {\n    name: 'showMaskedAlert' | 'execBotCommand' | 'searchByHashtag' | 'addstickers' | 'im' |\n          'resolve' | 'privatepost' | 'addstickers' | 'voicechat' | 'joinchat' | 'join' | 'invoice' |\n          'addemoji',\n    protocol?: 'tg',\n    callback: (params: Params, element?: HTMLAnchorElement) => boolean | any,\n    noPathnameParams?: boolean,\n    noUriParams?: boolean\n  }) {\n    (window as any)[(options.protocol ? options.protocol + '_' : '') + options.name] = (element?: HTMLAnchorElement/* , e: Event */) => {\n      cancelEvent(null);\n\n      let href = element.href;\n      let pathnameParams: any[];\n      let uriParams: any;\n\n      const u = new URL(href);\n      const match = u.host.match(/(.+?)\\.t(?:elegram)?\\.me/);\n      if(match) {\n        u.pathname = match[1] + (u.pathname === '/' ? '' : u.pathname);\n        href = u.toString();\n      }\n\n      if(!options.noPathnameParams) pathnameParams = new URL(href).pathname.split('/').slice(1);\n      if(!options.noUriParams) uriParams = this.parseUriParams(href);\n\n      const res = options.callback({pathnameParams, uriParams} as Params, element);\n      return res === undefined ? res : false;\n    };\n  }\n\n  private parseUriParams(uri: string, splitted = uri.split('?')) {\n    const params: any = {};\n    if(!splitted[1]) return params;\n    splitted[1].split('&').forEach((item) => {\n      params[item.split('=')[0]] = decodeURIComponent(item.split('=')[1]);\n    });\n\n    return params;\n  }\n\n  private onHashChange = (saveState?: boolean) => {\n    const hash = location.hash;\n    if(!saveState) {\n      appNavigationController.replaceState();\n    }\n\n    const splitted = hash.split('?');\n    const params = this.parseUriParams(hash, splitted);\n    this.log('hashchange', hash, splitted[0], params);\n    if(!hash) {\n      return;\n    }\n\n    if(params.tgaddr) {\n      const {onclick} = wrapUrl(params.tgaddr);\n      if(onclick) {\n        const a = document.createElement('a');\n        a.href = params.tgaddr;\n        (window as any)[onclick](a);\n      }\n      return;\n    }\n\n    switch(splitted[0]) {\n      default: {\n        params.p = splitted[0].slice(1);\n      }\n\n      case '#/im': {\n        const p: string = params.p;\n        const postId = params.post !== undefined ? generateMessageId(+params.post) : undefined;\n\n        switch(p[0]) {\n          case '@': {\n            this.openUsername({\n              userName: p,\n              lastMsgId: postId\n            });\n            break;\n          }\n\n          default: { // peerId\n            this.setInnerPeer({\n              peerId: postId ? p.toPeerId(true) : p.toPeerId(),\n              lastMsgId: postId\n            });\n            break;\n          }\n        }\n      }\n    }\n\n    // appNavigationController.replaceState();\n    // location.hash = '';\n  };\n\n  public openUsername(options: {\n    userName: string,\n    lastMsgId?: number,\n    threadId?: number,\n    commentId?: number,\n    startParam?: string\n  }) {\n    const {userName, lastMsgId, threadId, commentId, startParam} = options;\n    return this.managers.appUsersManager.resolveUsername(userName).then((peer) => {\n      const isUser = peer._ === 'user';\n      const peerId = peer.id.toPeerId(!isUser);\n\n      if(threadId) {\n        return this.openThread(peerId, lastMsgId, threadId);\n      } else if(commentId) {\n        return this.openComment(peerId, lastMsgId, commentId);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        startParam: startParam\n      });\n    }, (err) => {\n      if(err.type === 'USERNAME_NOT_OCCUPIED') {\n        toastNew({langPackKey: 'NoUsernameFound'});\n      } else if(err.type === 'USERNAME_INVALID') {\n        toastNew({langPackKey: 'Alert.UserDoesntExists'});\n      }\n    });\n  }\n\n  /**\n   * Opens thread when peerId of discussion group is known\n   */\n  public openThread(peerId: PeerId, lastMsgId: number, threadId: number) {\n    return this.managers.appMessagesManager.wrapSingleMessage(peerId, threadId).then((message) => {\n      // const message: Message = this.managers.appMessagesManager.getMessageByPeer(peerId, threadId);\n      if(!message) {\n        lastMsgId = undefined;\n      } else {\n        this.managers.appMessagesManager.generateThreadServiceStartMessage(message);\n      }\n\n      return this.setInnerPeer({\n        peerId,\n        lastMsgId,\n        threadId,\n        type: 'discussion'\n      });\n    });\n  }\n\n  /**\n   * Opens comment directly from original channel\n   */\n  public openComment(peerId: PeerId, msgId: number, commentId: number) {\n    return this.managers.appMessagesManager.getDiscussionMessage(peerId, msgId).then((message) => {\n      return this.openThread(message.peerId, commentId, message.mid);\n    });\n  }\n\n  public async callUser(userId: UserId, type: CallType) {\n    const call = callsController.getCallByUserId(userId);\n    if(call) {\n      return;\n    }\n\n    const userFull = await this.managers.appProfileManager.getProfile(userId);\n    if(userFull.pFlags.phone_calls_private) {\n      confirmationPopup({\n        descriptionLangKey: 'Call.PrivacyErrorMessage',\n        descriptionLangArgs: [new PeerTitle({peerId: userId.toPeerId()}).element],\n        button: {\n          langKey: 'OK',\n          isCancel: true\n        }\n      });\n\n      return;\n    }\n\n    await this.discardCurrentCall(userId.toPeerId());\n\n    callsController.startCallInternal(userId, type === 'video');\n  }\n\n  private discardCurrentCall(toPeerId: PeerId, ignoreGroupCall?: GroupCallInstance, ignoreCall?: CallInstance) {\n    if(groupCallsController.groupCall && groupCallsController.groupCall !== ignoreGroupCall) return this.discardGroupCallConfirmation(toPeerId);\n    else if(callsController.currentCall && callsController.currentCall !== ignoreCall) return this.discardCallConfirmation(toPeerId);\n    else return Promise.resolve();\n  }\n\n  private async discardCallConfirmation(toPeerId: PeerId) {\n    const currentCall = callsController.currentCall;\n    if(currentCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Call.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Call.ToCall.Text' : 'Call.Confirm.Discard.Call.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentCall.interlocutorUserId.toPeerId(false)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(!currentCall.isClosing) {\n        await currentCall.hangUp('phoneCallDiscardReasonDisconnect');\n      }\n    }\n  }\n\n  private async discardGroupCallConfirmation(toPeerId: PeerId) {\n    const currentGroupCall = groupCallsController.groupCall;\n    if(currentGroupCall) {\n      await confirmationPopup({\n        titleLangKey: 'Call.Confirm.Discard.Voice.Header',\n        descriptionLangKey: toPeerId.isUser() ? 'Call.Confirm.Discard.Voice.ToCall.Text' : 'Call.Confirm.Discard.Voice.ToVoice.Text',\n        descriptionLangArgs: [\n          new PeerTitle({peerId: currentGroupCall.chatId.toPeerId(true)}).element,\n          new PeerTitle({peerId: toPeerId}).element\n        ],\n        button: {\n          langKey: 'OK'\n        }\n      });\n\n      if(groupCallsController.groupCall === currentGroupCall) {\n        await currentGroupCall.hangUp();\n      }\n    }\n  }\n\n  public async joinGroupCall(peerId: PeerId, groupCallId?: GroupCallId) {\n    const chatId = peerId.toChatId();\n    const hasRights = this.managers.appChatsManager.hasRights(chatId, 'manage_call');\n    const next = async() => {\n      const chatFull = await this.managers.appProfileManager.getChatFull(chatId);\n      let call: MyGroupCall;\n      if(!chatFull.call) {\n        if(!hasRights) {\n          return;\n        }\n\n        call = await this.managers.appGroupCallsManager.createGroupCall(chatId);\n      } else {\n        call = chatFull.call;\n      }\n\n      groupCallsController.joinGroupCall(chatId, call.id, true, false);\n    };\n\n    if(groupCallId) {\n      const groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\n      if(groupCall._ === 'groupCallDiscarded') {\n        if(!hasRights) {\n          toastNew({\n            langPackKey: 'VoiceChat.Chat.Ended'\n          });\n\n          return;\n        }\n\n        await confirmationPopup({\n          descriptionLangKey: 'VoiceChat.Chat.StartNew',\n          button: {\n            langKey: 'VoiceChat.Chat.StartNew.OK'\n          }\n        });\n      }\n    }\n\n    // await this.discardCurrentCall(peerId);\n\n    next();\n  };\n\n  public setCurrentBackground(broadcastEvent = false): ReturnType<AppImManager['setBackground']> {\n    const theme = themeController.getTheme();\n\n    if(theme.background.slug) {\n      const defaultTheme = STATE_INIT.settings.themes.find((t) => t.name === theme.name);\n      // const isDefaultBackground = theme.background.blur === defaultTheme.background.blur &&\n      // theme.background.slug === defaultTheme.background.slug;\n\n      // if(!isDefaultBackground) {\n      return this.getBackground(theme.background.slug).then((url) => {\n        return this.setBackground(url, broadcastEvent);\n      }, () => { // * if NO_ENTRY_FOUND\n        theme.background = copy(defaultTheme.background); // * reset background\n        return this.setCurrentBackground(true);\n      });\n      // }\n    }\n\n    return this.setBackground('', broadcastEvent);\n  }\n\n  private getBackground(slug: string) {\n    if(this.backgroundPromises[slug]) return this.backgroundPromises[slug];\n    return this.backgroundPromises[slug] = this.cacheStorage.getFile('backgrounds/' + slug).then((blob) => {\n      return URL.createObjectURL(blob);\n    });\n  }\n\n  public setBackground(url: string, broadcastEvent = true): Promise<void> {\n    this.lastBackgroundUrl = url;\n    const promises = this.chats.map((chat) => chat.setBackground(url));\n    return promises[promises.length - 1].then(() => {\n      if(broadcastEvent) {\n        rootScope.dispatchEvent('background_change');\n      }\n    });\n  }\n\n  public saveChatPosition(chat: Chat) {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    // const bubble = chat.bubbles.getBubbleByPoint('top');\n    // if(bubble) {\n    // const top = bubble.getBoundingClientRect().top;\n    const chatBubbles = chat.bubbles;\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const chatPositions = stateStorage.getFromCache('chatPositions');\n    if(!(chatBubbles.scrollable.getDistanceToEnd() <= 16 && chatBubbles.scrollable.loadedAll.bottom) && chatBubbles.getRenderedLength()) {\n      chatBubbles.sliceViewport(true);\n      const top = chatBubbles.scrollable.scrollTop;\n\n      const position = {\n        mids: getObjectKeysAndSort(chatBubbles.bubbles, 'desc').filter((mid) => !chatBubbles.skippedMids.has(mid)),\n        top\n      };\n\n      chatPositions[key] = position;\n\n      this.log('saved chat position:', position);\n    } else {\n      delete chatPositions[key];\n\n      this.log('deleted chat position');\n    }\n\n    stateStorage.set({chatPositions}, true);\n    // }\n  }\n\n  public getChatSavedPosition(chat: Chat): ChatSavedPosition {\n    if(!(['chat', 'discussion'] as ChatType[]).includes(chat.type) || !chat.peerId) {\n      return;\n    }\n\n    const key = chat.peerId + (chat.threadId ? '_' + chat.threadId : '');\n    const cache = stateStorage.getFromCache('chatPositions');\n    return cache && cache[key];\n  }\n\n  public applyCurrentTheme(slug?: string, backgroundUrl?: string, broadcastEvent?: boolean) {\n    if(backgroundUrl) {\n      this.backgroundPromises[slug] = Promise.resolve(backgroundUrl);\n    }\n\n    themeController.setTheme();\n\n    return this.setCurrentBackground(broadcastEvent === undefined ? !!slug : broadcastEvent);\n  }\n\n  private setSettings = () => {\n    document.documentElement.style.setProperty('--messages-text-size', rootScope.settings.messagesTextSize + 'px');\n\n    document.body.classList.toggle('animation-level-0', !rootScope.settings.animationsEnabled);\n    document.body.classList.toggle('animation-level-1', false);\n    document.body.classList.toggle('animation-level-2', rootScope.settings.animationsEnabled);\n\n    this.chatsSelectTabDebounced = debounce(() => {\n      const topbar = this.chat.topbar;\n      if(topbar.pinnedMessage) { // *   ,     ,       \n        topbar.pinnedMessage.setCorrectIndex(0);\n      }\n\n      this.managers.apiFileManager.setQueueId(this.chat.bubbles.lazyLoadQueue.queueId);\n    }, rootScope.settings.animationsEnabled ? 250 : 0, false, true);\n\n    lottieLoader.setLoop(rootScope.settings.stickers.loop);\n    animationIntersector.checkAnimations(false);\n\n    for(const chat of this.chats) {\n      chat.setAutoDownloadMedia();\n    }\n\n    I18n.setTimeFormat(rootScope.settings.timeFormat);\n\n    this.toggleChatGradientAnimation(this.chat);\n  };\n\n  // *     TransitionSlider,       \n  // * (   )     (. scrollTop)\n  private chatsSelectTab(tab: HTMLElement, animate?: boolean) {\n    if(this.prevTab === tab) {\n      return;\n    }\n\n    if(animate === false && this.prevTab) { // * will be used for Safari iOS history swipe\n      disableTransition([tab, this.prevTab].filter(Boolean));\n    }\n\n    if(this.prevTab) {\n      this.prevTab.classList.remove('active');\n      this.chatsSelectTabDebounced();\n\n      // !    animation,         250\n      if(rootScope.settings.animationsEnabled && animate !== false) {\n        dispatchHeavyAnimationEvent(pause(250 + 150), 250 + 150);\n      }\n\n      const prevIdx = whichChild(this.prevTab);\n      const idx = whichChild(tab);\n      if(idx > prevIdx) {\n        appNavigationController.pushItem({\n          type: 'chat',\n          onPop: (canAnimate) => {\n            this.setPeer({}, canAnimate);\n            blurActiveElement();\n          }\n        });\n      }\n    }\n\n    tab.classList.add('active');\n    this.prevTab = tab;\n  }\n\n  private init() {\n    document.addEventListener('paste', this.onDocumentPaste, true);\n\n    if(!IS_TOUCH_SUPPORTED) {\n      this.attachDragAndDropListeners();\n    }\n\n    // if(!isTouchSupported) {\n    this.markupTooltip = new MarkupTooltip(this);\n    this.markupTooltip.handleSelection();\n    // }\n  }\n\n  private attachDragAndDropListeners() {\n    const drops: ChatDragAndDrop[] = [];\n    const mediaDrops: ChatDragAndDrop[] = [];\n    let mounted = false;\n    const toggle = async(e: DragEvent, mount: boolean) => {\n      if(mount === mounted) return;\n\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n\n      const newMediaPopup = getCurrentNewMediaPopup();\n      const types: string[] = await getFilesFromEvent(e, true);\n      if(!isFiles || (!(await this.canDrag()) && !newMediaPopup)) { // * skip dragging text case\n        counter = 0;\n        return;\n      }\n\n      const _dropsContainer = newMediaPopup ? mediaDropsContainer : dropsContainer;\n      const _drops = newMediaPopup ? mediaDrops : drops;\n\n      if(mount && !_drops.length) {\n        const force = isFiles && !types.length; // * can't get file items not from 'drop' on Safari\n\n        const foundMedia = types.filter((t) => MEDIA_MIME_TYPES_SUPPORTED.has(t)).length;\n        // const foundDocuments = types.length - foundMedia;\n\n        this.log('drag files', types);\n\n        if(newMediaPopup) {\n          newMediaPopup.appendDrops(_dropsContainer);\n\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              header: 'Preview.Dragging.AddItems',\n              headerArgs: [types.length],\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n        } else {\n          if(types.length || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragfiles',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropAsFilesDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'document');\n              }\n            }));\n          }\n\n          // if((foundMedia && !foundDocuments) || force) {\n          if(foundMedia || force) {\n            _drops.push(new ChatDragAndDrop(_dropsContainer, {\n              icon: 'dragmedia',\n              header: 'Chat.DropTitle',\n              subtitle: 'Chat.DropQuickDesc',\n              onDrop: (e: DragEvent) => {\n                toggle(e, false);\n                this.log('drop', e);\n                this.onDocumentPaste(e, 'media');\n              }\n            }));\n          }\n\n          this.chat.container.append(_dropsContainer);\n        }\n      }\n\n      // if(!mount) return;\n\n      SetTransition(_dropsContainer, 'is-visible', mount, 200, () => {\n        if(!mount) {\n          _drops.forEach((drop) => {\n            drop.destroy();\n          });\n\n          _drops.length = 0;\n        }\n      });\n\n      if(mount) {\n        _drops.forEach((drop) => {\n          drop.setPath();\n        });\n      } else {\n        counter = 0;\n      }\n\n      document.body.classList.toggle('is-dragging', mount);\n      mounted = mount;\n    };\n\n    /* document.body.addEventListener('dragover', (e) => {\n      cancelEvent(e);\n    }); */\n\n    let counter = 0;\n    document.body.addEventListener('dragenter', (e) => {\n      counter++;\n    });\n\n    document.body.addEventListener('dragover', (e) => {\n      // this.log('dragover', e/* , e.dataTransfer.types[0] */);\n      toggle(e, true);\n      cancelEvent(e);\n    });\n\n    document.body.addEventListener('dragleave', (e) => {\n      // this.log('dragleave', e, counter);\n      // if((e.pageX <= 0 || e.pageX >= this.managers.appPhotosManager.windowW) || (e.pageY <= 0 || e.pageY >= this.managers.appPhotosManager.windowH)) {\n      counter--;\n      if(counter === 0) {\n      // if(!findUpClassName(e.target, 'drops-container')) {\n        toggle(e, false);\n      }\n    });\n\n    const dropsContainer = document.createElement('div');\n    dropsContainer.classList.add('drops-container');\n\n    const mediaDropsContainer = dropsContainer.cloneNode(true) as HTMLElement;\n  }\n\n  private async canDrag() {\n    const chat = this.chat;\n    const peerId = chat?.peerId;\n    return !(!peerId || overlayCounter.isOverlayActive || !(await chat.canSend('send_media')));\n  }\n\n  private onDocumentPaste = async(e: ClipboardEvent | DragEvent, attachType?: 'media' | 'document') => {\n    const newMediaPopup = getCurrentNewMediaPopup();\n\n    // console.log('document paste');\n    // console.log('item', event.clipboardData.getData());\n\n    if(e instanceof DragEvent) {\n      const _types = e.dataTransfer.types;\n      // @ts-ignore\n      const isFiles = _types.contains ? _types.contains('Files') : _types.indexOf('Files') >= 0;\n      if(isFiles) {\n        cancelEvent(e);\n      }\n    }\n\n    const files = await getFilesFromEvent(e);\n    if(!(await this.canDrag()) && !newMediaPopup) return;\n    if(files.length) {\n      if(newMediaPopup) {\n        newMediaPopup.addFiles(files);\n        return;\n      }\n\n      const chatInput = this.chat.input;\n      chatInput.willAttachType = attachType || (MEDIA_MIME_TYPES_SUPPORTED.has(files[0].type) ? 'media' : 'document');\n      PopupElement.createPopup(PopupNewMedia, this.chat, files, chatInput.willAttachType);\n    }\n  };\n\n  private async overrideHash(peerId?: PeerId) {\n    let str: string;\n    if(peerId) {\n      const username = await this.managers.appPeersManager.getPeerUsername(peerId);\n      str = username ? '@' + username : '' + peerId;\n    }\n\n    appNavigationController.overrideHash(str);\n  }\n\n  public selectTab(id: number, animate?: boolean) {\n    if(animate === false) { // * will be used for Safari iOS history swipe\n      disableTransition([appSidebarLeft.sidebarEl, this.columnEl, appSidebarRight.sidebarEl]);\n    }\n\n    document.body.classList.toggle(LEFT_COLUMN_ACTIVE_CLASSNAME, id === 0);\n\n    const prevTabId = this.tabId;\n    if(prevTabId !== -1) {\n      this.overrideHash(id > 0 ? this.chat?.peerId : undefined);\n    }\n\n    this.log('selectTab', id, prevTabId);\n\n    let animationPromise: Promise<any> = rootScope.settings.animationsEnabled ? doubleRaf() : Promise.resolve();\n    if(prevTabId !== -1 && prevTabId !== id && rootScope.settings.animationsEnabled && animate !== false && mediaSizes.activeScreen !== ScreenSize.large) {\n      const transitionTime = (mediaSizes.isMobile ? 250 : 200) + 100; // * cause transition time could be > 250ms\n      animationPromise = pause(transitionTime);\n      dispatchHeavyAnimationEvent(animationPromise, transitionTime);\n\n      // ! it's very heavy operation. will blink in firefox\n      /* this.columnEl.classList.add('disable-hover');\n      animationPromise.finally(() => {\n        this.columnEl.classList.remove('disable-hover');\n      }); */\n    }\n\n    this.tabId = id;\n    blurActiveElement();\n    if(mediaSizes.isMobile && prevTabId === 2 && id < 2) {\n      document.body.classList.remove(RIGHT_COLUMN_ACTIVE_CLASSNAME);\n    }\n\n    if(prevTabId !== -1 && id > prevTabId) {\n      if(id < 2 || !appNavigationController.findItemByType('im')) {\n        appNavigationController.pushItem({\n          type: 'im',\n          onPop: (canAnimate) => {\n            // this.selectTab(prevTabId, !isSafari);\n            this.setPeer({}, canAnimate);\n          }\n        });\n      }\n    }\n\n    const onImTabChange = (window as any).onImTabChange;\n    onImTabChange && onImTabChange(id);\n\n    // this._selectTab(id, mediaSizes.isMobile);\n    // document.body.classList.toggle(RIGHT_COLUMN_ACTIVE_CLASSNAME, id === 2);\n\n    return animationPromise;\n  }\n\n  public updateStatus() {\n    return this.managers.appUsersManager.updateMyOnlineStatus(this.offline);\n  }\n\n  private createNewChat() {\n    const chat = new Chat(\n      this,\n      this.managers\n    );\n\n    if(this.chats.length) {\n      chat.setBackground(this.lastBackgroundUrl, true);\n    }\n\n    this.chats.push(chat);\n\n    return chat;\n  }\n\n  private spliceChats(fromIndex: number, justReturn = true, animate?: boolean, spliced?: Chat[]) {\n    if(fromIndex >= this.chats.length) return;\n\n    const chatFrom = this.chat;\n    if(this.chats.length > 1 && justReturn) {\n      this.dispatchEvent('peer_changing', this.chat);\n    }\n\n    if(!spliced) {\n      spliced = this.chats.splice(fromIndex, this.chats.length - fromIndex);\n    }\n\n    const chatTo = this.chat;\n    this.dispatchEvent('chat_changing', {from: chatFrom, to: chatTo});\n\n    // * -1 because one item is being sliced when closing the chat by calling .removeByType\n    for(let i = 0; i < spliced.length - 1; ++i) {\n      appNavigationController.removeByType('chat', true);\n    }\n\n    // * fix middle chat z-index on animation\n    if(spliced.length > 1) {\n      spliced.slice(0, -1).forEach((chat) => {\n        chat.container.remove();\n      });\n    }\n\n    this.chatsSelectTab(chatTo.container, animate);\n\n    if(justReturn) {\n      this.dispatchEvent('peer_changed', chatTo.peerId);\n\n      const searchTab = appSidebarRight.getTab(AppPrivateSearchTab);\n      if(searchTab) {\n        searchTab.close();\n      }\n\n      appSidebarRight.replaceSharedMediaTab(chatTo.sharedMediaTab);\n    }\n\n    spliced.forEach((chat) => {\n      chat.beforeDestroy();\n    });\n\n    setTimeout(() => {\n      // chat.setPeer(0);\n      spliced.forEach((chat) => {\n        chat.destroy();\n      });\n    }, 250 + 100);\n  }\n\n  public async setPeer(options: ChatSetPeerOptions = {}, animate?: boolean): Promise<boolean> {\n    if(this.init) {\n      this.init();\n      this.init = null;\n    }\n\n    options.peerId ??= NULL_PEER_ID;\n\n    const {peerId, lastMsgId} = options;\n\n    const chat = this.chat;\n    const chatIndex = this.chats.indexOf(chat);\n\n    if(!peerId) {\n      if(chatIndex > 0) {\n        this.spliceChats(chatIndex, undefined, animate);\n        return;\n      } else if(mediaSizes.activeScreen === ScreenSize.medium) { // * floating sidebar case\n        this.selectTab(+!this.tabId, animate);\n        return;\n      }\n    } else if(chatIndex > 0 && chat.peerId && chat.peerId !== peerId) {\n      // const firstChat = this.chats[0];\n      // if(firstChat.peerId !== chat.peerId) {\n      /* // * slice idx > 0, set background and slice first, so new one will be the first\n        const spliced = this.chats.splice(1, this.chats.length - 1);\n        this.createNewChat();\n        this.chats.splice(0, 1); */\n      const spliced = this.chats.splice(1, this.chats.length - 1);\n      if(this.chat.peerId === peerId) {\n        this.spliceChats(0, true, true, spliced);\n        return;\n      } else {\n        const ret = this.setPeer(options);\n        this.spliceChats(0, false, false, spliced);\n        return ret;\n      }\n      // } else {\n      //   this.spliceChats(1, false, animate);\n      // }\n\n      // return ret;\n    }\n\n    // * don't reset peer if returning\n    if(peerId === chat.peerId && mediaSizes.activeScreen <= ScreenSize.medium && document.body.classList.contains(LEFT_COLUMN_ACTIVE_CLASSNAME)) {\n      this.selectTab(1, animate);\n      return false;\n    }\n\n    if(peerId || mediaSizes.activeScreen !== ScreenSize.mobile) {\n      const result = await chat.setPeer(peerId, lastMsgId, options.startParam);\n\n      // * wait for cached render\n      const promise = result?.cached ? result.promise : Promise.resolve();\n      if(peerId) {\n        Promise.all([\n          promise,\n          chat.setBackgroundPromise\n        ]).then(() => {\n          // window.requestAnimationFrame(() => {\n          setTimeout(() => { // * setTimeout is better here\n            setTimeout(() => {\n              this.chatsSelectTab(this.chat.container);\n            }, 0);\n            this.selectTab(1, animate);\n          }, 0);\n        });\n      }\n    }\n\n    if(!peerId) {\n      this.selectTab(0, animate);\n      return false;\n    }\n  }\n\n  public setInnerPeer(options: ChatSetInnerPeerOptions) {\n    const {peerId} = options;\n    if(peerId === NULL_PEER_ID || !peerId) {\n      return;\n    }\n\n    if(options.threadId) {\n      options.type = 'discussion';\n    }\n\n    const type = options.type ??= 'chat';\n\n    // * prevent opening already opened peer\n    const existingIndex = this.chats.findIndex((chat) => chat.peerId === peerId && chat.type === type);\n    if(existingIndex !== -1) {\n      this.spliceChats(existingIndex + 1);\n      return this.setPeer(options);\n    }\n\n    const oldChat = this.chat;\n    let chat = oldChat;\n    if(oldChat.inited) { // * use first not inited chat\n      chat = this.createNewChat();\n    }\n\n    if(type) {\n      chat.setType(type);\n\n      if(options.threadId) {\n        chat.threadId = options.threadId;\n      }\n    }\n\n    this.dispatchEvent('chat_changing', {from: oldChat, to: chat});\n\n    // this.chatsSelectTab(chat.container);\n\n    return this.setPeer(options);\n  }\n\n  public openScheduled(peerId: PeerId) {\n    this.setInnerPeer({\n      peerId,\n      type: 'scheduled'\n    });\n  }\n\n  private getTypingElement(action: SendMessageAction) {\n    const el = document.createElement('span');\n    let c = 'peer-typing';\n    el.classList.add(c);\n    el.dataset.action = action._;\n    switch(action._) {\n      case 'sendMessageTypingAction': {\n      // default: {\n        c += '-text';\n        for(let i = 0; i < 3; ++i) {\n          const dot = document.createElement('span');\n          dot.className = c + '-dot';\n          el.append(dot);\n        }\n        break;\n      }\n\n      case 'sendMessageUploadAudioAction':\n      case 'sendMessageUploadDocumentAction':\n      case 'sendMessageUploadRoundAction':\n      case 'sendMessageUploadVideoAction':\n      case 'sendMessageUploadPhotoAction': {\n        c += '-upload';\n        /* const trail = document.createElement('span');\n        trail.className = c + '-trail';\n        el.append(trail); */\n        break;\n      }\n\n      case 'sendMessageRecordAudioAction':\n      case 'sendMessageRecordRoundAction':\n      case 'sendMessageRecordVideoAction': {\n        c += '-record';\n        break;\n      }\n\n      case 'sendMessageEmojiInteractionSeen':\n      case 'sendMessageChooseStickerAction': {\n        c += '-choosing-sticker';\n        for(let i = 0; i < 2; ++i) {\n          const eye = document.createElement('div');\n          eye.className = c + '-eye';\n          el.append(eye);\n        }\n        break;\n      }\n    }\n\n    el.classList.add(c);\n\n    return el;\n  }\n\n  public async getPeerTyping(peerId: PeerId, container?: HTMLElement) {\n    // const log = this.log.bindPrefix('getPeerTyping-' + peerId);\n    // log('getting peer typing');\n\n    const isUser = peerId.isUser();\n    if(isUser && await this.managers.appUsersManager.isBot(peerId)) {\n      // log('a bot');\n      return;\n    }\n\n    const typings = await this.managers.appProfileManager.getPeerTypings(peerId);\n    if(!typings?.length) {\n      // log('have no typing');\n      return;\n    }\n\n    const typing = typings[0];\n\n    const langPackKeys: {\n      [peerType in 'private' | 'chat' | 'multi']?: Partial<{[action in SendMessageAction['_']]: LangPackKey}>\n    } = {\n      private: {\n        'sendMessageTypingAction': 'Peer.Activity.User.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.User.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.User.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.User.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.User.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.User.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.User.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.User.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.User.EnjoyingAnimations'\n      },\n      chat: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.TypingText',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.SendingFile',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.SendingPhoto',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.SendingVideo',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.RecordingAudio',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.RecordingVideo',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.PlayingGame',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.ChoosingSticker',\n        'sendMessageEmojiInteractionSeen': 'Peer.Activity.Chat.EnjoyingAnimations'\n      },\n      multi: {\n        'sendMessageTypingAction': 'Peer.Activity.Chat.Multi.TypingText1',\n        'sendMessageUploadAudioAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadDocumentAction': 'Peer.Activity.Chat.Multi.SendingFile1',\n        'sendMessageUploadPhotoAction': 'Peer.Activity.Chat.Multi.SendingPhoto1',\n        'sendMessageUploadVideoAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageUploadRoundAction': 'Peer.Activity.Chat.Multi.SendingVideo1',\n        'sendMessageRecordVideoAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageRecordAudioAction': 'Peer.Activity.Chat.Multi.RecordingAudio1',\n        'sendMessageRecordRoundAction': 'Peer.Activity.Chat.Multi.RecordingVideo1',\n        'sendMessageGamePlayAction': 'Peer.Activity.Chat.Multi.PlayingGame1',\n        'sendMessageChooseStickerAction': 'Peer.Activity.Chat.Multi.ChoosingSticker1'\n      }\n    };\n\n    const mapa = isUser ? langPackKeys.private : (typings.length > 1 ? langPackKeys.multi : langPackKeys.chat);\n    let action = typing.action;\n\n    if(typings.length > 1) {\n      const s: any = {};\n      typings.forEach((typing) => {\n        const type = typing.action._;\n        if(s[type] === undefined) s[type] = 0;\n        ++s[type];\n      });\n\n      if(Object.keys(s).length > 1) {\n        action = {\n          _: 'sendMessageTypingAction'\n        };\n      }\n    }\n\n    const langPackKey = mapa[action._];\n    if(!langPackKey) {\n      // log('no langPackKey');\n      return;\n    }\n\n    let peerTitlePromise: Promise<any>;\n    let args: any[];\n    if(peerId.isAnyChat()) {\n      const peerTitle = new PeerTitle();\n      peerTitlePromise = peerTitle.update({peerId: typing.userId.toPeerId(false), onlyFirstName: true});\n      args = [\n        peerTitle.element,\n        typings.length - 1\n      ];\n\n      await peerTitlePromise;\n    }\n\n    if(!container) {\n      container = document.createElement('span');\n      container.classList.add('online', 'peer-typing-container');\n    }\n\n    container.classList.toggle('peer-typing-flex', action._ === 'sendMessageChooseStickerAction' || action._ === 'sendMessageEmojiInteractionSeen');\n\n    let typingElement = container.firstElementChild as HTMLElement;\n    if(!typingElement) {\n      typingElement = this.getTypingElement(action);\n      container.prepend(typingElement);\n    } else {\n      if(typingElement.dataset.action !== action._) {\n        typingElement.replaceWith(this.getTypingElement(action));\n      }\n    }\n\n    if(action._ === 'sendMessageEmojiInteractionSeen') {\n      if(args) {\n        args.pop();\n      } else {\n        args = [];\n      }\n\n      const span = htmlToSpan(wrapEmojiText(action.emoticon));\n      args.push(span);\n    }\n\n    const descriptionElement = i18n(langPackKey, args);\n    descriptionElement.classList.add('peer-typing-description');\n\n    if(container.childElementCount > 1) container.lastElementChild.replaceWith(descriptionElement);\n    else container.append(descriptionElement);\n\n    // log('returning typing');\n    return container;\n  }\n\n  private async getChatStatus(chatId: ChatId): Promise<AckedResult<HTMLElement>> {\n    const typingEl = await this.getPeerTyping(chatId.toPeerId(true));\n    if(typingEl) {\n      return {cached: true, result: Promise.resolve(typingEl)};\n    }\n\n    const result = await this.managers.acknowledged.appProfileManager.getChatFull(chatId);\n    const dooo = async(chatInfo: ChatFull) => {\n      // this.chat.log('chatInfo res:', chatInfo);\n\n      const participants_count = (chatInfo as ChatFull.channelFull).participants_count ||\n        ((chatInfo as ChatFull.chatFull).participants as ChatParticipants.chatParticipants)?.participants?.length ||\n        1;\n      // if(participants_count) {\n      let subtitle = await getChatMembersString(chatId);\n\n      if(participants_count < 2) {\n        return subtitle;\n      }\n\n      const onlines = await this.managers.appProfileManager.getOnlines(chatId);\n      if(onlines > 1) {\n        const span = document.createElement('span');\n\n        span.append(...join([subtitle, i18n('OnlineCount', [numberThousandSplitter(onlines)])], false));\n        subtitle = span;\n      }\n\n      return subtitle;\n      // }\n    };\n\n    const promise = Promise.resolve(result.result).then(dooo);\n    return {\n      cached: result.cached,\n      result: promise\n    };\n  }\n\n  private async getUserStatus(userId: UserId, ignoreSelf?: boolean) {\n    const result: AckedResult<HTMLElement> = {\n      cached: true,\n      result: Promise.resolve(undefined as HTMLElement)\n    };\n\n    const user = await this.managers.appUsersManager.getUser(userId);\n    if(!user || (user.pFlags.self && !ignoreSelf)) {\n      return result;\n    }\n\n    const subtitle = getUserStatusString(user);\n\n    if(!user.pFlags.bot) {\n      let typingEl = await this.getPeerTyping(userId.toPeerId());\n      if(!typingEl && user.status?._ === 'userStatusOnline') {\n        typingEl = document.createElement('span');\n        typingEl.classList.add('online');\n        typingEl.append(subtitle);\n      }\n\n      if(typingEl) {\n        result.result = Promise.resolve(typingEl);\n        return result;\n      }\n    }\n\n    result.result = Promise.resolve(subtitle);\n    return result;\n  }\n\n  private async getPeerStatus(peerId: PeerId, ignoreSelf?: boolean) {\n    if(!peerId) return;\n    let promise: Promise<AckedResult<HTMLElement>>;\n    if(peerId.isAnyChat()) {\n      promise = this.getChatStatus(peerId.toChatId());\n    } else {\n      promise = this.getUserStatus(peerId.toUserId(), ignoreSelf);\n    }\n\n    return promise;\n  }\n\n  public async setPeerStatus(\n    peerId: PeerId,\n    element: HTMLElement,\n    needClear: boolean,\n    useWhitespace: boolean,\n    middleware: () => boolean,\n    ignoreSelf?: boolean\n  ) {\n    // const log = this.log.bindPrefix('status-' + peerId);\n    // log('setting status', element);\n\n    if(!needClear) {\n      // * good good good\n      const typingContainer = element.querySelector('.peer-typing-container') as HTMLElement;\n      if(typingContainer && await this.getPeerTyping(peerId, typingContainer)) {\n        // log('already have a status');\n        return;\n      }\n    }\n\n    const result = await this.getPeerStatus(peerId, ignoreSelf);\n    // log('getPeerStatus result', result);\n    if(!middleware()) {\n      // log.warn('middleware');\n      return;\n    }\n\n    const set = async() => {\n      const subtitle = result && await result.result;\n      if(!middleware()) {\n        return;\n      }\n\n      return () => replaceContent(element, subtitle || placeholder);\n    };\n\n    const placeholder = useWhitespace ? '' : ''; // ! HERE U CAN FIND WHITESPACE\n    if(!result || result.cached) {\n      return await set();\n    } else if(needClear) {\n      return () => {\n        element.textContent = placeholder;\n        return set().then((callback) => callback && callback());\n      };\n    }\n  }\n\n  public setChoosingStickerTyping(cancel: boolean) {\n    this.managers.appMessagesManager.setTyping(this.chat.peerId, {_: cancel ? 'sendMessageCancelAction' : 'sendMessageChooseStickerAction'});\n  }\n}\n\nconst appImManager = new AppImManager();\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.appImManager = appImManager);\nexport default appImManager;\n","import {Document, Message, MessageAction, MessageMedia, Photo, WebPage} from '../../../../layer';\n\nexport default function getMediaFromMessage(message: Message) {\n  if(!message) return;\n\n  const media = (message as Message.messageService).action ?\n    ((message as Message.messageService).action as MessageAction.messageActionChannelEditPhoto).photo :\n    (message as Message.message).media && (\n      ((message as Message.message).media as MessageMedia.messageMediaPhoto).photo ||\n      ((message as Message.message).media as MessageMedia.messageMediaDocument).document || (\n        ((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage && (\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).document ||\n          (((message as Message.message).media as MessageMedia.messageMediaWebPage).webpage as WebPage.webPage).photo\n        )\n      )\n    );\n\n  return media as Photo.photo | Document.document;\n}\n","import {Message} from '../../../../layer';\nimport type {MyMessage} from '../../appMessagesManager';\n\nexport default function getMessageSenderPeerIdOrName(message: MyMessage) {\n  if(message.fromId) {\n    return {\n      peerId: message.fromId\n    };\n  } else {\n    return {\n      fromName: (message as Message.message).fwd_from?.from_name\n    };\n  }\n}\n","import {isRestricted} from '../../../../helpers/restrictions';\nimport {Message} from '../../../../layer';\n\nexport default function isMessageRestricted(message: Message.message) {\n  return !!(message.restriction_reason && isRestricted(message.restriction_reason));\n}\n","// https://github.com/eelcohn/Telegram-API/wiki/Calculating-color-for-a-Telegram-user-on-IRC\n/*\n  HTML-color  IRC-color  Description\n  #c03d33     4          red\n  #4fad2d     3          green\n  #d09306     7          yellow\n  #168acd     10         blue\n  #8544d6     6          purple\n  #cd4073     13         pink\n  #2996ad     11         sea\n  #ce671b     5          orange\n*/\nconst DialogColorsFg = ['#fc5c51', '#0fb297', '#d09306', '#3d72ed', '#895dd5', '#cd4073', '#00c1a6', '#fa790f'];\nconst DialogColors = ['red', 'green', 'yellow', 'blue', 'violet', 'pink', 'cyan', 'orange'];\nconst DialogColorsMap = [0, 7, 4, 1, 6, 3, 5];\n\nexport default function getPeerColorById(peerId: PeerId, pic = true) {\n  if(!peerId) return '';\n\n  const idx = DialogColorsMap[Math.abs(+peerId) % 7];\n  const color = (pic ? DialogColors : DialogColorsFg)[idx];\n  return color;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {MyDocument} from '../../appDocsManager';\nimport type {MyPhoto} from '../../appPhotosManager';\nimport type {PhotoSize, VideoSize, WebDocument} from '../../../../layer';\nimport calcImageInBox from '../../../../helpers/calcImageInBox';\nimport {THUMB_TYPE_FULL} from '../../../mtproto/mtproto_config';\n\nexport default function choosePhotoSize(\n  photo: MyPhoto | MyDocument | WebDocument,\n  boxWidth = 0,\n  boxHeight = 0,\n  useBytes = false,\n  pushDocumentSize = false\n) {\n  if(window.devicePixelRatio > 1) {\n    boxWidth *= 2;\n    boxHeight *= 2;\n  }\n\n  /*\n  s box 100x100\n  m box 320x320\n  x box 800x800\n  y box 1280x1280\n  w box 2560x2560\n  a crop  160x160\n  b crop  320x320\n  c crop  640x640\n  d crop  1280x1280 */\n\n  let sizes: PhotoSize[] = (photo as MyPhoto).sizes || (photo as MyDocument).thumbs as PhotoSize[];\n  let bestPhotoSize: typeof sizes[0] = {_: 'photoSizeEmpty', type: THUMB_TYPE_FULL};\n  if(pushDocumentSize && sizes && photo._ !== 'photo') {\n    sizes = sizes.concat({\n      _: 'photoSize',\n      w: photo.w,\n      h: photo.h,\n      size: photo.size,\n      type: THUMB_TYPE_FULL\n    });\n  }\n\n  if(sizes?.length) {\n    for(let i = 0, length = sizes.length; i < length; ++i) {\n      const photoSize = sizes[i];\n      if(!('w' in photoSize) && !('h' in photoSize)) continue;\n\n      bestPhotoSize = photoSize;\n\n      const size = calcImageInBox(photoSize.w, photoSize.h, boxWidth, boxHeight);\n      if(size.width >= boxWidth || size.height >= boxHeight) {\n        break;\n      }\n    }\n\n    if(useBytes && bestPhotoSize._ === 'photoSizeEmpty' && sizes[0]._ === 'photoStrippedSize') {\n      bestPhotoSize = sizes[0];\n    }\n  }\n\n  return bestPhotoSize;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {logger} from '../logger';\nimport createDataChannel from './helpers/createDataChannel';\nimport createPeerConnection from './helpers/createPeerConnection';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\n\nexport type CallConnectionInstanceOptions = {\n  streamManager: StreamManager,\n  connection?: RTCPeerConnection,\n  log?: ReturnType<typeof logger>\n};\n\nexport default abstract class CallConnectionInstanceBase {\n  public connection: RTCPeerConnection;\n  public streamManager: StreamManager;\n  public dataChannel: RTCDataChannel;\n  public description: LocalConferenceDescription;\n  public sources: {\n    audio: Ssrc,\n    video?: Ssrc,\n  };\n  protected negotiating: Promise<void>;\n  protected log: ReturnType<typeof logger>;\n\n  constructor(options: CallConnectionInstanceOptions) {\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = this.connection?.log || logger('CALL-CONNECTION-BASE');\n    }\n\n    this.sources = {} as any;\n  }\n\n  public createPeerConnection(config?: RTCConfiguration) {\n    return this.connection || (this.connection = createPeerConnection(config, this.log.bindPrefix('connection')).connection);\n  }\n\n  public createDataChannel(dict?: RTCDataChannelInit) {\n    return this.dataChannel || (this.dataChannel = createDataChannel(this.connection, dict, this.log.bindPrefix('data')));\n  }\n\n  public createDescription() {\n    return this.description || (this.description = new LocalConferenceDescription(this.connection));\n  }\n\n  public appendStreamToConference() {\n    return this.streamManager.appendToConference(this.description);\n  }\n\n  public closeConnection() {\n    const {connection} = this;\n    if(!connection) {\n      return;\n    }\n\n    try {\n      connection.log('close');\n      connection.close();\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n\n  public closeConnectionAndStream(stopStream: boolean) {\n    this.closeConnection();\n    stopStream && this.streamManager.stop();\n  }\n\n  protected abstract negotiateInternal(): CallConnectionInstanceBase['negotiating'];\n\n  public negotiate() {\n    const promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    return this.negotiating = this.negotiateInternal().finally(() => {\n      this.negotiating = undefined;\n    });\n  }\n\n  public sendDataChannelData(data: any) {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.dataChannel.send(JSON.stringify(data));\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createPeerConnection(config: RTCConfiguration, log?: Logger) {\n  if(!log) {\n    log = logger('RTCPeerConnection');\n  }\n\n  log('constructor');\n\n  // @ts-ignore\n  const connection = new RTCPeerConnection(config);\n  connection.addEventListener('track', (event) => {\n    log('ontrack', event);\n  });\n  connection.addEventListener('signalingstatechange', () => {\n    log('onsignalingstatechange', connection.signalingState);\n  });\n  connection.addEventListener('connectionstatechange', () => {\n    log('onconnectionstatechange', connection.connectionState);\n  });\n  connection.addEventListener('negotiationneeded', () => { // * will be fired every time input device changes\n    log('onnegotiationneeded', connection.signalingState);\n  });\n  connection.addEventListener('icecandidate', (event) => {\n    log('onicecandidate', event);\n  });\n  connection.addEventListener('iceconnectionstatechange', () => {\n    log('oniceconnectionstatechange', connection.iceConnectionState);\n  });\n  connection.addEventListener('datachannel', () => {\n    log('ondatachannel');\n  });\n\n  connection.log = log;\n\n  return {connection};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {Logger, logger} from '../../logger';\n\nexport default function createDataChannel(connection: RTCPeerConnection, dict?: RTCDataChannelInit, log?: Logger) {\n  // return;\n\n  if(!log) {\n    log = logger('RTCDataChannel');\n  }\n\n  const channel = connection.createDataChannel('data', dict);\n\n  channel.addEventListener('message', (e) => {\n    log('onmessage', e);\n  });\n  channel.addEventListener('open', () => {\n    log('onopen');\n  });\n  channel.addEventListener('close', () => {\n    log('onclose');\n  });\n\n  channel.log = log;\n\n  return channel;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport {CallSignalingData, P2PVideoCodec} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function parseSignalingData(sdp: SDP) {\n  const info = parseMediaSectionInfo(sdp, sdp.media[0]);\n\n  const data: CallSignalingData.initialSetup = {\n    '@type': 'InitialSetup',\n    'fingerprints': [info.fingerprint],\n    'ufrag': info.ufrag,\n    'pwd': info.pwd,\n    'audio': undefined,\n    'video': undefined,\n    'screencast': undefined\n  };\n\n  const convertNumber = (number: number) => '' + number;\n\n  for(const section of sdp.media) {\n    const mediaType = section.mediaType;\n    if(mediaType === 'application' || !section.isSending) {\n      continue;\n    }\n\n    const codec: P2PVideoCodec = data[mediaType === 'video' && data['video'] ? 'screencast' : mediaType] = {} as any;\n    const info = parseMediaSectionInfo(sdp, section);\n    codec.ssrc = convertNumber(info.source);\n\n    if(info.sourceGroups) {\n      codec.ssrcGroups = info.sourceGroups.map((sourceGroup) => ({semantics: sourceGroup.semantics, ssrcs: sourceGroup.sources.map(convertNumber)}));\n    }\n\n    const rtpExtensions: P2PVideoCodec['rtpExtensions'] = codec.rtpExtensions = [];\n    section.attributes.get('extmap').forEach((attribute) => {\n      rtpExtensions.push({\n        id: +attribute.key,\n        uri: attribute.value\n      });\n    });\n\n    const payloadTypesMap: Map<number, P2PVideoCodec['payloadTypes'][0]> = new Map();\n\n    const getPayloadType = (id: number) => {\n      let payloadType = payloadTypesMap.get(id);\n      if(!payloadType) {\n        payloadTypesMap.set(id, payloadType = {\n          id\n        } as any);\n      }\n\n      return payloadType;\n    };\n\n    section.attributes.get('rtpmap').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const splitted = attribute.value.split('/');\n      const [name, clockrate, channels] = splitted;\n      payloadType.name = name;\n      payloadType.clockrate = +clockrate;\n      payloadType.channels = channels ? +channels : 0;\n    });\n\n    section.attributes.get('rtcp-fb').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      payloadType.feedbackTypes = attribute.lines.map((line) => {\n        const splitted = line.split(' ');\n        const [type, subtype] = splitted;\n        return {\n          type,\n          subtype: subtype || ''\n        };\n      });\n    });\n\n    section.attributes.get('fmtp').forEach((attribute) => {\n      const id = +attribute.key;\n      const payloadType = getPayloadType(id);\n      const parameters: P2PVideoCodec['payloadTypes'][0]['parameters'] = payloadType.parameters = {};\n      const splitted = attribute.value.split(';');\n      for(const str of splitted) {\n        const [key, value] = str.split('=');\n        parameters[key] = value;\n      }\n    });\n\n    codec.payloadTypes = Array.from(payloadTypesMap.values());\n\n    /* if(codec.payloadTypes.length > 5) {\n      codec.payloadTypes.length = Math.min(codec.payloadTypes.length, 5);\n    } */\n  }\n\n  return data;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport CallInstance from './callInstance';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport {parseSdp} from './sdp/utils';\n\nexport default class CallConnectionInstance extends CallConnectionInstanceBase {\n  private call: CallInstance;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    call: CallConnectionInstance['call']\n  }) {\n    super(options);\n  }\n\n  protected async negotiateInternal() {\n    const {connection, call} = this;\n\n    if(!connection.localDescription && !connection.remoteDescription && !call.isOutgoing) {\n      return;\n    }\n\n    let descriptionInit: RTCSessionDescriptionInit;\n    if(call.offerReceived) {\n      call.offerReceived = false;\n\n      const answer = descriptionInit = await connection.createAnswer();\n\n      this.log('[sdp] local', answer.type, answer.sdp);\n      await connection.setLocalDescription(answer);\n\n      this.log('[InitialSetup] send 2');\n    } else {\n      const offer = descriptionInit = await connection.createOffer();\n\n      this.log('[sdp] local', offer.sdp);\n      await connection.setLocalDescription(offer);\n\n      call.offerSent = true;\n\n      this.log('[InitialSetup] send 0');\n    }\n\n    const initialSetup = parseSignalingData(parseSdp(descriptionInit.sdp));\n    call.sendCallSignalingData(initialSetup);\n  }\n}\n","const subtle = typeof(window) !== 'undefined' && 'crypto' in window ? window.crypto.subtle : self.crypto.subtle;\n\nexport default subtle;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport bufferConcats from '../../../helpers/bytes/bufferConcats';\nimport subtle from '../../crypto/subtle';\nimport sha256 from '../../crypto/utils/sha256';\n\nconst kMaxIncomingPacketSize = 128 * 1024 * 1024;\n\nexport default class P2PEncryptor {\n  private type: 'Signaling';\n  private counter: number;\n  private seqMap: Map<number, number>;\n\n  constructor(private isOutgoing: boolean, private p2pKey: Uint8Array) {\n    this.type = 'Signaling';\n    this.counter = 0;\n    this.seqMap = new Map();\n  }\n\n  private concatSHA256(parts: Uint8Array[]) {\n    return sha256(bufferConcats(...parts));\n  }\n\n  private async encryptPrepared(buffer: Uint8Array) {\n    const result = {\n      counter: 0, // this.counterFromSeq(this.readSeq(buffer)),\n      bytes: new Uint8Array(16 + buffer.length)\n    };\n\n    const x = (this.isOutgoing ? 0 : 8) + (this.type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKeyLarge = await this.concatSHA256([key.subarray(x + 88, x + 88 + 32), buffer]);\n    const msgKey = result.bytes;\n    for(let i = 0; i < 16; ++i) {\n      msgKey[i] = msgKeyLarge[i + 8];\n    }\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const bytes = await this.aesProcessCtr(buffer, buffer.length, aesKeyIv, true);\n\n    result.bytes = new Uint8Array([...result.bytes.subarray(0, 16), ...bytes]);\n\n    return result;\n  }\n\n  public encryptRawPacket(buffer: Uint8Array) {\n    const seq = ++this.counter;\n    const arr = new ArrayBuffer(4);\n    const view = new DataView(arr);\n    view.setUint32(0, seq >>> 0, false); // byteOffset = 0; litteEndian = false\n\n    const result = new Uint8Array([...new Uint8Array(arr), ...buffer]);\n\n    return this.encryptPrepared(result);\n  }\n\n  private async prepareAesKeyIv(key: Uint8Array, msgKey: Uint8Array, x: number) {\n    const [sha256a, sha256b] = await Promise.all([\n      this.concatSHA256([\n        msgKey.subarray(0, 16),\n        key.subarray(x, x + 36)\n      ]),\n\n      this.concatSHA256([\n        key.subarray(40 + x, 40 + x + 36),\n        msgKey.subarray(0, 16)\n      ])\n    ]);\n\n    return {\n      key: new Uint8Array([\n        ...sha256a.subarray(0, 8),\n        ...sha256b.subarray(8, 8 + 16),\n        ...sha256a.subarray(24, 24 + 8)\n      ]),\n      iv: new Uint8Array([\n        ...sha256b.subarray(0, 4),\n        ...sha256a.subarray(8, 8 + 8),\n        ...sha256b.subarray(24, 24 + 4)\n      ])\n    };\n  }\n\n  private async aesProcessCtr(encryptedData: Uint8Array, dataSize: number, aesKeyIv: {key: Uint8Array, iv: Uint8Array}, encrypt = true) {\n    const cryptoKey = await subtle.importKey(\n      'raw',\n      aesKeyIv.key,\n      {name: 'AES-CTR'},\n      false,\n      [encrypt ? 'encrypt' : 'decrypt']\n    );\n\n    const buffer: ArrayBuffer = await subtle[encrypt ? 'encrypt' : 'decrypt']({\n      name: 'AES-CTR',\n      counter: aesKeyIv.iv,\n      length: aesKeyIv.iv.length * 8\n    },\n    cryptoKey,\n    encryptedData\n    );\n\n    return new Uint8Array(buffer);\n  }\n\n  private constTimeIsDifferent(a: Uint8Array, b: Uint8Array, count: number) {\n    let msgKeyEquals = true;\n    for(let i = 0; i < count; ++i) {\n      if(a[i] !== b[i]) {\n        msgKeyEquals = false;\n      }\n    }\n\n    return !msgKeyEquals;\n  }\n\n  public async decryptRawPacket(buffer: Uint8Array) {\n    if(buffer.length < 21 || buffer.length > kMaxIncomingPacketSize) {\n      return;\n    }\n\n    const {isOutgoing, type} = this;\n\n    const x = (isOutgoing ? 8 : 0) + (type === 'Signaling' ? 128 : 0);\n    const key = this.p2pKey;\n\n    const msgKey = buffer.subarray(0, 16);\n    const encryptedData = buffer.subarray(16);\n    const encryptedDataSize = buffer.length - 16;\n\n    const aesKeyIv = await this.prepareAesKeyIv(key, msgKey, x);\n\n    const decryptionBuffer = await this.aesProcessCtr(encryptedData, encryptedDataSize, aesKeyIv, false);\n\n    const msgKeyLarge = await this.concatSHA256([\n      key.subarray(88 + x, 88 + x + 32),\n      decryptionBuffer\n    ]);\n\n    if(this.constTimeIsDifferent(msgKeyLarge.subarray(8), msgKey, 16)) {\n      return;\n    }\n\n    const dataView = new DataView(decryptionBuffer.buffer);\n    const seq = dataView.getUint32(0);\n    if(this.seqMap.has(seq)) {\n      return;\n    }\n    this.seqMap.set(seq, seq);\n\n    return decryptionBuffer.slice(4);\n  }\n}\n","import convertToUint8Array from '../../../helpers/bytes/convertToUint8Array';\nimport subtle from '../subtle';\n// import sha256 from '@cryptography/sha256';\n\nexport default function sha256(bytes: Parameters<typeof convertToUint8Array>[0]) {\n  return subtle.digest('SHA-256', convertToUint8Array(bytes)).then((b) => {\n    // console.log('legacy', performance.now() - perfS);\n    return new Uint8Array(b);\n  });\n  /* //console.log('SHA-256 hash start');\n\n  let perfS = performance.now();\n\n\n  let perfD = performance.now();\n  let words = typeof(bytes) === 'string' ? bytes : bytesToWordss(bytes as any);\n  let hash = sha256(words);\n  console.log('darutkin', performance.now() - perfD);\n\n  //console.log('SHA-256 hash finish', hash, sha256(words, 'hex'));\n\n  return bytesFromWordss(hash); */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport StringFromLineBuilder from '../stringFromLineBuilder';\nimport {addDataChannel, addExtmap, addPayloadTypes, addSsrc} from './p2PSdpBuilder';\n\nexport default class ChromeP2PSdpBuilder {\n  static generateOffer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n\n  static generateAnswer(info: any) {\n    const {fingerprints, ufrag, pwd, audio, video} = info;\n    audio.type = 'audio';\n    video.type = 'video';\n    const media = [audio, video];\n\n    const stringBuilder = new StringFromLineBuilder();\n    stringBuilder.add(\n      'v=0',\n      'o=- 1 2 IN IP4 127.0.0.1',\n      's=-',\n      't=0 0'\n    );\n\n    if(fingerprints) {\n      fingerprints.forEach((x: any) => {\n        const {hash, fingerprint, setup} = x;\n        stringBuilder.add(\n          `a=fingerprint:${hash} ${fingerprint}`,\n          `a=setup:${setup}`\n        );\n      });\n    }\n    if(ufrag && pwd) {\n      stringBuilder.add(\n        `a=ice-ufrag:${ufrag}`,\n        `a=ice-pwd:${pwd}`\n      );\n    }\n\n    stringBuilder.add(\n      'a=group:BUNDLE 0 1 2',\n      'a=extmap-allow-mixed',\n      'a=msid-semantic: WMS *'\n    );\n    const streamName = 'stream' + media.map((x) => x.ssrc).join('_');\n    for(let i = 0; i < media.length; i++) {\n      const m = media[i];\n      const {type, ssrc, ssrcGroups, payloadTypes, rtpExtensions} = m;\n      switch(type) {\n        case 'audio': {\n          stringBuilder.add(\n            `m=audio 56930 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} audio${ssrc}`);\n          }\n          stringBuilder.add(\n            'a=rtcp-mux',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n\n        case 'video': {\n          stringBuilder.add(\n            `m=video 61986 UDP/TLS/RTP/SAVPF ${payloadTypes.map((x: any) => x.id).join(' ')}`,\n            'c=IN IP4 0.0.0.0',\n            'a=rtcp:9 IN IP4 0.0.0.0',\n            'a=ice-options:trickle',\n            `a=mid:${i}`,\n            'a=sendrecv',\n            addExtmap(rtpExtensions)\n          );\n          if(ssrc) {\n            stringBuilder.add(`a=msid:${streamName} video${ssrc}`);\n          }\n\n          stringBuilder.add(\n            'a=rtcp-mux',\n            'a=rtcp-rsize',\n            addPayloadTypes(payloadTypes),\n            addSsrc(type, ssrc, ssrcGroups, streamName)\n          );\n          break;\n        }\n      }\n    }\n    stringBuilder.add(addDataChannel(2));\n    return stringBuilder.finalize();\n  }\n}\n","/*\n*  Copyright (c) 2018-present, Evgeny Nadymov\n*\n* This source code is licensed under the GPL v.3.0 license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n\nimport ChromeP2PSdpBuilder from './chromeP2PSdpBuilder';\nimport { FirefoxP2PSdpBuilder } from './firefoxP2PSdpBuilder';\nimport { SafariP2PSdpBuilder } from './safariP2PSdpBuilder';\n// import { TG_CALLS_SDP_STRING } from '../../Stores/CallStore';\n\nexport function p2pParseCandidate(candidate) {\n  if(!candidate || !candidate.startsWith('candidate:')) {\n    return;\n  }\n  \n  const sdpString = candidate;\n  candidate = candidate.substr('candidate:'.length);\n  \n  const [foundation, component, protocol, priority, ip, port, ...other] = candidate.split(' ');\n  const c = {\n    sdpString,\n    foundation,\n    component,\n    protocol,\n    priority,\n    address: { ip, port }\n  };\n  \n  for(let i = 0; i < other.length; i += 2) {\n    switch(other[i]) {\n      case 'typ': {\n        c.type = other[i + 1];\n        break;\n      }\n      case 'raddr': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.ip = other[i + 1];\n        break;\n      }\n      case 'rport': {\n        if(!c.relAddress) {\n          c.relAddress = {};\n        }\n        \n        c.relAddress.port = other[i + 1];\n        break;\n      }\n      case 'generation': {\n        c.generation = other[i + 1];\n        break;\n      }\n      case 'tcptype': {\n        c.tcpType = other[i + 1];\n        break;\n      }\n      case 'network-id': {\n        c.networkId = other[i + 1];\n        break;\n      }\n      case 'network-cost': {\n        c.networkCost = other[i + 1];\n        break;\n      }\n      case 'ufrag': {\n        c.username = other[i + 1];\n        break;\n      }\n    }\n  }\n  \n  return c;\n}\n\nexport function p2pParseSdp(sdp) {\n  const lines = sdp.split('\\r\\n');\n  const lookup = (prefix, force = true, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return line.substr(prefix.length);\n      }\n    }\n    \n    if (force) {\n      console.error(\"Can't find prefix\", prefix);\n    }\n    \n    return null;\n  };\n  const findIndex = (prefix, lineFrom = 0, lineTo = Number.MAX_VALUE) => {\n    if (lineTo === -1) {\n      lineTo = Number.MAX_VALUE;\n    }\n    for (let i = lineFrom; i < lines.length && i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith(prefix)) {\n        return i;\n      }\n    }\n    \n    return -1;\n  };\n  \n  const pwdIndex = findIndex('a=ice-pwd:');\n  const ufragIndex = findIndex('a=ice-ufrag:');\n  if (pwdIndex === -1 && ufragIndex === -1) {\n    return {\n      // sessionId: lookup('o=').split(' ')[1],\n      ufrag: null,\n      pwd: null,\n      fingerprints: []\n    };\n  }\n  \n  const info = {\n    // sessionId: lookup('o=').split(' ')[1],\n    ufrag: null,\n    pwd: null,\n    fingerprints: []\n  };\n  \n  let mediaIndex = findIndex('m=');\n  const fingerprint = lookup('a=fingerprint:', false);\n  const setup = lookup('a=setup:', false);\n  if (fingerprint && setup) {\n    info.fingerprints.push({\n      hash: fingerprint.split(' ')[0],\n      fingerprint: fingerprint.split(' ')[1],\n      setup\n    });\n  }\n  \n  const ufrag = lookup('a=ice-ufrag:', false);\n  const pwd = lookup('a=ice-pwd:', false);\n  if (ufrag && pwd) {\n    info.ufrag = ufrag;\n    info.pwd = pwd;\n  }\n  \n  while (mediaIndex !== -1) {\n    let nextMediaIndex = findIndex('m=', mediaIndex + 1);\n    \n    const extmap = [];\n    const types = [];\n    const mediaType = lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0];\n    const media = {\n      // type: lookup('m=', true, mediaIndex, nextMediaIndex).split(' ')[0],\n      // mid: lookup('a=mid:', true, mediaIndex, nextMediaIndex),\n      // dir: findDirection(mediaIndex, nextMediaIndex),\n      rtpExtensions: extmap,\n      payloadTypes: types\n    }\n    \n    const lineTo = nextMediaIndex === -1 ? lines.length : nextMediaIndex;\n    const fmtp = new Map();\n    const rtcpFb = new Map();\n    for (let i = mediaIndex; i < lineTo; i++) {\n      const line = lines[i];\n      if (line.startsWith('a=extmap:')) {\n        const [ id, uri ] = line.substr('a=extmap:'.length).split(' ');\n        extmap.push({ id: parseInt(id), uri });\n      } else if (line.startsWith('a=fmtp:')) {\n        const [ id, str ] = line.substr('a=fmtp:'.length).split(' ');\n        const obj = { };\n        const arr =  str.split(';').map(x => {\n          const [ key, value ] = x.split('=');\n          obj[key] = value;\n          return { [key]: value };\n        });\n        fmtp.set(parseInt(id), obj);\n      } else if (line.startsWith('a=rtcp-fb:')) {\n        const [ id, type = '', subtype = '' ] = line.substr('a=rtcp-fb:'.length).split(' ');\n        if (rtcpFb.has(parseInt(id))) {\n          rtcpFb.get(parseInt(id)).push({ type, subtype });\n        } else {\n          rtcpFb.set(parseInt(id), [{ type, subtype }])\n        }\n      } else if (line.startsWith('a=rtpmap')) {\n        const [ id, str ] = line.substr('a=rtpmap:'.length).split(' ');\n        const [ name, clockrate, channels = '0' ] = str.split('/');\n        const obj = { id: parseInt(id), name, clockrate: parseInt(clockrate), channels: parseInt(channels) };\n        \n        types.push(obj);\n      }\n    }\n    \n    for (let i = 0; i < types.length; i++) {\n      const { id } = types[i];\n      if (rtcpFb.has(id)) {\n        types[i].feedbackTypes = rtcpFb.get(id);\n      }\n      if (fmtp.has(id)) {\n        types[i].parameters = fmtp.get(id);\n      }\n    }\n    \n    const ssrc = lookup('a=ssrc:', false, mediaIndex, nextMediaIndex);\n    if (ssrc) {\n      media.ssrc = ssrc.split(' ')[0];\n    }\n    \n    const ssrcGroup = lookup('a=ssrc-group:', false, mediaIndex, nextMediaIndex);\n    if (ssrcGroup) {\n      const [ semantics, ...ssrcs ] = ssrcGroup.split(' ');\n      media.ssrcGroups = [{\n        semantics,\n        ssrcs\n      }]\n    }\n    \n    switch (mediaType) {\n      case 'audio': {\n        info.audio = media;\n        break;\n      }\n      case 'video': {\n        info.video = media;\n        break;\n      }\n    }\n    \n    mediaIndex = nextMediaIndex;\n  }\n\n  if(!info.video.ssrcGroups) {\n    info.video.ssrcGroups = [];\n  }\n\n  info['@type'] = 'InitialSetup';\n  \n  // console.log('[p2pParseSdp]', sdp, info);\n  return info;\n}\n\nexport function isFirefox() {\n  return navigator.userAgent.toLowerCase().indexOf('firefox') > -1;\n}\n\nfunction isSafari() {\n  return navigator.userAgent.toLowerCase().indexOf('safari') > -1 && navigator.userAgent.toLowerCase().indexOf('chrome') === -1;\n}\n\nexport function addExtmap(extmap) {\n  let sdp = [];\n  // return sdp;\n  for (let j = 0; j < extmap.length; j++) {\n    const ext = extmap[j];\n    const { id, uri } = ext;\n    // if (isFirefox() && uri.indexOf(''))\n    console.log('[extmap] add', id, uri);\n    sdp.push(`a=extmap:${id} ${uri}`);\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addPayloadTypes(types) {\n  let sdp = [];\n  console.log('[SDP] addPayloadTypes', types);\n  for (let i = 0; i < types.length; i++) {\n    const type = types[i];\n    const { id, name, clockrate, channels, feedbackTypes, parameters } = type;\n    sdp.push(`a=rtpmap:${id} ${name}/${clockrate}${channels ? '/' + channels : ''}`);\n    if (feedbackTypes) {\n      feedbackTypes.forEach(x => {\n        const { type, subtype } = x;\n        sdp.push(`a=rtcp-fb:${id} ${[type, subtype].join(' ')}`);\n      });\n    }\n    if (parameters) {\n      const fmtp = [];\n      Object.getOwnPropertyNames(parameters).forEach(pName => {\n        fmtp.push(`${pName}=${parameters[pName]}`);\n      });\n      \n      sdp.push(`a=fmtp:${id} ${fmtp.join(';')}`);\n    }\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addSsrc(type, ssrc, ssrcGroups, streamName) {\n  let sdp = [];\n  \n  if (ssrcGroups && ssrcGroups.length > 0) {\n    ssrcGroups.forEach(ssrcGroup => {\n      if (ssrcGroup && ssrcGroup.ssrcs.length > 0) {\n        sdp.push(`a=ssrc-group:${ssrcGroup.semantics} ${ssrcGroup.ssrcs.join(' ')}`);\n        ssrcGroup.ssrcs.forEach(ssrc => {\n          sdp.push(\n            `a=ssrc:${ssrc} cname:stream${ssrc}`,\n            `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n            `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n            `a=ssrc:${ssrc} label:${type}${ssrc}`\n          );\n        });\n      }\n    });\n  } else if (ssrc) {\n    sdp.push(\n      `a=ssrc:${ssrc} cname:stream${ssrc}`,\n      `a=ssrc:${ssrc} msid:${streamName} ${type}${ssrc}`,\n      `a=ssrc:${ssrc} mslabel:${type}${ssrc}`,\n      `a=ssrc:${ssrc} label:${type}${ssrc}`\n    );\n  }\n  \n  return sdp.join('\\n');\n}\n\nexport function addDataChannel(mid) {\n  return `m=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:2\na=sctp-port:5000\na=max-message-size:262144`;\n}\n\nexport class P2PSdpBuilder {\n  static generateCandidate(info) {\n    if (!info) return null;\n    \n    const { sdpString, sdpMLineIndex, sdpMid, foundation, component, protocol, priority, address, type, relAddress, generation, tcpType, networkId, networkCost, username } = info;\n    if (/* TG_CALLS_SDP_STRING */true) {\n      if (sdpString) {\n        return {\n          candidate: sdpString,\n          sdpMLineIndex,\n          sdpMid\n        };\n      }\n    }\n    throw 'no sdpString';\n    \n    let candidate = `candidate:${foundation} ${component} ${protocol} ${priority} ${address.ip} ${address.port}`;\n    const attrs = []\n    if (type) {\n      attrs.push(`typ ${type}`);\n    }\n    if (relAddress) {\n      attrs.push(`raddr ${relAddress.ip}`);\n      attrs.push(`rport ${relAddress.port}`);\n    }\n    if (tcpType) {\n      attrs.push(`tcptype ${tcpType}`);\n    }\n    if (generation) {\n      attrs.push(`generation ${generation}`);\n    }\n    if (username) {\n      attrs.push(`ufrag ${username}`);\n    }\n    if (networkId) {\n      attrs.push(`network-id ${networkId}`);\n    }\n    if (networkCost) {\n      attrs.push(`network-cost ${networkCost}`);\n    }\n    if (attrs.length > 0) {\n      candidate += ` ${attrs.join(' ')}`;\n    }\n    \n    return { candidate, sdpMid, sdpMLineIndex };\n  }\n  \n  static generateOffer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateOffer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateOffer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateOffer(info);\n  }\n  \n  static generateAnswer(info) {\n    if (isFirefox()) {\n      return FirefoxP2PSdpBuilder.generateAnswer(info);\n    } else if (isSafari()) {\n      return SafariP2PSdpBuilder.generateAnswer(info);\n    }\n    \n    return ChromeP2PSdpBuilder.generateAnswer(info);\n  }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class FirefoxP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        let sdp = `v=0\no=- 1 0 IN IP4 0.0.0.0\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=ice-options:trickle\na=msid-semantic:WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, mid, ssrc, ssrcGroups, payloadTypes, dir, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n *  Copyright (c) 2018-present, Evgeny Nadymov\n *\n * This source code is licensed under the GPL v.3.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { addDataChannel, addExtmap, addPayloadTypes, addSsrc } from './p2PSdpBuilder';\n\nexport class SafariP2PSdpBuilder {\n    static generateOffer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n\n    static generateAnswer(info) {\n        const { fingerprints, ufrag, pwd, audio, video } = info;\n        audio.type = 'audio';\n        video.type = 'video';\n        const media = [audio, video];\n\n        if (!media.length) {\n            return `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=msid-semantic: WMS\n`;\n        }\n\n        let sdp = `v=0\no=- 1 2 IN IP4 127.0.0.1\ns=-\nt=0 0`;\n        if (fingerprints) {\n            fingerprints.forEach(x => {\n                const { hash, fingerprint, setup } = x;\n                sdp += `\na=fingerprint:${hash} ${fingerprint}\na=setup:${setup}`;\n            });\n        }\n        if (ufrag && pwd) {\n            sdp += `\na=ice-ufrag:${ufrag}\na=ice-pwd:${pwd}`;\n        }\n\n        sdp += `\na=group:BUNDLE 0 1 2\na=extmap-allow-mixed\na=msid-semantic: WMS *`;\n        const streamName = 'stream' + media.map(x => x.ssrc).join('_');\n        for (let i = 0; i < media.length; i++) {\n            const m = media[i];\n            const { type, ssrc, ssrcGroups, payloadTypes, rtpExtensions } = m;\n            switch (type) {\n                case 'audio': {\n                    sdp += `\nm=audio 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} audio${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n\n                    break;\n                }\n                case 'video': {\n                    sdp += `\nm=video 9 UDP/TLS/RTP/SAVPF ${payloadTypes.map(x => x.id).join(' ')}\nc=IN IP4 0.0.0.0\na=rtcp:9 IN IP4 0.0.0.0\na=ice-options:trickle\na=mid:${i}\na=sendrecv`;\n                    sdp += addExtmap(rtpExtensions);\n                    if (ssrc) {\n                        sdp += `\na=msid:${streamName} video${ssrc}`;\n                    }\n                    sdp += `\na=rtcp-mux\na=rtcp-rsize`;\n                    sdp += addPayloadTypes(payloadTypes);\n                    sdp += addSsrc(type, ssrc, ssrcGroups, streamName);\n                    break;\n                }\n            }\n        }\n        sdp += addDataChannel(2);\n        sdp += `\n`;\n\n        return sdp;\n    }\n}","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport ctx from '../../environment/ctx';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport debounce from '../../helpers/schedulers/debounce';\nimport {GroupCallParticipantVideoSourceGroup, PhoneCall, PhoneCallDiscardReason, PhoneCallProtocol, Update} from '../../layer';\nimport {emojiFromCodePoints} from '../../vendor/emoji';\nimport type {CallId} from '../appManagers/appCallsManager';\nimport type {AppManagers} from '../appManagers/managers';\nimport {logger} from '../logger';\nimport apiManagerProxy from '../mtproto/mtprotoworker';\nimport CallConnectionInstance from './callConnectionInstance';\nimport CallInstanceBase from './callInstanceBase';\nimport callsController from './callsController';\nimport CALL_STATE from './callState';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from './constants';\nimport parseSignalingData from './helpers/parseSignalingData';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription, {ConferenceEntry, generateSsrc} from './localConferenceDescription';\nimport getCallProtocol from './p2P/getCallProtocol';\nimport getRtcConfiguration from './p2P/getRtcConfiguration';\nimport P2PEncryptor from './p2P/p2PEncryptor';\nimport {p2pParseCandidate, P2PSdpBuilder} from './p2P/p2PSdpBuilder';\nimport {parseSdp} from './sdp/utils';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {AudioCodec, CallMediaState, CallSignalingData, DiffieHellmanInfo, P2PAudioCodec, P2PVideoCodec, VideoCodec} from './types';\n\nexport default class CallInstance extends CallInstanceBase<{\n  state: (state: CALL_STATE) => void,\n  id: (id: CallId, prevId: CallId) => void,\n  muted: (muted: boolean) => void,\n  mediaState: (mediaState: CallMediaState) => void,\n  acceptCallOverride: () => Promise<boolean>,\n}> {\n  public dh: Partial<DiffieHellmanInfo.a & DiffieHellmanInfo.b>;\n  public id: CallId;\n  public call: PhoneCall;\n  public interlocutorUserId: UserId;\n  public protocol: PhoneCallProtocol;\n  public isOutgoing: boolean;\n  public encryptionKey: Uint8Array;\n  public connectionInstance: CallConnectionInstance;\n  public encryptor: P2PEncryptor;\n  public decryptor: P2PEncryptor;\n  public candidates: RTCIceCandidate[];\n\n  public offerReceived: boolean;\n  public offerSent: boolean;\n\n  public createdParticipantEntries: boolean;\n  public release: () => Promise<void>;\n  public _connectionState: CALL_STATE;\n\n  public createdAt: number;\n  public connectedAt: number;\n  public discardReason: string;\n\n  private managers: AppManagers;\n\n  private hangUpTimeout: number;\n\n  private mediaStates: {\n    input: CallMediaState,\n    output?: CallMediaState\n  };\n\n  private sendMediaState: () => Promise<void>;\n\n  private decryptQueue: Uint8Array[];\n\n  private getEmojisFingerprintPromise: Promise<CallInstance['emojisFingerprint']>;\n  private emojisFingerprint: [string, string, string, string];\n\n  private wasStartingScreen: boolean;\n  private wasStartingVideo: boolean;\n  public wasTryingToJoin: boolean;\n\n  public streamManager: StreamManager;\n\n  constructor(options: {\n    isOutgoing: boolean,\n    interlocutorUserId: UserId,\n    managers: CallInstance['managers'],\n    protocol?: PhoneCallProtocol\n  }) {\n    super();\n\n    this.log = logger('CALL');\n\n    if(!this.protocol) {\n      this.protocol = getCallProtocol();\n    }\n\n    safeAssign(this, options);\n\n    this.createdAt = Date.now();\n    this.offerReceived = false;\n    this.offerSent = false;\n    this.decryptQueue = [];\n    this.candidates = [];\n\n    this.addEventListener('state', (state) => {\n      this.log('state', CALL_STATE[state]);\n\n      if(state === CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n\n    const streamManager = this.streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n    streamManager.direction = 'sendrecv';\n    streamManager.types.push('screencast');\n    if(!this.isOutgoing) {\n      streamManager.locked = true;\n      streamManager.canCreateConferenceEntry = false;\n    }\n\n    let mediaState: CallMediaState = {\n      '@type': 'MediaState',\n      'type': 'input',\n      'lowBattery': false,\n      'muted': true,\n      'screencastState': 'inactive',\n      'videoRotation': 0,\n      'videoState': 'inactive'\n    };\n\n    const self = this;\n    mediaState = new Proxy(mediaState, {\n      set: function(target, key, value) {\n        // @ts-ignore\n        target[key] = value;\n        self.setMediaState(mediaState);\n        self.sendMediaState();\n        return true;\n      }\n    });\n\n    this.mediaStates = {\n      input: mediaState\n    };\n\n    this.sendMediaState = debounce(this._sendMediaState.bind(this), 0, false, true);\n  }\n\n  get connectionState() {\n    const {_connectionState, connectionInstance} = this;\n    if(_connectionState !== undefined) {\n      return _connectionState;\n    } else if(!connectionInstance) {\n      return CALL_STATE.CONNECTING;\n    } else {\n      const {iceConnectionState} = connectionInstance.connection;\n      if(iceConnectionState === 'closed') {\n        return CALL_STATE.CLOSED;\n      } else if(iceConnectionState !== 'connected' && (!IS_SAFARI || iceConnectionState !== 'completed')) {\n        return CALL_STATE.CONNECTING;\n      } else {\n        return CALL_STATE.CONNECTED;\n      }\n    }\n  }\n\n  get sortIndex() {\n    const connectionState = this.connectionState;\n    const state = CALL_STATE.CLOSED - connectionState + 1;\n    let index = state * 10000000000000;\n    index += 2147483647000 - (connectionState === CALL_STATE.PENDING && this.isOutgoing ? 0 : this.createdAt);\n    return index;\n  }\n\n  public getVideoElement(type: CallMediaState['type']) {\n    if(type === 'input') return this.elements.get('main');\n    else {\n      const mediaState = this.getMediaState('output');\n      if(!mediaState) {\n        return;\n      }\n\n      const type: WebRTCLineType = mediaState.videoState === 'active' ? 'video' : (mediaState.screencastState === 'active' ? 'screencast' : undefined);\n      if(!type) {\n        return;\n      }\n\n      const entry = this.description.findEntry((entry) => entry.type === type);\n      if(!entry) {\n        return;\n      }\n\n      return this.elements.get('' + entry.recvEntry.source);\n    }\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      this.wasStartingScreen = true;\n      this.wasStartingVideo = false;\n      this.streamManager.types = ['audio', 'screencast'];\n      await this.requestScreen();\n    } catch(err) {\n      this.log.error('startScreenSharing error', err);\n    }\n  }\n\n  public async toggleScreenSharing() {\n    if(this.isSharingVideo) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingScreen) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startScreenSharingInternal();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    try {\n      this.wasStartingScreen = false;\n      this.wasStartingVideo = true;\n      this.streamManager.types = ['audio', 'video'];\n      await this.requestInputSource(false, true, false);\n    } catch(err) {\n      this.log.error('startVideoSharing error', err);\n    }\n  }\n\n  public async stopVideoSharing() {\n    const mediaState = this.getMediaState('input');\n    mediaState.videoState = mediaState.screencastState = 'inactive';\n\n    const {streamManager, description} = this;\n    const track = streamManager.inputStream.getVideoTracks()[0];\n    if(track) {\n      stopTrack(track);\n      streamManager.appendToConference(description); // clear sender track\n    }\n  }\n\n  public async toggleVideoSharing() {\n    if(this.isSharingScreen) {\n      await this.stopVideoSharing();\n    }\n\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharingInternal();\n    }\n  }\n\n  public getMediaState(type: CallMediaState['type']) {\n    return this.mediaStates[type];\n  }\n\n  public setMediaState(mediaState: CallMediaState) {\n    this.mediaStates[mediaState.type] = mediaState;\n    this.dispatchEvent('mediaState', mediaState);\n  }\n\n  public isSharingVideoType(type: 'video' | 'screencast') {\n    try {\n      const hasVideoTrack = super.isSharingVideo;\n      return hasVideoTrack && !!((this.wasStartingScreen && type === 'screencast') || (this.wasStartingVideo && type === 'video'));\n\n      // ! it will be used before the track appears\n      // return !!this.description.entries.find((entry) => entry.type === type && entry.transceiver.sender.track.enabled);\n    } catch(err) {\n      return false;\n    }\n  }\n\n  public get isSharingVideo() {\n    return this.isSharingVideoType('video');\n  }\n\n  public get isSharingScreen() {\n    return this.isSharingVideoType('screencast');\n  }\n\n  public get isMuted() {\n    const audioTrack = this.streamManager.inputStream.getAudioTracks()[0];\n    return !audioTrack?.enabled;\n  }\n\n  public get isClosing() {\n    const {connectionState} = this;\n    return connectionState === CALL_STATE.CLOSING || connectionState === CALL_STATE.CLOSED;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connectionInstance?.description;\n  }\n\n  public setHangUpTimeout(timeout: number, reason: PhoneCallDiscardReason['_']) {\n    this.clearHangUpTimeout();\n    this.hangUpTimeout = ctx.setTimeout(() => {\n      this.hangUpTimeout = undefined;\n      this.hangUp(reason);\n    }, timeout);\n  }\n\n  public clearHangUpTimeout() {\n    if(this.hangUpTimeout !== undefined) {\n      clearTimeout(this.hangUpTimeout);\n      this.hangUpTimeout = undefined;\n    }\n  }\n\n  public setPhoneCall(phoneCall: PhoneCall) {\n    this.call = phoneCall;\n\n    const {id} = phoneCall;\n    if(this.id !== id) {\n      const prevId = this.id;\n      this.id = id;\n      this.dispatchEvent('id', id, prevId);\n    }\n  }\n\n  public async acceptCall() {\n    const canAccept = (await Promise.all(this.dispatchResultableEvent('acceptCallOverride')))[0] ?? true;\n    if(this.isClosing || !canAccept) {\n      return;\n    }\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n\n    const call = this.call as PhoneCall.phoneCallRequested;\n    this.requestInputSource(true, !!call.pFlags.video, false);\n\n    const g_a_hash = call.g_a_hash;\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\n      this.dh = { // ! it is correct\n        g_a_hash,\n        b: dh.a,\n        g_b: dh.g_a,\n        g_b_hash: dh.g_a_hash,\n        p: dh.p\n      };\n\n      return this.managers.apiManager.invokeApi('phone.acceptCall', {\n        peer: await this.managers.appCallsManager.getCallInput(this.id),\n        protocol: this.protocol,\n        g_b: this.dh.g_b\n      });\n    }).then(async(phonePhoneCall) => {\n      await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    }).catch((err) => {\n      this.log.error('accept call error', err);\n      // if(err.type === 'CALL_PROTOCOL_COMPAT_LAYER_INVALID') {\n\n      // }\n\n      this.hangUp('phoneCallDiscardReasonHangup');\n    });\n  }\n\n  public joinCall() {\n    this.log('joinCall');\n\n    this.getEmojisFingerprint();\n\n    this.overrideConnectionState();\n\n    const {isOutgoing, encryptionKey, streamManager} = this;\n\n    const configuration = getRtcConfiguration(this.call as PhoneCall.phoneCall);\n    this.log('joinCall configuration', configuration);\n    if(!configuration) return;\n\n    const connectionInstance = this.connectionInstance = new CallConnectionInstance({\n      call: this,\n      streamManager,\n      log: this.log.bindPrefix('connection')\n    });\n\n    const connection = connectionInstance.createPeerConnection(configuration);\n    connection.addEventListener('iceconnectionstatechange', () => {\n      const state = this.connectionState;\n      if(this.connectedAt === undefined && state === CALL_STATE.CONNECTED) {\n        this.connectedAt = Date.now();\n      }\n\n      this.dispatchEvent('state', state);\n    });\n    connection.addEventListener('negotiationneeded', () => {\n      connectionInstance.negotiate();\n    });\n    connection.addEventListener('icecandidate', (event) => {\n      const {candidate} = event;\n      connection.log('onicecandidate', candidate);\n      if(candidate?.candidate) {\n        this.sendIceCandidate(candidate);\n      }\n    });\n    connection.addEventListener('track', (event) => {\n      const {track} = event;\n      connection.log('ontrack', track);\n      this.onTrack(event);\n    });\n\n    const description = connectionInstance.createDescription();\n\n    this.encryptor = new P2PEncryptor(isOutgoing, encryptionKey);\n    this.decryptor = new P2PEncryptor(!isOutgoing, encryptionKey);\n\n    this.log('currentCall', this);\n\n    if(isOutgoing) {\n      connectionInstance.appendStreamToConference();\n    }\n\n    this.createDataChannel();\n\n    this.processDecryptQueue();\n  }\n\n  private createDataChannelEntry() {\n    const dataChannelEntry = this.description.createEntry('application');\n    dataChannelEntry.setDirection('sendrecv');\n    dataChannelEntry.sendEntry = dataChannelEntry.recvEntry = dataChannelEntry;\n  }\n\n  private createDataChannel() {\n    if(this.connectionInstance.dataChannel) {\n      return;\n    }\n\n    const channel = this.connectionInstance.createDataChannel({\n      id: 0,\n      negotiated: true\n    });\n    channel.addEventListener('message', (e) => {\n      this.applyDataChannelData(JSON.parse(e.data));\n    });\n    channel.addEventListener('open', () => {\n      this.sendMediaState();\n    });\n  }\n\n  private applyDataChannelData(data: CallMediaState) {\n    switch(data['@type']) {\n      case 'MediaState': {\n        data.type = 'output';\n        this.log('got output media state', data);\n        this.setMediaState(data);\n        break;\n      }\n\n      default:\n        this.log.error('unknown data channel data:', data);\n        break;\n    }\n  }\n\n  private _sendMediaState() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) return;\n\n    const mediaState = {...this.getMediaState('input')};\n    // mediaState.videoRotation = 90;\n    delete mediaState.type;\n    this.log('sendMediaState', mediaState);\n\n    connectionInstance.sendDataChannelData(mediaState);\n  }\n\n  public async sendCallSignalingData(data: CallSignalingData) {\n    /* if(data['@type'] === 'InitialSetup') {\n      this.filterNotVP8(data);\n    } */\n\n    const json = JSON.stringify(data);\n    const arr = new TextEncoder().encode(json);\n    const {bytes} = await this.encryptor.encryptRawPacket(arr);\n\n    this.log('sendCallSignalingData', this.id, json);\n    await this.managers.apiManager.invokeApi('phone.sendSignalingData', {\n      peer: await this.managers.appCallsManager.getCallInput(this.id),\n      data: bytes\n    });\n  }\n\n  public sendIceCandidate(iceCandidate: RTCIceCandidate) {\n    this.log('sendIceCandidate', iceCandidate);\n    const {candidate, sdpMLineIndex} = iceCandidate;\n    if(sdpMLineIndex !== 0) {\n      return;\n    }\n\n    const parsed = p2pParseCandidate(candidate);\n    // const parsed = {sdpString: candidate};\n    /* if(parsed.address.ip !== '') {\n      return;\n    } */\n\n    this.sendCallSignalingData({\n      '@type': 'Candidates',\n      'candidates': [parsed]\n    });\n  }\n\n  public async confirmCall() {\n    const {protocol, id, call} = this;\n    const dh = this.dh as DiffieHellmanInfo.a;\n\n    // this.clearHangUpTimeout();\n    this.overrideConnectionState(CALL_STATE.EXCHANGING_KEYS);\n    const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey((call as PhoneCall.phoneCallAccepted).g_b, dh.a, dh.p);\n\n    const phonePhoneCall = await this.managers.apiManager.invokeApi('phone.confirmCall', {\n      peer: await this.managers.appCallsManager.getCallInput(id),\n      protocol: protocol,\n      g_a: dh.g_a,\n      key_fingerprint: key_fingerprint\n    });\n\n    this.encryptionKey = key;\n    await this.managers.appCallsManager.savePhonePhoneCall(phonePhoneCall);\n    this.joinCall();\n  }\n\n  public getEmojisFingerprint() {\n    if(this.emojisFingerprint) return this.emojisFingerprint;\n    if(this.getEmojisFingerprintPromise) return this.getEmojisFingerprintPromise;\n    return this.getEmojisFingerprintPromise = apiManagerProxy.invokeCrypto('get-emojis-fingerprint', this.encryptionKey, this.dh.g_a).then((codePoints) => {\n      this.getEmojisFingerprintPromise = undefined;\n      return this.emojisFingerprint = codePoints.map((codePoints) => emojiFromCodePoints(codePoints)) as [string, string, string, string];\n    });\n  }\n\n  private unlockStreamManager() {\n    this.connectionInstance.streamManager.locked = false;\n    this.connectionInstance.appendStreamToConference();\n  }\n\n  private async doTheMagic() {\n    this.connectionInstance.appendStreamToConference();\n\n    const connection = this.connectionInstance.connection;\n\n    let answer = await connection.createAnswer();\n\n    this.log('[sdp] local', answer.type, answer.sdp);\n    await connection.setLocalDescription(answer);\n\n    connection.getTransceivers().filter((transceiver) => transceiver.direction === 'recvonly').forEach((transceiver) => {\n      const entry = this.connectionInstance.description.getEntryByMid(transceiver.mid);\n      entry.transceiver = entry.recvEntry.transceiver = transceiver;\n      transceiver.direction = 'sendrecv';\n    });\n\n    const isAnswer = false;\n\n    const description = this.description;\n    const bundle = description.entries.map((entry) => entry.mid);\n    const sdpDescription: RTCSessionDescriptionInit = {\n      type: isAnswer ? 'answer' : 'offer',\n      sdp: description.generateSdp({\n        bundle,\n        entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n        // isAnswer: isAnswer\n        isAnswer: !isAnswer\n      })\n    };\n\n    await connection.setRemoteDescription(sdpDescription);\n\n    answer = await connection.createAnswer();\n\n    await connection.setLocalDescription(answer);\n\n    const initialSetup = parseSignalingData(parseSdp(answer.sdp));\n    this.log('[InitialSetup] send 1');\n    this.sendCallSignalingData(initialSetup);\n\n    this.unlockStreamManager();\n  }\n\n  public overrideConnectionState(state?: CALL_STATE) {\n    this._connectionState = state;\n    this.dispatchEvent('state', this.connectionState);\n  }\n\n  public get duration() {\n    return this.connectedAt !== undefined ? (Date.now() - this.connectedAt) / 1000 | 0 : 0;\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    super.onInputStream(stream);\n\n    const videoTrack = stream.getVideoTracks()[0];\n    if(videoTrack) {\n      const state = this.getMediaState('input');\n\n      // handle starting camera\n      if(!this.wasStartingScreen && !this.wasStartingVideo) {\n        this.wasStartingVideo = true;\n      }\n\n      if(this.isSharingVideo) {\n        state.videoState = 'active';\n      } else if(this.isSharingScreen) {\n        state.screencastState = 'active';\n      }\n\n      videoTrack.addEventListener('ended', () => {\n        this.stopVideoSharing();\n      }, {once: true});\n    }\n\n    if(stream.getAudioTracks().length) {\n      this.onMutedChange();\n    }\n  }\n\n  private onMutedChange() {\n    const isMuted = this.isMuted;\n    this.dispatchEvent('muted', isMuted);\n\n    const state = this.getMediaState('input');\n    state.muted = isMuted;\n  }\n\n  public toggleMuted(): Promise<void> {\n    return this.requestAudioSource(true).then(() => {\n      this.setMuted();\n      this.onMutedChange();\n    });\n  }\n\n  public async hangUp(discardReason?: PhoneCallDiscardReason['_'], discardedByOtherParty?: boolean) {\n    if(this.isClosing) {\n      return;\n    }\n\n    this.discardReason = discardReason;\n    this.log('hangUp', discardReason);\n    this.overrideConnectionState(CALL_STATE.CLOSED);\n\n    if(this.connectionInstance) {\n      this.connectionInstance.closeConnectionAndStream(true);\n    }\n\n    if(discardReason && !discardedByOtherParty) {\n      let hasVideo = false;\n      for(const type in this.mediaStates) {\n        const mediaState = this.mediaStates[type as 'input' | 'output'];\n        hasVideo = mediaState.videoState === 'active' || mediaState.screencastState === 'active' || hasVideo;\n      }\n\n      await this.managers.appCallsManager.discardCall(this.id, this.duration, discardReason, hasVideo);\n    }\n  }\n\n  private performCodec(_codec: P2PAudioCodec | P2PVideoCodec) {\n    const payloadTypes: AudioCodec['payload-types'] = _codec.payloadTypes.map((payloadType) => {\n      return {\n        ...payloadType,\n        'rtcp-fbs': payloadType.feedbackTypes\n      }\n    });\n\n    const codec: AudioCodec = {\n      'rtp-hdrexts': _codec.rtpExtensions,\n      'payload-types': payloadTypes\n    };\n\n    return codec;\n  }\n\n  private setDataToDescription(data: CallSignalingData.initialSetup) {\n    this.description.setData({\n      transport: {\n        'pwd': data.pwd,\n        'ufrag': data.ufrag,\n        'fingerprints': data.fingerprints,\n        'rtcp-mux': true\n      },\n      audio: this.performCodec(data.audio),\n      video: data.video ? this.performCodec(data.video) as VideoCodec : undefined,\n      screencast: data.screencast ? this.performCodec(data.screencast) as VideoCodec : undefined\n    });\n  }\n\n  private filterNotVP8(initialSetup: CallSignalingData.initialSetup) {\n    if(!this.isOutgoing) { // only VP8 works now\n      [initialSetup.video, initialSetup.screencast].filter(Boolean).forEach((codec) => {\n        const payloadTypes = codec.payloadTypes;\n        const idx = payloadTypes.findIndex((payloadType) => payloadType.name === 'VP8');\n        const vp8PayloadType = payloadTypes[idx];\n        const rtxIdx = payloadTypes.findIndex((payloadType) => +payloadType.parameters?.apt === vp8PayloadType.id);\n        codec.payloadTypes = [payloadTypes[idx], payloadTypes[rtxIdx]];\n      });\n    }\n  }\n\n  public async applyCallSignalingData(data: CallSignalingData) {\n    this.log('applyCallSignalingData', this, data);\n\n    const {connection, description} = this.connectionInstance;\n\n    switch(data['@type']) {\n      case 'InitialSetup': {\n        this.log('[sdp] InitialSetup', data);\n\n        this.filterNotVP8(data);\n        this.setDataToDescription(data);\n\n        const performSsrcGroups = (ssrcGroups: P2PVideoCodec['ssrcGroups']): GroupCallParticipantVideoSourceGroup[] => {\n          return ssrcGroups.map((ssrcGroup) => {\n            return {\n              _: 'groupCallParticipantVideoSourceGroup',\n              semantics: ssrcGroup.semantics,\n              sources: ssrcGroup.ssrcs.map((source) => +source)\n            };\n          });\n        };\n\n        const ssrcs = [\n          generateSsrc('audio', +data.audio.ssrc),\n          data.video ? generateSsrc('video', performSsrcGroups(data.video.ssrcGroups)) : undefined,\n          data.screencast ? generateSsrc('screencast', performSsrcGroups(data.screencast.ssrcGroups)) : undefined\n        ].filter(Boolean);\n\n        ssrcs.forEach((ssrc) => {\n          let entry = description.getEntryBySource(ssrc.source);\n          if(entry) {\n            return;\n          }\n\n          const sendRecvEntry = description.findFreeSendRecvEntry(ssrc.type, false);\n          entry = new ConferenceEntry(sendRecvEntry.mid, ssrc.type);\n          entry.setDirection('sendrecv');\n          sendRecvEntry.recvEntry = entry;\n\n          description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n        });\n\n        this.createDataChannelEntry();\n\n        const isAnswer = this.offerSent;\n        this.offerSent = false;\n\n        const bundle = description.entries.map((entry) => entry.mid);\n        const sdpDescription: RTCSessionDescriptionInit = {\n          type: isAnswer ? 'answer' : 'offer',\n          sdp: description.generateSdp({\n            bundle,\n            entries: description.entries.filter((entry) => bundle.includes(entry.mid)),\n            // isAnswer: isAnswer\n            isAnswer: !isAnswer\n          })\n        };\n\n        this.log('[sdp] remote', sdpDescription.sdp);\n\n        await connection.setRemoteDescription(sdpDescription);\n\n        await this.tryToReleaseCandidates();\n\n        if(!isAnswer) {\n          await this.doTheMagic();\n        }\n\n        break;\n      }\n\n      case 'Candidates': {\n        for(const candidate of data.candidates) {\n          const init: RTCIceCandidateInit = P2PSdpBuilder.generateCandidate(candidate);\n          init.sdpMLineIndex = 0;\n          const iceCandidate = new RTCIceCandidate(init);\n          this.candidates.push(iceCandidate);\n        }\n\n        await this.tryToReleaseCandidates();\n        break;\n      }\n\n      default: {\n        this.log.error('unrecognized signaling data', data);\n      }\n    }\n  }\n\n  public async tryToReleaseCandidates() {\n    const {connectionInstance} = this;\n    if(!connectionInstance) {\n      return;\n    }\n\n    const {connection} = connectionInstance;\n    if(connection.remoteDescription) {\n      const promises: Promise<void>[] = this.candidates.map((candidate) => this.addIceCandidate(connection, candidate));\n      this.candidates.length = 0;\n\n      await Promise.all(promises);\n    } else {\n      this.log('[candidates] postpone');\n    }\n  }\n\n  private async addIceCandidate(connection: RTCPeerConnection, candidate: RTCIceCandidate) {\n    this.log('[candidate] start', candidate);\n    try {\n      // if(!candidate.address) return;\n      await connection.addIceCandidate(candidate);\n      this.log('[candidate] add', candidate);\n    } catch(e) {\n      this.log.error('[candidate] error', candidate, e);\n    }\n  }\n\n  private async processDecryptQueue() {\n    const {encryptor} = this;\n    if(!encryptor) {\n      this.log.warn('got encrypted signaling data before the encryption key');\n      return;\n    }\n\n    const length = this.decryptQueue.length;\n    if(!length) {\n      return;\n    }\n\n    const queue = this.decryptQueue.slice();\n    this.decryptQueue.length = 0;\n\n    for(const data of queue) {\n      const decryptedData = await encryptor.decryptRawPacket(data);\n      if(!decryptedData) {\n        continue;\n      }\n\n      // this.log('[update] updateNewCallSignalingData', update, decryptedData);\n\n      const str = new TextDecoder().decode(decryptedData);\n      try {\n        const signalingData: CallSignalingData = JSON.parse(str);\n        this.log('[update] updateNewCallSignalingData', signalingData);\n        this.applyCallSignalingData(signalingData);\n      } catch(err) {\n        this.log.error('wrong signaling data', str);\n        this.hangUp('phoneCallDiscardReasonDisconnect');\n        callsController.dispatchEvent('incompatible', this.interlocutorUserId);\n      }\n    }\n  }\n\n  public onUpdatePhoneCallSignalingData(data: Uint8Array) {\n    this.decryptQueue.push(data);\n    this.processDecryptQueue();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCallProtocol} from '../../../layer';\n\nexport default function getCallProtocol(): PhoneCallProtocol {\n  return {\n    _: 'phoneCallProtocol',\n    pFlags: {\n      udp_p2p: true,\n      udp_reflector: true\n    },\n    min_layer: 92,\n    max_layer: 92,\n    library_versions: ['4.0.0']\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {PhoneCall} from '../../../layer';\n\nexport default function getRtcConfiguration(call: PhoneCall.phoneCall): RTCConfiguration {\n  const iceServers: RTCIceServer[] = [];\n  call.connections.forEach((connection) => {\n    switch(connection._) {\n      /* case 'callServerTypeTelegramReflector': {\n        break;\n      } */\n      case 'phoneConnectionWebrtc': {\n        const {ip, ipv6, port, username, password} = connection;\n        const urls: string[] = [];\n        if(connection.pFlags.turn) {\n          if(ip) {\n            urls.push(`turn:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`turn:[${ipv6}]:${port}`);\n          }\n        } else if(connection.pFlags.stun) {\n          if(ip) {\n            urls.push(`stun:${ip}:${port}`);\n          }\n          if(ipv6) {\n            urls.push(`stun:[${ipv6}]:${port}`);\n          }\n        }\n\n        if(urls.length > 0) {\n          iceServers.push({\n            urls,\n            username,\n            credential: password\n          });\n        }\n        break;\n      }\n    }\n  });\n\n  return {\n    iceServers,\n    iceTransportPolicy: call.pFlags.p2p_allowed ? 'all' : 'relay'\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport getScreenStream from './getScreenStream';\nimport getStream from './getStream';\n\n/**\n * ! Use multiple constraints together only with first invoke\n */\nexport default function getStreamCached() {\n  const _cache: {\n    main: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>,\n    screen: Partial<{\n      audio: Promise<MediaStream>,\n      video: Promise<MediaStream>\n    }>\n  } = {\n    main: {},\n    screen: {}\n  };\n\n  return async(options: {\n    isScreen: true,\n    constraints: DisplayMediaStreamConstraints,\n  } | {\n    isScreen?: false,\n    constraints: MediaStreamConstraints,\n    muted: boolean\n  }) => {\n    const {isScreen, constraints} = options;\n    const cache = _cache[isScreen ? 'screen' : 'main'];\n    let promise: Promise<MediaStream> = cache[constraints.audio ? 'audio' : 'video'];\n\n    if(!promise) {\n      promise = (isScreen ? getScreenStream : getStream)(constraints, (options as any).muted);\n      if(constraints.audio && !cache.audio) cache.audio = promise.finally(() => cache.audio = undefined);\n      if(constraints.video && !cache.video) cache.video = promise.finally(() => cache.video = undefined);\n    }\n\n    try {\n      return await promise;\n      /* let out: Partial<{\n        audio: MediaStream,\n        video: MediaStream\n      }> = {};\n\n      await Promise.all([\n        constraints.audio && cache.audio.then((stream) => out.audio = stream),\n        constraints.video && cache.video.then((stream) => out.video = stream)\n      ].filter(Boolean));\n\n      return out; */\n    } catch(err) {\n      throw err;\n    }\n  };\n}\n\n(window as any).getStreamCached = getStreamCached;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport EventListenerBase, {EventListenerListeners} from '../../helpers/eventListenerBase';\nimport noop from '../../helpers/noop';\nimport {logger} from '../logger';\nimport getAudioConstraints from './helpers/getAudioConstraints';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getStreamCached from './helpers/getStreamCached';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport StreamManager, {StreamItem} from './streamManager';\n\nexport type TryAddTrackOptions = {\n  stream: MediaStream,\n  track: MediaStreamTrack,\n  type: StreamItem['type'],\n  source?: string\n};\n\nexport default abstract class CallInstanceBase<E extends EventListenerListeners> extends EventListenerBase<E> {\n  protected log: ReturnType<typeof logger>;\n  protected outputDeviceId: string;\n\n  protected player: HTMLElement;\n  protected elements: Map<string, HTMLMediaElement>;\n\n  protected audio: HTMLAudioElement;\n  // protected fixedSafariAudio: boolean;\n\n  protected getStream: ReturnType<typeof getStreamCached>;\n\n  constructor() {\n    super(false);\n\n    const player = this.player = document.createElement('div');\n    player.classList.add('call-player');\n    player.style.display = 'none';\n    document.body.append(player);\n\n    this.elements = new Map();\n\n    // possible Safari fix\n    const audio = this.audio = new Audio();\n    audio.autoplay = true;\n    audio.volume = 1.0;\n    this.player.append(audio);\n    this.elements.set('audio', audio);\n\n    this.fixSafariAudio();\n\n    this.getStream = getStreamCached();\n  }\n\n  public get isSharingAudio() {\n    return !!this.streamManager.hasInputTrackKind('audio');\n  }\n\n  public get isSharingVideo() {\n    return !!this.streamManager.hasInputTrackKind('video');\n  }\n\n  public abstract get isMuted(): boolean;\n  public abstract get isClosing(): boolean;\n\n  public fixSafariAudio() {\n    // if(this.fixedSafariAudio) return;\n    this.audio.play().catch(noop);\n    // this.fixedSafariAudio = true;\n  }\n\n  public requestAudioSource(muted: boolean) {\n    return this.requestInputSource(true, false, muted);\n  }\n\n  public requestInputSource(audio: boolean, video: boolean, muted: boolean) {\n    const {streamManager} = this;\n    if(streamManager) {\n      const isAudioGood = !audio || this.isSharingAudio;\n      const isVideoGood = !video || this.isSharingVideo;\n      if(isAudioGood && isVideoGood) {\n        return Promise.resolve();\n      }\n    }\n\n    const constraints: MediaStreamConstraints = {\n      audio: audio && getAudioConstraints(),\n      video: video && getVideoConstraints()\n    };\n\n    return this.getStream({\n      constraints,\n      muted\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public requestScreen() {\n    return this.getStream({\n      isScreen: true,\n      constraints: getScreenConstraints(true)\n    }).then((stream) => {\n      this.onInputStream(stream);\n    });\n  }\n\n  public getElement(endpoint: number | string) {\n    return this.elements.get('' + endpoint);\n  }\n\n  public abstract get streamManager(): StreamManager;\n  public abstract get description(): LocalConferenceDescription;\n  public abstract toggleMuted(): Promise<void>;\n\n  public cleanup() {\n    this.player.textContent = '';\n    this.player.remove();\n    this.elements.clear();\n\n    // can have no connectionInstance but streamManager with input stream\n    this.streamManager.stop();\n\n    super.cleanup();\n  }\n\n  public onTrack(event: RTCTrackEvent) {\n    this.tryAddTrack({\n      stream: event.streams[0],\n      track: event.track,\n      type: 'output'\n    });\n  }\n\n  public saveInputVideoStream(stream: MediaStream, type?: string) {\n    const track = stream.getVideoTracks()[0];\n    this.tryAddTrack({\n      stream,\n      track,\n      type: 'input',\n      source: type || 'main'\n    });\n  }\n\n  public tryAddTrack({stream, track, type, source}: TryAddTrackOptions) {\n    if(!source) {\n      source = StreamManager.getSource(stream, type);\n    }\n\n    this.log('tryAddTrack', stream, track, type, source);\n\n    const isOutput = type === 'output';\n\n    const {player, elements, streamManager} = this;\n\n    const tagName = track.kind as StreamItem['kind'];\n    const isVideo = tagName === 'video';\n\n    const elementEndpoint = isVideo ? source : tagName;\n    let element = elements.get(elementEndpoint);\n\n    if(isVideo) {\n      track.addEventListener('ended', () => {\n        this.log('[track] onended');\n        elements.delete(elementEndpoint);\n        // element.remove();\n      }, {once: true});\n    }\n\n    if(isOutput) {\n      streamManager.addTrack(stream, track, type);\n    }\n\n    const useStream = isVideo ? stream : streamManager.outputStream;\n    if(!element) {\n      element = document.createElement(tagName);\n      element.autoplay = true;\n      element.srcObject = useStream;\n      element.volume = 1.0;\n\n      if((element as any).sinkId !== 'undefined') {\n        const {outputDeviceId} = this;\n        if(outputDeviceId) {\n          (element as any).setSinkId(outputDeviceId);\n        }\n      }\n\n      if(!isVideo) {\n        player.appendChild(element);\n      } else {\n        element.setAttribute('playsinline', 'true');\n        element.muted = true;\n      }\n      // audio.play();\n\n      elements.set(elementEndpoint, element);\n    } else {\n      if(element.paused) {\n        element.play().catch(noop);\n      }\n\n      // ! EVEN IF MEDIASTREAM IS THE SAME NEW TRACK WON'T PLAY WITHOUT REPLACING IT WHEN NEW PARTICIPANT IS ENTERING !\n      // if(element.srcObject !== useStream) {\n      element.srcObject = useStream;\n      // }\n    }\n\n    return source;\n  }\n\n  public setMuted(muted?: boolean) {\n    this.streamManager.inputStream.getAudioTracks().forEach((track) => {\n      if(track?.kind === 'audio') {\n        track.enabled = muted === undefined ? !track.enabled : !muted;\n      }\n    });\n  }\n\n  protected onInputStream(stream: MediaStream): void {\n    if(!this.isClosing) {\n      const videoTracks = stream.getVideoTracks();\n      if(videoTracks.length) {\n        this.saveInputVideoStream(stream, 'main');\n      }\n\n      const {streamManager, description} = this;\n      streamManager.addStream(stream, 'input');\n\n      if(description) {\n        streamManager.appendToConference(description);\n      }\n    } else { // if call is declined earlier than stream appears\n      stream.getTracks().forEach((track) => {\n        stopTrack(track);\n      });\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum CALL_STATE {\n  CONNECTED,\n  CONNECTING,\n  EXCHANGING_KEYS,\n  PENDING,\n  REQUESTING,\n  CLOSING,\n  CLOSED\n}\n\nexport default CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type CallAudioAssetName = 'call_busy.mp3' | 'call_connect.mp3' | 'call_end.mp3' | 'call_incoming.mp3' | 'call_outgoing.mp3' | 'voip_failed.mp3' | 'voip_connecting.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\nexport default function getCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'call_busy.mp3',\r\n    'call_connect.mp3',\r\n    'call_end.mp3',\r\n    'call_incoming.mp3',\r\n    'call_outgoing.mp3',\r\n    'voip_failed.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getCallAudioAsset, {CallAudioAssetName} from '../../components/call/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport IS_CALL_SUPPORTED from '../../environment/callSupport';\r\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\r\nimport insertInDescendSortedArray from '../../helpers/array/insertInDescendSortedArray';\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\nimport bytesCmp from '../../helpers/bytes/bytesCmp';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport tsNow from '../../helpers/tsNow';\r\nimport {PhoneCallProtocol} from '../../layer';\r\nimport {CallId} from '../appManagers/appCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\r\nimport rootScope from '../rootScope';\r\nimport CallInstance from './callInstance';\r\nimport CALL_STATE from './callState';\r\n\r\nconst CALL_REQUEST_TIMEOUT = 45e3;\r\n\r\nexport class CallsController extends EventListenerBase<{\r\n  instance: (details: {hasCurrent: boolean, instance: CallInstance}) => void,\r\n  accepting: (instance: CallInstance) => void, //  .    ,     topbarCall\r\n  incompatible: (userId: UserId) => void,\r\n}> {\r\n  private log: ReturnType<typeof logger>;\r\n  private managers: AppManagers;\r\n  private audioAsset: AudioAssetPlayer<CallAudioAssetName>;\r\n  private instances: Map<CallId, CallInstance>;\r\n  private sortedInstances: Array<CallInstance>;\r\n  private tempId: number;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.log = logger('CC');\r\n\r\n    if(!IS_CALL_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.audioAsset = getCallAudioAsset();\r\n    this.tempId = 0;\r\n    this.instances = new Map();\r\n    this.sortedInstances = [];\r\n\r\n    rootScope.addEventListener('call_update', async(call) => {\r\n      let instance = this.instances.get(call.id);\r\n\r\n      if(instance) {\r\n        instance.setPhoneCall(call);\r\n      }\r\n\r\n      switch(call._) {\r\n        case 'phoneCallDiscarded': {\r\n          if(instance) {\r\n            instance.hangUp(call.reason?._, true);\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallAccepted': {\r\n          if(instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n              rootScope.dispatchEvent('call_incompatible', instance.interlocutorUserId);\r\n              break;\r\n            } */\r\n\r\n            instance.confirmCall();\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCallRequested': {\r\n          if(!instance) {\r\n            /* if(!this.verifyProtocolCompatibility(call.protocol)) {\r\n              rootScope.dispatchEvent('call_incompatible', call.admin_id);\r\n              break;\r\n            } */\r\n\r\n            instance = this.createCallInstance({\r\n              isOutgoing: false,\r\n              interlocutorUserId: call.admin_id\r\n            });\r\n\r\n            instance.overrideConnectionState(CALL_STATE.PENDING);\r\n            instance.setPhoneCall(call);\r\n            instance.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonMissed');\r\n          }\r\n\r\n          break;\r\n        }\r\n\r\n        case 'phoneCall': {\r\n          if(!instance || instance.encryptionKey) {\r\n            break;\r\n          }\r\n\r\n          const g_a = instance.dh.g_a = call.g_a_or_b;\r\n          const dh = instance.dh;\r\n          const g_a_hash = await apiManagerProxy.invokeCrypto('sha256', g_a);\r\n          if(!bytesCmp(dh.g_a_hash, g_a_hash)) {\r\n            this.log.error('Incorrect g_a_hash', dh.g_a_hash, g_a_hash);\r\n            break;\r\n          }\r\n\r\n          const {key, key_fingerprint} = await this.managers.appCallsManager.computeKey(g_a, dh.b, dh.p);\r\n          if(call.key_fingerprint !== key_fingerprint) {\r\n            this.log.error('Incorrect key fingerprint', call.key_fingerprint, key_fingerprint, g_a, dh);\r\n            instance.hangUp('phoneCallDiscardReasonDisconnect');\r\n            break;\r\n          }\r\n\r\n          instance.encryptionKey = key;\r\n          instance.joinCall();\r\n\r\n          break;\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('call_signaling', ({callId, data}) => {\r\n      const instance = this.instances.get(callId);\r\n      if(instance?.id !== callId) {\r\n        return;\r\n      }\r\n\r\n      instance.onUpdatePhoneCallSignalingData(data);\r\n    });\r\n  }\r\n\r\n  public get currentCall() {\r\n    return this.sortedInstances[0];\r\n  }\r\n\r\n  public getCallByUserId(userId: UserId) {\r\n    for(const [callId, instance] of this.instances) {\r\n      if(instance.interlocutorUserId === userId) {\r\n        return instance;\r\n      }\r\n    }\r\n  }\r\n\r\n  private createCallInstance(options: {\r\n    isOutgoing: boolean,\r\n    interlocutorUserId: UserId,\r\n    protocol?: PhoneCallProtocol\r\n  }) {\r\n    const call = new CallInstance({\r\n      managers: this.managers,\r\n      ...options\r\n    });\r\n\r\n    call.addEventListener('state', (state) => {\r\n      const currentCall = this.currentCall;\r\n      if(state === CALL_STATE.CLOSED) {\r\n        this.instances.delete(call.id);\r\n        indexOfAndSplice(this.sortedInstances, call);\r\n      } else {\r\n        insertInDescendSortedArray(this.sortedInstances, call, 'sortIndex');\r\n      }\r\n\r\n      if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n        call.wasTryingToJoin = true;\r\n      }\r\n\r\n      const hasConnected = call.connectedAt !== undefined;\r\n      if(state === CALL_STATE.EXCHANGING_KEYS || (state === CALL_STATE.CONNECTING && hasConnected)) {\r\n        call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonDisconnect');\r\n      } else {\r\n        call.clearHangUpTimeout();\r\n      }\r\n\r\n      if(currentCall === call || !currentCall) {\r\n        if(state === CALL_STATE.CLOSED) {\r\n          if(!call.isOutgoing && !call.wasTryingToJoin) { // incoming call has been accepted on other device or ended\r\n            this.audioAsset.stopSound();\r\n          } else if(call.wasTryingToJoin && !hasConnected) { // something has happened during the key exchanging\r\n            this.audioAsset.playSound('voip_failed.mp3');\r\n          } else {\r\n            this.audioAsset.playSound(call.discardReason === 'phoneCallDiscardReasonBusy' ? 'call_busy.mp3' : 'call_end.mp3');\r\n          }\r\n        } else if(state === CALL_STATE.PENDING) {\r\n          this.audioAsset.playSound(call.isOutgoing ? 'call_outgoing.mp3' : 'call_incoming.mp3', true);\r\n        } else if(state === CALL_STATE.EXCHANGING_KEYS) {\r\n          this.audioAsset.playSoundIfDifferent('call_connect.mp3');\r\n        } else if(state === CALL_STATE.CONNECTING) {\r\n          if(call.duration) {\r\n            this.audioAsset.playSound('voip_connecting.mp3', true);\r\n          }\r\n        } else {\r\n          this.audioAsset.stopSound();\r\n        }\r\n      }\r\n    });\r\n\r\n    call.addEventListener('id', (id, prevId) => {\r\n      if(prevId !== undefined) {\r\n        this.instances.delete(prevId);\r\n      }\r\n\r\n      const hasCurrent = !!this.currentCall;\r\n      this.instances.set(id, call);\r\n\r\n      if(prevId === undefined) {\r\n        this.dispatchEvent('instance', {instance: call, hasCurrent: hasCurrent});\r\n      }\r\n    });\r\n\r\n    return call;\r\n  }\r\n\r\n  public async startCallInternal(userId: UserId, isVideo: boolean) {\r\n    this.log('p2pStartCallInternal', userId, isVideo);\r\n\r\n    const fullInfo = await this.managers.appProfileManager.getProfile(userId);\r\n    if(!fullInfo) return;\r\n\r\n    const {video_calls_available} = fullInfo.pFlags;\r\n\r\n    const call = this.createCallInstance({\r\n      isOutgoing: true,\r\n      interlocutorUserId: userId\r\n    });\r\n\r\n    call.requestInputSource(true, !!(isVideo && video_calls_available), false);\r\n\r\n    call.overrideConnectionState(CALL_STATE.REQUESTING);\r\n    call.setPhoneCall({\r\n      _: 'phoneCallWaiting',\r\n      access_hash: '',\r\n      admin_id: NULL_PEER_ID,\r\n      date: tsNow(true),\r\n      id: --this.tempId,\r\n      participant_id: userId,\r\n      protocol: call.protocol,\r\n      pFlags: {\r\n        video: isVideo || undefined\r\n      }\r\n    });\r\n\r\n    // return;\r\n    this.managers.appCallsManager.generateDh().then(async(dh) => {\r\n      call.dh = dh;\r\n\r\n      return this.managers.appCallsManager.requestCall(userId, call.protocol, call.dh.g_a_hash, isVideo && video_calls_available);\r\n    }).then((phoneCall) => {\r\n      call.overrideConnectionState(CALL_STATE.PENDING);\r\n      call.setPhoneCall(phoneCall);\r\n      call.setHangUpTimeout(CALL_REQUEST_TIMEOUT, 'phoneCallDiscardReasonHangup');\r\n    });\r\n  }\r\n}\r\n\r\nconst callsController = new CallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.callsController = callsController);\r\nexport default callsController;\r\n","export const GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX = 50;\nexport const GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS = 100;\nexport const GROUP_CALL_PARTICIPANTS_LOAD_LIMIT = 100;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../helpers/array/forEachReverse';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCallConnectionType, JoinGroupCallJsonPayload} from '../appManagers/appGroupCallsManager';\nimport {AppManagers} from '../appManagers/managers';\nimport rootScope from '../rootScope';\nimport CallConnectionInstanceBase, {CallConnectionInstanceOptions} from './callConnectionInstanceBase';\nimport GroupCallInstance from './groupCallInstance';\nimport filterServerCodecs from './helpers/filterServerCodecs';\nimport fixLocalOffer from './helpers/fixLocalOffer';\nimport processMediaSection from './helpers/processMediaSection';\nimport {ConferenceEntry} from './localConferenceDescription';\nimport SDP from './sdp';\nimport SDPMediaSection from './sdp/mediaSection';\nimport {WebRTCLineType} from './sdpBuilder';\nimport {UpdateGroupCallConnectionData} from './types';\n\nexport default class GroupCallConnectionInstance extends CallConnectionInstanceBase {\n  private groupCall: GroupCallInstance;\n  public updateConstraints?: boolean;\n  private type: GroupCallConnectionType;\n  private options: {\n    type: Extract<GroupCallConnectionType, 'main'>,\n    isMuted?: boolean,\n    joinVideo?: boolean,\n    rejoin?: boolean\n  } | {\n    type: Extract<GroupCallConnectionType, 'presentation'>,\n  };\n\n  private updateConstraintsInterval: number;\n  public negotiateThrottled: () => void;\n\n  private managers: AppManagers;\n\n  constructor(options: CallConnectionInstanceOptions & {\n    groupCall: GroupCallConnectionInstance['groupCall'],\n    type: GroupCallConnectionInstance['type'],\n    options: GroupCallConnectionInstance['options'],\n    managers: AppManagers\n  }) {\n    super(options);\n\n    this.negotiateThrottled = throttle(this.negotiate.bind(this), 0, false);\n  }\n\n  public createPeerConnection() {\n    return this.connection || super.createPeerConnection({\n      iceServers: [],\n      iceTransportPolicy: 'all',\n      bundlePolicy: 'max-bundle',\n      rtcpMuxPolicy: 'require',\n      iceCandidatePoolSize: 0\n      // sdpSemantics: \"unified-plan\",\n      // extmapAllowMixed: true,\n    });\n  }\n\n  public createDataChannel() {\n    if(this.dataChannel) {\n      return this.dataChannel;\n    }\n\n    const dataChannel = super.createDataChannel();\n\n    dataChannel.addEventListener('open', () => {\n      this.maybeUpdateRemoteVideoConstraints();\n    });\n\n    dataChannel.addEventListener('close', () => {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    });\n\n    return dataChannel;\n  }\n\n  public createDescription() {\n    if(this.description) {\n      return this.description;\n    }\n\n    const description = super.createDescription();\n\n    /* const perType = 0;\n    const types = ['audio' as const, 'video' as const];\n    const count = types.length * perType;\n    const init: RTCRtpTransceiverInit = {direction: 'recvonly'};\n    types.forEach((type) => {\n      for(let i = 0; i < perType; ++i) {\n        description.createEntry(type).createTransceiver(connection, init);\n      }\n    }); */\n\n    return description;\n  }\n\n  public appendStreamToConference() {\n    super.appendStreamToConference();/* .then(() => {\n      currentGroupCall.connections.main.negotiating = false;\n      this.startNegotiation({\n        type: type,\n        isMuted: muted,\n        rejoin\n      });\n    }); */\n  }\n\n  private async invokeJoinGroupCall(localSdp: SDP, mainChannels: SDPMediaSection[], options: GroupCallConnectionInstance['options']) {\n    const {groupCall, description} = this;\n    const groupCallId = groupCall.id;\n\n    const processedChannels = mainChannels.map((section) => {\n      const processed = processMediaSection(localSdp, section);\n\n      this.sources[processed.entry.type as 'video' | 'audio'] = processed.entry;\n\n      return processed;\n    });\n\n    const audioChannel = processedChannels.find((channel) => channel.media.mediaType === 'audio');\n    const videoChannel = processedChannels.find((channel) => channel.media.mediaType === 'video');\n    let {source, params} = audioChannel || {};\n    const useChannel = videoChannel || audioChannel;\n\n    const channels: {[type in WebRTCLineType]?: typeof audioChannel} = {\n      audio: audioChannel,\n      video: videoChannel\n    };\n\n    description.entries.forEach((entry) => {\n      if(entry.direction === 'sendonly') {\n        const channel = channels[entry.type];\n        if(!channel) return;\n\n        description.setEntrySource(entry, channel.sourceGroups || channel.source);\n        description.setEntryPeerId(entry, rootScope.myId);\n      }\n    });\n\n    // overwrite ssrc with audio in video params\n    if(params !== useChannel.params) {\n      const data: JoinGroupCallJsonPayload = JSON.parse(useChannel.params.data);\n      // data.ssrc = source || data.ssrc - 1; // audio channel can be missed in screensharing\n      if(source) data.ssrc = source;\n      else delete data.ssrc;\n      params = {\n        _: 'dataJSON',\n        data: JSON.stringify(data)\n      };\n    }\n\n    const update = await this.managers.appGroupCallsManager.joinGroupCall(groupCallId, params, options);\n\n    const data: UpdateGroupCallConnectionData = JSON.parse(update.params.data);\n\n    data.audio = data.audio || groupCall.connections.main.description.audio;\n    description.setData(data);\n    filterServerCodecs(mainChannels, data);\n\n    return data;\n  }\n\n  protected async negotiateInternal() {\n    const {connection, description} = this;\n    const isNewConnection = connection.iceConnectionState === 'new' && !description.getEntryByMid('0').source;\n    const log = this.log.bindPrefix('startNegotiation');\n    log('start');\n\n    const originalOffer = await connection.createOffer({iceRestart: false});\n\n    if(isNewConnection && this.dataChannel) {\n      const dataChannelEntry = description.createEntry('application');\n      dataChannelEntry.setDirection('sendrecv');\n    }\n\n    const {sdp: localSdp, offer} = fixLocalOffer({\n      offer: originalOffer,\n      data: description\n    });\n\n    log('[sdp] setLocalDescription', offer.sdp);\n    await connection.setLocalDescription(offer);\n\n    const mainChannels = localSdp.media.filter((media) => {\n      return media.mediaType !== 'application' && media.isSending;\n    });\n\n    if(isNewConnection) {\n      try {\n        await this.invokeJoinGroupCall(localSdp, mainChannels, this.options);\n      } catch(e) {\n        this.log.error('[tdweb] joinGroupCall error', e);\n      }\n    }\n\n    /* if(!data) {\n      log('abort 0');\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    /* if(connection.iceConnectionState !== 'new') {\n      log(`abort 1 connectionState=${connection.iceConnectionState}`);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n    /* if(this.currentGroupCall !== currentGroupCall || connectionHandler.connection !== connection) {\n      log('abort', this.currentGroupCall, currentGroupCall);\n      this.closeConnectionAndStream(connection, streamManager);\n      return;\n    } */\n\n    const isAnswer = true;\n    // const _bundleMids = bundleMids.slice();\n    const entriesToDelete: ConferenceEntry[] = [];\n    const bundle = localSdp.bundle;\n    forEachReverse(bundle, (mid, idx, arr) => {\n      const entry = description.getEntryByMid(mid);\n      if(entry.shouldBeSkipped(isAnswer)) {\n        arr.splice(idx, 1);\n        entriesToDelete.push(entry);\n      }\n    });\n\n    /* forEachReverse(description.entries, (entry, idx, arr) => {\n      const mediaSection = _parsedSdp.media.find((section) => section.oa.get('mid').oa === entry.mid);\n      const deleted = !mediaSection;\n      // const deleted = !_bundleMids.includes(entry.mid); // ! can't use it because certain mid can be missed in bundle\n      if(deleted) {\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const entries = localSdp.media.map((section) => {\n      const mid = section.mid;\n      let entry = description.getEntryByMid(mid);\n      if(!entry) {\n        entry = new ConferenceEntry(mid, section.mediaType);\n        entry.setDirection('inactive');\n      }\n\n      return entry;\n    });\n\n    const answerDescription: RTCSessionDescriptionInit = {\n      type: 'answer',\n      sdp: description.generateSdp({\n        bundle,\n        entries,\n        isAnswer\n      })\n    };\n\n    entriesToDelete.forEach((entry) => {\n      description.deleteEntry(entry);\n    });\n\n    log(`[sdp] setRemoteDescription signaling=${connection.signalingState} ice=${connection.iceConnectionState} gathering=${connection.iceGatheringState} connection=${connection.connectionState}`, answerDescription.sdp);\n    await connection.setRemoteDescription(answerDescription);\n\n    log('end');\n  }\n\n  public negotiate() {\n    let promise = this.negotiating;\n    if(promise) {\n      return promise;\n    }\n\n    promise = super.negotiate();\n\n    if(this.updateConstraints) {\n      promise.then(() => {\n        this.maybeUpdateRemoteVideoConstraints();\n        this.updateConstraints = false;\n      });\n    }\n\n    if(this.options.type === 'presentation') {\n      promise.then(() => {\n        this.connection.getTransceivers().find((transceiver) => {\n          if(transceiver.sender?.track?.kind === 'video') {\n            transceiver.sender.setParameters({\n              ...transceiver.sender.getParameters(),\n              degradationPreference: 'maintain-resolution'\n            });\n          }\n        });\n      });\n    }\n\n    return promise;\n  }\n\n  public maybeUpdateRemoteVideoConstraints() {\n    if(this.dataChannel.readyState !== 'open') {\n      return;\n    }\n\n    this.log('maybeUpdateRemoteVideoConstraints');\n\n    // * https://github.com/TelegramMessenger/tgcalls/blob/6f2746e04c9b040f8c8dfc64d916a1853d09c4ce/tgcalls/group/GroupInstanceCustomImpl.cpp#L2549\n    type VideoConstraints = {minHeight?: number, maxHeight: number};\n    const obj: {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {[endpoint: string]: VideoConstraints},\n      defaultConstraints: VideoConstraints,\n      onStageEndpoints: string[]\n    } = {\n      colibriClass: 'ReceiverVideoConstraints',\n      constraints: {},\n      defaultConstraints: {maxHeight: 0},\n      onStageEndpoints: []\n    };\n\n    for(const entry of this.description.entries) {\n      if(entry.direction !== 'recvonly' || entry.type !== 'video') {\n        continue;\n      }\n\n      const {endpoint} = entry;\n      obj.onStageEndpoints.push(endpoint);\n      obj.constraints[endpoint] = {\n        minHeight: 180,\n        maxHeight: 720\n      };\n    }\n\n    this.sendDataChannelData(obj);\n\n    if(!obj.onStageEndpoints.length) {\n      if(this.updateConstraintsInterval) {\n        clearInterval(this.updateConstraintsInterval);\n        this.updateConstraintsInterval = undefined;\n      }\n    } else if(!this.updateConstraintsInterval) {\n      this.updateConstraintsInterval = window.setInterval(this.maybeUpdateRemoteVideoConstraints.bind(this), 5000);\n    }\n  }\n\n  public addInputVideoStream(stream: MediaStream) {\n    // const {sources} = this;\n    // if(sources?.video) {\n    // const source = this.sources.video.source;\n    // stream.source = '' + source;\n    this.groupCall.saveInputVideoStream(stream, this.type);\n    // }\n\n    this.streamManager.addStream(stream, 'input');\n    this.appendStreamToConference(); // replace sender track\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {DataJSON} from '../../../layer';\nimport {JoinGroupCallJsonPayload} from '../../appManagers/appGroupCallsManager';\nimport SDP from '../sdp';\nimport {Ssrc} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function processMediaSection(sdp: SDP, media: SDP['media'][0]) {\n  const sectionInfo = parseMediaSectionInfo(sdp, media);\n\n  const mediaType: Exclude<typeof media['mediaType'], 'application'> = media.mediaType as any;\n  const entry: Ssrc = {\n    source: sectionInfo.source,\n    sourceGroups: sectionInfo.sourceGroups,\n    type: mediaType\n  };\n\n  // do not change this value, otherwise onconnectionstatechange won't fire\n  sectionInfo.fingerprint.setup = 'active';\n  const payload: JoinGroupCallJsonPayload = {\n    'fingerprints': [sectionInfo.fingerprint],\n    'pwd': sectionInfo.pwd,\n    'ssrc': sectionInfo.source,\n    'ssrc-groups': sectionInfo.sourceGroups || [],\n    'ufrag': sectionInfo.ufrag\n  };\n  const paramsDataJson = JSON.stringify(payload);\n\n  const params: DataJSON = {\n    _: 'dataJSON',\n    data: paramsDataJson\n  };\n\n  return {\n    params,\n    source: sectionInfo.source,\n    media,\n    sourceGroups: sectionInfo.sourceGroups,\n    entry\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {UpdateGroupCallConnectionData, Codec} from '../types';\n\nexport default function filterServerCodecs(mainChannels: SDPMediaSection[], data: UpdateGroupCallConnectionData) {\n  // ! Need to filter server's extmap for Firefox\n  const performExtmap = (channel: typeof mainChannels[0]) => {\n    const out: {[id: string]: string} = {};\n    const extmap = channel.attributes.get('extmap');\n    extmap.forEach((extmap) => {\n      const id = extmap.key.split('/', 1)[0];\n      out[id] = extmap.value;\n    });\n\n    return out;\n  };\n\n  const codecsToPerform: [Codec, 'audio' | 'video'][] = /* flatten([data, dataPresentation].filter(Boolean).map((data) => {\n    return  */['audio' as const, 'video' as const].filter((type) => data[type]).map((type) => ([data[type], type]));\n  // }));\n\n  codecsToPerform.forEach(([codec, type]) => {\n    const channel = mainChannels.find((line) => line.mediaType === type);\n    if(!channel) {\n      return;\n    }\n\n    const extmap = performExtmap(channel);\n    forEachReverse(codec['rtp-hdrexts'], (value, index, arr) => {\n      if(extmap[value.id] !== value.uri) {\n        arr.splice(index, 1);\n        console.log(`[sdp] filtered extmap:`, value, index, type);\n      }\n    });\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport forEachReverse from '../../../helpers/array/forEachReverse';\nimport copy from '../../../helpers/object/copy';\nimport {ConferenceEntry} from '../localConferenceDescription';\nimport {parseSdp, addSimulcast} from '../sdp/utils';\nimport {generateMediaFirstLine, SDPBuilder} from '../sdpBuilder';\nimport {UpdateGroupCallConnectionData} from '../types';\nimport parseMediaSectionInfo from './parseMediaSectionInfo';\n\nexport default function fixLocalOffer(options: {\n  offer: RTCSessionDescriptionInit,\n  data: UpdateGroupCallConnectionData,\n  skipAddingMulticast?: boolean\n  // mids?: string[]\n}) {\n  const {offer, data} = options;\n  const sdp = parseSdp(offer.sdp);\n  let hasMunged = false;\n\n  if(!options.skipAddingMulticast) {\n    hasMunged = addSimulcast(sdp) || hasMunged;\n  }\n\n  // const bundleLine = parsedSdp.session.lines.find((line) => line.Ha?.key === 'group');\n  // const bundleMids = bundleLine.value.split(' ').slice(1);\n\n  forEachReverse(sdp.media, (section, idx, arr) => {\n    // const mid = section.oa.get('mid').oa;\n\n    //        . -    \n    // !     ,  \n    /* if(mids && !mids.includes(mid) && !bundleMids.includes(mid)) {\n      console.error('wtf');\n      hasMunged = true;\n      arr.splice(idx, 1);\n      return;\n    } */\n\n    if(/* section.mediaType !== 'video' ||  */section.isSending) {\n      return;\n    }\n\n    if(section.mediaType === 'application') {\n      return;\n    }\n\n    const mediaLine = section.mediaLine;\n    const mediaLineParts = mediaLine.mediaLineParts;\n    const mediaCodecIds = mediaLineParts.ids;\n    const localMLine = mediaLine.toString();\n\n    const codec = data[section.mediaType];\n    const payloadTypes = codec['payload-types'];\n\n    /* forEachReverse(payloadTypes, (payloadType, idx, arr) => {\n      if(!mediaCodecIds.includes('' + payloadType.id) && section.mediaType === 'video') {\n      // if(payloadType.name === 'H265') {\n        console.warn('[sdp] filtered unsupported codec', payloadType, mediaCodecIds, section.mediaType);\n        arr.splice(idx, 1);\n      }\n    }); */\n\n    const codecIds = payloadTypes.map((payload) => '' + payload.id);\n    const correctMLine = generateMediaFirstLine(section.mediaType, undefined, codecIds);\n\n    if(localMLine !== correctMLine) {\n      const sectionInfo = parseMediaSectionInfo(sdp, section);\n\n      const newData = {...data};\n      newData.transport = copy(newData.transport);\n      newData.transport.ufrag = sectionInfo.ufrag;\n      newData.transport.pwd = sectionInfo.pwd;\n      newData.transport.fingerprints = [sectionInfo.fingerprint];\n      newData.transport.candidates = [];\n\n      const entry = new ConferenceEntry(sectionInfo.mid, mediaLineParts.type);\n      entry.setPort(mediaLineParts.port);\n      sectionInfo.source && entry.setSource(sectionInfo.sourceGroups || sectionInfo.source);\n      entry.setDirection(section.direction);\n\n      const newSdp = new SDPBuilder().addSsrcEntry(entry, newData).finalize();\n\n      const newChannel = parseSdp(newSdp).media[0];\n      arr[idx] = newChannel;\n\n      hasMunged = true;\n    }\n  });\n\n  if(hasMunged) {\n    const mungedSdp = sdp.toString();\n    offer.sdp = mungedSdp;\n  }\n\n  return {offer, sdp/* , bundleMids */};\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {GroupCallConnectionType, GroupCallId, GroupCallOutputSource} from '../appManagers/appGroupCallsManager';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport throttle from '../../helpers/schedulers/throttle';\nimport {GroupCall, GroupCallParticipant} from '../../layer';\nimport {logger} from '../logger';\nimport {NULL_PEER_ID} from '../mtproto/mtproto_config';\nimport rootScope from '../rootScope';\nimport CallInstanceBase, {TryAddTrackOptions} from './callInstanceBase';\nimport GroupCallConnectionInstance from './groupCallConnectionInstance';\nimport GROUP_CALL_STATE from './groupCallState';\nimport getScreenConstraints from './helpers/getScreenConstraints';\nimport getScreenStream from './helpers/getScreenStream';\nimport getStream from './helpers/getStream';\nimport getVideoConstraints from './helpers/getVideoConstraints';\nimport stopTrack from './helpers/stopTrack';\nimport localConferenceDescription from './localConferenceDescription';\nimport {WebRTCLineType} from './sdpBuilder';\nimport StreamManager from './streamManager';\nimport {Ssrc} from './types';\nimport getPeerId from '../appManagers/utils/peers/getPeerId';\nimport {AppManagers} from '../appManagers/managers';\nimport {generateSelfVideo, makeSsrcFromParticipant, makeSsrcsFromParticipant} from './groupCallsController';\n\nexport default class GroupCallInstance extends CallInstanceBase<{\n  state: (state: GROUP_CALL_STATE) => void,\n  pinned: (source?: GroupCallOutputSource) => void,\n}> {\n  public id: GroupCallId;\n  public chatId: ChatId;\n  public handleUpdateGroupCallParticipants: boolean;\n  public updatingSdp: boolean;\n  public isSpeakingMap: Map<any, any>;\n  public connections: {[k in GroupCallConnectionType]?: GroupCallConnectionInstance};\n  public groupCall: GroupCall;\n  public participant: GroupCallParticipant;\n\n  // will be set with negotiation\n  public joined: boolean;\n\n  private pinnedSources: Array<GroupCallOutputSource>;\n  private participantsSsrcs: Map<PeerId, Ssrc[]>;\n  private hadAutoPinnedSources: Set<GroupCallOutputSource>;\n  private dispatchPinnedThrottled: () => void;\n  private startVideoSharingPromise: Promise<void>;\n  private startScreenSharingPromise: Promise<void>;\n\n  private managers: AppManagers;\n\n  constructor(options: {\n    id: GroupCallInstance['id'],\n    chatId: GroupCallInstance['chatId'],\n    isSpeakingMap?: GroupCallInstance['isSpeakingMap'],\n    connections?: GroupCallInstance['connections'],\n    managers: AppManagers\n  }) {\n    super();\n\n    safeAssign(this, options);\n\n    if(!this.log) {\n      this.log = logger('GROUP-CALL');\n    }\n\n    if(!this.connections) {\n      this.connections = {};\n    }\n\n    if(!this.isSpeakingMap) {\n      this.isSpeakingMap = new Map();\n    }\n\n    this.pinnedSources = [];\n    this.participantsSsrcs = new Map();\n    this.hadAutoPinnedSources = new Set();\n    this.dispatchPinnedThrottled = throttle(() => {\n      this.dispatchEvent('pinned', this.pinnedSource);\n    }, 0, false);\n\n    this.addEventListener('state', (state) => {\n      if(state === GROUP_CALL_STATE.CLOSED) {\n        this.cleanup();\n      }\n    });\n  }\n\n  get connectionState() {\n    return this.connections.main.connection.iceConnectionState;\n  }\n\n  get state() {\n    const {connectionState} = this;\n    if(connectionState === 'closed') {\n      return GROUP_CALL_STATE.CLOSED;\n    } else if(connectionState !== 'connected' && (!IS_SAFARI || connectionState !== 'completed')) {\n      return GROUP_CALL_STATE.CONNECTING;\n    } else {\n      const {participant} = this;\n      if(!participant.pFlags.can_self_unmute) {\n        return GROUP_CALL_STATE.MUTED_BY_ADMIN;\n      } else if(participant.pFlags.muted) {\n        return GROUP_CALL_STATE.MUTED;\n      } else {\n        return GROUP_CALL_STATE.UNMUTED;\n      }\n    }\n  }\n\n  get participants() {\n    return this.managers.appGroupCallsManager.getCachedParticipants(this.id);\n  }\n\n  get isSharingScreen() {\n    return !!this.connections.presentation;\n  }\n\n  get pinnedSource() {\n    return this.pinnedSources[this.pinnedSources.length - 1];\n  }\n\n  public get isMuted() {\n    return this.state !== GROUP_CALL_STATE.UNMUTED;\n  }\n\n  public get isClosing() {\n    const {state} = this;\n    return state === GROUP_CALL_STATE.CLOSED;\n  }\n\n  public get streamManager(): StreamManager {\n    return this.connections.main.streamManager;\n  }\n\n  public get description(): localConferenceDescription {\n    return this.connections.main.description;\n  }\n\n  public pinSource(source: GroupCallOutputSource) {\n    indexOfAndSplice(this.pinnedSources, source);\n    this.pinnedSources.push(source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinSource(source: GroupCallOutputSource) {\n    this.hadAutoPinnedSources.delete(source);\n    indexOfAndSplice(this.pinnedSources, source);\n    this.dispatchPinnedThrottled();\n  }\n\n  public unpinAll() {\n    this.pinnedSources.length = 0;\n    this.dispatchPinnedThrottled();\n  }\n\n  public async getParticipantByPeerId(peerId: PeerId) {\n    return NULL_PEER_ID === peerId ? this.participant : (await this.participants).get(peerId);\n  }\n\n  public toggleMuted() {\n    return this.requestAudioSource(true).then(() => this.changeUserMuted(NULL_PEER_ID));\n  }\n\n  public async changeUserMuted(peerId: PeerId, muted?: boolean) {\n    const participant = await this.getParticipantByPeerId(peerId);\n    if(NULL_PEER_ID === peerId && participant.pFlags.can_self_unmute) {\n      muted = muted === undefined ? !participant.pFlags.muted : muted;\n    }\n\n    return this.editParticipant(participant, {muted});\n  }\n\n  public getElement(endpoint: GroupCallOutputSource) {\n    return super.getElement(endpoint);\n  }\n\n  public getVideoElementFromParticipantByType(participant: GroupCallParticipant, type: 'video' | 'presentation') {\n    let source: GroupCallOutputSource;\n    if(participant.pFlags.self) {\n      const connectionType: GroupCallConnectionType = type === 'video' ? 'main' : 'presentation';\n      source = connectionType;\n    } else {\n      const codec = participant[type];\n      source = codec.source_groups[0].sources[0];\n    }\n\n    const element = this.getElement(source) as HTMLVideoElement;\n    if(!element) return;\n\n    const clone = element.cloneNode() as typeof element;\n    clone.srcObject = element.srcObject;\n    return {video: clone, source};\n  }\n\n  public createConnectionInstance(options: {\n    streamManager: StreamManager,\n    type: GroupCallConnectionType,\n    options: GroupCallConnectionInstance['options'],\n  }) {\n    return this.connections[options.type] = new GroupCallConnectionInstance({\n      groupCall: this,\n      log: this.log.bindPrefix(options.type),\n      managers: this.managers,\n      ...options\n    });\n  }\n\n  public changeRaiseHand(raise: boolean) {\n    return this.editParticipant(this.participant, {raiseHand: raise});\n  }\n\n  public async startScreenSharingInternal() {\n    try {\n      const type: GroupCallConnectionType = 'presentation';\n\n      const stream = await getScreenStream(getScreenConstraints());\n      const streamManager = new StreamManager();\n\n      const connectionInstance = this.createConnectionInstance({\n        streamManager,\n        type,\n        options: {\n          type\n        }\n      });\n\n      const connection = connectionInstance.createPeerConnection();\n      connection.addEventListener('negotiationneeded', () => {\n        connectionInstance.negotiate();\n      });\n\n      stream.getVideoTracks()[0].addEventListener('ended', () => {\n        if(this.connections.presentation) { // maybe user has stopped screensharing through browser's ui\n          this.stopScreenSharing();\n        }\n      }, {once: true});\n\n      connectionInstance.createDescription();\n      connectionInstance.addInputVideoStream(stream);\n    } catch(err) {\n      this.log.error('start screen sharing error', err);\n    }\n  }\n\n  public startScreenSharing() {\n    return this.startScreenSharingPromise ??= this.startScreenSharingInternal().finally(() => {\n      this.startScreenSharingPromise = undefined;\n    });\n  }\n\n  public stopScreenSharing() {\n    const connectionInstance = this.connections.presentation;\n    if(!connectionInstance) {\n      return Promise.resolve();\n    }\n\n    delete this.connections.presentation;\n    this.unpinSource('presentation');\n    connectionInstance.closeConnectionAndStream(true);\n\n    delete this.participant.presentation;\n    this.managers.appGroupCallsManager.saveApiParticipant(this.id, this.participant);\n\n    return this.managers.appGroupCallsManager.leaveGroupCallPresentation(this.id);\n  }\n\n  public toggleScreenSharing() {\n    if(this.isSharingScreen) {\n      return this.stopScreenSharing();\n    } else {\n      return this.startScreenSharing();\n    }\n  }\n\n  public async startVideoSharingInternal() {\n    const constraints: MediaStreamConstraints = {\n      video: getVideoConstraints()\n    };\n\n    try {\n      const stream = await getStream(constraints, false);\n      const connectionInstance = this.connections.main;\n      connectionInstance.addInputVideoStream(stream);\n\n      await this.editParticipant(this.participant, {\n        videoPaused: false,\n        videoStopped: false\n      });\n    } catch(err) {\n      this.log.error('startVideoSharing error', err, constraints);\n    }\n  }\n\n  public startVideoSharing() {\n    return this.startVideoSharingPromise ??= this.startVideoSharingInternal().finally(() => {\n      this.startVideoSharingPromise = undefined;\n    });\n  }\n\n  public async stopVideoSharing() {\n    const connectionInstance = this.connections.main;\n    const track = connectionInstance.streamManager.inputStream.getVideoTracks()[0];\n    if(!track) {\n      return;\n    }\n\n    stopTrack(track);\n    connectionInstance.streamManager.appendToConference(connectionInstance.description); // clear sender track\n\n    await this.editParticipant(this.participant, {\n      videoStopped: true\n    });\n  }\n\n  public toggleVideoSharing() {\n    if(this.isSharingVideo) {\n      return this.stopVideoSharing();\n    } else {\n      return this.startVideoSharing();\n    }\n  }\n\n  public async hangUp(discard = false, rejoin = false, isDiscarded = false) {\n    for(const type in this.connections) {\n      const connection = this.connections[type as GroupCallConnectionType];\n      connection.closeConnectionAndStream(!rejoin);\n    }\n\n    this.dispatchEvent('state', this.state);\n\n    if(isDiscarded) {\n      return;\n    }\n\n    if(!rejoin) {\n      const d = discard || (this.joined ? this.connections.main.sources.audio.source : undefined);\n      this.managers.appGroupCallsManager.hangUp(this.id, d);\n    }\n  }\n\n  public tryAddTrack(options: Omit<TryAddTrackOptions, 'streamManager'>) {\n    const {description} = this;\n    const source = super.tryAddTrack(options);\n\n    if(options.type === 'output') {\n      const entry = description.getEntryBySource(+source);\n      this.getParticipantByPeerId(entry.peerId).then((participant) => {\n        if(participant) {\n          rootScope.dispatchEvent('group_call_participant', {groupCallId: this.id, participant});\n        }\n      });\n    }\n\n    return source;\n  }\n\n  public async editParticipant(participant: GroupCallParticipant, options: Partial<{\n    muted: boolean,\n    volume: number,\n    raiseHand: boolean,\n    videoStopped: boolean,\n    videoPaused: boolean,\n    presentationPaused: boolean\n  }>) {\n    if(!Object.keys(options).length) {\n      return;\n    }\n\n    // let processUpdate = true;\n    if(participant) {\n      // const {currentGroupCall} = this;\n      // const isCurrentCall = currentGroupCall?.id === groupCallId;\n      const isCurrentCall = true;\n      const isUpdatingMeInCurrentCall = isCurrentCall && participant.pFlags.self;\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.muted !== undefined && !this.isSharingAudio) {\n          delete options.muted;\n\n          if(!Object.keys(options).length) {\n            return;\n          }\n        }\n      }\n\n      // if(isCurrentCall) {\n      const muted = options.muted;\n      if(muted !== undefined) {\n        /* const isAdmin = appChatsManager.hasRights(currentGroupCall.chatId, 'manage_call');\n          if(isAdmin) {\n            if(muted) {\n              participant.pFlags.muted = true;\n              delete participant.pFlags.can_self_unmute;\n            } else {\n              participant.pFlags.can_self_unmute = true;\n            }\n          } else  */if(participant.pFlags.self) {\n          if(muted) {\n            participant.pFlags.muted = true;\n          } else if(participant.pFlags.can_self_unmute) {\n            delete participant.pFlags.muted;\n          }\n        }/*  else {\n            if(muted) {\n              participant.pFlags.muted_by_you = true;\n            } else {\n              delete participant.pFlags.muted_by_you;\n            }\n          } */\n      }\n      // }\n\n      /* const a: [keyof GroupCallParticipant['pFlags'], keyof typeof options][] = [\n        ['muted', 'muted']\n      ];\n\n      a.forEach(([key, optionKey]) => {\n        const value = options[optionKey];\n        if(value === undefined) {\n          return;\n        }\n\n        if(value) {\n          participant.pFlags[key] = true;\n        } else {\n          delete participant.pFlags[key];\n        }\n      }); */\n\n      if(options.raiseHand !== undefined) {\n        if(options.raiseHand) participant.raise_hand_rating = '1';\n        else delete participant.raise_hand_rating;\n      }\n\n      if(isUpdatingMeInCurrentCall) {\n        if(options.videoStopped !== undefined) {\n          if(options.videoStopped) delete participant.video;\n          else participant.video = generateSelfVideo(this.connections.main.sources.video);\n        }\n\n        if(!participant.pFlags.muted && participant.pFlags.can_self_unmute) {\n          this.setMuted(false);\n        }\n\n        this.dispatchEvent('state', this.state);\n      }\n\n      // rootScope.dispatchEvent('group_call_participant', {groupCallId, participant});\n\n      /* if(participant.pFlags.self) {\n        processUpdate = false;\n      } */\n    }\n\n    return this.managers.appGroupCallsManager.editParticipant(this.id, participant, options);\n  }\n\n  public onParticipantUpdate(participant: GroupCallParticipant, doNotDispatchParticipantUpdate?: PeerId) {\n    const connectionInstance = this.connections.main;\n    const {connection, description} = connectionInstance;\n\n    const peerId = getPeerId(participant.peer);\n    const hasLeft = !!participant.pFlags.left;\n    const oldSsrcs = this.participantsSsrcs.get(peerId) || [];\n\n    if(participant.presentation && !hasLeft) {\n      const {source} = makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint);\n      if(!this.hadAutoPinnedSources.has(source)) {\n        this.hadAutoPinnedSources.add(source);\n        this.pinSource(participant.pFlags.self ? 'presentation' : source);\n      }\n    }\n\n    if(participant.pFlags.self) {\n      this.participant = participant;\n\n      if(connectionInstance.sources.audio.source !== participant.source) {\n        this.hangUp();\n      }\n\n      let mute = false;\n      if(!participant.pFlags.can_self_unmute) {\n        this.stopScreenSharing();\n        this.stopVideoSharing();\n        mute = true;\n      } else if(participant.pFlags.muted) {\n        mute = true;\n      }\n\n      if(mute) {\n        this.setMuted(true);\n      }\n\n      if(doNotDispatchParticipantUpdate !== peerId) {\n        this.dispatchEvent('state', this.state);\n      }\n\n      return;\n    }\n\n    const ssrcs = hasLeft ? [] : makeSsrcsFromParticipant(participant);\n\n    if(!hasLeft) {\n      this.participantsSsrcs.set(peerId, ssrcs);\n    } else {\n      this.participantsSsrcs.delete(peerId);\n    }\n\n    // const TEST_OLD = false;\n\n    const modifiedTypes: Set<WebRTCLineType> = new Set();\n    oldSsrcs.forEach((oldSsrc) => {\n      const oldSource = oldSsrc.source;\n      const newSsrc = ssrcs.find((ssrc) => ssrc.source === oldSource);\n      if(!newSsrc) {\n        this.unpinSource(oldSource);\n\n        const oldEntry = description.getEntryBySource(oldSource);\n        if(oldEntry && oldEntry.direction !== 'inactive') {\n          oldEntry.setDirection('inactive');\n          modifiedTypes.add(oldEntry.type);\n        }\n      }\n    });\n\n    ssrcs.forEach((ssrc) => {\n      let entry = description.getEntryBySource(ssrc.source);\n      if(entry) {\n        if(entry.direction === 'inactive') {\n          entry.setDirection(entry.originalDirection);\n          modifiedTypes.add(entry.type);\n        }\n\n        return;\n      }\n\n      entry = description.createEntry(ssrc.type);\n      description.setEntrySource(entry, ssrc.sourceGroups || ssrc.source);\n      description.setEntryPeerId(entry, peerId);\n\n      // if(TEST_OLD) {\n      //   description.bundleMids.push(entry.mid);\n      //   entry.setDirection('recvonly');\n      // } else {\n      ssrc.type === 'video' && entry.setEndpoint(ssrc.endpoint);\n      entry.createTransceiver(connection, {direction: 'recvonly'});\n      // }\n\n      modifiedTypes.add(entry.type);\n    });\n\n    /* if(TEST_OLD) {\n      this.setRemoteOffer({\n        connection,\n        description,\n        ssrcs\n      });\n    } else  */if(modifiedTypes.size) {\n      if(modifiedTypes.has('video')) {\n        connectionInstance.updateConstraints = true;\n      }\n\n      connectionInstance.negotiateThrottled();\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nenum GROUP_CALL_STATE {\n  UNMUTED,\n  MUTED,\n  MUTED_BY_ADMIN,\n  CONNECTING,\n  CLOSED\n}\n\nexport default GROUP_CALL_STATE;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport AudioAssetPlayer from '../../helpers/audioAssetPlayer';\r\n\r\nexport type GroupCallAudioAssetName = 'group_call_connect.mp3' | 'group_call_end.mp3' | 'group_call_start.mp3' | 'voip_onallowtalk.mp3';\r\n\r\nlet audioAsset: AudioAssetPlayer<GroupCallAudioAssetName>;\r\nexport default function getGroupCallAudioAsset() {\r\n  return audioAsset ??= new AudioAssetPlayer([\r\n    'group_call_connect.mp3',\r\n    'group_call_end.mp3',\r\n    'group_call_start.mp3',\r\n    'voip_onallowtalk.mp3'\r\n  ]);\r\n}\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport getGroupCallAudioAsset from '../../components/groupCall/getAudioAsset';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport EventListenerBase from '../../helpers/eventListenerBase';\r\nimport {GroupCallParticipant, GroupCallParticipantVideo, GroupCallParticipantVideoSourceGroup} from '../../layer';\r\nimport {GroupCallId, GroupCallConnectionType} from '../appManagers/appGroupCallsManager';\r\nimport {AppManagers} from '../appManagers/managers';\r\nimport {logger} from '../logger';\r\nimport rootScope from '../rootScope';\r\nimport GroupCallInstance from './groupCallInstance';\r\nimport GROUP_CALL_STATE from './groupCallState';\r\nimport createMainStreamManager from './helpers/createMainStreamManager';\r\nimport {generateSsrc} from './localConferenceDescription';\r\nimport {WebRTCLineType} from './sdpBuilder';\r\nimport StreamManager from './streamManager';\r\nimport {Ssrc} from './types';\r\n\r\nconst IS_MUTED = true;\r\n\r\nexport function makeSsrcsFromParticipant(participant: GroupCallParticipant) {\r\n  return [\r\n    makeSsrcFromParticipant(participant, 'audio', participant.source),\r\n    participant.video?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.video.audio_source),\r\n    participant.video && makeSsrcFromParticipant(participant, 'video', participant.video.source_groups, participant.video.endpoint),\r\n    participant.presentation?.audio_source && makeSsrcFromParticipant(participant, 'audio', participant.presentation.audio_source),\r\n    participant.presentation && makeSsrcFromParticipant(participant, 'video', participant.presentation.source_groups, participant.presentation.endpoint)\r\n  ].filter(Boolean);\r\n};\r\n\r\nexport function makeSsrcFromParticipant(participant: GroupCallParticipant, type: WebRTCLineType, source?: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\r\n  return generateSsrc(type, source, endpoint);\r\n}\r\n\r\nexport function generateSelfVideo(source: Ssrc, audioSource?: number): GroupCallParticipantVideo {\r\n  return source && {\r\n    _: 'groupCallParticipantVideo',\r\n    pFlags: {},\r\n    endpoint: '',\r\n    source_groups: source.sourceGroups,\r\n    audio_source: audioSource\r\n  };\r\n}\r\n\r\nexport class GroupCallsController extends EventListenerBase<{\r\n  instance: (instance: GroupCallInstance) => void\r\n}> {\r\n  private audioAsset: ReturnType<typeof getGroupCallAudioAsset>;\r\n  private log: ReturnType<typeof logger>;\r\n  private currentGroupCall: GroupCallInstance;\r\n  private managers: AppManagers;\r\n\r\n  public construct(managers: AppManagers) {\r\n    this.managers = managers;\r\n    this.audioAsset = getGroupCallAudioAsset();\r\n    this.log = logger('GCC');\r\n\r\n    rootScope.addEventListener('group_call_update', (groupCall) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCall.id) {\r\n        currentGroupCall.groupCall = groupCall;\r\n\r\n        if(groupCall._ === 'groupCallDiscarded') {\r\n          currentGroupCall.hangUp(false, false, true);\r\n        }\r\n      }\r\n    });\r\n\r\n    rootScope.addEventListener('group_call_participant', ({groupCallId, participant}) => {\r\n      const {currentGroupCall} = this;\r\n      if(currentGroupCall?.id === groupCallId) {\r\n        currentGroupCall.onParticipantUpdate(participant/* , this.doNotDispatchParticipantUpdate */);\r\n      }\r\n    });\r\n  }\r\n\r\n  get groupCall() {\r\n    return this.currentGroupCall;\r\n  }\r\n\r\n  public setCurrentGroupCall(groupCall: GroupCallInstance) {\r\n    this.currentGroupCall = groupCall;\r\n\r\n    if(groupCall) {\r\n      this.dispatchEvent('instance', groupCall);\r\n    }\r\n  }\r\n\r\n  public startConnectingSound() {\r\n    this.stopConnectingSound();\r\n    this.audioAsset.playSoundWithTimeout('group_call_connect.mp3', true, 2500);\r\n  }\r\n\r\n  public stopConnectingSound() {\r\n    this.audioAsset.stopSound();\r\n    this.audioAsset.cancelDelayedPlay();\r\n  }\r\n\r\n  public async joinGroupCall(chatId: ChatId, groupCallId: GroupCallId, muted = IS_MUTED, rejoin?: boolean, joinVideo?: boolean) {\r\n    this.audioAsset.createAudio();\r\n\r\n    this.log(`joinGroupCall chatId=${chatId} id=${groupCallId} muted=${muted} rejoin=${rejoin}`);\r\n\r\n    let streamManager: StreamManager;\r\n    if(rejoin) {\r\n      streamManager = this.currentGroupCall.connections.main.streamManager;\r\n    } else {\r\n      streamManager = await createMainStreamManager(muted, joinVideo);\r\n    }\r\n\r\n    return this.joinGroupCallInternal(chatId, groupCallId, streamManager, muted, rejoin, joinVideo);\r\n  }\r\n\r\n  public async joinGroupCallInternal(chatId: ChatId, groupCallId: GroupCallId, streamManager: StreamManager, muted: boolean, rejoin = false, joinVideo?: boolean) {\r\n    const log = this.log.bindPrefix('joinGroupCallInternal');\r\n    log('start', groupCallId);\r\n\r\n    const type: GroupCallConnectionType = 'main';\r\n\r\n    let {currentGroupCall} = this;\r\n    if(currentGroupCall && rejoin) {\r\n      // currentGroupCall.connections.main.connection = connection;\r\n      currentGroupCall.handleUpdateGroupCallParticipants = false;\r\n      currentGroupCall.updatingSdp = false;\r\n      log('update currentGroupCall', groupCallId, currentGroupCall);\r\n    } else {\r\n      currentGroupCall = new GroupCallInstance({\r\n        chatId,\r\n        id: groupCallId,\r\n        managers: this.managers\r\n      });\r\n\r\n      currentGroupCall.fixSafariAudio();\r\n\r\n      currentGroupCall.addEventListener('state', (state) => {\r\n        if(this.currentGroupCall === currentGroupCall && state === GROUP_CALL_STATE.CLOSED) {\r\n          this.setCurrentGroupCall(null);\r\n          this.stopConnectingSound();\r\n          this.audioAsset.playSound('group_call_end.mp3');\r\n          rootScope.dispatchEvent('chat_update', currentGroupCall.chatId);\r\n        }\r\n      });\r\n\r\n      currentGroupCall.groupCall = await this.managers.appGroupCallsManager.getGroupCallFull(groupCallId);\r\n\r\n      const connectionInstance = currentGroupCall.createConnectionInstance({\r\n        streamManager,\r\n        type,\r\n        options: {\r\n          type,\r\n          isMuted: muted,\r\n          joinVideo,\r\n          rejoin\r\n        }\r\n      });\r\n\r\n      const connection = connectionInstance.createPeerConnection();\r\n      connection.addEventListener('negotiationneeded', () => {\r\n        connectionInstance.negotiate();\r\n      });\r\n\r\n      connection.addEventListener('track', (event) => {\r\n        log('ontrack', event);\r\n        currentGroupCall.onTrack(event);\r\n      });\r\n\r\n      connection.addEventListener('iceconnectionstatechange', () => {\r\n        currentGroupCall.dispatchEvent('state', currentGroupCall.state);\r\n\r\n        const {iceConnectionState} = connection;\r\n        if(iceConnectionState === 'disconnected' || iceConnectionState === 'checking' || iceConnectionState === 'new') {\r\n          this.startConnectingSound();\r\n        } else {\r\n          this.stopConnectingSound();\r\n        }\r\n\r\n        switch(iceConnectionState) {\r\n          case 'checking': {\r\n            break;\r\n          }\r\n\r\n          case 'closed': {\r\n            currentGroupCall.hangUp();\r\n            break;\r\n          }\r\n\r\n          case 'completed': {\r\n            break;\r\n          }\r\n\r\n          case 'connected': {\r\n            if(!currentGroupCall.joined) {\r\n              currentGroupCall.joined = true;\r\n              this.audioAsset.playSound('group_call_start.mp3');\r\n              this.managers.appGroupCallsManager.getGroupCallParticipants(groupCallId);\r\n            }\r\n\r\n            break;\r\n          }\r\n\r\n          case 'disconnected': {\r\n            break;\r\n          }\r\n\r\n          case 'failed': {\r\n            // TODO: replace with ICE restart\r\n            currentGroupCall.hangUp();\r\n            // connection.restartIce();\r\n            break;\r\n          }\r\n\r\n          case 'new': {\r\n            break;\r\n          }\r\n        }\r\n      });\r\n\r\n      connectionInstance.createDescription();\r\n      connectionInstance.createDataChannel();\r\n\r\n      connectionInstance.appendStreamToConference();\r\n\r\n      this.setCurrentGroupCall(currentGroupCall);\r\n      log('set currentGroupCall', groupCallId, currentGroupCall);\r\n\r\n      this.startConnectingSound();\r\n\r\n      return connectionInstance.negotiate();\r\n    }\r\n  }\r\n}\r\n\r\nconst groupCallsController = new GroupCallsController();\r\nMOUNT_CLASS_TO && (MOUNT_CLASS_TO.groupCallController = groupCallsController);\r\nexport default groupCallsController;\r\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS} from '../constants';\nimport StreamManager from '../streamManager';\nimport getAudioConstraints from './getAudioConstraints';\nimport getStream from './getStream';\nimport getVideoConstraints from './getVideoConstraints';\n\nexport default async function createMainStreamManager(muted?: boolean, joinVideo?: boolean) {\n  const constraints: MediaStreamConstraints = {\n    audio: getAudioConstraints(),\n    video: joinVideo && getVideoConstraints()\n  };\n\n  const streamManager = new StreamManager(GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS);\n\n  try {\n    const stream = await getStream(constraints, muted);\n    streamManager.addStream(stream, 'input');\n  } catch(err) {\n    console.error('joinGroupCall getStream error', err, constraints);\n    streamManager.inputStream = new MediaStream();\n  }\n\n  return streamManager;\n}\n","import constraintSupported, {MyMediaTrackSupportedConstraints} from '../../../environment/constraintSupport';\n\nexport default function getAudioConstraints(): MediaTrackConstraints {\n  const constraints: MediaTrackConstraints = {\n    channelCount: 2\n  };\n\n  const desirable: (keyof MyMediaTrackSupportedConstraints)[] = [\n    'noiseSuppression',\n    'echoCancellation',\n    'autoGainControl'\n  ];\n\n  desirable.forEach((constraint) => {\n    if(constraintSupported(constraint)) {\n      // @ts-ignore\n      constraints[constraint] = true;\n    }\n  });\n\n  return constraints;\n}\n","export type MyMediaTrackSupportedConstraints = MediaTrackSupportedConstraints & {\n  noiseSuppression?: boolean,\n  autoGainControl?: boolean\n};\n\nexport default function constraintSupported(constraint: keyof MyMediaTrackSupportedConstraints) {\n  return (!!navigator?.mediaDevices?.getSupportedConstraints() as any as MyMediaTrackSupportedConstraints)[constraint];\n}\n","export default function getScreenConstraints(skipAudio?: boolean) {\n  const constraints: DisplayMediaStreamConstraints = {\n    video: {\n      // @ts-ignore\n      // cursor: 'always',\n      width: {max: 1920},\n      height: {max: 1080},\n      frameRate: {max: 30}\n    }\n  };\n\n  if(!skipAudio) {\n    constraints.audio = true;\n  }\n\n  return constraints;\n}\n","export default async function getScreenStream(constraints: DisplayMediaStreamConstraints) {\n  const screenStream = await navigator.mediaDevices.getDisplayMedia(constraints);\n  const track = screenStream.getVideoTracks()[0];\n  track.contentHint = 'text';\n  return screenStream;\n}\n","export default async function getStream(constraints: MediaStreamConstraints, muted: boolean) {\n  // console.log('getStream', constraints);\n\n  const stream = await navigator.mediaDevices.getUserMedia(constraints);\n  stream.getTracks().forEach((x) => {\n    x.enabled = !muted;\n  });\n\n  // console.log('getStream result', stream);\n  return stream;\n}\n\n(window as any).getStream = getStream;\n","export default function getVideoConstraints(): MediaTrackConstraints {\n  return {\n    width: {min: 1280, max: 1920/* , ideal: 1920 */},\n    height: {min: 720, max: 1080/* , ideal: 1080 */},\n    frameRate: {min: 24, max: 30}\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '../sdp';\nimport SDPMediaSection from '../sdp/mediaSection';\nimport {toTelegramSource} from '../utils';\nimport {parseSourceGroups} from './parseSourceGroups';\n\nexport default function parseMediaSectionInfo(sdp: SDP, channel: SDPMediaSection) {\n  const clientInfo = channel.lookupAttributeKeys({\n    'ice-ufrag': true,\n    'ice-pwd': true,\n    'fingerprint': true,\n    'setup': true,\n    'ssrc': true,\n    'mid': true,\n    'ssrc-group': false\n  });\n\n  if(!clientInfo.fingerprint) { // support Firefox\n    const line = sdp.session.lines.find((line) => line.parsed?.key === 'fingerprint');\n    clientInfo.fingerprint = line.parsed.value;\n  }\n\n  const telegramSourceGroups = parseSourceGroups(clientInfo['ssrc-group']);\n  const [hash, fingerprint] = clientInfo.fingerprint.split(' ', 2);\n  const ssrc = clientInfo.ssrc && toTelegramSource(+clientInfo.ssrc.split(' ', 1)[0]);\n  // ssrc = telegramSourceGroups ? telegramSourceGroups[0].sources[0] : ssrc;\n\n  return {\n    raw: clientInfo,\n    ufrag: clientInfo['ice-ufrag'],\n    pwd: clientInfo['ice-pwd'],\n    fingerprint: {\n      fingerprint,\n      setup: clientInfo.setup,\n      hash\n    },\n    source: ssrc,\n    sourceGroups: telegramSourceGroups,\n    mid: clientInfo.mid\n  };\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {GroupCallParticipantVideoSourceGroup} from '../../../layer';\nimport {toTelegramSource} from '../utils';\n\nexport function parseSourceGroups(sdpLines: string[]) {\n  const telegramSourceGroups = sdpLines.map((str) => {\n    const [semantics, ...rest] = str.split(' ');\n\n    const sourceGroup: GroupCallParticipantVideoSourceGroup = {\n      _: 'groupCallParticipantVideoSourceGroup',\n      semantics,\n      // sources: rest.map((ssrc) => +ssrc)\n      sources: rest.map((ssrc) => toTelegramSource(+ssrc))\n    };\n\n    return sourceGroup;\n  });\n\n  /* const simIndex = telegramSourceGroups.findIndex((g) => g.semantics === 'SIM');\n  if(simIndex !== -1) {\n    const sourceGroup = telegramSourceGroups.splice(simIndex, 1)[0];\n    telegramSourceGroups.unshift(sourceGroup);\n  } */\n\n  return telegramSourceGroups.length ? telegramSourceGroups : undefined;\n}\n","import simulateEvent from '../../../helpers/dom/dispatchEvent';\n\nexport default function stopTrack(track: MediaStreamTrack) {\n  track.stop();\n  simulateEvent(track, 'ended');\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport safeAssign from '../../helpers/object/safeAssign';\nimport {GroupCallParticipantVideoSourceGroup} from '../../layer';\nimport {fixMediaLineType, SDPBuilder, WebRTCLineType, WEBRTC_MEDIA_PORT} from './sdpBuilder';\nimport {AudioCodec, GroupCallConnectionTransport, Ssrc, UpdateGroupCallConnectionData, VideoCodec} from './types';\n\nexport class ConferenceEntry {\n  public source: number;\n  public sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  public transceiver: RTCRtpTransceiver;\n  public originalDirection: RTCRtpTransceiverDirection;\n  public direction: RTCRtpTransceiverDirection;\n  public port: string;\n  public endpoint: string;\n  public peerId: PeerId;\n\n  public sendEntry: ConferenceEntry;\n  public recvEntry: ConferenceEntry;\n\n  constructor(public mid: string, public type: WebRTCLineType) {\n    this.port = WEBRTC_MEDIA_PORT;\n  }\n\n  public setDirection(direction: RTCRtpTransceiverDirection) {\n    if(!this.originalDirection) {\n      this.originalDirection = direction;\n    }\n\n    return this.direction = direction;\n  }\n\n  public setPort(port: string) {\n    return this.port = port;\n  }\n\n  public setEndpoint(endpoint: string) {\n    return this.endpoint = endpoint;\n  }\n\n  public setPeerId(peerId: PeerId) {\n    return this.peerId = peerId;\n  }\n\n  public createTransceiver(connection: RTCPeerConnection, init?: RTCRtpTransceiverInit) {\n    if(init?.direction) {\n      this.setDirection(init.direction);\n    }\n\n    return this.transceiver = connection.addTransceiver(fixMediaLineType(this.type), init);\n  }\n\n  public setSource(source: number | GroupCallParticipantVideoSourceGroup[]) {\n    let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n    if(Array.isArray(source)) {\n      if(!source[0]) return;\n      sourceGroups = source;\n      source = sourceGroups[0].sources[0];\n    }\n\n    this.sourceGroups = sourceGroups;\n    return this.source = source;\n  }\n\n  public shouldBeSkipped(isAnswer?: boolean) {\n    return isAnswer && this.direction === 'inactive';\n  }\n}\n\nexport function generateSsrc(type: WebRTCLineType, source: number | GroupCallParticipantVideoSourceGroup[], endpoint?: string): Ssrc {\n  let sourceGroups: GroupCallParticipantVideoSourceGroup[];\n  if(Array.isArray(source)) {\n    if(!source[0]) return;\n    sourceGroups = source;\n    source = sourceGroups[0].sources[0];\n  }\n\n  return {\n    endpoint,\n    type,\n    source,\n    sourceGroups\n  };\n}\n\nexport default class LocalConferenceDescription implements UpdateGroupCallConnectionData {\n  public readonly sessionId: string;\n  // public ssrcs: Ssrc[];\n  public readonly transport: GroupCallConnectionTransport;\n  public readonly audio?: AudioCodec;\n  public readonly video: VideoCodec;\n  public readonly screencast?: VideoCodec;\n\n  private maxSeenId: number;\n  public readonly entries: ConferenceEntry[];\n  private entriesByMid: Map<ConferenceEntry['mid'], ConferenceEntry>;\n  private entriesBySource: Map<ConferenceEntry['source'], ConferenceEntry>;\n  private entriesByPeerId: Map<ConferenceEntry['peerId'], Set<ConferenceEntry>>;\n\n  constructor(public connection: RTCPeerConnection) {\n    this.sessionId = '' + Date.now();\n    // this.ssrcs = [];\n    this.maxSeenId = -1;\n    this.entries = [];\n    this.entriesByMid = new Map();\n    this.entriesBySource = new Map();\n    this.entriesByPeerId = new Map();\n  }\n\n  public setData(data: UpdateGroupCallConnectionData) {\n    return safeAssign(this, data);\n  }\n\n  public createEntry(type: WebRTCLineType) {\n    const mid = '' + ++this.maxSeenId;\n    const entry = new ConferenceEntry(mid, type);\n    this.entries.push(entry);\n    this.entriesByMid.set(mid, entry);\n    return entry;\n  }\n\n  public deleteEntry(entry: ConferenceEntry) {\n    indexOfAndSplice(this.entries, entry);\n    this.entriesByMid.delete(entry.mid);\n    this.entriesBySource.delete(entry.source);\n\n    const set = this.entriesByPeerId.get(entry.peerId);\n    if(set) {\n      set.delete(entry);\n      if(!set.size) {\n        this.entriesByPeerId.delete(entry.peerId);\n      }\n    }\n  }\n\n  public setEntrySource(entry: ConferenceEntry, source: Parameters<ConferenceEntry['setSource']>[0]) {\n    entry.setSource(source);\n    this.entriesBySource.set(entry.source, entry);\n  }\n\n  public setEntryPeerId(entry: ConferenceEntry, peerId: ConferenceEntry['peerId']) {\n    entry.setPeerId(peerId);\n    let set = this.entriesByPeerId.get(peerId);\n    if(!set) {\n      this.entriesByPeerId.set(peerId, set = new Set());\n    }\n\n    set.add(entry);\n  }\n\n  public findEntry(verify: Parameters<LocalConferenceDescription['entries']['find']>[0]) {\n    return this.entries.find(verify);\n  }\n\n  public findFreeSendRecvEntry(type: WebRTCLineType, isSending: boolean) {\n    let entry = this.entries.find((entry) => {\n      return entry.direction === 'sendrecv' && entry.type === type && !(isSending ? entry.sendEntry : entry.recvEntry);\n    });\n\n    if(!entry) {\n      entry = this.createEntry(type);\n      entry.setDirection('sendrecv');\n    }\n\n    return entry;\n  }\n\n  public getEntryByMid(mid: ConferenceEntry['mid']) {\n    return this.entriesByMid.get(mid);\n  }\n\n  public getEntryBySource(source: ConferenceEntry['source']) {\n    return this.entriesBySource.get(source);\n  }\n\n  public getEntriesByPeerId(peerId: ConferenceEntry['peerId']) {\n    return this.entriesByPeerId.get(peerId);\n  }\n\n  public generateSdp(options: Omit<Parameters<SDPBuilder['addConference']>[0], 'conference'>) {\n    return SDPBuilder.fromConference({\n      conference: this,\n      ...options\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport type AttributeKey = 'group' | 'rtcp' | 'ice-ufrag' |\n  'ice-pwd' | 'ice-options' | 'fingerprint' | 'setup' |\n  'mid' | 'extmap' | 'sendonly' | 'msid' | 'rtcp-mux' |\n  'rtpmap' | 'rtcp-fb' | 'fmtp' | 'ssrc' | 'ssrc-group' |\n  'extmap-allow-mixed' | 'msid-semantic';\n\nexport type AttributeMap = {[k in AttributeKey]?: boolean};\n\nexport default class SDP {\n  #session: SDPSessionSection;\n  #media: SDPMediaSection[];\n\n  constructor(session: SDP['session'], mediaSections: SDP['media']) {\n    this.#session = session;\n    this.#media = mediaSections;\n  }\n\n  public get session() {\n    return this.#session;\n  }\n\n  public get media() {\n    return this.#media;\n  }\n\n  public get bundle() {\n    const bundleLine = this.session.lines.find((line) => line.parsed?.key === 'group');\n    return bundleLine.value.split(' ').slice(1);\n  }\n\n  toString() {\n    return this.session.lines\n    .concat(...this.media.map((section) => section.lines))\n    .map((line) => line.toString()).join('\\r\\n') + '\\r\\n';\n  }\n\n  /* get buggedMedia() {\n    const bundle = this.bundle;\n    type A = {\n      mid: SDPMediaSection['mid'],\n      mediaType: SDPMediaSection['mediaType'],\n      direction: SDPMediaSection['direction']\n    };\n    const out: A[] = [];\n    for(let i = 0, length = this.media.length; i < length; ++i) {\n      const section = this.media[i];\n      const mid = section.mid;\n      if(!bundle.includes(mid)) {\n        out.push(section);\n      }\n    }\n\n    return out;\n  } */\n\n  /* get mediaTypes() {\n    return this.media.map((section) => {\n      return {mid: section.oa.get('mid').oa, type: section.mediaType, direction: section.direction};\n    });\n  } */\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default function splitStringByLimitWithRest(str: string, separator: string, limit: number) {\n  const splitted = str.split(separator);\n  const out: string[] = [];\n\n  while(limit > 0 && splitted.length) {\n    out.push(splitted.shift());\n    --limit;\n  }\n\n  if(splitted.length) {\n    out.push(splitted.join(separator));\n  }\n\n  return out;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class UniqueNumberGenerator {\n  #set: Set<number>;\n  #min: number;\n  #max: number;\n\n  constructor(min: number, max: number) {\n    this.#set = new Set();\n    this.#min = min;\n    this.#max = max;\n  }\n\n  public generate() {\n    const min = this.#min;\n    const max = this.#max;\n    const set = this.#set;\n\n    const maxTries = max - min + 1;\n    let value = Math.floor(min + maxTries * Math.random()), _try = 0;\n    while(set.has(value)) {\n      if(value < max) {\n        ++value;\n      } else {\n        value = min;\n      }\n\n      if(++_try >= maxTries) {\n        return null;\n      }\n    }\n\n    set.add(value);\n    return value;\n  }\n\n  public add(value: number) {\n    this.#set.add(value);\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeKey} from '.';\n\nexport default class SDPAttributeSplitted {\n  #key: AttributeKey;\n  #value: string;\n\n  // key = 'ssrc-group', value = 'SIM 1 2 3'\n  constructor(key: AttributeKey, value: string) {\n    this.#key = key;\n    this.#value = value;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nexport default class SDPMediaLineParts {\n  #type: 'audio' | 'video' | 'application';\n  #port: string;\n  #protocol: string;\n  #ids: string[];\n\n  constructor(\n    type: SDPMediaLineParts['type'],\n    port: SDPMediaLineParts['port'],\n    protocol: SDPMediaLineParts['protocol'],\n    ids: SDPMediaLineParts['ids']\n  ) {\n    this.#type = type;\n    this.#port = port;\n    this.#protocol = protocol;\n    this.#ids = ids;\n  }\n\n  public get type() {\n    return this.#type;\n  }\n\n  public get port() {\n    return this.#port;\n  }\n\n  public get protocol() {\n    return this.#protocol;\n  }\n\n  public get ids() {\n    return this.#ids;\n  }\n\n  toString() {\n    return this.type + ' ' + this.port + ' ' + this.protocol + ' ' + this.ids.join(' ');\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport SDPAttributeSplitted from './attributeSplitted';\nimport SDPMediaLineParts from './mediaLineParts';\n\nexport default class SDPLine {\n  #key: 'm' | 'a' | 'o' | 'v' | 's' | 't' | 'c';\n  #value: string;\n  #mediaLineParts: SDPMediaLineParts;\n  #parsed?: SDPAttributeSplitted;\n\n  // key = 'a', value = 'ssrc-group:SIM 1 2 3'\n  constructor(key: SDPLine['key'], value: string | SDPMediaLineParts | SDPAttributeSplitted) {\n    this.#key = key;\n\n    if(typeof(value) === 'string') {\n      this.#value = value;\n\n      if(key === 'm') {\n        const splitted = value.split(' ');\n        this.#mediaLineParts = new SDPMediaLineParts(splitted[0] as any, splitted[1], splitted[2], splitted.slice(3));\n      } else {\n        if(key === 'a') {\n          const result = splitStringByLimitWithRest(value, ':', 1);\n          value = result[0];\n          this.#parsed = result.length === 1 ? new SDPAttributeSplitted(value as any, null) : new SDPAttributeSplitted(value as any, result[1]);\n        }\n      }\n    } else {\n      if(value instanceof SDPMediaLineParts) {\n        this.#mediaLineParts = value;\n        this.#value = value.toString();\n      } else if(value instanceof SDPAttributeSplitted) {\n        this.#parsed = value;\n        this.#value = value.value ? `${value.key}:${value.value}` : value.key;\n      }\n    }\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get value() {\n    return this.#value;\n  }\n\n  public get parsed() {\n    return this.#parsed;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLineParts;\n  }\n\n  toString() {\n    return `${this.key}=${this.value}`;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\n\nexport default class SDPAttributeInner {\n  #key: string;\n  #lines: Array<string>;\n  #prefix: string;\n  #nestedMap: Map<string, SDPAttributeInner>;\n  #missed: boolean;\n  #keys: Array<string>;\n\n  constructor(key: SDPAttributeInner['key'], lines: SDPAttributeInner['lines'], prefix: string = ':', missed = false) {\n    this.#key = key;\n    this.#lines = lines;\n    this.#prefix = prefix;\n    this.#missed = missed;\n    this.#nestedMap = missed ? new Map() : null;\n    this.#keys = missed ? [] : null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get value() {\n    return this.#missed || !this.lines.length ? null : this.lines[0];\n  }\n\n  public get exists() {\n    return !this.#missed;\n  }\n\n  public get key() {\n    return this.#key;\n  }\n\n  public get keys() {\n    SDPAttributeInner.fill(this);\n    return this.#keys;\n  }\n\n  public forEach(callback: Parameters<Map<string, SDPAttributeInner>['forEach']>[0]) {\n    SDPAttributeInner.fill(this);\n    this.#nestedMap.forEach(callback);\n  }\n\n  public get(key: string) {\n    SDPAttributeInner.fill(this);\n    return this.#nestedMap.get(key) || new SDPAttributeInner(key, [], ':', true);\n  }\n\n  private static fill(attribute: SDPAttributeInner) {\n    if(attribute.#nestedMap !== null) {\n      return;\n    }\n\n    const map: Map<string, Array<string>> = new Map();\n    attribute.lines.forEach((str) => {\n      const [key, rest] = splitStringByLimitWithRest(str, attribute.#prefix, 1);\n      const values = map.get(key) || [];\n      map.set(key, [...values, rest || '']);\n    });\n\n    const nestedMap = attribute.#nestedMap = SDPAttributeInner.makeAttributes(map);\n    attribute.#keys = Array.from(nestedMap.keys());\n  }\n\n  private static makeAttributes(innerParts: Map<string, Array<string>>) {\n    const out: Map<string, SDPAttributeInner> = new Map();\n\n    innerParts.forEach((lines, key) => {\n      out.set(key, new SDPAttributeInner(key, lines));\n    });\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPAttributeInner from './attributeInner';\nimport SDPLine from './line';\n\nexport default class SDPAttributes {\n  #lines: SDPLine[];\n  #attributes: Map<string, SDPAttributeInner>;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#attributes = new Map();\n    SDPAttributes.fillAttributes(this);\n  }\n\n  public get(key: string) {\n    return this.#attributes.get(key) || new SDPAttributeInner(key, [], ' ', true);\n  }\n\n  private static fillAttributes(attributes: SDPAttributes) {\n    const attributesMap: Map<string, Array<string>> = new Map();\n    attributes.#lines.forEach((line) => {\n      if(line.key === 'a') {\n        const {key, value} = line.parsed;\n\n        let linesArray = attributesMap.get(key);\n        if(!linesArray) {\n          linesArray = [];\n          attributesMap.set(key, linesArray);\n        }\n\n        linesArray.push(value || '');\n      }\n    });\n\n    attributesMap.forEach((linesArray, key) => {\n      attributes.#attributes.set(key, new SDPAttributeInner(key, linesArray, ' ', false));\n    });\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {AttributeMap} from '.';\nimport {NoExtraProperties} from '../../../types';\nimport SDPAttributes from './attributes';\nimport SDPLine from './line';\n\nexport type SDPMediaDirection = 'sendonly' | 'recvonly' | 'inactive' | 'sendrecv';\nexport default class SDPMediaSection {\n  #lines: Array<SDPLine>;\n  #mediaLine: SDPLine;\n  #attributes: SDPAttributes;\n  #direction: SDPMediaDirection;\n\n  constructor(lines: Array<SDPLine>) {\n    this.#lines = lines;\n    this.#mediaLine = lines[0];\n    this.#attributes = this.#direction = null;\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get mediaLine() {\n    return this.#mediaLine;\n  }\n\n  public get mediaLineParts() {\n    return this.#mediaLine.mediaLineParts;\n  }\n\n  public get mediaType() {\n    return this.mediaLineParts.type;\n  }\n\n  public get direction() {\n    if(!this.#direction) {\n      const attributes = this.attributes;\n\n      let direction: SDPMediaDirection;\n      if(attributes.get('sendonly').exists) direction = 'sendonly';\n      else if(attributes.get('recvonly').exists) direction = 'recvonly';\n      else if(attributes.get('inactive').exists) direction = 'inactive';\n      else direction = 'sendrecv';\n\n      this.#direction = direction;\n    }\n\n    return this.#direction;\n  }\n\n  public get isSending() {\n    return this.direction === 'sendrecv' || this.direction === 'sendonly';\n  }\n\n  public get isReceiving() {\n    return this.direction === 'sendrecv' || this.direction === 'recvonly';\n  }\n\n  public get attributes() {\n    this.#attributes || (this.#attributes = new SDPAttributes(this.lines));\n    return this.#attributes;\n  }\n\n  public get mid() {\n    return this.attributes.get('mid').value;\n  }\n\n  public lookupAttributeKeys<T extends AttributeMap>(keys: NoExtraProperties<AttributeMap, T>): {[k in keyof T]: T[k] extends true ? string : string[]} {\n    const out: any = {};\n\n    for(const key in keys) {\n      const result = this.attributes.get(key);\n      // @ts-ignore\n      const resultShouldBeArray = !keys[key];\n      if(!result) {\n        out[key] = resultShouldBeArray ? [] : undefined;\n      } else {\n        out[key] = resultShouldBeArray ? result.lines : result.value;\n      }\n    }\n\n    return out;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDPLine from './line';\n\nexport default class SDPSessionSection {\n  #lines: SDPLine[];\n  #sessionId: string;\n\n  constructor(lines: SDPLine[]) {\n    this.#lines = lines;\n    this.#sessionId = lines.filter((line) => line.key === 'o').map((line) => line.value.split(' ')[1])[0];\n  }\n\n  public get lines() {\n    return this.#lines;\n  }\n\n  public get sessionId() {\n    return this.#sessionId;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport SDP from '.';\nimport splitStringByLimitWithRest from '../../../helpers/string/splitStringByLimitWithRest';\nimport UniqueNumberGenerator from '../../../helpers/uniqueNumberGenerator';\nimport SDPLine from './line';\nimport SDPMediaSection from './mediaSection';\nimport SDPSessionSection from './sessionSection';\n\nexport function parseSdp(str: string) {\n  function createSection() {\n    if(sessionSection) {\n      mediaSections.push(new SDPMediaSection(lines));\n    } else {\n      sessionSection = new SDPSessionSection(lines);\n    }\n  }\n\n  let sessionSection: SDPSessionSection = null, lines: SDPLine[] = [];\n  const mediaSections: SDPMediaSection[] = [];\n  str.split(/\\r?\\n/).forEach((lineStr) => {\n    if(!isIncorrectSdpLine(lineStr)) {\n      const line = parseSdpLine(lineStr);\n      if(line.key === 'm') {\n        createSection();\n        lines = [];\n      }\n\n      lines.push(line);\n    }\n  });\n\n  createSection();\n  return new SDP(sessionSection, mediaSections);\n}\n\nexport function isIncorrectSdpLine(str: string) {\n  return /^[\\s\\xa0]*$/.test(str);\n}\n\nexport function parseSdpLine(str: string) {\n  const splitted = splitStringByLimitWithRest(str, '=', 1);\n  return new SDPLine(splitted[0] as any, splitted[1]);\n}\n\nexport function addSimulcast(sdp: SDP) {\n  let generator: UniqueNumberGenerator;\n  sdp.media.forEach((section, idx) => {\n    if(section.mediaType === 'video' && section.isSending && !section.attributes.get('ssrc-group').get('SIM').exists) {\n      if(!generator) {\n        generator = new UniqueNumberGenerator(2, 4294967295);\n      }\n\n      const originalSsrcs = section.attributes.get('ssrc-group').get('FID').value.split(' ');\n      const lines = section.lines;\n      originalSsrcs.forEach((ssrc) => generator.add(+ssrc)); // fix possible duplicates\n      const ssrcs = [originalSsrcs[0], generator.generate(), generator.generate()];\n      const ssrcs2 = [originalSsrcs[1], generator.generate(), generator.generate()];\n\n      lines.push(parseSdpLine('a=ssrc-group:SIM ' + ssrcs.join(' ')));\n\n      const ssrcsStrLines = section.attributes.get('ssrc').get(originalSsrcs[0]).lines;\n\n      ssrcs.forEach((ssrc, idx) => {\n        const ssrc2 = ssrcs2[idx];\n        if(idx > 0) {\n          lines.push(parseSdpLine('a=ssrc-group:FID ' + ssrc + ' ' + ssrc2));\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc + ' ' + v));\n          });\n\n          ssrcsStrLines.forEach((v) => {\n            lines.push(parseSdpLine('a=ssrc:' + ssrc2 + ' ' + v));\n          });\n        }\n      });\n\n      sdp.media[idx] = new SDPMediaSection(lines);\n    }\n  });\n\n  return !!generator;\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport {IS_FIREFOX} from '../../environment/userAgent';\nimport LocalConferenceDescription, {ConferenceEntry} from './localConferenceDescription';\nimport StringFromLineBuilder from './stringFromLineBuilder';\nimport {GroupCallConnectionTransport, PayloadType, UpdateGroupCallConnectionData} from './types';\nimport {fromTelegramSource} from './utils';\n\n// screencast is for Peer-to-Peer only\nexport type WebRTCLineTypeTrue = 'video' | 'audio' | 'application';\nexport type WebRTCLineType = WebRTCLineTypeTrue | 'screencast';\n\nexport const WEBRTC_MEDIA_PORT = '9';\n\nexport function fixMediaLineType(mediaType: WebRTCLineType) {\n  return mediaType === 'screencast' ? 'video' : mediaType;\n}\n\nexport function performCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n  const arr: string[] = [];\n  arr.push('a=candidate:');\n  arr.push(`${c.foundation} ${c.component} ${c.protocol.toUpperCase()} ${c.priority} ${c.ip} ${c.port} typ ${c.type}`);\n  if(c['rel-addr'] !== undefined) {\n    arr.push(` raddr ${c['rel-addr']} rport ${c['rel-port']}`);\n  }\n  arr.push(` generation ${c.generation}`);\n  return arr.join('');\n}\n\nexport function getConnectionTypeForMediaType(mediaType: WebRTCLineType) {\n  // return mediaType === 'application' ? 'DTLS/SCTP' : 'RTP/SAVPF';\n  return mediaType === 'application' ? 'DTLS/SCTP' : 'UDP/TLS/RTP/SAVPF';\n}\n\nexport function generateMediaFirstLine(mediaType: WebRTCLineType, port = WEBRTC_MEDIA_PORT, payloadIds: (string | number)[]) {\n  const connectionType = getConnectionTypeForMediaType(mediaType);\n  return `m=${fixMediaLineType(mediaType)} ${port} ${connectionType} ${payloadIds.join(' ')}`;\n}\n\ntype ConferenceData = UpdateGroupCallConnectionData | LocalConferenceDescription;\n\n// https://tools.ietf.org/id/draft-ietf-rtcweb-sdp-08.html\n// https://datatracker.ietf.org/doc/html/draft-roach-mmusic-unified-plan-00\nexport class SDPBuilder extends StringFromLineBuilder {\n  public addCandidate(c: GroupCallConnectionTransport['candidates'][0]) {\n    return this.add(performCandidate(c));\n  }\n\n  /* public addDataChannel(mid: string, transport: GroupCallConnectionTransport, isAnswer?: boolean) {\n    this.add(\n      'm=application 9 UDP/DTLS/SCTP webrtc-datachannel',\n      'c=IN IP4 0.0.0.0',\n      'a=ice-options:trickle',\n      `a=mid:${mid}`\n    );\n\n    // if(!isAnswer) {\n      this.add('a=sendrecv');\n    // }\n\n    this.addTransport(transport, isAnswer);\n\n    return this.add(\n      'a=sctp-port:5000',\n      'a=max-message-size:262144'\n    );\n  } */\n\n  public addHeader(sId: string, bundleMids: string[]) {\n    const bundle = bundleMids.join(' ');\n    return this.add(\n      'v=0',                          // version\n      `o=- ${sId} 2 IN IP4 0.0.0.0`,  // sessionId, 2=sessionVersion\n      's=-',                          // name of the session\n      't=0 0',                        // time when session is valid\n      'a=extmap-allow-mixed',\n      `a=group:BUNDLE ${bundle}`,\n      'a=ice-options:trickle',\n      // 'a=ice-lite',                   // ice-lite: is a minimal version of the ICE specification, intended for servers running on a public IP address.\n      'a=msid-semantic:WMS *'\n    );\n  }\n\n  public addTransport(transport: GroupCallConnectionTransport, skipCandidates?: boolean) {\n    this.add(\n      `a=ice-ufrag:${transport.ufrag}`,\n      `a=ice-pwd:${transport.pwd}`,\n      'a=ice-options:trickle'           // ! test\n    );\n\n    for(const fingerprint of transport.fingerprints) {\n      this.add(\n        `a=fingerprint:${fingerprint.hash} ${fingerprint.fingerprint}`,\n        `a=setup:${fingerprint.setup}`\n      );\n    }\n\n    if(!skipCandidates && transport.candidates) {\n      for(const candidate of transport.candidates) {\n        this.addCandidate(candidate);\n      }\n    }\n\n    return this;\n  }\n\n  public addSsrc(entry: ConferenceEntry) {\n    let streamName = 'stream';\n    let {type, sourceGroups} = entry;\n\n    // let source = ssrc.source ?? ssrc.sourceGroups[0].sources[0];\n    // source = fromTelegramSource(source);\n    const source = fromTelegramSource(entry.source);\n\n    streamName += source;\n    type += source as any;\n\n    // streamName += mid;\n    // type += mid as any;\n\n    // streamName = type = entry.transceiver.receiver.track.id as any;\n\n    const addMsid = () => {\n      this.add(`a=msid:${streamName} ${type}`);\n    };\n\n    const addSource = (ssrc: number) => {\n      this.add(\n        `a=ssrc:${ssrc} cname:${streamName}`,\n        `a=ssrc:${ssrc} msid:${streamName} ${type}`,\n        `a=ssrc:${ssrc} mslabel:${streamName}`,\n        `a=ssrc:${ssrc} label:${type}`\n      );\n    };\n\n    addMsid();\n    if(sourceGroups?.length) {\n      sourceGroups.forEach((ssrcGroup) => {\n        if(ssrcGroup.sources.length) {\n          const sources = ssrcGroup.sources.map(fromTelegramSource);\n          this.add(`a=ssrc-group:${ssrcGroup.semantics} ${sources.join(' ')}`);\n          sources.forEach(addSource);\n        }\n      });\n    } else {\n      addSource(source);\n    }\n\n    return this;\n  }\n\n  public addSsrcEntry(entry: ConferenceEntry, data: ConferenceData, isAnswer?: boolean) {\n    const add = (...x: string[]) => this.add(...x);\n\n    const {type, mid, direction, port} = entry;\n    const transport = data.transport;\n\n    /* if(type === 'application') {\n      return this.addDataChannel(mid, transport, isAnswer);\n    } */\n\n    const isApplication = type === 'application';\n    const codec = isApplication ? undefined : data[type];\n\n    const isInactive = direction === 'inactive';\n    if(entry.shouldBeSkipped(isAnswer)) {\n      return add(\n        `m=${fixMediaLineType(type)} 0 ${getConnectionTypeForMediaType(type)} 0`,\n        `c=IN IP4 0.0.0.0`,\n        `a=inactive`,\n        `a=mid:${mid}`\n      );\n    }\n\n    const payloadTypes = !isApplication ? codec['payload-types'] : [{id: 5000} as PayloadType];\n    const ids = payloadTypes.map((type) => type.id);\n    add(\n      generateMediaFirstLine(type, port, ids),\n      'c=IN IP4 0.0.0.0',\n      `a=rtcp:${port} IN IP4 0.0.0.0`\n    );\n\n    if(transport['rtcp-mux']) {\n      add('a=rtcp-mux');\n    }\n\n    add(`a=mid:${mid}`);\n    /* if(type === 'video') {\n      add('b=AS:2500');\n    } */\n\n    let setDirection = direction;\n    if(direction !== 'sendrecv' && isAnswer && !(isInactive || isApplication)) {\n      setDirection = direction === 'sendonly' ? 'recvonly' : 'sendonly';\n    }\n\n    // a=bundle-only\n    add(`a=${setDirection}`);\n\n    // this.addTransport(transport, isAnswer);\n    this.addTransport(transport);\n\n    if(!isApplication) {\n      const hdrexts = codec['rtp-hdrexts'];\n      if(hdrexts?.length) {\n        hdrexts.forEach((hdrext) => {\n          add(`a=extmap:${hdrext.id} ${hdrext.uri}`);\n        });\n      }\n\n      payloadTypes.forEach((type) => {\n        add(`a=rtpmap:${type.id} ${type.name}/${type.clockrate}${type.channels && type.channels > 1 ? `/${type.channels}` : ''}`);\n\n        const parameters = type.parameters;\n        if(Array.isArray(parameters)) {\n          if(parameters.length) {\n            console.error('parameters is array???', parameters);\n          }\n        } else if(parameters && Object.keys(parameters).length) {\n          const p: string[] = [];\n          for(const i in parameters) {\n            p.push(`${i}=${parameters[i]}`);\n          }\n          add(`a=fmtp:${type.id} ${p.join(';')}`);\n        }\n\n        const fbs = type['rtcp-fbs'];\n        if(fbs?.length) {\n          fbs.forEach((fb) => {\n            add(`a=rtcp-fb:${type.id} ${fb.type}${fb.subtype ? ' ' + fb.subtype : ''}`);\n          });\n        }\n      });\n    } else {\n      add(`a=sctpmap:${payloadTypes[0].id} webrtc-datachannel 256`);\n    }\n\n    if(entry.source && (setDirection === 'sendonly' || setDirection === 'sendrecv')) {\n      this.addSsrc(entry);\n    }\n\n    return this;\n  }\n\n  public addConference(options: {\n    conference: LocalConferenceDescription,\n    bundle: string[],\n    entries: ConferenceEntry[],\n    isAnswer?: boolean,\n  }) {\n    const {conference, entries, bundle, isAnswer} = options;\n    this.addHeader(conference.sessionId, bundle);\n\n    if(IS_FIREFOX) {\n      this.addTransport(conference.transport); // support Firefox\n    }\n\n    for(const entry of entries) {\n      // this.addSsrcEntry(entry, conference, isAnswer);\n      this.addSsrcEntry((isAnswer ? entry.recvEntry || entry.sendEntry : entry.sendEntry || entry.recvEntry) || entry, conference, isAnswer);\n    }\n\n    return this;\n  }\n\n  public static fromConference(options: Parameters<SDPBuilder['addConference']>[0]) {\n    return new SDPBuilder().addConference(options).finalize();\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport {logger} from '../logger';\nimport rootScope from '../rootScope';\nimport {GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX} from './constants';\nimport stopTrack from './helpers/stopTrack';\nimport LocalConferenceDescription from './localConferenceDescription';\nimport {fixMediaLineType, WebRTCLineType} from './sdpBuilder';\nimport {getAmplitude, toTelegramSource} from './utils';\n\nexport type StreamItemBase = {\n  type: 'input' | 'output',\n  track: MediaStreamTrack,\n  source: string,\n  stream: MediaStream\n};\n\nexport type StreamItem = StreamAudioItem | StreamVideoItem;\n\nexport type StreamAudioItem = StreamItemBase & {kind: 'audio', streamAnalyser: AudioStreamAnalyser};\nexport type StreamVideoItem = StreamItemBase & {kind: 'video'};\n\nexport type StreamAmplitude = {\n  type: 'input' | 'output';\n  source: string;\n  stream: MediaStream;\n  track: MediaStreamTrack;\n  value: number;\n};\n\nclass AudioStreamAnalyser {\n  public analyser: AnalyserNode;\n  public gain: GainNode;\n  public streamSource: MediaStreamAudioSourceNode;\n\n  constructor(context: AudioContext, stream: MediaStream) {\n    const streamSource = this.streamSource = context.createMediaStreamSource(stream);\n    const analyser = this.analyser = context.createAnalyser();\n    const gain = this.gain = context.createGain();\n    // const streamDestination = context.createMediaStreamDestination();\n\n    analyser.minDecibels = -100;\n    analyser.maxDecibels = -30;\n    analyser.smoothingTimeConstant = 0.05;\n    analyser.fftSize = 1024;\n\n    // connect Web Audio API\n    streamSource.connect(analyser);\n    // analyser.connect(context.destination);\n  }\n}\n\nexport default class StreamManager {\n  public static ANALYSER_LISTENER = new EventListenerBase<{amplitude: (details: {amplitudes: StreamAmplitude[], type: 'all' | 'input'}) => void}>();\n  private context: AudioContext;\n  public outputStream: MediaStream;\n  public inputStream: MediaStream;\n\n  private timer: number;\n  private counter: number;\n\n  private items: StreamItem[];\n\n  private log: ReturnType<typeof logger>;\n\n  public direction: RTCRtpTransceiver['direction'];\n  public canCreateConferenceEntry: boolean;\n  public locked: boolean;\n  public types: WebRTCLineType[];\n\n  constructor(private interval?: number) {\n    this.context = new (window.AudioContext || (window as any).webkitAudioContext)();\n    this.items = [];\n    this.outputStream = new MediaStream();\n    this.inputStream = new MediaStream();\n    this.counter = 0;\n    this.log = logger('SM');\n    this.direction = 'sendonly';\n    this.canCreateConferenceEntry = true;\n    // this.lol = true;\n    this.types = ['audio', 'video'];\n  }\n\n  public addStream(stream: MediaStream, type: StreamItem['type']) {\n    stream.getTracks().forEach((track) => {\n      this.addTrack(stream, track, type);\n    });\n  }\n\n  public addTrack(stream: MediaStream, track: MediaStreamTrack, type: StreamItem['type']) {\n    this.log('addTrack', type, track, stream);\n\n    const {context, items, inputStream, outputStream} = this;\n    const kind: StreamItem['kind'] = track.kind as any;\n    const source = StreamManager.getSource(stream, type);\n\n    // this.removeTrack(track);\n    switch(type) {\n      case 'input': {\n        if(!inputStream) {\n          this.inputStream = stream;\n        } else {\n          inputStream.addTrack(track);\n        }\n\n        break;\n      }\n\n      case 'output': {\n        for(let i = 0; i < items.length; ++i) {\n          const {track: t, type, source: itemSource} = items[i];\n          if(itemSource === source && type === 'input') {\n            items.splice(i, 1);\n            outputStream.removeTrack(t);\n            break;\n          }\n        }\n\n        if(kind !== 'video') {\n          outputStream.addTrack(track);\n        }\n\n        break;\n      }\n    }\n\n    this.finalizeAddingTrack({\n      type,\n      source,\n      stream,\n      track,\n      kind,\n      streamAnalyser: kind === 'audio' ? new AudioStreamAnalyser(context, stream) : undefined\n    });\n\n    if(kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  private finalizeAddingTrack(item: StreamItem) {\n    const {track} = item;\n    track.addEventListener('ended', () => {\n      this.removeTrack(track);\n    }, {once: true});\n\n    this.items.push(item);\n  }\n\n  public hasInputTrackKind(kind: StreamItem['kind']) {\n    return this.items.find((item) => item.type === 'input' && item.kind === kind);\n  }\n\n  public static getSource(stream: MediaStream, type: StreamItem['type']) {\n    return type === 'input' ? (stream.source || stream.id) : '' + toTelegramSource(+stream.id.substring(6));\n  }\n\n  public removeTrack(track: MediaStreamTrack) {\n    this.log('removeTrack', track);\n\n    const {items} = this;\n\n    let handled = false;\n    for(let i = 0, length = items.length; !handled && i < length; ++i) {\n      const {track: t, type} = items[i];\n      switch(type) {\n        case 'output': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.outputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n\n        case 'input': {\n          if(t === track) {\n            items.splice(i, 1);\n            this.inputStream.removeTrack(track);\n            handled = true;\n          }\n\n          break;\n        }\n      }\n    }\n\n    if(track.kind === 'audio' && this.interval) {\n      this.changeTimer();\n    }\n  }\n\n  public replaceInputAudio(stream: MediaStream, oldTrack: MediaStreamTrack) {\n    this.removeTrack(oldTrack);\n    this.addStream(stream, 'input');\n  }\n\n  private changeTimer() {\n    if(this.timer !== undefined) {\n      clearInterval(this.timer);\n    }\n\n    if(this.items.length) {\n      this.timer = window.setInterval(this.analyse, this.interval);\n    }\n  }\n\n  public getAmplitude = (item: StreamAudioItem): StreamAmplitude => {\n    const {streamAnalyser, stream, track, source, type} = item;\n    const analyser = streamAnalyser.analyser;\n    if(!analyser) return;\n\n    const array = new Uint8Array(analyser.frequencyBinCount);\n    analyser.getByteFrequencyData(array);\n    const value = getAmplitude(array);\n\n    return {\n      type,\n      source,\n      stream,\n      track,\n      value\n    };\n  };\n\n  public analyse = () => {\n    const all = this.counter % 3 === 0;\n    const filteredItems = all ? this.items : this.items.filter((x) => x.type === 'input');\n    const audioItems = filteredItems.filter((x) => x.kind === 'audio') as StreamAudioItem[];\n    const amplitudes = audioItems.slice(0, GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX).map(this.getAmplitude);\n    if(++this.counter >= 1000) {\n      this.counter = 0;\n    }\n\n    StreamManager.ANALYSER_LISTENER.dispatchEvent('amplitude', {\n      amplitudes,\n      type: all ? 'all' : 'input'\n    });\n  };\n\n  /* public appendToConnection(connection: RTCPeerConnection) {\n    if(this.inputStream) {\n      this.inputStream.getTracks().forEach((track) => {\n        connection.log('addTrack', track);\n        connection.addTrack(track, this.inputStream);\n\n        if(track.kind === 'video') {\n          track.enabled = true;\n        }\n      });\n    }\n  } */\n\n  public appendToConference(conference: LocalConferenceDescription) {\n    if(this.locked) {\n      return;\n    }\n\n    const {inputStream, direction, canCreateConferenceEntry} = this;\n    const transceiverInit: RTCRtpTransceiverInit = {direction, streams: [inputStream]};\n    const types = this.types.map((type) => {\n      return [\n        type,\n        /* type === 'video' || type === 'screencast' ?\n          {sendEncodings: [{maxBitrate: 2500000}], ...transceiverInit} :  */\n        transceiverInit\n      ] as const;\n    });\n\n    const tracks = inputStream.getTracks();\n    // const transceivers = conference.connection.getTransceivers();\n    for(const [type, transceiverInit] of types) {\n      let entry = conference.findEntry((entry) => entry.direction === direction && entry.type === type);\n      if(!entry) {\n        if(!canCreateConferenceEntry) {\n          continue;\n        }\n\n        entry = conference.createEntry(type);\n      }\n      /* const entry = conference.findFreeSendRecvEntry(type, true);\n      if(!entry.transceiver) {\n        entry.transceiver = transceivers.find((transceiver) => transceiver.mid === entry.mid);\n      } */\n\n      let {transceiver} = entry;\n      if(!transceiver) {\n        transceiver = entry.createTransceiver(conference.connection, transceiverInit);\n\n        /* if(this.isScreenSharingManager) {\n          transceiver.sender.setParameters({\n            ...transceiver.sender.getParameters(),\n            degradationPreference: 'maintain-resolution'\n          });\n        } */\n      }\n\n      if(entry.direction !== transceiver.direction) {\n        transceiver.direction = entry.direction;\n      }\n\n      const mediaTrackType = fixMediaLineType(type);\n      const trackIdx = tracks.findIndex((track) => track.kind === mediaTrackType);\n      const track = trackIdx !== -1 ? tracks.splice(trackIdx, 1)[0] : undefined;\n      const sender = transceiver.sender;\n      if(sender.track === track) {\n        continue;\n      }\n\n      // try { // ! don't use await here. it will wait for adding track and fake one won't be visible in startNegotiation.\n      /* await  */sender.replaceTrack(track).catch((err) => {\n        this.log.error(err);\n      });\n      // } catch(err) {\n\n      // }\n    }\n  }\n\n  public stop() {\n    try {\n      const tracks = this.inputStream.getTracks().concat(this.outputStream.getTracks());\n      tracks.forEach((track) => {\n        stopTrack(track);\n      });\n    } catch(e) {\n      this.log.error(e);\n    }\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\nexport default class StringFromLineBuilder {\n  private lines: string[];\n  private newLine: string[];\n\n  constructor(private joiner = '\\r\\n') {\n    this.lines = [];\n    this.newLine = [];\n  }\n\n  public add(...strs: string[]) {\n    this.lines.push(...strs);\n    return this;\n  }\n\n  public push(word: string) {\n    this.newLine.push(word);\n    return this;\n  }\n\n  public addJoined(separator = '') {\n    this.add(this.newLine.join(separator));\n    this.newLine = [];\n    return this;\n  }\n\n  public join() {\n    return this.lines.join(this.joiner);\n  }\n\n  public finalize() {\n    return this.join() + this.joiner;\n  }\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n *\n * Originally from:\n * https://github.com/evgeny-nadymov/telegram-react\n * Copyright (C) 2018 Evgeny Nadymov\n * https://github.com/evgeny-nadymov/telegram-react/blob/master/LICENSE\n */\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// unsign => sign\nexport function toTelegramSource(source: number) {\n  return source << 0;\n}\n\n// NOTE: telegram returns sign source, while webrtc uses unsign source internally\n// sign => unsign\nexport function fromTelegramSource(source: number) {\n  return source >>> 0;\n}\n\nexport function getAmplitude(array: Uint8Array, scale = 3) {\n  if(!array) return 0;\n\n  const {length} = array;\n  let total = 0;\n  for(let i = 0; i < length; ++i) {\n    total += array[i] * array[i];\n  }\n  const rms = Math.sqrt(total / length) / 255;\n\n  return Math.min(1, rms * scale);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport wrapEmojiText from './wrapEmojiText';\n\nexport default function getAbbreviation(str: string, onlyFirst = false) {\n  if(!str) return '';\n  const splitted = str.trim().split(' ');\n  if(!splitted[0]) return '';\n\n  const first = [...splitted[0]][0];\n\n  if(onlyFirst || splitted.length === 1) return wrapEmojiText(first);\n\n  const last = [...splitted[splitted.length - 1]][0];\n\n  return wrapEmojiText(first + last);\n}\n","import {MessageEntity} from '../../layer';\nimport {toCodePoints} from '../../vendor/emoji';\n\nexport default function getEmojiEntityFromEmoji(emoji: string): MessageEntity.messageEntityEmoji {\n  return {\n    _: 'messageEntityEmoji',\n    offset: 0,\n    length: emoji.length,\n    unicode: toCodePoints(emoji).join('-').replace(/-?fe0f/g, '')\n  };\n}\n","import {EMAIL_REG_EXP} from '.';\n\nexport default function matchEmail(text: string) {\n  return !text ? null : text.match(EMAIL_REG_EXP);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport {MessageEntity} from '../../layer';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapDraftText(text: string, options: Partial<{\n  entities: MessageEntity[]\n}> = {}) {\n  if(!text) {\n    return wrapRichText('');\n  }\n\n  return wrapRichText(text, {\n    entities: options.entities,\n    noLinks: true,\n    wrappingDraft: true,\n    passEntities: {\n      messageEntityTextUrl: true,\n      messageEntityMentionName: true\n    }\n  });\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport parseEntities from './parseEntities';\nimport wrapRichText from './wrapRichText';\n\nexport default function wrapEmojiText(text: string, isDraft = false) {\n  if(!text) return wrapRichText('');\n\n  const entities = parseEntities(text).filter((e) => e._ === 'messageEntityEmoji');\n  return wrapRichText(text, {entities, wrappingDraft: isDraft});\n}\n","export default function setBlankToAnchor(anchor: HTMLAnchorElement) {\n  anchor.target = '_blank';\n  anchor.rel = 'noopener noreferrer';\n  return anchor;\n}\n","import IS_EMOJI_SUPPORTED from './emojiSupport';\n\nexport type EMOJI_VERSION = '' | '14';\n\nconst EMOJI_VERSIONS_SUPPORTED: {\n  [v in EMOJI_VERSION]: boolean\n} = {} as any;\n\n// Thanks to WebZ for the detect\nfunction isEmojiSupported(emoji: string) {\n  const ALLOWABLE_CALCULATION_ERROR_SIZE = 5;\n  const inlineEl = document.createElement('span');\n  inlineEl.classList.add('emoji');\n  document.body.appendChild(inlineEl);\n\n  inlineEl.innerText = emoji; // Emoji from 14.0 version\n  const newEmojiWidth = inlineEl.offsetWidth;\n  inlineEl.innerText = ''; // Emoji from 1.0 version\n  const legacyEmojiWidth = inlineEl.offsetWidth;\n\n  document.body.removeChild(inlineEl);\n\n  return Math.abs(newEmojiWidth - legacyEmojiWidth) < ALLOWABLE_CALCULATION_ERROR_SIZE;\n}\n\nif(IS_EMOJI_SUPPORTED) {\n  EMOJI_VERSIONS_SUPPORTED[''] = true;\n\n  const a: [keyof typeof EMOJI_VERSIONS_SUPPORTED, string][] = [\n    ['14', '']\n  ];\n\n  a.forEach(([version, emoji]) => {\n    EMOJI_VERSIONS_SUPPORTED[version] = isEmojiSupported(emoji);\n  });\n}\n\nexport default EMOJI_VERSIONS_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {EMOJI_VERSION} from '../../environment/emojiVersionsSupport';\nimport {SITE_HASHTAGS} from '.';\nimport {EmojiVersions} from '../../config/emoji';\nimport IS_EMOJI_SUPPORTED from '../../environment/emojiSupport';\nimport {IS_SAFARI} from '../../environment/userAgent';\nimport buildURLHash from '../../helpers/buildURLHash';\nimport copy from '../../helpers/object/copy';\nimport encodeEntities from '../../helpers/string/encodeEntities';\nimport {MessageEntity} from '../../layer';\nimport encodeSpoiler from './encodeSpoiler';\nimport parseEntities from './parseEntities';\nimport setBlankToAnchor from './setBlankToAnchor';\nimport wrapUrl from './wrapUrl';\nimport EMOJI_VERSIONS_SUPPORTED from '../../environment/emojiVersionsSupport';\nimport {CLICK_EVENT_NAME} from '../../helpers/dom/clickEvent';\nimport IS_CUSTOM_EMOJI_SUPPORTED from '../../environment/customEmojiSupport';\nimport rootScope from '../rootScope';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport wrapSticker from '../../components/wrappers/sticker';\nimport RLottiePlayer from '../rlottie/rlottiePlayer';\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\nimport type {MyDocument} from '../appManagers/appDocsManager';\nimport LazyLoadQueue from '../../components/lazyLoadQueue';\nimport {Awaited} from '../../types';\nimport {MediaSize} from '../../helpers/mediaSize';\nimport IS_WEBM_SUPPORTED from '../../environment/webmSupport';\nimport assumeType from '../../helpers/assumeType';\nimport noop from '../../helpers/noop';\nimport indexOfAndSplice from '../../helpers/array/indexOfAndSplice';\nimport findUpClassName from '../../helpers/dom/findUpClassName';\nimport getViewportSlice from '../../helpers/dom/getViewportSlice';\nimport {getMiddleware, Middleware} from '../../helpers/middleware';\n\nconst resizeObserver = new ResizeObserver((entries) => {\n  for(const entry of entries) {\n    const renderer = entry.target.parentElement as CustomEmojiRendererElement;\n    renderer.setDimensionsFromRect(entry.contentRect);\n  }\n});\n\nclass CustomEmojiElement extends HTMLElement {\n  public elements: CustomEmojiElement[];\n  public renderer: CustomEmojiRendererElement;\n  public player: RLottiePlayer | HTMLVideoElement;\n  public paused: boolean;\n  public syncedPlayer: SyncedPlayer;\n\n  constructor() {\n    super();\n    this.paused = true;\n  }\n\n  public connectedCallback() {\n    if(this.player) {\n      animationIntersector.addAnimation(this, this.renderer.animationGroup);\n    }\n\n    this.connectedCallback = undefined;\n  }\n\n  public disconnectedCallback() {\n    if(this.isConnected) { // prepend on sibling can invoke disconnectedCallback\n      return;\n    }\n\n    if(this.syncedPlayer) {\n      this.syncedPlayer.pausedElements.delete(this);\n    }\n\n    // otherwise https://bugs.chromium.org/p/chromium/issues/detail?id=1144736#c27 will happen\n    this.textContent = '';\n\n    this.disconnectedCallback = this.elements = this.renderer = this.player = this.syncedPlayer = undefined;\n  }\n\n  public pause() {\n    if(this.paused) {\n      return;\n    }\n\n    this.paused = true;\n\n    if(this.player instanceof HTMLVideoElement) {\n      this.renderer.lastPausedVideo = this.player;\n      this.player.pause();\n    }\n\n    if(this.syncedPlayer && !this.syncedPlayer.pausedElements.has(this)) {\n      this.syncedPlayer.pausedElements.add(this);\n\n      if(this.syncedPlayer.pausedElements.size === this.syncedPlayer.elementsCounter) {\n        this.syncedPlayer.player.pause();\n      }\n    }\n  }\n\n  public play() {\n    if(!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n\n    if(this.player instanceof HTMLVideoElement) {\n      this.player.currentTime = this.renderer.lastPausedVideo?.currentTime || this.player.currentTime;\n      this.player.play().catch(noop);\n    }\n\n    if(this.syncedPlayer && this.syncedPlayer.pausedElements.has(this)) {\n      this.syncedPlayer.pausedElements.delete(this);\n\n      if(this.syncedPlayer.pausedElements.size !== this.syncedPlayer.elementsCounter) {\n        this.player.play();\n      }\n    }\n  }\n\n  public remove() {\n    this.elements = this.renderer = this.player = undefined;\n  }\n\n  public get autoplay() {\n    return true;\n  }\n}\n\nexport class CustomEmojiRendererElement extends HTMLElement {\n  public canvas: HTMLCanvasElement;\n  public context: CanvasRenderingContext2D;\n\n  public playersSynced: Map<CustomEmojiElement[], RLottiePlayer | HTMLVideoElement>;\n  public syncedElements: Map<SyncedPlayer, CustomEmojiElement[]>;\n  public clearedElements: Set<CustomEmojiElement[]>;\n  public lastPausedVideo: HTMLVideoElement;\n\n  public lastRect: DOMRect;\n  public isDimensionsSet: boolean;\n\n  public animationGroup: AnimationItemGroup;\n  public size: MediaSize;\n\n  public lazyLoadQueue: LazyLoadQueue;\n\n  constructor() {\n    super();\n\n    this.classList.add('custom-emoji-renderer');\n    this.canvas = document.createElement('canvas');\n    this.canvas.classList.add('custom-emoji-canvas');\n    this.context = this.canvas.getContext('2d');\n    this.append(this.canvas);\n\n    this.playersSynced = new Map();\n    this.syncedElements = new Map();\n    this.clearedElements = new Set();\n\n    this.animationGroup = 'EMOJI';\n  }\n\n  public connectedCallback() {\n    // this.setDimensions();\n    // animationIntersector.addAnimation(this, this.animationGroup);\n    resizeObserver.observe(this.canvas);\n    emojiRenderers.push(this);\n\n    this.connectedCallback = undefined;\n  }\n\n  public disconnectedCallback() {\n    if(this.isConnected) {\n      return;\n    }\n\n    for(const [syncedPlayer, elements] of this.syncedElements) {\n      if(syncedPlayers.get(syncedPlayer.key) !== syncedPlayer) {\n        continue;\n      }\n\n      if(elements) {\n        syncedPlayer.elementsCounter -= elements.length;\n      }\n\n      if(!--syncedPlayer.counter) {\n        if(syncedPlayer.player) {\n          const frame = syncedPlayersFrames.get(syncedPlayer.player);\n          if(frame) {\n            (frame as ImageBitmap).close?.();\n            syncedPlayersFrames.delete(syncedPlayer.player);\n          }\n\n          syncedPlayersFrames.delete(syncedPlayer.player);\n          syncedPlayer.player.overrideRender = noop;\n          syncedPlayer.player.remove();\n          syncedPlayer.player = undefined;\n        }\n\n        syncedPlayers.delete(syncedPlayer.key);\n\n        if(!syncedPlayers.size) {\n          clearRenderInterval();\n        }\n      }\n    }\n\n    resizeObserver.unobserve(this.canvas);\n\n    indexOfAndSplice(emojiRenderers, this);\n    this.playersSynced.clear();\n    this.syncedElements.clear();\n    this.clearedElements.clear();\n    this.lazyLoadQueue?.clear();\n    this.middlewareHelper?.clean();\n\n    this.disconnectedCallback = this.lastPausedVideo = this.lazyLoadQueue = undefined;\n  }\n\n  public getOffsets(offsetsMap: Map<CustomEmojiElement[], {top: number, left: number}[]> = new Map()) {\n    if(!this.playersSynced.size) {\n      return offsetsMap;\n    }\n\n    const overflowElement = findUpClassName(this, 'scrollable') || this.offsetParent as HTMLElement;\n    if(!overflowElement) {\n      return offsetsMap;\n    }\n\n    const overflowRect = overflowElement.getBoundingClientRect();\n    const rect = this.getBoundingClientRect();\n\n    for(const elements of this.playersSynced.keys()) {\n      const {visible} = getViewportSlice({\n        overflowElement,\n        overflowRect,\n        elements,\n        extraSize: this.size.height * 2.5 // let's add some margin\n      });\n\n      const offsets = visible.map(({rect: elementRect}) => {\n        const top = elementRect.top - rect.top;\n        const left = elementRect.left - rect.left;\n        return {top, left};\n      });\n\n      if(offsets.length) {\n        offsetsMap.set(elements, offsets);\n      }\n    }\n\n    // const rect = this.getBoundingClientRect();\n    // const visibleRect = getVisibleRect(this, overflowElement, undefined, rect);\n    // const minTop = visibleRect ? visibleRect.rect.top - this.size.height : 0;\n    // const maxTop = Infinity;\n    // for(const elements of this.playersSynced.keys()) {\n    //   const offsets = elements.map((element) => {\n    //     const elementRect = element.getBoundingClientRect();\n    //     const top = elementRect.top - rect.top;\n    //     const left = elementRect.left - rect.left;\n    //     return top >= minTop && (top + elementRect.height) <= maxTop ? {top, left} : undefined;\n    //   }).filter(Boolean);\n\n    //   if(offsets.length) {\n    //     offsetsMap.set(elements, offsets);\n    //   }\n    // }\n\n    return offsetsMap;\n  }\n\n  public clearCanvas() {\n    const {context, canvas} = this;\n    context.clearRect(0, 0, canvas.width, canvas.height);\n  }\n\n  public render(offsetsMap: ReturnType<CustomEmojiRendererElement['getOffsets']>) {\n    const {context, canvas, isDimensionsSet} = this;\n    if(!isDimensionsSet) {\n      this.setDimensionsFromRect();\n    }\n\n    const {width, height, dpr} = canvas;\n    for(const [elements, offsets] of offsetsMap) {\n      const player = this.playersSynced.get(elements);\n      const frame = syncedPlayersFrames.get(player);\n      if(!frame) {\n        continue;\n      }\n\n      const isImageData = frame instanceof ImageData;\n      const {width: frameWidth, height: frameHeight} = frame;\n      const maxTop = height - frameHeight;\n      const maxLeft = width - frameWidth;\n\n      if(!this.clearedElements.has(elements)) {\n        elements.forEach((element) => {\n          element.textContent = '';\n        });\n\n        this.clearedElements.add(elements);\n      }\n\n      offsets.forEach(({top, left}) => {\n        top = Math.round(top * dpr), left = Math.round(left * dpr);\n        if(/* top > maxTop ||  */left > maxLeft) {\n          return;\n        }\n\n        if(isImageData) {\n          context.putImageData(frame as ImageData, left, top);\n        } else {\n          // context.clearRect(left, top, width, height);\n          context.drawImage(frame as ImageBitmap, left, top, frameWidth, frameHeight);\n        }\n      });\n    }\n  }\n\n  public checkForAnyFrame() {\n    for(const player of this.playersSynced.values()) {\n      if(syncedPlayersFrames.has(player)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  public remove() {\n    // this.canvas.remove();\n  }\n\n  // public setDimensions() {\n  //   const {canvas} = this;\n  //   sequentialDom.mutateElement(canvas, () => {\n  //     const rect = canvas.getBoundingClientRect();\n  //     this.setDimensionsFromRect(rect);\n  //   });\n  // }\n\n  public setDimensionsFromRect(rect: DOMRect = this.lastRect) {\n    const {canvas} = this;\n    const {dpr} = canvas;\n\n    if(this.lastRect !== rect) {\n      this.lastRect = rect;\n    }\n\n    if(!rect || !dpr) {\n      return;\n    }\n\n    this.isDimensionsSet = true;\n    canvas.width = Math.round(rect.width * dpr);\n    canvas.height = Math.round(rect.height * dpr);\n  }\n}\n\ntype CustomEmojiRenderer = CustomEmojiRendererElement;\ntype SyncedPlayer = {\n  player: RLottiePlayer,\n  middlewares: Set<() => boolean>,\n  pausedElements: Set<CustomEmojiElement>,\n  elementsCounter: number,\n  counter: number,\n  key: string\n};\ntype CustomEmojiFrame = Parameters<RLottiePlayer['overrideRender']>[0] | HTMLVideoElement;\n\nconst CUSTOM_EMOJI_INSTANT_PLAY = true; // do not wait for animationIntersector\nlet emojiRenderInterval: number;\nconst emojiRenderers: Array<CustomEmojiRenderer> = [];\nconst syncedPlayers: Map<string, SyncedPlayer> = new Map();\nconst syncedPlayersFrames: Map<RLottiePlayer | HTMLVideoElement, CustomEmojiFrame> = new Map();\nconst renderEmojis = () => {\n  const t = emojiRenderers.filter((r) => r.isConnected && r.checkForAnyFrame());\n  if(!t.length) {\n    return;\n  }\n\n  const o = t.map((renderer) => {\n    const offsets = renderer.getOffsets();\n    return offsets.size ? [renderer, offsets] as const : undefined;\n  }).filter(Boolean);\n\n  for(const [renderer] of o) {\n    renderer.clearCanvas();\n  }\n\n  for(const [renderer, offsets] of o) {\n    renderer.render(offsets);\n  }\n};\nconst CUSTOM_EMOJI_FPS = 60;\nconst CUSTOM_EMOJI_FRAME_INTERVAL = 1000 / CUSTOM_EMOJI_FPS;\nconst setRenderInterval = () => {\n  if(emojiRenderInterval) {\n    return;\n  }\n\n  emojiRenderInterval = window.setInterval(renderEmojis, CUSTOM_EMOJI_FRAME_INTERVAL);\n  renderEmojis();\n};\nconst clearRenderInterval = () => {\n  if(!emojiRenderInterval) {\n    return;\n  }\n\n  clearInterval(emojiRenderInterval);\n  emojiRenderInterval = undefined;\n};\n\n(window as any).syncedPlayers = syncedPlayers;\n\ncustomElements.define('custom-emoji-element', CustomEmojiElement);\ncustomElements.define('custom-emoji-renderer-element', CustomEmojiRendererElement);\n\n/**\n * * Expecting correctly sorted nested entities (RichTextProcessor.sortEntities)\n */\nexport default function wrapRichText(text: string, options: Partial<{\n  entities: MessageEntity[],\n  contextSite: string,\n  highlightUsername: string,\n  noLinks: boolean,\n  noLinebreaks: boolean,\n  noCommands: boolean,\n  wrappingDraft: boolean,\n  // mustWrapEmoji: boolean,\n  fromBot: boolean,\n  noTextFormat: boolean,\n  passEntities: Partial<{\n    [_ in MessageEntity['_']]: boolean\n  }>,\n  noEncoding: boolean,\n\n  contextHashtag?: string,\n\n  // ! recursive, do not provide\n  nasty?: {\n    i: number,\n    usedLength: number,\n    text: string,\n    lastEntity?: MessageEntity\n  },\n  voodoo?: boolean,\n  customEmojis?: {[docId: DocId]: CustomEmojiElement[]},\n\n  loadPromises?: Promise<any>[],\n  middleware?: Middleware,\n  lazyLoadQueue?: LazyLoadQueue,\n  customEmojiSize?: MediaSize,\n  animationGroup?: AnimationItemGroup\n}> = {}) {\n  const fragment = document.createDocumentFragment();\n  if(!text) {\n    return fragment;\n  }\n\n  const nasty = options.nasty ??= {\n    i: 0,\n    usedLength: 0,\n    text\n  };\n\n  const customEmojis = options.customEmojis ??= {};\n\n  const entities = options.entities ??= parseEntities(nasty.text);\n\n  const passEntities = options.passEntities ??= {};\n  const contextSite = options.contextSite ??= 'Telegram';\n  const contextExternal = contextSite !== 'Telegram';\n\n  const textLength = nasty.text.length;\n  const length = entities.length;\n  let lastElement: HTMLElement | DocumentFragment;\n  for(; nasty.i < length; ++nasty.i) {\n    let entity = entities[nasty.i];\n\n    // * check whether text was sliced\n    // TODO: consider about moving it to other function\n    if(entity.offset >= textLength) {\n      if(entity._ !== 'messageEntityCaret') { // * can set caret to the end\n        continue;\n      }\n    } else if((entity.offset + entity.length) > textLength) {\n      entity = copy(entity);\n      // entity.length = entity.offset + entity.length - textLength;\n      entity.length = textLength - entity.offset;\n    }\n\n    if(entity.length) {\n      nasty.lastEntity = entity;\n    }\n\n    let nextEntity = entities[nasty.i + 1];\n\n    const startOffset = entity.offset;\n    const endOffset = startOffset + entity.length;\n    const endPartOffset = Math.min(endOffset, nextEntity?.offset ?? 0xFFFF);\n    const fullEntityText = nasty.text.slice(startOffset, endOffset);\n    const sliced = nasty.text.slice(startOffset, endPartOffset);\n    let partText = sliced;\n\n    if(nasty.usedLength < startOffset) {\n      (lastElement || fragment).append(nasty.text.slice(nasty.usedLength, startOffset));\n    }\n\n    if(lastElement) {\n      lastElement = fragment;\n    }\n\n    nasty.usedLength = endPartOffset;\n\n    let element: HTMLElement,\n      property: 'textContent' | 'alt' = 'textContent',\n      usedText = false;\n    switch(entity._) {\n      case 'messageEntityBold': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontWeight = 'bold';\n          } else {\n            element = document.createElement('strong');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityItalic': {\n        if(!options.noTextFormat) {\n          if(options.wrappingDraft) {\n            element = document.createElement('span');\n            element.style.fontStyle = 'italic';\n          } else {\n            element = document.createElement('em');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityStrike': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: line-through;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('del');\n        }\n\n        break;\n      }\n\n      case 'messageEntityUnderline': {\n        if(options.wrappingDraft) {\n          const styleName = IS_SAFARI ? 'text-decoration' : 'text-decoration-line';\n          element = document.createElement('span');\n          element.style.cssText = `${styleName}: underline;`;\n        } else if(!options.noTextFormat) {\n          element = document.createElement('u');\n        }\n\n        break;\n      }\n\n      case 'messageEntityPre':\n      case 'messageEntityCode': {\n        if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'var(--font-monospace)';\n        } else if(!options.noTextFormat) {\n          element = document.createElement('code');\n        }\n\n        break;\n      }\n\n      // case 'messageEntityPre': {\n      //   if(options.wrappingDraft) {\n      //     element = document.createElement('span');\n      //     element.style.fontFamily = 'var(--font-monospace)';\n      //   } else if(!options.noTextFormat) {\n      //     element = document.createElement('pre');\n      //     const inner = document.createElement('code');\n      //     if(entity.language) {\n      //       inner.className = 'language-' + entity.language;\n      //       inner.textContent = entityText;\n      //       usedText = true;\n      //     }\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityHighlight': {\n        element = document.createElement('i');\n        element.className = 'text-highlight';\n        break;\n      }\n\n      case 'messageEntityBotCommand': {\n        // if(!(options.noLinks || options.noCommands || contextExternal)/*  && !entity.unsafe */) {\n        if(!options.noLinks && passEntities[entity._]) {\n          let command = fullEntityText.slice(1);\n          let bot: string | boolean;\n          let atPos: number;\n          if((atPos = command.indexOf('@')) !== -1) {\n            bot = command.slice(atPos + 1);\n            command = command.slice(0, atPos);\n          } else {\n            bot = options.fromBot;\n          }\n\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('tg://bot_command?command=' + encodeURIComponent(command) + (bot ? '&bot=' + encodeURIComponent(bot) : ''));\n          if(!contextExternal) {\n            element.setAttribute('onclick', 'execBotCommand(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityCustomEmoji': {\n        if(!IS_CUSTOM_EMOJI_SUPPORTED) {\n          break;\n        }\n\n        while(nextEntity?._ === 'messageEntityEmoji' && nextEntity.offset < endOffset) {\n          ++nasty.i;\n          nasty.lastEntity = nextEntity;\n          nasty.usedLength += nextEntity.length;\n          nextEntity = entities[nasty.i + 1];\n        }\n\n        (customEmojis[entity.document_id] ??= []).push(element = new CustomEmojiElement());\n        element.classList.add('custom-emoji');\n\n        property = 'alt';\n        break;\n      }\n\n      case 'messageEntityEmoji': {\n        let isSupported = IS_EMOJI_SUPPORTED;\n        if(isSupported) {\n          for(const version in EmojiVersions) {\n            if(version) {\n              const emojiData = EmojiVersions[version as EMOJI_VERSION];\n              if(emojiData.hasOwnProperty(entity.unicode) && !EMOJI_VERSIONS_SUPPORTED[version as EMOJI_VERSION]) {\n                isSupported = false;\n                break;\n              }\n            }\n          }\n        }\n\n        // if(!(options.wrappingDraft && isSupported)) { // * fix safari emoji\n        if(!isSupported) { // no wrapping needed\n          // if(isSupported) { // ! contenteditable=\"false\"    ,       Safari,     ,  \n          //   insertPart(entity, '<span class=\"emoji\">', '</span>');\n          // } else {\n          element = document.createElement('img');\n          (element as HTMLImageElement).src = `assets/img/emoji/${entity.unicode}.png`;\n          property = 'alt';\n          element.className = 'emoji';\n          // }\n        // } else if(options.mustWrapEmoji) {\n        } else if(!options.wrappingDraft) {\n          element = document.createElement('span');\n          element.className = 'emoji';\n        }/*  else if(!IS_SAFARI) {\n          insertPart(entity, '<span class=\"emoji\" contenteditable=\"false\">', '</span>');\n        } */\n        /* if(!isSupported) {\n          insertPart(entity, `<img src=\"assets/img/emoji/${entity.unicode}.png\" alt=\"`, `\" class=\"emoji\">`);\n        } */\n\n        break;\n      }\n\n      case 'messageEntityCaret': {\n        element = document.createElement('span');\n        element.className = 'composer-sel';\n        break;\n      }\n\n      // case 'messageEntityLinebreak': {\n      //   if(options.noLinebreaks) {\n      //     insertPart(entity, ' ');\n      //   } else {\n      //     insertPart(entity, '<br/>');\n      //   }\n\n      //   break;\n      // }\n\n      case 'messageEntityUrl':\n      case 'messageEntityTextUrl': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          // let inner: string;\n          let url: string = (entity as MessageEntity.messageEntityTextUrl).url || fullEntityText;\n          let masked = false;\n          let onclick: string;\n\n          const wrapped = wrapUrl(url, true);\n          url = wrapped.url;\n          onclick = wrapped.onclick;\n\n          if(entity._ === 'messageEntityTextUrl') {\n            if(nextEntity?._ === 'messageEntityUrl' &&\n              nextEntity.length === entity.length &&\n              nextEntity.offset === entity.offset) {\n              nasty.lastEntity = nextEntity;\n              ++nasty.i;\n            }\n\n            if(url !== fullEntityText) {\n              masked = true;\n            }\n          } else {\n            // inner = encodeEntities(replaceUrlEncodings(entityText));\n          }\n\n          const currentContext = !!onclick;\n          if(!onclick && masked && !currentContext) {\n            onclick = 'showMaskedAlert';\n          }\n\n          if(options.wrappingDraft) {\n            onclick = undefined;\n          }\n\n          const href = (currentContext || typeof electronHelpers === 'undefined') ?\n            url :\n            `javascript:electronHelpers.openExternal('${url}');`;\n\n          element = document.createElement('a');\n          element.className = 'anchor-url';\n          (element as HTMLAnchorElement).href = href;\n\n          if(!(currentContext || typeof electronHelpers !== 'undefined')) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          }\n\n          if(onclick) {\n            element.setAttribute('onclick', onclick + '(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityEmail': {\n        if(!options.noLinks) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = encodeEntities('mailto:' + fullEntityText);\n          setBlankToAnchor(element as HTMLAnchorElement);\n        }\n\n        break;\n      }\n\n      case 'messageEntityHashtag': {\n        const contextUrl = !options.noLinks && SITE_HASHTAGS[contextSite];\n        if(contextUrl) {\n          const hashtag = fullEntityText.slice(1);\n          element = document.createElement('a');\n          element.className = 'anchor-hashtag';\n          (element as HTMLAnchorElement).href = contextUrl.replace('{1}', encodeURIComponent(hashtag));\n          if(contextExternal) {\n            setBlankToAnchor(element as HTMLAnchorElement);\n          } else {\n            element.setAttribute('onclick', 'searchByHashtag(this)');\n          }\n        }\n\n        break;\n      }\n\n      case 'messageEntityMentionName': {\n        if(!(options.noLinks && !passEntities[entity._])) {\n          element = document.createElement('a');\n          (element as HTMLAnchorElement).href = buildURLHash('' + entity.user_id);\n          element.className = 'follow';\n          element.dataset.follow = '' + entity.user_id;\n        }\n\n        break;\n      }\n\n      case 'messageEntityMention': {\n        // const contextUrl = !options.noLinks && siteMentions[contextSite];\n        if(!options.noLinks) {\n          const username = fullEntityText.slice(1);\n\n          const {url, onclick} = wrapUrl('t.me/' + username);\n\n          element = document.createElement('a');\n          element.className = 'mention';\n          (element as HTMLAnchorElement).href = url;\n          if(onclick) {\n            element.setAttribute('onclick', `${onclick}(this)`);\n          }\n\n          // insertPart(entity, `<a class=\"mention\" href=\"${contextUrl.replace('{1}', encodeURIComponent(username))}\"${contextExternal ? ' target=\"_blank\" rel=\"noopener noreferrer\"' : ''}>`, '</a>');\n        }\n\n        break;\n      }\n\n      case 'messageEntitySpoiler': {\n        if(options.noTextFormat) {\n          const encoded = encodeSpoiler(nasty.text, entity);\n          nasty.text = encoded.text;\n          partText = encoded.entityText;\n          if(endPartOffset !== endOffset) {\n            nasty.usedLength += endOffset - endPartOffset;\n          }\n          let n: MessageEntity;\n          for(; n = entities[nasty.i + 1], n && n.offset < endOffset;) {\n            // nasty.usedLength += n.length;\n            ++nasty.i;\n            nasty.lastEntity = n;\n            nextEntity = entities[nasty.i + 1];\n          }\n        } else if(options.wrappingDraft) {\n          element = document.createElement('span');\n          element.style.fontFamily = 'spoiler';\n        } else {\n          const container = document.createElement('span');\n          container.className = 'spoiler';\n          element = document.createElement('span');\n          element.className = 'spoiler-text';\n          element.textContent = partText;\n          usedText = true;\n          container.append(element);\n          fragment.append(container);\n\n          container[`on${CLICK_EVENT_NAME}`] = (window as any).onSpoilerClick;\n        }\n\n        break;\n      }\n    }\n\n    if(!usedText) {\n      if(element) {\n        // @ts-ignore\n        element[property] = partText;\n      } else {\n        (element || fragment).append(partText);\n      }\n    }\n\n    if(element && !element.parentElement) {\n      (lastElement || fragment).append(element);\n    }\n\n    while(nextEntity && nextEntity.offset < endOffset) {\n      ++nasty.i;\n\n      (element || fragment).append(wrapRichText(nasty.text, {\n        ...options,\n        voodoo: true\n      }));\n\n      nextEntity = entities[nasty.i + 1];\n    }\n\n    // if(!element?.parentElement) {\n    //   (lastElement || fragment).append(element ?? partText);\n    // }\n\n    if(nasty.usedLength <= endOffset) {\n      if(nasty.usedLength < endOffset) {\n        (element || fragment).append(nasty.text.slice(nasty.usedLength, endOffset));\n        nasty.usedLength = endOffset;\n      }\n\n      lastElement = fragment;\n      nasty.lastEntity = undefined;\n    } else if(entity.length > partText.length && element) {\n      lastElement = element;\n    } else {\n      lastElement = fragment;\n    }\n\n    if(options.voodoo) {\n      return fragment;\n    }\n  }\n\n  if(nasty.lastEntity) {\n    nasty.usedLength = nasty.lastEntity.offset + nasty.lastEntity.length;\n  }\n\n  if(nasty.usedLength < textLength) {\n    (lastElement || fragment).append(nasty.text.slice(nasty.usedLength));\n  }\n\n  const docIds = Object.keys(customEmojis) as DocId[];\n  if(docIds.length) {\n    const managers = rootScope.managers;\n    const size = options.customEmojiSize || mediaSizes.active.customEmoji;\n    const renderer = new CustomEmojiRendererElement();\n    // const middleware = () => !!renderer.disconnectedCallback && (!options.middleware || options.middleware());\n    let middleware: Middleware;\n    if(options.middleware) {\n      middleware = options.middleware;\n      options.middleware.onDestroy(() => {\n        renderer.disconnectedCallback?.();\n      });\n    } else {\n      renderer.middlewareHelper = getMiddleware();\n      middleware = renderer.middlewareHelper.get();\n    }\n\n    renderer.animationGroup = options.animationGroup;\n    renderer.size = size;\n    fragment.prepend(renderer);\n\n    const loadPromise = managers.appEmojiManager.getCachedCustomEmojiDocuments(docIds).then((docs) => {\n      if(middleware && !middleware()) return;\n\n      const loadPromises: Promise<any>[] = [];\n      const wrap = (doc: MyDocument, _loadPromises?: Promise<any>[]) => {\n        const elements = customEmojis[doc.id];\n        const isLottie = doc.sticker === 2;\n\n        const loadPromises: Promise<any>[] = [];\n        const promise = wrapSticker({\n          div: elements,\n          doc,\n          width: size.width,\n          height: size.height,\n          loop: true,\n          play: CUSTOM_EMOJI_INSTANT_PLAY,\n          managers,\n          isCustomEmoji: true,\n          group: 'none',\n          loadPromises,\n          middleware,\n          exportLoad: true,\n          needFadeIn: false,\n          loadStickerMiddleware: isLottie && middleware ? middleware.create().get(() => {\n            if(syncedPlayers.get(key) !== syncedPlayer) {\n              return false;\n            }\n\n            let good = !syncedPlayer.middlewares.size;\n            for(const middleware of syncedPlayer.middlewares) {\n              if(middleware()) {\n                good = true;\n              }\n            }\n\n            return good;\n          }) : undefined,\n          static: doc.mime_type === 'video/webm' && !IS_WEBM_SUPPORTED\n        });\n\n        if(_loadPromises) {\n          promise.then(() => _loadPromises.push(...loadPromises));\n        }\n\n        const addition: {\n          onRender?: (_p: Awaited<Awaited<typeof promise>['render']>) => Promise<void>,\n          elements: typeof elements\n        } = {\n          elements\n        };\n\n        if(doc.sticker === 1) {\n          return promise.then((res) => ({...res, ...addition}));\n        }\n\n        // eslint-disable-next-line prefer-const\n        addition.onRender = (_p) => Promise.all(loadPromises).then(() => {\n          if((middleware && !middleware()) || !doc.animated) {\n            return;\n          }\n\n          const players = Array.isArray(_p) ? _p as HTMLVideoElement[] : [_p as RLottiePlayer];\n          const player = Array.isArray(players) ? players[0] : players;\n          assumeType<RLottiePlayer | HTMLVideoElement>(player);\n          elements.forEach((element, idx) => {\n            const player = players[idx] || players[0];\n            element.renderer = renderer;\n            element.elements = elements;\n            element.player = player;\n\n            if(syncedPlayer) {\n              element.syncedPlayer = syncedPlayer;\n              if(element.paused) {\n                element.syncedPlayer.pausedElements.add(element);\n              }\n            }\n\n            if(element.isConnected) {\n              animationIntersector.addAnimation(element, element.renderer.animationGroup);\n            }\n          });\n\n          if(syncedPlayer) {\n            syncedPlayer.elementsCounter += elements.length;\n            syncedPlayer.middlewares.delete(middleware);\n            renderer.syncedElements.set(syncedPlayer, elements);\n          }\n\n          if(player instanceof RLottiePlayer) {\n            syncedPlayer.player = player;\n            renderer.playersSynced.set(elements, player);\n            renderer.canvas.dpr = player.canvas[0].dpr;\n            player.group = renderer.animationGroup;\n\n            player.overrideRender ??= (frame) => {\n              syncedPlayersFrames.set(player, frame);\n              // frames.set(containers, frame);\n            };\n\n            setRenderInterval();\n          } else if(player instanceof HTMLVideoElement) {\n            // player.play();\n\n            // const cache = framesCache.getCache(key);\n            // let {width, height} = renderer.size;\n            // width *= dpr;\n            // height *= dpr;\n\n            // const onFrame = (frame: ImageBitmap | HTMLCanvasElement) => {\n            //   topFrames.set(player, frame);\n            //   player.requestVideoFrameCallback(callback);\n            // };\n\n            // let frameNo = -1, lastTime = 0;\n            // const callback: VideoFrameRequestCallback = (now, metadata) => {\n            //   const time = player.currentTime;\n            //   if(lastTime > time) {\n            //     frameNo = -1;\n            //   }\n\n            //   const _frameNo = ++frameNo;\n            //   lastTime = time;\n            //   // const frameNo = Math.floor(player.currentTime * 1000 / CUSTOM_EMOJI_FRAME_INTERVAL);\n            //   // const frameNo = metadata.presentedFrames;\n            //   const imageBitmap = cache.framesNew.get(_frameNo);\n\n            //   if(imageBitmap) {\n            //     onFrame(imageBitmap);\n            //   } else if(IS_IMAGE_BITMAP_SUPPORTED) {\n            //     createImageBitmap(player, {resizeWidth: width, resizeHeight: height}).then((imageBitmap) => {\n            //       cache.framesNew.set(_frameNo, imageBitmap);\n            //       if(frameNo === _frameNo) onFrame(imageBitmap);\n            //     });\n            //   } else {\n            //     const canvas = document.createElement('canvas');\n            //     const context = canvas.getContext('2d');\n            //     canvas.width = width;\n            //     canvas.height = height;\n            //     context.drawImage(player, 0, 0);\n            //     cache.framesNew.set(_frameNo, canvas);\n            //     onFrame(canvas);\n            //   }\n            // };\n\n            // // player.requestVideoFrameCallback(callback);\n            // // setInterval(callback, CUSTOM_EMOJI_FRAME_INTERVAL);\n          }\n        });\n\n        let syncedPlayer: SyncedPlayer;\n        const key = [doc.id, size.width, size.height].join('-');\n        if(isLottie) {\n          syncedPlayer = syncedPlayers.get(key);\n          if(!syncedPlayer) {\n            syncedPlayer = {\n              player: undefined,\n              middlewares: new Set(),\n              pausedElements: new Set(),\n              elementsCounter: 0,\n              counter: 0,\n              key\n            };\n\n            syncedPlayers.set(key, syncedPlayer);\n          }\n\n          renderer.syncedElements.set(syncedPlayer, undefined);\n\n          ++syncedPlayer.counter;\n\n          if(middleware) {\n            syncedPlayer.middlewares.add(middleware);\n          }\n        }\n\n        return promise.then((res) => ({...res, ...addition}));\n      };\n\n      const missing: DocId[] = [];\n      const cachedPromises = docs.map((doc, idx) => {\n        if(!doc) {\n          missing.push(docIds[idx]);\n          return;\n        }\n\n        return wrap(doc, loadPromises);\n      }).filter(Boolean);\n\n      const uncachedPromisesPromise = managers.appEmojiManager.getCustomEmojiDocuments(missing).then((docs) => {\n        if(middleware && !middleware()) return [];\n        return docs.filter(Boolean).map((doc) => wrap(doc));\n      });\n\n      const loadFromPromises = (promises: typeof cachedPromises) => {\n        return Promise.all(promises).then((arr) => {\n          const promises = arr.map(({load, onRender, elements}) => {\n            if(!load) {\n              return;\n            }\n\n            const l = () => load().then(onRender);\n\n            if(renderer.lazyLoadQueue) {\n              elements.forEach((element) => {\n                renderer.lazyLoadQueue.push({\n                  div: element,\n                  load: () => {\n                    elements.forEach((element) => {\n                      renderer.lazyLoadQueue.unobserve(element);\n                    });\n\n                    return l();\n                  }\n                });\n              });\n            } else {\n              return l();\n            }\n          });\n\n          return Promise.all(promises);\n        });\n      };\n\n      const load = () => {\n        if(middleware && !middleware()) return;\n        const cached = loadFromPromises(cachedPromises);\n        const uncached = uncachedPromisesPromise.then((promises) => loadFromPromises(promises));\n        return Promise.all([cached, uncached]);\n      };\n\n      if(options.lazyLoadQueue) {\n        options.lazyLoadQueue.push({\n          div: renderer.canvas,\n          load\n        });\n      } else {\n        renderer.lazyLoadQueue = new LazyLoadQueue();\n        load();\n      }\n\n      return Promise.all(cachedPromises).then(() => Promise.all(loadPromises)).then(() => {});\n    });\n\n    // recordPromise(loadPromise, 'render emojis: ' + docIds.length);\n\n    options.loadPromises?.push(loadPromise);\n  }\n\n  return fragment;\n}\n\n(window as any).wrapRichText = wrapRichText;\n","// just for the future\nexport default function buildURLHash(str: string) {\n  return '#' + encodeURIComponent(str);\n}\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport EventListenerBase from '../../helpers/eventListenerBase';\n\nexport default class QueryableWorker extends EventListenerBase<{\n  ready: () => void,\n  frame: (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => void,\n  loaded: (reqId: number, frameCount: number, fps: number) => void,\n  error: (reqId: number, error: Error) => void,\n  workerError: (error: ErrorEvent) => void\n}> {\n  constructor(private worker: Worker) {\n    super();\n\n    this.worker.onerror = (error) => {\n      try {\n        this.dispatchEvent('workerError', error);\n        this.cleanup();\n        this.terminate();\n      } catch(err) {\n\n      }\n    };\n\n    this.worker.onmessage = (event) => {\n      this.dispatchEvent(event.data.queryMethodListener, ...event.data.queryMethodArguments);\n    };\n  }\n\n  public postMessage(message: any) {\n    this.worker.postMessage(message);\n  }\n\n  public terminate() {\n    this.worker.terminate();\n  }\n\n  public sendQuery(args: any[], transfer?: Transferable[]) {\n    this.worker.postMessage({\n      queryMethod: args.shift(),\n      queryMethodArguments: args\n    }, CAN_USE_TRANSFERABLES ? transfer: undefined);\n  }\n}\n","const IS_WEB_ASSEMBLY_SUPPORTED = typeof(WebAssembly) !== 'undefined';\n\nexport default IS_WEB_ASSEMBLY_SUPPORTED;\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport animationIntersector, {AnimationItemGroup} from '../../components/animationIntersector';\r\nimport {MOUNT_CLASS_TO} from '../../config/debug';\r\nimport pause from '../../helpers/schedulers/pause';\r\nimport {logger, LogTypes} from '../logger';\r\nimport RLottiePlayer, {RLottieOptions} from './rlottiePlayer';\r\nimport QueryableWorker from './queryableWorker';\r\nimport blobConstruct from '../../helpers/blob/blobConstruct';\r\nimport apiManagerProxy from '../mtproto/mtprotoworker';\r\nimport IS_WEB_ASSEMBLY_SUPPORTED from '../../environment/webAssemblySupport';\r\nimport makeError from '../../helpers/makeError';\r\n\r\nexport type LottieAssetName = 'EmptyFolder' | 'Folders_1' | 'Folders_2' |\r\n  'TwoFactorSetupMonkeyClose' | 'TwoFactorSetupMonkeyCloseAndPeek' |\r\n  'TwoFactorSetupMonkeyCloseAndPeekToIdle' | 'TwoFactorSetupMonkeyIdle' |\r\n  'TwoFactorSetupMonkeyPeek' | 'TwoFactorSetupMonkeyTracking' |\r\n  'voice_outlined2' | 'voip_filled' | 'voice_mini';\r\n\r\nexport class LottieLoader {\r\n  private loadPromise: Promise<void> = !IS_WEB_ASSEMBLY_SUPPORTED ? Promise.reject() : undefined;\r\n  private loaded = false;\r\n\r\n  private workersLimit = 4;\r\n  private players: {[reqId: number]: RLottiePlayer} = {};\r\n  private playersByCacheName: {[cacheName: string]: Set<RLottiePlayer>} = {};\r\n\r\n  private workers: QueryableWorker[] = [];\r\n  private curWorkerNum = 0;\r\n\r\n  private log = logger('LOTTIE', LogTypes.Error);\r\n\r\n  public getAnimation(element: HTMLElement) {\r\n    for(const i in this.players) {\r\n      if(this.players[i].el.includes(element)) {\r\n        return this.players[i];\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  public setLoop(loop: boolean) {\r\n    for(const i in this.players) {\r\n      const player = this.players[i];\r\n      player.loop = loop;\r\n      player.autoplay = player._autoplay;\r\n    }\r\n  }\r\n\r\n  public loadLottieWorkers() {\r\n    if(this.loadPromise) {\r\n      return this.loadPromise;\r\n    }\r\n\r\n    return this.loadPromise = new Promise((resolve, reject) => {\r\n      let remain = this.workersLimit;\r\n      for(let i = 0; i < this.workersLimit; ++i) {\r\n        const worker = new Worker(new URL('./rlottie.worker.ts', import.meta.url));\r\n        const queryableWorker = this.workers[i] = new QueryableWorker(worker);\r\n\r\n        queryableWorker.addEventListener('ready', () => {\r\n          this.log('worker #' + i + ' ready');\r\n\r\n          queryableWorker.addEventListener('frame', this.onFrame);\r\n          queryableWorker.addEventListener('loaded', this.onPlayerLoaded);\r\n          queryableWorker.addEventListener('error', this.onPlayerError);\r\n\r\n          --remain;\r\n          if(!remain) {\r\n            this.log('workers ready');\r\n            resolve();\r\n            this.loaded = true;\r\n          }\r\n        }, {once: true});\r\n\r\n        queryableWorker.addEventListener('workerError', (error) => {\r\n          reject('rlottie load error: ' + error.message);\r\n          this.loaded = false;\r\n        }, {once: true});\r\n      }\r\n    });\r\n  }\r\n\r\n  public loadAnimationAsAsset(params: Omit<RLottieOptions, 'animationData' | 'name'>, name: LottieAssetName) {\r\n    (params as RLottieOptions).name = name;\r\n    return this.loadAnimationFromURL(params, 'assets/tgs/' + name + '.json');\r\n  }\r\n\r\n  public loadAnimationFromURL(params: Omit<RLottieOptions, 'animationData'>, url: string): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      this.loadLottieWorkers();\r\n    }\r\n\r\n    return fetch(url)\r\n    .then((res) => {\r\n      if(!res.headers || res.headers.get('content-type') === 'application/octet-stream') {\r\n        return res.arrayBuffer().then((data) => apiManagerProxy.invokeCrypto('gzipUncompress', data)).then((arr) => blobConstruct(arr as Uint8Array, ''))\r\n      } else {\r\n        return res.blob();\r\n      }\r\n    })\r\n    /* .then((str) => {\r\n      return new Promise<string>((resolve) => setTimeout(() => resolve(str), 2e3));\r\n    }) */\r\n    .then((blob) => {\r\n      const newParams = Object.assign(params, {animationData: blob, needUpscale: true});\r\n      if(!newParams.name) newParams.name = url;\r\n      return this.loadAnimationWorker(newParams);\r\n    });\r\n  }\r\n\r\n  public waitForFirstFrame(player: RLottiePlayer) {\r\n    return Promise.race([\r\n      /* new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', () => {\r\n          setTimeout(() => resolve(), 1500);\r\n        }, true);\r\n      }) */\r\n      new Promise<void>((resolve) => {\r\n        player.addEventListener('firstFrame', resolve, {once: true});\r\n      }),\r\n      pause(2500)\r\n    ]).then(() => player);\r\n  }\r\n\r\n  public async loadAnimationWorker(\r\n    params: RLottieOptions,\r\n    group: AnimationItemGroup = params.group || '',\r\n    middleware?: () => boolean\r\n  ): Promise<RLottiePlayer> {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return this.loadPromise as any;\r\n    }\r\n\r\n    if(!this.loaded) {\r\n      await this.loadLottieWorkers();\r\n    }\r\n\r\n    if(middleware && !middleware()) {\r\n      throw makeError('MIDDLEWARE');\r\n    }\r\n\r\n    if(params.sync) {\r\n      const cacheName = RLottiePlayer.CACHE.generateName(params.name, params.width, params.height, params.color, params.toneIndex);\r\n      const players = this.playersByCacheName[cacheName];\r\n      if(players?.size) {\r\n        return Promise.resolve(players.entries().next().value[0]);\r\n      }\r\n    }\r\n\r\n    const containers = Array.isArray(params.container) ? params.container : [params.container];\r\n    if(!params.width || !params.height) {\r\n      params.width = parseInt(containers[0].style.width);\r\n      params.height = parseInt(containers[0].style.height);\r\n    }\r\n\r\n    if(!params.width || !params.height) {\r\n      throw new Error('No size for sticker!');\r\n    }\r\n\r\n    params.group = group;\r\n\r\n    const player = this.initPlayer(containers, params);\r\n\r\n    animationIntersector.addAnimation(player, group);\r\n\r\n    return player;\r\n  }\r\n\r\n  private onPlayerLoaded = (reqId: number, frameCount: number, fps: number) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onPlayerLoaded on destroyed player:', reqId, frameCount);\r\n      return;\r\n    }\r\n\r\n    this.log.debug('onPlayerLoaded');\r\n    player.onLoad(frameCount, fps);\r\n  };\r\n\r\n  private onFrame = (reqId: number, frameNo: number, frame: Uint8ClampedArray | ImageBitmap) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      this.log.warn('onFrame on destroyed player:', reqId, frameNo);\r\n      return;\r\n    }\r\n\r\n    if(player.clamped !== undefined && frame instanceof Uint8ClampedArray) {\r\n      player.clamped = frame;\r\n    }\r\n\r\n    player.renderFrame(frame, frameNo);\r\n  };\r\n\r\n  private onPlayerError = (reqId: number, error: Error) => {\r\n    const player = this.players[reqId];\r\n    if(!player) {\r\n      return;\r\n    }\r\n\r\n    // ! will need refactoring later, this is not the best way to remove the animation\r\n    const animations = animationIntersector.getAnimations(player.el[0]);\r\n    animations.forEach((animation) => {\r\n      animationIntersector.checkAnimation(animation, true, true);\r\n    });\r\n  };\r\n\r\n  public onDestroy(reqId: number) {\r\n    delete this.players[reqId];\r\n  }\r\n\r\n  public destroyWorkers() {\r\n    if(!IS_WEB_ASSEMBLY_SUPPORTED) {\r\n      return;\r\n    }\r\n\r\n    this.workers.forEach((worker, idx) => {\r\n      worker.terminate();\r\n      this.log('worker #' + idx + ' terminated');\r\n    });\r\n\r\n    this.log('workers destroyed');\r\n    this.workers.length = 0;\r\n    this.curWorkerNum = 0;\r\n    this.loaded = false;\r\n    this.loadPromise = undefined;\r\n  }\r\n\r\n  private initPlayer(el: RLottiePlayer['el'], options: RLottieOptions) {\r\n    const player = new RLottiePlayer({\r\n      el,\r\n      worker: this.workers[this.curWorkerNum++],\r\n      options\r\n    });\r\n\r\n    const {reqId, cacheName} = player;\r\n    this.players[reqId] = player;\r\n\r\n    const playersByCacheName = cacheName ? this.playersByCacheName[cacheName] ??= new Set() : undefined;\r\n    if(cacheName) {\r\n      playersByCacheName.add(player);\r\n    }\r\n\r\n    if(this.curWorkerNum >= this.workers.length) {\r\n      this.curWorkerNum = 0;\r\n    }\r\n\r\n    player.addEventListener('destroy', () => {\r\n      this.onDestroy(reqId);\r\n      if(playersByCacheName.delete(player) && !playersByCacheName.size) {\r\n        delete this.playersByCacheName[cacheName];\r\n      }\r\n    });\r\n\r\n    player.loadFromData(options.animationData);\r\n\r\n    return player;\r\n  }\r\n}\r\n\r\nconst lottieLoader = new LottieLoader();\r\nMOUNT_CLASS_TO.lottieLoader = lottieLoader;\r\nexport default lottieLoader;\r\n","const IS_IMAGE_BITMAP_SUPPORTED = typeof(ImageBitmap) !== 'undefined';\n\nexport default IS_IMAGE_BITMAP_SUPPORTED;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {RLottieColor} from '../lib/rlottie/rlottiePlayer';\n\nexport type FramesCacheMap = Map<number, Uint8ClampedArray>;\nexport type FramesCacheMapNew = Map<number, HTMLCanvasElement | ImageBitmap>;\nexport type FramesCacheMapURLs = Map<number, string>;\nexport type FramesCacheItem = {\n  frames: FramesCacheMap,\n  framesNew: FramesCacheMapNew,\n  framesURLs: FramesCacheMapURLs,\n  clearCache: () => void,\n  counter: number\n};\n\nexport class FramesCache {\n  private cache: Map<string, FramesCacheItem>;\n\n  constructor() {\n    this.cache = new Map();\n  }\n\n  public static createCache(): FramesCacheItem {\n    const cache: FramesCacheItem = {\n      frames: new Map(),\n      framesNew: new Map(),\n      framesURLs: new Map(),\n      clearCache: () => {\n        cache.framesNew.forEach((value) => {\n          (value as ImageBitmap).close?.();\n        });\n\n        cache.frames.clear();\n        cache.framesNew.clear();\n        cache.framesURLs.clear();\n      },\n      counter: 0\n    };\n\n    return cache;\n  }\n\n  public getCache(name: string) {\n    let cache = this.cache.get(name);\n    if(!cache) {\n      this.cache.set(name, cache = FramesCache.createCache());\n    } else {\n      // console.warn('[RLottieCache] cache will be reused', cache);\n    }\n\n    ++cache.counter;\n    return cache;\n  }\n\n  public releaseCache(name: string) {\n    const cache = this.cache.get(name);\n    if(cache && !--cache.counter) {\n      this.cache.delete(name);\n      // console.warn('[RLottieCache] released cache', cache);\n    }\n  }\n\n  public getCacheCounter(name: string) {\n    const cache = this.cache.get(name);\n    return cache?.counter;\n  }\n\n  public generateName(name: string, width: number, height: number, color: RLottieColor, toneIndex: number) {\n    return [\n      name,\n      width,\n      height,\n      // color ? rgbaToHexa(color) : ''\n      color ? 'colored' : '',\n      toneIndex || ''\n    ].filter(Boolean).join('-');\n  }\n}\n\nconst framesCache = new FramesCache();\n\nexport default framesCache;\n","/*\n * https://github.com/morethanwords/tweb\n * Copyright (C) 2019-2021 Eduard Kuzmenko\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\n */\n\nimport type {AnimationItemGroup, AnimationItemWrapper} from '../../components/animationIntersector';\nimport CAN_USE_TRANSFERABLES from '../../environment/canUseTransferables';\nimport IS_APPLE_MX from '../../environment/appleMx';\nimport {IS_ANDROID, IS_APPLE_MOBILE, IS_APPLE, IS_SAFARI} from '../../environment/userAgent';\nimport EventListenerBase from '../../helpers/eventListenerBase';\nimport mediaSizes from '../../helpers/mediaSizes';\nimport clamp from '../../helpers/number/clamp';\nimport QueryableWorker from './queryableWorker';\nimport IS_IMAGE_BITMAP_SUPPORTED from '../../environment/imageBitmapSupport';\nimport framesCache, {FramesCache, FramesCacheItem} from '../../helpers/framesCache';\n\nexport type RLottieOptions = {\n  container: HTMLElement | HTMLElement[],\n  canvas?: HTMLCanvasElement,\n  autoplay?: boolean,\n  animationData: Blob,\n  loop?: boolean,\n  width?: number,\n  height?: number,\n  group?: AnimationItemGroup,\n  noCache?: boolean,\n  needUpscale?: boolean,\n  skipRatio?: number,\n  initFrame?: number, // index\n  color?: RLottieColor,\n  inverseColor?: RLottieColor,\n  name?: string,\n  skipFirstFrameRendering?: boolean,\n  toneIndex?: number,\n  sync?: boolean\n};\n\nexport type RLottieColor = [number, number, number];\n\nexport function getLottiePixelRatio(width: number, height: number, needUpscale?: boolean) {\n  let pixelRatio = clamp(window.devicePixelRatio, 1, 2);\n  if(pixelRatio > 1 && !needUpscale) {\n    if(width > 90 && height > 90) {\n      if(!IS_APPLE && mediaSizes.isMobile) {\n        pixelRatio = 1;\n      }\n    } else if(width > 60 && height > 60) {\n      pixelRatio = Math.max(1.5, pixelRatio - 1.5);\n    }\n  }\n\n  return pixelRatio;\n}\n\nexport default class RLottiePlayer extends EventListenerBase<{\n  enterFrame: (frameNo: number) => void,\n  ready: () => void,\n  firstFrame: () => void,\n  cached: () => void,\n  destroy: () => void\n}> implements AnimationItemWrapper {\n  public static CACHE = framesCache;\n  private static reqId = 0;\n\n  public reqId = 0;\n  public curFrame: number;\n  private frameCount: number;\n  private fps: number;\n  private skipDelta: number;\n  public name: string;\n  public cacheName: string;\n  private toneIndex: number;\n\n  private worker: QueryableWorker;\n\n  private width = 0;\n  private height = 0;\n\n  public el: HTMLElement[];\n  public canvas: HTMLCanvasElement[];\n  private contexts: CanvasRenderingContext2D[];\n\n  public paused = true;\n  // public paused = false;\n  public direction = 1;\n  private speed = 1;\n  public autoplay = true;\n  public _autoplay: boolean; // ! will be used to store original value for settings.stickers.loop\n  public loop = true;\n  private _loop: boolean; // ! will be used to store original value for settings.stickers.loop\n  public group: AnimationItemGroup = '';\n\n  private frInterval: number;\n  private frThen: number;\n  private rafId: number;\n\n  // private caching = false;\n  // private removed = false;\n\n  private cache: FramesCacheItem;\n  private imageData: ImageData;\n  public clamped: Uint8ClampedArray;\n  private cachingDelta = 0;\n\n  private initFrame: number;\n  private color: RLottieColor;\n  private inverseColor: RLottieColor;\n\n  public minFrame: number;\n  public maxFrame: number;\n\n  // private playedTimes = 0;\n\n  private currentMethod: RLottiePlayer['mainLoopForwards'] | RLottiePlayer['mainLoopBackwards'];\n  private frameListener: (currentFrame: number) => void;\n  private skipFirstFrameRendering: boolean;\n  private playToFrameOnFrameCallback: (frameNo: number) => void;\n\n  public overrideRender: (frame: ImageData | HTMLCanvasElement | ImageBitmap) => void;\n  private renderedFirstFrame: boolean;\n\n  constructor({el, worker, options}: {\n    el: RLottiePlayer['el'],\n    worker: QueryableWorker,\n    options: RLottieOptions\n  }) {\n    super(true);\n\n    this.reqId = ++RLottiePlayer['reqId'];\n    this.el = el;\n    this.worker = worker;\n\n    for(const i in options) {\n      if(this.hasOwnProperty(i)) {\n        // @ts-ignore\n        this[i] = options[i];\n      }\n    }\n\n    this._loop = this.loop;\n    this._autoplay = this.autoplay;\n\n    // ! :(\n    this.initFrame = options.initFrame;\n    this.color = options.color;\n    this.inverseColor = options.inverseColor;\n    this.name = options.name;\n    this.skipFirstFrameRendering = options.skipFirstFrameRendering;\n    this.toneIndex = options.toneIndex;\n\n    if(this.name) {\n      this.cacheName = RLottiePlayer.CACHE.generateName(this.name, this.width, this.height, this.color, this.toneIndex);\n    }\n\n    // * Skip ratio (30fps)\n    let skipRatio: number;\n    if(options.skipRatio !== undefined) skipRatio = options.skipRatio;\n    else if((IS_ANDROID || IS_APPLE_MOBILE || (IS_APPLE && !IS_SAFARI && !IS_APPLE_MX)) && this.width < 100 && this.height < 100 && !options.needUpscale) {\n      skipRatio = 0.5;\n    }\n\n    this.skipDelta = skipRatio !== undefined ? 1 / skipRatio | 0 : 1;\n\n    // options.needUpscale = true;\n\n    // * Pixel ratio\n    const pixelRatio = getLottiePixelRatio(this.width, this.height, options.needUpscale);\n\n    this.width = Math.round(this.width * pixelRatio);\n    this.height = Math.round(this.height * pixelRatio);\n\n    // options.noCache = true;\n\n    // * Cache frames params\n    if(!options.noCache/*  && false */) {\n      //      ,     ,   8080  6868,   75%\n      if(IS_APPLE && this.width > 100 && this.height > 100) {\n        this.cachingDelta = 2; // 2 // 50%\n      } else if(this.width < 100 && this.height < 100) {\n        this.cachingDelta = Infinity; // 100%\n      } else {\n        this.cachingDelta = 4; // 75%\n      }\n    }\n\n    // this.cachingDelta = Infinity;\n    // this.cachingDelta = 0;\n    // if(isApple) {\n    //   this.cachingDelta = 0; //2 // 50%\n    // }\n\n    if(!this.canvas) {\n      this.canvas = this.el.map(() => {\n        const canvas = document.createElement('canvas');\n        canvas.classList.add('rlottie');\n        canvas.width = this.width;\n        canvas.height = this.height;\n        canvas.dpr = pixelRatio;\n        return canvas;\n      });\n    }\n\n    this.contexts = this.canvas.map((canvas) => canvas.getContext('2d'));\n\n    if(!IS_IMAGE_BITMAP_SUPPORTED) {\n      this.imageData = new ImageData(this.width, this.height);\n\n      if(CAN_USE_TRANSFERABLES) {\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n    }\n\n    if(this.name) {\n      this.cache = RLottiePlayer.CACHE.getCache(this.cacheName);\n    } else {\n      this.cache = FramesCache.createCache();\n    }\n  }\n\n  public clearCache() {\n    if(this.cachingDelta === Infinity) {\n      return;\n    }\n\n    if(this.cacheName && this.cache.counter > 1) { // skip clearing because same sticker can be still visible\n      return;\n    }\n\n    this.cache.clearCache();\n  }\n\n  public sendQuery(args: any[]) {\n    this.worker.sendQuery([args.shift(), this.reqId, ...args]);\n  }\n\n  public loadFromData(data: RLottieOptions['animationData']) {\n    this.sendQuery(['loadFromData', data, this.width, this.height, this.toneIndex/* , this.canvas.transferControlToOffscreen() */]);\n  }\n\n  public play() {\n    if(!this.paused) {\n      return;\n    }\n\n    this.paused = false;\n    this.setMainLoop();\n  }\n\n  public pause(clearPendingRAF = true) {\n    if(this.paused) {\n      return;\n    }\n\n    this.paused = true;\n    if(clearPendingRAF) {\n      clearTimeout(this.rafId);\n    }\n    // window.cancelAnimationFrame(this.rafId);\n  }\n\n  private resetCurrentFrame() {\n    return this.curFrame = this.initFrame ?? (this.direction === 1 ? this.minFrame : this.maxFrame);\n  }\n\n  public stop(renderFirstFrame = true) {\n    this.pause();\n\n    const curFrame = this.resetCurrentFrame();\n    if(renderFirstFrame) {\n      this.requestFrame(curFrame);\n      // this.sendQuery('renderFrame', this.curFrame);\n    }\n  }\n\n  public restart() {\n    this.stop(false);\n    this.play();\n  }\n\n  public setSpeed(speed: number) {\n    if(this.speed === speed) {\n      return;\n    }\n\n    this.speed = speed;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public setDirection(direction: number) {\n    if(this.direction === direction) {\n      return;\n    }\n\n    this.direction = direction;\n\n    if(!this.paused) {\n      this.setMainLoop();\n    }\n  }\n\n  public remove() {\n    this.pause();\n    this.sendQuery(['destroy']);\n    if(this.cacheName) RLottiePlayer.CACHE.releaseCache(this.cacheName);\n    this.dispatchEvent('destroy');\n    this.cleanup();\n  }\n\n  private applyColor(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.color;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] !== 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n      }\n    }\n  }\n\n  private applyInversing(frame: Uint8ClampedArray) {\n    const [r, g, b] = this.inverseColor;\n    for(let i = 0, length = frame.length; i < length; i += 4) {\n      if(frame[i + 3] === 0) {\n        frame[i] = r;\n        frame[i + 1] = g;\n        frame[i + 2] = b;\n        frame[i + 3] = 255;\n      } else {\n        frame[i + 3] = 0;\n      }\n    }\n  }\n\n  public renderFrame2(frame: Uint8ClampedArray | HTMLCanvasElement | ImageBitmap, frameNo: number) {\n    /* this.setListenerResult('enterFrame', frameNo);\n    return; */\n\n    try {\n      if(frame instanceof Uint8ClampedArray) {\n        if(this.color) {\n          this.applyColor(frame);\n        }\n\n        if(this.inverseColor) {\n          this.applyInversing(frame);\n        }\n\n        this.imageData.data.set(frame);\n      }\n\n      // this.context.putImageData(new ImageData(frame, this.width, this.height), 0, 0);\n      this.contexts.forEach((context, idx) => {\n        let cachedSource: HTMLCanvasElement | ImageBitmap = this.cache.framesNew.get(frameNo);\n        if(!(frame instanceof Uint8ClampedArray)) {\n          cachedSource = frame;\n        } else if(idx > 0) {\n          cachedSource = this.canvas[0];\n        }\n\n        if(!cachedSource) {\n          // console.log('drawing from data');\n          const c = document.createElement('canvas');\n          c.width = context.canvas.width;\n          c.height = context.canvas.height;\n          c.getContext('2d').putImageData(this.imageData, 0, 0);\n          this.cache.framesNew.set(frameNo, c);\n          cachedSource = c;\n        }\n\n        if(this.overrideRender && this.renderedFirstFrame) {\n          this.overrideRender(cachedSource || this.imageData);\n        } else if(cachedSource) {\n          // console.log('drawing from canvas');\n          context.clearRect(0, 0, cachedSource.width, cachedSource.height);\n          context.drawImage(cachedSource, 0, 0);\n        } else {\n          context.putImageData(this.imageData, 0, 0);\n        }\n\n        if(!this.renderedFirstFrame) {\n          this.renderedFirstFrame = true;\n        }\n      });\n\n      this.dispatchEvent('enterFrame', frameNo);\n    } catch(err) {\n      console.error('RLottiePlayer renderFrame error:', err/* , frame */, this.width, this.height);\n      this.autoplay = false;\n      this.pause();\n    }\n  }\n\n  public renderFrame(frame: Parameters<RLottiePlayer['renderFrame2']>[0], frameNo: number) {\n    const canCacheFrame = this.cachingDelta && (frameNo % this.cachingDelta || !frameNo);\n    if(canCacheFrame) {\n      if(frame instanceof Uint8ClampedArray && !this.cache.frames.has(frameNo)) {\n        this.cache.frames.set(frameNo, new Uint8ClampedArray(frame));// frame;\n      } else if(IS_IMAGE_BITMAP_SUPPORTED && frame instanceof ImageBitmap && !this.cache.framesNew.has(frameNo)) {\n        this.cache.framesNew.set(frameNo, frame);\n      }\n    }\n\n    /* if(!this.listenerResults.hasOwnProperty('cached')) {\n      this.setListenerResult('enterFrame', frameNo);\n      if(frameNo === (this.frameCount - 1)) {\n        this.setListenerResult('cached');\n      }\n\n      return;\n    } */\n\n    if(this.frInterval) {\n      const now = Date.now(), delta = now - this.frThen;\n\n      if(delta < 0) {\n        const timeout = this.frInterval > -delta ? -delta % this.frInterval : this.frInterval;\n        if(this.rafId) clearTimeout(this.rafId);\n        this.rafId = window.setTimeout(() => {\n          this.renderFrame2(frame, frameNo);\n        }, timeout);\n        // await new Promise((resolve) => setTimeout(resolve, -delta % this.frInterval));\n        return;\n      }\n    }\n\n    this.renderFrame2(frame, frameNo);\n  }\n\n  public requestFrame(frameNo: number) {\n    const frame = this.cache.frames.get(frameNo);\n    const frameNew = this.cache.framesNew.get(frameNo);\n    if(frameNew) {\n      this.renderFrame(frameNew, frameNo);\n    } else if(frame) {\n      this.renderFrame(frame, frameNo);\n    } else {\n      if(this.clamped && !this.clamped.length) { // fix detached\n        this.clamped = new Uint8ClampedArray(this.width * this.height * 4);\n      }\n\n      this.sendQuery(['renderFrame', frameNo, this.clamped]);\n    }\n  }\n\n  private onLap() {\n    // this.playedTimes++;\n\n    if(!this.loop) {\n      this.pause(false);\n      return false;\n    }\n\n    return true;\n  }\n\n  private mainLoopForwards() {\n    const {skipDelta, maxFrame} = this;\n    const frame = (this.curFrame + skipDelta) > maxFrame ? this.curFrame = (this.loop ? this.minFrame : this.maxFrame) : this.curFrame += skipDelta;\n    // console.log('mainLoopForwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame + skipDelta) > maxFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  private mainLoopBackwards() {\n    const {skipDelta, minFrame} = this;\n    const frame = (this.curFrame - skipDelta) < minFrame ? this.curFrame = (this.loop ? this.maxFrame : this.minFrame) : this.curFrame -= skipDelta;\n    // console.log('mainLoopBackwards', this.curFrame, skipDelta, frame);\n\n    this.requestFrame(frame);\n    if((frame - skipDelta) < minFrame) {\n      return this.onLap();\n    }\n\n    return true;\n  }\n\n  public setMainLoop() {\n    // window.cancelAnimationFrame(this.rafId);\n    clearTimeout(this.rafId);\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n\n    // console.trace('setMainLoop', this.frInterval, this.direction, this, JSON.stringify(this.listenerResults), this.listenerResults);\n\n    const method = (this.direction === 1 ? this.mainLoopForwards : this.mainLoopBackwards).bind(this);\n    this.currentMethod = method;\n    // this.frameListener && this.removeListener('enterFrame', this.frameListener);\n\n    // setTimeout(() => {\n    // this.addListener('enterFrame', this.frameListener);\n    // }, 0);\n\n    if(this.frameListener) {\n      const lastResult = this.listenerResults.enterFrame;\n      if(lastResult !== undefined) {\n        this.frameListener(this.curFrame);\n      }\n    }\n\n    // this.mainLoop(method);\n    // this.r(method);\n    // method();\n  }\n\n  public playPart(options: {\n    from: number,\n    to: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {from, to, callback} = options;\n    this.curFrame = from - 1;\n\n    return this.playToFrame({\n      frame: to,\n      direction: to > from ? 1 : -1,\n      callback\n    });\n  }\n\n  public playToFrame(options: {\n    frame: number,\n    speed?: number,\n    direction?: number,\n    callback?: () => void\n  }) {\n    this.pause();\n\n    const {frame, speed, callback, direction} = options;\n    this.setDirection(direction === undefined ? this.curFrame > frame ? -1 : 1 : direction);\n    speed !== undefined && this.setSpeed(speed);\n\n    const bounds = [this.curFrame, frame];\n    if(this.direction === -1) bounds.reverse();\n\n    this.loop = false;\n    this.setMinMax(bounds[0], bounds[1]);\n\n    if(this.playToFrameOnFrameCallback) {\n      this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    if(callback) {\n      this.playToFrameOnFrameCallback = (frameNo: number) => {\n        if(frameNo === frame) {\n          this.removeEventListener('enterFrame', this.playToFrameOnFrameCallback);\n          callback();\n        }\n      };\n\n      this.addEventListener('enterFrame', this.playToFrameOnFrameCallback);\n    }\n\n    this.play();\n  }\n\n  public setColor(color: RLottieColor, renderIfPaused: boolean) {\n    this.color = color;\n\n    if(renderIfPaused && this.paused) {\n      this.renderFrame2(this.imageData.data, this.curFrame);\n    }\n  }\n\n  public setInverseColor(color: RLottieColor) {\n    this.inverseColor = color;\n  }\n\n  private setMinMax(minFrame = 0, maxFrame = this.frameCount - 1) {\n    this.minFrame = minFrame;\n    this.maxFrame = maxFrame;\n  }\n\n  public async onLoad(frameCount: number, fps: number) {\n    this.frameCount = frameCount;\n    this.fps = fps;\n    this.setMinMax();\n    if(this.initFrame !== undefined) {\n      this.initFrame = clamp(this.initFrame, this.minFrame, this.maxFrame);\n    }\n\n    const curFrame = this.resetCurrentFrame();\n\n    // * Handle 30fps stickers if 30fps set\n    if(this.fps < 60 && this.skipDelta !== 1) {\n      const diff = 60 / fps;\n      this.skipDelta = this.skipDelta / diff | 0;\n    }\n\n    this.frInterval = 1000 / this.fps / this.speed * this.skipDelta;\n    this.frThen = Date.now() - this.frInterval;\n    // this.sendQuery('renderFrame', 0);\n\n    //    ,   ()  519,\n    //   75%      ,  475, ..  100%   593,    84.\n\n    /* console.time('cache' + this.reqId);\n    for(let i = 0; i < frameCount; ++i) {\n      //if(this.removed) return;\n\n      if(i % 4) {\n        await new Promise((resolve) => {\n          delete this.listenerResults.enterFrame;\n          this.addListener('enterFrame', resolve, true);\n          this.requestFrame(i);\n        });\n      }\n    }\n\n    console.timeEnd('cache' + this.reqId); */\n    // console.log('cached');\n    /* this.el.innerHTML = '';\n    this.el.append(this.canvas);\n    return; */\n\n    !this.skipFirstFrameRendering && this.requestFrame(curFrame);\n    this.dispatchEvent('ready');\n    this.addEventListener('enterFrame', () => {\n      this.dispatchEvent('firstFrame');\n\n      if(!this.canvas[0].parentNode && this.el && !this.overrideRender) {\n        this.el.forEach((container, idx) => container.append(this.canvas[idx]));\n      }\n\n      // console.log('enterFrame firstFrame');\n\n      // let lastTime = this.frThen;\n      this.frameListener = () => {\n        if(this.paused || !this.currentMethod) {\n          return;\n        }\n\n        const time = Date.now();\n        // console.log(`enterFrame handle${this.reqId}`, time, (time - lastTime), this.frInterval);\n        /* if(Math.round(time - lastTime + this.frInterval * 0.25) < Math.round(this.frInterval)) {\n          return;\n        } */\n\n        // lastTime = time;\n\n        this.frThen = time + this.frInterval;\n        const canContinue = this.currentMethod();\n        if(!canContinue && !this.loop && this.autoplay) {\n          this.autoplay = false;\n        }\n      };\n\n      this.addEventListener('enterFrame', this.frameListener);\n      // setInterval(this.frameListener, this.frInterval);\n\n      // ! fix autoplaying since there will be no animationIntersector for it\n      if(this.group === 'none' && this.autoplay) {\n        this.play();\n      }\n    }, {once: true});\n  }\n}\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport Page from './page';\r\nimport lottieLoader from '../lib/rlottie/lottieLoader';\r\nimport {horizontalMenu} from '../components/horizontalMenu';\r\nimport {MOUNT_CLASS_TO} from '../config/debug';\r\nimport fastSmoothScroll from '../helpers/fastSmoothScroll';\r\nimport whichChild from '../helpers/dom/whichChild';\r\n\r\nclass PagesManager {\r\n  private pageId = -1;\r\n  private page: Page;\r\n\r\n  private selectTab: ReturnType<typeof horizontalMenu>;\r\n  public pagesDiv: HTMLDivElement;\r\n  public scrollableDiv: HTMLElement;\r\n\r\n  constructor() {\r\n    this.pagesDiv = document.getElementById('auth-pages') as HTMLDivElement;\r\n    this.scrollableDiv = this.pagesDiv.querySelector('.scrollable') as HTMLElement;\r\n    this.selectTab = horizontalMenu(null, this.scrollableDiv.querySelector('.tabs-container') as HTMLDivElement, null, () => {\r\n      if(this.page?.onShown) {\r\n        this.page.onShown();\r\n      }\r\n    });\r\n  }\r\n\r\n  public setPage(page: Page) {\r\n    if(page.isAuthPage) {\r\n      this.pagesDiv.style.display = '';\r\n\r\n      const id = whichChild(page.pageEl);\r\n      if(this.pageId === id) return;\r\n\r\n      this.selectTab(id);\r\n\r\n      if(this.pageId !== -1 && id > 1) {\r\n        lottieLoader.loadLottieWorkers();\r\n      }\r\n\r\n\r\n      this.pageId = id;\r\n\r\n      if(this.scrollableDiv) {\r\n        fastSmoothScroll({\r\n          container: this.scrollableDiv,\r\n          element: this.scrollableDiv.firstElementChild as HTMLElement,\r\n          position: 'start'\r\n        });\r\n      }\r\n    } else {\r\n      this.pagesDiv.style.display = 'none';\r\n      page.pageEl.style.display = '';\r\n\r\n      this.pageId = -1;\r\n    }\r\n\r\n    this.page = page;\r\n  }\r\n}\r\n\r\nconst pagesManager = new PagesManager();\r\nMOUNT_CLASS_TO.pagesManager = pagesManager;\r\nexport default pagesManager;\r\n","/*\r\n * https://github.com/morethanwords/tweb\r\n * Copyright (C) 2019-2021 Eduard Kuzmenko\r\n * https://github.com/morethanwords/tweb/blob/master/LICENSE\r\n */\r\n\r\nimport pagesManager from './pagesManager';\r\n\r\nexport default class Page {\r\n  public pageEl: HTMLDivElement;\r\n  private installed = false;\r\n\r\n  constructor(className: string, public isAuthPage: boolean, private onFirstMount?: (...args: any[]) => Promise<any> | void, private onMount?: (...args: any[]) => void, public onShown?: () => void) {\r\n    this.pageEl = document.body.querySelector('.' + className) as HTMLDivElement;\r\n  }\r\n\r\n  public async mount(...args: any[]) {\r\n    // this.pageEl.style.display = '';\r\n\r\n    if(this.onMount) {\r\n      this.onMount(...args);\r\n    }\r\n\r\n    if(!this.installed) {\r\n      if(this.onFirstMount) {\r\n        try {\r\n          const res = this.onFirstMount(...args);\r\n          if(res instanceof Promise) {\r\n            await res;\r\n          }\r\n        } catch(err) {\r\n          console.error('PAGE MOUNT ERROR:', err);\r\n        }\r\n      }\r\n\r\n      this.installed = true;\r\n    }\r\n\r\n    pagesManager.setPage(this);\r\n  }\r\n}\r\n","// https://github.com/twitter/twemoji-parser/blob/master/src/lib/regex.js\r\n\r\nexport function encodeEmoji(emojiText: string) {\r\n  const codepoints = toCodePoints(removeVS16s(emojiText)).join('-');\r\n  return codepoints;\r\n}\r\n\r\nconst vs16RegExp = /\\uFE0F/g;\r\n// avoid using a string literal like '\\u200D' here because minifiers expand it inline\r\nconst zeroWidthJoiner = String.fromCharCode(0x200d);\r\n\r\nconst removeVS16s = (rawEmoji: string) => (rawEmoji.indexOf(zeroWidthJoiner) < 0 ? rawEmoji.replace(vs16RegExp, '') : rawEmoji);\r\n\r\nexport function toCodePoints(unicodeSurrogates: string): Array<string> {\r\n  const points = [];\r\n  let char = 0;\r\n  let previous = 0;\r\n  let i = 0;\r\n  while(i < unicodeSurrogates.length) {\r\n    char = unicodeSurrogates.charCodeAt(i++);\r\n    if(previous) {\r\n      points.push((0x10000 + ((previous - 0xd800) << 10) + (char - 0xdc00)).toString(16));\r\n      previous = 0;\r\n    } else if(char > 0xd800 && char <= 0xdbff) {\r\n      previous = char;\r\n    } else {\r\n      points.push(char.toString(16));\r\n    }\r\n  }\r\n\r\n  if(points.length && points[0].length === 2) {\r\n    points[0] = '00' + points[0];\r\n  }\r\n\r\n  return points;\r\n}\r\n\r\nexport function getEmojiToneIndex(input: string) {\r\n  const match = input.match(/[\\uDFFB-\\uDFFF]/);\r\n  return match ? 5 - (57343 - match[0].charCodeAt(0)) : 0;\r\n}\r\n\r\nexport function getCountryEmoji(iso2: string) {\r\n  return String.fromCharCode(55356, 56741 + iso2.charCodeAt(0), 55356, 56741 + iso2.charCodeAt(1));\r\n}\r\n\r\nexport function emojiFromCodePoints(codePoints: string) {\r\n  return codePoints.split('-').reduce((prev, curr) => prev + String.fromCodePoint(parseInt(curr, 16)), '');\r\n}\n","!function(e,t){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=t():\"function\"==typeof define&&define.amd?define([],t):\"object\"==typeof exports?exports.Recorder=t():e.Recorder=t()}(\"undefined\"!=typeof self?self:this,(function(){return function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}return o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},o.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var n in e)o.d(i,n,function(t){return e[t]}.bind(null,n));return i},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,\"a\",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p=\"\",o(o.s=0)}([function(e,t,o){\"use strict\";(function(t){var o=t.AudioContext||t.webkitAudioContext,i=function(e){if(!i.isRecordingSupported())throw new Error(\"Recording is not supported in this browser\");e||(e={}),this.state=\"inactive\",this.config=Object.assign({bufferLength:4096,encoderApplication:2049,encoderFrameSize:20,encoderPath:\"encoderWorker.min.js\",encoderSampleRate:48e3,maxFramesPerPage:40,mediaTrackConstraints:!0,monitorGain:0,numberOfChannels:1,recordingGain:1,resampleQuality:3,streamPages:!1,reuseWorker:!1,wavBitDepth:16},e),this.encodedSamplePosition=0};i.isRecordingSupported=function(){return o&&t.navigator&&t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia&&t.WebAssembly},i.prototype.clearStream=function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach((function(e){e.stop()})):this.stream.stop(),delete this.stream),this.audioContext&&this.closeAudioContext&&(this.audioContext.close(),delete this.audioContext)},i.prototype.encodeBuffers=function(e){if(\"recording\"===this.state){for(var t=[],o=0;o<e.numberOfChannels;o++)t[o]=e.getChannelData(o);this.encoder.postMessage({command:\"encode\",buffers:t})}},i.prototype.initAudioContext=function(e){return e&&e.context?(this.audioContext=e.context,this.closeAudioContext=!1):(this.audioContext=new o,this.closeAudioContext=!0),this.audioContext},i.prototype.initAudioGraph=function(){this.encodeBuffers=function(){delete this.encodeBuffers},this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.config.bufferLength,this.config.numberOfChannels,this.config.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=e=>{this.encodeBuffers(e.inputBuffer)},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.config.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.config.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)},i.prototype.initSourceNode=function(e){return e&&e.context?t.Promise.resolve(e):t.navigator.mediaDevices.getUserMedia({audio:this.config.mediaTrackConstraints}).then(e=>(this.stream=e,this.audioContext.createMediaStreamSource(e)))},i.prototype.loadWorker=function(){this.encoder||(this.encoder=new t.Worker(this.config.encoderPath))},i.prototype.initWorker=function(){var e=(this.config.streamPages?this.streamPage:this.storePage).bind(this);return this.recordedPages=[],this.totalLength=0,this.loadWorker(),new Promise((t,o)=>{var i=o=>{switch(o.data.message){case\"ready\":t();break;case\"page\":this.encodedSamplePosition=o.data.samplePosition,e(o.data.page);break;case\"done\":this.encoder.removeEventListener(\"message\",i),this.finish()}};this.encoder.addEventListener(\"message\",i),this.encoder.postMessage(Object.assign({command:\"init\",originalSampleRate:this.audioContext.sampleRate,wavSampleRate:this.audioContext.sampleRate},this.config))})},i.prototype.pause=function(e){if(\"recording\"===this.state){if(this.state=\"paused\",e&&this.config.streamPages){var t=this.encoder;return new Promise((e,o)=>{var i=o=>{\"flushed\"===o.data.message&&(t.removeEventListener(\"message\",i),this.onpause(),e())};t.addEventListener(\"message\",i),t.postMessage({command:\"flush\"})})}return this.onpause(),Promise.resolve()}},i.prototype.resume=function(){\"paused\"===this.state&&(this.state=\"recording\",this.onresume())},i.prototype.setRecordingGain=function(e){this.config.recordingGain=e,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.setMonitorGain=function(e){this.config.monitorGain=e,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)},i.prototype.start=function(e){if(\"inactive\"===this.state)return this.initAudioContext(e),this.initAudioGraph(),this.encodedSamplePosition=0,this.initWorker().then(()=>this.initSourceNode(e)).then(e=>{this.sourceNode=e,this.state=\"recording\",this.onstart(),this.encoder.postMessage({command:\"getHeaderPages\"}),this.sourceNode.connect(this.monitorGainNode),this.sourceNode.connect(this.recordingGainNode)})},i.prototype.stop=function(){if(\"inactive\"!==this.state){this.state=\"inactive\",this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect(),this.clearStream();var e=this.encoder;return new Promise(t=>{var o=i=>{\"done\"===i.data.message&&(e.removeEventListener(\"message\",o),t())};e.addEventListener(\"message\",o),e.postMessage({command:\"done\"}),this.config.reuseWorker||e.postMessage({command:\"close\"})})}return Promise.resolve()},i.prototype.destroyWorker=function(){\"inactive\"===this.state&&this.encoder&&(this.encoder.postMessage({command:\"close\"}),delete this.encoder)},i.prototype.storePage=function(e){this.recordedPages.push(e),this.totalLength+=e.length},i.prototype.streamPage=function(e){this.ondataavailable(e)},i.prototype.finish=function(){if(!this.config.streamPages){var e=new Uint8Array(this.totalLength);this.recordedPages.reduce((function(t,o){return e.set(o,t),t+o.length}),0),this.ondataavailable(e)}this.onstop(),this.config.reuseWorker||delete this.encoder},i.prototype.ondataavailable=function(){},i.prototype.onpause=function(){},i.prototype.onresume=function(){},i.prototype.onstart=function(){},i.prototype.onstop=function(){},e.exports=i}).call(this,o(1))},function(e,t){var o;o=function(){return this}();try{o=o||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(o=window)}e.exports=o}])}));"],"names":["animationIntersector","constructor","visible","Set","byGroups","lockedGroups","onlyOnePlayableGroup","intersectionLockedGroups","videosLocked","this","observer","IntersectionObserver","entries","entry","target","group","animation","find","p","el","isIntersecting","add","checkAnimation","delete","_animation","clearCache","overrideIdleGroups","doc","type","checkAnimations","idle","setOverrideIdleGroup","override","getAnimations","element","found","player","push","removeAnimation","remove","HTMLVideoElement","IS_SAFARI","setTimeout","src","load","length","unobserve","addAnimation","canvas","HTMLElement","loop","observe","blurred","destroy","undefined","groups","Object","keys","animations","paused","pause","has","autoplay","play","getOnlyOnePlayableGroup","setOnlyOnePlayableGroup","lockGroup","unlockGroup","refreshGroup","forEach","lockIntersectionGroup","unlockIntersectionGroup","SHOULD_USE_SAFARI_FIX","navigator","userAgent","match","err","AppMediaPlaybackController","media","Map","scheduled","mediaDetails","waitingMediaForLoad","waitingScheduledMediaForLoad","waitingDocumentsForLoad","playbackRates","voice","video","audio","seekBackward","details","playingMedia","currentTime","Math","max","seekOffset","seekForward","min","duration","seekTo","seekTime","onMediaDocumentLoad","get","managers","appDocsManager","getDoc","docId","supportsStreaming","handleSafariStreamable","cacheContext","thumbsStorage","getCacheContext","url","playbackRate","set","id","size","onPlay","e","peerId","mid","pip","message","getMessageByMedia","stop","setMedia","verify","listLoader","current","getCurrent","jumpLength","withOtherSide","previous","getPrevious","idx","findIndex","getNext","go","setTargets","dispatchEvent","getPlayingDetails","pauseMediaInOtherTabs","onPause","onEnded","isTrusted","lockedSwitchers","round","next","toggle","clean","s","isScheduled","storage","playingMediaType","playItem","item","searchContext","getMedia","resolveWaitingForLoadMedia","dispatchJump","goRound","browserPlay","bindBrowserCallback","browserPause","browserStop","browserSeekBackward","browserSeekForward","browserSeekTo","browserNext","browserPrevious","seekToStart","construct","container","document","createElement","style","cssText","body","append","mediaSession","actions","seekbackward","seekforward","seekto","previoustrack","nexttrack","action","setActionHandler","console","warn","skipMediaPlayEvent","properties","key","_key","value","dispatchPlaybackParams","defineProperties","getPlaybackParams","volume","muted","setPlaybackParams","params","_volume","_muted","_playbackRate","_loop","_round","addMedia","autoload","pFlags","is_scheduled","setAttribute","addEventListener","media_unread","fromId","appMessagesManager","readMessages","once","deferred","resolve","w","waitingStorage","then","promise","isSafariBuffering","safariBuffering","setSafariBuffering","setNewMediadata","pictureInPictureElement","artwork","isVoice","title","artist","thumbs","bytes","sizes","h","thumb","appPeersManager","getPeerPhoto","attribute","attributes","_","file_name","performer","IS_APPLE","metadata","MediaMetadata","setCurrentMediadata","playbackParams","cb","willBePlayed","willBePlayedMedia","setSearchContext","context","getSearchContext","prev","reset","loadCount","loadWhenLeft","processItem","onJump","older","onEmptied","reverse","folderId","getPlaybackMediaTypeFromMessage","mediaType","setSingleMedia","wasPlaying","toggleSwitchers","playPaused","removeEventListener","enabled","setPictureInPicture","listenerSetter","removeAll","appMediaPlaybackController","AppMediaViewer","captionTimeout","super","isForDocument","inputFilter","isMediaCompatibleForDocumentViewer","onPrevClick","openMedia","getMessageByPeer","onNextClick","onDeleteClick","content","close","onForwardClick","onAuthorClick","Number","MAX_SAFE_INTEGER","threadId","tab","lastMsgId","onDownloadClick","queueId","caption","classList","setCaptionTimeout","clearTimeout","window","onAdditionalScroll","wholeDiv","buttons","btnMenuForward","icon","text","onClick","btnMenuDownload","btnMenuDelete","setBtnMenuToggle","setListeners","forward","author","onCaptionClick","a","spoiler","HTMLAnchorElement","contains","onclick","getAttribute","includes","capture","click","getScheduledMessageByPeer","setCaption","html","entities","totalEntities","firstElementChild","fromRight","prevTargets","nextTargets","setMoverPromise","fwd_from","from_name","cantForwardMessage","canForward","button","cantDownloadMessage","download","canDeleteMessage","_openMedia","date","static","mime_type","VideoPlayer","streamable","onPlaybackRackMenuToggle","onPip","onPipClose","wrapper","setup","canHideControls","playbackRateButton","showOnLeaveToClassName","ignoreClickClassName","parentNode","insertBefore","appendChild","skin","stylePlayer","controls","querySelector","progress","prepend","catch","name","finally","initDuration","buildControls","timeDuration","insertAdjacentHTML","pipButton","querySelectorAll","fullScreenButton","timeElapsed","textContent","toHHMMSS","volumeSelector","leftControls","btn","parentElement","Array","from","togglePlay","requestPictureInPicture","visibility","debounceTime","debouncedPip","debounce","listener","timeout","overlayCounter","code","good","toggleFullScreen","altKey","nextIdx","PLAYBACK_RATES","indexOf","cancelEvent","onFullScreen","bind","hideControls","showControls","setPlaybackRateIcon","onMediaLoad","IS_MOBILE","pictureInPictureEnabled","map","rate","regularText","btnMenu","PLAYBACK_RATES_ICONS","className","IS_APPLE_MOBILE","webkitEnterFullscreen","enterFullscreen","isFull","cleanup","removeListeners","MEDIA_VIEWER_CLASSNAME","AppMediaViewerBase","topButtons","tempId","preloader","preloaderStreamable","isFirstOpen","pageEl","getElementById","zoomElements","zoomSwipeStartX","zoomSwipeStartY","zoomSwipeX","zoomSwipeY","setZoomValue","rangeSelector","moversContainer","transform","btnOut","btnIn","toggleZoom","setMoverAnimationPromise","tagName","highlightSwitchersTimeout","isZooming","mover","classNames","findUpClassName","onKeyDown","ctrlKeyDown","changeZoom","ctrlKey","metaKey","onKeyUp","onWheel","scrollingUp","deltaY","rootScope","log","logger","cancelable","lazyLoadQueue","overlaysDiv","mainDiv","topbar","topbarLeft","onlyMobile","authorRight","avatarEl","nameEl","buttonsDiv","concat","noRipple","zoom","step","withTransition","setHandlers","onScrub","onMouseUp","main","innerHTML","onLoadedMore","setNewMover","moveLength","onSwipe","xDiff","yDiff","abs","windowSize","verifyTouchTarget","evt","enable","isVisible","mousedown","zoomValue","setProgress","videoPlayer","lockControls","zoomSwipeHandler","lastDiffX","lastDiffY","multiplier","onFirstSwipe","onReset","cursor","addProgress","btnMenuToggle","Promise","reject","navigationItem","appNavigationController","clear","setMoverToTarget","onAnimationEnd","appMediaViewer","removeGlobalListeners","toggleOverlay","active","toggleGlobalListeners","setGlobalListeners","passive","closing","removeCenterFromMover","wasActive","delay","realParent","rect","getBoundingClientRect","SVGImageElement","SVGForeignObjectElement","left","needOpacity","overflowElement","visibleRect","getVisibleRect","overflow","vertical","horizontal","containerRect","top","aspecter","width","HTMLImageElement","setFullAspect","offsetLeft","height","scaleX","scaleY","borderRadius","getComputedStyle","getPropertyValue","brSplitted","str","splitted","split","i","fillPropertyValue","r","parseInt","join","willBeLeft","willBeTop","path","opacity","isOut","ret","isFulfilled","isRejected","SVGSVGElement","sizeTailPath","toggleWholeActive","mediaElement","selector","queryFrom","matches","elements","pop","getContext","naturalWidth","naturalHeight","videoWidth","videoHeight","HTMLCanvasElement","drawImage","image","Image","createVideo","clipId","dataset","newClipId","newSvg","createElementNS","setAttributeNS","outerHTML","replace","lastElementChild","defs","use","SVGUseElement","d","getAttributeNS","x","y","sX","sY","br","v","generatePathData","foreignObject","renderImageFromUrl","display","proportion","upscale","start","Date","now","diff","_br","moveTheMover","toLeft","windowW","newTransform","p1","newMover","updateMediaSource","toLowerCase","setAuthorInfo","timestamp","isPeerId","wrapTitlePromise","dialog","onlyFirstName","plainText","wrapEmojiText","oldAvatar","newAvatar","cloneNode","all","updateWithOptions","peerTitle","replaceContent","replaceWith","setAuthorPromise","isDocument","isVideo","useContainerAsTarget","IS_MOBILE_SAFARI","onPop","canAnimate","maxWidth","padding","windowH","mediaSizes","maxHeight","thumbPromise","setAttachmentSize","photoSize","img","downloaded","gotThumb","getStrippedThumbIfNeeded","loadPromise","useController","div","moverVideo","canPlayThrough","createPlayer","ckin","overlay","open","otherMediaViewer","releaseSingleMedia","show","readyState","HAVE_FUTURE_DATA","attach","attachCanPlay","detach","loading","networkState","NETWORK_LOADING","isntEnoughData","unshift","appDownloadManager","error","cancellablePromise","attachPromise","imgs","haveImage","setManual","onPopState","hash","location","state","debug","isPossibleSwipe","currentHash","overriddenHash","overrideHash","onHashChange","pushState","navigations","manual","handleItem","onEscape","back","onTouchStart","touches","options","history","scrollRestoration","replaceState","pushItem","noBlurOnPop","findItemByType","index","backByItem","splice","onItemAdded","noHistory","unshiftItem","spliceItems","items","origin","pathname","search","removeItem","removeByType","single","SearchGroup","clearable","clickable","autonomous","onFound","noIcons","list","setActive","childElementCount","AppSearch","searchInput","searchGroups","onSearch","minMsgId","loadedCount","foundCount","searchPromise","searchTimeout","query","listsContainer","scrollable","messages","setVirtualContainer","onChange","searchMore","onScrolledBottom","trim","beginSearch","inputField","input","focus","maxId","limit","res","count","shift","searchGroup","avatarSize","meAsSaved","SearchContextMenu","attachTo","searchSuper","onGotoClick","appImManager","selection","isSelecting","selectionForwardBtn","onSelectClick","toggleByElement","onClearSelectionClick","cancelSelection","selectionDeleteBtn","attachContextMenuListener","init","MouseEvent","preventDefault","cancelBubble","toPeerId","isSelected","isMidSelected","withSelection","positionMenu","contextMenuController","AppSearchSuper","tabs","prevTabId","middleware","historyStorage","usedFromHistory","urlsToRevoke","loadMutex","nextRates","loadPromises","loaded","loadedChats","firstLoad","monthContainers","mediaTabsMap","asChatList","groupByMonth","hideEmptyTabs","showSender","onTransitionStart","onTransitionEnd","safeAssign","searchContextMenu","navScrollableContainer","navScrollable","nav","tabsMenu","mediaTab","mediaTabs","menuTab","span","ripple","unlockScroll","tabsContainer","swipeHandler","handleTabSwipe","prevId","selectTab","children","onTouchMove","lockers","lockTouchScroll","contentTab","searchGroupMedia","canLoadMediaTab","horizontalMenu","tabContent","animate","skipScroll","scrollIntoViewNew","position","startCallback","scrollStartCallback","newMediaTab","onChangeTab","fromMediaTab","offsetTop","scrollTop","scroll","scrollHeight","rect2","onScroll","onMediaClick","targetClassName","targets","containerEl","copySearchContext","slice","inputMessagesFilterPhotoVideo","inputMessagesFilterDocument","useHeavyAnimationCheck","lock","unlockAndRefresh","filterMessagesByType","filterMessagesByInputFilter","processEmptyFilter","dom","appDialogsManager","setLastMessagePromise","lastMessage","highlightWord","processPhotoVideoFilter","promises","getMediaFromMessage","wrapped","choosePhotoSize","boxWidth","boxHeight","onlyPreview","withoutPreloader","noPlayButton","photo","noBlur","images","full","filter","Boolean","processDocumentFilter","withTime","fontWeight","voiceAsMusic","autoDownloadSize","processUrlFilter","webpage","entity","display_url","sliced","offset","matchUrl","same","URL","hostname","description","previewDiv","setInnerHTML","getAbbreviation","subtitleFragment","htmlToDocumentFragment","wrapRichText","innerText","decodeURIComponent","href","firstChild","wrapPlainText","row","titleRight","subtitle","havePadding","performSearchResult","elemsToAppend","sharedMediaDiv","processCallback","results","awaited","method","monthContainer","getMonthContainerByTimestamp","toggleElementCheckbox","afterPerforming","parent","child","loadChats","renderedPeerIds","inputMessagesFilterEmpty","setResults","showMembersCount","peer","getPeer","participants_count","participants","regExp","RegExp","escapeRegExp","cleanSearchText","titleSpan","lastMessageSpan","getChatMembersString","toChatId","username","getPeerUsername","user","appUsersManager","getUser","phone","formatPhoneNumber","formatted","onLoad","arg","getContactsPeerIds","contacts","searchContacts","my_results","globalContacts","showMore","intlElement","isShort","update","getConversations","dialogs","minDate","renderRecentSearch","recent","recentSearch","isUser","getUserStatusString","toUserId","getTopPeers","peers","people","loadMembers","renderParticipants","membersList","rippleEnabled","li","findUpTag","DIALOG_LIST_ELEMENT_TAG","participant","getParticipantPeerId","isAnyChat","deleted","appChatsManager","isChannel","LOAD_COUNT","appProfileManager","getChannelParticipants","getChatFull","chatFull","loadType","justLoad","used","slicedLength","ids","notFilteredMessages","m","checkForTriggers","getSearch","nextRate","next_rate","loadFirstTime","filters","counters","canViewMembers","getSearchCounters","firstMediaTab","counter","c","membersTab","loadFirstTimePromise","toLoad","t","findAndSplice","setHours","setDate","dateTimestamp","getTime","containers","month","getFullYear","year","dateElement","haveTimestamps","getObjectKeysAndSort","positionElementByIndex","isBroadcast","hasRights","cleanScrollPositions","cleanupHTML","goFirst","revokeObjectURL","putPreloader","empty","newInputFilter","copy","setQuery","maxDate","AppSelectPeers","chatsContainer","selected","freezed","offsetIndex","loadedWhat","peerType","multiSelect","exceptSelf","tempIds","selfPresence","needSwitchList","onInput","cachedContacts","getMoreResults","f","renderResultsFunc","renderResults","peerIds","splitUp","notRendered","filterPeerTypeBy","placeholder","section","innerContainer","topContainer","selectedContainer","selectedScrollable","sectionNameLangPackKey","noShadow","checkbox","checked","debouncedInput","appendTo","getResultsPromise","onFirstRender","renderSaved","testSelfSearch","getTempId","getMoreDialogs","archived","pageCount","newOffsetIndex","chatRightsAction","filterByRights","isEnd","getMoreContacts","isGlobalSearch","searchResult","resultPeerIds","arr","getMoreChannelParticipants","channelParticipants","q","isNonContactUser","checkboxField","label","subtitleEl","isDialog","insertAdjacentElement","offsetWidth","getSelected","addInitial","values","requestAnimationFrame","forceDirection","constructDownloadPreloader","tryAgainOnFail","circle","totalLength","mids","attr","elem","findMediaTargets","anchor","anchorMid","isBubbles","justAudioSelector","selectors","prefix","mediaItems","AudioElement","render","isRealVoice","isOutgoing","is_outgoing","uploadingFileName","durationStr","downloadDiv","onTypeLoad","audioEl","out","waveform","Uint8Array","valueCount","result","dataView","DataView","buffer","byteIndex","bitShift","getUint16","decodeWaveform","svg","svgContainer","availW","barHeightMax","minW","maxW","normValue","wfSize","barCount","maxValue","maxDelta","barX","sumI","bar_value","barWidth","createWaveformBars","fakeSvgContainer","waveformContainer","timeDiv","onTimeUpdate","throttledTimeUpdate","addAudioListener","readyPromise","mousemove","scrub","offsetX","targetTouches","pageX","scrubTime","wrapVoiceMessage","descriptionEl","audioAttribute","parts","titleEl","middleEllipsisEl","sizeType","subtitleDiv","launched","progressLine","lastChild","wrapAudio","audioTimeDiv","HAVE_CURRENT_DATA","onTypeDisconnect","getTimeStr","hadSearchContext","useSearch","autoDownload","shouldPlay","onDownloadInit","pauseListener","notifyAll","done","total","cancel","Error","playListener","setDownloadFunction","disconnectedCallback","isConnected","customElements","define","AvatarListLoader","loadMore","photoId","appPhotosManager","getUserPhotos","photos","loadedAllUp","AppMediaViewerAvatar","getPhoto","onAvatarUpdate","openAvatarViewer","getTarget","hadMessage","isObject","believeMe","seen","AvatarElement","addedToQueue","attachClickEvent","updateOptions","wasPeerId","newPeerId","onlyThumb","putPhoto","isBig","AvatarEdit","clearRect","asDiv","rippleSquare","disabled","ButtonMenuItem","noCheckboxClickListener","textElement","textArgs","keepOpen","menu","b","ButtonMenuToggleHandler","onOpen","onClose","openedMenu","direction","ChatBackgroundGradientRenderer","_width","_height","_tails","_scrollTails","_curve","_positions","_phases","_animatingToNextPosition","_scrollDelta","_onWheelRAF","drawOnWheel","floor","ceil","changeTailAndDraw","drawNextPositionAnimated","getProgress","transitionValue","nextPositionTail","_nextPositionTail","_nextPositionTails","_nextPositionLeft","frames","_frames","drawImageData","_incrementalCurve","hexToRgb","hex","g","getPositions","positions","getNextPositions","phase","curveMax","curve","pos","distances","nextPos","distance","curPosition","tail","changeTail","_tail","_phase","curPos","drawGradient","getGradientImageData","_hctx","createImageData","pixels","data","centerDistanceY","centerDistanceY2","centerDistanceX","swirlFactor","sqrt","theta","sinTheta","sin","cosTheta","cos","pixelX","pixelY","distanceSum","_colors","distanceX","distanceY","putImageData","_ctx","_hc","cancelAnimationFrame","colors","color","alpha","_canvas","fillStyle","fillRect","toNextPosition","tails","nextPhaseOnIdx","inc","toFixed","curves","last","scrollAnimate","_addedScrollListener","createCanvas","gradientRenderer","accumulateMapSet","reduce","acc","AppSelection","selectedMids","onMouseDown","targetLookupClassName","verifyTarget","selecting","firstTarget","processElement","checkBetween","isInDOM","seenSet","seenLength","findUpAsChild","elementsBetween","getElementsBetween","toggleByMid","canceledSelection","onMouseMove","getElementFromTarget","verifyMouseMoveTarget","removeManual","listenElement","documentListenerOptions","first","firstRect","lastRect","isHigher","lookupBetweenParentClassName","lookupBetweenElementsQuery","firstIndex","lastIndex","doNotAnimate","onCancelSelection","toggleSelection","navigationType","random","attachListeners","selectedText","getSelection","toString","createRange","verifyTouchLongPress","isElementShouldBeSelected","appendCheckbox","hasCheckbox","getCheckboxInputFromElement","updateContainer","forceSelection","cantForward","cantDelete","cantSend","storageKey","cantForwardDeleteMids","onUpdateContainer","toggleCheckboxes","wasSelecting","blurActiveElement","forwards","toggleResult","onToggleSelection","updateElementSelection","toggleMid","unselect","deleteSelectedMids","SearchSelection","selectionCountEl","selectionGotoBtn","selectionContainer","BASE_CLASS","btnCancel","attachClickOptions","obj","fromPeerId","sort","isPrivate","transitionElement","ChatSelection","chat","bubbles","recording","bubble","canSelectBubble","isGroupedBubbleSelected","getMidsFromGroupContainer","getBubbleGroupedItems","groupContainer","isGroupedSelected","isGroupedMidsSelected","mounted","getMountedBubble","needTranslateX","widthFrom","widthTo","center","selectionInputWrapper","selectionSendNowBtn","selectionLeft","selectionRight","translateButtonsX","right","inputContainer","toggleAttribute","skippedMids","isGrouped","groupedCheckboxInput","CheckboxField","restriction","toggleDisability","stateKey","stateValues","stateValue","setValueSilently","box","checkSvg","bg","border","withRipple","withHover","event","Event","disable","CodeInputField","autocomplete","lastLength","setLabel","onFill","confirmationPopup","callback","cancelButton","isCancel","checkboxes","countries","setCountries","country","hidden","default_name","localeCompare","CountryInputField","hidePicker","hideTimeout","selectWrapper","selectCountryByTarget","defaultName","phoneCodeEl","phoneCode","countryCode","lastCountrySelected","lastCountryCodeSelected","country_codes","_countryCode","country_code","onCountryChange","liMap","arrowDown","selectList","initSelect","emoji","iso2","liArr","noPhoneCodes","Infinity","spanEmoji","select","margin","mouseDownHandlerAttached","onKeyPress","_value","names","abbr","word","test","blur","selectCountryByIso2","countryName","EditPeer","_disabled","isChanged","uploadAvatar","changedLength","requiredLength","requiredValidLength","inputFields","isValid","required","handleChange","nextBtn","withoutAvatar","avatarElem","doNotEditAvatar","avatarEdit","_upload","lockWithPromise","unlockOnSuccess","GifsTab","gifsContainer","EmoticonsDropdown","masonry","EMOTICONSSTICKERGROUP","getGifs","docs","processInvisibleDiv","ANIMATIONGROUP","AppGifsTab","nextOffset","loadedAll","onGifsClick","fileId","inputSearch","gifsDiv","onCloseAfterTimeout","newSearch","gifBotPeerId","resolveUsername","appInlineBotsManager","getInlineResults","next_offset","AppStickersTab","setsDiv","listenTo","sticker","stickerSet","access_hash","appStickersManager","getStickerSet","toggleStickerSet","changed","installed_date","removeAttribute","renderSet","header","countDiv","stickersDiv","stickerDiv","documents","withLock","renderFeatured","getFeaturedStickers","coveredSets","filterRendered","forEachReverse","covered","searchStickerSets","tabId","onSelectTabClick","searchButton","deleteBtn","checkRights","tabsEl","tabsElements","canSendStickers","canSendGifs","canSendToPeer","whichChild","savedRange","getGoodRange","unlock","refresh","emojiTab","stickersTab","gifsTab","HIDE_EMOJI_TAB","INIT_TAB_ID","lastMouseMoveEvent","mouseMoveEventAttached","isActive","onMouseOut","getElement","clearDraft","silent","emoticonsDropdown","forceClose","addLazyLoadQueueRepeat","divs","intersector","getVisible","clearVisible","getSavedRange","sel","rangeCount","activeElement","getRangeAt","menuOnClick","menuScroll","jumpedTo","stickyIntersector","stuck","which","axis","sendDocId","loadedURLs","appendEmoji","unify","kek","getEmojiEntityFromEmoji","wrapSingleEmoji","fixEmoji","getEmojiFromElement","nodeType","nodeValue","EmojiTab","closeScrollTop","onContentClick","EMOJI_RECENT_CATEGORY","EMOJI_CATEGORIES","sorted","category","emojis","emojiCategory","titleLangPackKey","getElementMediaSize","menuTabPadding","unified","menuWrapper","previousElementSibling","emojiScroll","appEmojiManager","getRecentEmojis","setMenuActive","hasRecent","activeId","recentCategory","recentItemsDiv","observeStickyHeaderChanges","LazyLoadQueueRepeat","parallelLimit","onVisibilityChange","_queue","spliced","findAndSpliceAll","queue","setProcessQueueTimeout","SuperStickerRenderer","regularLazyLoadQueue","animated","checkAnimationContainer","processVisible","processInvisible","renderSticker","observeAnimated","unobserveAnimated","StickersTabCategory","setCategoryItemsHeight","containerWidth","elementSize","itemsPerRow","minHeight","StickersTab","categories","categoriesMap","localCategories","createCategory","categoriesIntersector","isCategoryVisible","toggleLocalCategory","notMounted","onLocalCategoryUpdate","setFavedLimit","appConfig","stickers_faved_limit_premium","stickers_faved_limit_default","categoryAppendStickers","superStickerRenderer","renderStickerSet","setTyping","intersectionOptions","root","clearCategoryItems","createLocalCategory","onCategoryStickers","stickers","deleteSticker","unshiftSticker","spliceExceed","favedCategory","clearButton","titleLangKey","descriptionLangKey","langKey","clearRecentStickers","noop","premiumCategory","apiManager","getAppConfig","getFavedStickersStickers","getRecentStickersStickers","getAllStickers","sets","getPremiumStickers","isPremium","race","rendererLazyLoadQueue","faved","resizeCategories","createStickersContextMenu","verifyRecent","batch","unshiftRecentSticker","saveRecentSticker","deleteRecentSticker","generateFakeIcon","isScam","LazyLoadQueueRepeat2","GifsMasonry","scrollPromise","processVisibleDiv","noInfo","noPreview","gifWidth","gifHeight","willUseWidth","calcImageInBox","transitionTime","scrollableX","proxy","Proxy","apply","that","args","selectTarget","result1","canChange","forceDuration","mutateCallback","useStripe","indicator","currentIndicator","shiftLeft","scaleFactor","clientWidth","findUpAttribute","noLinebreaks","originalEvent","clipboardData","getData","usePlainText","filterEntity","curChild","nextSibling","richValue","getRichValue","entities2","parseEntities","mergeEntities","fragment","wrapDraftText","documentFragmentToHTML","execCommand","InputState","InputField","validate","maxLength","showLengthOn","canBeEdited","labelText","onInputCallbacks","String","isInputEmpty","inputMode","labelEl","showingLength","wasError","inputLength","isError","withLinebreaks","range","selectNodeContents","removeAllRanges","addRange","selectElementContents","labelOptions","fromSet","originalValue","isValidToChange","setDraftValue","setOriginalValue","setState","Valid","setError","InputSearch","prevValue","onClearClick","onClear","searchIcon","clearBtn","LazyLoadQueue","wasSeen","getItem","addElement","hasOwnProperty","LazyLoadQueueIntersector","inProcess","disconnect","loadItem","intersectorTimeout","processQueue","MediaProgressLine","useTransform","progressRAF","onLoadedData","seek","setLoadProgress","onProgress","filledLoad","setSeekMax","buf","buffered","numRanges","nearestStart","end","percents","testQueue","pendingTest","setTestQueue","testElement","getElementWidth","mapped","firstTime","textLength","font","textWidth","elementWidth","newElementWidth","widthChanged","smallerText","smallerWidth","smallerTextLength","half","half1","substr","half2","MiddleEllipsisElement","connectedCallback","PasswordMonkey","passwordInputField","needFrame","noCache","currentFrame","setSpeed","onVisibilityClickAdditional","passwordVisible","setDirection","curFrame","TrackingMonkey","playAnimation","frame","idleAnimation","PasswordInputField","onVisibilityClick","toggleVisible","stealthy","tabIndex","PeerProfileAvatars","avatar","avatars","draggable","loadCallback","intersectionObserver","loadCallbacks","addTab","gradient","info","arrowPrevious","arrowNext","checkScrollTop","SWITCH_ZONE","freeze","_e","clickX","toRight","cancelNextClick","minX","lastX","SCALE","TRANSLATE_TEMPLATE","addIndex","loadNearestToTarget","setPeer","backLimit","filterChatPhotosMessages","chat_photo","generateFakeAvatarMessage","activeTab","photo_id","setText","PeerProfile","setPeerStatus","needClear","noDelimiter","bio","subtitleLangKey","getProfileByPeerId","about","toast","link","notifications","togglePeerMute","appNotificationsManager","isPeerLocalMuted","setMoreDetails","fillUsername","userId","self","fillUserPhone","setAvatar","setPeerStatusInterval","setInterval","clearSetMoreDetailsTimeout","canBeDetailed","oldAvatars","formatUserPhone","fillNotifications","notificationsRow","fillRows","withIcons","fillProfileElements","cleaned","_setMoreDetails","peerFull","getChat","exportedInvite","exported_invite","address","setMoreDetailsTimeout","isRestricted","acknowledged","setPromise","cached","clearInterval","generateTitleIcons","noVerifiedIcon","noFakeIcon","noPremiumIcon","verified","use2","generateVerifiedIcon","fake","scam","premium","generatePremiumIcon","weakMap","WeakMap","PeerTitle","setOptions","hasInner","fromName","limitSymbols","icons","getPeerTitle","withPremiumIcon","inner","createDocumentFragment","PopupAvatar","closable","withConfirm","cropper","crop","removeHandlers","h6","btnClose","cropContainer","file","files","readBlobAsDataURL","contents","onload","originalImage","cropComponent","cropImage","event_state","cropLeft","cropTop","cropWidth","cropHeight","scaledRatio","overlayColor","CROPWIDTH","offsetHeight","CROPHEIGHT","updateCropSize","updateCropImage","startMoving","resizing","keyHandler","imgZoom","PI","bottom","newWidth","newHeight","clientHeight","fromCharCode","charCode","stopPropagation","container_width","container_height","container_left","container_top","mouse_x","clientX","scrollX","mouse_y","clientY","pageY","scrollY","saveEventState","moving","endMoving","currentTouch","complete","btnConfirm","hide","toBlob","blob","darkenCanvas","onCrop","postCanvas","ctx","PopupDeleteDialog","onSelect","peerTitleElement","getDialogType","callbackLeave","flush","leave","flushHistory","callbackDelete","descriptionArgs","isDanger","descriptionLangArgs","PopupDeleteMessages","onConfirm","revoke","deleteScheduledMessages","deleteMessages","titleArgs","isMegagroup","_hasRights","canRevoke","titleLangArgs","PopupForward","peerIdMids","overrideOnSelect","peerTypes","DEFAULT_APPEND_TO","appendPopupTo","onFullScreenChange","PopupElement","reAppend","middlewareHelper","MANAGERS","confirmShortcutIsSendShortcut","withoutOverlay","overlayClosable","isScrolledDown","btnConfirmOnEnter","buttonsEl","buttonsElements","langArgs","POPUPS","onContentUpdate","popup","popupConstructor","ctor","addCancelButton","times","langPackKey","ONE_HOUR","PopupMute","time","mutePeer","radioForm","PopupPeer","noTitle","o","original","nextElementSibling","PopupPickUser","PopupSendNow","sendScheduledMessages","ANIMATION_GROUP","PopupStickers","stickerSetInput","isEmojis","onStickersClick","updateAdded","stickersFooter","onStickerSetUpdate","_set","updateButton","loadStickerSet","createStickerSetElements","headerRow","buttonRight","added","itemsContainer","setsPromises","isArray","firstSet","isStickerPack","onSend","containersPromises","docIds","animationGroup","toggleStickerSets","isAdd","buttonAppend","installed","ProgressivePreloader","detached","isUpload","attachMethod","loadFunc","constructContainer","bold","constructDownloadIcon","downloadSvg","cancelSvg","func","startTime","onEnd","notify","elapsedTime","TRANSITION_TIME","addNotifyListener","useRafs","getTotalLength","strokeDasharray","putAvatar","renderThumbPromise","thumbImage","isFullLoaded","stripped_thumb","getPreviewURLFromBytes","sequentialDom","renderPromise","myId","getPeerColorById","avatarAvailable","avatarRendered","appAvatarsManager","isAvatarCached","first_name","last_name","getPeerInitials","returnDiv","setButtonLoader","RadioField","alignRight","RadioForm","radios","form","RangeSelector","events","setFilled","filled","stepStr","decimals","_removeListeners","rectMax","offsetAxisValue","rippleClickId","attachListenerTo","handler","drawRipple","clickId","touchStartFired","clickY","isRippleUnneeded","touchEnd","Row","radioField","subtitleLangArgs","isToggle","noCheckboxSubtitle","titleRightSecondary","noWrap","titleRightEl","navigationTab","buttonRightLangKey","createMedia","RadioFormFromRows","rows","RadioFormFromValues","SCROLL_THROTTLE","IS_ANDROID","ScrollableBase","logPrefix","onScrollMeasure","lastScrollPosition","lastScrollDirection","isHeavyAnimationInProgress","needCheckAfterAnimation","cancelMeasure","onScrolledTop","scrollPosition","scrollProperty","addScrollListener","addedScrollListener","removeScrollListener","removeHeavyAnimationListener","Scrollable","onScrollOffset","withPaddingContainer","maxScrollTop","getDistanceToEnd","setScrollTopSilently","ignoreNextScrollEvent","ScrollableX","splitCount","scrollHorizontally","deltaX","scrollWidth","scrollLeft","AppNewGroupTab","isGeoChat","setTitle","SettingSection","inputWrapper","groupNameInputField","groupLocationInputField","valueCheck","userLocationCoords","userLocationAddress","createChannel","geo_point","megagroup","chatId","inputFile","editPhoto","inviteToChannel","createChat","chatsSection","nameArgs","new","startLocating","geolocation","getCurrentPosition","lat","coords","latitude","long","longitude","uri","fetch","response","json","display_name","GeolocationPositionError","PrivacyType","getPrivacyRulesDetails","rules","types","allowPeers","users","chats","disallowPeers","rule","PrivacySection","onRadioChange","captions","captionElement","radioSection","exceptions","radioRows","skipTypes","noExceptions","generateSection","exceptionTexts","exception","_peerIds","slider","createTab","skippable","takeOut","newPeerIds","generateStr","splitPeersByType","selectedPeerIds","appPrivacyManager","getPrivacy","inputKey","setRadio","k","eventListener","chatKey","usersKey","getUserInput","setPrivacy","AppPrivacyPhoneNumberTab","getSelf","captionEl","mePath","anchorCopy","phoneSection","sCaption","AppTwoStepVerificationSetTab","captionOld","stickerContainer","inputContent","generateContentElement","btnReturn","sliceTabsUntilTab","AppSettingsTab","canFocus","isFirstInput","AppTwoStepVerificationEmailConfirmationTab","isFirst","email","codeInputField","passwordManager","confirmPasswordEmail","goNext","btnChange","btnResend","cancelPasswordEmail","AppTwoStepVerificationEmailTab","resendPasswordEmail","onOpenAfterTimeout","onContinueClick","btnContinue","btnSkip","matchEmail","toggleButtons","updateSettings","hint","currentPassword","plainPassword","newPassword","symbols","AppTwoStepVerificationHintTab","onSkipClick","saveHint","AppTwoStepVerificationReEnterPasswordTab","monkey","I","verifyInput","AppTwoStepVerificationEnterPasswordTab","isNew","has_password","textEl","getStateInterval","getState","_state","check","auth","AppTwoStepVerificationTab","removeTabFromHistory","btnChangePassword","btnDisablePassword","btnSetRecoveryEmail","has_recovery","btnSetPassword","AppPrivacyLastSeenTab","AppPrivacyProfilePhotoTab","AppPrivacyForwardMessagesTab","AppPrivacyAddToGroupsTab","AppPrivacyCallsTab","AppActiveSessionsTab","Session","app_name","app_version","ip","date_active","date_created","midtitle","device_model","system_version","platform","authorizations","session","btnTerminate","invokeApi","otherSection","onError","onTerminateClick","menuElement","AppBlockedUsersTab","btnAdd","toggleBlock","bot","blocked","getBlocked","convertKeyToInputKey","toUpperCase","AppPrivacyVoicesTab","AppPrivacyAndSecurityTab","SUBTITLE","blockedPeerIds","blockedUsersRow","passwordState","twoFactorRowOptions","email_unconfirmed_pattern","twoFactorRow","activeSessionsRow","updateActiveSessions","setBlockedCount","updateBlocked","rowsByKeys","numberVisibilityRow","lastSeenTimeRow","photoVisibilityRow","callRow","linkAccountRow","groupChatsAddRow","voicesRow","updatePrivacyRow","disallowLength","allowLength","destroyed","setGlobalPrivacySettings","archive_and_mute_new_noncontact_peers","getGlobalPrivacySettings","settings","onPremiumToggle","autoarchive_setting_available","_enabled","sensitive_enabled","sensitive_can_change","payment","appPaymentsManager","clearSavedInfo","deleteButton","appDraftsManager","clearAllDrafts","auths","averageColorFromCanvas","pixel","fill","getImageData","pixelsLength","outPixel","Uint8ClampedArray","highlightningColor","rgba","l","ColorPicker","hue","saturation","lightness","onGrabStart","documentElement","boxDragger","onGrabEnd","sliders","hueDragger","hexInputField","rgbInputField","inputs","valid","setColor","rgbRegExp","attachBoxListeners","attachHueListeners","attachGrabListeners","boxRect","saturationHandler","hueRect","hueHandler","updateHexInput","updateRgbInput","rgb","boxX","percentY","boxY","percentHue","hueX","updatePicker","getCurrentColor","rgbaArray","hexa","hsl","hsla","clamp","maxX","maxY","posX","posY","lightnessX","lightnessY","AppBackgroundColorTab","_applyColor","updateColorPicker","colorPicker","background","theme","intensity","slug","appStateManager","pushToState","onColorChange","applyColor","themeController","gridSection","grid","backgroundColor","throttle","isColored","AppBackgroundTab","clicked","wallPapersByElement","elementsByKey","onUploadClick","accept","requestFile","endsWith","createObjectURL","mimeType","scaleMediaElement","File","wallPaper","prepareWallPaperUpload","uploadPromise","uploadWallPaper","uploadDeferred","newKey","getWallPaperKey","setBackgroundDocument","addWallPaper","onResetClick","defaultTheme","blurCheckboxField","onGridClick","wallpaper","saveToCache","_tempId","onReady","getPixelPromise","imageUrl","imageSource","ratio","averageColorFromImageSource","averageColor","getColorsFromWallPaper","toDataURL","getWallPaperKeyFromTheme","uploadButton","colorButton","resetButton","pattern","getWallPapers","wallPapers","gridContainer","background_color","second_background_color","third_background_color","fourth_background_color","hasFile","isDark","dark","noFadeIn","webkitMaskImage","AppQuickReactionTab","appReactionsManager","getQuickReaction","getAvailableReactions","quickReaction","availableReactions","reaction","inactive","availableReaction","static_icon","setDefaultReaction","emoticon","RangeSettingSelector","initialValue","minValue","writeValue","nameDiv","valueDiv","valueContainer","AppGeneralSettingsTab","chatBackgroundButton","animationsCheckboxField","enterRow","ctrlEnterRow","kilometersRow","milesRow","formats","format","runFirst","getNextTimeout","_callback","run","eachTimeout","getSeconds","eachMinute","toLocaleTimeString","hour","minute","suggestCheckboxField","bigCheckboxField","reactionsRow","renderQuickReaction","getCustomEmojiDocument","document_id","loopCheckboxField","stickerSets","stickersContent","allStickers","assumeType","AppEditProfileTab","firstNameInputField","lastNameInputField","bioInputField","about_length_limit_premium","about_length_limit_default","editPeer","usernameInputField","setProfileUrl","availableText","takenText","invalidText","profileUrlContainer","profileUrlAnchor","updateProfile","uploadProfilePhoto","updateUsername","userFull","getProfile","AppNotificationsTab","NotifySection","enabledRow","typeText","previewEnabledRow","inputNotifyPeer","getNotifySettings","notifySettings","applySettings","isMuted","show_previews","mute","showPreviews","inputSettings","mute_until","updateNotifySettings","notify_settings","contactsSignUpRow","soundRow","sound","getContactSignUpNotification","setContactSignUpNotification","AppLanguageTab","invokeApiCacheable","lang_pack","languages1","languages2","rendered","webLangCodes","language","lang_code","native_name","langPack","autoDownloadPeerTypeSection","contactsCheckboxField","privateCheckboxField","groupsCheckboxField","channelsCheckboxField","AppAutoDownloadPhotoTab","AppAutoDownloadFileTab","debouncedSave","sizeMax","setByKey","MIN","MAX_RANGE","MAX","upTo","formatBytes","compareAndUpdate","AppAutoDownloadVideoTab","AUTO_DOWNLOAD_FOR_KEYS","private","channels","AppDataAndStorageTab","autoCheckboxField","autoDownloadNew","deepEqual","setSubtitles","setAutoDownloadSubtitle","photoRow","videoRow","fileRow","file_size_max","openTab","tabConstructor","onDisabledChange","gifsCheckboxField","videosCheckboxField","peerKeys","enabledKeys","isAll","logOut","edit","profile","fillPromise","changeAvatarBtn","upload","updateChangeAvatarBtn","devicesRow","languageRow","buttonsSection","lottieLoader","getAuthorizations","overwrite","getAuthorizationsPromise","AppNewChannelTab","channelNameInputField","channelDescriptionInputField","onLengthChange","broadcast","channelId","PopupCreateContact","importContact","nameInputField","telInputField","AppContactsTab","openContacts","isContact","sortedUserList","createList","renderPage","AppArchivedTab","wasFilterId","filterId","chatList","localId","AppPeopleNearbyTab","isLocationWatched","parseDistance","retryBtn","latestLocationSaved","accuracy","getLocated","updates","orderedPeers","groupsCounter","usersCounter","getPeerId","peopleSection","locatedPeers","sortedList","errorCategory","startWatching","watchPosition","isLongitudeDifferent","isLatitudeDifferent","distanceCheck","calculateDistance","stopWatching","lat1","long1","lat2","long2","asin","LEFT_COLUMN_ACTIVE_CLASSNAME","AppSidebarLeft","sidebarEl","sidebarHeader","onContactsClick","backBtn","btnArchive","dialogsStorage","getFolderDialogs","isDialogsLoaded","themeCheckboxField","filteredButtons","sessionStorage","kz_version","toolsBtn","btnMenuFooter","rel","newBtnMenu","updateBtn","reload","initSearch","archivedCount","folder","unreadPeerIds","formatNumber","checkUpdateInterval","cache","status","ok","hasUpdate","searchContainer","pickedElements","selectedPeerId","selectedMinDate","selectedMaxDate","updatePicked","setProperty","removeProperty","helper","unselectEntity","renderEntity","indexOfAndSplice","dates","dateData","pushRecentSearch","peopleContainer","hideNewBtnMenuTimeout","transition","activeClassName","onFocus","clearRecentSearchBtn","clearRecentSearch","fakeGradientDelimiter","generateDelimiter","hr","captionArgs","delimiter","appSidebarLeft","AppAddMembersTab","attachToPromise","removeLoader","isPrivacy","AppChatFoldersTab","filtersRendered","renderFolder","dialogFilter","non_contacts","broadcasts","bots","isAnyGroup","filtersStorage","getFilter","createFolderBtn","foldersSection","suggestedSection","canCreateFolder","onFiltersContainerUpdate","getDialogFilters","toggleAllChats","getSuggestedFilters","order","loadAnimationPromise","dialog_filters_limit_premium","dialog_filters_limit_default","getSuggestedDialogsFilters","suggestedFilters","includePeerIds","excludePeerIds","pinnedPeerIds","createDialogFilter","bool","AppIncludedChatsTab","getContacts","foundInFilters","dialogsByFilters","onSelectChange","confirmBtn","cmp","pinned_peers","other","otherLegacy","getInputPeerById","editFolderTab","setFilter","onAppConfig","dialog_filters_chats_limit_premium","dialog_filters_chats_limit_default","categoriesSection","exclude_muted","ico","exclude_archived","exclude_read","selectedPeers","addedInitial","_add","flag","originalFilter","AppEditFolderTab","flags","deleteFolderButton","updateDialogFilter","menuBtn","inputSection","generateList","h2Text","to","includedFlagsContainer","excludedFlagsContainer","include","include_peers","editCheckForChange","reloadMissingPromises","reloadMissingPeerIds","onCreateOpen","onEditOpen","ul","ignoreClick","hasPeer","getDialogOnly","filtered","filterAsync","renderMore","_length","exclude_peers","RIGHT_COLUMN_ACTIVE_CLASSNAME","AppSidebarRight","canHideFirst","isColumnProportionSet","toggleSidebar","setColumnProportion","createSharedMediaTab","replaceSharedMediaTab","previousTab","sharedMediaTab","historyTabIds","_selectTab","getFrom","setFrom","onCloseTab","isNavigation","willChange","animationPromise","appSidebarRight","AppEditContactTab","notificationsCheckboxField","profileNameDiv","profileSubtitleDiv","phoneRow","addContact","btnDelete","deleteContacts","AppChatTypeTab","privateRow","publicRow","privateSection","publicSection","linkRow","btnRevoke","getChatInviteLink","linkInputField","applyBtn","head","getValue","migrateChat","toggleNoForwards","onChatUpdate","noforwards","AppUserPermissionsTab","destroyListener","ChatPermissions","rights","banned_rights","editBanned","btnDeleteException","clearChannelParticipantBannedRights","kickFromChannel","exceptionText","toggleWith","defaultBannedRights","default_banned_rights","defaultRights","combineParticipantBannedRights","restrictionText","mainFlag","until_date","AppGroupPermissionsTab","chatPermissions","editChatDefaultBannedRights","addExceptionRow","openPermissions","getChannelParticipant","setSubtitle","bannedRights","cantWhat","listEl","setLength","exceptionsCount","loader","setLoader","getPromise","migrateFrom","migrateTo","AppChatReactionsTab","getActiveAvailableReactions","_chatReactions","available_reactions","chatReactions","emoticons","reactions","makeReactionFromEmoticons","getCaptionLangPackKey","toggleSection","reactionsSection","toggleCheckboxFieldsByEmoticons","checkboxFieldsByEmoticon","toggleCheckboxField","toggleRow","save","checkboxFields","every","saveReactionsDebounced","allow_custom","saveReactions","setChatAvailableReactions","isDebounced","AppEditChatTab","_init","chatUpdateListeners","addChatUpdateListener","getCachedFullChat","canChangeType","canChangePermissions","chatNameInputField","descriptionInputField","chatTypeRow","setChatTypeSubtitle","setReactionsLength","availableReactionsLength","chatAvailableReactions","permissionsRow","setPermissionsLength","getChatTyped","editTitle","editAbout","signMessagesCheckboxField","signatures","toggleSignatures","showChatHistoryCheckboxField","togglePreHistoryHidden","hidden_prehistory","historiesStorage","AppSharedMediaTab","newCloseBtn","closeBtn","animatedCloseIcon","transitionContainer","transitionFirstItem","editBtn","transitionLastItem","secondTitle","setIsSharedMedia","isSharedMedia","onCloseBtnClick","toggleEditBtn","renderNewMessages","msgs","deleteDeletedMessages","btnAddMembers","showConfirmation","addChatUser","setLoadMutex","peerChanged","loadSidebarMedia","destroyable","SetTransition","raf","afterTimeout","SidebarSlider","closeTab","closingId","preserveTab","getTab","isTabExists","doNotAppend","SliderSuperTab","_constructor","SliderSuperTabEventable","SortedUserList","getIndex","getUserStatusForSort","onDelete","onListLengthChange","onUpdate","onSort","willChangeLength","onElementCreate","base","updateElementWith","updateListWith","createChatListOptions","doTimeout","updateList","SORT_INTERVAL","hasViewer","attachStickerViewerListeners","findTarget","checkForParent","closest","mediaContainer","previousGroup","_middleware","previousTransformer","doThatSticker","lockGroups","isSwitching","effectThumb","mediaRect","boxSize","fitted","aspectFitted","transformer","stickerEmoji","stickerEmojiRaw","transformX","transformY","needFadeIn","withThumb","relativeEffect","loopEffect","firstFramePromise","prevPlayer","ready","onMousePreMove","newMediaContainer","_previousTransformer","StickyIntersector","observeHeaders","observeElements","headersObserver","targetInfo","boundingClientRect","stickyTarget","rootBoundsInfo","rootBounds","threshold","elementsObserver","addSentinel","sentinel","headerSentinel","getEvent","attachGlobalListenerTo","RESET_GLOBAL","SwipeHandler","listenerOptions","hadMove","xDown","yDown","handleMove","setCursorTo","handleStart","xUp","yUp","onSwipeResult","setCursor","TelInputField","pasted","lastValue","telEl","HTMLInputElement","pixelRatio","devicePixelRatio","letterSpacing","originalFunc","formattedPhoneNumber","leftPattern","shiftKey","toastEl","hideToast","toastNew","langPackArguments","slideNavigation","prevTabContent","slideTabs","TransitionSlider","isHeavy","animationFunction","Transition","withAnimationListener","onTransitionEndCallbacks","animationDeferred","listenerName","onEndEvent","overrideFrom","onTransitionEndCallback","_from","isUsernameValid","UsernameInputField","checkUsernameDebounced","checkUsername","checkUsernamePromise","available","VisibilityIntersector","locked","change","refreshVisible","VolumeSelector","onMuteClick","setVolume","iconIndex","ICONS","wrapCustomEmoji","customEmojiSize","wrapDocument","noAutoDownload","uploadFileName","audioElement","extSplitted","ext","docDiv","icoDiv","icoTextEl","hadContext","hasThumb","performance","fileName","bytesContainer","descriptionParts","bytesMaxEl","sizeDiv","_downloadDiv","addByteProgress","sizeContainer","_bytesContainer","_d","canOpenAfter","downloadFileName","downloadId","apiFileManager","isDownloading","_limitSymbols","support","was_online","today","getDate","dateEl","timeEl","wrapJoinVoiceChatAnchor","wrapUrl","call","wrapLinkToMessage","plain","savedFrom","dir","wrapMessageActionTextNew","unsafeMessage","getNameDivHTML","formatCallDuration","post","schedule_date","daysToStart","tomorrowDate","_args","day","pinnedMessage","reply_to_mid","fetchMessageReplyTo","htmlToSpan","user_id","joined","anchorHTML","domain","isRecurringInit","recurring_init","isRecurringUsed","recurring_used","paymentsWrapCurrencyAmount","total_amount","currency","invoiceMessage","reply_to","reply_to_peer_id","waited","wrapMessageActionTextNewUnsafe","wrapMessageForReply","usingMids","withoutMediaType","hasAlbumKey","addPart","part","usingFullAlbum","grouped_id","getMidsByMessage","albumText","getAlbumText","poll","question","game","actionWrapped","restriction_reason","exec","messageWrapped","noLinks","noTextFormat","wrapPeerTitle","wrapPhoto","withTail","noThumb","blurAfter","isWebDoc","isFit","loadThumbPromise","isGif","renderOnLoad","canAttachPreloader","haveToDownload","onlyCache","getDownloadPromise","wrapSenderToPeer","senderTitle","fromMe","wrapSentTime","STICKER_EFFECT_MULTIPLIER","locksUrls","wrapSticker","loadStickerMiddleware","exportLoad","needUpscale","skipRatio","asStatic","fullThumb","noPremium","isCustomEmoji","stickerType","emojiSticker","animatedSticker","staticSticker","isAnimated","getStickerEffectThumb","willHaveLock","lockUrl","toneIndex","isThumbNeededForType","lottieCachedThumb","getLottieCachedThumb","haveThumbCached","afterRender","num","getPathFromBytes","ns","getPreviewURLFromThumb","stickerThumbConverted","webpWorkerController","saveWebPConvertedStrippedThumb","getImageFromStrippedThumb","middlewareError","makeError","animationData","sync","setLockColor","dpr","skipx","skipy","imageData","sr","sg","sb","sa","outCanvas","outContext","computeLockColor","saveLottiePreview","onFirstFrame","preloadAnimatedEmojiStickerAnimation","isSingleVideo","mediaLength","lastPromise","_media","preloadSticker","playing","animationDiv","stickerPromise","side","attachStickerEffectHandler","onEmojiStickerClick","emojiData","sendInteractionThrottled","msg_id","getServerMessageId","interaction","JSON","stringify","getAnimatedEmojiSoundDocument","restart","getAnimatedEmojiSticker","withRandomOffset","wrapStickerAnimation","unmountAnimation","create","frameNo","maxFrame","vibrate","generateRandomSigned","randomOffsetX","randomOffsetY","setPosition","factor","stableOffsetX","stableOffsetY","rectX","rectY","addOffsetX","addOffsetY","wrapStickerEmoji","wrapStickerSetThumb","downloadOptions","getStickerSetThumbDownloadOptions","videos","wrapStickerToRow","previousMedia","_size","roundVideoCircumference","wrapVideo","videoSize","isAlbumItem","canAutoplay","spanTime","spanPlay","needPlayButton","photoRes","divRound","halfSize","strokeWidth","radius","strokeDashoffset","globalVideo","onPaused","onFrame","renderDeferred","loadPhotoThumbFunc","wrapWebPageDescription","webPage","shortDescriptionText","wrapWebPageTitle","shortTitle","site_name","EmojiVersions","Emoji","version","assign","FontFamily","FontSize","FontWeight","instances","getAnimationInstance","cancelAnimationByKey","instance","isCancelled","animateSingle","tick","createAnimationInstance","array","AudioAssetPlayer","assets","playSound","assetName","createAudio","playSoundIfDifferent","Audio","stopSound","cancelDelayedPlay","playSoundWithTimeout","heavyQueue","processingQueue","addHeavyTask","processHeavyQueue","todo","possiblePromise","process","realResult","timedChunk","requireBlurPromise","fastBlurFunc","processBlurNext","iterations","default","dataUri","JPEG_HEADER","bytesFromHex","JPEG_TAIL","isSticker","btoa","bytesToDataURL","imageW","imageH","boxW","boxH","noZoom","boxedImageW","boxedImageH","getTextWidth","measureText","mediaSize","quality","badCharsRe","trimRe","C2L","clearBadCharsAndTrim","latinize","processSearchText","clearBadChars","ignoreCase","hasTag","includeTag","charAt","originalText","ch","latinizeCh","latinizeString","fixCyrillic","copyTextToClipboard","clipboard","writeText","textArea","removeChild","fallbackCopyTextToClipboard","ContextMenuController","diffX","diffY","isOpened","openBtnMenu","months","days","ONE_DAY","getWeekNumber","UTC","getMonth","dayNum","getUTCDay","setUTCDate","getUTCDate","yearStart","getUTCFullYear","formatDateAccordingToTodayNew","weekday","formatFullSentTimeRaw","formatTime","capitalize","textTransform","formatFullSentTime","getFullDate","joiner","monthAsNumber","getHours","getMinutes","noSeconds","leadingZero","noTime","minYear","yearPattern","monthYearOrDayPattern","yearOrDayAndMonthPattern","shortDate","longDate","numberOfDaysEachMonth","fillTipDates","setFullYear","dayOfWeek","formatWeekLong","getDay","getDayOfWeek","setTime","g1","g2","createForDayMonth","createForMonthYear","selectedYear","currentYear","g3","validDateForMonth","formatterYearMax","k1","setMonth","formatterMonthYear","formatterDayMonth","_cancelContextMenuOpening","_cancelContextMenuOpeningTimeout","cancelContextMenuOpening","onCancel","onStart","onMove","isTouch","onTouchEnd","CLICK_EVENT_NAME","touchMouseDown","detachClickEvent","simulateClickEvent","ControlsHover","setHideTimeout","hideControlsTimeout","isShown","controlsLocked","toggleControls","relatedTarget","verifyFavoriteSticker","toAdd","favedStickers","some","_doc","findElement","filterButtons","attachListenerSetter","_element","initResult","createContextMenu","disablePictureInPicture","computedStyle","getProperty","simulateEvent","childNodes","node","tag","requestFullScreen","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen","addFullScreenListener","addListener","eventName","getFullScreenElement","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","isFullScreen","markdownTags","entityName","underline","italic","monospace","strikethrough","mentionName","BLOCK_TAG_NAMES","getRichElementValue","lines","line","selNode","selOffset","follow","isBlock","alt","isTableCell","wasEntitiesLength","wasLength","field","withEntities","getViewportSlice","overflowRect","extraSize","invisibleTop","invisibleBottom","foundVisible","lookForSticky","overflowTop","overflowRight","overflowBottom","overflowLeft","sticky","windowWidth","windowHeight","handleHorizontalSwipe","cancelY","DocumentFragment","template","hasAttribute","isSendShortcutPressed","isComposing","secondaryKey","isSwipingBackSafari","TouchEvent","placeCaretAtEnd","ignoreTouchCheck","selectionStart","selectionEnd","collapse","createTextRange","textRange","moveToElementText","prevPos","backgroundImage","useCache","isImage","renderImageFromUrlPromise","renderMediaWithFadeIn","DropdownHover","inited","ignoreMouseOut","displayTimeout","toElement","willBeActive","dispatchResultableEvent","attachButtonListener","onmouseout","onmouseover","setIgnoreMouseOut","ignore","FocusDirection","fastSmoothScroll","maxDistance","Static","scrollWithJs","getNormalSize","rectStartKey","rectEndKey","sizeKey","scrollSizeKey","scrollPositionKey","elementRect","elementPosition","containerSize","scrollSize","fallbackToElementStartWhenCentering","remainingPath","absPath","startAt","shortTransition","longTransition","currentPath","distanceToEnd","FILENAME_JOINER","getFileNameByLocation","thumb_size","big","stickerset","short_name","thumb_version","volume_id","local_id","strictDecimals","_decimals","dm","fixed","pow","parseFloat","CALL_DURATION_LANG_KEYS","showLast","modulus","formatDuration","strings","prefixes","maxPrefixLength","setPrefix","originalStr","prefixCountry","patterns","searchForPattern","mostMatchedPatternMatches","mostMatchedPattern","_pattern","patternMatches","symbol","arcParameter","rx","ry","xAxisRotation","largeArcFlag","sweepFlag","tl","tr","bl","useBlur","ignoreCache","ListLoader","loadedAllDown","setLoaded","unsetCurrent","toPrevious","goUnsafe","leftLength","down","loadPromiseDown","loadPromiseUp","processedArr","processed","ListenerSetter","listeners","addManual","onceCallback","onceFired","_listener","MediaSize","aspect","aspectCovered","makeMediaSize","ScreenSize","MediaSizes","screenSizes","mobile","medium","large","handhelds","regular","album","esgSticker","documentName","invoice","customEmoji","esgCustomEmoji","desktop","isMobile","handleResize","innerWidth","activeScreen","wasScreen","rAF","middlewarePromise","throwWhat","numberThousandSplitter","HAVE_METADATA","useCanplayOnIos","OverlayClickHandler","withOverlay","amount","skipSymbol","isNegative","currencyData","amountExp","exp","number","dec_point","thousands_sep","n","isFinite","prec","sep","dec","toFixedFix","number_format","decimal_sep","space_between","symbol_left","splitter","additionalPadding","getScrollWidthFromElement","menuWidth","menuHeight","paddingTop","paddingRight","paddingBottom","paddingLeft","verticalSide","maxTop","maxLeft","minLeft","sides","intermediateX","intermediateY","possibleSides","platforms","getRestrictionReason","reasons","reason","savingLottiePreview","isSavingLottiePreview","saving","throttleWithRaf","fn","schedulerFn","waiting","throttleWith","ScrollableLoader","SearchListLoader","messageId","generateMessageId","filterMids","onHistoryDelete","shouldBeDeleted","onHistoryMultiappend","onMessageSent","isInner","otherSideLoader","filterMessagesByInputFilterFromStorage","goToOtherEnd","do","kind","scheduleFlush","measure","mutate","mutateElement","read","write","pushDocumentSize","_isWebDocument","replies","comments","channel_id","SortedList","_updateList","canUpdate","getAll","updateBatch","noScheduler","encodeEntities","charCodeAt","limitFrom","leadZero","sec_num","hours","minutes","seconds","visualViewport","innerHeight","ANIMATION_START_EVENT","ANIMATION_END_EVENT","isAnimating","heavyAnimationPromise","promisesInQueue","dispatchHeavyAnimationEvent","perf","_heavyAnimationPromise","onHeavyAnimationEnd","interruptHeavyAnimation","getHeavyAnimationPromise","handleAnimationStart","handleAnimationEnd","DialogsContextMenu","onArchiveClick","selectedId","editPeerFolders","folder_id","onPinClick","toggleDialogPin","config","getConfig","pinned_dialogs_count_max","onUnmuteClick","onUnreadClick","unread_count","readHistory","top_message","markDialogUnread","onContextMenu","getDeleteButtonText","isDialogUnread","pinned","ConnectionStatusComponent","hadConnect","connecting","timedOut","updating","setConnectionStatus","baseDcId","connectionStatus","setFirstConnectionTimeout","online","apiUpdatesManager","forceGetDifference","retryAt","setStatusText","currentLangPackKey","statusEl","statusPreloader","singleInstance","CHANGE_STATE_DELAY","getA","networkerFactory","forceReconnect","timerSpan","interval","forceReconnectTimeout","setStateTimeout","statusContainer","SENDING_STATUS","easeInOutSine","easeInOutSineApply","roundRect","stroke","defaultRadius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","DPR","SIZE","MARGIN","WIDTH","RADIUS","Shimmer","currTime","diffTime","spread","pausedTime","pauseInterval","lightSource","lightSpread","currentAnimationIndex","keepTime","cycleAnimation","currentAnimation","animateGlow","animateSlide","smartInc","lightLeft","lightRight","lightCenter","createLinearGradient","customProperties","shimmerColor","addColorStop","dict","on","fillText","DialogsPlaceholder","onThemeChange","stopAnimation","startAnimation","onResize","updateCanvasSize","shimmer","generatedValues","marginVertical","lineHeight","lineBorderRadius","lineMarginVertical","statusWidth","getRectFrom","onRemove","blockScrollable","overflowY","availableLength","detachTime","renderDetachAnimationFrame","globalCompositeOperation","completed","elapsedRowTime","dialogHeight","renderFrame","createPattern","patternCanvas","patternContext","drawChat","firstLineWidth","secondLineWidth","marginLeft","arc","drawCircle","drawCircleFromStart","setPromiseMiddleware","oldPromise","SortedDialogList","indexKey","getDialogIndex","addListDialog","isBatch","AppDialogsManager","Log","placeholders","sortedLists","scrollables","folders","menuScrollContainer","lastActiveElements","offsets","initedListeners","loadedDialogsAtLeastOnce","onTabChange","loadDialogsRenderPromise","loadDialogsPromise","onChatsScroll","_onListLengthChange","checkIfPlaceholderNeeded","hasContacts","removeContactsPlaceholder","updateContactsLength","dialogSize","loadContacts","verifyPeerIdForContacts","processContact","setListClickListener","onChatsRegularScroll","sliceTimeout","scrollTopWas","rectContainer","rectTarget","firstY","lastY","firstElement","elementFromPoint","lastElement","elementOverflow","sliceFromStart","sliceFromEnd","deleteDialog","setOffsets","onChatsScrollTop","loadDialogs","getProxiedManagers","contextMenu","bottomPart","allChatsIntlElement","isFilterIdAvailable","clearCurrent","onStateLoaded","setFilterId","addFilter","foldersScrollable","_id","filtersNavigationItem","setFilterIdAndChangeTab","changeFiltersAllChatsKey","groupCallsController","callsController","getDialogIndexKey","getDialogIndexKeyByFilterId","setOnlineStatus","hasClassName","initListeners","getDialogDom","isBot","processDialogForCallStatus","setFilterUnreadCount","setLastMessageN","setUnread","validateDialogForFilter","setFiltersUnreadCount","updateDialog","setUnreadMessagesN","drop","setDialogActive","getCachedDialogs","validateListForFilter","onFiltersLengthChange","containerToAppend","renderedFilter","typings","unsetTyping","dialogDom","callIcon","filtersArr","haveFilters","addFilters","addFiltersPromise","doNotRenderChatList","showFiltersPromise","getNotifyPeerTypeSettings","fillConversations","getOffsetIndex","isDialogMustBeInViewport","migratedTo","testDialogForFilter","topOffset","bottomOffset","unreadSpan","unread","unreadUnmutedCount","unreadCount","getFolderUnreadCount","generateScrollable","sortedDialogList","createChatList","wasShowing","cachedInfoPromise","currentOffsetIndex","needIndex","getConversationsResult","isTopEnd","callbacks","cccc","offsetDialog","generateEmptyPlaceholder","classNameType","subtitleArgs","placeholderContainer","needPlaceholder","emptyDialogsPlaceholderSubtitle","usersLength","placeholderType","updatePartClassName","updateContactsLengthPromise","firstDialog","getDialogFromElement","lastDialog","withContext","openInner","lastActiveListElement","setPeerFunc","sameElement","getDialogByPeerId","setLastMessage","draftMessage","draft","topMessage","lastTimeSpan","isMessageRestricted","willPrepend","videoTypes","playIcon","senderBold","setUnreadMessages","wasMuted","setStatusMessage","isPinned","hasUnreadBadge","transitionDuration","disableAnimationIfRippleFound","iconClassName","setSendingStatus","statusSpan","isUnreadBadgeMounted","unreadBadge","hasMentionsBadge","unread_mentions_count","isMentionBadgeMounted","mentionsBadge","isUnread","isMention","getDialog","originalDialog","getOutputPeer","setCallStatus","START_X","wasMounted","itemProgress","groupCallActiveIcon","addDialogNew","call_active","call_not_empty","addDialogAndSetLastMessage","getMessageSenderPeerIdOrName","addDialog","captionDiv","titleSpanContainer","peerTitlePromise","titleP","rightSpan","oldTypingElement","newTypingElement","downloads","getNewDeferred","cancelDownload","clearDownload","getNewDeferredForUpload","getUpload","getDownload","getUploadPromise","getDownloadFileNameFromOptions","downloadMedia","promiseBefore","getDownloadMediaDetails","downloadMediaURL","downloadMediaVoid","getFileNameForUpload","downloadToDisc","justAttach","pingPromise","iframe","hadProgress","getDocumentDownloadOptions","getPhotoDownloadOptions","clickEvent","createEvent","initMouseEvent","createDownloadAnchor","BubbleGroup","createAvatar","avatarLoadPromise","avatarContainer","fwdFrom","fwdFromId","isForwardFromChannel","from_id","currentPeerId","firstTimestamp","firstItem","firstMid","lastTimestamp","lastItem","lastMid","updateClassNames","insertItem","insertInDescendSortedArray","sortGroupItemsKey","insertGroup","mount","onItemUnmount","mountItem","onItemMount","unmountItem","dateContainer","getDateContainerByTimestamp","dateGroups","_group","dateGroupsLength","unmountedLength","STICKY_OFFSET","deleteEmptyDateGroups","BubbleGroups","itemsArr","itemsMap","newGroupDiff","sortItemsKey","sortGroupsKey","removeItemFromCache","removeAndUnmountBubble","getItemByBubble","siblings","getSiblingsAtIndex","modifiedGroups","previousSibling","canItemsBeGrouped","groupUngrouped","mountUnmountGroups","toMount","toUnmount","bad","partition","getLastGroup","changeBubbleMid","insertItemToArray","changeItemBubble","changeBubbleByBubble","item1","item2","itemIndex","findGroupSiblingByItem","findGroupSiblingInItems","previousItem","siblingGroupedItem","nextItem","addItemToGroup","addItemToCache","getMessageFromId","viaBotId","createItem","SERVICE_AS_REGULAR","getDateForDateContainer","groupMid","splitSiblingsOnGrouping","prepareForGrouping","hadGroup","foundItem","splittedGroups","PopupDatePicker","initDate","onPick","noButtons","selectedDate","selectedMonth","minMonth","prevBtn","maxMonth","onDateClick","selectedEl","setTimeTitle","controlsDiv","monthTitle","monthsContainer","handleTimeInput","onOverflow","maxString","hoursInputField","minutesInputField","setMinutes","popupCenterer","timeOptions","sendDate","dateOptions","renderElement","firstDate","weekStartDate","dayIndex","clonedDate","showOverflowMonths","remainder","DivAndCaption","MEDIA_SIZE","wrapReplyDivAndCaption","mediaEl","messageMedia","isRound","mediaChildren","CHAT_ANIMATION_GROUP","video_thumbs","ReplyContainer","isMediaSet","wrapReply","setColorPeerId","replyContainer","CLASS_NAME","StackedAvatars","AVATAR_CLASS_NAME","RepliesElement","updated","postKey","leftPart","recent_repliers","stackedAvatars","read_max_id","max_id","textSpan","iconSpan","rippleContainer","subscribeRepliesThread","updateMessage","makeEdited","edited","makeSponsored","MessageRender","chatType","editedSpan","sponsoredSpan","isSponsored","sponsored","isMessage","views","postAuthor","post_author","postViewsSpan","channelViews","edit_date","edit_hide","timeSpan","clonedArgs","renderReplies","bubbleContainer","messageDiv","isFooter","repliesFooter","setReply","isReplacing","currentReplyDiv","replyToPeerId","originalMessage","originalPeerTitle","titlePeerId","originalMessageFwdFromId","needUpdate","replyMid","getElementByPoint","horizontalSide","reflowScrollableElement","SEND_WHEN_ONLINE_TIMESTAMP","INTERNAL_LINK_TYPE","PopupJoinChatInvite","chatInvite","request_needed","importChatInvite","savePhoto","peopleCount","ReactionElement","reactionCount","_reactionCount","setCanRenderAvatars","canRenderAvatars","doNotRenderSticker","hadStickerContainer","getReaction","callbackify","center_icon","renderDoc","wrapPromise","wrapStickerPromise","renderCounter","displayOn","renderAvatars","recentReactions","peer_id","setIsChosen","isChosen","chosen_order","fireAroundAnimation","REACTION_INLINE_SIZE","REACTION_BLOCK_SIZE","around_animation","iconPlayer","aroundPlayer","removeOnFrame","REACTIONS_ELEMENTS","ReactionsElement","middlewareHelpers","onConnectCallback","getReactionCount","reactionElement","getMessage","isPlaceholder","onDestroy","changeMessage","changedResults","hasReactions","counts","reactionsEqual","totalReactions","can_see_list","recent_reactions","handleChangedResults","ScrollSaver","getSaved","findElements","replaceSaved","findAndSetElements","_save","scrollHeightMinusTop","onRestore","useReflow","setScrollTop","newScrollTop","restore","_restore","previousScrollHeightMinusTop","SuperIntersectionObserver","observing","observingQueue","freezedObservingNew","toggleObservingNew","isMentionUnread","mentioned","accumulate","stringResults","numberResults","replaceNonNumber","CARD_BRAND_REGEXP","visa","mastercard","amex","discover","diners","diners14","jcb","unionpay","elo","mir","CARD_BRANDS","minLength","cvcMaxLength","cvcMinLength","unknown","detectCardBrand","card","sanitizedCard","brand","detectUnifiedCardBrand","createArray","delta","buggedRegExp","getDistanceFromBuggedToNormal","char","fixBuggedNumbers","makeOptionalCharacter","consumed","makeRequiredCharacter","partial","wrapCharacterRegExpFactory","optional","_regExp","source","makeCharacter","makeMonthDigitPatternCharacter","digit","capitalCharacter","cleanedResult","formattingCharacter","str1","makeFormattingCharacter","optionalPattern","spaceCharacter","yearOptionalPattern","sixteenPattern","fifteenPattern","requiredPostcodes","generateFourPattern","cardFormattingPatterns","cardNumber","cardExpiry","cardCvc","cardCvcFromBrand","postalCodeFromCountry","optionalDigits","accumulateLengths","strs","nbspRegExp","makeValidationError","validateCardNumber","sanitized","getCardInfoByNumber","ignoreIncomplete","validateCompleteCardNumber","makeCardNumberError","validateCardExpiry","monthStr","yearStr","_year","nextMonth","isNaN","validateExpiry","createVerificationIframe","allow","contentWindow","parse","PopupPaymentVerification","eventType","eventData","path_full","InputFieldCorrected","lastKeyDown","deleting","lastTransformed","getPattern","pushRest","autocorrectComplete","character","getCharacter","meta","formatInputValueByPattern","formatMethod","transformedValue","validateNew","onBlur","justReturn","validateMethod","validateAnyIncomplete","errorKeys","handleInputFieldsOnChange","_onChange","createCountryZipFields","zip","countryInputField","postcodeInputField","SUPPORTED_NATIVE_PROVIDERS","PopupPaymentCard","paymentForm","savedCard","native_provider","cardOut","token","credentials","can_save_credentials","cardSection","nativeParams","native_params","lastBrand","lastBrandImg","brandIconTempId","cardInputField","invalid","incomplete","transformed","getPaymentBrandIconPath","setBrandIcon","cvcInputField","need_cardholder_name","expireInputField","switchFocusOrder","previousInputField","nextInputField","inputFieldsRow","billingSection","need_country","need_zip","canSave","saveCheckboxField","saveRow","payButton","PaymentButton","expiryFull","expiryMonth","expiryYear","cvc","cardholderName","nativeProvider","URLSearchParams","headers","publishable_key","expiration_month","expiration_year","security_code","public_token","PopupPaymentCardConfirmation","inputCheckPassword","getInputCheckPassword","tmpPassword","password","period","handled","PopupPaymentShipping","inputInvoice","savedInfo","saved_info","addressSection","address1InputField","address2InputField","cityInputField","stateInputField","receiverSection","emailInputField","shipping_address_requested","name_requested","email_requested","phone_requested","validateEmail","validatePhone","selectedCountry","shipping_address","street_line1","street_line2","city","country_iso2","post_code","requestedInfo","validateRequestedInfo","shippingAddress","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_CITY_INVALID","ADDRESS_STATE_INVALID","ADDRESS_POSTCODE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_EMAIL_INVALID","REQ_INFO_PHONE_INVALID","focusField","PopupPaymentShippingMethods","shippingOption","shipping_options","prices","lastShippingId","option","PopupPayment","tipButtonsMap","confirmed","onConfirmed","popupPaymentVerification","mediaInvoice","isReceipt","receipt_msg_id","isTest","itemEl","detailsClassName","photoEl","linesClassName","linesEl","botName","preloaderContainer","getPaymentReceipt","getPaymentForm","savedCredentials","saved_credentials","lastRequestedInfo","providerPeerTitle","provider_id","bot_id","wrapAmount","isRecurring","recurring","peerTitle2","makeLabel","pricesClassName","makePricesElements","price","_label","wrappedAmount","pricesElements","getTipsAmount","shippingAmount","setTotal","totalAmount","totalLabel","payI18n","canTip","max_tip_amount","tip_amount","tipsClassName","getInputValue","setInputWidth","setInputValue","unsetActiveTip","tipEl","tipsLabel","haveToIgnoreEvents","onSelectionChange","ignoreNextSelectionChange","onFocusOut","tipsEl","tipClassName","tipButtons","suggested_tip_amounts","tipAmount","prevTipEl","setRowIcon","createRow","setRowTitle","setCardSubtitle","methodRow","onMethodClick","previousCardDetails","previousToken","credentials_title","providerRow","providerAvatar","shippingAddressRow","shippingNameRow","shippingEmailRow","shippingPhoneRow","shippingMethodRow","lastShippingOption","onShippingAddressClick","onShippingMethodClick","setShippingTitle","postAddress","setShippingInfo","setShippingOption","scrollSaver","lastShippingPricesElements","shipping","acceptTermsCheckboxField","recurring_terms_url","acceptTermsRow","recurringElements","lastTmpPasword","missingInfo","tmp_password","paymentResult","sendPaymentForm","form_id","_passwordState","valid_until","tsNow","Layouter","minWidth","spacing","ratios","countRatios","proportions","countProportions","averageRatio","maxSizeRatio","layout","ComplexLayouter","layoutTwo","layoutThree","layoutFour","layoutTwoTopBottom","layoutTwoLeftRightEqual","layoutTwoLeftRight","layoutThreeLeftAndOther","layoutThreeTopAndOther","layoutFourTopAndOther","layoutFourLeftAndOther","geometry","RectPart","minimalWidth","secondWidth","firstWidth","firstHeight","thirdHeight","secondHeight","rightWidth","leftWidth","thirdWidth","h0","w0","w2","w1","h1","h2","cropRatios","attempts","multiHeight","sum","pushAttempt","lineCounts","heights","second","third","fourth","optimalAttempt","optimalDiff","attempt","lineCount","totalHeight","minLineHeight","bad1","bad2","optimalCounts","optimalHeights","rowCount","colCount","col","prepareAlbum","widthItem","heightItem","borderTopLeftRadius","borderBottomLeftRadius","borderTopRightRadius","borderBottomRightRadius","forMedia","mediaDiv","wrapAlbum","attachmentDiv","uploading","AppPollResultsTab","resultsDiv","appPollsManager","getPoll","quiz","voters","total_voters","roundPercents","answer","answers","answerEl","answerTitle","answerPercents","getVotes","votesList","votes","vote","lineTotalLength","minIndex","minRemainder","maxRemainder","pollElement","isClosed","closed","performResults","chosenIndexes","PollElement","setMaxLength","resizePolls","hideQuizHint","onHide","prevQuizHint","prevQuizHintOnHide","prevQuizHintTimeout","isListenerSet","isQuiz","isRetracted","isPublic","isMultiple","chosingIndexes","sentVote","MAX_LENGTH","MAX_OFFSET","svgLines","setLineProgress","descKey","public_voters","multiple_choice","multipleSelect","descDiv","typeDiv","avatarsDiv","close_period","close_date","timeLeftDiv","quizTimer","circumference","closeTime","quizInterval","timeLeft","getResults","answerDivs","numberDivs","footerDiv","viewResults","votersCountDiv","sendVoteBtn","sendVotes","canVote","setVotersCount","clickHandler","initQuizHint","solution","solution_entities","toggleHint","setQuizHint","correctResult","correct","chosen","answerIndex","foundIndex","indexes","sendVotePromise","sendVote","recent_voters","isVoted","hideSendVoteBtn","hideViewResultsBtn","maxPercents","getPercentValue","iterate","fullTime","votersCount","IGNORE_ACTIONS","TEST_SCROLL_TIMES","TEST_SCROLL","PEER_CHANGED_ERROR","BIG_EMOJI_SIZES","BIG_EMOJI_SIZES_LENGTH","getMainMidForGrouped","ChatBubbles","unreadOut","bubblesNewByGroupedId","bubblesNew","dateMessages","scrolledDown","isScrollingTimeout","unreaded","unreadedSeen","messagesQueuePromise","messagesQueue","messagesQueueOnRenderAdditional","firstUnreadBubble","replyFollowHistory","isFirstLoad","passEntities","viewsMids","isTopPaddingSet","renderingMessages","bubblesToEject","bubblesToReplace","setPeerTempId","renderNewPromises","unreadedObserverCallback","onUnreadedInViewport","viewsObserverCallback","sendViewCountersDebounced","sponsoredMessage","random_id","viewSponsoredMessage","stickerEffectObserverCallback","onBubblesMouseMove","unhoverPrevious","hoverBubble","hoverReaction","setHoverVisible","stickerWrapper","getGroupsFirstMessage","getMiddleware","getAvailableReactionsByMessage","select_animation","sendReaction","onBubblesClick","setInnerPeer","chatInner","onDatePick","contactDiv","callDiv","callUser","getInputInvoiceByPeerId","reactionsElement","stickerEmojiEl","bubbleMid","reply_to_top_id","saved_from_msg_id","openThread","message1","getMessageWithReplies","getDiscussionMessage","via","setDraft","peerIdStr","documentDiv","groupedItem","SINGLE_MEDIA_CLASSNAME","isSingleMedia","parents","hasAspecter","albumItem","isReplyClick","replyToMid","reply_to_msg_id","ignoreHeavyAnimation","scrollDimensions","forceDown","sliceViewportDebounced","setCorrectIndexThrottled","setStickyDateManually","setPeerPromise","requestHistory","setMessageId","constructBubbles","bubbleGroups","sequential","messagesStorageKey","newItem","_items","groupBubbles","scrollingToBubble","scrollToEnd","deleteMessagesByIds","tempMessage","_bubble","groupedId","getMessagesByAlbum","reactionsElements","repliesElement","newDiv","safeRenderMessage","scrollToBubbleIfLast","deletedMids","wasMainMid","mainMid","createScrollSaver","appendReactionsElementToBubble","dateMessage","dateBubble","previousStickyDate","sliceViewport","setScroll","attachContainerListeners","highlightBubble","replyAfter","shouldReply","canSend","_target","initMessageReply","constructPeerHelpers","updateGradient","renderNewMessage","setUnreadCount","updateUnreadByDialog","finishPeerChange","postViewsElements","different","postViews","incrementMessageViews","createResizeObserver","resizeObserver","wasHeight","skip","scrolled","onResizeEnd","setEndRAF","ResizeObserver","contentRect","realDiff","_part","needScrollTop","destroyResizeObserver","setReactionsHoverListeners","getRenderedLength","readUnreaded","readPromise","idleController","bubblesMaxId","getHistoryMaxId","readContents","constructPinnedHelpers","constructScheduledHelpers","getScheduledMessagesStorage","onGoDownClick","getBubbleByPoint","getGroupedBubble","groupId","getMidsByAlbum","findNextMountedBubbleByMsgId","filterCallback","_mid","foundMid","loadMoreHistory","getHistoryTopPromise","getHistoryBottomPromise","getHistory1","destroyScrollable","getHistoryStorage","readMaxId","readOutboxMaxId","msgId","permanent","ignoreOnScroll","emptyPlaceholderBubble","setTopPadding","setPaddingTo","isPaddingNeeded","unsetPadding","_renderNewMessage","newMessage","replyTo","getLastBubble","performHistoryResult","scrollToBubbleEnd","scrollToBubble","isChangingHeight","messageInput","dimensions","datasetKey","createDateBubble","bubbleContent","serviceMsg","fakeBubble","bubblesToo","cleanupPlaceholders","attachedUnreadBubble","fetchNewPromise","getSponsoredMessagePromise","onAnimateLadder","resolveLadderAnimation","attachPlaceholderOnRender","samePeer","startParam","bindPrefix","onChangePeer","getPinnedMessagesMaxId","isTarget","followingUnread","savedPosition","overrideAdditionMsgId","getChatSavedPosition","getReadMaxIdIfUnread","foundSlice","findSliceOffset","isJump","isStartButtonNeeded","setStartParam","setQueueId","messageEntityBotCommand","additionMsgId","maxBubbleId","oldChatInner","oldPlaceholderBubble","haveToScrollToBubble","fromUp","scrollFromDown","scrollFromUp","willScrollOnLoad","setPeerOptions","waitPromise","setPeerCached","mountedByLastMsgId","setCorrectIndex","lastBubble","onRenderScrollSet","afterSetPromise","setFetchReactionsInterval","setFetchHistoryInterval","onScrolledAllDown","unread_mark","fetchReactions","getMessagesReactions","needFetchInterval","isFetchIntervalNeeded","getNewHistory","isBottomEnd","historyMaxId","canWrite","renderMessagesQueue","setMessagesQueuePromise","possibleError","renderQueue","renderQueuePromises","loadQueue","filterQueue","avatarPromises","updatePosition","timePromises","groupCollapsed","groupEnd","setUnreadDelimiter","restoreScroll","prepareToSaveScroll","ejectBubbles","oldBubble","local","updatePlaceholderPosition","isAvatarNeeded","additionalCallback","processResult","newBubble","originalPromise","renderMessage","messageContentHasToBeMuted","isMessageForwardFromChannel","getPeerMuted","albumMids","reactionsMessage","albumMessages","albumMustBeRenderedFull","our","isOurMessage","contentWrapper","isInUnread","chat_id","is_single","hasToBeMuted","messageMessage","muteMessageEntity","bigEmojis","emojiEntities","strLength","curr","richText","canHaveTail","isStandaloneMedia","needToSetHTML","replyMarkup","reply_markup","containerDiv","rowDiv","buttonEl","botId","same_peer","checkSwitchReturn","switchInlineQuery","column","callbackButtonClick","callbackAnswer","messageWithReplies","getMessageWithCommentReplies","withReplies","isOutMessage","nameContainer","canHideNameIfMedia","processingWebPage","quote","previewResizer","preview","quoteTextDiv","strong","titleDiv","textDiv","isSquare","isEmoji","nopremium","newNameContainer","getMidsByMid","wrapGroupedDocuments","lastContainer","contact","contactDetails","contactNameDiv","contactNumberDiv","phone_number","wrapPoll","priceEl","needName","titleVia","isHidden","goto","generateTail","documentContainer","documentMessageDiv","viewportSlice","deleteViewportSlice","historyResult","needReflowScroll","setLoadedPromises","firstSlice","lastSlice","both","processLocalMessageRender","getHistory","ackedResult","getScheduledMessages","animateAsLadder","additionMsgIds","isAdditionRender","targetMid","sortedMids","topIds","middleIds","bottomIds","setBubbles","lastMsDelay","elementsToAnimate","transitionDelay","topRes","middleRes","bottomRes","delays","renderEmptyPlaceholder","listElements","getRestrictionReasonText","getGreetingSticker","channel_post","start_param","chat_invite","chat_invite_hash","JOIN_CHAT","invite","processInternalLink","creator","isWaitingForAnimation","noTransition","setOn","generateLocalMessageId","addOffset","generateLocalFirstMessage","service","saveMessages","ignoreScrollSaving","invisible","checkPlaceholders","toggleSponsoredMessage","renderBotPlaceholder","checkIfEmptyPlaceholderNeeded","_log","getSponsoredMessage","sponsoredMessages","messagePromise","processPromise","bot_info","botInfo","description_document","description_photo","isBackLimit","resultPromise","isFirstMessageRender","serviceStartMessageId","getThreadServiceMessageId","sup","_promise","mustBeCount","PopupPinMessage","unpin","canUnpin","canPinMessage","oneSide","unpinAllMessages","hidePinnedMessages","updatePinnedMessage","buttonText","getPinnedMessagesCount","pinButtonText","isSelectionEmpty","selectionRange","START_TO_END","preloadAnimatedEmojiSticker","PopupReportMessagesConfirm","reportMessages","STICKER_EMOJI","PopupReportMessages","preloadStickerPromise","marginTop","PopupSponsored","PopupReactedList","canViewReadParticipants","canViewMessageReadParticipants","loaders","hasAllReactions","createFakeReaction","hasReadParticipants","readUserIds","getMessageReadParticipants","chatlist","skipReadParticipants","skipReactionsList","getMessageReactionsListAndReadParticipants","combined","getReactionCached","allReactionsSticker","REACTION_CLASS_NAME","REACTIONS_CLASS_NAME","CAN_USE_TRANSFORM","ChatReactionsMenu","reactionsMap","players","onScrollProcessItem","reactionDiv","appear","widthContainer","reactionsContainer","reactionsScrollable","renderReaction","setVisible","canUseAnimations","scaleContainer","appearWrapper","appear_animation","selectLoadPromise","selectPlayer","REACTION_SIZE","ChatContextMenu","isSelectable","isTextSelected","isAnchorTarget","isUsernameTarget","selectedMid","isOverBubble","isTargetAGroupedItem","noForwards","viewerPeerId","canOpenReactedList","menuPadding","reactionsMenu","reactionsMenuPosition","isReactionsMenuVisible","offsetSize","nextVisiblePart","MIN_NEXT_VISIBLE_PART","minSize","onSendScheduledClick","onReplyClick","onFaveStickerClick","unfave","faveSticker","onEditClick","initMessageEditing","onCopyClick","onCopyAnchorLinkClick","onCopyLinkClick","threadMessage","onUnpinClick","onRetractVote","onStopPoll","stopPoll","setButtons","notDirect","scheduleSending","editMessage","scheduleDate","canEditMessage","getMessageFromStorage","hasTarget","isGoodType","localName","emojiInputsPromise","getUniqueCustomEmojisFromMessage","filterUnique","viewsButton","isViewingReactions","participantsCount","reactedLength","i18nElem","fakeText","AVATAR_SIZE","MAX_AVATARS","PADDING_PER_AVATAR","reactionsCount","fakeElem","readParticipants","totalSize","emojisButton","setPadding","inputsPromise","getCachedCustomEmojiDocuments","getCustomEmojiDocuments","SendMenu","sendMenuButtons","onSilentClick","onScheduleClick","sendMenu","openSide","onContextElement","setPeerId","PopupCreatePoll","onSubmitClick","send","radioLabel","isEmpty","questions","appendMoreField","correctAnswers","optionInputFields","questionInputField","sendSilent","dd","settingsCaption","anonymousCheckboxField","multipleCheckboxField","quizCheckboxField","quizSolutionField","quizElements","quizSolutionCaption","quizHr","quizSolutionContainer","quizSolutionSubtitle","getFilledAnswers","quizSolution","force","quizSolutionEntities","inputMediaPoll","getInputMediaPoll","sendOther","getMessageSendingParams","helperType","clearHelper","questionField","createPosterFromMedia","getGifDuration","arrayBuffer","currentPopup","getCurrentNewMediaPopup","PopupNewMedia","willAttachType","attachFile","willAttach","shouldCompress","itemDiv","attachMedia","attachDocument","sendFileDetails","captionLengthMax","caption_length_max","wasInputValue","messageInputField","attachFiles","appendDrops","appendGroupCheckboxField","groupCheckboxField","mediaCheckboxField","appendMediaCheckboxField","addFiles","toPush","_file","lastModified","isMedia","sendingParams","sendText","sendAlbum","replyToMsgId","startsWith","objectURL","audioDecodedByteCount","webkitAudioDecodedByteCount","noSound","onseeked","onerror","createPosterFromVideo","isPhoto","isAudio","finish","onRender","foundPhotos","foundVideos","foundFiles","appendMediaToContainer","firstType","albumContainer","HANDLE_EVENT","ACTIVE_CLASS_NAME","AXIS_Y_KEYS","AXIS_X_KEYS","attachListNavigation","waitForKey","waitForKeySet","keyNames","getCurrentTarget","setCurrentTarget","scrollTo","hadTarget","getNextTargetX","currentTarget","isNext","nextTarget","handleArrowKey","property","endProperty","currentRect","targetRect","getNextTargetY","fireSelect","canContinue","attached","resetTarget","_onKeyDown","AutocompleteHelper","onVisible","listType","attachNavigation","controller","addHelper","toggleListNavigation","fromController","skipAnimation","hideOtherHelpers","StickersHelper","onChangeScreen","checkEmoticon","getStickersByEmoticon","getMinDate","getMaxDate","PopupSchedule","canSendWhenOnline","btnSendWhenOnline","getRichValueWithCaret","startOffset","startContainer","endContainer","endOffset","possibleChildrenFocusOffset","caretPos","combineSameEntities","EmojiHelper","chatInput","onEmojiSelected","checkQuery","firstChar","getBothEmojiKeywords","searchEmojis","AutocompletePeerHelper","doNotShow","listElement","BASE","BASE_CLASS_LIST_ELEMENT","processPeerFullForCommands","botInfos","commands","command","indexObject","CommandsHelper","getReadyToSend","sendMessage","AutocompleteHelperController","helpers","preserveHelper","MentionsHelper","insertAtCaret","topMsgId","trimmed","getMentions","ReplyKeyboard","onBodyTouchStart","btnHover","checkAvailability","checkForceReply","touchListener","sendContact","getReplyMarkup","getHistoryStorageTransferable","InlineHelper","queryId","queryAndResultIds","generateQId","resultId","sendInlineResult","_checkQuery","botResults","query_id","gifsMasonry","isGallery","gallery","noCommands","separator","dcId","dataURL","switch_pm","btnSwitchToPM","switchToPM","ChatBotCommands","setUserId","modifyAckedResult","acked","modifyAckedPromise","ChatSendAs","sendAsButtons","previousAvatar","onSendAsMenuToggle","updateButtons","sendAsPeerId","changeSendAsPeerId","executeButtonsUpdate","sendAsPeerIds","saveDefaultSendAs","updateAvatar","getDefaultSendAs","getChannelFull","channelFull","default_send_as","updateManual","updatingPromise","wasSkippingAnimation","auto","getSendAs","sendAsPeers","sendAsPeer","premium_required","addedListener","InputFieldAnimated","inputFake","onFakeInput","setHeight","currentHeight","POSTING_MEDIA_NOT_ALLOWED","ChatInput","lastUrl","lastTimeType","replyElements","willSendWebPage","recordCanceled","recordStartTime","lockRedo","canRedoFromHTML","undoHistory","executedHistory","canUndoFromHTML","onCancelRecordClick","recorder","opusDecodeController","onEmoticonsOpen","toggleClass","btnToggleEmoticons","onEmoticonsClose","isUserOnlineVisible","openScheduled","prepareDocumentExecute","undoRedo","needHTML","sameHTMLTimes","currentHTML","handleMarkdownShortcut","formatKeys","markupTooltip","applyMarkdown","showLinkEditor","onMessageInput","markdownEntities","parseMarkdown","urlEntities","getWebPagePromise","appWebPagesManager","getWebPage","setTopInfo","noWebPage","onHelperCancel","helperFunc","botCommands","resetCurrentFontFormatting","updateBotCommandsToggle","editMsgId","saveDraftDebounced","checkAutocomplete","updateSendBtn","onBtnSendClick","forwarding","restricted","voice_messages_forbidden","releaseMediaPlayback","setRecording","showDiscardPopup","btnCancelRecord","recordingOverlayListener","recordingNavigationItem","sourceNode","analyser","createAnalyser","connect","fftSize","frequencyData","frequencyBinCount","getByteFrequencyData","recordRippleEl","ms","recordTimeEl","needReturn","onHelperClick","forwardElements","rowsWrapperWrapper","rowsWrapper","fakeRowsWrapper","fakeSelectionWrapper","goDownBtn","controlContainer","iconBtn","cancelBtn","onHideAuthorClick","isChangingAuthor","canToggleHideAuthor","onHideCaptionClick","forwardButtons","hideSender","showCaption","hideCaption","changePeer","changeForwardRecipient","forwardBtnMenu","forwardWasDroppingAuthor","replyTitle","forwardHover","modifyArgs","newMessageWrapper","inputMessageContainer","goDownUnreadBadge","goMentionBtn","goMentionUnreadBadge","goToNextMention","btnScheduled","btnToggleReplyMarkup","replyKeyboard","botCommandsToggle","scaler","botCommandsIcon","attachMenuButtons","fileInput","attachMenu","multiple","autocompleteHelperController","stickersHelper","emojiHelper","commandsHelper","mentionsHelper","inlineHelper","btnSendContainer","btnSend","attachMessageInputField","previousQuery","saveDraft","encoderSampleRate","monitorGain","numberOfChannels","recordingGain","reuseWorker","onstop","ondataavailable","typedArray","dataBlob","Blob","sendFile","isVoiceMessage","botStartBtn","toggleBotStartBtnDisability","startBot","pinnedControlBtn","originalChat","pinnedMessageContainer","_center","neededFakeContainer","fakeWrapperTo","oldFakeWrapperTo","fakeSelectionRect","fakeRowsRect","scale","initTranslateX","getNeededFakeContainer","hasMentions","no_webpage","syncDraft","helperToo","clearInput","fromUpdate","getDraft","wrappedDraft","myEntities","apiEntities","wrapDraft","createSendAs","firstChange","sendAs","updateOffset","getPlaceholderKey","updateMessageInputPlaceholder","previousSendAs","ackedPeerFull","ackedScheduledMids","setSendAsCallback","filteredAttachMenuButtons","filterAttachMenuButtons","placeholderKey","hasBotCommands","updateBotCommands","updateMessageInput","isAnonymousSending","oldInputField","attachMessageInputListeners","fixSafariStickyInputFocusing","setStart","readAllHistory","commandsMap","saveExecuted","executed","checkType","haveThisType","isCollapsed","commonAncestorContainer","resetCurrentFormatting","setActiveMarkupButton","insertText","insertEntity","isHelper","fullValue","suffix","AUTO_COMPLETE_REG_EXP","matchIndex","newValue","hadEntities","insertLength","addEntities","caretEntity","insertCaretAtIndex","caret","originalNode","newNode","createTextNode","setStartAfter","insertNode","setCaretAt","foundHelper","checkInlineAutocomplete","inlineMatch","btnPreloader","bot_inline_placeholder","inlinePlaceholder","helperWaitingForward","canSetDraft","fireEvent","clearValue","fixSafariStickyInput","clearReply","unicode","pushRecentEmoji","forwardMessages","dropAuthor","dropCaptions","isDroppingCaptions","sendMessageWithDocument","hideCaptionCheckboxField","replyFragment","initMessagesForward","fromPeerIdsMids","fromPeerIds","smth","messagesWithCaptionsLength","peerTitles","titleKey","senderTitles","firstMessage","newReply","intl","peerTitleEl","wrapSingleMessage","_message","callerFunc","replyParent","oldReply","haveReply","CLASSNAME_BASE","PinnedContainer","floating","divAndCaption","wrapperUtils","attachOnCloseEvent","needClose","isFloating","setFloating","setUtilsWidth","BAR_HEIGHTS","ChatAudio","onPlaybackParams","fasterEl","repeatEl","toggleEl","onStop","onMediaPlay","isMusic","prevEl","nextEl","attachClick","volumeProgressLineContainer","tunnel","progressWrapper","playingDetails","PinnedMessageBorder","drawRect","getClipPath","barHeight","GAP","clipPath","getBarHeight","ONE","TWO","THREE","FOUR","MORE","getMarkHeight","markHeight","getMarkTranslateY","getTrackTranslateY","trackHeight","getTrackHeight","clipPathId","markTranslateY","trackTranslateY","mark","AnimatedSuper","getRow","animateFirst","clearRow","clearRows","currentIndex","DURATION","setNewRow","reflow","previousIndex","fromTop","ignorePrevious","previousRow","AnimatedCounter","previousNumber","getDecimal","animatedSuper","decimal","hideLeft","previousDecimalNumber","EMPTY_INDEX","setCount","previousByDecimal","decimalNumber","ChatPinnedMessage","pinnedMaxMid","pinnedMid","pinnedIndex","wasPinnedIndex","wasPinnedMediaIndex","waitForScrollBottom","loadedBottom","loadedTop","scrollDownListenerSetter","getCurrentIndexPromise","isStatic","dAC","pinnedMessageBorder","animatedSubtitle","animatedMedia","animatedCounter","btnOpen","openPinned","setPinnedMessage","_setPinnedMessage","unsetScrollDownListener","testMid","isNeededMore","getCurrentIndex","LOAD_OFFSET","correctAfter","gotRest","getPinnedMessage","backLimited","offset_id_offset","setScrollDownListener","isDown","handleScrollSideEvent","refreshPosition","handleFollowingPinnedMessage","followPinnedMessage","isLast","writeTo","writeMediaTo","ChatTopbar","verifyButtons","isMenuOpen","btnMore","deleteButtonText","menuButtons","buttonsToVerify","verifyVideoChatButton","currentGroupCall","groupCall","verifyCallButton","getCachedFullUser","phone_calls_available","video_calls_available","onJoinGroupCallClick","joinGroupCall","resize","setUtilsRAF","chatUtils","chatAudio","setPeerStatusManual","btnBack","chatInfoContainer","chatInfo","person","avatarElement","btnJoin","btnPinned","btnCall","btnGroupCall","btnMute","btnSearch","pushButtonToVerify","onBtnBackClick","isFirstChat","constructUtils","linked_chat_id","onCallClick","chatContextMenuHintWasShown","contactPeerId","constructAvatar","joinChannel","setMutedState","isTopMessage","hiddenPinnedMessages","constructDiscussionHelpers","byCurrent","setTitleCallback","setStatusCallback","setTitleManual","wasAlreadyUsed","newPinnedMessage","AppPrivateSearchTab","appSearch","btnPickDate","ChatSearch","selectedIndex","onResultsClick","selectResult","onFooterClick","onUpClick","onDownClick","foundCountEl","upBtn","downBtn","footer","dateBtn","renderedCount","ChatBackgroundPatternRenderer","canvases","INSTANCES","renderToCanvas","fillCanvas","crossOrigin","objectUrl","imageWidth","imageHeight","patternHeight","originalHeight","mask","centerY","topY","endY","bottomY","setCanvasDimensions","Chat","backgroundEl","backgroundTempId","sharedMediaTabs","setBackground","patternRenderer","gradientCanvas","previousGradientRenderer","previousPatternRenderer","previousPatternCanvas","isDarkPattern","getInstance","_gradientRenderer","setBackgroundPromise","setType","beforeDestroy","cleanupBackground","searchTab","_isAnyGroup","setAutoDownloadMedia","destroySharedMediaTab","bubblesSetPeerPromise","photoSizeMax","videoSizeMax","fileSizeMax","photo_size_max","video_size_max","getAutoDownloadSettingsByPeerId","callbacksPromise","ignoreThreadId","historyStorageTransferable","historySerialized","MarkupTooltip","waitingForMouseUp","mouseUpCounter","onMouseUpSingle","resetSelection","tools1","tools2","cancelClosening","linkBackButton","linkInput","applyLink","isLinkValid","setTooltipPosition","linkApplyButton","applyDiv","delimiter1","delimiter2","delimiter3","matchUrlProtocol","getActiveMarkupButton","nodes","getSelectedNodes","currentMarkups","activeButtons","isLinkToggle","bodyRect","selectionRect","inputRect","selectionTop","sizesRect","isFirstShow","setMouseUpEvent","handleSelection","ChatDragAndDrop","dropIcon","onDragOver","onDragLeave","onDrop","outlineWrapper","dropHeader","dropSubtitle","headerArgs","setPath","sizeX","sizeY","disableTransition","LineBlobDrawable","maxRadius","minRadius","N","radiusNext","speed","generateBlob","radDif","generateNextBlob","amplitude","speedScale","draw","paint","pinnedTop","progressToPinned","r1","progressNext","x1","x2","cx","y1","y2","bezierCurveTo","WeavingState","stateId","createGradient","shader","getGradientFromType","x0","y0","dt","TopbarWeave","handleDevicePixelRatioChanged","setSize","forceUpdate","resizeHandler","resizeCanvas","invokeDraw","handleFocus","focused","handleBlur","lbd","lbd1","lbd2","currentState","previousState","progressToState","lastUpdateTime","animateToAmplitude","animateAmplitudeDiff","amplitude2","animateAmplitudeDiff2","top1","top2","paint1","globalAlpha","setCurrentState","states","componentDidMount","matchMedia","setAmplitude","componentWillUnmount","setCanvasSize","RLottieIconItemPart","playPart","RLottieIconItem","createPart","initFrame","skipFirstFrameRendering","inverseColor","onLoadForColor","onLoadForPart","getPart","RLottieIcon","startFrame","endFrame","frameCount","SuperRLottieIcon","partState","colorState","getColor","partCallback","changedPartState","changedColorState","setPartState","setColorState","prevState","renderIfPaused","invoke","GroupCallMicrophoneIcon","GROUP_CALL_MICROPHONE_BUTTON_STATE","partName","HAND","MUTED","UNMUTED","GroupCallParticipantMutedIcon","colored","GROUP_CALL_PARTICIPANT_MUTED_STATE","colorStr","MUTED_FOR_ME","MUTED_BY_ADMIN","propertyValue","getColorByMutedState","generateEqualParts","clearMutedStateModifier","GroupCallParticipantStatusElement","element2","actionClassName","GroupCallParticipantsList","getParticipantByPeerId","onElementDestroy","getGroupCallParticipantMutedState","mutedIcon","callVideoCanvasBlur","GroupCallParticipantVideoElement","setPinned","setParticipant","groupCallParticipantMutedIcon","groupCallParticipantStatus","updateParticipant","GroupCallParticipantsVideoElement","participantsElements","groupCallId","setElementDisplay","pinnedSource","pinSource","unpinAll","setInstance","shouldDisplayElement","displayPinned","shouldDisplay","hasAnyVideo","participantElements","participantVideo","getVideoElementFromParticipantByType","_onLengthChange","GroupCallParticipantContextMenu","onOpenProfileClick","PopupGroupCall","targetPeerId","toggleParticipantMuted","editParticipant","canManageCall","can_self_unmute","muted_by_you","kickFromChat","getContainer","GroupCallParticipantsElement","groupCallParticipantsVideo","appGroupCallsManager","getGroupCallParticipants","GroupCallDescriptionElement","descriptionIntl","GroupCallTitleElement","makeButton","_className","buttonDiv","isConfirm","resizeHandlerClassName","MovableElement","fixDimensions","fixPosition","addResizeHandlers","setSwipeHandler","destroyElements","handlers","startTop","startLeft","startWidth","startHeight","resizingSide","isEnlarging","resizeDiff","maxPossible","setPositionToCenter","MovablePanel","toggleMovable","movable","movableOptions","toggleClassName","raise_hand_rating","onFullScreenClick","onToggleControls","buttonsContainer","onVideoClick","btnVideo","toggleVideoSharing","onScreenClick","btnScreen","toggleScreenSharing","toggleMuted","changeRaiseHand","onLeaveClick","hangUp","discard","toggleBigLayout","btnFullScreen","btnExitFullScreen","wasFullScreen","movablePanel","videosCount","wasBig","btnInvite","btnShowColumn","toggleRightColumn","btnFullScreen2","headerInfo","newHeader","newHeaderInfo","newHeaderTitle","btnHideColumn","videosScrollable","groupCallTitle","groupCallDescription","groupCallBodyHeaderDescription","constructButtons","groupCallParticipants","updateInstance","setHasPinned","groupCallMicrophoneIcon","_makeButton","microphoneIcon","btnLeave","setDescription","microphoneButtonState","getGroupCallMicrophoneButtonState","micState","CallDescriptionElement","connectionState","connectedAt","GroupCallMicrophoneIconMini","INIT_STATE","PopupCall","resizeVideoContainers","videoContainers","interlocutorUserId","emojisSubtitle","partyStates","partyMutedState","stateText","constructFirstButtons","constructSecondButtons","wasTryingToJoin","movableElement","controlsHover","getCallInstance","firstButtonsRow","muteI18nElement","secondButtonsRow","declineI18nElement","btnDecline","btnAccept","acceptCall","createVideoContainer","isPendingIncoming","isSharingVideo","isSharingScreen","outputState","getMediaState","oldContainers","mediaState","getVideoElement","hasFrame","hasPromise","videoState","screencastState","videoContainer","output","getEmojisFingerprint","popupWidth","MAX_WIDTH_PX","MAX_HEIGHT_PX","isVertical","MAX_SIZE","biggestSideSize","widthRatio","heightRatio","TopbarCall","onState","amplitudes","weave","clearCurrentInstance","currentDescription","instanceListenerSetter","isChangingInstance","callDescription","convertCallStateToGroupState","groupCallMicrophoneIconMini","throttledMuteClick","weaveContainer","uiNotificationsManager","notificationsShown","notificationIndex","notificationsCount","soundsPlayed","vibrateSupport","faviconEl","titleBackup","titleChanged","stopped","pushInited","updateLocalSettings","updSettings","nodesktop","novibrate","nopreview","nopush","needPush","webPushApiManager","registeredDevice","nosound","requestPermission","Notification","mozVibrate","webkitVibrate","setAppBadge","notificationsUiSupport","notifySoundEl","topMessagesDeferred","toggleToggler","peerString","soundReset","unreadUnmutedPeerIds","tokenData","unregisterDevice","registerDevice","notificationData","custom","hasChat","hasUser","buildNotification","fwdCount","peerReaction","peerTypeNotifySettings","notification","getPeerString","notificationMessage","noIncrement","notificationFromPeerId","peerPhoto","loadAvatar","resetTitle","isBlink","setFavicon","titleInterval","fontSize","textBaseline","textAlign","prevFavicon","replaceChild","testSound","permission","appRuntimeManager","onclose","getLocalSettings","nextSoundAt","prevSoundVolume","filename","token_type","tokenType","tokenValue","other_uids","app_sandbox","secret","getFilesFromEvent","onlyTypes","scanFiles","isDirectory","directoryReader","createReader","readEntries","itemFile","getAsFile","DataTransferItem","DragEvent","dataTransfer","webkitGetAsEntry","AppImManager","columnEl","offline","updateStatusInterval","cacheStorage","saveState","parseUriParams","tgaddr","postId","openUsername","userName","setSettings","chatsSelectTabDebounced","toggleChatGradientAnimation","onDocumentPaste","attachType","newMediaPopup","_types","canDrag","backgroundPromises","IS_FIREFOX","updateStatus","emojiAnimationContainer","appendEmojiAnimationContainer","createNewChat","chatsSelectTab","compareVersion","deleteFilesIterative","applyCurrentTheme","resizeInstances","saveChatPosition","choosing","setChoosingStickerTyping","typing","onInstanceDeactivated","isUpdated","receiptMessage","onSpoilerClick","spoilerTimeout","stateStorage","topbarCall","discardCurrentCall","currentCall","setAuthorized","telegramMeWebManager","addAnchorListener","uriParams","hashtag","STICKER_SET","EMOJI_SET","pathnameParams","protocol","makeLink","INVOICE","VOICE_CHAT","USER_PHONE_NUMBER","PRIVATE_POST","channel","thread","comment","MESSAGE","attachKeydownListener","timeoutOperation","requests","request","isBad","activatingChat","screen","IGNORE_KEYS","getFirstMessageToEdit","getNextDialog","newEvent","KeyboardEvent","commentId","resolveChannel","checkChatInvite","saveApiChat","resolvePhone","getInputInvoiceBySlug","openUrl","wrappedUrl","u","host","noPathnameParams","noUriParams","openComment","generateThreadServiceStartMessage","phone_calls_private","ignoreGroupCall","ignoreCall","discardGroupCallConfirmation","discardCallConfirmation","isClosing","getGroupCallFull","createGroupCall","setCurrentBackground","broadcastEvent","getBackground","getFile","lastBackgroundUrl","chatBubbles","chatPositions","backgroundUrl","prevTab","prevIdx","attachDragAndDropListeners","drops","mediaDrops","isFiles","_dropsContainer","mediaDropsContainer","dropsContainer","_drops","foundMedia","onImTabChange","updateMyOnlineStatus","spliceChats","fromIndex","chatFrom","chatTo","chatIndex","existingIndex","oldChat","getTypingElement","dot","eye","getPeerTyping","getPeerTypings","langPackKeys","multi","mapa","typingElement","descriptionElement","getChatStatus","typingEl","onlines","getOnlines","getUserStatus","ignoreSelf","getPeerStatus","useWhitespace","typingContainer","DialogColorsFg","DialogColors","DialogColorsMap","pic","useBytes","bestPhotoSize","CallConnectionInstanceBase","connection","sources","createPeerConnection","RTCPeerConnection","signalingState","iceConnectionState","createDataChannel","dataChannel","createDescription","appendStreamToConference","streamManager","appendToConference","closeConnection","closeConnectionAndStream","stopStream","negotiate","negotiating","negotiateInternal","sendDataChannelData","parseSignalingData","sdp","parseMediaSectionInfo","fingerprint","ufrag","pwd","convertNumber","isSending","codec","ssrc","sourceGroups","ssrcGroups","sourceGroup","semantics","ssrcs","rtpExtensions","payloadTypesMap","getPayloadType","payloadType","clockrate","feedbackTypes","subtype","parameters","payloadTypes","CallConnectionInstance","localDescription","remoteDescription","descriptionInit","offerReceived","createAnswer","setLocalDescription","offer","createOffer","offerSent","initialSetup","sendCallSignalingData","crypto","subtle","P2PEncryptor","p2pKey","seqMap","concatSHA256","bufferConcats","convertToUint8Array","encryptPrepared","msgKeyLarge","subarray","msgKey","aesKeyIv","prepareAesKeyIv","aesProcessCtr","encryptRawPacket","seq","ArrayBuffer","setUint32","sha256a","sha256b","iv","encryptedData","dataSize","encrypt","cryptoKey","constTimeIsDifferent","msgKeyEquals","decryptRawPacket","encryptedDataSize","decryptionBuffer","getUint32","ChromeP2PSdpBuilder","fingerprints","stringBuilder","streamName","addExtmap","addPayloadTypes","addSsrc","finalize","FirefoxP2PSdpBuilder","SafariP2PSdpBuilder","isFirefox","isSafari","extmap","j","fmtp","getOwnPropertyNames","pName","ssrcGroup","P2PSdpBuilder","sdpString","sdpMLineIndex","sdpMid","foundation","component","priority","relAddress","generation","tcpType","networkId","networkCost","candidate","generateOffer","generateAnswer","CallInstance","udp_p2p","udp_reflector","min_layer","max_layer","library_versions","createdAt","decryptQueue","candidates","canCreateConferenceEntry","setMediaState","sendMediaState","mediaStates","_sendMediaState","_connectionState","connectionInstance","sortIndex","findEntry","recvEntry","startScreenSharingInternal","wasStartingScreen","wasStartingVideo","requestScreen","stopVideoSharing","startVideoSharingInternal","requestInputSource","track","inputStream","getVideoTracks","stopTrack","isSharingVideoType","audioTrack","getAudioTracks","setHangUpTimeout","clearHangUpTimeout","hangUpTimeout","setPhoneCall","phoneCall","canAccept","overrideConnectionState","g_a_hash","appCallsManager","generateDh","dh","g_b","g_a","g_b_hash","getCallInput","phonePhoneCall","savePhonePhoneCall","joinCall","encryptionKey","configuration","iceServers","connections","ipv6","port","urls","turn","stun","credential","iceTransportPolicy","p2p_allowed","getRtcConfiguration","sendIceCandidate","onTrack","encryptor","decryptor","processDecryptQueue","createDataChannelEntry","dataChannelEntry","createEntry","sendEntry","negotiated","applyDataChannelData","TextEncoder","encode","iceCandidate","parsed","p2pParseCandidate","confirmCall","key_fingerprint","computeKey","emojisFingerprint","getEmojisFingerprintPromise","codePoints","unlockStreamManager","doTheMagic","getTransceivers","transceiver","getEntryByMid","bundle","sdpDescription","generateSdp","isAnswer","setRemoteDescription","onInputStream","stream","videoTrack","onMutedChange","requestAudioSource","setMuted","discardReason","discardedByOtherParty","hasVideo","discardCall","performCodec","_codec","setDataToDescription","setData","transport","screencast","filterNotVP8","vp8PayloadType","rtxIdx","apt","applyCallSignalingData","performSsrcGroups","getEntryBySource","sendRecvEntry","findFreeSendRecvEntry","setEntrySource","tryToReleaseCandidates","generateCandidate","RTCIceCandidate","addIceCandidate","decryptedData","TextDecoder","decode","signalingData","onUpdatePhoneCallSignalingData","getStreamCached","_cache","isScreen","constraints","getScreenStream","getStream","CallInstanceBase","fixSafariAudio","isSharingAudio","hasInputTrackKind","isAudioGood","isVideoGood","getAudioConstraints","getVideoConstraints","getScreenConstraints","endpoint","tryAddTrack","streams","saveInputVideoStream","isOutput","elementEndpoint","addTrack","useStream","outputStream","srcObject","sinkId","outputDeviceId","setSinkId","getTracks","addStream","CALL_STATE","audioAsset","CALL_REQUEST_TIMEOUT","CallsController","sortedInstances","createCallInstance","admin_id","g_a_or_b","bytesCmp","callId","getCallByUserId","hasConnected","hasCurrent","startCallInternal","fullInfo","participant_id","requestCall","GROUP_CALL_AMPLITUDE_ANALYSE_COUNT_MAX","GROUP_CALL_AMPLITUDE_ANALYSE_INTERVAL_MS","GroupCallConnectionInstance","negotiateThrottled","bundlePolicy","rtcpMuxPolicy","iceCandidatePoolSize","maybeUpdateRemoteVideoConstraints","updateConstraintsInterval","invokeJoinGroupCall","localSdp","mainChannels","processedChannels","sectionInfo","payload","processMediaSection","audioChannel","videoChannel","useChannel","setEntryPeerId","performExtmap","filterServerCodecs","isNewConnection","originalOffer","iceRestart","hasMunged","skipAddingMulticast","mediaLine","mediaLineParts","localMLine","codecIds","newData","setPort","setSource","newSdp","addSsrcEntry","newChannel","mungedSdp","fixLocalOffer","entriesToDelete","shouldBeSkipped","answerDescription","deleteEntry","iceGatheringState","updateConstraints","sender","setParameters","getParameters","degradationPreference","colibriClass","defaultConstraints","onStageEndpoints","addInputVideoStream","GroupCallInstance","isSpeakingMap","pinnedSources","participantsSsrcs","hadAutoPinnedSources","dispatchPinnedThrottled","getCachedParticipants","presentation","unpinSource","changeUserMuted","source_groups","clone","createConnectionInstance","raise","raiseHand","stopScreenSharing","startScreenSharing","startScreenSharingPromise","saveApiParticipant","leaveGroupCallPresentation","videoPaused","videoStopped","startVideoSharing","startVideoSharingPromise","rejoin","isDiscarded","isUpdatingMeInCurrentCall","onParticipantUpdate","doNotDispatchParticipantUpdate","hasLeft","oldSsrcs","modifiedTypes","oldSsrc","oldSource","oldEntry","originalDirection","setEndpoint","createTransceiver","GROUP_CALL_STATE","makeSsrcsFromParticipant","makeSsrcFromParticipant","audio_source","generateSelfVideo","audioSource","GroupCallsController","setCurrentGroupCall","startConnectingSound","stopConnectingSound","joinVideo","MediaStream","createMainStreamManager","joinGroupCallInternal","handleUpdateGroupCallParticipants","updatingSdp","channelCount","constraint","mediaDevices","getSupportedConstraints","constraintSupported","skipAudio","frameRate","screenStream","getDisplayMedia","contentHint","getUserMedia","clientInfo","lookupAttributeKeys","telegramSourceGroups","sdpLines","rest","parseSourceGroups","raw","ConferenceEntry","addTransceiver","generateSsrc","LocalConferenceDescription","sessionId","maxSeenId","entriesByMid","entriesBySource","entriesByPeerId","getEntriesByPeerId","conference","SDP","mediaSections","splitStringByLimitWithRest","UniqueNumberGenerator","generate","maxTries","_try","SDPAttributeSplitted","SDPMediaLineParts","SDPLine","SDPAttributeInner","missed","exists","nestedMap","makeAttributes","innerParts","SDPAttributes","fillAttributes","attributesMap","linesArray","SDPMediaSection","isReceiving","resultShouldBeArray","SDPSessionSection","parseSdp","createSection","sessionSection","lineStr","isIncorrectSdpLine","parseSdpLine","addSimulcast","generator","originalSsrcs","ssrcs2","ssrcsStrLines","ssrc2","WEBRTC_MEDIA_PORT","fixMediaLineType","getConnectionTypeForMediaType","generateMediaFirstLine","payloadIds","connectionType","SDPBuilder","addCandidate","performCandidate","addHeader","sId","bundleMids","addTransport","skipCandidates","addSource","addMsid","isApplication","isInactive","hdrexts","hdrext","fbs","fb","addConference","AudioStreamAnalyser","streamSource","createMediaStreamSource","gain","createGain","minDecibels","maxDecibels","smoothingTimeConstant","StreamManager","getAmplitude","streamAnalyser","analyse","ANALYSER_LISTENER","AudioContext","webkitAudioContext","getSource","itemSource","removeTrack","finalizeAddingTrack","changeTimer","substring","replaceInputAudio","oldTrack","timer","transceiverInit","tracks","mediaTrackType","trackIdx","replaceTrack","StringFromLineBuilder","newLine","addJoined","toTelegramSource","fromTelegramSource","rms","onlyFirst","E","wrappingDraft","messageEntityTextUrl","messageEntityMentionName","isDraft","setBlankToAnchor","EMOJI_VERSIONS_SUPPORTED","inlineEl","newEmojiWidth","legacyEmojiWidth","isEmojiSupported","setDimensionsFromRect","CustomEmojiElement","renderer","syncedPlayer","pausedElements","lastPausedVideo","elementsCounter","CustomEmojiRendererElement","playersSynced","syncedElements","clearedElements","emojiRenderers","syncedPlayers","syncedPlayersFrames","overrideRender","clearRenderInterval","getOffsets","offsetsMap","offsetParent","clearCanvas","isDimensionsSet","isImageData","ImageData","frameWidth","frameHeight","checkForAnyFrame","emojiRenderInterval","renderEmojis","nasty","usedLength","customEmojis","contextSite","contextExternal","lastEntity","nextEntity","endPartOffset","fullEntityText","partText","usedText","fontStyle","styleName","fontFamily","atPos","fromBot","encodeURIComponent","isSupported","masked","currentContext","electronHelpers","contextUrl","encoded","encodeSpoiler","entityText","voodoo","wrap","_loadPromises","isLottie","middlewares","addition","_p","missing","cachedPromises","uncachedPromisesPromise","loadFromPromises","uncached","QueryableWorker","worker","terminate","onmessage","queryMethodListener","queryMethodArguments","postMessage","sendQuery","transfer","queryMethod","workersLimit","playersByCacheName","workers","curWorkerNum","onPlayerLoaded","reqId","fps","clamped","onPlayerError","getAnimation","setLoop","_autoplay","loadLottieWorkers","remain","Worker","queryableWorker","loadAnimationAsAsset","loadAnimationFromURL","blobConstruct","newParams","loadAnimationWorker","waitForFirstFrame","cacheName","initPlayer","destroyWorkers","loadFromData","FramesCache","framesNew","framesURLs","getCache","createCache","releaseCache","getCacheCounter","generateName","RLottiePlayer","cachingDelta","CACHE","skipDelta","getLottiePixelRatio","contexts","setMainLoop","clearPendingRAF","rafId","resetCurrentFrame","minFrame","renderFirstFrame","requestFrame","applyInversing","renderFrame2","cachedSource","renderedFirstFrame","ImageBitmap","frInterval","frThen","frameNew","onLap","mainLoopForwards","mainLoopBackwards","currentMethod","frameListener","listenerResults","enterFrame","playToFrame","bounds","setMinMax","playToFrameOnFrameCallback","setInverseColor","pagesManager","pageId","pagesDiv","scrollableDiv","page","onShown","setPage","isAuthPage","Page","onFirstMount","onMount","encodeEmoji","emojiText","toCodePoints","removeVS16s","vs16RegExp","zeroWidthJoiner","rawEmoji","unicodeSurrogates","points","getEmojiToneIndex","getCountryEmoji","emojiFromCodePoints","fromCodePoint","module","exports","defineProperty","enumerable","Symbol","toStringTag","__esModule","prototype","isRecordingSupported","bufferLength","encoderApplication","encoderFrameSize","encoderPath","maxFramesPerPage","mediaTrackConstraints","resampleQuality","streamPages","wavBitDepth","encodedSamplePosition","WebAssembly","clearStream","audioContext","closeAudioContext","encodeBuffers","getChannelData","encoder","buffers","initAudioContext","initAudioGraph","scriptProcessorNode","createScriptProcessor","destination","onaudioprocess","inputBuffer","monitorGainNode","setMonitorGain","recordingGainNode","setRecordingGain","initSourceNode","loadWorker","initWorker","streamPage","storePage","recordedPages","samplePosition","originalSampleRate","sampleRate","wavSampleRate","onpause","resume","onresume","setTargetAtTime","onstart","destroyWorker","Function"],"sourceRoot":""}